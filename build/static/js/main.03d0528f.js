/*! For license information please see main.03d0528f.js.LICENSE.txt */
(()=>{var e={551:()=>{},579:(e,t,n)=>{"use strict";e.exports=n(1153)},1153:(e,t,n)=>{"use strict";var r=n(5043),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:u,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},1234:()=>{},2016:(e,t,n)=>{"use strict";e.exports=n(6958)},2062:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,s=a>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(m=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,m&&(m=!1,y(E),E=-1),p=!0;var i=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!k());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&a(c),b(n)}else a(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,B=-1;function k(){return!(t.unstable_now()-B<N)}function I(){if(null!==C){var e=t.unstable_now();B=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(I)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,M=T.port2;T.port1.onmessage=I,_=function(){M.postMessage(null)}}else _=function(){g(I,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,a,i){var s=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?s+i:s:i=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>s?(e.sortIndex=i,n(u,e),null===r(c)&&e===r(u)&&(m?(y(E),E=-1):m=!0,R(x,i-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2430:function(e,t,n){var r;!function(a,i,s){var o,l=256,c=s.pow(l,6),u=s.pow(2,52),h=2*u,d=255;function A(e,t,n){var r=[],d=g(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),A=new p(r),v=function(){for(var e=A.g(6),t=c,n=0;e<u;)e=(e+n)*l,t*=l,n=A.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|A.g(4)},v.quick=function(){return A.g(4)/4294967296},v.double=v,g(y(A.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&f(r,A),e.state=function(){return f(A,{})}),n?(s.random=e,t):e})(v,d,"global"in t?t.global:this==s,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<l;)s[a]=a++;for(a=0;a<l;a++)s[a]=s[i=d&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=d&a+1],n=n*l+s[d&(s[a]=s[i=d&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(l)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(s.random(),i),e.exports){e.exports=A;try{o=n(1234)}catch(v){}}else void 0===(r=function(){return A}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},2730:(e,t,n)=>{"use strict";var r=n(5043),a=n(8853);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},p={};function f(e,t,n,r,a,i,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!h.call(p,e)||!h.call(A,e)&&(d.test(e)?p[e]=!0:(A[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,y);m[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),N=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),M=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var F=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var U,P=Object.assign;function D(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var O=!1;function z(e,t){if(!e||O)return"";O=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),s=a.length-1,o=i.length-1;1<=s&&0<=o&&a[s]!==i[o];)o--;for(;1<=s&&0<=o;s--,o--)if(a[s]!==i[o]){if(1!==s||1!==o)do{if(s--,0>--o||a[s]!==i[o]){var l="\n"+a[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{O=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?D(e):""}function H(e){switch(e.tag){case 5:return D(e.type);case 16:return D("Lazy");case 13:return D("Suspense");case 19:return D("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case k:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case N:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case B:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case T:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case M:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function Q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=W(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return P({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return P({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ie(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ae={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||Ae.hasOwnProperty(e)&&Ae[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(Ae).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ae[t]=Ae[e]})});var ge=P({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,_e=null,Se=null;function Ce(e){if(e=va(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=xa(t),we(e.stateNode,e.type,t))}}function Ee(e){_e?Se?Se.push(e):Se=[e]:_e=e}function Ne(){if(_e){var e=_e,t=Se;if(Se=_e=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Be(e,t){return e(t)}function ke(){}var Ie=!1;function Te(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Be(e,t,n)}finally{Ie=!1,(null!==_e||null!==Se)&&(ke(),Ne())}}function Me(e,t){var n=e.stateNode;if(null===n)return null;var r=xa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Fe=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){Fe=!1}function Le(e,t,n,r,a,i,s,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Ue=!1,Pe=null,De=!1,Oe=null,ze={onError:function(e){Ue=!0,Pe=e}};function He(e,t,n,r,a,i,s,o,l){Ue=!1,Pe=null,Le.apply(ze,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(je(e)!==e)throw Error(i(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var s=a.alternate;if(null===s){if(null!==(r=a.return)){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return Ve(a),e;if(s===r)return Ve(a),t;s=s.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=s;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=a.unstable_scheduleCallback,qe=a.unstable_cancelCallback,Xe=a.unstable_shouldYield,Ye=a.unstable_requestPaint,Je=a.unstable_now,Ze=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~a;0!==o?r=ht(o):0!==(i&=s)&&(r=ht(i))}else 0!==(s=n&~a)?r=ht(s):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-st(t)),r|=e[n],t&=~a;return r}function At(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var vt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,_t,St,Ct,Et=!1,Nt=[],Bt=null,kt=null,It=null,Tt=new Map,Mt=new Map,Ft=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Bt=null;break;case"dragenter":case"dragleave":kt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Tt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(t.pointerId)}}function Ut(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=va(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Pt(e){var t=ya(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Qe(n)))return e.blockedOn=t,void Ct(e.priority,function(){_t(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Dt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=va(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ot(e,t,n){Dt(e)&&n.delete(t)}function zt(){Et=!1,null!==Bt&&Dt(Bt)&&(Bt=null),null!==kt&&Dt(kt)&&(kt=null),null!==It&&Dt(It)&&(It=null),Tt.forEach(Ot),Mt.forEach(Ot)}function Ht(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,zt)))}function jt(e){function t(t){return Ht(t,e)}if(0<Nt.length){Ht(Nt[0],e);for(var n=1;n<Nt.length;n++){var r=Nt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Bt&&Ht(Bt,e),null!==kt&&Ht(kt,e),null!==It&&Ht(It,e),Tt.forEach(t),Mt.forEach(t),n=0;n<Ft.length;n++)(r=Ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ft.length&&null===(n=Ft[0]).blockedOn;)Pt(n),null===n.blockedOn&&Ft.shift()}var Qt=b.ReactCurrentBatchConfig,Vt=!0;function Wt(e,t,n,r){var a=vt,i=Qt.transition;Qt.transition=null;try{vt=1,Kt(e,t,n,r)}finally{vt=a,Qt.transition=i}}function Gt(e,t,n,r){var a=vt,i=Qt.transition;Qt.transition=null;try{vt=4,Kt(e,t,n,r)}finally{vt=a,Qt.transition=i}}function Kt(e,t,n,r){if(Vt){var a=Xt(e,t,n,r);if(null===a)Vr(e,t,r,qt,n),Lt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Bt=Ut(Bt,e,t,n,r,a),!0;case"dragenter":return kt=Ut(kt,e,t,n,r,a),!0;case"mouseover":return It=Ut(It,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Tt.set(i,Ut(Tt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Mt.set(i,Ut(Mt.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==a;){var i=va(a);if(null!==i&&xt(i),null===(i=Xt(e,t,n,r))&&Vr(e,t,r,qt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var qt=null;function Xt(e,t,n,r){if(qt=null,null!==(e=ya(e=xe(r))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(a):a[s]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return P(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),hn=P({},cn,{view:0,detail:0}),dn=an(hn),An=P({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=an(An),fn=an(P({},An,{dataTransfer:0})),mn=an(P({},hn,{relatedTarget:0})),gn=an(P({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=P({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=an(yn),bn=an(P({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function Cn(){return Sn}var En=P({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Nn=an(En),Bn=an(P({},An,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),kn=an(P({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),In=an(P({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Tn=P({},An,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mn=an(Tn),Fn=[9,13,27,32],Rn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var Un=u&&"TextEvent"in window&&!Ln,Pn=u&&(!Rn||Ln&&8<Ln&&11>=Ln),Dn=String.fromCharCode(32),On=!1;function zn(e,t){switch(e){case"keyup":return-1!==Fn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Qn[e.type]:"textarea"===t}function Wn(e,t,n,r){Ee(r),0<(t=Gr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function qn(e){Dr(e,0)}function Xn(e){if(K(ba(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Zn;if(u){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Kn=Gn=null)}function nr(e){if("value"===e.propertyName&&Xn(Kn)){var t=[];Wn(t,Kn,e,xe(e)),Te(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Kn)}function ir(e,t){if("click"===e)return Xn(t)}function sr(e,t){if("input"===e||"change"===e)return Xn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!h.call(t,a)||!or(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function Ar(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&Ar(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=ur(n,i);var s=ur(n,r);a&&s&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,vr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==mr||mr!==q(r)||("selectionStart"in(r=mr)&&Ar(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Gr(gr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},_r={},Sr={};function Cr(e){if(_r[e])return _r[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return _r[e]=n[t];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Er=Cr("animationend"),Nr=Cr("animationiteration"),Br=Cr("animationstart"),kr=Cr("transitionend"),Ir=new Map,Tr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mr(e,t){Ir.set(e,t),l(t,[e])}for(var Fr=0;Fr<Tr.length;Fr++){var Rr=Tr[Fr];Mr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Mr(Er,"onAnimationEnd"),Mr(Nr,"onAnimationIteration"),Mr(Br,"onAnimationStart"),Mr("dblclick","onDoubleClick"),Mr("focusin","onFocus"),Mr("focusout","onBlur"),Mr(kr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ur=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Pr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,s,o,l,c){if(He.apply(this,arguments),Ue){if(!Ue)throw Error(i(198));var u=Pe;Ue=!1,Pe=null,De||(De=!0,Oe=u)}}(r,t,void 0,e),e.currentTarget=null}function Dr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&a.isPropagationStopped())break e;Pr(a,o,c),i=l}else for(s=0;s<r.length;s++){if(l=(o=r[s]).instance,c=o.currentTarget,o=o.listener,l!==i&&a.isPropagationStopped())break e;Pr(a,o,c),i=l}}}if(De)throw e=Oe,De=!1,Oe=null,e}function Or(e,t){var n=t[fa];void 0===n&&(n=t[fa]=new Set);var r=e+"__bubble";n.has(r)||(Qr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Qr(n,e,r,t)}var Hr="_reactListening"+Math.random().toString(36).slice(2);function jr(e){if(!e[Hr]){e[Hr]=!0,s.forEach(function(t){"selectionchange"!==t&&(Ur.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hr]||(t[Hr]=!0,zr("selectionchange",!1,t))}}function Qr(e,t,n,r){switch(Yt(t)){case 1:var a=Wt;break;case 4:a=Gt;break;default:a=Kt}n=a.bind(null,t,n,e),a=void 0,!Fe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===a||8===o.nodeType&&o.parentNode===a)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;s=s.return}for(;null!==o;){if(null===(s=ya(o)))return;if(5===(l=s.tag)||6===l){r=i=s;continue e}o=o.parentNode}}r=r.return}Te(function(){var r=i,a=xe(n),s=[];e:{var o=Ir.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Nn;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=kn;break;case Er:case Nr:case Br:l=gn;break;case kr:l=In;break;case"scroll":l=dn;break;case"wheel":l=Mn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Bn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var A,p=r;null!==p;){var f=(A=p).stateNode;if(5===A.tag&&null!==f&&(A=f,null!==d&&(null!=(f=Me(p,d))&&u.push(Wr(p,f,A)))),h)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,a),s.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[pa])&&(l||o)&&(o=a.window===a?a:(o=a.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(h=je(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,f="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Bn,f="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:ba(l),A=null==c?o:ba(c),(o=new u(f,p+"leave",l,n,a)).target=h,o.relatedTarget=A,f=null,ya(a)===r&&((u=new u(d,p+"enter",c,n,a)).target=A,u.relatedTarget=h,f=u),h=f,l&&c)e:{for(d=c,p=0,A=u=l;A;A=Kr(A))p++;for(A=0,f=d;f;f=Kr(f))A++;for(;0<p-A;)u=Kr(u),p--;for(;0<A-p;)d=Kr(d),A--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=Kr(u),d=Kr(d)}u=null}else u=null;null!==l&&qr(s,o,l,u,!1),null!==c&&null!==h&&qr(s,h,c,u,!0)}if("select"===(l=(o=r?ba(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Yn;else if(Vn(o))if(Jn)m=sr;else{m=ar;var g=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=ir);switch(m&&(m=m(e,r))?Wn(s,m,n,a):(g&&g(e,o,r),"focusout"===e&&(g=o._wrapperState)&&g.controlled&&"number"===o.type&&ee(o,"number",o.value)),g=r?ba(r):window,e){case"focusin":(Vn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,br(s,n,a);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":br(s,n,a)}var y;if(Rn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else jn?zn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Pn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==v?"onCompositionEnd"===v&&jn&&(y=en()):(Zt="value"in(Jt=a)?Jt.value:Jt.textContent,jn=!0)),0<(g=Gr(r,v)).length&&(v=new bn(v,e,null,n,a),s.push({event:v,listeners:g}),y?v.data=y:null!==(y=Hn(n))&&(v.data=y))),(y=Un?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(On=!0,Dn);case"textInput":return(e=t.data)===Dn&&On?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Rn&&zn(e,t)?(e=en(),$t=Zt=Jt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(a=new bn("onBeforeInput","beforeinput",null,n,a),s.push({event:a,listeners:r}),a.data=y))}Dr(s,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Me(e,n))&&r.unshift(Wr(e,i,a)),null!=(i=Me(e,t))&&r.push(Wr(e,i,a))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,a){for(var i=t._reactName,s=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,a?null!=(l=Me(n,i))&&s.unshift(Wr(n,l,o)):a||null!=(l=Me(n,i))&&s.push(Wr(n,l,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function Zr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,sa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(oa)}:ra;function oa(e){setTimeout(function(){throw e})}function la(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void jt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);jt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ua(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ha=Math.random().toString(36).slice(2),da="__reactFiber$"+ha,Aa="__reactProps$"+ha,pa="__reactContainer$"+ha,fa="__reactEvents$"+ha,ma="__reactListeners$"+ha,ga="__reactHandles$"+ha;function ya(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ua(e);null!==e;){if(n=e[da])return n;e=ua(e)}return t}n=(e=n).parentNode}return null}function va(e){return!(e=e[da]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ba(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function xa(e){return e[Aa]||null}var wa=[],_a=-1;function Sa(e){return{current:e}}function Ca(e){0>_a||(e.current=wa[_a],wa[_a]=null,_a--)}function Ea(e,t){_a++,wa[_a]=e.current,e.current=t}var Na={},Ba=Sa(Na),ka=Sa(!1),Ia=Na;function Ta(e,t){var n=e.type.contextTypes;if(!n)return Na;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ma(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Fa(){Ca(ka),Ca(Ba)}function Ra(e,t,n){if(Ba.current!==Na)throw Error(i(168));Ea(Ba,t),Ea(ka,n)}function La(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,Q(e)||"Unknown",a));return P({},n,r)}function Ua(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Na,Ia=Ba.current,Ea(Ba,e),Ea(ka,ka.current),!0}function Pa(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=La(e,t,Ia),r.__reactInternalMemoizedMergedChildContext=e,Ca(ka),Ca(Ba),Ea(Ba,e)):Ca(ka),Ea(ka,n)}var Da=null,Oa=!1,za=!1;function Ha(e){null===Da?Da=[e]:Da.push(e)}function ja(){if(!za&&null!==Da){za=!0;var e=0,t=vt;try{var n=Da;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Da=null,Oa=!1}catch(a){throw null!==Da&&(Da=Da.slice(e+1)),Ke($e,ja),a}finally{vt=t,za=!1}}return null}var Qa=[],Va=0,Wa=null,Ga=0,Ka=[],qa=0,Xa=null,Ya=1,Ja="";function Za(e,t){Qa[Va++]=Ga,Qa[Va++]=Wa,Wa=e,Ga=t}function $a(e,t,n){Ka[qa++]=Ya,Ka[qa++]=Ja,Ka[qa++]=Xa,Xa=e;var r=Ya;e=Ja;var a=32-st(r)-1;r&=~(1<<a),n+=1;var i=32-st(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Ya=1<<32-st(t)+a|n<<a|r,Ja=i+e}else Ya=1<<i|n<<a|r,Ja=e}function ei(e){null!==e.return&&(Za(e,1),$a(e,1,0))}function ti(e){for(;e===Wa;)Wa=Qa[--Va],Qa[Va]=null,Ga=Qa[--Va],Qa[Va]=null;for(;e===Xa;)Xa=Ka[--qa],Ka[qa]=null,Ja=Ka[--qa],Ka[qa]=null,Ya=Ka[--qa],Ka[qa]=null}var ni=null,ri=null,ai=!1,ii=null;function si(e,t){var n=Tc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oi(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xa?{id:Ya,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Tc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function li(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!oi(e,t)){if(li(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&oi(e,t)?si(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(li(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function ui(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function hi(e){if(e!==ni)return!1;if(!ai)return ui(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(li(e))throw di(),Error(i(418));for(;t;)si(e,t),t=ca(t.nextSibling)}if(ui(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=ca(e.nextSibling)}function Ai(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var fi=b.ReactCurrentBatchConfig;function mi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=a.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function gi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function vi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Fc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Pc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===M&&yi(i)===t.type)?((r=a(t,n.props)).ref=mi(e,t,n),r.return=e,r):((r=Rc(n.type,n.key,n.props,null,e.mode,r)).ref=mi(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Dc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Pc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=mi(e,null,t),n.return=e,n;case w:return(t=Dc(t,e.mode,n)).return=e,t;case M:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;gi(e,t)}return null}function A(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===a?c(e,t,n,r):null;case w:return n.key===a?u(e,t,n,r):null;case M:return A(e,t,(a=n._init)(n._payload),r)}if(te(n)||L(n))return null!==a?null:h(e,t,n,r,null);gi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case M:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,a,null);gi(t,r)}return null}function f(a,i,o,l){for(var c=null,u=null,h=i,f=i=0,m=null;null!==h&&f<o.length;f++){h.index>f?(m=h,h=null):m=h.sibling;var g=A(a,h,o[f],l);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(a,h),i=s(g,i,f),null===u?c=g:u.sibling=g,u=g,h=m}if(f===o.length)return n(a,h),ai&&Za(a,f),c;if(null===h){for(;f<o.length;f++)null!==(h=d(a,o[f],l))&&(i=s(h,i,f),null===u?c=h:u.sibling=h,u=h);return ai&&Za(a,f),c}for(h=r(a,h);f<o.length;f++)null!==(m=p(h,a,f,o[f],l))&&(e&&null!==m.alternate&&h.delete(null===m.key?f:m.key),i=s(m,i,f),null===u?c=m:u.sibling=m,u=m);return e&&h.forEach(function(e){return t(a,e)}),ai&&Za(a,f),c}function m(a,o,l,c){var u=L(l);if("function"!==typeof u)throw Error(i(150));if(null==(l=u.call(l)))throw Error(i(151));for(var h=u=null,f=o,m=o=0,g=null,y=l.next();null!==f&&!y.done;m++,y=l.next()){f.index>m?(g=f,f=null):g=f.sibling;var v=A(a,f,y.value,c);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(a,f),o=s(v,o,m),null===h?u=v:h.sibling=v,h=v,f=g}if(y.done)return n(a,f),ai&&Za(a,m),u;if(null===f){for(;!y.done;m++,y=l.next())null!==(y=d(a,y.value,c))&&(o=s(y,o,m),null===h?u=y:h.sibling=y,h=y);return ai&&Za(a,m),u}for(f=r(a,f);!y.done;m++,y=l.next())null!==(y=p(f,a,m,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?m:y.key),o=s(y,o,m),null===h?u=y:h.sibling=y,h=y);return e&&f.forEach(function(e){return t(a,e)}),ai&&Za(a,m),u}return function e(r,i,s,l){if("object"===typeof s&&null!==s&&s.type===_&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=i;null!==u;){if(u.key===c){if((c=s.type)===_){if(7===u.tag){n(r,u.sibling),(i=a(u,s.props.children)).return=r,r=i;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===M&&yi(c)===u.type){n(r,u.sibling),(i=a(u,s.props)).ref=mi(r,u,s),i.return=r,r=i;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===_?((i=Lc(s.props.children,r.mode,l,s.key)).return=r,r=i):((l=Rc(s.type,s.key,s.props,null,r.mode,l)).ref=mi(r,i,s),l.return=r,r=l)}return o(r);case w:e:{for(u=s.key;null!==i;){if(i.key===u){if(4===i.tag&&i.stateNode.containerInfo===s.containerInfo&&i.stateNode.implementation===s.implementation){n(r,i.sibling),(i=a(i,s.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Dc(s,r.mode,l)).return=r,r=i}return o(r);case M:return e(r,i,(u=s._init)(s._payload),l)}if(te(s))return f(r,i,s,l);if(L(s))return m(r,i,s,l);gi(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,s)).return=r,r=i):(n(r,i),(i=Pc(s,r.mode,l)).return=r,r=i),o(r)):n(r,i)}}var bi=vi(!0),xi=vi(!1),wi=Sa(null),_i=null,Si=null,Ci=null;function Ei(){Ci=Si=_i=null}function Ni(e){var t=wi.current;Ca(wi),e._currentValue=t}function Bi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ki(e,t){_i=e,Ci=Si=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vo=!0),e.firstContext=null)}function Ii(e){var t=e._currentValue;if(Ci!==e)if(e={context:e,memoizedValue:t,next:null},null===Si){if(null===_i)throw Error(i(308));Si=e,_i.dependencies={lanes:0,firstContext:e}}else Si=Si.next=e;return t}var Ti=null;function Mi(e){null===Ti?Ti=[e]:Ti.push(e)}function Fi(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Mi(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ri(e,r)}function Ri(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Li=!1;function Ui(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Pi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Bl)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ri(e,n)}return null===(a=r.interleaved)?(t.next=t,Mi(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ri(e,n)}function zi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Hi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=s:i=i.next=s,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ji(e,t,n,r){var a=e.updateQueue;Li=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,o=a.shared.pending;if(null!==o){a.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?i=c:s.next=c,s=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==i){var h=a.baseState;for(s=0,u=c=l=null,o=i;;){var d=o.lane,A=o.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:A,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,f=o;switch(d=t,A=n,f.tag){case 1:if("function"===typeof(p=f.payload)){h=p.call(A,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=f.payload)?p.call(A,h,d):p)||void 0===d)break e;h=P({},h,d);break e;case 2:Li=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[o]:d.push(o))}else A={eventTime:A,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=A,l=h):u=u.next=A,s|=d;if(null===(o=o.next)){if(null===(o=a.shared.pending))break;o=(d=o).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===u&&(l=h),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null!==(t=a.shared.interleaved)){a=t;do{s|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Ul|=s,e.lanes=s,e.memoizedState=h}}function Qi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Vi={},Wi=Sa(Vi),Gi=Sa(Vi),Ki=Sa(Vi);function qi(e){if(e===Vi)throw Error(i(174));return e}function Xi(e,t){switch(Ea(Ki,t),Ea(Gi,e),Ea(Wi,Vi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ca(Wi),Ea(Wi,t)}function Yi(){Ca(Wi),Ca(Gi),Ca(Ki)}function Ji(e){qi(Ki.current);var t=qi(Wi.current),n=le(t,e.type);t!==n&&(Ea(Gi,e),Ea(Wi,n))}function Zi(e){Gi.current===e&&(Ca(Wi),Ca(Gi))}var $i=Sa(0);function es(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ts=[];function ns(){for(var e=0;e<ts.length;e++)ts[e]._workInProgressVersionPrimary=null;ts.length=0}var rs=b.ReactCurrentDispatcher,as=b.ReactCurrentBatchConfig,is=0,ss=null,os=null,ls=null,cs=!1,us=!1,hs=0,ds=0;function As(){throw Error(i(321))}function ps(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function fs(e,t,n,r,a,s){if(is=s,ss=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rs.current=null===e||null===e.memoizedState?Zs:$s,e=n(r,a),us){s=0;do{if(us=!1,hs=0,25<=s)throw Error(i(301));s+=1,ls=os=null,t.updateQueue=null,rs.current=eo,e=n(r,a)}while(us)}if(rs.current=Js,t=null!==os&&null!==os.next,is=0,ls=os=ss=null,cs=!1,t)throw Error(i(300));return e}function ms(){var e=0!==hs;return hs=0,e}function gs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ls?ss.memoizedState=ls=e:ls=ls.next=e,ls}function ys(){if(null===os){var e=ss.alternate;e=null!==e?e.memoizedState:null}else e=os.next;var t=null===ls?ss.memoizedState:ls.next;if(null!==t)ls=t,os=e;else{if(null===e)throw Error(i(310));e={memoizedState:(os=e).memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},null===ls?ss.memoizedState=ls=e:ls=ls.next=e}return ls}function vs(e,t){return"function"===typeof t?t(e):t}function bs(e){var t=ys(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=os,a=r.baseQueue,s=n.pending;if(null!==s){if(null!==a){var o=a.next;a.next=s.next,s.next=o}r.baseQueue=a=s,n.pending=null}if(null!==a){s=a.next,r=r.baseState;var l=o=null,c=null,u=s;do{var h=u.lane;if((is&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,ss.lanes|=h,Ul|=h}u=u.next}while(null!==u&&u!==s);null===c?o=r:c.next=l,or(r,t.memoizedState)||(vo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{s=a.lane,ss.lanes|=s,Ul|=s,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xs(e){var t=ys(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,s=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{s=e(s,o.action),o=o.next}while(o!==a);or(s,t.memoizedState)||(vo=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function ws(){}function _s(e,t){var n=ss,r=ys(),a=t(),s=!or(r.memoizedState,a);if(s&&(r.memoizedState=a,vo=!0),r=r.queue,Ls(Es.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ls&&1&ls.memoizedState.tag){if(n.flags|=2048,Is(9,Cs.bind(null,n,r,a,t),void 0,null),null===kl)throw Error(i(349));0!==(30&is)||Ss(n,t,a)}return a}function Ss(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Cs(e,t,n,r){t.value=n,t.getSnapshot=r,Ns(t)&&Bs(e)}function Es(e,t,n){return n(function(){Ns(t)&&Bs(e)})}function Ns(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Bs(e){var t=Ri(e,1);null!==t&&nc(t,e,1,-1)}function ks(e){var t=gs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},t.queue=e,e=e.dispatch=Ks.bind(null,ss,e),[t.memoizedState,e]}function Is(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ts(){return ys().memoizedState}function Ms(e,t,n,r){var a=gs();ss.flags|=e,a.memoizedState=Is(1|t,n,void 0,void 0===r?null:r)}function Fs(e,t,n,r){var a=ys();r=void 0===r?null:r;var i=void 0;if(null!==os){var s=os.memoizedState;if(i=s.destroy,null!==r&&ps(r,s.deps))return void(a.memoizedState=Is(t,n,i,r))}ss.flags|=e,a.memoizedState=Is(1|t,n,i,r)}function Rs(e,t){return Ms(8390656,8,e,t)}function Ls(e,t){return Fs(2048,8,e,t)}function Us(e,t){return Fs(4,2,e,t)}function Ps(e,t){return Fs(4,4,e,t)}function Ds(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Os(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fs(4,4,Ds.bind(null,t,e),n)}function zs(){}function Hs(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function js(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qs(e,t,n){return 0===(21&is)?(e.baseState&&(e.baseState=!1,vo=!0),e.memoizedState=n):(or(n,t)||(n=ft(),ss.lanes|=n,Ul|=n,e.baseState=!0),t)}function Vs(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=as.transition;as.transition={};try{e(!1),t()}finally{vt=n,as.transition=r}}function Ws(){return ys().memoizedState}function Gs(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},qs(e))Xs(t,n);else if(null!==(n=Fi(e,t,n,r))){nc(n,e,r,ec()),Ys(n,t,r)}}function Ks(e,t,n){var r=tc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(qs(e))Xs(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=i(s,n);if(a.hasEagerState=!0,a.eagerState=o,or(o,s)){var l=t.interleaved;return null===l?(a.next=a,Mi(t)):(a.next=l.next,l.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Fi(e,t,a,r))&&(nc(n,e,r,a=ec()),Ys(n,t,r))}}function qs(e){var t=e.alternate;return e===ss||null!==t&&t===ss}function Xs(e,t){us=cs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ys(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Js={readContext:Ii,useCallback:As,useContext:As,useEffect:As,useImperativeHandle:As,useInsertionEffect:As,useLayoutEffect:As,useMemo:As,useReducer:As,useRef:As,useState:As,useDebugValue:As,useDeferredValue:As,useTransition:As,useMutableSource:As,useSyncExternalStore:As,useId:As,unstable_isNewReconciler:!1},Zs={readContext:Ii,useCallback:function(e,t){return gs().memoizedState=[e,void 0===t?null:t],e},useContext:Ii,useEffect:Rs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ms(4194308,4,Ds.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ms(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ms(4,2,e,t)},useMemo:function(e,t){var n=gs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=gs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Gs.bind(null,ss,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},gs().memoizedState=e},useState:ks,useDebugValue:zs,useDeferredValue:function(e){return gs().memoizedState=e},useTransition:function(){var e=ks(!1),t=e[0];return e=Vs.bind(null,e[1]),gs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ss,a=gs();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===kl)throw Error(i(349));0!==(30&is)||Ss(r,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,Rs(Es.bind(null,r,s,e),[e]),r.flags|=2048,Is(9,Cs.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=gs(),t=kl.identifierPrefix;if(ai){var n=Ja;t=":"+t+"R"+(n=(Ya&~(1<<32-st(Ya)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ds++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$s={readContext:Ii,useCallback:Hs,useContext:Ii,useEffect:Ls,useImperativeHandle:Os,useInsertionEffect:Us,useLayoutEffect:Ps,useMemo:js,useReducer:bs,useRef:Ts,useState:function(){return bs(vs)},useDebugValue:zs,useDeferredValue:function(e){return Qs(ys(),os.memoizedState,e)},useTransition:function(){return[bs(vs)[0],ys().memoizedState]},useMutableSource:ws,useSyncExternalStore:_s,useId:Ws,unstable_isNewReconciler:!1},eo={readContext:Ii,useCallback:Hs,useContext:Ii,useEffect:Ls,useImperativeHandle:Os,useInsertionEffect:Us,useLayoutEffect:Ps,useMemo:js,useReducer:xs,useRef:Ts,useState:function(){return xs(vs)},useDebugValue:zs,useDeferredValue:function(e){var t=ys();return null===os?t.memoizedState=e:Qs(t,os.memoizedState,e)},useTransition:function(){return[xs(vs)[0],ys().memoizedState]},useMutableSource:ws,useSyncExternalStore:_s,useId:Ws,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=P({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:P({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Oi(e,i,a))&&(nc(t,e,a,r),zi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Oi(e,i,a))&&(nc(t,e,a,r),zi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Oi(e,a,r))&&(nc(t,e,r,n),zi(t,e,r))}};function ao(e,t,n,r,a,i,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(a,i))}function io(e,t,n){var r=!1,a=Na,i=t.contextType;return"object"===typeof i&&null!==i?i=Ii(i):(a=Ma(t)?Ia:Ba.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ta(e,a):Na),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function so(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Ui(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ii(i):(i=Ma(t)?Ia:Ba.current,a.context=Ta(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(no(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&ro.enqueueReplaceState(a,a.state,null),ji(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=H(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function Ao(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Wl=r),uo(0,t)},n}function po(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){uo(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function go(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Oi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var yo=b.ReactCurrentOwner,vo=!1;function bo(e,t,n,r){t.child=null===e?xi(t,null,n,r):bi(t,e.child,n,r)}function xo(e,t,n,r,a){n=n.render;var i=t.ref;return ki(t,a),r=fs(e,t,n,r,i,a),n=ms(),null===e||vo?(ai&&n&&ei(t),t.flags|=1,bo(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vo(e,t,a))}function wo(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Mc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,_o(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var s=i.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Vo(e,t,a)}return t.flags|=1,(e=Fc(i,r)).ref=t.ref,e.return=t,t.child=e}function _o(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(lr(i,r)&&e.ref===t.ref){if(vo=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Vo(e,t,a);0!==(131072&e.flags)&&(vo=!0)}}return Eo(e,t,n,r,a)}function So(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ea(Fl,Ml),Ml|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ea(Fl,Ml),Ml|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ea(Fl,Ml),Ml|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ea(Fl,Ml),Ml|=r;return bo(e,t,a,n),t.child}function Co(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Eo(e,t,n,r,a){var i=Ma(n)?Ia:Ba.current;return i=Ta(t,i),ki(t,a),n=fs(e,t,n,r,i,a),r=ms(),null===e||vo?(ai&&r&&ei(t),t.flags|=1,bo(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vo(e,t,a))}function No(e,t,n,r,a){if(Ma(n)){var i=!0;Ua(t)}else i=!1;if(ki(t,a),null===t.stateNode)Qo(e,t),io(t,n,r),oo(t,n,r,a),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ii(c):c=Ta(t,c=Ma(n)?Ia:Ba.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==r||l!==c)&&so(t,s,r,c),Li=!1;var d=t.memoizedState;s.state=d,ji(t,r,s,a),l=t.memoizedState,o!==r||d!==l||ka.current||Li?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=Li||ao(t,n,o,r,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Pi(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ii(l):l=Ta(t,l=Ma(n)?Ia:Ba.current);var A=n.getDerivedStateFromProps;(u="function"===typeof A||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==h||d!==l)&&so(t,s,r,l),Li=!1,d=t.memoizedState,s.state=d,ji(t,r,s,a);var p=t.memoizedState;o!==h||d!==p||ka.current||Li?("function"===typeof A&&(no(t,n,A,r),p=t.memoizedState),(c=Li||ao(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Bo(e,t,n,r,i,a)}function Bo(e,t,n,r,a,i){Co(e,t);var s=0!==(128&t.flags);if(!r&&!s)return a&&Pa(t,n,!1),Vo(e,t,i);r=t.stateNode,yo.current=t;var o=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=bi(t,e.child,null,i),t.child=bi(t,null,o,i)):bo(e,t,o,i),t.memoizedState=r.state,a&&Pa(t,n,!0),t.child}function ko(e){var t=e.stateNode;t.pendingContext?Ra(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ra(0,t.context,!1),Xi(e,t.containerInfo)}function Io(e,t,n,r,a){return Ai(),pi(a),t.flags|=256,bo(e,t,n,r),t.child}var To,Mo,Fo,Ro,Lo={dehydrated:null,treeContext:null,retryLane:0};function Uo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Po(e,t,n){var r,a=t.pendingProps,s=$i.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ea($i,1&s),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=a.children,e=a.fallback,o?(a=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&a)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Uc(l,a,0,null),e=Lc(e,a,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Uo(n),t.memoizedState=Lo,e):Do(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,a,s,o){if(n)return 256&t.flags?(t.flags&=-257,Oo(e,t,o,r=co(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=Uc({mode:"visible",children:r.children},a,0,null),(s=Lc(s,a,o,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&bi(t,e.child,null,o),t.child.memoizedState=Uo(o),t.memoizedState=Lo,s);if(0===(1&t.mode))return Oo(e,t,o,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var l=r.dgst;return r=l,Oo(e,t,o,r=co(s=Error(i(419)),r,void 0))}if(l=0!==(o&e.childLanes),vo||l){if(null!==(r=kl)){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|o))?0:a)&&a!==s.retryLane&&(s.retryLane=a,Ri(e,a),nc(r,e,a,-1))}return fc(),Oo(e,t,o,r=co(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Nc.bind(null,e),a._reactRetry=t,null):(e=s.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Ka[qa++]=Ya,Ka[qa++]=Ja,Ka[qa++]=Xa,Ya=e.id,Ja=e.overflow,Xa=t),t=Do(t,r.children),t.flags|=4096,t)}(e,t,l,a,r,s,n);if(o){o=a.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&l)&&t.child!==s?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Fc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?o=Fc(r,o):(o=Lc(o,l,n,null)).flags|=2,o.return=t,a.return=t,a.sibling=o,t.child=a,a=o,o=t.child,l=null===(l=e.child.memoizedState)?Uo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Lo,a}return e=(o=e.child).sibling,a=Fc(o,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Do(e,t){return(t=Uc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Oo(e,t,n,r){return null!==r&&pi(r),bi(t,e.child,null,n),(e=Do(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Bi(e.return,t,n)}function Ho(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function jo(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(bo(e,t,r.children,n),0!==(2&(r=$i.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,n,t);else if(19===e.tag)zo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ea($i,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===es(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Ho(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===es(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Ho(t,!0,n,null,i);break;case"together":Ho(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ul|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Fc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Go(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ko(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Go(t),null;case 1:case 17:return Ma(t.type)&&Fa(),Go(t),null;case 3:return r=t.stateNode,Yi(),Ca(ka),Ca(Ba),ns(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(sc(ii),ii=null))),Mo(e,t),Go(t),null;case 5:Zi(t);var a=qi(Ki.current);if(n=t.type,null!==e&&null!=t.stateNode)Fo(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Go(t),null}if(e=qi(Wi.current),hi(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[da]=t,r[Aa]=s,e=0!==(1&t.mode),n){case"dialog":Or("cancel",r),Or("close",r);break;case"iframe":case"object":case"embed":Or("load",r);break;case"video":case"audio":for(a=0;a<Lr.length;a++)Or(Lr[a],r);break;case"source":Or("error",r);break;case"img":case"image":case"link":Or("error",r),Or("load",r);break;case"details":Or("toggle",r);break;case"input":Y(r,s),Or("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Or("invalid",r);break;case"textarea":ae(r,s),Or("invalid",r)}for(var l in ye(n,s),a=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),a=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Or("scroll",r)}switch(n){case"input":G(r),$(r,s,!0);break;case"textarea":G(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[da]=t,e[Aa]=r,To(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,r),n){case"dialog":Or("cancel",e),Or("close",e),a=r;break;case"iframe":case"object":case"embed":Or("load",e),a=r;break;case"video":case"audio":for(a=0;a<Lr.length;a++)Or(Lr[a],e);a=r;break;case"source":Or("error",e),a=r;break;case"img":case"image":case"link":Or("error",e),Or("load",e),a=r;break;case"details":Or("toggle",e),a=r;break;case"input":Y(e,r),a=X(e,r),Or("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=P({},r,{value:void 0}),Or("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Or("invalid",e)}for(s in ye(n,a),c=a)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?me(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Or("scroll",e):null!=u&&v(e,s,u,l))}switch(n){case"input":G(e),$(e,r,!1);break;case"textarea":G(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Go(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=qi(Ki.current),qi(Wi.current),hi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(s=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return Go(t),null;case 13:if(Ca($i),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),Ai(),t.flags|=98560,s=!1;else if(s=hi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(i(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(i(317));s[da]=t}else Ai(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Go(t),s=!1}else null!==ii&&(sc(ii),ii=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$i.current)?0===Rl&&(Rl=3):fc())),null!==t.updateQueue&&(t.flags|=4),Go(t),null);case 4:return Yi(),Mo(e,t),null===e&&jr(t.stateNode.containerInfo),Go(t),null;case 10:return Ni(t.type._context),Go(t),null;case 19:if(Ca($i),null===(s=t.memoizedState))return Go(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)Wo(s,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=es(e))){for(t.flags|=128,Wo(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ea($i,1&$i.current|2),t.child}e=e.sibling}null!==s.tail&&Je()>jl&&(t.flags|=128,r=!0,Wo(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=es(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ai)return Go(t),null}else 2*Je()-s.renderingStartTime>jl&&1073741824!==n&&(t.flags|=128,r=!0,Wo(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Je(),t.sibling=null,n=$i.current,Ea($i,r?1&n|2:1&n),t):(Go(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ml)&&(Go(t),6&t.subtreeFlags&&(t.flags|=8192)):Go(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function qo(e,t){switch(ti(t),t.tag){case 1:return Ma(t.type)&&Fa(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yi(),Ca(ka),Ca(Ba),ns(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zi(t),null;case 13:if(Ca($i),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));Ai()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ca($i),null;case 4:return Yi(),null;case 10:return Ni(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}To=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Mo=function(){},Fo=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,qi(Wi.current);var i,s=null;switch(n){case"input":a=X(e,a),r=X(e,r),s=[];break;case"select":a=P({},a,{value:void 0}),r=P({},r,{value:void 0}),s=[];break;case"textarea":a=re(e,a),r=re(e,r),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(u in ye(n,r),n=null,a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u){var l=a[u];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=a?a[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Or("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ro=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xo=!1,Yo=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Zo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Sc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&el(t,n,i)}a=a.next}while(a!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[Aa],delete t[fa],delete t[ma],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,hl=!1;function dl(e,t,n){for(n=n.child;null!==n;)Al(e,t,n),n=n.sibling}function Al(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(o){}switch(n.tag){case 5:Yo||$o(n,t);case 6:var r=ul,a=hl;ul=null,dl(e,t,n),hl=a,null!==(ul=r)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?la(e.parentNode,n):1===e.nodeType&&la(e,n),jt(e)):la(ul,n.stateNode));break;case 4:r=ul,a=hl,ul=n.stateNode.containerInfo,hl=!0,dl(e,t,n),ul=r,hl=a;break;case 0:case 11:case 14:case 15:if(!Yo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,void 0!==s&&(0!==(2&i)||0!==(4&i))&&el(n,t,s),a=a.next}while(a!==r)}dl(e,t,n);break;case 1:if(!Yo&&($o(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Sc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Yo=(r=Yo)||null!==n.memoizedState,dl(e,t,n),Yo=r):dl(e,t,n);break;default:dl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Jo),t.forEach(function(t){var r=Bc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function fl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(i(160));Al(s,o,a),ul=null,hl=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(u){Sc(a,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),gl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(m){Sc(e,e.return,m)}try{nl(5,e,e.return)}catch(m){Sc(e,e.return,m)}}break;case 1:fl(t,e),gl(e),512&r&&null!==n&&$o(n,n.return);break;case 5:if(fl(t,e),gl(e),512&r&&null!==n&&$o(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(m){Sc(e,e.return,m)}}if(4&r&&null!=(a=e.stateNode)){var s=e.memoizedProps,o=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&J(a,s),ve(l,o);var u=ve(l,s);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?me(a,d):"dangerouslySetInnerHTML"===h?he(a,d):"children"===h?de(a,d):v(a,h,d,u)}switch(l){case"input":Z(a,s);break;case"textarea":ie(a,s);break;case"select":var A=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(a,!!s.multiple,p,!1):A!==!!s.multiple&&(null!=s.defaultValue?ne(a,!!s.multiple,s.defaultValue,!0):ne(a,!!s.multiple,s.multiple?[]:"",!1))}a[Aa]=s}catch(m){Sc(e,e.return,m)}}break;case 6:if(fl(t,e),gl(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,s=e.memoizedProps;try{a.nodeValue=s}catch(m){Sc(e,e.return,m)}}break;case 3:if(fl(t,e),gl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(m){Sc(e,e.return,m)}break;case 4:default:fl(t,e),gl(e);break;case 13:fl(t,e),gl(e),8192&(a=e.child).flags&&(s=null!==a.memoizedState,a.stateNode.isHidden=s,!s||null!==a.alternate&&null!==a.alternate.memoizedState||(Hl=Je())),4&r&&pl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Yo=(u=Yo)||h,fl(t,e),Yo=u):fl(t,e),gl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Zo=e,h=e.child;null!==h;){for(d=Zo=h;null!==Zo;){switch(p=(A=Zo).child,A.tag){case 0:case 11:case 14:case 15:nl(4,A,A.return);break;case 1:$o(A,A.return);var f=A.stateNode;if("function"===typeof f.componentWillUnmount){r=A,n=A.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(m){Sc(r,n,m)}}break;case 5:$o(A,A.return);break;case 22:if(null!==A.memoizedState){xl(d);continue}}null!==p?(p.return=A,Zo=p):xl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{a=d.stateNode,u?"function"===typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",o))}catch(m){Sc(e,e.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Sc(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:fl(t,e),gl(e),4&r&&pl(e);case 21:}}function gl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),cl(e,ol(e),a);break;case 3:case 4:var s=r.stateNode.containerInfo;ll(e,ol(e),s);break;default:throw Error(i(161))}}catch(o){Sc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Zo=e,vl(e,t,n)}function vl(e,t,n){for(var r=0!==(1&e.mode);null!==Zo;){var a=Zo,i=a.child;if(22===a.tag&&r){var s=null!==a.memoizedState||Xo;if(!s){var o=a.alternate,l=null!==o&&null!==o.memoizedState||Yo;o=Xo;var c=Yo;if(Xo=s,(Yo=l)&&!c)for(Zo=a;null!==Zo;)l=(s=Zo).child,22===s.tag&&null!==s.memoizedState?wl(a):null!==l?(l.return=s,Zo=l):wl(a);for(;null!==i;)Zo=i,vl(i,t,n),i=i.sibling;Zo=a,Xo=o,Yo=c}bl(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Zo=i):bl(e)}}function bl(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Yo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Yo)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Qi(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Qi(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&jt(d)}}}break;default:throw Error(i(163))}Yo||512&t.flags&&al(t)}catch(A){Sc(t,t.return,A)}}if(t===e){Zo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zo=n;break}Zo=t.return}}function xl(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zo=n;break}Zo=t.return}}function wl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Sc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(l){Sc(t,a,l)}}var i=t.return;try{al(t)}catch(l){Sc(t,i,l)}break;case 5:var s=t.return;try{al(t)}catch(l){Sc(t,s,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var _l,Sl=Math.ceil,Cl=b.ReactCurrentDispatcher,El=b.ReactCurrentOwner,Nl=b.ReactCurrentBatchConfig,Bl=0,kl=null,Il=null,Tl=0,Ml=0,Fl=Sa(0),Rl=0,Ll=null,Ul=0,Pl=0,Dl=0,Ol=null,zl=null,Hl=0,jl=1/0,Ql=null,Vl=!1,Wl=null,Gl=null,Kl=!1,ql=null,Xl=0,Yl=0,Jl=null,Zl=-1,$l=0;function ec(){return 0!==(6&Bl)?Je():-1!==Zl?Zl:Zl=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Bl)&&0!==Tl?Tl&-Tl:null!==fi.transition?(0===$l&&($l=ft()),$l):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,n,r){if(50<Yl)throw Yl=0,Jl=null,Error(i(185));gt(e,n,r),0!==(2&Bl)&&e===kl||(e===kl&&(0===(2&Bl)&&(Pl|=n),4===Rl&&oc(e,Tl)),rc(e,r),1===n&&0===Bl&&0===(1&t.mode)&&(jl=Je()+500,Oa&&ja()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-st(i),o=1<<s,l=a[s];-1===l?0!==(o&n)&&0===(o&r)||(a[s]=At(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var r=dt(e,e===kl?Tl:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Oa=!0,Ha(e)}(lc.bind(null,e)):Ha(lc.bind(null,e)),sa(function(){0===(6&Bl)&&ja()}),n=null;else{switch(bt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=kc(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Zl=-1,$l=0,0!==(6&Bl))throw Error(i(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=dt(e,e===kl?Tl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var a=Bl;Bl|=2;var s=pc();for(kl===e&&Tl===t||(Ql=null,jl=Je()+500,dc(e,t));;)try{yc();break}catch(l){Ac(e,l)}Ei(),Cl.current=s,Bl=a,null!==Il?t=0:(kl=null,Tl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=ic(e,a))),1===t)throw n=Ll,dc(e,0),oc(e,r),rc(e,Je()),n;if(6===t)oc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!or(i(),a))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=mc(e,r))&&(0!==(s=pt(e))&&(r=s,t=ic(e,s))),1===t))throw n=Ll,dc(e,0),oc(e,r),rc(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:xc(e,zl,Ql);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Hl+500-Je())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(xc.bind(null,e,zl,Ql),t);break}xc(e,zl,Ql);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-st(r);s=1<<o,(o=t[o])>a&&(a=o),r&=~s}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sl(r/1960))-r)){e.timeoutHandle=ra(xc.bind(null,e,zl,Ql),r);break}xc(e,zl,Ql);break;default:throw Error(i(329))}}}return rc(e,Je()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Ol;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=zl,zl=n,null!==t&&sc(t)),e}function sc(e){null===zl?zl=e:zl.push.apply(zl,e)}function oc(e,t){for(t&=~Dl,t&=~Pl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Bl))throw Error(i(327));wc();var t=dt(e,0);if(0===(1&t))return rc(e,Je()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ll,dc(e,0),oc(e,t),rc(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zl,Ql),rc(e,Je()),null}function cc(e,t){var n=Bl;Bl|=1;try{return e(t)}finally{0===(Bl=n)&&(jl=Je()+500,Oa&&ja())}}function uc(e){null!==ql&&0===ql.tag&&0===(6&Bl)&&wc();var t=Bl;Bl|=1;var n=Nl.transition,r=vt;try{if(Nl.transition=null,vt=1,e)return e()}finally{vt=r,Nl.transition=n,0===(6&(Bl=t))&&ja()}}function hc(){Ml=Fl.current,Ca(Fl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Il)for(n=Il.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Fa();break;case 3:Yi(),Ca(ka),Ca(Ba),ns();break;case 5:Zi(r);break;case 4:Yi();break;case 13:case 19:Ca($i);break;case 10:Ni(r.type._context);break;case 22:case 23:hc()}n=n.return}if(kl=e,Il=e=Fc(e.current,null),Tl=Ml=t,Rl=0,Ll=null,Dl=Pl=Ul=0,zl=Ol=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(r=(n=Ti[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var s=i.next;i.next=a,r.next=s}n.pending=r}Ti=null}return e}function Ac(e,t){for(;;){var n=Il;try{if(Ei(),rs.current=Js,cs){for(var r=ss.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}cs=!1}if(is=0,ls=os=ss=null,us=!1,hs=0,El.current=null,null===n||null===n.return){Rl=1,Ll=t,Il=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Tl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var A=h.alternate;A?(h.updateQueue=A.updateQueue,h.memoizedState=A.memoizedState,h.lanes=A.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=mo(o);if(null!==p){p.flags&=-257,go(p,o,l,0,t),1&p.mode&&fo(s,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var m=new Set;m.add(c),t.updateQueue=m}else f.add(c);break e}if(0===(1&t)){fo(s,u,t),fc();break e}c=Error(i(426))}else if(ai&&1&l.mode){var g=mo(o);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),go(g,o,l,0,t),pi(lo(c,l));break e}}s=c=lo(c,l),4!==Rl&&(Rl=2),null===Ol?Ol=[s]:Ol.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Hi(s,Ao(0,c,t));break e;case 1:l=c;var y=s.type,v=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Gl||!Gl.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,Hi(s,po(s,l,t));break e}}s=s.return}while(null!==s)}bc(n)}catch(b){t=b,Il===n&&null!==n&&(Il=n=n.return);continue}break}}function pc(){var e=Cl.current;return Cl.current=Js,null===e?Js:e}function fc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===kl||0===(268435455&Ul)&&0===(268435455&Pl)||oc(kl,Tl)}function mc(e,t){var n=Bl;Bl|=2;var r=pc();for(kl===e&&Tl===t||(Ql=null,dc(e,t));;)try{gc();break}catch(a){Ac(e,a)}if(Ei(),Bl=n,Cl.current=r,null!==Il)throw Error(i(261));return kl=null,Tl=0,Rl}function gc(){for(;null!==Il;)vc(Il)}function yc(){for(;null!==Il&&!Xe();)vc(Il)}function vc(e){var t=_l(e.alternate,e,Ml);e.memoizedProps=e.pendingProps,null===t?bc(e):Il=t,El.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ko(n,t,Ml)))return void(Il=n)}else{if(null!==(n=qo(n,t)))return n.flags&=32767,void(Il=n);if(null===e)return Rl=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Rl&&(Rl=5)}function xc(e,t,n){var r=vt,a=Nl.transition;try{Nl.transition=null,vt=1,function(e,t,n,r){do{wc()}while(null!==ql);if(0!==(6&Bl))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-st(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,s),e===kl&&(Il=kl=null,Tl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kl||(Kl=!0,kc(tt,function(){return wc(),null})),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Nl.transition,Nl.transition=null;var o=vt;vt=1;var l=Bl;Bl|=4,El.current=null,function(e,t){if(ea=Vt,Ar(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(x){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,A=null;t:for(;;){for(var p;d!==n||0!==a&&3!==d.nodeType||(l=o+a),d!==s||0!==r&&3!==d.nodeType||(c=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)A=d,d=p;for(;;){if(d===e)break t;if(A===n&&++u===a&&(l=o),A===s&&++h===r&&(c=o),null!==(p=d.nextSibling))break;A=(d=A).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Vt=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var m=f.memoizedProps,g=f.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:to(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(i(163))}}catch(x){Sc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}f=tl,tl=!1}(e,n),ml(n,e),pr(ta),Vt=!!ea,ta=ea=null,e.current=n,yl(n,e,a),Ye(),Bl=l,vt=o,Nl.transition=s}else e.current=n;if(Kl&&(Kl=!1,ql=e,Xl=a),s=e.pendingLanes,0===s&&(Gl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Vl)throw Vl=!1,e=Wl,Wl=null,e;0!==(1&Xl)&&0!==e.tag&&wc(),s=e.pendingLanes,0!==(1&s)?e===Jl?Yl++:(Yl=0,Jl=e):Yl=0,ja()}(e,t,n,r)}finally{Nl.transition=a,vt=r}return null}function wc(){if(null!==ql){var e=bt(Xl),t=Nl.transition,n=vt;try{if(Nl.transition=null,vt=16>e?16:e,null===ql)var r=!1;else{if(e=ql,ql=null,Xl=0,0!==(6&Bl))throw Error(i(331));var a=Bl;for(Bl|=4,Zo=e.current;null!==Zo;){var s=Zo,o=s.child;if(0!==(16&Zo.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zo=u;null!==Zo;){var h=Zo;switch(h.tag){case 0:case 11:case 15:nl(8,h,s)}var d=h.child;if(null!==d)d.return=h,Zo=d;else for(;null!==Zo;){var A=(h=Zo).sibling,p=h.return;if(il(h),h===u){Zo=null;break}if(null!==A){A.return=p,Zo=A;break}Zo=p}}}var f=s.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Zo=s}}if(0!==(2064&s.subtreeFlags)&&null!==o)o.return=s,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(s=Zo).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Zo=y;break e}Zo=s.return}}var v=e.current;for(Zo=v;null!==Zo;){var b=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,Zo=b;else e:for(o=v;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Sc(l,l.return,w)}if(l===o){Zo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Zo=x;break e}Zo=l.return}}if(Bl=a,ja(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(w){}r=!0}return r}finally{vt=n,Nl.transition=t}}return!1}function _c(e,t,n){e=Oi(e,t=Ao(0,t=lo(n,t),1),1),t=ec(),null!==e&&(gt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gl||!Gl.has(r))){t=Oi(t,e=po(t,e=lo(n,e),1),1),e=ec(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,kl===e&&(Tl&n)===n&&(4===Rl||3===Rl&&(130023424&Tl)===Tl&&500>Je()-Hl?dc(e,0):Dl|=n),rc(e,t)}function Ec(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Ri(e,t))&&(gt(e,t,n),rc(e,n))}function Nc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ec(e,n)}function Bc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ec(e,n)}function kc(e,t){return Ke(e,t)}function Ic(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tc(e,t,n,r){return new Ic(e,t,n,r)}function Mc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fc(e,t){var n=e.alternate;return null===n?((n=Tc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,r,a,s){var o=2;if(r=e,"function"===typeof e)Mc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case _:return Lc(n.children,a,s,t);case S:o=8,a|=8;break;case C:return(e=Tc(12,n,t,2|a)).elementType=C,e.lanes=s,e;case k:return(e=Tc(13,n,t,a)).elementType=k,e.lanes=s,e;case I:return(e=Tc(19,n,t,a)).elementType=I,e.lanes=s,e;case F:return Uc(n,a,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case N:o=9;break e;case B:o=11;break e;case T:o=14;break e;case M:o=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Tc(o,n,t,a)).elementType=e,t.type=r,t.lanes=s,t}function Lc(e,t,n,r){return(e=Tc(7,e,r,t)).lanes=n,e}function Uc(e,t,n,r){return(e=Tc(22,e,r,t)).elementType=F,e.lanes=n,e.stateNode={isHidden:!1},e}function Pc(e,t,n){return(e=Tc(6,e,null,t)).lanes=n,e}function Dc(e,t,n){return(t=Tc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Oc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,r,a,i,s,o,l){return e=new Oc(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Tc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ui(i),e}function Hc(e){if(!e)return Na;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ma(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Ma(n))return La(e,n,t)}return t}function jc(e,t,n,r,a,i,s,o,l){return(e=zc(n,r,!0,e,0,i,0,o,l)).context=Hc(null),n=e.current,(i=Di(r=ec(),a=tc(n))).callback=void 0!==t&&null!==t?t:null,Oi(n,i,a),e.current.lanes=a,gt(e,a,r),rc(e,r),e}function Qc(e,t,n,r){var a=t.current,i=ec(),s=tc(a);return n=Hc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oi(a,t,s))&&(nc(e,a,s,i),zi(e,a,s)),s}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}_l=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ka.current)vo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return vo=!1,function(e,t,n){switch(t.tag){case 3:ko(t),Ai();break;case 5:Ji(t);break;case 1:Ma(t.type)&&Ua(t);break;case 4:Xi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ea(wi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ea($i,1&$i.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Po(e,t,n):(Ea($i,1&$i.current),null!==(e=Vo(e,t,n))?e.sibling:null);Ea($i,1&$i.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return jo(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ea($i,$i.current),r)break;return null;case 22:case 23:return t.lanes=0,So(e,t,n)}return Vo(e,t,n)}(e,t,n);vo=0!==(131072&e.flags)}else vo=!1,ai&&0!==(1048576&t.flags)&&$a(t,Ga,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Qo(e,t),e=t.pendingProps;var a=Ta(t,Ba.current);ki(t,n),a=fs(null,t,r,e,a,n);var s=ms();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ma(r)?(s=!0,Ua(t)):s=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ui(t),a.updater=ro,t.stateNode=a,a._reactInternals=t,oo(t,r,e,n),t=Bo(null,t,r,!0,s,n)):(t.tag=0,ai&&s&&ei(t),bo(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Qo(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Mc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===B)return 11;if(e===T)return 14}return 2}(r),e=to(r,e),a){case 0:t=Eo(null,t,r,e,n);break e;case 1:t=No(null,t,r,e,n);break e;case 11:t=xo(null,t,r,e,n);break e;case 14:t=wo(null,t,r,to(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Eo(e,t,r,a=t.elementType===r?a:to(r,a),n);case 1:return r=t.type,a=t.pendingProps,No(e,t,r,a=t.elementType===r?a:to(r,a),n);case 3:e:{if(ko(t),null===e)throw Error(i(387));r=t.pendingProps,a=(s=t.memoizedState).element,Pi(e,t),ji(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Io(e,t,r,n,a=lo(Error(i(423)),t));break e}if(r!==a){t=Io(e,t,r,n,a=lo(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=xi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Ai(),r===a){t=Vo(e,t,n);break e}bo(e,t,r,n)}t=t.child}return t;case 5:return Ji(t),null===e&&ci(t),r=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,o=a.children,na(r,a)?o=null:null!==s&&na(r,s)&&(t.flags|=32),Co(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Po(e,t,n);case 4:return Xi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=bi(t,null,r,n):bo(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,xo(e,t,r,a=t.elementType===r?a:to(r,a),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,s=t.memoizedProps,o=a.value,Ea(wi,r._currentValue),r._currentValue=o,null!==s)if(or(s.value,o)){if(s.children===a.children&&!ka.current){t=Vo(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Di(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Bi(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Bi(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}bo(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,ki(t,n),r=r(a=Ii(a)),t.flags|=1,bo(e,t,r,n),t.child;case 14:return a=to(r=t.type,t.pendingProps),wo(e,t,r,a=to(r.type,a),n);case 15:return _o(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:to(r,a),Qo(e,t),t.tag=1,Ma(r)?(e=!0,Ua(t)):e=!1,ki(t,n),io(t,r,a),oo(t,r,a,n),Bo(null,t,r,!0,e,n);case 19:return jo(e,t,n);case 22:return So(e,t,n)}throw Error(i(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function qc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function $c(e,t,n,r,a){var i=n._reactRootContainer;if(i){var s=i;if("function"===typeof a){var o=a;a=function(){var e=Vc(s);o.call(e)}}Qc(t,s,e,a)}else s=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Vc(s);i.call(e)}}var s=jc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[pa]=s.current,jr(8===e.nodeType?e.parentNode:e),uc(),s}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[pa]=l.current,jr(8===e.nodeType?e.parentNode:e),uc(function(){Qc(t,l,n,r)}),l}(n,t,e,a,r);return Vc(s)}Xc.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Qc(e,t,null,null)},Xc.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Qc(null,e,null,null)}),t[pa]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ft.length&&0!==t&&t<Ft[n].priority;n++);Ft.splice(n,0,e),0===n&&Pt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Je()),0===(6&Bl)&&(jl=Je()+500,ja()))}break;case 13:uc(function(){var t=Ri(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Gc(e,1)}},wt=function(e){if(13===e.tag){var t=Ri(e,134217728);if(null!==t)nc(t,e,134217728,ec());Gc(e,134217728)}},_t=function(e){if(13===e.tag){var t=tc(e),n=Ri(e,t);if(null!==n)nc(n,e,t,ec());Gc(e,t)}},St=function(){return vt},Ct=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=xa(r);if(!a)throw Error(i(90));K(r),Z(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Be=cc,ke=uc;var eu={usingClientEntryPoint:!1,Events:[va,ba,xa,Ee,Ne,cc]},tu={findFiberByHostInstance:ya,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{at=ru.inject(nu),it=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(i(299));var n=!1,r="",a=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,jr(8===e.nodeType?e.parentNode:e),new qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(i(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,s="",o=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,a,0,s,o),e[pa]=t.current,jr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Xc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(i(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(i(40));return!!e._reactRootContainer&&(uc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[pa]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return $c(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),A=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var b=v.prototype=new y;b.constructor=v,f(b,g.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,_={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var a,i={},s=null,o=null;if(null!=t)for(a in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,a)&&!S.hasOwnProperty(a)&&(i[a]=t[a]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===i[a]&&(i[a]=l[a]);return{$$typeof:n,type:e,key:s,ref:o,props:i,_owner:_.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var N=/\/+/g;function B(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function k(e,t,a,i,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===i?"."+B(l,0):i,x(s)?(a="",null!=e&&(a=e.replace(N,"$&/")+"/"),k(s,t,a,"",function(e){return e})):null!=s&&(E(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,a+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(N,"$&/")+"/")+e)),t.push(s)),1;if(l=0,i=""===i?".":i+":",x(e))for(var c=0;c<e.length;c++){var u=i+B(o=e[c],c);l+=k(o,t,a,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=A&&e[A]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=k(o=o.value,t,a,u=i+B(o,c++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var r=[],a=0;return k(e,r,"","",function(e){return t.call(n,e,a++)}),r}function T(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M={current:null},F={transition:null},R={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:F,ReactCurrentOwner:_};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=s,t.PureComponent=v,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=f({},e.props),i=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=_.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!S.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}return{$$typeof:n,type:e.type,key:i,ref:s,props:a,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:T}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=F.transition;F.transition={};try{e()}finally{F.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return M.current.useCallback(e,t)},t.useContext=function(e){return M.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return M.current.useDeferredValue(e)},t.useEffect=function(e,t){return M.current.useEffect(e,t)},t.useId=function(){return M.current.useId()},t.useImperativeHandle=function(e,t,n){return M.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return M.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return M.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return M.current.useMemo(e,t)},t.useReducer=function(e,t,n){return M.current.useReducer(e,t,n)},t.useRef=function(e){return M.current.useRef(e)},t.useState=function(e){return M.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return M.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return M.current.useTransition()},t.version="18.3.1"},4334:(e,t,n)=>{var r=n(7359),a=n(7066),i=n(9016),s=n(9538),o=n(6288),l=n(5262),c=n(2430);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=s,c.xor4096=o,c.tychei=l,e.exports=c},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4530:()=>{},4980:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(2284);function a(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=(0,r.A)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}function i(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5239:function(e){e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},n.apply(this,arguments)};function r(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function s(e){try{l(r.next(e))}catch(Pt){i(Pt)}}function o(e){try{l(r.throw(e))}catch(Pt){i(Pt)}}function l(e){e.done?n(e.value):a(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())})}function a(e,t){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(e){return function(t){return l([e,t])}}function l(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(Pt){i=[6,Pt],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}function i(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||t)}for(var s=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,a){return new e(this.left+t,this.top+n,this.width+r,this.height+a)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=Array.from(n).find(function(e){return 0!==e.width});return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),o=function(e,t){return s.fromClientRect(e,t.getBoundingClientRect())},l=function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),a=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new s(0,0,r,a)},c=function(e){for(var t=[],n=0,r=e.length;n<r;){var a=e.charCodeAt(n++);if(a>=55296&&a<=56319&&n<r){var i=e.charCodeAt(n++);56320===(64512&i)?t.push(((1023&a)<<10)+(1023&i)+65536):(t.push(a),n--)}else t.push(a)}return t},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],a=-1,i="";++a<n;){var s=e[a];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(a+1===n||r.length>16384)&&(i+=String.fromCharCode.apply(String,r),r.length=0)}return i},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"===typeof Uint8Array?[]:new Uint8Array(256),A=0;A<h.length;A++)d[h.charCodeAt(A)]=A;for(var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="undefined"===typeof Uint8Array?[]:new Uint8Array(256),m=0;m<p.length;m++)f[p.charCodeAt(m)]=m;for(var g=function(e){var t,n,r,a,i,s=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=f[e.charCodeAt(t)],r=f[e.charCodeAt(t+1)],a=f[e.charCodeAt(t+2)],i=f[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&i;return c},y=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},v=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},b=5,x=11,w=2,_=65536>>b,S=(1<<b)-1,C=_+(1024>>b)+32,E=65536>>x,N=(1<<x-b)-1,B=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},k=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},I=function(e,t){var n=g(e),r=Array.isArray(n)?v(n):new Uint32Array(n),a=Array.isArray(n)?y(n):new Uint16Array(n),i=24,s=B(a,i/2,r[4]/2),o=2===r[5]?B(a,(i+r[4])/2):k(r,Math.ceil((i+r[4])/4));return new T(r[0],r[1],r[2],r[3],s,o)},T=function(){function e(e,t,n,r,a,i){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=a,this.data=i}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>b])<<w)+(e&S),this.data[t];if(e<=65535)return t=((t=this.index[_+(e-55296>>b)])<<w)+(e&S),this.data[t];if(e<this.highStart)return t=C-E+(e>>x),t=this.index[t],t+=e>>b&N,t=((t=this.index[t])<<w)+(e&S),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F="undefined"===typeof Uint8Array?[]:new Uint8Array(256),R=0;R<M.length;R++)F[M.charCodeAt(R)]=R;var L=50,U=1,P=2,D=3,O=4,z=5,H=7,j=8,Q=9,V=10,W=11,G=12,K=13,q=14,X=15,Y=16,J=17,Z=18,$=19,ee=20,te=21,ne=22,re=23,ae=24,ie=25,se=26,oe=27,le=28,ce=29,ue=30,he=31,de=32,Ae=33,pe=34,fe=35,me=36,ge=37,ye=38,ve=39,be=40,xe=41,we=42,_e=43,Se=[9001,65288],Ce="!",Ee="\xd7",Ne="\xf7",Be=I("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),ke=[ue,me],Ie=[U,P,D,z],Te=[V,j],Me=[oe,se],Fe=Ie.concat(Te),Re=[ye,ve,be,pe,fe],Le=[X,K],Ue=function(e,t){void 0===t&&(t="strict");var n=[],r=[],a=[];return e.forEach(function(e,i){var s=Be.get(e);if(s>L?(a.push(!0),s-=L):a.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(i),n.push(Y);if(s===O||s===W){if(0===i)return r.push(i),n.push(ue);var o=n[i-1];return-1===Fe.indexOf(o)?(r.push(r[i-1]),n.push(o)):(r.push(i),n.push(ue))}return r.push(i),s===he?n.push("strict"===t?te:ge):s===we||s===ce?n.push(ue):s===_e?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(ge):n.push(ue):void n.push(s)}),[r,n,a]},Pe=function(e,t,n,r){var a=r[n];if(Array.isArray(e)?-1!==e.indexOf(a):e===a)for(var i=n;i<=r.length;){if((l=r[++i])===t)return!0;if(l!==V)break}if(a===V)for(i=n;i>0;){var s=r[--i];if(Array.isArray(e)?-1!==e.indexOf(s):e===s)for(var o=n;o<=r.length;){var l;if((l=r[++o])===t)return!0;if(l!==V)break}if(s!==V)break}return!1},De=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==V)return r;n--}return 0},Oe=function(e,t,n,r,a){if(0===n[r])return Ee;var i=r-1;if(Array.isArray(a)&&!0===a[i])return Ee;var s=i-1,o=i+1,l=t[i],c=s>=0?t[s]:0,u=t[o];if(l===P&&u===D)return Ee;if(-1!==Ie.indexOf(l))return Ce;if(-1!==Ie.indexOf(u))return Ee;if(-1!==Te.indexOf(u))return Ee;if(De(i,t)===j)return Ne;if(Be.get(e[i])===W)return Ee;if((l===de||l===Ae)&&Be.get(e[o])===W)return Ee;if(l===H||u===H)return Ee;if(l===Q)return Ee;if(-1===[V,K,X].indexOf(l)&&u===Q)return Ee;if(-1!==[J,Z,$,ae,le].indexOf(u))return Ee;if(De(i,t)===ne)return Ee;if(Pe(re,ne,i,t))return Ee;if(Pe([J,Z],te,i,t))return Ee;if(Pe(G,G,i,t))return Ee;if(l===V)return Ne;if(l===re||u===re)return Ee;if(u===Y||l===Y)return Ne;if(-1!==[K,X,te].indexOf(u)||l===q)return Ee;if(c===me&&-1!==Le.indexOf(l))return Ee;if(l===le&&u===me)return Ee;if(u===ee)return Ee;if(-1!==ke.indexOf(u)&&l===ie||-1!==ke.indexOf(l)&&u===ie)return Ee;if(l===oe&&-1!==[ge,de,Ae].indexOf(u)||-1!==[ge,de,Ae].indexOf(l)&&u===se)return Ee;if(-1!==ke.indexOf(l)&&-1!==Me.indexOf(u)||-1!==Me.indexOf(l)&&-1!==ke.indexOf(u))return Ee;if(-1!==[oe,se].indexOf(l)&&(u===ie||-1!==[ne,X].indexOf(u)&&t[o+1]===ie)||-1!==[ne,X].indexOf(l)&&u===ie||l===ie&&-1!==[ie,le,ae].indexOf(u))return Ee;if(-1!==[ie,le,ae,J,Z].indexOf(u))for(var h=i;h>=0;){if((d=t[h])===ie)return Ee;if(-1===[le,ae].indexOf(d))break;h--}if(-1!==[oe,se].indexOf(u))for(h=-1!==[J,Z].indexOf(l)?s:i;h>=0;){var d;if((d=t[h])===ie)return Ee;if(-1===[le,ae].indexOf(d))break;h--}if(ye===l&&-1!==[ye,ve,pe,fe].indexOf(u)||-1!==[ve,pe].indexOf(l)&&-1!==[ve,be].indexOf(u)||-1!==[be,fe].indexOf(l)&&u===be)return Ee;if(-1!==Re.indexOf(l)&&-1!==[ee,se].indexOf(u)||-1!==Re.indexOf(u)&&l===oe)return Ee;if(-1!==ke.indexOf(l)&&-1!==ke.indexOf(u))return Ee;if(l===ae&&-1!==ke.indexOf(u))return Ee;if(-1!==ke.concat(ie).indexOf(l)&&u===ne&&-1===Se.indexOf(e[o])||-1!==ke.concat(ie).indexOf(u)&&l===Z)return Ee;if(l===xe&&u===xe){for(var A=n[i],p=1;A>0&&t[--A]===xe;)p++;if(p%2!==0)return Ee}return l===de&&u===Ae?Ee:Ne},ze=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=Ue(e,t.lineBreak),r=n[0],a=n[1],i=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(a=a.map(function(e){return-1!==[ie,ue,we].indexOf(e)?ge:e}));var s="keep-all"===t.wordBreak?i.map(function(t,n){return t&&e[n]>=19968&&e[n]<=40959}):void 0;return[r,a,s]},He=function(){function e(e,t,n,r){this.codePoints=e,this.required=t===Ce,this.start=n,this.end=r}return e.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),je=function(e,t){var n=c(e),r=ze(n,t),a=r[0],i=r[1],s=r[2],o=n.length,l=0,u=0;return{next:function(){if(u>=o)return{done:!0,value:null};for(var e=Ee;u<o&&(e=Oe(n,i,a,++u,s))===Ee;);if(e!==Ee||u===o){var t=new He(n,e,l,u);return l=u,{value:t,done:!1}}return{done:!0,value:null}}}},Qe=1,Ve=2,We=4,Ge=8,Ke=10,qe=47,Xe=92,Ye=9,Je=32,Ze=34,$e=61,et=35,tt=36,nt=37,rt=39,at=40,it=41,st=95,ot=45,lt=33,ct=60,ut=62,ht=64,dt=91,At=93,pt=61,ft=123,mt=63,gt=125,yt=124,vt=126,bt=128,xt=65533,wt=42,_t=43,St=44,Ct=58,Et=59,Nt=46,Bt=0,kt=8,It=11,Tt=14,Mt=31,Ft=127,Rt=-1,Lt=48,Ut=97,Pt=101,Dt=102,Ot=117,zt=122,Ht=65,jt=69,Qt=70,Vt=85,Wt=90,Gt=function(e){return e>=Lt&&e<=57},Kt=function(e){return e>=55296&&e<=57343},qt=function(e){return Gt(e)||e>=Ht&&e<=Qt||e>=Ut&&e<=Dt},Xt=function(e){return e>=Ut&&e<=zt},Yt=function(e){return e>=Ht&&e<=Wt},Jt=function(e){return Xt(e)||Yt(e)},Zt=function(e){return e>=bt},$t=function(e){return e===Ke||e===Ye||e===Je},en=function(e){return Jt(e)||Zt(e)||e===st},tn=function(e){return en(e)||Gt(e)||e===ot},nn=function(e){return e>=Bt&&e<=kt||e===It||e>=Tt&&e<=Mt||e===Ft},rn=function(e,t){return e===Xe&&t!==Ke},an=function(e,t,n){return e===ot?en(t)||rn(t,n):!!en(e)||!(e!==Xe||!rn(e,t))},sn=function(e,t,n){return e===_t||e===ot?!!Gt(t)||t===Nt&&Gt(n):Gt(e===Nt?t:e)},on=function(e){var t=0,n=1;e[t]!==_t&&e[t]!==ot||(e[t]===ot&&(n=-1),t++);for(var r=[];Gt(e[t]);)r.push(e[t++]);var a=r.length?parseInt(u.apply(void 0,r),10):0;e[t]===Nt&&t++;for(var i=[];Gt(e[t]);)i.push(e[t++]);var s=i.length,o=s?parseInt(u.apply(void 0,i),10):0;e[t]!==jt&&e[t]!==Pt||t++;var l=1;e[t]!==_t&&e[t]!==ot||(e[t]===ot&&(l=-1),t++);for(var c=[];Gt(e[t]);)c.push(e[t++]);var h=c.length?parseInt(u.apply(void 0,c),10):0;return n*(a+o*Math.pow(10,-s))*Math.pow(10,l*h)},ln={type:2},cn={type:3},un={type:4},hn={type:13},dn={type:8},An={type:21},pn={type:9},fn={type:10},mn={type:11},gn={type:12},yn={type:14},vn={type:23},bn={type:1},xn={type:25},wn={type:24},_n={type:26},Sn={type:27},Cn={type:28},En={type:29},Nn={type:31},Bn={type:32},kn=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Bn;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Ze:return this.consumeStringToken(Ze);case et:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(tn(t)||rn(n,r)){var a=an(t,n,r)?Ve:Qe;return{type:5,value:this.consumeName(),flags:a}}break;case tt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),hn;break;case rt:return this.consumeStringToken(rt);case at:return ln;case it:return cn;case wt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),yn;break;case _t:if(sn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case St:return un;case ot:var i=e,s=this.peekCodePoint(0),o=this.peekCodePoint(1);if(sn(i,s,o))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(an(i,s,o))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(s===ot&&o===ut)return this.consumeCodePoint(),this.consumeCodePoint(),wn;break;case Nt:if(sn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case qe:if(this.peekCodePoint(0)===wt)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===wt&&(l=this.consumeCodePoint())===qe)return this.consumeToken();if(l===Rt)return this.consumeToken()}break;case Ct:return _n;case Et:return Sn;case ct:if(this.peekCodePoint(0)===lt&&this.peekCodePoint(1)===ot&&this.peekCodePoint(2)===ot)return this.consumeCodePoint(),this.consumeCodePoint(),xn;break;case ht:var c=this.peekCodePoint(0),h=this.peekCodePoint(1),d=this.peekCodePoint(2);if(an(c,h,d))return{type:7,value:this.consumeName()};break;case dt:return Cn;case Xe:if(rn(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case At:return En;case pt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),dn;break;case ft:return mn;case gt:return gn;case Ot:case Vt:var A=this.peekCodePoint(0),p=this.peekCodePoint(1);return A!==_t||!qt(p)&&p!==mt||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case yt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),pn;if(this.peekCodePoint(0)===yt)return this.consumeCodePoint(),An;break;case vt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),fn;break;case Rt:return Bn}return $t(e)?(this.consumeWhiteSpace(),Nn):Gt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):en(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:u(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return"undefined"===typeof e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();qt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===mt&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(u.apply(void 0,e.map(function(e){return e===mt?Lt:e})),16),end:parseInt(u.apply(void 0,e.map(function(e){return e===mt?Qt:e})),16)};var r=parseInt(u.apply(void 0,e),16);if(this.peekCodePoint(0)===ot&&qt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var a=[];qt(t)&&a.length<6;)a.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(u.apply(void 0,a),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===at?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===at?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===rt||t===Ze){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt||this.peekCodePoint(0)===it)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),vn)}for(;;){var r=this.consumeCodePoint();if(r===Rt||r===it)return{type:22,value:u.apply(void 0,e)};if($t(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt||this.peekCodePoint(0)===it?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,e)}):(this.consumeBadUrlRemnants(),vn);if(r===Ze||r===rt||r===at||nn(r))return this.consumeBadUrlRemnants(),vn;if(r===Xe){if(!rn(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),vn;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;$t(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===it||e===Rt)return;rn(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var r=Math.min(t,e);n+=u.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),n},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(r===Rt||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(r===Ke)return this._value.splice(0,n),bn;if(r===Xe){var a=this._value[n+1];a!==Rt&&void 0!==a&&(a===Ke?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):rn(r,a)&&(t+=this.consumeStringSlice(n),t+=u(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=We,n=this.peekCodePoint(0);for(n!==_t&&n!==ot||e.push(this.consumeCodePoint());Gt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(n===Nt&&Gt(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Ge;Gt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var a=this.peekCodePoint(2);if((n===jt||n===Pt)&&((r===_t||r===ot)&&Gt(a)||Gt(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Ge;Gt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[on(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),a=this.peekCodePoint(1),i=this.peekCodePoint(2);return an(r,a,i)?{type:15,number:t,flags:n,unit:this.consumeName()}:r===nt?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(qt(e)){for(var t=u(e);qt(this.peekCodePoint(0))&&t.length<6;)t+=u(this.consumeCodePoint());$t(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||Kt(n)||n>1114111?xt:n}return e===Rt?xt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(tn(t))e+=u(t);else{if(!rn(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=u(this.consumeEscapedCodePoint())}}},e}(),In=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new kn;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||On(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return"undefined"===typeof e?Bn:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Tn=function(e){return 15===e.type},Mn=function(e){return 17===e.type},Fn=function(e){return 20===e.type},Rn=function(e){return 0===e.type},Ln=function(e,t){return Fn(e)&&e.value===t},Un=function(e){return 31!==e.type},Pn=function(e){return 31!==e.type&&4!==e.type},Dn=function(e){var t=[],n=[];return e.forEach(function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)}),n.length&&t.push(n),t},On=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},zn=function(e){return 17===e.type||15===e.type},Hn=function(e){return 16===e.type||zn(e)},jn=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Qn={type:17,number:0,flags:We},Vn={type:16,number:50,flags:We},Wn={type:16,number:100,flags:We},Gn=function(e,t,n){var r=e[0],a=e[1];return[Kn(r,t),Kn("undefined"!==typeof a?a:r,n)]},Kn=function(e,t){if(16===e.type)return e.number/100*t;if(Tn(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},qn="deg",Xn="grad",Yn="rad",Jn="turn",Zn={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case qn:return Math.PI*t.number/180;case Xn:return Math.PI/200*t.number;case Yn:return t.number;case Jn:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},$n=function(e){return 15===e.type&&(e.unit===qn||e.unit===Xn||e.unit===Yn||e.unit===Jn)},er=function(e){switch(e.filter(Fn).map(function(e){return e.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Qn,Qn];case"to top":case"bottom":return tr(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Qn,Wn];case"to right":case"left":return tr(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Wn,Wn];case"to bottom":case"top":return tr(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Wn,Qn];case"to left":case"right":return tr(270)}return 0},tr=function(e){return Math.PI*e/180},nr={name:"color",parse:function(e,t){if(18===t.type){var n=ur[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),a=t.value.substring(1,2),i=t.value.substring(2,3);return ir(parseInt(r+r,16),parseInt(a+a,16),parseInt(i+i,16),1)}if(4===t.value.length){r=t.value.substring(0,1),a=t.value.substring(1,2),i=t.value.substring(2,3);var s=t.value.substring(3,4);return ir(parseInt(r+r,16),parseInt(a+a,16),parseInt(i+i,16),parseInt(s+s,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),a=t.value.substring(2,4),i=t.value.substring(4,6),ir(parseInt(r,16),parseInt(a,16),parseInt(i,16),1);if(8===t.value.length)return r=t.value.substring(0,2),a=t.value.substring(2,4),i=t.value.substring(4,6),s=t.value.substring(6,8),ir(parseInt(r,16),parseInt(a,16),parseInt(i,16),parseInt(s,16)/255)}if(20===t.type){var o=dr[t.value.toUpperCase()];if("undefined"!==typeof o)return o}return dr.TRANSPARENT}},rr=function(e){return 0===(255&e)},ar=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,a=255&e>>24;return t<255?"rgba("+a+","+r+","+n+","+t/255+")":"rgb("+a+","+r+","+n+")"},ir=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r))>>>0},sr=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},or=function(e,t){var n=t.filter(Pn);if(3===n.length){var r=n.map(sr),a=r[0],i=r[1],s=r[2];return ir(a,i,s,1)}if(4===n.length){var o=n.map(sr),l=(a=o[0],i=o[1],s=o[2],o[3]);return ir(a,i,s,l)}return 0};function lr(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var cr=function(e,t){var n=t.filter(Pn),r=n[0],a=n[1],i=n[2],s=n[3],o=(17===r.type?tr(r.number):Zn.parse(e,r))/(2*Math.PI),l=Hn(a)?a.number/100:0,c=Hn(i)?i.number/100:0,u="undefined"!==typeof s&&Hn(s)?Kn(s,1):1;if(0===l)return ir(255*c,255*c,255*c,1);var h=c<=.5?c*(l+1):c+l-c*l,d=2*c-h,A=lr(d,h,o+1/3),p=lr(d,h,o),f=lr(d,h,o-1/3);return ir(255*A,255*p,255*f,u)},ur={hsl:cr,hsla:cr,rgb:or,rgba:or},hr=function(e,t){return nr.parse(e,In.create(t).parseComponentValue())},dr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Ar={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Fn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},pr={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fr=function(e,t){var n=nr.parse(e,t[0]),r=t[1];return r&&Hn(r)?{color:n,stop:r}:{color:n,stop:null}},mr=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=Qn),null===r.stop&&(r.stop=Wn);for(var a=[],i=0,s=0;s<e.length;s++){var o=e[s].stop;if(null!==o){var l=Kn(o,t);l>i?a.push(l):a.push(i),i=l}else a.push(null)}var c=null;for(s=0;s<a.length;s++){var u=a[s];if(null===u)null===c&&(c=s);else if(null!==c){for(var h=s-c,d=(u-a[c-1])/(h+1),A=1;A<=h;A++)a[c+A-1]=d*A;c=null}}return e.map(function(e,n){return{color:e.color,stop:Math.max(Math.min(1,a[n]/t),0)}})},gr=function(e,t,n){var r=t/2,a=n/2,i=Kn(e[0],t)-r,s=a-Kn(e[1],n);return(Math.atan2(s,i)+2*Math.PI)%(2*Math.PI)},yr=function(e,t,n){var r="number"===typeof e?e:gr(e,t,n),a=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),i=t/2,s=n/2,o=a/2,l=Math.sin(r-Math.PI/2)*o,c=Math.cos(r-Math.PI/2)*o;return[a,i-c,i+c,s-l,s+l]},vr=function(e,t){return Math.sqrt(e*e+t*t)},br=function(e,t,n,r,a){return[[0,0],[0,t],[e,0],[e,t]].reduce(function(e,t){var i=t[0],s=t[1],o=vr(n-i,r-s);return(a?o<e.optimumDistance:o>e.optimumDistance)?{optimumCorner:t,optimumDistance:o}:e},{optimumDistance:a?1/0:-1/0,optimumCorner:null}).optimumCorner},xr=function(e,t,n,r,a){var i=0,s=0;switch(e.size){case 0:0===e.shape?i=s=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-a)):1===e.shape&&(i=Math.min(Math.abs(t),Math.abs(t-r)),s=Math.min(Math.abs(n),Math.abs(n-a)));break;case 2:if(0===e.shape)i=s=Math.min(vr(t,n),vr(t,n-a),vr(t-r,n),vr(t-r,n-a));else if(1===e.shape){var o=Math.min(Math.abs(n),Math.abs(n-a))/Math.min(Math.abs(t),Math.abs(t-r)),l=br(r,a,t,n,!0),c=l[0],u=l[1];s=o*(i=vr(c-t,(u-n)/o))}break;case 1:0===e.shape?i=s=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-a)):1===e.shape&&(i=Math.max(Math.abs(t),Math.abs(t-r)),s=Math.max(Math.abs(n),Math.abs(n-a)));break;case 3:if(0===e.shape)i=s=Math.max(vr(t,n),vr(t,n-a),vr(t-r,n),vr(t-r,n-a));else if(1===e.shape){o=Math.max(Math.abs(n),Math.abs(n-a))/Math.max(Math.abs(t),Math.abs(t-r));var h=br(r,a,t,n,!1);c=h[0],u=h[1],s=o*(i=vr(c-t,(u-n)/o))}}return Array.isArray(e.size)&&(i=Kn(e.size[0],r),s=2===e.size.length?Kn(e.size[1],a):i),[i,s]},wr=function(e,t){var n=tr(180),r=[];return Dn(t).forEach(function(t,a){if(0===a){var i=t[0];if(20===i.type&&-1!==["top","left","right","bottom"].indexOf(i.value))return void(n=er(t));if($n(i))return void(n=(Zn.parse(e,i)+tr(270))%tr(360))}var s=fr(e,t);r.push(s)}),{angle:n,stops:r,type:1}},_r="closest-side",Sr="farthest-side",Cr="closest-corner",Er="farthest-corner",Nr="circle",Br="ellipse",kr="cover",Ir="contain",Tr=function(e,t){var n=0,r=3,a=[],i=[];return Dn(t).forEach(function(t,s){var o=!0;if(0===s?o=t.reduce(function(e,t){if(Fn(t))switch(t.value){case"center":return i.push(Vn),!1;case"top":case"left":return i.push(Qn),!1;case"right":case"bottom":return i.push(Wn),!1}else if(Hn(t)||zn(t))return i.push(t),!1;return e},o):1===s&&(o=t.reduce(function(e,t){if(Fn(t))switch(t.value){case Nr:return n=0,!1;case Br:return n=1,!1;case Ir:case _r:return r=0,!1;case Sr:return r=1,!1;case Cr:return r=2,!1;case kr:case Er:return r=3,!1}else if(zn(t)||Hn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e},o)),o){var l=fr(e,t);a.push(l)}}),{size:r,shape:n,stops:a,position:i,type:2}},Mr=function(e){return 1===e.type},Fr=function(e){return 2===e.type},Rr={name:"image",parse:function(e,t){if(22===t.type){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(18===t.type){var r=Pr[t.name];if("undefined"===typeof r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function Lr(e){return!(20===e.type&&"none"===e.value)&&(18!==e.type||!!Pr[e.name])}var Ur,Pr={"linear-gradient":function(e,t){var n=tr(180),r=[];return Dn(t).forEach(function(t,a){if(0===a){var i=t[0];if(20===i.type&&"to"===i.value)return void(n=er(t));if($n(i))return void(n=Zn.parse(e,i))}var s=fr(e,t);r.push(s)}),{angle:n,stops:r,type:1}},"-moz-linear-gradient":wr,"-ms-linear-gradient":wr,"-o-linear-gradient":wr,"-webkit-linear-gradient":wr,"radial-gradient":function(e,t){var n=0,r=3,a=[],i=[];return Dn(t).forEach(function(t,s){var o=!0;if(0===s){var l=!1;o=t.reduce(function(e,t){if(l)if(Fn(t))switch(t.value){case"center":return i.push(Vn),e;case"top":case"left":return i.push(Qn),e;case"right":case"bottom":return i.push(Wn),e}else(Hn(t)||zn(t))&&i.push(t);else if(Fn(t))switch(t.value){case Nr:return n=0,!1;case Br:return n=1,!1;case"at":return l=!0,!1;case _r:return r=0,!1;case kr:case Sr:return r=1,!1;case Ir:case Cr:return r=2,!1;case Er:return r=3,!1}else if(zn(t)||Hn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e},o)}if(o){var c=fr(e,t);a.push(c)}}),{size:r,shape:n,stops:a,position:i,type:2}},"-moz-radial-gradient":Tr,"-ms-radial-gradient":Tr,"-o-radial-gradient":Tr,"-webkit-radial-gradient":Tr,"-webkit-gradient":function(e,t){var n=tr(180),r=[],a=1,i=0,s=3,o=[];return Dn(t).forEach(function(t,n){var i=t[0];if(0===n){if(Fn(i)&&"linear"===i.value)return void(a=1);if(Fn(i)&&"radial"===i.value)return void(a=2)}if(18===i.type)if("from"===i.name){var s=nr.parse(e,i.values[0]);r.push({stop:Qn,color:s})}else if("to"===i.name)s=nr.parse(e,i.values[0]),r.push({stop:Wn,color:s});else if("color-stop"===i.name){var o=i.values.filter(Pn);if(2===o.length){s=nr.parse(e,o[1]);var l=o[0];Mn(l)&&r.push({stop:{type:16,number:100*l.number,flags:l.flags},color:s})}}}),1===a?{angle:(n+tr(180))%tr(360),stops:r,type:a}:{size:s,shape:i,stops:r,position:o,type:a}}},Dr={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter(function(e){return Pn(e)&&Lr(e)}).map(function(t){return Rr.parse(e,t)})}},Or={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Fn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},zr={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(Hn)}).map(jn)}},Hr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(Fn).map(function(e){return e.value}).join(" ")}).map(jr)}},jr=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Ur||(Ur={}));var Qr,Vr={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(Wr)})}},Wr=function(e){return Fn(e)||Hn(e)},Gr=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Kr=Gr("top"),qr=Gr("right"),Xr=Gr("bottom"),Yr=Gr("left"),Jr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return jn(t.filter(Hn))}}},Zr=Jr("top-left"),$r=Jr("top-right"),ea=Jr("bottom-right"),ta=Jr("bottom-left"),na=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},ra=na("top"),aa=na("right"),ia=na("bottom"),sa=na("left"),oa=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Tn(t)?t.number:0}}},la=oa("top"),ca=oa("right"),ua=oa("bottom"),ha=oa("left"),da={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Aa={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},pa={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).reduce(function(e,t){return e|fa(t.value)},0)}},fa=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},ma={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},ga={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Qr||(Qr={}));var ya,va={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Qr.STRICT:Qr.NORMAL}},ba={name:"line-height",initialValue:"normal",prefix:!1,type:4},xa=function(e,t){return Fn(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Hn(e)?Kn(e,t):t},wa={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Rr.parse(e,t)}},_a={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},Sa={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Ca=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Ea=Ca("top"),Na=Ca("right"),Ba=Ca("bottom"),ka=Ca("left"),Ia={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},Ta={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Ma=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Fa=Ma("top"),Ra=Ma("right"),La=Ma("bottom"),Ua=Ma("left"),Pa={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Da={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Oa={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Dn(t).map(function(t){for(var n={color:dr.TRANSPARENT,offsetX:Qn,offsetY:Qn,blur:Qn},r=0,a=0;a<t.length;a++){var i=t[a];zn(i)?(0===r?n.offsetX=i:1===r?n.offsetY=i:n.blur=i,r++):n.color=nr.parse(e,i)}return n})}},za={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ha={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=ja[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},ja={matrix:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number});return 6===t.length?t:null},matrix3d:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number}),n=t[0],r=t[1];t[2],t[3];var a=t[4],i=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var s=t[12],o=t[13];return t[14],t[15],16===t.length?[n,r,a,i,s,o]:null}},Qa={type:16,number:50,flags:We},Va=[Qa,Qa],Wa={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(Hn);return 2!==n.length?Va:[n[0],n[1]]}},Ga={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(ya||(ya={}));for(var Ka={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return ya.BREAK_ALL;case"keep-all":return ya.KEEP_ALL;default:return ya.NORMAL}}},qa={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Mn(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Xa={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Ya={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Mn(t)?t.number:1}},Ja={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Za={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return 0!==e})}},$a={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],r=[];return t.forEach(function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:r.push(n.join(" ")),n.length=0}}),n.length&&r.push(n.join(" ")),r.map(function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"})}},ei={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ti={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Mn(t)?t.number:Fn(t)&&"bold"===t.value?700:400}},ni={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Fn).map(function(e){return e.value})}},ri={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},ai=function(e,t){return 0!==(e&t)},ii={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},si={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var r=[],a=t.filter(Un),i=0;i<a.length;i++){var s=a[i],o=a[i+1];if(20===s.type){var l=o&&Mn(o)?o.number:1;r.push({counter:s.value,increment:l})}}return r}},oi={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(Un),a=0;a<r.length;a++){var i=r[a],s=r[a+1];if(Fn(i)&&"none"!==i.value){var o=s&&Mn(s)?s.number:0;n.push({counter:i.value,reset:o})}}return n}},li={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Tn).map(function(t){return Xa.parse(e,t)})}},ci={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var r=[],a=t.filter(Rn);if(a.length%2!==0)return null;for(var i=0;i<a.length;i+=2){var s=a[i].value,o=a[i+1].value;r.push({open:s,close:o})}return r}},ui=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},hi={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Dn(t).map(function(t){for(var n={color:255,offsetX:Qn,offsetY:Qn,blur:Qn,spread:Qn,inset:!1},r=0,a=0;a<t.length;a++){var i=t[a];Ln(i,"inset")?n.inset=!0:zn(i)?(0===r?n.offsetX=i:1===r?n.offsetY=i:2===r?n.blur=i:n.spread=i,r++):n.color=nr.parse(e,i)}return n})}},di={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[0,1,2],r=[];return t.filter(Fn).forEach(function(e){switch(e.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2)}}),n.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),r}},Ai={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},pi={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Tn(t)?t.number:0}},fi=function(){function e(e,t){var n,r;this.animationDuration=yi(e,li,t.animationDuration),this.backgroundClip=yi(e,Ar,t.backgroundClip),this.backgroundColor=yi(e,pr,t.backgroundColor),this.backgroundImage=yi(e,Dr,t.backgroundImage),this.backgroundOrigin=yi(e,Or,t.backgroundOrigin),this.backgroundPosition=yi(e,zr,t.backgroundPosition),this.backgroundRepeat=yi(e,Hr,t.backgroundRepeat),this.backgroundSize=yi(e,Vr,t.backgroundSize),this.borderTopColor=yi(e,Kr,t.borderTopColor),this.borderRightColor=yi(e,qr,t.borderRightColor),this.borderBottomColor=yi(e,Xr,t.borderBottomColor),this.borderLeftColor=yi(e,Yr,t.borderLeftColor),this.borderTopLeftRadius=yi(e,Zr,t.borderTopLeftRadius),this.borderTopRightRadius=yi(e,$r,t.borderTopRightRadius),this.borderBottomRightRadius=yi(e,ea,t.borderBottomRightRadius),this.borderBottomLeftRadius=yi(e,ta,t.borderBottomLeftRadius),this.borderTopStyle=yi(e,ra,t.borderTopStyle),this.borderRightStyle=yi(e,aa,t.borderRightStyle),this.borderBottomStyle=yi(e,ia,t.borderBottomStyle),this.borderLeftStyle=yi(e,sa,t.borderLeftStyle),this.borderTopWidth=yi(e,la,t.borderTopWidth),this.borderRightWidth=yi(e,ca,t.borderRightWidth),this.borderBottomWidth=yi(e,ua,t.borderBottomWidth),this.borderLeftWidth=yi(e,ha,t.borderLeftWidth),this.boxShadow=yi(e,hi,t.boxShadow),this.color=yi(e,da,t.color),this.direction=yi(e,Aa,t.direction),this.display=yi(e,pa,t.display),this.float=yi(e,ma,t.cssFloat),this.fontFamily=yi(e,$a,t.fontFamily),this.fontSize=yi(e,ei,t.fontSize),this.fontStyle=yi(e,ri,t.fontStyle),this.fontVariant=yi(e,ni,t.fontVariant),this.fontWeight=yi(e,ti,t.fontWeight),this.letterSpacing=yi(e,ga,t.letterSpacing),this.lineBreak=yi(e,va,t.lineBreak),this.lineHeight=yi(e,ba,t.lineHeight),this.listStyleImage=yi(e,wa,t.listStyleImage),this.listStylePosition=yi(e,_a,t.listStylePosition),this.listStyleType=yi(e,Sa,t.listStyleType),this.marginTop=yi(e,Ea,t.marginTop),this.marginRight=yi(e,Na,t.marginRight),this.marginBottom=yi(e,Ba,t.marginBottom),this.marginLeft=yi(e,ka,t.marginLeft),this.opacity=yi(e,Ya,t.opacity);var a=yi(e,Ia,t.overflow);this.overflowX=a[0],this.overflowY=a[a.length>1?1:0],this.overflowWrap=yi(e,Ta,t.overflowWrap),this.paddingTop=yi(e,Fa,t.paddingTop),this.paddingRight=yi(e,Ra,t.paddingRight),this.paddingBottom=yi(e,La,t.paddingBottom),this.paddingLeft=yi(e,Ua,t.paddingLeft),this.paintOrder=yi(e,di,t.paintOrder),this.position=yi(e,Da,t.position),this.textAlign=yi(e,Pa,t.textAlign),this.textDecorationColor=yi(e,Ja,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=yi(e,Za,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=yi(e,Oa,t.textShadow),this.textTransform=yi(e,za,t.textTransform),this.transform=yi(e,Ha,t.transform),this.transformOrigin=yi(e,Wa,t.transformOrigin),this.visibility=yi(e,Ga,t.visibility),this.webkitTextStrokeColor=yi(e,Ai,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=yi(e,pi,t.webkitTextStrokeWidth),this.wordBreak=yi(e,Ka,t.wordBreak),this.zIndex=yi(e,qa,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return rr(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return ai(this.display,4)||ai(this.display,33554432)||ai(this.display,268435456)||ai(this.display,536870912)||ai(this.display,67108864)||ai(this.display,134217728)},e}(),mi=function(){function e(e,t){this.content=yi(e,ii,t.content),this.quotes=yi(e,ci,t.quotes)}return e}(),gi=function(){function e(e,t){this.counterIncrement=yi(e,si,t.counterIncrement),this.counterReset=yi(e,oi,t.counterReset)}return e}(),yi=function(e,t,n){var r=new kn,a=null!==n&&"undefined"!==typeof n?n.toString():t.initialValue;r.write(a);var i=new In(r.read());switch(t.type){case 2:var s=i.parseComponentValue();return t.parse(e,Fn(s)?s.value:t.initialValue);case 0:return t.parse(e,i.parseComponentValue());case 1:return t.parse(e,i.parseComponentValues());case 4:return i.parseComponentValue();case 3:switch(t.format){case"angle":return Zn.parse(e,i.parseComponentValue());case"color":return nr.parse(e,i.parseComponentValue());case"image":return Rr.parse(e,i.parseComponentValue());case"length":var o=i.parseComponentValue();return zn(o)?o:Qn;case"length-percentage":var l=i.parseComponentValue();return Hn(l)?l:Qn;case"time":return Xa.parse(e,i.parseComponentValue())}}},vi="data-html2canvas-debug",bi=function(e){switch(e.getAttribute(vi)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},xi=function(e,t){var n=bi(e);return 1===n||t===n},wi=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,xi(t,3),this.styles=new fi(e,window.getComputedStyle(t,null)),co(t)&&(this.styles.animationDuration.some(function(e){return e>0})&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=o(this.context,t),xi(t,4)&&(this.flags|=16)}return e}(),_i="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Si="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ci="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Ei=0;Ei<Si.length;Ei++)Ci[Si.charCodeAt(Ei)]=Ei;for(var Ni=function(e){var t,n,r,a,i,s=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=Ci[e.charCodeAt(t)],r=Ci[e.charCodeAt(t+1)],a=Ci[e.charCodeAt(t+2)],i=Ci[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&i;return c},Bi=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},ki=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},Ii=5,Ti=11,Mi=2,Fi=65536>>Ii,Ri=(1<<Ii)-1,Li=Fi+(1024>>Ii)+32,Ui=65536>>Ti,Pi=(1<<Ti-Ii)-1,Di=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},Oi=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},zi=function(e,t){var n=Ni(e),r=Array.isArray(n)?ki(n):new Uint32Array(n),a=Array.isArray(n)?Bi(n):new Uint16Array(n),i=24,s=Di(a,i/2,r[4]/2),o=2===r[5]?Di(a,(i+r[4])/2):Oi(r,Math.ceil((i+r[4])/4));return new Hi(r[0],r[1],r[2],r[3],s,o)},Hi=function(){function e(e,t,n,r,a,i){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=a,this.data=i}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>Ii])<<Mi)+(e&Ri),this.data[t];if(e<=65535)return t=((t=this.index[Fi+(e-55296>>Ii)])<<Mi)+(e&Ri),this.data[t];if(e<this.highStart)return t=Li-Ui+(e>>Ti),t=this.index[t],t+=e>>Ii&Pi,t=((t=this.index[t])<<Mi)+(e&Ri),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),ji="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qi="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Vi=0;Vi<ji.length;Vi++)Qi[ji.charCodeAt(Vi)]=Vi;var Wi,Gi=1,Ki=2,qi=3,Xi=4,Yi=5,Ji=7,Zi=8,$i=9,es=10,ts=11,ns=12,rs=13,as=14,is=15,ss=function(e){for(var t=[],n=0,r=e.length;n<r;){var a=e.charCodeAt(n++);if(a>=55296&&a<=56319&&n<r){var i=e.charCodeAt(n++);56320===(64512&i)?t.push(((1023&a)<<10)+(1023&i)+65536):(t.push(a),n--)}else t.push(a)}return t},os=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],a=-1,i="";++a<n;){var s=e[a];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(a+1===n||r.length>16384)&&(i+=String.fromCharCode.apply(String,r),r.length=0)}return i},ls=zi(_i),cs="\xd7",us="\xf7",hs=function(e){return ls.get(e)},ds=function(e,t,n){var r=n-2,a=t[r],i=t[n-1],s=t[n];if(i===Ki&&s===qi)return cs;if(i===Ki||i===qi||i===Xi)return us;if(s===Ki||s===qi||s===Xi)return us;if(i===Zi&&-1!==[Zi,$i,ts,ns].indexOf(s))return cs;if((i===ts||i===$i)&&(s===$i||s===es))return cs;if((i===ns||i===es)&&s===es)return cs;if(s===rs||s===Yi)return cs;if(s===Ji)return cs;if(i===Gi)return cs;if(i===rs&&s===as){for(;a===Yi;)a=t[--r];if(a===as)return cs}if(i===is&&s===is){for(var o=0;a===is;)o++,a=t[--r];if(o%2===0)return cs}return us},As=function(e){var t=ss(e),n=t.length,r=0,a=0,i=t.map(hs);return{next:function(){if(r>=n)return{done:!0,value:null};for(var e=cs;r<n&&(e=ds(t,i,++r))===cs;);if(e!==cs||r===n){var s=os.apply(null,t.slice(a,r));return a=r,{value:s,done:!1}}return{done:!0,value:null}}}},ps=function(e){for(var t,n=As(e),r=[];!(t=n.next()).done;)t.value&&r.push(t.value.slice());return r},fs=function(e){var t=123;if(e.createRange){var n=e.createRange();if(n.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height=t+"px",r.style.display="block",e.body.appendChild(r),n.selectNode(r);var a=n.getBoundingClientRect(),i=Math.round(a.height);if(e.body.removeChild(r),i===t)return!0}}return!1},ms=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"===typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,a=c(r.data).map(function(e){return u(e)}),i=0,s={},o=a.every(function(e,t){n.setStart(r,i),n.setEnd(r,i+e.length);var a=n.getBoundingClientRect();i+=e.length;var o=a.x>s.x||a.y>s.y;return s=a,0===t||o});return e.body.removeChild(t),o},gs=function(){return"undefined"!==typeof(new Image).crossOrigin},ys=function(){return"string"===typeof(new XMLHttpRequest).responseType},vs=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(Pt){return!1}return!0},bs=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},xs=function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var a=new Image,i=t.toDataURL();a.src=i;var s=ws(n,n,0,0,a);return r.fillStyle="red",r.fillRect(0,0,n,n),_s(s).then(function(t){r.drawImage(t,0,0);var a=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var s=e.createElement("div");return s.style.backgroundImage="url("+i+")",s.style.height=n+"px",bs(a)?_s(ws(n,n,0,0,s)):Promise.reject(!1)}).then(function(e){return r.drawImage(e,0,0),bs(r.getImageData(0,0,n,n).data)}).catch(function(){return!1})},ws=function(e,t,n,r,a){var i="http://www.w3.org/2000/svg",s=document.createElementNS(i,"svg"),o=document.createElementNS(i,"foreignObject");return s.setAttributeNS(null,"width",e.toString()),s.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",n.toString()),o.setAttributeNS(null,"y",r.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(o),o.appendChild(a),s},_s=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},Ss={get SUPPORT_RANGE_BOUNDS(){var e=fs(document);return Object.defineProperty(Ss,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Ss.SUPPORT_RANGE_BOUNDS&&ms(document);return Object.defineProperty(Ss,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=vs(document);return Object.defineProperty(Ss,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"===typeof Array.from&&"function"===typeof window.fetch?xs(document):Promise.resolve(!1);return Object.defineProperty(Ss,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=gs();return Object.defineProperty(Ss,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=ys();return Object.defineProperty(Ss,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ss,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"===typeof Intl||!Intl.Segmenter);return Object.defineProperty(Ss,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Cs=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),Es=function(e,t,n,r){var a=Ts(t,n),i=[],o=0;return a.forEach(function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Ss.SUPPORT_RANGE_BOUNDS){var a=Bs(r,o,t.length).getClientRects();if(a.length>1){var l=ks(t),c=0;l.forEach(function(t){i.push(new Cs(t,s.fromDOMRectList(e,Bs(r,c+o,t.length).getClientRects()))),c+=t.length})}else i.push(new Cs(t,s.fromDOMRectList(e,a)))}else{var u=r.splitText(t.length);i.push(new Cs(t,Ns(e,r))),r=u}else Ss.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));o+=t.length}),i},Ns=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var a=t.parentNode;if(a){a.replaceChild(r,t);var i=o(e,r);return r.firstChild&&a.replaceChild(r.firstChild,r),i}}return s.EMPTY},Bs=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var a=r.createRange();return a.setStart(e,t),a.setEnd(e,t+n),a},ks=function(e){if(Ss.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(e){return e.segment})}return ps(e)},Is=function(e,t){if(Ss.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map(function(e){return e.segment})}return Fs(e,t)},Ts=function(e,t){return 0!==t.letterSpacing?ks(e):Is(e,t)},Ms=[32,160,4961,65792,65793,4153,4241],Fs=function(e,t){for(var n,r=je(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),a=[],i=function(){if(n.value){var e=n.value.slice(),t=c(e),r="";t.forEach(function(e){-1===Ms.indexOf(e)?r+=u(e):(r.length&&a.push(r),a.push(u(e)),r="")}),r.length&&a.push(r)}};!(n=r.next()).done;)i();return a},Rs=function(){function e(e,t,n){this.text=Ls(t.data,n.textTransform),this.textBounds=Es(e,this.text,n,t)}return e}(),Ls=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Us,Ps);case 2:return e.toUpperCase();default:return e}},Us=/(^|\s|:|-|\(|\))([a-z])/g,Ps=function(e,t,n){return e.length>0?t+n.toUpperCase():e},Ds=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(wi),Os=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(wi),zs=function(e){function n(t,n){var r=e.call(this,t,n)||this,a=new XMLSerializer,i=o(t,n);return n.setAttribute("width",i.width+"px"),n.setAttribute("height",i.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(a.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(wi),Hs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wi),js=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"===typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(wi),Qs=[{type:15,flags:0,unit:"px",number:3}],Vs=[{type:16,flags:0,number:50}],Ws=function(e){return e.width>e.height?new s(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new s(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},Gs=function(e){var t=e.type===Xs?new Array(e.value.length+1).join("\u2022"):e.value;return 0===t.length?e.placeholder||"":t},Ks="checkbox",qs="radio",Xs="password",Ys=707406591,Js=function(e){function n(t,n){var r=e.call(this,t,n)||this;switch(r.type=n.type.toLowerCase(),r.checked=n.checked,r.value=Gs(n),r.type!==Ks&&r.type!==qs||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=Ws(r.bounds)),r.type){case Ks:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Qs;break;case qs:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Vs}return r}return t(n,e),n}(wi),Zs=function(e){function n(t,n){var r=e.call(this,t,n)||this,a=n.options[n.selectedIndex||0];return r.value=a&&a.text||"",r}return t(n,e),n}(wi),$s=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wi),eo=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=ao(t,n.contentWindow.document.documentElement);var a=n.contentWindow.document.documentElement?hr(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):dr.TRANSPARENT,i=n.contentWindow.document.body?hr(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):dr.TRANSPARENT;r.backgroundColor=rr(a)?rr(i)?r.styles.backgroundColor:i:a}}catch(Pt){}return r}return t(n,e),n}(wi),to=["OL","UL","MENU"],no=function(e,t,n,r){for(var a=t.firstChild,i=void 0;a;a=i)if(i=a.nextSibling,oo(a)&&a.data.trim().length>0)n.textNodes.push(new Rs(e,a,n.styles));else if(lo(a))if(Eo(a)&&a.assignedNodes)a.assignedNodes().forEach(function(t){return no(e,t,n,r)});else{var s=ro(e,a);s.styles.isVisible()&&(io(a,s,r)?s.flags|=4:so(s.styles)&&(s.flags|=2),-1!==to.indexOf(a.tagName)&&(s.flags|=8),n.elements.push(s),a.slot,a.shadowRoot?no(e,a.shadowRoot,s,r):So(a)||mo(a)||Co(a)||no(e,a,s,r))}},ro=function(e,t){return bo(t)?new Ds(e,t):yo(t)?new Os(e,t):mo(t)?new zs(e,t):ho(t)?new Hs(e,t):Ao(t)?new js(e,t):po(t)?new Js(e,t):Co(t)?new Zs(e,t):So(t)?new $s(e,t):xo(t)?new eo(e,t):new wi(e,t)},ao=function(e,t){var n=ro(e,t);return n.flags|=4,no(e,t,n,n),n},io=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||go(e)&&n.styles.isTransparent()},so=function(e){return e.isPositioned()||e.isFloating()},oo=function(e){return e.nodeType===Node.TEXT_NODE},lo=function(e){return e.nodeType===Node.ELEMENT_NODE},co=function(e){return lo(e)&&"undefined"!==typeof e.style&&!uo(e)},uo=function(e){return"object"===typeof e.className},ho=function(e){return"LI"===e.tagName},Ao=function(e){return"OL"===e.tagName},po=function(e){return"INPUT"===e.tagName},fo=function(e){return"HTML"===e.tagName},mo=function(e){return"svg"===e.tagName},go=function(e){return"BODY"===e.tagName},yo=function(e){return"CANVAS"===e.tagName},vo=function(e){return"VIDEO"===e.tagName},bo=function(e){return"IMG"===e.tagName},xo=function(e){return"IFRAME"===e.tagName},wo=function(e){return"STYLE"===e.tagName},_o=function(e){return"SCRIPT"===e.tagName},So=function(e){return"TEXTAREA"===e.tagName},Co=function(e){return"SELECT"===e.tagName},Eo=function(e){return"SLOT"===e.tagName},No=function(e){return e.tagName.indexOf("-")>0},Bo=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,a=!0;null!==n&&n.forEach(function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(a=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)});var i=[];return a&&r.forEach(function(e){var n=t.counters[e.counter];i.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)}),i},e}(),ko={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Io={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054f","\u054e","\u054d","\u054c","\u054b","\u054a","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053f","\u053e","\u053d","\u053c","\u053b","\u053a","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},To={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05d9\u05f3","\u05d8\u05f3","\u05d7\u05f3","\u05d6\u05f3","\u05d5\u05f3","\u05d4\u05f3","\u05d3\u05f3","\u05d2\u05f3","\u05d1\u05f3","\u05d0\u05f3","\u05ea","\u05e9","\u05e8","\u05e7","\u05e6","\u05e4","\u05e2","\u05e1","\u05e0","\u05de","\u05dc","\u05db","\u05d9\u05d8","\u05d9\u05d7","\u05d9\u05d6","\u05d8\u05d6","\u05d8\u05d5","\u05d9","\u05d8","\u05d7","\u05d6","\u05d5","\u05d4","\u05d3","\u05d2","\u05d1","\u05d0"]},Mo={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10f5","\u10f0","\u10ef","\u10f4","\u10ee","\u10ed","\u10ec","\u10eb","\u10ea","\u10e9","\u10e8","\u10e7","\u10e6","\u10e5","\u10e4","\u10f3","\u10e2","\u10e1","\u10e0","\u10df","\u10de","\u10dd","\u10f2","\u10dc","\u10db","\u10da","\u10d9","\u10d8","\u10d7","\u10f1","\u10d6","\u10d5","\u10d4","\u10d3","\u10d2","\u10d1","\u10d0"]},Fo=function(e,t,n,r,a,i){return e<t||e>n?Go(e,a,i.length>0):r.integers.reduce(function(t,n,a){for(;e>=n;)e-=n,t+=r.values[a];return t},"")+i},Ro=function(e,t,n,r){var a="";do{n||e--,a=r(e)+a,e/=t}while(e*t>=t);return a},Lo=function(e,t,n,r,a){var i=n-t+1;return(e<0?"-":"")+(Ro(Math.abs(e),i,r,function(e){return u(Math.floor(e%i)+t)})+a)},Uo=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return Ro(Math.abs(e),r,!1,function(e){return t[Math.floor(e%r)]})+n},Po=1,Do=2,Oo=4,zo=8,Ho=function(e,t,n,r,a,i){if(e<-9999||e>9999)return Go(e,4,a.length>0);var s=Math.abs(e),o=a;if(0===s)return t[0]+o;for(var l=0;s>0&&l<=4;l++){var c=s%10;0===c&&ai(i,Po)&&""!==o?o=t[c]+o:c>1||1===c&&0===l||1===c&&1===l&&ai(i,Do)||1===c&&1===l&&ai(i,Oo)&&e>100||1===c&&l>1&&ai(i,zo)?o=t[c]+(l>0?n[l-1]:"")+o:1===c&&l>0&&(o=n[l-1]+o),s=Math.floor(s/10)}return(e<0?r:"")+o},jo="\u5341\u767e\u5343\u842c",Qo="\u62fe\u4f70\u4edf\u842c",Vo="\u30de\u30a4\u30ca\u30b9",Wo="\ub9c8\uc774\ub108\uc2a4",Go=function(e,t,n){var r=n?". ":"",a=n?"\u3001":"",i=n?", ":"",s=n?" ":"";switch(t){case 0:return"\u2022"+s;case 1:return"\u25e6"+s;case 2:return"\u25fe"+s;case 5:var o=Lo(e,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return Uo(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",a);case 6:return Fo(e,1,3999,ko,3,r).toLowerCase();case 7:return Fo(e,1,3999,ko,3,r);case 8:return Lo(e,945,969,!1,r);case 9:return Lo(e,97,122,!1,r);case 10:return Lo(e,65,90,!1,r);case 11:return Lo(e,1632,1641,!0,r);case 12:case 49:return Fo(e,1,9999,Io,3,r);case 35:return Fo(e,1,9999,Io,3,r).toLowerCase();case 13:return Lo(e,2534,2543,!0,r);case 14:case 30:return Lo(e,6112,6121,!0,r);case 15:return Uo(e,"\u5b50\u4e11\u5bc5\u536f\u8fb0\u5df3\u5348\u672a\u7533\u9149\u620c\u4ea5",a);case 16:return Uo(e,"\u7532\u4e59\u4e19\u4e01\u620a\u5df1\u5e9a\u8f9b\u58ec\u7678",a);case 17:case 48:return Ho(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",jo,"\u8ca0",a,Do|Oo|zo);case 47:return Ho(e,"\u96f6\u58f9\u8cb3\u53c3\u8086\u4f0d\u9678\u67d2\u634c\u7396",Qo,"\u8ca0",a,Po|Do|Oo|zo);case 42:return Ho(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",jo,"\u8d1f",a,Do|Oo|zo);case 41:return Ho(e,"\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396",Qo,"\u8d1f",a,Po|Do|Oo|zo);case 26:return Ho(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07",Vo,a,0);case 25:return Ho(e,"\u96f6\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343\u4e07",Vo,a,Po|Do|Oo);case 31:return Ho(e,"\uc601\uc77c\uc774\uc0bc\uc0ac\uc624\uc721\uce60\ud314\uad6c","\uc2ed\ubc31\ucc9c\ub9cc",Wo,i,Po|Do|Oo);case 33:return Ho(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u842c",Wo,i,0);case 32:return Ho(e,"\u96f6\u58f9\u8cb3\u53c3\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343",Wo,i,Po|Do|Oo);case 18:return Lo(e,2406,2415,!0,r);case 20:return Fo(e,1,19999,Mo,3,r);case 21:return Lo(e,2790,2799,!0,r);case 22:return Lo(e,2662,2671,!0,r);case 22:return Fo(e,1,10999,To,3,r);case 23:return Uo(e,"\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093");case 24:return Uo(e,"\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059");case 27:return Lo(e,3302,3311,!0,r);case 28:return Uo(e,"\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3",a);case 29:return Uo(e,"\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9",a);case 34:return Lo(e,3792,3801,!0,r);case 37:return Lo(e,6160,6169,!0,r);case 38:return Lo(e,4160,4169,!0,r);case 39:return Lo(e,2918,2927,!0,r);case 40:return Lo(e,1776,1785,!0,r);case 43:return Lo(e,3046,3055,!0,r);case 44:return Lo(e,3174,3183,!0,r);case 45:return Lo(e,3664,3673,!0,r);case 46:return Lo(e,3872,3881,!0,r);default:return Lo(e,48,57,!0,r)}},Ko="data-html2canvas-ignore",qo=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new Bo,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var n=this,i=Yo(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,l=i.contentWindow,c=l.document,u=$o(i).then(function(){return r(n,void 0,void 0,function(){var e,n;return a(this,function(r){switch(r.label){case 0:return this.scrolledElements.forEach(al),l&&(l.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===t.top&&l.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-t.left,l.scrollY-t.top,0,0))),e=this.options.onclone,"undefined"===typeof(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Zo(c)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"===typeof e?[2,Promise.resolve().then(function(){return e(c,n)}).then(function(){return i})]:[2,i]}})})});return c.open(),c.write(nl(document.doctype)+"<html></html>"),rl(this.referenceElement.ownerDocument,s,o),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},e.prototype.createElementClone=function(e){if(xi(e,2),yo(e))return this.createCanvasClone(e);if(vo(e))return this.createVideoClone(e);if(wo(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return bo(t)&&(bo(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),No(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return tl(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(e,t){return t&&"string"===typeof t.cssText?e+t.cssText:e},""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(Pt){if(this.context.logger.error("Unable to access cssRules property",Pt),"SecurityError"!==Pt.name)throw Pt}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(Pt){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var a=e.getContext("2d"),i=r.getContext("2d");if(i)if(!this.options.allowTaint&&a)i.putImageData(a.getImageData(0,0,e.width,e.height),0,0);else{var s=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(s){var o=s.getContextAttributes();!1===(null===o||void 0===o?void 0:o.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}i.drawImage(e,0,0)}return r}catch(Pt){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch(Pt){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,n){lo(t)&&(_o(t)||t.hasAttribute(Ko)||"function"===typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&lo(t)&&wo(t)||e.appendChild(this.cloneNode(t,n))},e.prototype.cloneChildNodes=function(e,t,n){for(var r=this,a=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;a;a=a.nextSibling)if(lo(a)&&Eo(a)&&"function"===typeof a.assignedNodes){var i=a.assignedNodes();i.length&&i.forEach(function(e){return r.appendChildNode(t,e,n)})}else this.appendChildNode(t,a,n)},e.prototype.cloneNode=function(e,t){if(oo(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&lo(e)&&(co(e)||uo(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var a=n.getComputedStyle(e),i=n.getComputedStyle(e,":before"),s=n.getComputedStyle(e,":after");this.referenceElement===e&&co(r)&&(this.clonedReferenceElement=r),go(r)&&ul(r);var o=this.counters.parse(new gi(this.context,a)),l=this.resolvePseudoContent(e,r,i,Wi.BEFORE);No(e)&&(t=!0),vo(e)||this.cloneChildNodes(e,r,t),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(e,r,s,Wi.AFTER);return c&&r.appendChild(c),this.counters.pop(o),(a&&(this.options.copyStyles||uo(e))&&!xo(e)||t)&&tl(a,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(So(e)||Co(e))&&(So(r)||Co(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var a=this;if(n){var i=n.content,s=t.ownerDocument;if(s&&i&&"none"!==i&&"-moz-alt-content"!==i&&"none"!==n.display){this.counters.parse(new gi(this.context,n));var o=new mi(this.context,n),l=s.createElement("html2canvaspseudoelement");tl(n,l),o.content.forEach(function(t){if(0===t.type)l.appendChild(s.createTextNode(t.value));else if(22===t.type){var n=s.createElement("img");n.src=t.value,n.style.opacity="1",l.appendChild(n)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Fn);r.length&&l.appendChild(s.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var i=t.values.filter(Pn),c=i[0],u=i[1];if(c&&Fn(c)){var h=a.counters.getCounterValue(c.value),d=u&&Fn(u)?Sa.parse(a.context,u.value):3;l.appendChild(s.createTextNode(Go(h,d,!1)))}}else if("counters"===t.name){var A=t.values.filter(Pn),p=(c=A[0],A[1]);if(u=A[2],c&&Fn(c)){var f=a.counters.getCounterValues(c.value),m=u&&Fn(u)?Sa.parse(a.context,u.value):3,g=p&&0===p.type?p.value:"",y=f.map(function(e){return Go(e,m,!1)}).join(g);l.appendChild(s.createTextNode(y))}}}else if(20===t.type)switch(t.value){case"open-quote":l.appendChild(s.createTextNode(ui(o.quotes,a.quoteDepth++,!0)));break;case"close-quote":l.appendChild(s.createTextNode(ui(o.quotes,--a.quoteDepth,!1)));break;default:l.appendChild(s.createTextNode(t.value))}}),l.className=ol+" "+ll;var c=r===Wi.BEFORE?" "+ol:" "+ll;return uo(t)?t.className.baseValue+=c:t.className+=c,l}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Wi||(Wi={}));var Xo,Yo=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(Ko,"true"),e.body.appendChild(n),n},Jo=function(e){return new Promise(function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()})},Zo=function(e){return Promise.all([].slice.call(e.images,0).map(Jo))},$o=function(e){return new Promise(function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var a=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval(function(){a.body.childNodes.length>0&&"complete"===a.readyState&&(clearInterval(n),t(e))},50)}})},el=["all","d","content"],tl=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===el.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},nl=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},rl=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},al=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},il=":before",sl=":after",ol="___html2canvas___pseudoelement_before",ll="___html2canvas___pseudoelement_after",cl='{\n    content: "" !important;\n    display: none !important;\n}',ul=function(e){hl(e,"."+ol+il+cl+"\n         ."+ll+sl+cl)},hl=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},dl=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Al=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:bl(e)||gl(e)?((this._cache[e]=this.loadImage(e)).catch(function(){}),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){var t,n,r,i,s=this;return a(this,function(a){switch(a.label){case 0:return t=dl.isSameOrigin(e),n=!yl(e)&&!0===this._options.useCORS&&Ss.SUPPORT_CORS_IMAGES&&!t,r=!yl(e)&&!t&&!bl(e)&&"string"===typeof this._options.proxy&&Ss.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||yl(e)||bl(e)||r||n?(i=e,r?[4,this.proxy(i)]:[3,2]):[2];case 1:i=a.sent(),a.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(vl(i)||n)&&(r.crossOrigin="anonymous"),r.src=i,!0===r.complete&&setTimeout(function(){return e(r)},500),s._options.imageTimeout>0&&setTimeout(function(){return t("Timed out ("+s._options.imageTimeout+"ms) loading image")},s._options.imageTimeout)})];case 3:return[2,a.sent()]}})})},e.prototype.has=function(e){return"undefined"!==typeof this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise(function(a,i){var s=Ss.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(200===o.status)if("text"===s)a(o.response);else{var e=new FileReader;e.addEventListener("load",function(){return a(e.result)},!1),e.addEventListener("error",function(e){return i(e)},!1),e.readAsDataURL(o.response)}else i("Failed to proxy resource "+r+" with status code "+o.status)},o.onerror=i;var l=n.indexOf("?")>-1?"&":"?";if(o.open("GET",""+n+l+"url="+encodeURIComponent(e)+"&responseType="+s),"text"!==s&&o instanceof XMLHttpRequest&&(o.responseType=s),t._options.imageTimeout){var c=t._options.imageTimeout;o.timeout=c,o.ontimeout=function(){return i("Timed out ("+c+"ms) proxying "+r)}}o.send()})},e}(),pl=/^data:image\/svg\+xml/i,fl=/^data:image\/.*;base64,/i,ml=/^data:image\/.*/i,gl=function(e){return Ss.SUPPORT_SVG_DRAWING||!xl(e)},yl=function(e){return ml.test(e)},vl=function(e){return fl.test(e)},bl=function(e){return"blob"===e.substr(0,4)},xl=function(e){return"svg"===e.substr(-3).toLowerCase()||pl.test(e)},wl=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),_l=function(e,t,n){return new wl(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},Sl=function(){function e(e,t,n,r){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=_l(this.start,this.startControl,t),a=_l(this.startControl,this.endControl,t),i=_l(this.endControl,this.end,t),s=_l(r,a,t),o=_l(a,i,t),l=_l(s,o,t);return n?new e(this.start,r,s,l):new e(l,o,i,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Cl=function(e){return 1===e.type},El=function(){function e(e){var t=e.styles,n=e.bounds,r=Gn(t.borderTopLeftRadius,n.width,n.height),a=r[0],i=r[1],s=Gn(t.borderTopRightRadius,n.width,n.height),o=s[0],l=s[1],c=Gn(t.borderBottomRightRadius,n.width,n.height),u=c[0],h=c[1],d=Gn(t.borderBottomLeftRadius,n.width,n.height),A=d[0],p=d[1],f=[];f.push((a+o)/n.width),f.push((A+u)/n.width),f.push((i+p)/n.height),f.push((l+h)/n.height);var m=Math.max.apply(Math,f);m>1&&(a/=m,i/=m,o/=m,l/=m,u/=m,h/=m,A/=m,p/=m);var g=n.width-o,y=n.height-h,v=n.width-u,b=n.height-p,x=t.borderTopWidth,w=t.borderRightWidth,_=t.borderBottomWidth,S=t.borderLeftWidth,C=Kn(t.paddingTop,e.bounds.width),E=Kn(t.paddingRight,e.bounds.width),N=Kn(t.paddingBottom,e.bounds.width),B=Kn(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=a>0||i>0?Nl(n.left+S/3,n.top+x/3,a-S/3,i-x/3,Xo.TOP_LEFT):new wl(n.left+S/3,n.top+x/3),this.topRightBorderDoubleOuterBox=a>0||i>0?Nl(n.left+g,n.top+x/3,o-w/3,l-x/3,Xo.TOP_RIGHT):new wl(n.left+n.width-w/3,n.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||h>0?Nl(n.left+v,n.top+y,u-w/3,h-_/3,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w/3,n.top+n.height-_/3),this.bottomLeftBorderDoubleOuterBox=A>0||p>0?Nl(n.left+S/3,n.top+b,A-S/3,p-_/3,Xo.BOTTOM_LEFT):new wl(n.left+S/3,n.top+n.height-_/3),this.topLeftBorderDoubleInnerBox=a>0||i>0?Nl(n.left+2*S/3,n.top+2*x/3,a-2*S/3,i-2*x/3,Xo.TOP_LEFT):new wl(n.left+2*S/3,n.top+2*x/3),this.topRightBorderDoubleInnerBox=a>0||i>0?Nl(n.left+g,n.top+2*x/3,o-2*w/3,l-2*x/3,Xo.TOP_RIGHT):new wl(n.left+n.width-2*w/3,n.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||h>0?Nl(n.left+v,n.top+y,u-2*w/3,h-2*_/3,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-2*w/3,n.top+n.height-2*_/3),this.bottomLeftBorderDoubleInnerBox=A>0||p>0?Nl(n.left+2*S/3,n.top+b,A-2*S/3,p-2*_/3,Xo.BOTTOM_LEFT):new wl(n.left+2*S/3,n.top+n.height-2*_/3),this.topLeftBorderStroke=a>0||i>0?Nl(n.left+S/2,n.top+x/2,a-S/2,i-x/2,Xo.TOP_LEFT):new wl(n.left+S/2,n.top+x/2),this.topRightBorderStroke=a>0||i>0?Nl(n.left+g,n.top+x/2,o-w/2,l-x/2,Xo.TOP_RIGHT):new wl(n.left+n.width-w/2,n.top+x/2),this.bottomRightBorderStroke=u>0||h>0?Nl(n.left+v,n.top+y,u-w/2,h-_/2,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w/2,n.top+n.height-_/2),this.bottomLeftBorderStroke=A>0||p>0?Nl(n.left+S/2,n.top+b,A-S/2,p-_/2,Xo.BOTTOM_LEFT):new wl(n.left+S/2,n.top+n.height-_/2),this.topLeftBorderBox=a>0||i>0?Nl(n.left,n.top,a,i,Xo.TOP_LEFT):new wl(n.left,n.top),this.topRightBorderBox=o>0||l>0?Nl(n.left+g,n.top,o,l,Xo.TOP_RIGHT):new wl(n.left+n.width,n.top),this.bottomRightBorderBox=u>0||h>0?Nl(n.left+v,n.top+y,u,h,Xo.BOTTOM_RIGHT):new wl(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=A>0||p>0?Nl(n.left,n.top+b,A,p,Xo.BOTTOM_LEFT):new wl(n.left,n.top+n.height),this.topLeftPaddingBox=a>0||i>0?Nl(n.left+S,n.top+x,Math.max(0,a-S),Math.max(0,i-x),Xo.TOP_LEFT):new wl(n.left+S,n.top+x),this.topRightPaddingBox=o>0||l>0?Nl(n.left+Math.min(g,n.width-w),n.top+x,g>n.width+w?0:Math.max(0,o-w),Math.max(0,l-x),Xo.TOP_RIGHT):new wl(n.left+n.width-w,n.top+x),this.bottomRightPaddingBox=u>0||h>0?Nl(n.left+Math.min(v,n.width-S),n.top+Math.min(y,n.height-_),Math.max(0,u-w),Math.max(0,h-_),Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w,n.top+n.height-_),this.bottomLeftPaddingBox=A>0||p>0?Nl(n.left+S,n.top+Math.min(b,n.height-_),Math.max(0,A-S),Math.max(0,p-_),Xo.BOTTOM_LEFT):new wl(n.left+S,n.top+n.height-_),this.topLeftContentBox=a>0||i>0?Nl(n.left+S+B,n.top+x+C,Math.max(0,a-(S+B)),Math.max(0,i-(x+C)),Xo.TOP_LEFT):new wl(n.left+S+B,n.top+x+C),this.topRightContentBox=o>0||l>0?Nl(n.left+Math.min(g,n.width+S+B),n.top+x+C,g>n.width+S+B?0:o-S+B,l-(x+C),Xo.TOP_RIGHT):new wl(n.left+n.width-(w+E),n.top+x+C),this.bottomRightContentBox=u>0||h>0?Nl(n.left+Math.min(v,n.width-(S+B)),n.top+Math.min(y,n.height+x+C),Math.max(0,u-(w+E)),h-(_+N),Xo.BOTTOM_RIGHT):new wl(n.left+n.width-(w+E),n.top+n.height-(_+N)),this.bottomLeftContentBox=A>0||p>0?Nl(n.left+S+B,n.top+b,Math.max(0,A-(S+B)),p-(_+N),Xo.BOTTOM_LEFT):new wl(n.left+S+B,n.top+n.height-(_+N))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Xo||(Xo={}));var Nl=function(e,t,n,r,a){var i=(Math.sqrt(2)-1)/3*4,s=n*i,o=r*i,l=e+n,c=t+r;switch(a){case Xo.TOP_LEFT:return new Sl(new wl(e,c),new wl(e,c-o),new wl(l-s,t),new wl(l,t));case Xo.TOP_RIGHT:return new Sl(new wl(e,t),new wl(e+s,t),new wl(l,c-o),new wl(l,c));case Xo.BOTTOM_RIGHT:return new Sl(new wl(l,t),new wl(l,t+o),new wl(e+s,c),new wl(e,c));case Xo.BOTTOM_LEFT:default:return new Sl(new wl(l,c),new wl(l-s,c),new wl(e,t+o),new wl(e,t))}},Bl=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},kl=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},Il=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Tl=function(){function e(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return e}(),Ml=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),Fl=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),Rl=function(e){return 0===e.type},Ll=function(e){return 1===e.type},Ul=function(e){return 2===e.type},Pl=function(e,t){return e.length===t.length&&e.some(function(e,n){return e===t[n]})},Dl=function(e,t,n,r,a){return e.map(function(e,i){switch(i){case 0:return e.add(t,n);case 1:return e.add(t+r,n);case 2:return e.add(t+r,n+a);case 3:return e.add(t,n+a)}return e})},Ol=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),zl=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new El(this.container),this.container.styles.opacity<1&&this.effects.push(new Fl(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,a=this.container.styles.transform;this.effects.push(new Tl(n,r,a))}if(0!==this.container.styles.overflowX){var i=Bl(this.curves),s=Il(this.curves);Pl(i,s)?this.effects.push(new Ml(i,6)):(this.effects.push(new Ml(i,2)),this.effects.push(new Ml(s,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,r=this.effects.slice(0);n;){var a=n.effects.filter(function(e){return!Ll(e)});if(t||0!==n.container.styles.position||!n.parent){if(r.unshift.apply(r,a),t=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var i=Bl(n.curves),s=Il(n.curves);Pl(i,s)||r.unshift(new Ml(s,6))}}else r.unshift.apply(r,a);n=n.parent}return r.filter(function(t){return ai(t.target,e)})},e}(),Hl=function(e,t,n,r){e.container.elements.forEach(function(a){var i=ai(a.flags,4),s=ai(a.flags,2),o=new zl(a,e);ai(a.styles.display,2048)&&r.push(o);var l=ai(a.flags,8)?[]:r;if(i||s){var c=i||a.styles.isPositioned()?n:t,u=new Ol(o);if(a.styles.isPositioned()||a.styles.opacity<1||a.styles.isTransformed()){var h=a.styles.zIndex.order;if(h<0){var d=0;c.negativeZIndex.some(function(e,t){return h>e.element.container.styles.zIndex.order?(d=t,!1):d>0}),c.negativeZIndex.splice(d,0,u)}else if(h>0){var A=0;c.positiveZIndex.some(function(e,t){return h>=e.element.container.styles.zIndex.order?(A=t+1,!1):A>0}),c.positiveZIndex.splice(A,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else a.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);Hl(o,u,i?u:n,l)}else a.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),Hl(o,t,n,l);ai(a.flags,8)&&jl(a,l)})},jl=function(e,t){for(var n=e instanceof js?e.start:1,r=e instanceof js&&e.reversed,a=0;a<t.length;a++){var i=t[a];i.container instanceof Hs&&"number"===typeof i.container.value&&0!==i.container.value&&(n=i.container.value),i.listValue=Go(n,i.container.styles.listStyleType,!0),n+=r?-1:1}},Ql=function(e){var t=new zl(e,null),n=new Ol(t),r=[];return Hl(t,n,n,r),jl(t.container,r),n},Vl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Xl(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Xl(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Xl(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Wl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Xl(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Xl(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Xl(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},Gl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Xl(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Xl(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Xl(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},Kl=function(e,t){switch(t){case 0:return ql(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return ql(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return ql(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return ql(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},ql=function(e,t){var n=[];return Cl(e)?n.push(e.subdivide(.5,!1)):n.push(e),Cl(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},Xl=function(e,t,n,r){var a=[];return Cl(e)?a.push(e.subdivide(.5,!1)):a.push(e),Cl(n)?a.push(n.subdivide(.5,!0)):a.push(n),Cl(r)?a.push(r.subdivide(.5,!0).reverse()):a.push(r),Cl(t)?a.push(t.subdivide(.5,!1).reverse()):a.push(t),a},Yl=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},Jl=function(e){var t=e.styles,n=e.bounds,r=Kn(t.paddingLeft,n.width),a=Kn(t.paddingRight,n.width),i=Kn(t.paddingTop,n.width),s=Kn(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,i+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+a),-(t.borderTopWidth+t.borderBottomWidth+i+s))},Zl=function(e,t){return 0===e?t.bounds:2===e?Jl(t):Yl(t)},$l=function(e,t){return 0===e?t.bounds:2===e?Jl(t):Yl(t)},ec=function(e,t,n){var r=Zl(ac(e.styles.backgroundOrigin,t),e),a=$l(ac(e.styles.backgroundClip,t),e),i=rc(ac(e.styles.backgroundSize,t),n,r),s=i[0],o=i[1],l=Gn(ac(e.styles.backgroundPosition,t),r.width-s,r.height-o);return[ic(ac(e.styles.backgroundRepeat,t),l,i,r,a),Math.round(r.left+l[0]),Math.round(r.top+l[1]),s,o]},tc=function(e){return Fn(e)&&e.value===Ur.AUTO},nc=function(e){return"number"===typeof e},rc=function(e,t,n){var r=t[0],a=t[1],i=t[2],s=e[0],o=e[1];if(!s)return[0,0];if(Hn(s)&&o&&Hn(o))return[Kn(s,n.width),Kn(o,n.height)];var l=nc(i);if(Fn(s)&&(s.value===Ur.CONTAIN||s.value===Ur.COVER))return nc(i)?n.width/n.height<i!==(s.value===Ur.COVER)?[n.width,n.width/i]:[n.height*i,n.height]:[n.width,n.height];var c=nc(r),u=nc(a),h=c||u;if(tc(s)&&(!o||tc(o)))return c&&u?[r,a]:l||h?h&&l?[c?r:a*i,u?a:r/i]:[c?r:n.width,u?a:n.height]:[n.width,n.height];if(l){var d=0,A=0;return Hn(s)?d=Kn(s,n.width):Hn(o)&&(A=Kn(o,n.height)),tc(s)?d=A*i:o&&!tc(o)||(A=d/i),[d,A]}var p=null,f=null;if(Hn(s)?p=Kn(s,n.width):o&&Hn(o)&&(f=Kn(o,n.height)),null===p||o&&!tc(o)||(f=c&&u?p/r*a:n.height),null!==f&&tc(s)&&(p=c&&u?f/a*r:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},ac=function(e,t){var n=e[t];return"undefined"===typeof n?e[0]:n},ic=function(e,t,n,r,a){var i=t[0],s=t[1],o=n[0],l=n[1];switch(e){case 2:return[new wl(Math.round(r.left),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(l+r.top+s)),new wl(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new wl(Math.round(r.left+i),Math.round(r.top)),new wl(Math.round(r.left+i+o),Math.round(r.top)),new wl(Math.round(r.left+i+o),Math.round(r.height+r.top)),new wl(Math.round(r.left+i),Math.round(r.height+r.top))];case 1:return[new wl(Math.round(r.left+i),Math.round(r.top+s)),new wl(Math.round(r.left+i+o),Math.round(r.top+s)),new wl(Math.round(r.left+i+o),Math.round(r.top+s+l)),new wl(Math.round(r.left+i),Math.round(r.top+s+l))];default:return[new wl(Math.round(a.left),Math.round(a.top)),new wl(Math.round(a.left+a.width),Math.round(a.top)),new wl(Math.round(a.left+a.width),Math.round(a.height+a.top)),new wl(Math.round(a.left),Math.round(a.height+a.top))]}},sc="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",oc="Hidden Text",lc=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),a=this._document.createElement("span"),i=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",i.appendChild(n),r.src=sc,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",a.style.fontFamily=e,a.style.fontSize=t,a.style.margin="0",a.style.padding="0",a.appendChild(this._document.createTextNode(oc)),n.appendChild(a),n.appendChild(r);var s=r.offsetTop-a.offsetTop+2;n.removeChild(a),n.appendChild(this._document.createTextNode(oc)),n.style.lineHeight="normal",r.style.verticalAlign="super";var o=r.offsetTop-n.offsetTop+2;return i.removeChild(n),{baseline:s,middle:o}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return"undefined"===typeof this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),cc=function(){function e(e,t){this.context=e,this.options=t}return e}(),uc=1e4,hc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new lc(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach(function(e){return t.applyEffect(e)})},n.prototype.applyEffect=function(e){this.ctx.save(),Ul(e)&&(this.ctx.globalAlpha=e.opacity),Rl(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Ll(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.renderNode=function(e){return r(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return ai(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):ks(e.text).reduce(function(t,a){return r.ctx.fillText(a,t,e.bounds.top+n),t+r.ctx.measureText(a).width},e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return"normal"===e||"small-caps"===e}).join(""),n=mc(e.fontFamily).join(", "),r=Tn(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,function(){var n,r,i,s,o,l,c,u,h=this;return a(this,function(a){return n=this.createFontStyle(t),r=n[0],i=n[1],s=n[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",o=this.fontMetrics.getMetrics(i,s),l=o.baseline,c=o.middle,u=t.paintOrder,e.textBounds.forEach(function(e){u.forEach(function(n){switch(n){case 0:h.ctx.fillStyle=ar(t.color),h.renderTextWithLetterSpacing(e,t.letterSpacing,l);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach(function(n){h.ctx.shadowColor=ar(n.color),h.ctx.shadowOffsetX=n.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=n.offsetY.number*h.options.scale,h.ctx.shadowBlur=n.blur.number,h.renderTextWithLetterSpacing(e,t.letterSpacing,l)}),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),t.textDecorationLine.length&&(h.ctx.fillStyle=ar(t.textDecorationColor||t.color),t.textDecorationLine.forEach(function(t){switch(t){case 1:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+l),e.bounds.width,1);break;case 2:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:h.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+c),e.bounds.width,1)}}));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(h.ctx.strokeStyle=ar(t.webkitTextStrokeColor),h.ctx.lineWidth=t.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+l)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}})}),[2]})})},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=Jl(e),a=Il(t);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,function(){var t,r,i,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x;return a(this,function(a){switch(a.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,r=e.curves,i=t.styles,o=0,l=t.textNodes,a.label=1;case 1:return o<l.length?(c=l[o],[4,this.renderTextNode(c,i)]):[3,4];case 2:a.sent(),a.label=3;case 3:return o++,[3,1];case 4:if(!(t instanceof Ds))return[3,8];a.label=5;case 5:return a.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return y=a.sent(),this.renderReplacedElement(t,r,y),[3,8];case 7:return a.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Os&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof zs))return[3,12];a.label=9;case 9:return a.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return y=a.sent(),this.renderReplacedElement(t,r,y),[3,12];case 11:return a.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof eo&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:u=a.sent(),t.width&&t.height&&this.ctx.drawImage(u,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),a.label=14;case 14:if(t instanceof Js&&(h=Math.min(t.bounds.width,t.bounds.height),t.type===Ks?t.checked&&(this.ctx.save(),this.path([new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h),new wl(t.bounds.left+.16*h,t.bounds.top+.5549*h),new wl(t.bounds.left+.27347*h,t.bounds.top+.44071*h),new wl(t.bounds.left+.39694*h,t.bounds.top+.5649*h),new wl(t.bounds.left+.72983*h,t.bounds.top+.23*h),new wl(t.bounds.left+.84*h,t.bounds.top+.34085*h),new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h)]),this.ctx.fillStyle=ar(Ys),this.ctx.fill(),this.ctx.restore()):t.type===qs&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+h/2,t.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=ar(Ys),this.ctx.fill(),this.ctx.restore())),dc(t)&&t.value.length){switch(d=this.createFontStyle(i),b=d[0],A=d[1],p=this.fontMetrics.getMetrics(b,A).baseline,this.ctx.font=b,this.ctx.fillStyle=ar(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=pc(t.styles.textAlign),x=Jl(t),f=0,t.styles.textAlign){case 1:f+=x.width/2;break;case 2:f+=x.width}m=x.add(f,0,0,-x.height/2+1),this.ctx.save(),this.path([new wl(x.left,x.top),new wl(x.left+x.width,x.top),new wl(x.left+x.width,x.top+x.height),new wl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Cs(t.value,m),i.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ai(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(g=t.styles.listStyleImage).type)return[3,18];y=void 0,v=g.url,a.label=15;case 15:return a.trys.push([15,17,,18]),[4,this.context.cache.match(v)];case 16:return y=a.sent(),this.ctx.drawImage(y,t.bounds.left-(y.width+10),t.bounds.top),[3,18];case 17:return a.sent(),this.context.logger.error("Error loading list-style-image "+v),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(b=this.createFontStyle(i)[0],this.ctx.font=b,this.ctx.fillStyle=ar(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new s(t.bounds.left,t.bounds.top+Kn(t.styles.paddingTop,t.bounds.width),t.bounds.width,xa(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Cs(e.listValue,x),i.letterSpacing,xa(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),a.label=20;case 20:return[2]}})})},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,function(){var t,n,r,i,s,o,l,c,u,h,d,A,p,f,m;return a(this,function(a){switch(a.label){case 0:return ai(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:a.sent(),t=0,n=e.negativeZIndex,a.label=2;case 2:return t<n.length?(m=n[t],[4,this.renderStack(m)]):[3,5];case 3:a.sent(),a.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:a.sent(),r=0,i=e.nonInlineLevel,a.label=7;case 7:return r<i.length?(m=i[r],[4,this.renderNode(m)]):[3,10];case 8:a.sent(),a.label=9;case 9:return r++,[3,7];case 10:s=0,o=e.nonPositionedFloats,a.label=11;case 11:return s<o.length?(m=o[s],[4,this.renderStack(m)]):[3,14];case 12:a.sent(),a.label=13;case 13:return s++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,a.label=15;case 15:return l<c.length?(m=c[l],[4,this.renderStack(m)]):[3,18];case 16:a.sent(),a.label=17;case 17:return l++,[3,15];case 18:u=0,h=e.inlineLevel,a.label=19;case 19:return u<h.length?(m=h[u],[4,this.renderNode(m)]):[3,22];case 20:a.sent(),a.label=21;case 21:return u++,[3,19];case 22:d=0,A=e.zeroOrAutoZIndexOrTransformedOrOpacity,a.label=23;case 23:return d<A.length?(m=A[d],[4,this.renderStack(m)]):[3,26];case 24:a.sent(),a.label=25;case 25:return d++,[3,23];case 26:p=0,f=e.positiveZIndex,a.label=27;case 27:return p<f.length?(m=f[p],[4,this.renderStack(m)]):[3,30];case 28:a.sent(),a.label=29;case 29:return p++,[3,27];case 30:return[2]}})})},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach(function(e,n){var r=Cl(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),Cl(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var a=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return a.width=Math.max(1,t),a.height=Math.max(1,n),a.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),a},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,function(){var t,n,r,i,s,o;return a(this,function(l){switch(l.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var i,s,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S,C,E,N,B,k,I,T,M,F,R,L;return a(this,function(a){switch(a.label){case 0:if(0!==n.type)return[3,5];i=void 0,s=n.url,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return i=a.sent(),[3,4];case 3:return a.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return i&&(o=ec(e,t,[i.width,i.height,i.width/i.height]),b=o[0],E=o[1],N=o[2],_=o[3],S=o[4],y=r.ctx.createPattern(r.resizeImage(i,_,S),"repeat"),r.renderRepeat(b,y,E,N)),[3,6];case 5:Mr(n)?(l=ec(e,t,[null,null,null]),b=l[0],E=l[1],N=l[2],_=l[3],S=l[4],c=yr(n.angle,_,S),u=c[0],h=c[1],d=c[2],A=c[3],p=c[4],(f=document.createElement("canvas")).width=_,f.height=S,m=f.getContext("2d"),g=m.createLinearGradient(h,A,d,p),mr(n.stops,u).forEach(function(e){return g.addColorStop(e.stop,ar(e.color))}),m.fillStyle=g,m.fillRect(0,0,_,S),_>0&&S>0&&(y=r.ctx.createPattern(f,"repeat"),r.renderRepeat(b,y,E,N))):Fr(n)&&(v=ec(e,t,[null,null,null]),b=v[0],x=v[1],w=v[2],_=v[3],S=v[4],C=0===n.position.length?[Vn]:n.position,E=Kn(C[0],_),N=Kn(C[C.length-1],S),B=xr(n,E,N,_,S),k=B[0],I=B[1],k>0&&I>0&&(T=r.ctx.createRadialGradient(x+E,w+N,0,x+E,w+N,k),mr(n.stops,2*k).forEach(function(e){return T.addColorStop(e.stop,ar(e.color))}),r.path(b),r.ctx.fillStyle=T,k!==I?(M=e.bounds.left+.5*e.bounds.width,F=e.bounds.top+.5*e.bounds.height,L=1/(R=I/k),r.ctx.save(),r.ctx.translate(M,F),r.ctx.transform(1,0,0,R,0,0),r.ctx.translate(-M,-F),r.ctx.fillRect(x,L*(w-F)+F,_,S*L),r.ctx.restore()):r.ctx.fill())),a.label=6;case 6:return t--,[2]}})},r=this,i=0,s=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return i<s.length?(o=s[i],[5,n(o)]):[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,function(){return a(this,function(r){return this.path(Vl(n,t)),this.ctx.fillStyle=ar(e),this.ctx.fill(),[2]})})},n.prototype.renderDoubleBorder=function(e,t,n,i){return r(this,void 0,void 0,function(){var r,s;return a(this,function(a){switch(a.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,i)]:[3,2];case 1:return a.sent(),[2];case 2:return r=Wl(i,n),this.path(r),this.ctx.fillStyle=ar(e),this.ctx.fill(),s=Gl(i,n),this.path(s),this.ctx.fill(),[2]}})})},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,function(){var t,n,r,i,s,o,l,c,u=this;return a(this,function(a){switch(a.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!rr(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],i=Ac(ac(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(i),this.ctx.clip(),rr(t.backgroundColor)||(this.ctx.fillStyle=ar(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:a.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach(function(t){u.ctx.save();var n=Bl(e.curves),r=t.inset?0:uc,a=Dl(n,-r+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(u.path(n),u.ctx.clip(),u.mask(a)):(u.mask(n),u.ctx.clip(),u.path(a)),u.ctx.shadowOffsetX=t.offsetX.number+r,u.ctx.shadowOffsetY=t.offsetY.number,u.ctx.shadowColor=ar(t.color),u.ctx.shadowBlur=t.blur.number,u.ctx.fillStyle=t.inset?ar(t.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()}),a.label=2;case 2:s=0,o=0,l=r,a.label=3;case 3:return o<l.length?0!==(c=l[o]).style&&!rr(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,2)]:[3,11]:[3,13];case 4:return a.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,3)];case 6:return a.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,s,e.curves)];case 8:return a.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,s,e.curves)];case 10:a.sent(),a.label=11;case 11:s++,a.label=12;case 12:return o++,[3,3];case 13:return[2]}})})},n.prototype.renderDashedDottedBorder=function(e,t,n,i,s){return r(this,void 0,void 0,function(){var r,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x;return a(this,function(a){return this.ctx.save(),r=Kl(i,n),o=Vl(i,n),2===s&&(this.path(o),this.ctx.clip()),Cl(o[0])?(l=o[0].start.x,c=o[0].start.y):(l=o[0].x,c=o[0].y),Cl(o[1])?(u=o[1].end.x,h=o[1].end.y):(u=o[1].x,h=o[1].y),d=0===n||2===n?Math.abs(l-u):Math.abs(c-h),this.ctx.beginPath(),3===s?this.formatPath(r):this.formatPath(o.slice(0,2)),A=t<3?3*t:2*t,p=t<3?2*t:t,3===s&&(A=t,p=t),f=!0,d<=2*A?f=!1:d<=2*A+p?(A*=m=d/(2*A+p),p*=m):(g=Math.floor((d+p)/(A+p)),y=(d-g*A)/(g-1),p=(v=(d-(g+1)*A)/g)<=0||Math.abs(p-y)<Math.abs(p-v)?y:v),f&&(3===s?this.ctx.setLineDash([0,A+p]):this.ctx.setLineDash([A,p])),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=ar(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Cl(o[0])&&(b=o[3],x=o[0],this.ctx.beginPath(),this.formatPath([new wl(b.end.x,b.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke()),Cl(o[1])&&(b=o[1],x=o[2],this.ctx.beginPath(),this.formatPath([new wl(b.end.x,b.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},n.prototype.render=function(e){return r(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ar(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=Ql(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},n}(cc),dc=function(e){return e instanceof $s||e instanceof Zs||e instanceof Js&&e.type!==qs&&e.type!==Ks},Ac=function(e,t){switch(e){case 0:return Bl(t);case 2:return kl(t);default:return Il(t)}},pc=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},fc=["-apple-system","system-ui"],mc=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(e){return-1===fc.indexOf(e)}):e},gc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,function(){var t,n;return a(this,function(r){switch(r.label){case 0:return t=ws(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,yc(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ar(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},n}(cc),yc=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},vc=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.debug?console.debug.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!==typeof window&&window.console&&"function"===typeof console.info&&console.info.apply(console,i([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.warn?console.warn.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.error?console.error.apply(console,i([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),bc=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new vc({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new Al(this,t)}return e.instanceCount=1,e}(),xc=function(e,t){return void 0===t&&(t={}),wc(e,t)};"undefined"!==typeof window&&dl.setContext(window);var wc=function(e,t){return r(void 0,void 0,void 0,function(){var r,i,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S,C,E,N,B,k,I,T,M,F,R,L,U,P,D,O,z,H,j,Q,V;return a(this,function(a){switch(a.label){case 0:if(!e||"object"!==typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(i=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(B=t.allowTaint)&&void 0!==B&&B,imageTimeout:null!==(k=t.imageTimeout)&&void 0!==k?k:15e3,proxy:t.proxy,useCORS:null!==(I=t.useCORS)&&void 0!==I&&I},u=n({logging:null===(T=t.logging)||void 0===T||T,cache:t.cache},c),h={windowWidth:null!==(M=t.windowWidth)&&void 0!==M?M:i.innerWidth,windowHeight:null!==(F=t.windowHeight)&&void 0!==F?F:i.innerHeight,scrollX:null!==(R=t.scrollX)&&void 0!==R?R:i.pageXOffset,scrollY:null!==(L=t.scrollY)&&void 0!==L?L:i.pageYOffset},d=new s(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),A=new bc(u,d),p=null!==(U=t.foreignObjectRendering)&&void 0!==U&&U,f={allowTaint:null!==(P=t.allowTaint)&&void 0!==P&&P,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:p,copyStyles:p},A.logger.debug("Starting document clone with size "+d.width+"x"+d.height+" scrolled to "+-d.left+","+-d.top),m=new qo(A,e,f),(g=m.clonedReferenceElement)?[4,m.toIFrame(r,d)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return y=a.sent(),v=go(g)||fo(g)?l(g.ownerDocument):o(A,g),b=v.width,x=v.height,w=v.left,_=v.top,S=_c(A,g,t.backgroundColor),C={canvas:t.canvas,backgroundColor:S,scale:null!==(O=null!==(D=t.scale)&&void 0!==D?D:i.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(z=t.x)&&void 0!==z?z:0)+w,y:(null!==(H=t.y)&&void 0!==H?H:0)+_,width:null!==(j=t.width)&&void 0!==j?j:Math.ceil(b),height:null!==(Q=t.height)&&void 0!==Q?Q:Math.ceil(x)},p?(A.logger.debug("Document cloned, using foreign object rendering"),[4,new gc(A,C).render(g)]):[3,3];case 2:return E=a.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+w+","+_+" with size "+b+"x"+x+" using computed rendering"),A.logger.debug("Starting DOM parsing"),N=ao(A,g),S===N.styles.backgroundColor&&(N.styles.backgroundColor=dr.TRANSPARENT),A.logger.debug("Starting renderer for element at "+C.x+","+C.y+" with size "+C.width+"x"+C.height),[4,new hc(A,C).render(N)];case 4:E=a.sent(),a.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(qo.destroy(y)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,E]}})})},_c=function(e,t,n){var r=t.ownerDocument,a=r.documentElement?hr(e,getComputedStyle(r.documentElement).backgroundColor):dr.TRANSPARENT,i=r.body?hr(e,getComputedStyle(r.body).backgroundColor):dr.TRANSPARENT,s="string"===typeof n?hr(e,n):null===n?dr.TRANSPARENT:4294967295;return t===r.documentElement?rr(a)?rr(i)?s:i:a:s};return xc}()},5262:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.tychei=o}(0,e=n.nmd(e),n.amdD)},5817:()=>{},6288:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,s,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),a=0,i=-32;i<l;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(s=s+1640531527|0,a=0==(n=o[127&i]^=r+s)?a+1:0);for(a>=128&&(o[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=o[a+34&127],n=o[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[a]=r^n;e.w=s,e.X=o,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.xor4096=o}(0,e=n.nmd(e),n.amdD)},6958:(e,t,n)=>{e.exports=function(e){var t={},r=n(5043),a=n(8513),i=Object.assign;function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),v=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var b=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var x=Symbol.iterator;function w(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=x&&e[x]||e["@@iterator"])?e:null}function _(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case f:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:_(e.type)||"Memo";case v:t=e._payload,e=e._init;try{return _(e(t))}catch(n){}}return null}function S(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function C(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function E(e){if(C(e)!==e)throw Error(s(188))}function N(e){var t=e.alternate;if(!t){if(null===(t=C(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return E(a),e;if(i===r)return E(a),t;i=i.sibling}throw Error(s(188))}if(n.return!==r.return)n=a,r=i;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}function B(e){return null!==(e=N(e))?k(e):null}function k(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=k(e);if(null!==t)return t;e=e.sibling}return null}function I(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=I(e);if(null!==t)return t}e=e.sibling}return null}var T,M=Array.isArray,F=e.getPublicInstance,R=e.getRootHostContext,L=e.getChildHostContext,U=e.prepareForCommit,P=e.resetAfterCommit,D=e.createInstance,O=e.appendInitialChild,z=e.finalizeInitialChildren,H=e.prepareUpdate,j=e.shouldSetTextContent,Q=e.createTextInstance,V=e.scheduleTimeout,W=e.cancelTimeout,G=e.noTimeout,K=e.isPrimaryRenderer,q=e.supportsMutation,X=e.supportsPersistence,Y=e.supportsHydration,J=e.getInstanceFromNode,Z=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ae=e.findFiberRoot,ie=e.getBoundingRect,se=e.getTextContent,oe=e.isHiddenSubtree,le=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,he=e.appendChild,de=e.appendChildToContainer,Ae=e.commitTextUpdate,pe=e.commitMount,fe=e.commitUpdate,me=e.insertBefore,ge=e.insertInContainerBefore,ye=e.removeChild,ve=e.removeChildFromContainer,be=e.resetTextContent,xe=e.hideInstance,we=e.hideTextInstance,_e=e.unhideInstance,Se=e.unhideTextInstance,Ce=e.clearContainer,Ee=e.cloneInstance,Ne=e.createContainerChildSet,Be=e.appendChildToContainerChildSet,ke=e.finalizeContainerChildren,Ie=e.replaceContainerChildren,Te=e.cloneHiddenInstance,Me=e.cloneHiddenTextInstance,Fe=e.canHydrateInstance,Re=e.canHydrateTextInstance,Le=e.canHydrateSuspenseInstance,Ue=e.isSuspenseInstancePending,Pe=e.isSuspenseInstanceFallback,De=e.registerSuspenseInstanceRetry,Oe=e.getNextHydratableSibling,ze=e.getFirstHydratableChild,He=e.getFirstHydratableChildWithinContainer,je=e.getFirstHydratableChildWithinSuspenseInstance,Qe=e.hydrateInstance,Ve=e.hydrateTextInstance,We=e.hydrateSuspenseInstance,Ge=e.getNextHydratableInstanceAfterSuspenseInstance,Ke=e.commitHydratedContainer,qe=e.commitHydratedSuspenseInstance,Xe=e.clearSuspenseBoundary,Ye=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,Ze=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===T)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);T=t&&t[1]||""}return"\n"+T+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),s=a.length-1,o=i.length-1;1<=s&&0<=o&&a[s]!==i[o];)o--;for(;1<=s&&0<=o;s--,o--)if(a[s]!==i[o]){if(1!==s||1!==o)do{if(s--,0>--o||a[s]!==i[o]){var l="\n"+a[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,at=[],it=-1;function st(e){return{current:e}}function ot(e){0>it||(e.current=at[it],at[it]=null,it--)}function lt(e,t){it++,at[it]=e.current,e.current=t}var ct={},ut=st(ct),ht=st(!1),dt=ct;function At(e,t){var n=e.type.contextTypes;if(!n)return ct;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ft(){ot(ht),ot(ut)}function mt(e,t,n){if(ut.current!==ct)throw Error(s(168));lt(ut,t),lt(ht,n)}function gt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(s(108,S(e)||"Unknown",a));return i({},n,r)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,dt=ut.current,lt(ut,e),lt(ht,ht.current),!0}function vt(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=gt(e,t,dt),r.__reactInternalMemoizedMergedChildContext=e,ot(ht),ot(ut),lt(ut,e)):ot(ht),lt(ht,n)}var bt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xt(e)/wt|0)|0},xt=Math.log,wt=Math.LN2;var _t=64,St=4194304;function Ct(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Et(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~a;0!==o?r=Ct(o):0!==(i&=s)&&(r=Ct(i))}else 0!==(s=n&~a)?r=Ct(s):0!==i&&(r=Ct(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-bt(t)),r|=e[n],t&=~a;return r}function Nt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function kt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function It(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-bt(t)]=n}function Tt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-bt(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Mt=0;function Ft(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Rt=a.unstable_scheduleCallback,Lt=a.unstable_cancelCallback,Ut=a.unstable_shouldYield,Pt=a.unstable_requestPaint,Dt=a.unstable_now,Ot=a.unstable_ImmediatePriority,zt=a.unstable_UserBlockingPriority,Ht=a.unstable_NormalPriority,jt=a.unstable_IdlePriority,Qt=null,Vt=null;var Wt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Gt=null,Kt=!1,qt=!1;function Xt(e){null===Gt?Gt=[e]:Gt.push(e)}function Yt(){if(!qt&&null!==Gt){qt=!0;var e=0,t=Mt;try{var n=Gt;for(Mt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Gt=null,Kt=!1}catch(a){throw null!==Gt&&(Gt=Gt.slice(e+1)),Rt(Ot,Yt),a}finally{Mt=t,qt=!1}}return null}var Jt=o.ReactCurrentBatchConfig;function Zt(e,t){if(Wt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!rt.call(t,a)||!Wt(e[a],t[a]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=st(null),nn=null,rn=null,an=null;function sn(){an=rn=nn=null}function on(e,t,n){K?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;ot(tn),K?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ua=!0),e.firstContext=null)}function hn(e){var t=K?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(s(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var dn=null,An=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==qi&&0!==(1&e.mode)&&0===(2&Ki)?(null===(e=n.interleaved)?(t.next=t,null===dn?dn=[n]:dn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Tt(e,n)}}function vn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=s:i=i.next=s,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bn(e,t,n,r){var a=e.updateQueue;An=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(null!==l){a.shared.pending=null;var c=l,u=c.next;c.next=null,null===o?s=u:o.next=u,o=c;var h=e.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==s){var d=a.baseState;for(o=0,h=u=c=null,l=s;;){var A=l.lane,p=l.eventTime;if((r&A)===A){null!==h&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var f=e,m=l;switch(A=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,A);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(A="function"===typeof(f=m.payload)?f.call(p,d,A):f)||void 0===A)break e;d=i({},d,A);break e;case 2:An=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(A=a.effects)?a.effects=[l]:A.push(l))}else p={eventTime:p,lane:A,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,o|=A;if(null===(l=l.next)){if(null===(l=a.shared.pending))break;l=(A=l).next,A.next=null,a.lastBaseUpdate=A,a.shared.pending=null}}if(null===h&&(c=d),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=h,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===s&&(a.shared.lanes=0);ts|=o,e.lanes=o,e.memoizedState=d}}function xn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(s(191,a));a.call(r)}}}var wn=(new r.Component).refs;function _n(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Sn={isMounted:function(e){return!!(e=e._reactInternals)&&C(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=bs(),a=xs(e),i=mn(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=ws(e,a,r))&&yn(t,e,a)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=bs(),a=xs(e),i=mn(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=ws(e,a,r))&&yn(t,e,a)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bs(),r=xs(e),a=mn(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),gn(e,a),null!==(t=ws(e,r,n))&&yn(t,e,r)}};function Cn(e,t,n,r,a,i,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,s):!t.prototype||!t.prototype.isPureReactComponent||(!Zt(n,r)||!Zt(a,i))}function En(e,t,n){var r=!1,a=ct,i=t.contextType;return"object"===typeof i&&null!==i?i=hn(i):(a=pt(t)?dt:ut.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?At(e,a):ct),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Sn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Nn(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Sn.enqueueReplaceState(t,t.state,null)}function Bn(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=wn,pn(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=hn(i):(i=pt(t)?dt:ut.current,a.context=At(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(_n(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Sn.enqueueReplaceState(a,a.state,null),bn(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}var kn=[],In=0,Tn=null,Mn=0,Fn=[],Rn=0,Ln=null,Un=1,Pn="";function Dn(e,t){kn[In++]=Mn,kn[In++]=Tn,Tn=e,Mn=t}function On(e,t,n){Fn[Rn++]=Un,Fn[Rn++]=Pn,Fn[Rn++]=Ln,Ln=e;var r=Un;e=Pn;var a=32-bt(r)-1;r&=~(1<<a),n+=1;var i=32-bt(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Un=1<<32-bt(t)+a|n<<a|r,Pn=i+e}else Un=1<<i|n<<a|r,Pn=e}function zn(e){null!==e.return&&(Dn(e,1),On(e,1,0))}function Hn(e){for(;e===Tn;)Tn=kn[--In],kn[In]=null,Mn=kn[--In],kn[In]=null;for(;e===Ln;)Ln=Fn[--Rn],Fn[Rn]=null,Pn=Fn[--Rn],Fn[Rn]=null,Un=Fn[--Rn],Fn[Rn]=null}var jn=null,Qn=null,Vn=!1,Wn=!1,Gn=null;function Kn(e,t){var n=Js(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function qn(e,t){switch(e.tag){case 5:return null!==(t=Fe(t,e.type,e.pendingProps))&&(e.stateNode=t,jn=e,Qn=ze(t),!0);case 6:return null!==(t=Re(t,e.pendingProps))&&(e.stateNode=t,jn=e,Qn=null,!0);case 13:if(null!==(t=Le(t))){var n=null!==Ln?{id:Un,overflow:Pn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Js(18,null,null,0)).stateNode=t,n.return=e,e.child=n,jn=e,Qn=null,!0}return!1;default:return!1}}function Xn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Yn(e){if(Vn){var t=Qn;if(t){var n=t;if(!qn(e,t)){if(Xn(e))throw Error(s(418));t=Oe(n);var r=jn;t&&qn(e,t)?Kn(r,n):(e.flags=-4097&e.flags|2,Vn=!1,jn=e)}}else{if(Xn(e))throw Error(s(418));e.flags=-4097&e.flags|2,Vn=!1,jn=e}}}function Jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;jn=e}function Zn(e){if(!Y||e!==jn)return!1;if(!Vn)return Jn(e),Vn=!0,!1;if(3!==e.tag&&(5!==e.tag||Je(e.type)&&!j(e.type,e.memoizedProps))){var t=Qn;if(t){if(Xn(e)){for(e=Qn;e;)e=Oe(e);throw Error(s(418))}for(;t;)Kn(e,t),t=Oe(t)}}if(Jn(e),13===e.tag){if(!Y)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));Qn=Ge(e)}else Qn=jn?Oe(e.stateNode):null;return!0}function $n(){Y&&(Qn=jn=null,Wn=Vn=!1)}function er(e){null===Gn?Gn=[e]:Gn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var a=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=a.refs;t===wn&&(t=a.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ar(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=$s(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,r){return null===t||6!==t.tag?((t=ro(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n,r){var i=n.type;return i===u?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===v&&rr(i)===t.type)?((r=a(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=eo(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function A(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ao(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=to(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=ro(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=eo(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case c:return(t=ao(t,e.mode,n)).return=e,t;case v:return f(e,(0,t._init)(t._payload),n)}if(M(t)||w(t))return(t=to(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function m(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:h(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===a?d(e,t,n,r):null;case c:return n.key===a?A(e,t,n,r):null;case v:return m(e,t,(a=n._init)(n._payload),r)}if(M(n)||w(n))return null!==a?null:p(e,t,n,r,null);nr(e,n)}return null}function g(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return h(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case l:return d(t,e=e.get(null===r.key?n:r.key)||null,r,a);case c:return A(t,e=e.get(null===r.key?n:r.key)||null,r,a);case v:return g(e,t,n,(0,r._init)(r._payload),a)}if(M(r)||w(r))return p(t,e=e.get(n)||null,r,a,null);nr(t,r)}return null}function y(a,s,o,l){for(var c=null,u=null,h=s,d=s=0,A=null;null!==h&&d<o.length;d++){h.index>d?(A=h,h=null):A=h.sibling;var p=m(a,h,o[d],l);if(null===p){null===h&&(h=A);break}e&&h&&null===p.alternate&&t(a,h),s=i(p,s,d),null===u?c=p:u.sibling=p,u=p,h=A}if(d===o.length)return n(a,h),Vn&&Dn(a,d),c;if(null===h){for(;d<o.length;d++)null!==(h=f(a,o[d],l))&&(s=i(h,s,d),null===u?c=h:u.sibling=h,u=h);return Vn&&Dn(a,d),c}for(h=r(a,h);d<o.length;d++)null!==(A=g(h,a,d,o[d],l))&&(e&&null!==A.alternate&&h.delete(null===A.key?d:A.key),s=i(A,s,d),null===u?c=A:u.sibling=A,u=A);return e&&h.forEach(function(e){return t(a,e)}),Vn&&Dn(a,d),c}function b(a,o,l,c){var u=w(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,d=o,A=o=0,p=null,y=l.next();null!==d&&!y.done;A++,y=l.next()){d.index>A?(p=d,d=null):p=d.sibling;var v=m(a,d,y.value,c);if(null===v){null===d&&(d=p);break}e&&d&&null===v.alternate&&t(a,d),o=i(v,o,A),null===h?u=v:h.sibling=v,h=v,d=p}if(y.done)return n(a,d),Vn&&Dn(a,A),u;if(null===d){for(;!y.done;A++,y=l.next())null!==(y=f(a,y.value,c))&&(o=i(y,o,A),null===h?u=y:h.sibling=y,h=y);return Vn&&Dn(a,A),u}for(d=r(a,d);!y.done;A++,y=l.next())null!==(y=g(d,a,A,y.value,c))&&(e&&null!==y.alternate&&d.delete(null===y.key?A:y.key),o=i(y,o,A),null===h?u=y:h.sibling=y,h=y);return e&&d.forEach(function(e){return t(a,e)}),Vn&&Dn(a,A),u}return function e(r,i,s,h){if("object"===typeof s&&null!==s&&s.type===u&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case l:e:{for(var d=s.key,A=i;null!==A;){if(A.key===d){if((d=s.type)===u){if(7===A.tag){n(r,A.sibling),(i=a(A,s.props.children)).return=r,r=i;break e}}else if(A.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===v&&rr(d)===A.type){n(r,A.sibling),(i=a(A,s.props)).ref=tr(r,A,s),i.return=r,r=i;break e}n(r,A);break}t(r,A),A=A.sibling}s.type===u?((i=to(s.props.children,r.mode,h,s.key)).return=r,r=i):((h=eo(s.type,s.key,s.props,null,r.mode,h)).ref=tr(r,i,s),h.return=r,r=h)}return o(r);case c:e:{for(A=s.key;null!==i;){if(i.key===A){if(4===i.tag&&i.stateNode.containerInfo===s.containerInfo&&i.stateNode.implementation===s.implementation){n(r,i.sibling),(i=a(i,s.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=ao(s,r.mode,h)).return=r,r=i}return o(r);case v:return e(r,i,(A=s._init)(s._payload),h)}if(M(s))return y(r,i,s,h);if(w(s))return b(r,i,s,h);nr(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,s)).return=r,r=i):(n(r,i),(i=ro(s,r.mode,h)).return=r,r=i),o(r)):n(r,i)}}var ir=ar(!0),sr=ar(!1),or={},lr=st(or),cr=st(or),ur=st(or);function hr(e){if(e===or)throw Error(s(174));return e}function dr(e,t){lt(ur,t),lt(cr,e),lt(lr,or),e=R(t),ot(lr),lt(lr,e)}function Ar(){ot(lr),ot(cr),ot(ur)}function pr(e){var t=hr(ur.current),n=hr(lr.current);n!==(t=L(n,e.type,t))&&(lt(cr,e),lt(lr,t))}function fr(e){cr.current===e&&(ot(lr),ot(cr))}var mr=st(0);function gr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Ue(n)||Pe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yr=[];function vr(){for(var e=0;e<yr.length;e++){var t=yr[e];K?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yr.length=0}var br=o.ReactCurrentDispatcher,xr=o.ReactCurrentBatchConfig,wr=0,_r=null,Sr=null,Cr=null,Er=!1,Nr=!1,Br=0,kr=0;function Ir(){throw Error(s(321))}function Tr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}function Mr(e,t,n,r,a,i){if(wr=i,_r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,br.current=null===e||null===e.memoizedState?pa:fa,e=n(r,a),Nr){i=0;do{if(Nr=!1,Br=0,25<=i)throw Error(s(301));i+=1,Cr=Sr=null,t.updateQueue=null,br.current=ma,e=n(r,a)}while(Nr)}if(br.current=Aa,t=null!==Sr&&null!==Sr.next,wr=0,Cr=Sr=_r=null,Er=!1,t)throw Error(s(300));return e}function Fr(){var e=0!==Br;return Br=0,e}function Rr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e,Cr}function Lr(){if(null===Sr){var e=_r.alternate;e=null!==e?e.memoizedState:null}else e=Sr.next;var t=null===Cr?_r.memoizedState:Cr.next;if(null!==t)Cr=t,Sr=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Sr=e).memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e}return Cr}function Ur(e,t){return"function"===typeof t?t(e):t}function Pr(e){var t=Lr(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Sr,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var o=a.next;a.next=i.next,i.next=o}r.baseQueue=a=i,n.pending=null}if(null!==a){i=a.next,r=r.baseState;var l=o=null,c=null,u=i;do{var h=u.lane;if((wr&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,_r.lanes|=h,ts|=h}u=u.next}while(null!==u&&u!==i);null===c?o=r:c.next=l,Wt(r,t.memoizedState)||(Ua=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{i=a.lane,_r.lanes|=i,ts|=i,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Dr(e){var t=Lr(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{i=e(i,o.action),o=o.next}while(o!==a);Wt(i,t.memoizedState)||(Ua=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Or(){}function zr(e,t){var n=_r,r=Lr(),a=t(),i=!Wt(r.memoizedState,a);if(i&&(r.memoizedState=a,Ua=!0),r=r.queue,Jr(Qr.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==Cr&&1&Cr.memoizedState.tag){if(n.flags|=2048,Gr(9,jr.bind(null,n,r,a,t),void 0,null),null===qi)throw Error(s(349));0!==(30&wr)||Hr(n,t,a)}return a}function Hr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function jr(e,t,n,r){t.value=n,t.getSnapshot=r,Vr(t)&&ws(e,1,-1)}function Qr(e,t,n){return n(function(){Vr(t)&&ws(e,1,-1)})}function Vr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wt(e,n)}catch(r){return!0}}function Wr(e){var t=Rr();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ur,lastRenderedState:e},t.queue=e,e=e.dispatch=la.bind(null,_r,e),[t.memoizedState,e]}function Gr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Kr(){return Lr().memoizedState}function qr(e,t,n,r){var a=Rr();_r.flags|=e,a.memoizedState=Gr(1|t,n,void 0,void 0===r?null:r)}function Xr(e,t,n,r){var a=Lr();r=void 0===r?null:r;var i=void 0;if(null!==Sr){var s=Sr.memoizedState;if(i=s.destroy,null!==r&&Tr(r,s.deps))return void(a.memoizedState=Gr(t,n,i,r))}_r.flags|=e,a.memoizedState=Gr(1|t,n,i,r)}function Yr(e,t){return qr(8390656,8,e,t)}function Jr(e,t){return Xr(2048,8,e,t)}function Zr(e,t){return Xr(4,2,e,t)}function $r(e,t){return Xr(4,4,e,t)}function ea(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ta(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Xr(4,4,ea.bind(null,t,e),n)}function na(){}function ra(e,t){var n=Lr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Tr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function aa(e,t){var n=Lr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Tr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ia(e,t){var n=Mt;Mt=0!==n&&4>n?n:4,e(!0);var r=xr.transition;xr.transition={};try{e(!1),t()}finally{Mt=n,xr.transition=r}}function sa(){return Lr().memoizedState}function oa(e,t,n){var r=xs(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ca(e)?ua(t,n):(ha(e,t,n),null!==(e=ws(e,r,n=bs()))&&da(e,t,r))}function la(e,t,n){var r=xs(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ca(e))ua(t,a);else{ha(e,t,a);var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=i(s,n);if(a.hasEagerState=!0,a.eagerState=o,Wt(o,s))return}catch(l){}null!==(e=ws(e,r,n=bs()))&&da(e,t,r)}}function ca(e){var t=e.alternate;return e===_r||null!==t&&t===_r}function ua(e,t){Nr=Er=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ha(e,t,n){null!==qi&&0!==(1&e.mode)&&0===(2&Ki)?(null===(e=t.interleaved)?(n.next=n,null===dn?dn=[t]:dn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function da(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Tt(e,n)}}var Aa={readContext:hn,useCallback:Ir,useContext:Ir,useEffect:Ir,useImperativeHandle:Ir,useInsertionEffect:Ir,useLayoutEffect:Ir,useMemo:Ir,useReducer:Ir,useRef:Ir,useState:Ir,useDebugValue:Ir,useDeferredValue:Ir,useTransition:Ir,useMutableSource:Ir,useSyncExternalStore:Ir,useId:Ir,unstable_isNewReconciler:!1},pa={readContext:hn,useCallback:function(e,t){return Rr().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Yr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,qr(4194308,4,ea.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qr(4194308,4,e,t)},useInsertionEffect:function(e,t){return qr(4,2,e,t)},useMemo:function(e,t){var n=Rr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Rr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=oa.bind(null,_r,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Rr().memoizedState=e},useState:Wr,useDebugValue:na,useDeferredValue:function(e){var t=Wr(e),n=t[0],r=t[1];return Yr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){var e=Wr(!1),t=e[0];return e=ia.bind(null,e[1]),Rr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=_r,a=Rr();if(Vn){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===qi)throw Error(s(349));0!==(30&wr)||Hr(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Yr(Qr.bind(null,r,i,e),[e]),r.flags|=2048,Gr(9,jr.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Rr(),t=qi.identifierPrefix;if(Vn){var n=Pn;t=":"+t+"R"+(n=(Un&~(1<<32-bt(Un)-1)).toString(32)+n),0<(n=Br++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=kr++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},fa={readContext:hn,useCallback:ra,useContext:hn,useEffect:Jr,useImperativeHandle:ta,useInsertionEffect:Zr,useLayoutEffect:$r,useMemo:aa,useReducer:Pr,useRef:Kr,useState:function(){return Pr(Ur)},useDebugValue:na,useDeferredValue:function(e){var t=Pr(Ur),n=t[0],r=t[1];return Jr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){return[Pr(Ur)[0],Lr().memoizedState]},useMutableSource:Or,useSyncExternalStore:zr,useId:sa,unstable_isNewReconciler:!1},ma={readContext:hn,useCallback:ra,useContext:hn,useEffect:Jr,useImperativeHandle:ta,useInsertionEffect:Zr,useLayoutEffect:$r,useMemo:aa,useReducer:Dr,useRef:Kr,useState:function(){return Dr(Ur)},useDebugValue:na,useDeferredValue:function(e){var t=Dr(Ur),n=t[0],r=t[1];return Jr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){return[Dr(Ur)[0],Lr().memoizedState]},useMutableSource:Or,useSyncExternalStore:zr,useId:sa,unstable_isNewReconciler:!1};function ga(e,t){try{var n="",r=t;do{n+=$t(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a}}function ya(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var va,ba,xa,wa,_a="function"===typeof WeakMap?WeakMap:Map;function Sa(e,t,n){(n=mn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){us||(us=!0,hs=r),ya(0,t)},n}function Ca(e,t,n){(n=mn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ya(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ya(0,t),"function"!==typeof r&&(null===ds?ds=new Set([this]):ds.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Ea(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new _a;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Ws.bind(null,e,t,n),t.then(e,e))}function Na(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ba(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=mn(-1,1)).tag=2,gn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}function ka(e){e.flags|=4}function Ia(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(q)va=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)O(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ba=function(){},xa=function(e,t,n,r,a){if((e=e.memoizedProps)!==r){var i=t.stateNode,s=hr(lr.current);n=H(i,n,e,r,a,s),(t.updateQueue=n)&&ka(t)}},wa=function(e,t,n,r){n!==r&&ka(t)};else if(X){va=function(e,t,n,r){for(var a=t.child;null!==a;){if(5===a.tag){var i=a.stateNode;n&&r&&(i=Te(i,a.type,a.memoizedProps,a)),O(e,i)}else if(6===a.tag)i=a.stateNode,n&&r&&(i=Me(i,a.memoizedProps,a)),O(e,i);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(i=a.child)&&(i.return=a),va(e,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};var Ta=function(e,t,n,r){for(var a=t.child;null!==a;){if(5===a.tag){var i=a.stateNode;n&&r&&(i=Te(i,a.type,a.memoizedProps,a)),Be(e,i)}else if(6===a.tag)i=a.stateNode,n&&r&&(i=Me(i,a.memoizedProps,a)),Be(e,i);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(i=a.child)&&(i.return=a),Ta(e,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};ba=function(e,t){var n=t.stateNode;if(!Ia(e,t)){e=n.containerInfo;var r=Ne(e);Ta(r,t,!1,!1),n.pendingChildren=r,ka(t),ke(e,r)}},xa=function(e,t,n,r,a){var i=e.stateNode,s=e.memoizedProps;if((e=Ia(e,t))&&s===r)t.stateNode=i;else{var o=t.stateNode,l=hr(lr.current),c=null;s!==r&&(c=H(o,n,s,r,a,l)),e&&null===c?t.stateNode=i:(i=Ee(i,c,n,s,r,t,e,o),z(i,n,r,a,l)&&ka(t),t.stateNode=i,e?ka(t):va(i,t,!1,!1))}},wa=function(e,t,n,r){n!==r?(e=hr(ur.current),n=hr(lr.current),t.stateNode=Q(r,e,n,t),ka(t)):t.stateNode=e.stateNode}}else ba=function(){},xa=function(){},wa=function(){};function Ma(e,t){if(!Vn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Fa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ra(e,t,n){var r=t.pendingProps;switch(Hn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fa(t),null;case 1:case 17:return pt(t.type)&&ft(),Fa(t),null;case 3:return r=t.stateNode,Ar(),ot(ht),ot(ut),vr(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Zn(t)?ka(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Gn&&(Ns(Gn),Gn=null))),ba(e,t),Fa(t),null;case 5:fr(t),n=hr(ur.current);var a=t.type;if(null!==e&&null!=t.stateNode)xa(e,t,a,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Fa(t),null}if(e=hr(lr.current),Zn(t)){if(!Y)throw Error(s(175));e=Qe(t.stateNode,t.type,t.memoizedProps,n,e,t,!Wn),t.updateQueue=e,null!==e&&ka(t)}else{var i=D(a,r,n,e,t);va(i,t,!1,!1),t.stateNode=i,z(i,a,r,n,e)&&ka(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Fa(t),null;case 6:if(e&&null!=t.stateNode)wa(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(e=hr(ur.current),n=hr(lr.current),Zn(t)){if(!Y)throw Error(s(176));if(e=t.stateNode,r=t.memoizedProps,(n=Ve(e,r,t,!Wn))&&null!==(a=jn))switch(i=0!==(1&a.mode),a.tag){case 3:Ze(a.stateNode.containerInfo,e,r,i);break;case 5:$e(a.type,a.memoizedProps,a.stateNode,e,r,i)}n&&ka(t)}else t.stateNode=Q(r,e,n,t)}return Fa(t),null;case 13:if(ot(mr),r=t.memoizedState,Vn&&null!==Qn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Qn;e;)e=Oe(e);return $n(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Zn(t),null===e){if(!r)throw Error(s(318));if(!Y)throw Error(s(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(317));We(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Fa(t),null}return null!==Gn&&(Ns(Gn),Gn=null),0!==(128&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Zn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&mr.current)?0===$i&&($i=3):Ls())),null!==t.updateQueue&&(t.flags|=4),Fa(t),null);case 4:return Ar(),ba(e,t),null===e&&Z(t.stateNode.containerInfo),Fa(t),null;case 10:return ln(t.type._context),Fa(t),null;case 19:if(ot(mr),null===(a=t.memoizedState))return Fa(t),null;if(r=0!==(128&t.flags),null===(i=a.rendering))if(r)Ma(a,!1);else{if(0!==$i||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=gr(e))){for(t.flags|=128,Ma(a,!1),null!==(e=i.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)a=e,(n=r).flags&=14680066,null===(i=n.alternate)?(n.childLanes=0,n.lanes=a,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=i.childLanes,n.lanes=i.lanes,n.child=i.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=i.memoizedProps,n.memoizedState=i.memoizedState,n.updateQueue=i.updateQueue,n.type=i.type,a=i.dependencies,n.dependencies=null===a?null:{lanes:a.lanes,firstContext:a.firstContext}),r=r.sibling;return lt(mr,1&mr.current|2),t.child}e=e.sibling}null!==a.tail&&Dt()>os&&(t.flags|=128,r=!0,Ma(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=gr(i))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Ma(a,!0),null===a.tail&&"hidden"===a.tailMode&&!i.alternate&&!Vn)return Fa(t),null}else 2*Dt()-a.renderingStartTime>os&&1073741824!==n&&(t.flags|=128,r=!0,Ma(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=a.last)?e.sibling=i:t.child=i,a.last=i)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Dt(),t.sibling=null,e=mr.current,lt(mr,r?1&e|2:1&e),t):(Fa(t),null);case 22:case 23:return Ts(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ji)&&(Fa(t),q&&6&t.subtreeFlags&&(t.flags|=8192)):Fa(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}var La=o.ReactCurrentOwner,Ua=!1;function Pa(e,t,n,r){t.child=null===e?sr(t,null,n,r):ir(t,e.child,n,r)}function Da(e,t,n,r,a){n=n.render;var i=t.ref;return un(t,a),r=Mr(e,t,n,r,i,a),n=Fr(),null===e||Ua?(Vn&&n&&zn(t),t.flags|=1,Pa(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function Oa(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Zs(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=eo(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,za(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var s=i.memoizedProps;if((n=null!==(n=n.compare)?n:Zt)(s,r)&&e.ref===t.ref)return ai(e,t,a)}return t.flags|=1,(e=$s(i,r)).ref=t.ref,e.return=t,t.child=e}function za(e,t,n,r,a){if(null!==e&&Zt(e.memoizedProps,r)&&e.ref===t.ref){if(Ua=!1,0===(e.lanes&a))return t.lanes=e.lanes,ai(e,t,a);0!==(131072&e.flags)&&(Ua=!0)}return Qa(e,t,n,r,a)}function Ha(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},lt(Zi,Ji),Ji|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Zi,Ji),Ji|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==i?i.baseLanes:n,lt(Zi,Ji),Ji|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,lt(Zi,Ji),Ji|=r;return Pa(e,t,a,n),t.child}function ja(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Qa(e,t,n,r,a){var i=pt(n)?dt:ut.current;return i=At(t,i),un(t,a),n=Mr(e,t,n,r,i,a),r=Fr(),null===e||Ua?(Vn&&r&&zn(t),t.flags|=1,Pa(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function Va(e,t,n,r,a){if(pt(n)){var i=!0;yt(t)}else i=!1;if(un(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),En(t,n,r),Bn(t,n,r,a),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=At(t,c=pt(n)?dt:ut.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==r||l!==c)&&Nn(t,s,r,c),An=!1;var d=t.memoizedState;s.state=d,bn(t,r,s,a),l=t.memoizedState,o!==r||d!==l||ht.current||An?("function"===typeof u&&(_n(t,n,u,r),l=t.memoizedState),(o=An||Cn(t,n,o,r,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,fn(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:en(t.type,o),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=At(t,l=pt(n)?dt:ut.current);var A=n.getDerivedStateFromProps;(u="function"===typeof A||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==h||d!==l)&&Nn(t,s,r,l),An=!1,d=t.memoizedState,s.state=d,bn(t,r,s,a);var p=t.memoizedState;o!==h||d!==p||ht.current||An?("function"===typeof A&&(_n(t,n,A,r),p=t.memoizedState),(c=An||Cn(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Wa(e,t,n,r,i,a)}function Wa(e,t,n,r,a,i){ja(e,t);var s=0!==(128&t.flags);if(!r&&!s)return a&&vt(t,n,!1),ai(e,t,i);r=t.stateNode,La.current=t;var o=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=ir(t,e.child,null,i),t.child=ir(t,null,o,i)):Pa(e,t,o,i),t.memoizedState=r.state,a&&vt(t,n,!0),t.child}function Ga(e){var t=e.stateNode;t.pendingContext?mt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mt(0,t.context,!1),dr(e,t.containerInfo)}function Ka(e,t,n,r,a){return $n(),er(a),t.flags|=256,Pa(e,t,n,r),t.child}var qa={dehydrated:null,treeContext:null,retryLane:0};function Xa(e){return{baseLanes:e,cachePool:null}}function Ya(e,t,n){var r,a=t.pendingProps,i=mr.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),lt(mr,1&i),null===e)return Yn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Pe(e)?t.lanes=8:t.lanes=1073741824,null):(i=a.children,e=a.fallback,o?(a=t.mode,o=t.child,i={mode:"hidden",children:i},0===(1&a)&&null!==o?(o.childLanes=0,o.pendingProps=i):o=no(i,a,0,null),e=to(e,a,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Xa(n),t.memoizedState=qa,e):Ja(t,i));if(null!==(i=e.memoizedState)){if(null!==(r=i.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,ei(e,t,n,Error(s(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=a.fallback,i=t.mode,a=no({mode:"visible",children:a.children},i,0,null),(o=to(o,i,n,null)).flags|=2,a.return=t,o.return=t,a.sibling=o,t.child=a,0!==(1&t.mode)&&ir(t,e.child,null,n),t.child.memoizedState=Xa(n),t.memoizedState=qa,o);if(0===(1&t.mode))t=ei(e,t,n,null);else if(Pe(r))t=ei(e,t,n,Error(s(419)));else if(a=0!==(n&e.childLanes),Ua||a){if(null!==(a=qi)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(a=0!==(o&(a.suspendedLanes|n))?0:o)&&a!==i.retryLane&&(i.retryLane=a,ws(e,a,-1))}Ls(),t=ei(e,t,n,Error(s(421)))}else Ue(r)?(t.flags|=128,t.child=e.child,t=Ks.bind(null,e),De(r,t),t=null):(n=i.treeContext,Y&&(Qn=je(r),jn=t,Vn=!0,Gn=null,Wn=!1,null!==n&&(Fn[Rn++]=Un,Fn[Rn++]=Pn,Fn[Rn++]=Ln,Un=n.id,Pn=n.overflow,Ln=t)),(t=Ja(t,t.pendingProps.children)).flags|=4096);return t}return o?(a=$a(e,t,a.children,a.fallback,n),o=t.child,i=e.child.memoizedState,o.memoizedState=null===i?Xa(n):{baseLanes:i.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=qa,a):(n=Za(e,t,a.children,n),t.memoizedState=null,n)}return o?(a=$a(e,t,a.children,a.fallback,n),o=t.child,i=e.child.memoizedState,o.memoizedState=null===i?Xa(n):{baseLanes:i.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=qa,a):(n=Za(e,t,a.children,n),t.memoizedState=null,n)}function Ja(e,t){return(t=no({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Za(e,t,n,r){var a=e.child;return e=a.sibling,n=$s(a,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function $a(e,t,n,r,a){var i=t.mode,s=(e=e.child).sibling,o={mode:"hidden",children:n};return 0===(1&i)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null):(n=$s(e,o)).subtreeFlags=14680064&e.subtreeFlags,null!==s?r=$s(s,r):(r=to(r,i,a,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ei(e,t,n,r){return null!==r&&er(r),ir(t,e.child,null,n),(e=Ja(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ti(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cn(e.return,t,n)}function ni(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function ri(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Pa(e,t,r.children,n),0!==(2&(r=mr.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ti(e,n,t);else if(19===e.tag)ti(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(lt(mr,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===gr(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ni(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===gr(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ni(t,!0,n,null,i);break;case"together":ni(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ai(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ts|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=$s(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=$s(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ii(e,t){switch(Hn(t),t.tag){case 1:return pt(t.type)&&ft(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ar(),ot(ht),ot(ut),vr(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return fr(t),null;case 13:if(ot(mr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ot(mr),null;case 4:return Ar(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Ts(),null;default:return null}}var si=!1,oi=!1,li="function"===typeof WeakSet?WeakSet:Set,ci=null;function ui(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Vs(e,t,r)}else n.current=null}function hi(e,t,n){try{n()}catch(r){Vs(e,t,r)}}var di=!1;function Ai(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&hi(t,n,i)}a=a.next}while(a!==r)}}function pi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function fi(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=F(n);else e=n;"function"===typeof t?t(e):t.current=e}}function mi(e,t,n){if(Vt&&"function"===typeof Vt.onCommitFiberUnmount)try{Vt.onCommitFiberUnmount(Qt,t)}catch(s){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var a=r,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&hi(t,n,i),r=r.next}while(r!==e)}break;case 1:if(ui(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(s){Vs(t,n,s)}break;case 5:ui(t,n);break;case 4:q?Si(e,t,n):X&&X&&(t=t.stateNode.containerInfo,n=Ne(t),Ie(t,n))}}function gi(e,t,n){for(var r=t;;)if(mi(e,r,n),null===r.child||q&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function yi(e){var t=e.alternate;null!==t&&(e.alternate=null,yi(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function vi(e){return 5===e.tag||3===e.tag||4===e.tag}function bi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||vi(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function xi(e){if(q){e:{for(var t=e.return;null!==t;){if(vi(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(be(t),n.flags&=-33),_i(e,n=bi(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,wi(e,n=bi(e),t);break;default:throw Error(s(161))}}}function wi(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):de(n,e);else if(4!==r&&null!==(e=e.child))for(wi(e,t,n),e=e.sibling;null!==e;)wi(e,t,n),e=e.sibling}function _i(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?me(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(_i(e,t,n),e=e.sibling;null!==e;)_i(e,t,n),e=e.sibling}function Si(e,t,n){for(var r,a,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(s(160));switch(r=o.stateNode,o.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag)gi(e,i,n),a?ve(r,i.stateNode):ye(r,i.stateNode);else if(18===i.tag)a?Ye(r,i.stateNode):Xe(r,i.stateNode);else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,a=!0,i.child.return=i,i=i.child;continue}}else if(mi(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function Ci(e,t){if(q){switch(t.tag){case 0:case 11:case 14:case 15:return Ai(3,t,t.return),pi(3,t),void Ai(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var a=t.type,i=t.updateQueue;t.updateQueue=null,null!==i&&fe(n,i,a,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return n=t.memoizedProps,void Ae(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Y&&null!==e&&e.memoizedState.isDehydrated&&Ke(t.stateNode.containerInfo));case 13:case 19:return void Ei(t)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:return Ai(3,t,t.return),pi(3,t),void Ai(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ei(t);case 3:Y&&null!==e&&e.memoizedState.isDehydrated&&Ke(t.stateNode.containerInfo)}e:if(X){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Ie(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Ei(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new li),t.forEach(function(t){var r=qs.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function Ni(e,t,n){ci=e,Bi(e,t,n)}function Bi(e,t,n){for(var r=0!==(1&e.mode);null!==ci;){var a=ci,i=a.child;if(22===a.tag&&r){var s=null!==a.memoizedState||si;if(!s){var o=a.alternate,l=null!==o&&null!==o.memoizedState||oi;o=si;var c=oi;if(si=s,(oi=l)&&!c)for(ci=a;null!==ci;)l=(s=ci).child,22===s.tag&&null!==s.memoizedState?Ti(a):null!==l?(l.return=s,ci=l):Ti(a);for(;null!==i;)ci=i,Bi(i,t,n),i=i.sibling;ci=a,si=o,oi=c}ki(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,ci=i):ki(e)}}function ki(e){for(;null!==ci;){var t=ci;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:oi||pi(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!oi)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&xn(t,i,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=F(t.child.stateNode);break;case 1:n=t.child.stateNode}xn(t,o,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&pe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Y&&null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&qe(h)}}}break;default:throw Error(s(163))}oi||512&t.flags&&fi(t)}catch(d){Vs(t,t.return,d)}}if(t===e){ci=null;break}if(null!==(n=t.sibling)){n.return=t.return,ci=n;break}ci=t.return}}function Ii(e){for(;null!==ci;){var t=ci;if(t===e){ci=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ci=n;break}ci=t.return}}function Ti(e){for(;null!==ci;){var t=ci;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pi(4,t)}catch(l){Vs(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(l){Vs(t,a,l)}}var i=t.return;try{fi(t)}catch(l){Vs(t,i,l)}break;case 5:var s=t.return;try{fi(t)}catch(l){Vs(t,s,l)}}}catch(l){Vs(t,t.return,l)}if(t===e){ci=null;break}var o=t.sibling;if(null!==o){o.return=t.return,ci=o;break}ci=t.return}}var Mi=0,Fi=1,Ri=2,Li=3,Ui=4;if("function"===typeof Symbol&&Symbol.for){var Pi=Symbol.for;Mi=Pi("selector.component"),Fi=Pi("selector.has_pseudo_class"),Ri=Pi("selector.role"),Li=Pi("selector.test_id"),Ui=Pi("selector.text")}function Di(e){var t=J(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=ae(e)))throw Error(s(362));return e.stateNode.current}function Oi(e,t){switch(t.$$typeof){case Mi:if(e.type===t.value)return!0;break;case Fi:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],a=e[n++],i=t[a];if(5!==r.tag||!oe(r)){for(;null!=i&&Oi(r,i);)i=t[++a];if(a===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}t=!1}return t;case Ri:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case Ui:if((5===e.tag||6===e.tag)&&(null!==(e=se(e))&&0<=e.indexOf(t.value)))return!0;break;case Li:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function zi(e){switch(e.$$typeof){case Mi:return"<"+(_(e.value)||"Unknown")+">";case Fi:return":has("+(zi(e)||"")+")";case Ri:return'[role="'+e.value+'"]';case Ui:return'"'+e.value+'"';case Li:return'[data-testname="'+e.value+'"]';default:throw Error(s(365))}}function Hi(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var a=e[r++],i=e[r++],s=t[i];if(5!==a.tag||!oe(a)){for(;null!=s&&Oi(a,s);)s=t[++i];if(i===t.length)n.push(a);else for(a=a.child;null!==a;)e.push(a,i),a=a.sibling}}return n}function ji(e,t){if(!re)throw Error(s(363));e=Hi(e=Di(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)oe(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Qi=Math.ceil,Vi=o.ReactCurrentDispatcher,Wi=o.ReactCurrentOwner,Gi=o.ReactCurrentBatchConfig,Ki=0,qi=null,Xi=null,Yi=0,Ji=0,Zi=st(0),$i=0,es=null,ts=0,ns=0,rs=0,as=null,is=null,ss=0,os=1/0;function ls(){os=Dt()+500}var cs,us=!1,hs=null,ds=null,As=!1,ps=null,fs=0,ms=0,gs=null,ys=-1,vs=0;function bs(){return 0!==(6&Ki)?Dt():-1!==ys?ys:ys=Dt()}function xs(e){return 0===(1&e.mode)?1:0!==(2&Ki)&&0!==Yi?Yi&-Yi:null!==Jt.transition?(0===vs&&(e=_t,0===(4194240&(_t<<=1))&&(_t=64),vs=e),vs):0!==(e=Mt)?e:$()}function ws(e,t,n){if(50<ms)throw ms=0,gs=null,Error(s(185));var r=_s(e,t);return null===r?null:(It(r,t,n),0!==(2&Ki)&&r===qi||(r===qi&&(0===(2&Ki)&&(ns|=t),4===$i&&Bs(r,Yi)),Ss(r,n),1===t&&0===Ki&&0===(1&e.mode)&&(ls(),Kt&&Yt())),r)}function _s(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ss(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-bt(i),o=1<<s,l=a[s];-1===l?0!==(o&n)&&0===(o&r)||(a[s]=Nt(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}}(e,t);var r=Et(e,e===qi?Yi:0);if(0===r)null!==n&&Lt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Lt(n),1===t)0===e.tag?function(e){Kt=!0,Xt(e)}(ks.bind(null,e)):Xt(ks.bind(null,e)),te?ne(function(){0===Ki&&Yt()}):Rt(Ot,Yt),n=null;else{switch(Ft(r)){case 1:n=Ot;break;case 4:n=zt;break;case 16:default:n=Ht;break;case 536870912:n=jt}n=Xs(n,Cs.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Cs(e,t){if(ys=-1,vs=0,0!==(6&Ki))throw Error(s(327));var n=e.callbackNode;if(js()&&e.callbackNode!==n)return null;var r=Et(e,e===qi?Yi:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Us(e,r);else{t=r;var a=Ki;Ki|=2;var i=Rs();for(qi===e&&Yi===t||(ls(),Ms(e,t));;)try{Ds();break}catch(l){Fs(e,l)}sn(),Vi.current=i,Ki=a,null!==Xi?t=0:(qi=null,Yi=0,t=$i)}if(0!==t){if(2===t&&(0!==(a=Bt(e))&&(r=a,t=Es(e,a))),1===t)throw n=es,Ms(e,0),Bs(e,r),Ss(e,Dt()),n;if(6===t)Bs(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!Wt(i(),a))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=Us(e,r))&&(0!==(i=Bt(e))&&(r=i,t=Es(e,i))),1===t))throw n=es,Ms(e,0),Bs(e,r),Ss(e,Dt()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:Hs(e,is);break;case 3:if(Bs(e,r),(130023424&r)===r&&10<(t=ss+500-Dt())){if(0!==Et(e,0))break;if(((a=e.suspendedLanes)&r)!==r){bs(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=V(Hs.bind(null,e,is),t);break}Hs(e,is);break;case 4:if(Bs(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-bt(r);i=1<<o,(o=t[o])>a&&(a=o),r&=~i}if(r=a,10<(r=(120>(r=Dt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Qi(r/1960))-r)){e.timeoutHandle=V(Hs.bind(null,e,is),r);break}Hs(e,is);break;default:throw Error(s(329))}}}return Ss(e,Dt()),e.callbackNode===n?Cs.bind(null,e):null}function Es(e,t){var n=as;return e.current.memoizedState.isDehydrated&&(Ms(e,t).flags|=256),2!==(e=Us(e,t))&&(t=is,is=n,null!==t&&Ns(t)),e}function Ns(e){null===is?is=e:is.push.apply(is,e)}function Bs(e,t){for(t&=~rs,t&=~ns,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-bt(t),r=1<<n;e[n]=-1,t&=~r}}function ks(e){if(0!==(6&Ki))throw Error(s(327));js();var t=Et(e,0);if(0===(1&t))return Ss(e,Dt()),null;var n=Us(e,t);if(0!==e.tag&&2===n){var r=Bt(e);0!==r&&(t=r,n=Es(e,r))}if(1===n)throw n=es,Ms(e,0),Bs(e,t),Ss(e,Dt()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Hs(e,is),Ss(e,Dt()),null}function Is(e){null!==ps&&0===ps.tag&&0===(6&Ki)&&js();var t=Ki;Ki|=1;var n=Gi.transition,r=Mt;try{if(Gi.transition=null,Mt=1,e)return e()}finally{Mt=r,Gi.transition=n,0===(6&(Ki=t))&&Yt()}}function Ts(){Ji=Zi.current,ot(Zi)}function Ms(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==G&&(e.timeoutHandle=G,W(n)),null!==Xi)for(n=Xi.return;null!==n;){var r=n;switch(Hn(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&ft();break;case 3:Ar(),ot(ht),ot(ut),vr();break;case 5:fr(r);break;case 4:Ar();break;case 13:case 19:ot(mr);break;case 10:ln(r.type._context);break;case 22:case 23:Ts()}n=n.return}if(qi=e,Xi=e=$s(e.current,null),Yi=Ji=t,$i=0,es=null,rs=ns=ts=0,is=as=null,null!==dn){for(t=0;t<dn.length;t++)if(null!==(r=(n=dn[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var s=i.next;i.next=a,r.next=s}n.pending=r}dn=null}return e}function Fs(e,t){for(;;){var n=Xi;try{if(sn(),br.current=Aa,Er){for(var r=_r.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}Er=!1}if(wr=0,Cr=Sr=_r=null,Nr=!1,Br=0,Wi.current=null,null===n||null===n.return){$i=1,es=t,Xi=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Yi,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var A=h.alternate;A?(h.updateQueue=A.updateQueue,h.memoizedState=A.memoizedState,h.lanes=A.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Na(o);if(null!==p){p.flags&=-257,Ba(p,o,l,0,t),1&p.mode&&Ea(i,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var m=new Set;m.add(c),t.updateQueue=m}else f.add(c);break e}if(0===(1&t)){Ea(i,u,t),Ls();break e}c=Error(s(426))}else if(Vn&&1&l.mode){var g=Na(o);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),Ba(g,o,l,0,t),er(c);break e}}i=c,4!==$i&&($i=2),null===as?as=[i]:as.push(i),c=ga(c,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,vn(l,Sa(0,c,t));break e;case 1:i=c;var y=l.type,v=l.stateNode;if(0===(128&l.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===ds||!ds.has(v)))){l.flags|=65536,t&=-t,l.lanes|=t,vn(l,Ca(l,i,t));break e}}l=l.return}while(null!==l)}zs(n)}catch(b){t=b,Xi===n&&null!==n&&(Xi=n=n.return);continue}break}}function Rs(){var e=Vi.current;return Vi.current=Aa,null===e?Aa:e}function Ls(){0!==$i&&3!==$i&&2!==$i||($i=4),null===qi||0===(268435455&ts)&&0===(268435455&ns)||Bs(qi,Yi)}function Us(e,t){var n=Ki;Ki|=2;var r=Rs();for(qi===e&&Yi===t||Ms(e,t);;)try{Ps();break}catch(a){Fs(e,a)}if(sn(),Ki=n,Vi.current=r,null!==Xi)throw Error(s(261));return qi=null,Yi=0,$i}function Ps(){for(;null!==Xi;)Os(Xi)}function Ds(){for(;null!==Xi&&!Ut();)Os(Xi)}function Os(e){var t=cs(e.alternate,e,Ji);e.memoizedProps=e.pendingProps,null===t?zs(e):Xi=t,Wi.current=null}function zs(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ra(n,t,Ji)))return void(Xi=n)}else{if(null!==(n=ii(n,t)))return n.flags&=32767,void(Xi=n);if(null===e)return $i=6,void(Xi=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Xi=t);Xi=t=e}while(null!==t);0===$i&&($i=5)}function Hs(e,t){var n=Mt,r=Gi.transition;try{Gi.transition=null,Mt=1,function(e,t,n){do{js()}while(null!==ps);if(0!==(6&Ki))throw Error(s(327));var r=e.finishedWork,a=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-bt(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,i),e===qi&&(Xi=qi=null,Yi=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||As||(As=!0,Xs(Ht,function(){return js(),null})),i=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||i){i=Gi.transition,Gi.transition=null;var o=Mt;Mt=1;var l=Ki;Ki|=4,Wi.current=null,function(e,t){for(U(e.containerInfo),ci=t;null!==ci;)if(t=(e=ci).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,ci=t;else for(;null!==ci;){e=ci;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,a=n.memoizedState,i=e.stateNode,o=i.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),a);i.__reactInternalSnapshotBeforeUpdate=o}break;case 3:q&&Ce(e.stateNode.containerInfo);break;default:throw Error(s(163))}}catch(l){Vs(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,ci=t;break}ci=e.return}n=di,di=!1}(e,r),function(e,t){for(ci=t;null!==ci;){var n=(t=ci).deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e;q?Si(i,a,t):gi(i,a,t);var s=a.alternate;null!==s&&(s.return=null),a.return=null}catch(x){Vs(a,t,x)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,ci=n;else for(;null!==ci;){t=ci;try{var o=t.flags;if(32&o&&q&&be(t.stateNode),512&o){var l=t.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(ss=Dt())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,A=null!==d&&null!==d.memoizedState;if(n=t,q)e:if(r=n,a=h,i=null,q)for(var p=r;;){if(5===p.tag){if(null===i){i=p;var f=p.stateNode;a?xe(f):_e(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===i){var m=p.stateNode;a?we(m):Se(m,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;i===p&&(i=null),p=p.return}i===p&&(i=null),p.sibling.return=p.return,p=p.sibling}if(h&&!A&&0!==(1&n.mode)){ci=n;for(var g=n.child;null!==g;){for(n=ci=g;null!==ci;){var y=(r=ci).child;switch(r.tag){case 0:case 11:case 14:case 15:Ai(4,r,r.return);break;case 1:ui(r,r.return);var v=r.stateNode;if("function"===typeof v.componentWillUnmount){var b=r.return;try{v.props=r.memoizedProps,v.state=r.memoizedState,v.componentWillUnmount()}catch(x){Vs(r,b,x)}}break;case 5:ui(r,r.return);break;case 22:if(null!==r.memoizedState){Ii(n);continue}}null!==y?(y.return=r,ci=y):Ii(n)}g=g.sibling}}}switch(4102&o){case 2:xi(t),t.flags&=-3;break;case 6:xi(t),t.flags&=-3,Ci(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ci(t.alternate,t);break;case 4:Ci(t.alternate,t)}}catch(x){Vs(t,t.return,x)}if(null!==(n=t.sibling)){n.return=t.return,ci=n;break}ci=t.return}}}(e,r),P(e.containerInfo),e.current=r,Ni(r,e,a),Pt(),Ki=l,Mt=o,Gi.transition=i}else e.current=r;if(As&&(As=!1,ps=e,fs=a),i=e.pendingLanes,0===i&&(ds=null),function(e){if(Vt&&"function"===typeof Vt.onCommitFiberRoot)try{Vt.onCommitFiberRoot(Qt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),Ss(e,Dt()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(us)throw us=!1,e=hs,hs=null,e;0!==(1&fs)&&0!==e.tag&&js(),i=e.pendingLanes,0!==(1&i)?e===gs?ms++:(ms=0,gs=e):ms=0,Yt()}(e,t,n)}finally{Gi.transition=r,Mt=n}return null}function js(){if(null!==ps){var e=Ft(fs),t=Gi.transition,n=Mt;try{if(Gi.transition=null,Mt=16>e?16:e,null===ps)var r=!1;else{if(e=ps,ps=null,fs=0,0!==(6&Ki))throw Error(s(331));var a=Ki;for(Ki|=4,ci=e.current;null!==ci;){var i=ci,o=i.child;if(0!==(16&ci.flags)){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(ci=u;null!==ci;){var h=ci;switch(h.tag){case 0:case 11:case 15:Ai(8,h,i)}var d=h.child;if(null!==d)d.return=h,ci=d;else for(;null!==ci;){var A=(h=ci).sibling,p=h.return;if(yi(h),h===u){ci=null;break}if(null!==A){A.return=p,ci=A;break}ci=p}}}var f=i.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}ci=i}}if(0!==(2064&i.subtreeFlags)&&null!==o)o.return=i,ci=o;else e:for(;null!==ci;){if(0!==(2048&(i=ci).flags))switch(i.tag){case 0:case 11:case 15:Ai(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,ci=y;break e}ci=i.return}}var v=e.current;for(ci=v;null!==ci;){var b=(o=ci).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,ci=b;else e:for(o=v;null!==ci;){if(0!==(2048&(l=ci).flags))try{switch(l.tag){case 0:case 11:case 15:pi(9,l)}}catch(w){Vs(l,l.return,w)}if(l===o){ci=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,ci=x;break e}ci=l.return}}if(Ki=a,Yt(),Vt&&"function"===typeof Vt.onPostCommitFiberRoot)try{Vt.onPostCommitFiberRoot(Qt,e)}catch(w){}r=!0}return r}finally{Mt=n,Gi.transition=t}}return!1}function Qs(e,t,n){gn(e,t=Sa(0,t=ga(n,t),1)),t=bs(),null!==(e=_s(e,1))&&(It(e,1,t),Ss(e,t))}function Vs(e,t,n){if(3===e.tag)Qs(e,e,n);else for(;null!==t;){if(3===t.tag){Qs(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===ds||!ds.has(r))){gn(t,e=Ca(t,e=ga(n,e),1)),e=bs(),null!==(t=_s(t,1))&&(It(t,1,e),Ss(t,e));break}}t=t.return}}function Ws(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=bs(),e.pingedLanes|=e.suspendedLanes&n,qi===e&&(Yi&n)===n&&(4===$i||3===$i&&(130023424&Yi)===Yi&&500>Dt()-ss?Ms(e,0):rs|=n),Ss(e,t)}function Gs(e,t){0===t&&(0===(1&e.mode)?t=1:(t=St,0===(130023424&(St<<=1))&&(St=4194304)));var n=bs();null!==(e=_s(e,t))&&(It(e,t,n),Ss(e,n))}function Ks(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Gs(e,n)}function qs(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),Gs(e,n)}function Xs(e,t){return Rt(e,t)}function Ys(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Js(e,t,n,r){return new Ys(e,t,n,r)}function Zs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function $s(e,t){var n=e.alternate;return null===n?((n=Js(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function eo(e,t,n,r,a,i){var o=2;if(r=e,"function"===typeof e)Zs(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case u:return to(n.children,a,i,t);case h:o=8,a|=8;break;case d:return(e=Js(12,n,t,2|a)).elementType=d,e.lanes=i,e;case m:return(e=Js(13,n,t,a)).elementType=m,e.lanes=i,e;case g:return(e=Js(19,n,t,a)).elementType=g,e.lanes=i,e;case b:return no(n,a,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:o=10;break e;case p:o=9;break e;case f:o=11;break e;case y:o=14;break e;case v:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Js(o,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function to(e,t,n,r){return(e=Js(7,e,r,t)).lanes=n,e}function no(e,t,n,r){return(e=Js(22,e,r,t)).elementType=b,e.lanes=n,e.stateNode={},e}function ro(e,t,n){return(e=Js(6,e,null,t)).lanes=n,e}function ao(e,t,n){return(t=Js(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function io(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=G,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kt(0),this.expirationTimes=kt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kt(0),this.identifierPrefix=r,this.onRecoverableError=a,Y&&(this.mutableSourceEagerHydrationData=null)}function so(e,t,n,r,a,i,s,o,l){return e=new io(e,t,n,o,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Js(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},pn(i),e}function oo(e){if(!e)return ct;e:{if(C(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(pt(n))return gt(e,n,t)}return t}function lo(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return null===(e=B(t))?null:e.stateNode}function co(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function uo(e,t){co(e,t),(e=e.alternate)&&co(e,t)}function ho(e){return null===(e=B(e))?null:e.stateNode}function Ao(){return null}return cs=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)Ua=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Ua=!1,function(e,t,n){switch(t.tag){case 3:Ga(t),$n();break;case 5:pr(t);break;case 1:pt(t.type)&&yt(t);break;case 4:dr(t,t.stateNode.containerInfo);break;case 10:on(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(lt(mr,1&mr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ya(e,t,n):(lt(mr,1&mr.current),null!==(e=ai(e,t,n))?e.sibling:null);lt(mr,1&mr.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ri(e,t,n);t.flags|=128}var a=t.memoizedState;if(null!==a&&(a.rendering=null,a.tail=null,a.lastEffect=null),lt(mr,mr.current),r)break;return null;case 22:case 23:return t.lanes=0,Ha(e,t,n)}return ai(e,t,n)}(e,t,n);Ua=0!==(131072&e.flags)}else Ua=!1,Vn&&0!==(1048576&t.flags)&&On(t,Mn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var a=At(t,ut.current);un(t,n),a=Mr(null,t,r,e,a,n);var i=Fr();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(r)?(i=!0,yt(t)):i=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,pn(t),a.updater=Sn,t.stateNode=a,a._reactInternals=t,Bn(t,r,e,n),t=Wa(null,t,r,!0,i,n)):(t.tag=0,Vn&&i&&zn(t),Pa(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Zs(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===f)return 11;if(e===y)return 14}return 2}(r),e=en(r,e),a){case 0:t=Qa(null,t,r,e,n);break e;case 1:t=Va(null,t,r,e,n);break e;case 11:t=Da(null,t,r,e,n);break e;case 14:t=Oa(null,t,r,en(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Qa(e,t,r,a=t.elementType===r?a:en(r,a),n);case 1:return r=t.type,a=t.pendingProps,Va(e,t,r,a=t.elementType===r?a:en(r,a),n);case 3:e:{if(Ga(t),null===e)throw Error(s(387));r=t.pendingProps,a=(i=t.memoizedState).element,fn(e,t),bn(t,r,null,n);var o=t.memoizedState;if(r=o.element,Y&&i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:o.cache,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Ka(e,t,r,n,a=Error(s(423)));break e}if(r!==a){t=Ka(e,t,r,n,a=Error(s(424)));break e}for(Y&&(Qn=He(t.stateNode.containerInfo),jn=t,Vn=!0,Gn=null,Wn=!1),n=sr(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),r===a){t=ai(e,t,n);break e}Pa(e,t,r,n)}t=t.child}return t;case 5:return pr(t),null===e&&Yn(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,o=a.children,j(r,a)?o=null:null!==i&&j(r,i)&&(t.flags|=32),ja(e,t),Pa(e,t,o,n),t.child;case 6:return null===e&&Yn(t),null;case 13:return Ya(e,t,n);case 4:return dr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ir(t,null,r,n):Pa(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,Da(e,t,r,a=t.elementType===r?a:en(r,a),n);case 7:return Pa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Pa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,on(0,r,o=a.value),null!==i)if(Wt(i.value,o)){if(i.children===a.children&&!ht.current){t=ai(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){o=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=mn(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),cn(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)o=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(o=i.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),cn(o,n,t),o=i.sibling}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===t){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}Pa(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,un(t,n),r=r(a=hn(a)),t.flags|=1,Pa(e,t,r,n),t.child;case 14:return a=en(r=t.type,t.pendingProps),Oa(e,t,r,a=en(r.type,a),n);case 15:return za(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:en(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(r)?(e=!0,yt(t)):e=!1,un(t,n),En(t,r,a),Bn(t,r,a,n),Wa(null,t,r,!0,e,n);case 19:return ri(e,t,n);case 22:return Ha(e,t,n)}throw Error(s(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(ws(e,134217728,bs()),uo(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=bs(),n=xs(e);ws(e,n,t),uo(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ct(t.pendingLanes);0!==n&&(Tt(t,1|n),Ss(t,Dt()),0===(6&Ki)&&(ls(),Yt()))}break;case 13:var r=bs();Is(function(){return ws(e,1,r)}),uo(e,1)}},t.batchedUpdates=function(e,t){var n=Ki;Ki|=1;try{return e(t)}finally{0===(Ki=n)&&(ls(),Kt&&Yt())}},t.createComponentSelector=function(e){return{$$typeof:Mi,value:e}},t.createContainer=function(e,t,n,r,a,i,s){return so(e,t,!1,null,0,r,0,i,s)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Fi,value:e}},t.createHydrationContainer=function(e,t,n,r,a,i,s,o,l){return(e=so(n,r,!0,e,0,i,0,o,l)).context=oo(null),n=e.current,(i=mn(r=bs(),a=xs(n))).callback=void 0!==t&&null!==t?t:null,gn(n,i),e.current.lanes=a,It(e,a,r),Ss(e,r),e},t.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Ri,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Li,value:e}},t.createTextSelector=function(e){return{$$typeof:Ui,value:e}},t.deferredUpdates=function(e){var t=Mt,n=Gi.transition;try{return Gi.transition=null,Mt=16,e()}finally{Mt=t,Gi.transition=n}},t.discreteUpdates=function(e,t,n,r,a){var i=Mt,s=Gi.transition;try{return Gi.transition=null,Mt=1,e(t,n,r,a)}finally{Mt=i,Gi.transition=s,0===Ki&&ls()}},t.findAllNodes=ji,t.findBoundingRects=function(e,t){if(!re)throw Error(s(363));t=ji(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ie(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,a=r+n.width,i=n.y,o=i+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,h=u+c.width,d=c.y,A=d+c.height;if(r>=u&&i>=d&&a<=h&&o<=A){e.splice(t,1);break}if(!(r!==u||n.width!==c.width||A<i||d>o)){d>i&&(c.height+=d-i,c.y=i),A<o&&(c.height=o-d),e.splice(t,1);break}if(!(i!==d||n.height!==c.height||h<r||u>a)){u>r&&(c.width+=u-r,c.x=r),h<a&&(c.width=a-u),e.splice(t,1);break}}return e},t.findHostInstance=lo,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=N(e))?I(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return lo(e)},t.flushControlled=function(e){var t=Ki;Ki|=1;var n=Gi.transition,r=Mt;try{Gi.transition=null,Mt=1,e()}finally{Mt=r,Gi.transition=n,0===(Ki=t)&&(ls(),Yt())}},t.flushPassiveEffects=js,t.flushSync=Is,t.focusWithin=function(e,t){if(!re)throw Error(s(363));for(t=Hi(e=Di(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!oe(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Mt},t.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(s(363));var n=0,r=[];e=[Di(e),0];for(var a=0;a<e.length;){var i=e[a++],o=e[a++],l=t[o];if((5!==i.tag||!oe(i))&&(Oi(i,l)&&(r.push(zi(l)),++o>n&&(n=o)),o<t.length))for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(zi(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?F(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:ho,findFiberByHostInstance:e.findFiberByHostInstance||Ao,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Qt=t.inject(e),Vt=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(s(363));e=ji(e,t);var a=ue(e,n,r).disconnect;return{disconnect:function(){a()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Mt;try{return Mt=e,t()}finally{Mt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,r){var a=t.current,i=bs(),s=xs(a);return n=oo(n),null===t.context?t.context=n:t.pendingContext=n,(t=mn(i,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),gn(a,t),null!==(e=ws(a,s,i))&&yn(e,a,s),s},t}},7066:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.xor128=o}(0,e=n.nmd(e),n.amdD)},7205:(e,t,n)=>{"use strict";e.exports=n(7302)},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,s=a>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(m=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,m&&(m=!1,y(E),E=-1),p=!0;var i=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!k());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&a(c),b(n)}else a(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,B=-1;function k(){return!(t.unstable_now()-B<N)}function I(){if(null!==C){var e=t.unstable_now();B=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(I)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,M=T.port2;T.port1.onmessage=I,_=function(){M.postMessage(null)}}else _=function(){g(I,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,a,i){var s=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?s+i:s:i=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>s?(e.sortIndex=i,n(u,e),null===r(c)&&e===r(u)&&(m?(y(E),E=-1):m=!0,R(x,i-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}},7302:(e,t)=>{"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},7359:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new i(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.alea=o}(0,e=n.nmd(e),n.amdD)},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8108:()=>{},8513:(e,t,n)=>{"use strict";e.exports=n(2062)},8590:()=>{},8784:(e,t,n)=>{"use strict";e.exports=n(9813)},8818:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(C){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function s(e,t){var n,r,s;return t?(s=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=l(e,(0|e)<0?-1:0,!0),s&&(i[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=l(e,e<0?-1:0,!1),s&&(a[e]=n),n)}function o(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=A)return w}else{if(e<=-p)return _;if(e+1>=p)return x}return e<0?o(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=s,n.fromNumber=o,n.fromBits=l;var c=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return u(e.substring(1),t,n).neg();for(var a=o(c(n,8)),i=m,s=0;s<e.length;s+=8){var l=Math.min(8,e.length-s),h=parseInt(e.substring(s,s+l),n);if(l<8){var d=o(c(n,l));i=i.mul(d).add(o(h))}else i=(i=i.mul(a)).add(o(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?o(e,t):"string"===typeof e?u(e,t):l(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=h;var d=4294967296,A=d*d,p=A/2,f=s(1<<24),m=s(0);n.ZERO=m;var g=s(0,!0);n.UZERO=g;var y=s(1);n.ONE=y;var v=s(1,!0);n.UONE=v;var b=s(-1);n.NEG_ONE=b;var x=l(-1,2147483647,!1);n.MAX_VALUE=x;var w=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var _=l(0,-2147483648,!1);n.MIN_VALUE=_;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=o(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=o(c(e,6),this.unsigned),i=this,s="";;){var l=i.div(a),u=(i.sub(l.mul(a)).toInt()>>>0).toString(e);if((i=l).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(y)},S.neg=S.negate,S.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,s=e.high>>>16,o=65535&e.high,c=e.low>>>16,u=0,d=0,A=0,p=0;return A+=(p+=i+(65535&e.low))>>>16,d+=(A+=a+c)>>>16,u+=(d+=n+o)>>>16,u+=t+s,l((A&=65535)<<16|(p&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(_))return e.isOdd()?_:m;if(e.eq(_))return this.isOdd()?_:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return o(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,s=65535&this.low,c=e.high>>>16,u=65535&e.high,d=e.low>>>16,A=65535&e.low,p=0,g=0,y=0,v=0;return y+=(v+=s*A)>>>16,g+=(y+=i*A)>>>16,y&=65535,g+=(y+=s*d)>>>16,p+=(g+=a*A)>>>16,g&=65535,p+=(g+=i*d)>>>16,g&=65535,p+=(g+=s*u)>>>16,p+=n*A+a*d+i*u+s*c,l((y&=65535)<<16|(v&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return v;i=g}else{if(this.eq(_))return e.eq(y)||e.eq(b)?_:e.eq(_)?y:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:b:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(_))return this.unsigned?g:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:c(2,s-48),d=o(n),A=d.mul(e);A.isNegative()||A.gt(a);)A=(d=o(n-=u,this.unsigned)).mul(e);d.isZero()&&(d=y),i=i.add(d),a=a.sub(A)}return i},S.div=S.divide,S.modulo=function(e){return r(e)||(e=h(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return l(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},9016:function(e,t,n){var r;!function(e,a){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.xorwow=o}(0,e=n.nmd(e),n.amdD)},9538:function(e,t,n){var r;!function(e,a){function i(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,a))||(a.exports=r):this.xorshift7=o}(0,e=n.nmd(e),n.amdD)},9813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,s=a>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(m=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,m&&(m=!1,y(E),E=-1),p=!0;var i=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!k());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&a(c),b(n)}else a(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,B=-1;function k(){return!(t.unstable_now()-B<N)}function I(){if(null!==C){var e=t.unstable_now();B=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(I)};else if("undefined"!==typeof MessageChannel){var T=new MessageChannel,M=T.port2;T.port1.onmessage=I,_=function(){M.postMessage(null)}}else _=function(){g(I,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,a,i){var s=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?s+i:s:i=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>s?(e.sortIndex=i,n(u,e),null===r(c)&&e===r(u)&&(m?(y(E),E=-1):m=!0,R(x,i-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>s[e]=()=>r[e]);return s.default=()=>r,n.d(i,s),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+"."+{455:"073ea903",977:"fde04b13"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="bhotch-crm:";n.l=(r,a,i,s)=>{if(e[r])e[r].push(a);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+i){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+i),o.src=r),e[r]=[a];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(A);var a=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach(e=>e(n)),t)return t(n)},A=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((n,r)=>a=e[t]=[n,r]);r.push(a[2]=i);var s=n.p+n.u(t),o=new Error;n.l(s,r=>{if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,a[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var a,i,s=r[0],o=r[1],l=r[2],c=0;if(s.some(t=>0!==e[t])){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(l)l(n)}for(t&&t(r);c<s.length;c++)i=s[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkbhotch_crm=self.webpackChunkbhotch_crm||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>fo,AddEquation:()=>Fs,AddOperation:()=>co,AdditiveAnimationBlendMode:()=>Zl,AdditiveBlending:()=>ks,AgXToneMapping:()=>go,AlphaFormat:()=>$o,AlwaysCompare:()=>Uc,AlwaysDepth:()=>eo,AlwaysStencilFunc:()=>Bc,AmbientLight:()=>ty,AnimationAction:()=>Gy,AnimationClip:()=>_g,AnimationLoader:()=>Mg,AnimationMixer:()=>qy,AnimationObjectGroup:()=>Wy,AnimationUtils:()=>ug,ArcCurve:()=>Rf,ArrayCamera:()=>wy,ArrowHelper:()=>Xv,AttachedBindMode:()=>vo,Audio:()=>Iy,AudioAnalyser:()=>Uy,AudioContext:()=>my,AudioListener:()=>ky,AudioLoader:()=>gy,AxesHelper:()=>Yv,BackSide:()=>Cs,BasicDepthPacking:()=>nc,BasicShadowMap:()=>bs,BatchedMesh:()=>Qp,Bone:()=>ep,BooleanKeyframeTrack:()=>mg,Box2:()=>hv,Box3:()=>Gu,Box3Helper:()=>Vv,BoxGeometry:()=>tA,BoxHelper:()=>Qv,BufferAttribute:()=>Sd,BufferGeometry:()=>Hd,BufferGeometryLoader:()=>ly,ByteType:()=>Ho,Cache:()=>Cg,Camera:()=>oA,CameraHelper:()=>zv,CanvasTexture:()=>yf,CapsuleGeometry:()=>xf,CatmullRomCurve3:()=>zf,CineonToneMapping:()=>po,CircleGeometry:()=>wf,ClampToEdgeWrapping:()=>Bo,Clock:()=>_y,Color:()=>hd,ColorKeyframeTrack:()=>gg,ColorManagement:()=>Bu,CompressedArrayTexture:()=>mf,CompressedCubeTexture:()=>gf,CompressedTexture:()=>ff,CompressedTextureLoader:()=>Fg,ConeGeometry:()=>Sf,ConstantAlphaFactor:()=>Js,ConstantColorFactor:()=>Xs,Controls:()=>Zv,CubeCamera:()=>AA,CubeReflectionMapping:()=>wo,CubeRefractionMapping:()=>_o,CubeTexture:()=>pA,CubeTextureLoader:()=>Ug,CubeUVReflectionMapping:()=>Eo,CubicBezierCurve:()=>Vf,CubicBezierCurve3:()=>Wf,CubicInterpolant:()=>dg,CullFaceBack:()=>gs,CullFaceFront:()=>ys,CullFaceFrontBack:()=>vs,CullFaceNone:()=>ms,Curve:()=>Mf,CurvePath:()=>Zf,CustomBlending:()=>Ms,CustomToneMapping:()=>mo,CylinderGeometry:()=>_f,Cylindrical:()=>lv,Data3DTexture:()=>Vu,DataArrayTexture:()=>ju,DataTexture:()=>tp,DataTextureLoader:()=>Pg,DataUtils:()=>bd,DecrementStencilOp:()=>gc,DecrementWrapStencilOp:()=>vc,DefaultLoadingManager:()=>Ng,DepthFormat:()=>nl,DepthStencilFormat:()=>rl,DepthTexture:()=>vf,DetachedBindMode:()=>bo,DirectionalLight:()=>ey,DirectionalLightHelper:()=>Pv,DiscreteInterpolant:()=>pg,DodecahedronGeometry:()=>Ef,DoubleSide:()=>Es,DstAlphaFactor:()=>Vs,DstColorFactor:()=>Gs,DynamicCopyUsage:()=>Vc,DynamicDrawUsage:()=>Dc,DynamicReadUsage:()=>Hc,EdgesGeometry:()=>Tf,EllipseCurve:()=>Ff,EqualCompare:()=>Tc,EqualDepth:()=>ro,EqualStencilFunc:()=>_c,EquirectangularReflectionMapping:()=>So,EquirectangularRefractionMapping:()=>Co,Euler:()=>kh,EventDispatcher:()=>$c,ExternalTexture:()=>bf,ExtrudeGeometry:()=>Tm,FileLoader:()=>Tg,Float16BufferAttribute:()=>Md,Float32BufferAttribute:()=>Fd,FloatType:()=>Go,Fog:()=>bA,FogExp2:()=>vA,FramebufferTexture:()=>pf,FrontSide:()=>Ss,Frustum:()=>xp,FrustumArray:()=>Sp,GLBufferAttribute:()=>ev,GLSL1:()=>Gc,GLSL3:()=>Kc,GreaterCompare:()=>Fc,GreaterDepth:()=>io,GreaterEqualCompare:()=>Lc,GreaterEqualDepth:()=>ao,GreaterEqualStencilFunc:()=>Nc,GreaterStencilFunc:()=>Cc,GridHelper:()=>Mv,Group:()=>mA,HalfFloatType:()=>Ko,HemisphereLight:()=>zg,HemisphereLightHelper:()=>Tv,IcosahedronGeometry:()=>Fm,ImageBitmapLoader:()=>py,ImageLoader:()=>Lg,ImageUtils:()=>Mu,IncrementStencilOp:()=>mc,IncrementWrapStencilOp:()=>yc,InstancedBufferAttribute:()=>ip,InstancedBufferGeometry:()=>oy,InstancedInterleavedBuffer:()=>$y,InstancedMesh:()=>Ap,Int16BufferAttribute:()=>Bd,Int32BufferAttribute:()=>Id,Int8BufferAttribute:()=>Cd,IntType:()=>Vo,InterleavedBuffer:()=>wA,InterleavedBufferAttribute:()=>SA,Interpolant:()=>hg,InterpolateDiscrete:()=>Wl,InterpolateLinear:()=>Gl,InterpolateSmooth:()=>Kl,InterpolationSamplingMode:()=>Zc,InterpolationSamplingType:()=>Jc,InvertStencilOp:()=>bc,KeepStencilOp:()=>pc,KeyframeTrack:()=>fg,LOD:()=>QA,LatheGeometry:()=>Rm,Layers:()=>Ih,LessCompare:()=>Ic,LessDepth:()=>to,LessEqualCompare:()=>Mc,LessEqualDepth:()=>no,LessEqualStencilFunc:()=>Sc,LessStencilFunc:()=>wc,Light:()=>Og,LightProbe:()=>ay,Line:()=>Zp,Line3:()=>vv,LineBasicMaterial:()=>Vp,LineCurve:()=>Gf,LineCurve3:()=>Kf,LineDashedMaterial:()=>ag,LineLoop:()=>rf,LineSegments:()=>nf,LinearFilter:()=>Lo,LinearInterpolant:()=>Ag,LinearMipMapLinearFilter:()=>Oo,LinearMipMapNearestFilter:()=>Po,LinearMipmapLinearFilter:()=>Do,LinearMipmapNearestFilter:()=>Uo,LinearSRGBColorSpace:()=>uc,LinearToneMapping:()=>ho,LinearTransfer:()=>hc,Loader:()=>Bg,LoaderUtils:()=>sy,LoadingManager:()=>Eg,LoopOnce:()=>jl,LoopPingPong:()=>Vl,LoopRepeat:()=>Ql,MOUSE:()=>ps,Material:()=>pd,MaterialLoader:()=>iy,MathUtils:()=>uu,Matrix2:()=>cv,Matrix3:()=>mu,Matrix4:()=>vh,MaxEquation:()=>Ps,Mesh:()=>$d,MeshBasicMaterial:()=>fd,MeshDepthMaterial:()=>tg,MeshDistanceMaterial:()=>ng,MeshLambertMaterial:()=>eg,MeshMatcapMaterial:()=>rg,MeshNormalMaterial:()=>$m,MeshPhongMaterial:()=>Jm,MeshPhysicalMaterial:()=>Ym,MeshStandardMaterial:()=>Xm,MeshToonMaterial:()=>Zm,MinEquation:()=>Us,MirroredRepeatWrapping:()=>ko,MixOperation:()=>lo,MultiplyBlending:()=>Ts,MultiplyOperation:()=>oo,NearestFilter:()=>Io,NearestMipMapLinearFilter:()=>Ro,NearestMipMapNearestFilter:()=>Mo,NearestMipmapLinearFilter:()=>Fo,NearestMipmapNearestFilter:()=>To,NeutralToneMapping:()=>yo,NeverCompare:()=>kc,NeverDepth:()=>$s,NeverStencilFunc:()=>xc,NoBlending:()=>Ns,NoColorSpace:()=>lc,NoToneMapping:()=>uo,NormalAnimationBlendMode:()=>Jl,NormalBlending:()=>Bs,NotEqualCompare:()=>Rc,NotEqualDepth:()=>so,NotEqualStencilFunc:()=>Ec,NumberKeyframeTrack:()=>yg,Object3D:()=>Gh,ObjectLoader:()=>cy,ObjectSpaceNormalMap:()=>oc,OctahedronGeometry:()=>Lm,OneFactor:()=>Os,OneMinusConstantAlphaFactor:()=>Zs,OneMinusConstantColorFactor:()=>Ys,OneMinusDstAlphaFactor:()=>Ws,OneMinusDstColorFactor:()=>Ks,OneMinusSrcAlphaFactor:()=>Qs,OneMinusSrcColorFactor:()=>Hs,OrthographicCamera:()=>Zg,PCFShadowMap:()=>xs,PCFSoftShadowMap:()=>ws,PMREMGenerator:()=>Nb,Path:()=>$f,PerspectiveCamera:()=>hA,Plane:()=>gp,PlaneGeometry:()=>Um,PlaneHelper:()=>Wv,PointLight:()=>Jg,PointLightHelper:()=>Nv,Points:()=>uf,PointsMaterial:()=>af,PolarGridHelper:()=>Fv,PolyhedronGeometry:()=>Cf,PositionalAudio:()=>Ly,PropertyBinding:()=>Vy,PropertyMixer:()=>Py,QuadraticBezierCurve:()=>qf,QuadraticBezierCurve3:()=>Xf,Quaternion:()=>du,QuaternionKeyframeTrack:()=>bg,QuaternionLinearInterpolant:()=>vg,RED_GREEN_RGTC2_Format:()=>zl,RED_RGTC1_Format:()=>Dl,REVISION:()=>As,RGBADepthPacking:()=>rc,RGBAFormat:()=>tl,RGBAIntegerFormat:()=>cl,RGBA_ASTC_10x10_Format:()=>Ml,RGBA_ASTC_10x5_Format:()=>kl,RGBA_ASTC_10x6_Format:()=>Il,RGBA_ASTC_10x8_Format:()=>Tl,RGBA_ASTC_12x10_Format:()=>Fl,RGBA_ASTC_12x12_Format:()=>Rl,RGBA_ASTC_4x4_Format:()=>xl,RGBA_ASTC_5x4_Format:()=>wl,RGBA_ASTC_5x5_Format:()=>_l,RGBA_ASTC_6x5_Format:()=>Sl,RGBA_ASTC_6x6_Format:()=>Cl,RGBA_ASTC_8x5_Format:()=>El,RGBA_ASTC_8x6_Format:()=>Nl,RGBA_ASTC_8x8_Format:()=>Bl,RGBA_BPTC_Format:()=>Ll,RGBA_ETC2_EAC_Format:()=>bl,RGBA_PVRTC_2BPPV1_Format:()=>gl,RGBA_PVRTC_4BPPV1_Format:()=>ml,RGBA_S3TC_DXT1_Format:()=>hl,RGBA_S3TC_DXT3_Format:()=>dl,RGBA_S3TC_DXT5_Format:()=>Al,RGBDepthPacking:()=>ac,RGBFormat:()=>el,RGBIntegerFormat:()=>ll,RGB_BPTC_SIGNED_Format:()=>Ul,RGB_BPTC_UNSIGNED_Format:()=>Pl,RGB_ETC1_Format:()=>yl,RGB_ETC2_Format:()=>vl,RGB_PVRTC_2BPPV1_Format:()=>fl,RGB_PVRTC_4BPPV1_Format:()=>pl,RGB_S3TC_DXT1_Format:()=>ul,RGDepthPacking:()=>ic,RGFormat:()=>sl,RGIntegerFormat:()=>ol,RawShaderMaterial:()=>qm,Ray:()=>yh,Raycaster:()=>nv,RectAreaLight:()=>ny,RedFormat:()=>al,RedIntegerFormat:()=>il,ReinhardToneMapping:()=>Ao,RenderTarget:()=>zu,RenderTarget3D:()=>Xy,RepeatWrapping:()=>No,ReplaceStencilOp:()=>fc,ReverseSubtractEquation:()=>Ls,RingGeometry:()=>Pm,SIGNED_RED_GREEN_RGTC2_Format:()=>Hl,SIGNED_RED_RGTC1_Format:()=>Ol,SRGBColorSpace:()=>cc,SRGBTransfer:()=>dc,Scene:()=>xA,ShaderChunk:()=>rb,ShaderLib:()=>ib,ShaderMaterial:()=>sA,ShadowMaterial:()=>Km,Shape:()=>em,ShapeGeometry:()=>Dm,ShapePath:()=>Jv,ShapeUtils:()=>Bm,ShortType:()=>jo,Skeleton:()=>ap,SkeletonHelper:()=>Cv,SkinnedMesh:()=>$A,Source:()=>Ru,Sphere:()=>uh,SphereGeometry:()=>Om,Spherical:()=>ov,SphericalHarmonics3:()=>ry,SplineCurve:()=>Yf,SpotLight:()=>Gg,SpotLightHelper:()=>xv,Sprite:()=>OA,SpriteMaterial:()=>CA,SrcAlphaFactor:()=>js,SrcAlphaSaturateFactor:()=>qs,SrcColorFactor:()=>zs,StaticCopyUsage:()=>Qc,StaticDrawUsage:()=>Pc,StaticReadUsage:()=>zc,StereoCamera:()=>xy,StreamCopyUsage:()=>Wc,StreamDrawUsage:()=>Oc,StreamReadUsage:()=>jc,StringKeyframeTrack:()=>xg,SubtractEquation:()=>Rs,SubtractiveBlending:()=>Is,TOUCH:()=>fs,TangentSpaceNormalMap:()=>sc,TetrahedronGeometry:()=>zm,Texture:()=>Du,TextureLoader:()=>Dg,TextureUtils:()=>eb,Timer:()=>iv,TimestampQuery:()=>Yc,TorusGeometry:()=>Hm,TorusKnotGeometry:()=>jm,Triangle:()=>sd,TriangleFanDrawMode:()=>tc,TriangleStripDrawMode:()=>ec,TrianglesDrawMode:()=>$l,TubeGeometry:()=>Qm,UVMapping:()=>xo,Uint16BufferAttribute:()=>kd,Uint32BufferAttribute:()=>Td,Uint8BufferAttribute:()=>Ed,Uint8ClampedBufferAttribute:()=>Nd,Uniform:()=>Yy,UniformsGroup:()=>Zy,UniformsLib:()=>ab,UniformsUtils:()=>iA,UnsignedByteType:()=>zo,UnsignedInt101111Type:()=>Zo,UnsignedInt248Type:()=>Yo,UnsignedInt5999Type:()=>Jo,UnsignedIntType:()=>Wo,UnsignedShort4444Type:()=>qo,UnsignedShort5551Type:()=>Xo,UnsignedShortType:()=>Qo,VSMShadowMap:()=>_s,Vector2:()=>hu,Vector3:()=>Au,Vector4:()=>Ou,VectorKeyframeTrack:()=>wg,VideoFrameTexture:()=>Af,VideoTexture:()=>df,WebGL3DRenderTarget:()=>Wu,WebGLArrayRenderTarget:()=>Qu,WebGLCoordinateSystem:()=>qc,WebGLCubeRenderTarget:()=>fA,WebGLRenderTarget:()=>Hu,WebGLRenderer:()=>Uw,WebGLUtils:()=>kw,WebGPUCoordinateSystem:()=>Xc,WebXRController:()=>yA,WireframeGeometry:()=>Vm,WrapAroundEnding:()=>Yl,ZeroCurvatureEnding:()=>ql,ZeroFactor:()=>Ds,ZeroSlopeEnding:()=>Xl,ZeroStencilOp:()=>Ac,createCanvasElement:()=>wu});var t={};n.r(t),n.d(t,{CompositeArrayBuffer:()=>mT,browserFiles:()=>hF,browserHTTPRequest:()=>bF,concatenateArrayBuffers:()=>UT,copyModel:()=>xM,decodeWeights:()=>NT,decodeWeightsStream:()=>MT,encodeWeights:()=>ET,fromMemory:()=>SF,fromMemorySync:()=>CF,getLoadHandlers:()=>KT,getModelArtifactsForJSON:()=>zT,getModelArtifactsForJSONSync:()=>OT,getModelArtifactsInfoForJSON:()=>HT,getSaveHandlers:()=>GT,getWeightSpecs:()=>jT,http:()=>vF,isHTTPScheme:()=>gF,listModels:()=>vM,loadWeights:()=>pF,moveModel:()=>wM,registerLoadRouter:()=>WT,registerSaveRouter:()=>VT,removeModel:()=>bM,weightsLoaderFactory:()=>fF,withSaveHandler:()=>EF,withSaveHandlerSync:()=>NF});var r={};n.r(r),n.d(r,{assertParamsValid:()=>RF,computeFlatOffset:()=>KF,computeOutShape:()=>UF,getNormalizedAxes:()=>zF,isSliceContinous:()=>GF,maskToAxes:()=>LF,parseSliceParams:()=>qF,sliceInfo:()=>XF,startForAxis:()=>VF,startIndicesWithElidedDims:()=>HF,stopForAxis:()=>WF,stopIndicesWithElidedDims:()=>jF,stridesForAxis:()=>QF,stridesWithElidedDims:()=>PF});var a={};n.r(a),n.d(a,{conv2d:()=>lD,depthwiseConv2d:()=>hD,matMul:()=>dD});var i={};n.r(i),n.d(i,{collectGatherOpShapeInfo:()=>_z,computeOutShape:()=>wz,segOpComputeOptimalWindowSize:()=>xz});var s={};n.r(s),n.d(s,{ERF_A1:()=>OO,ERF_A2:()=>zO,ERF_A3:()=>HO,ERF_A4:()=>jO,ERF_A5:()=>QO,ERF_P:()=>DO,PARALLELIZE_THRESHOLD:()=>NO,RowPartitionType:()=>wO,SELU_SCALE:()=>PO,SELU_SCALEALPHA:()=>UO,applyActivation:()=>sD,assertAndGetBroadcastShape:()=>tF,assertAxesAreInnerMostDims:()=>wL,assertParamsConsistent:()=>bO,assignToTypedArray:()=>XO,axesAreInnerMostDims:()=>yL,calculateShapes:()=>UP,checkEinsumDimSizes:()=>az,checkPadOnDimRoundingMode:()=>_R,combineLocations:()=>vL,combineRaggedTensorToTensorShapes:()=>_O,complexWithEvenIndex:()=>GO,complexWithOddIndex:()=>KO,computeConv2DInfo:()=>dR,computeConv3DInfo:()=>AR,computeDefaultPad:()=>pR,computeDilation2DInfo:()=>cR,computeOptimalWindowSize:()=>BO,computeOutAndReduceShapes:()=>bL,computeOutShape:()=>xO,computePool2DInfo:()=>uR,computePool3DInfo:()=>hR,convertConv2DDataFormat:()=>wR,decodeEinsumEquation:()=>nz,eitherStridesOrDilationsAreOne:()=>bR,expandShapeToKeepDim:()=>xL,exponent:()=>JO,exponents:()=>YO,fromStringArrayToUint8:()=>Cz,fromUint8ToStringArray:()=>Sz,getAxesPermutation:()=>_L,getBroadcastDims:()=>$M,getComplexWithIndex:()=>qO,getEinsumComputePath:()=>iz,getEinsumPermutation:()=>rz,getFusedBiasGradient:()=>iD,getFusedDyActivation:()=>aD,getImageCenter:()=>kO,getInnerMostAxes:()=>CL,getPermuted:()=>TO,getRaggedRank:()=>CO,getReductionAxes:()=>eF,getReshaped:()=>IO,getReshapedPermuted:()=>MO,getRowPartitionTypesHelper:()=>SO,getSliceBeginCoords:()=>FO,getSliceSize:()=>RO,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>cz,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>uz,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>hz,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>pz,getSparseReshapeInputOutputMismatchErrorMessage:()=>mz,getSparseReshapeInputOutputMultipleErrorMessage:()=>fz,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>dz,getSparseReshapeNegativeOutputDimErrorMessage:()=>Az,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>bz,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>gz,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>yz,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>vz,getUndoAxesPermutation:()=>SL,isIdentityPermutation:()=>sz,log:()=>Qk,mergeRealAndImagArrays:()=>VO,prepareAndValidate:()=>LO,prepareSplitSize:()=>lz,segment_util:()=>i,shouldFuse:()=>oD,slice_util:()=>r,splitRealAndImagArrays:()=>WO,stridesOrDilationsArePositive:()=>xR,tupleValuesAreOne:()=>vR,upcastType:()=>HI,validateDefaultValueShape:()=>EO,validateInput:()=>LP,validateUpdateShape:()=>RP,warn:()=>jk});var o={};n.r(o),n.d(o,{json:()=>wq});var l={};n.r(l),n.d(l,{json:()=>_q});var c={};n.r(c),n.d(c,{json:()=>Sq});var u={};n.r(u),n.d(u,{json:()=>Cq});var h={};n.r(h),n.d(h,{json:()=>Eq});var d={};n.r(d),n.d(d,{json:()=>Nq});var A={};n.r(A),n.d(A,{json:()=>Bq});var p={};n.r(p),n.d(p,{json:()=>kq});var f={};n.r(f),n.d(f,{json:()=>Iq});var m={};n.r(m),n.d(m,{json:()=>Tq});var g={};n.r(g),n.d(g,{json:()=>Mq});var y={};n.r(y),n.d(y,{json:()=>Fq});var v={};n.r(v),n.d(v,{json:()=>Rq});var b={};n.r(b),n.d(b,{json:()=>Lq});var x={};n.r(x),n.d(x,{json:()=>Uq});var w={};n.r(w),n.d(w,{json:()=>Pq});var _={};n.r(_),n.d(_,{json:()=>Dq});var S={};n.r(S),n.d(S,{json:()=>Oq});var C={};n.r(C),n.d(C,{json:()=>zq});var E={};n.r(E),n.d(E,{OP_SCOPE_SUFFIX:()=>uT,abs:()=>ZM,acos:()=>JF,acosh:()=>ZF,add:()=>TM,addN:()=>$F,all:()=>eR,any:()=>tR,argMax:()=>nR,argMin:()=>rR,asin:()=>aR,asinh:()=>iR,atan:()=>sR,atan2:()=>oR,atanh:()=>lR,avgPool:()=>CR,avgPool3d:()=>ER,basicLSTMCell:()=>MR,batchNorm:()=>RR,batchNorm2d:()=>LR,batchNorm3d:()=>UR,batchNorm4d:()=>PR,batchToSpaceND:()=>FR,bincount:()=>DR,bitwiseAnd:()=>OR,booleanMaskAsync:()=>KP,broadcastArgs:()=>zR,broadcastTo:()=>HR,buffer:()=>NM,cast:()=>BM,ceil:()=>jR,clipByValue:()=>QR,clone:()=>kM,complex:()=>dT,concat:()=>NR,concat1d:()=>VR,concat2d:()=>WR,concat3d:()=>GR,concat4d:()=>KR,conv1d:()=>XR,conv2d:()=>qR,conv2dTranspose:()=>JR,conv3d:()=>ZR,conv3dTranspose:()=>eL,cos:()=>tL,cosh:()=>nL,cosineWindow:()=>tD,cumprod:()=>rL,cumsum:()=>aL,denseBincount:()=>iL,depthToSpace:()=>sL,depthwiseConv2d:()=>oL,diag:()=>lL,dilation2d:()=>cL,div:()=>FM,divNoNan:()=>dL,dot:()=>AL,dropout:()=>$P,einsum:()=>pL,elu:()=>fL,enclosingPowerOfTwo:()=>eD,ensureShape:()=>mL,equal:()=>uL,erf:()=>gL,euclideanNorm:()=>TL,exp:()=>ML,expandDims:()=>FL,expm1:()=>RL,eye:()=>UL,fft:()=>yP,fill:()=>KM,floor:()=>PL,floorDiv:()=>MM,fused:()=>a,gather:()=>DL,gatherND:()=>ZP,greater:()=>OL,greaterEqual:()=>zL,ifft:()=>vP,imag:()=>HL,image:()=>dO,inTopKAsync:()=>nD,irfft:()=>bP,isFinite:()=>jL,isInf:()=>QL,isNaN:()=>VL,leakyRelu:()=>WL,less:()=>GL,lessEqual:()=>KL,linalg:()=>AO,linspace:()=>qL,localResponseNormalization:()=>XL,log:()=>YL,log1p:()=>JL,logSigmoid:()=>eU,logSoftmax:()=>tU,logSumExp:()=>nU,logicalAnd:()=>rU,logicalNot:()=>aU,logicalOr:()=>iU,logicalXor:()=>sU,losses:()=>pO,lowerBound:()=>cU,matMul:()=>BR,max:()=>EL,maxPool:()=>uU,maxPool3d:()=>hU,maxPoolWithArgmax:()=>dU,maximum:()=>nF,mean:()=>AU,meshgrid:()=>mU,min:()=>NL,minimum:()=>gU,mirrorPad:()=>yU,mod:()=>vU,moments:()=>bU,movingAverage:()=>XP,mul:()=>RM,multiRNNCell:()=>xU,multinomial:()=>wU,neg:()=>ZL,norm:()=>IL,notEqual:()=>_U,oneHot:()=>SU,ones:()=>fU,onesLike:()=>CU,op:()=>hT,outerProduct:()=>EU,pad:()=>NU,pad1d:()=>BU,pad2d:()=>kU,pad3d:()=>IU,pad4d:()=>TU,pool:()=>FU,pow:()=>XM,prelu:()=>RU,print:()=>IM,prod:()=>LU,raggedGather:()=>UU,raggedRange:()=>PU,raggedTensorToTensor:()=>DU,rand:()=>OU,randomGamma:()=>VU,randomNormal:()=>WU,randomStandardNormal:()=>GU,randomUniform:()=>KU,randomUniformInt:()=>qU,range:()=>XU,real:()=>YU,reciprocal:()=>JU,relu:()=>ZU,relu6:()=>$U,reshape:()=>SR,reverse:()=>eP,reverse1d:()=>tP,reverse2d:()=>nP,reverse3d:()=>rP,reverse4d:()=>aP,rfft:()=>wP,round:()=>iP,rsqrt:()=>sP,scalar:()=>OM,scatterND:()=>YP,searchSorted:()=>lU,selu:()=>oP,separableConv2d:()=>lP,setdiff1dAsync:()=>cP,sigmoid:()=>kR,sign:()=>uP,signal:()=>hO,sin:()=>hP,sinh:()=>dP,slice:()=>IR,slice1d:()=>AP,slice2d:()=>pP,slice3d:()=>fP,slice4d:()=>mP,softmax:()=>gP,softplus:()=>$L,spaceToBatchND:()=>MU,sparse:()=>fO,sparseToDense:()=>JP,spectral:()=>uO,split:()=>xP,sqrt:()=>LM,square:()=>UM,squaredDifference:()=>_P,squeeze:()=>SP,stack:()=>CP,step:()=>EP,stridedSlice:()=>NP,string:()=>mO,sub:()=>YM,sum:()=>BL,tan:()=>BP,tanh:()=>TR,tensor:()=>pT,tensor1d:()=>kP,tensor2d:()=>IP,tensor3d:()=>BF,tensor4d:()=>TP,tensor5d:()=>MP,tensor6d:()=>FP,tensorScatterUpdate:()=>PP,tile:()=>LL,topk:()=>DP,transpose:()=>qP,truncatedNormal:()=>OP,unique:()=>zP,unsortedSegmentSum:()=>HP,unstack:()=>jP,upperBound:()=>QP,variable:()=>VP,where:()=>hL,whereAsync:()=>GP,zeros:()=>pU,zerosLike:()=>PM});var N={};n.r(N),n.d(N,{mx:()=>HY,XI:()=>FJ,Nk:()=>RJ,f6:()=>UJ,ct:()=>UY,YG:()=>zJ,hH:()=>GJ,z3:()=>IZ,sG:()=>HZ,uM:()=>GZ,vS:()=>c$,qB:()=>g$,GG:()=>v$,lg:()=>S$,rq:()=>x$,cu:()=>P$,WR:()=>R$,GE:()=>z$,px:()=>j$,jC:()=>r0,He:()=>s0,hE:()=>m0,BF:()=>wZ,Dk:()=>E0,cl:()=>R0,_B:()=>K0,ub:()=>Z0,_f:()=>t1,Ku:()=>o1,qy:()=>c1,Zy:()=>x1,bu:()=>S1,zv:()=>NY,dH:()=>YY,HS:()=>kJ,yH:()=>V1,l3:()=>G1,z9:()=>q1,x6:()=>$1,_m:()=>s2,eW:()=>h2,GK:()=>p2,SP:()=>g2,yr:()=>v2,dl:()=>ZZ,Dw:()=>C2,xT:()=>k2,_X:()=>rJ,wz:()=>U2});var B=n(5043),k=n(4391),I=n(4980);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){(0,I.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function F(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const R=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),L=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},U=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var P={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const D=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],O=(0,B.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:s="",children:o,iconNode:l}=e,c=F(e,D);return(0,B.createElement)("svg",M(M(M({ref:t},P),{},{width:r,height:r,stroke:n,strokeWidth:i?24*Number(a)/Number(r):a,className:U("lucide",s)},!o&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"}),c),[...l.map(e=>{let[t,n]=e;return(0,B.createElement)(t,n)}),...Array.isArray(o)?o:[o]])}),z=["className"],H=(e,t)=>{const n=(0,B.forwardRef)((n,r)=>{let{className:a}=n,i=F(n,z);return(0,B.createElement)(O,M({ref:r,iconNode:t,className:U("lucide-".concat(R(L(e))),"lucide-".concat(e),a)},i))});return n.displayName=L(e),n},j=H("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Q=H("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),V=H("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),W=H("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),G=H("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),K=H("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),q=H("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),X=H("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),Y=H("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),J=H("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Z=H("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),$=H("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ee=H("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);let te="https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec";te&&te.includes("REACT_APP_GAS_WEB_APP_URL=")&&(te=te.split("REACT_APP_GAS_WEB_APP_URL=")[1]),te&&!te.startsWith("http")&&(te="https://"+te.replace(/^\/+/,""));const ne=new class{constructor(e){this.baseURL=e}async makeRequest(e,t){if(!this.baseURL)return{success:!1,message:"API endpoint is not configured."};try{const r=await fetch(this.baseURL,{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(M({action:e},t))});if(!r.ok)throw new Error("Server responded with status: ".concat(r.status));const a=await r.text();try{const e=JSON.parse(a);if(!1===e.success)throw new Error(e.message||"An unknown backend error occurred.");return e}catch(n){throw new Error("Invalid server response. The backend may have crashed.")}}catch(_S){return{success:!1,message:"Network error: ".concat(_S.message)}}}fetchLeads(){return this.makeRequest("getLeads",{})}addLead(e){return this.makeRequest("addLead",{lead:e})}updateLead(e){return this.makeRequest("updateLead",{lead:e})}deleteLead(e){return this.makeRequest("deleteLead",{leadId:e})}fetchJobCounts(){return this.makeRequest("getJobCounts",{})}addJobCount(e){return this.makeRequest("addJobCount",{jobCount:e})}updateJobCount(e){return this.makeRequest("updateJobCount",{jobCount:e})}deleteJobCount(e){return this.makeRequest("deleteJobCount",{jobCountId:e})}testConnection(){return this.makeRequest("testConnection",{})}geocodeAddress(e){return this.makeRequest("geocodeAddress",{address:e})}calculateLomacoVents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.makeRequest("calculateLomacoVents",{sqft:e,options:t})}batchCalculateVents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.makeRequest("batchCalculateVents",{jobCountIds:e})}}(te);const re="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";const ae="crm_communications";function ie(e){try{const t=JSON.parse(localStorage.getItem(ae)||"[]");return t.push(M(M({},e),{},{id:Date.now().toString()})),localStorage.setItem(ae,JSON.stringify(t)),{success:!0,data:e}}catch(_S){throw console.error("Error saving to local storage:",_S),_S}}function se(){try{return JSON.parse(localStorage.getItem(ae)||"[]")}catch(_S){return console.error("Error reading from local storage:",_S),[]}}function oe(e){const[t,n]=(0,B.useState)([]),[r,a]=(0,B.useState)(!1),[i,s]=(0,B.useState)(null),o=(0,B.useCallback)(()=>{try{const e=se();return n(e),e}catch(_S){return console.error("Error loading communications from local storage:",_S),[]}},[]);(0,B.useEffect)(()=>{o()},[o]);const l=(0,B.useCallback)(async t=>{a(!0);try{await async function(e){try{return await fetch("".concat(re,"?action=addCommunication"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"no-cors"}),console.log("Communication logged successfully:",e),{success:!0,data:e}}catch(_S){throw console.error("Error logging communication:",_S),new Error("Failed to log communication")}}(t);const r=ie(t);return n(e=>[...e,r.data]),e&&e("Communication logged successfully","success"),r.data}catch(_S){console.error("Error adding communication:",_S);try{const r=ie(t);return n(e=>[...e,r.data]),e&&e("Communication saved locally (offline mode)","warning"),r.data}catch(r){throw e&&e("Failed to save communication","error"),r}}finally{a(!1)}},[e]),c=(0,B.useCallback)(async e=>{a(!0);try{const t=await async function(e){try{return await fetch("".concat(re,"?action=getCommunications&leadId=").concat(e),{method:"GET",mode:"no-cors"}),console.log("Fetching communications for lead:",e),[]}catch(_S){return console.error("Error fetching communications:",_S),[]}}(e);if(!t||0===t.length){const t=se();return t.filter(t=>t.leadId===e)}return t}catch(_S){console.error("Error fetching communications for lead:",_S);return se().filter(t=>t.leadId===e)}finally{a(!1)}},[]),u=(0,B.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;a(!0);try{const t=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{return await fetch("".concat(re,"?action=getRecentCommunications&days=").concat(e),{method:"GET",mode:"no-cors"}),console.log("Fetching communications from last ".concat(e," days")),[]}catch(_S){return console.error("Error fetching recent communications:",_S),[]}}(e);if(!t||0===t.length){const t=se(),r=new Date;r.setDate(r.getDate()-e);const a=t.filter(e=>new Date(e.dateTime)>=r);return n(a),a}return n(t),t}catch(_S){console.error("Error fetching recent communications:",_S);const r=se(),a=new Date;a.setDate(a.getDate()-e);const i=r.filter(e=>new Date(e.dateTime)>=a);return n(i),i}finally{a(!1)}},[]),h=(0,B.useCallback)(async()=>{a(!0);try{const e=await async function(){try{return await fetch("".concat(re,"?action=getCommunicationStats"),{method:"GET",mode:"no-cors"}),console.log("Fetching communication statistics"),{totalCalls:0,totalSMS:0,totalEmails:0,appointmentsConfirmed:0,noAnswers:0,voicemailsLeft:0}}catch(_S){return console.error("Error fetching communication stats:",_S),null}}();if(!e){const e=se(),t={totalCalls:e.filter(e=>"Call"===e.communicationType).length,totalSMS:e.filter(e=>"SMS"===e.communicationType).length,totalEmails:e.filter(e=>"Email"===e.communicationType).length,appointmentsConfirmed:e.filter(e=>{var t;return"Completed"===e.status&&(null===(t=e.notes)||void 0===t?void 0:t.includes("confirmed"))}).length,noAnswers:e.filter(e=>"No Answer"===e.status).length,voicemailsLeft:e.filter(e=>"Left Voicemail"===e.status).length};return s(t),t}return s(e),e}catch(_S){return console.error("Error fetching communication stats:",_S),null}finally{a(!1)}},[]),d=(0,B.useCallback)(async t=>{a(!0);try{await async function(e){try{return await fetch("".concat(re,"?action=deleteCommunication&id=").concat(e),{method:"DELETE",mode:"no-cors"}),console.log("Communication deleted:",e),{success:!0}}catch(_S){throw console.error("Error deleting communication:",_S),new Error("Failed to delete communication")}}(t),n(e=>e.filter(e=>e.id!==t)),e&&e("Communication deleted","success")}catch(_S){throw console.error("Error deleting communication:",_S),e&&e("Failed to delete communication","error"),_S}finally{a(!1)}},[e]);return{communications:t,loading:r,stats:i,addCommunication:l,getForLead:c,getRecent:u,getStats:h,removeCommunication:d,loadFromLocal:o}}const le=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let a=e.charCodeAt(r);a<128?t[n++]=a:a<2048?(t[n++]=a>>6|192,t[n++]=63&a|128):55296===(64512&a)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++r)),t[n++]=a>>18|240,t[n++]=a>>12&63|128,t[n++]=a>>6&63|128,t[n++]=63&a|128):(t[n++]=a>>12|224,t[n++]=a>>6&63|128,t[n++]=63&a|128)}return t},ce={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<e.length;a+=3){const t=e[a],i=a+1<e.length,s=i?e[a+1]:0,o=a+2<e.length,l=o?e[a+2]:0,c=t>>2,u=(3&t)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;o||(d=64,i||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(le(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const a=e[n++];if(a<128)t[r++]=String.fromCharCode(a);else if(a>191&&a<224){const i=e[n++];t[r++]=String.fromCharCode((31&a)<<6|63&i)}else if(a>239&&a<365){const i=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<e.length;){const t=n[e.charAt(a++)],i=a<e.length?n[e.charAt(a)]:0;++a;const s=a<e.length?n[e.charAt(a)]:64;++a;const o=a<e.length?n[e.charAt(a)]:64;if(++a,null==t||null==i||null==s||null==o)throw new ue;const l=t<<2|i>>4;if(r.push(l),64!==s){const e=i<<4&240|s>>2;if(r.push(e),64!==o){const e=s<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ue extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const he=function(e){return function(e){const t=le(e);return ce.encodeByteArray(t,!0)}(e).replace(/\./g,"")},de=function(e){try{return ce.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const Ae=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,pe=()=>{try{return Ae()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AUTH_CODE:"IAMBRANDON",REACT_APP_FIREBASE_API_KEY:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",REACT_APP_FIREBASE_APP_ID:"1:874590395925:web:41fff249ed9a7b349af81c",REACT_APP_FIREBASE_AUTH_DOMAIN:"crmbackend-470221.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-4BG7SZMK6K",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"874590395925",REACT_APP_FIREBASE_PROJECT_ID:"crmbackend-470221",REACT_APP_FIREBASE_STORAGE_BUCKET:"crmbackend-470221.firebasestorage.app",REACT_APP_GAS_WEB_APP_URL:"https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4",REACT_APP_SHEET_NAME:"Bhotchleads",REACT_APP_SPREADSHEET_ID:"1E9VX7XI7GNGJa8Hq9__XAWv95WNgfJto1gUEXMbGqi0",REACT_APP_TWILIO_ACCOUNT_SID:"AC20e24f43ac063d43511d06c688b5ec06",REACT_APP_TWILIO_AUTH_TOKEN:"65cc837132a39a100d4b03a8a234f2ed",REACT_APP_TWILIO_PHONE_NUMBER:"+13852357204"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&de(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},fe=e=>{var t,n;return null===(n=null===(t=pe())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},me=()=>{var e;return null===(e=pe())||void 0===e?void 0:e.config},ge=e=>{var t;return null===(t=pe())||void 0===t?void 0:t["_".concat(e)]};class ye{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function ve(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}class be extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,be.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xe.prototype.create)}}class xe{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],a=r?function(e,t){return e.replace(we,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",i="".concat(this.serviceName,": ").concat(a," (").concat(n,").");return new be(n,i,t)}}const we=/\{\$([^}]+)}/g;function _e(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return!1;const n=e[a],i=t[a];if(Se(n)&&Se(i)){if(!_e(n,i))return!1}else if(n!==i)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function Se(e){return null!==e&&"object"===typeof e}function Ce(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Ee(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Ne(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Be{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ke),void 0===r.error&&(r.error=ke),void 0===r.complete&&(r.complete=ke);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),a}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ke(){}function Ie(e){return e&&e._delegate?e._delegate:e}class Te{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Me="[DEFAULT]";class Fe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new ye;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Me})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[a,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(a)&&i.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),a=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;a.add(e),this.onInitCallbacks.set(r,a);const i=this.instances.get(r);return i&&e(i,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(hS){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(a=t,a===Me?void 0:a),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(hS){}var a;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;return this.component?this.component.multipleInstances?e:Me:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Re{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Fe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Le=[];var Ue;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Ue||(Ue={}));const Pe={debug:Ue.DEBUG,verbose:Ue.VERBOSE,info:Ue.INFO,warn:Ue.WARN,error:Ue.ERROR,silent:Ue.SILENT},De=Ue.INFO,Oe={[Ue.DEBUG]:"log",[Ue.VERBOSE]:"log",[Ue.INFO]:"info",[Ue.WARN]:"warn",[Ue.ERROR]:"error"},ze=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=Oe[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var a=arguments.length,i=new Array(a>2?a-2:0),s=2;s<a;s++)i[s-2]=arguments[s];console[r]("[".concat(n,"]  ").concat(e.name,":"),...i)};class He{constructor(e){this.name=e,this._logLevel=De,this._logHandler=ze,this._userLogHandler=null,Le.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ue))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?Pe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.DEBUG,...t),this._logHandler(this,Ue.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.VERBOSE,...t),this._logHandler(this,Ue.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.INFO,...t),this._logHandler(this,Ue.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.WARN,...t),this._logHandler(this,Ue.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.ERROR,...t),this._logHandler(this,Ue.ERROR,...t)}}let je,Qe;const Ve=new WeakMap,We=new WeakMap,Ge=new WeakMap,Ke=new WeakMap,qe=new WeakMap;let Xe={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return We.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ge.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ze(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ye(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Qe||(Qe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply($e(this),n),Ze(Ve.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ze(e.apply($e(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];const i=e.call($e(this),t,...r);return Ge.set(i,t.sort?t.sort():[t]),Ze(i)}}function Je(e){return"function"===typeof e?Ye(e):(e instanceof IDBTransaction&&function(e){if(We.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)});We.set(e,t)}(e),t=e,(je||(je=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Xe):e);var t}function Ze(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",a),e.removeEventListener("error",i)},a=()=>{t(Ze(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&Ve.set(t,e)}).catch(()=>{}),qe.set(t,e),t}(e);if(Ke.has(e))return Ke.get(e);const t=Je(e);return t!==e&&(Ke.set(e,t),qe.set(t,e)),t}const $e=e=>qe.get(e);const et=["get","getKey","getAll","getAllKeys","count"],tt=["put","add","delete","clear"],nt=new Map;function rt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(nt.get(t))return nt.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,a=tt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!a&&!et.includes(n))return;const i=async function(e){const t=this.transaction(e,a?"readwrite":"readonly");let i=t.store;for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];return r&&(i=i.index(o.shift())),(await Promise.all([i[n](...o),a&&t.done]))[0]};return nt.set(t,i),i}Xe=(e=>M(M({},e),{},{get:(t,n,r)=>rt(t,n)||e.get(t,n,r),has:(t,n)=>!!rt(t,n)||e.has(t,n)}))(Xe);class at{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const it="@firebase/app",st="0.10.13",ot=new He("@firebase/app"),lt="@firebase/app-compat",ct="@firebase/analytics-compat",ut="@firebase/analytics",ht="@firebase/app-check-compat",dt="@firebase/app-check",At="@firebase/auth",pt="@firebase/auth-compat",ft="@firebase/database",mt="@firebase/data-connect",gt="@firebase/database-compat",yt="@firebase/functions",vt="@firebase/functions-compat",bt="@firebase/installations",xt="@firebase/installations-compat",wt="@firebase/messaging",_t="@firebase/messaging-compat",St="@firebase/performance",Ct="@firebase/performance-compat",Et="@firebase/remote-config",Nt="@firebase/remote-config-compat",Bt="@firebase/storage",kt="@firebase/storage-compat",It="@firebase/firestore",Tt="@firebase/vertexai-preview",Mt="@firebase/firestore-compat",Ft="firebase",Rt="[DEFAULT]",Lt={[it]:"fire-core",[lt]:"fire-core-compat",[ut]:"fire-analytics",[ct]:"fire-analytics-compat",[dt]:"fire-app-check",[ht]:"fire-app-check-compat",[At]:"fire-auth",[pt]:"fire-auth-compat",[ft]:"fire-rtdb",[mt]:"fire-data-connect",[gt]:"fire-rtdb-compat",[yt]:"fire-fn",[vt]:"fire-fn-compat",[bt]:"fire-iid",[xt]:"fire-iid-compat",[wt]:"fire-fcm",[_t]:"fire-fcm-compat",[St]:"fire-perf",[Ct]:"fire-perf-compat",[Et]:"fire-rc",[Nt]:"fire-rc-compat",[Bt]:"fire-gcs",[kt]:"fire-gcs-compat",[It]:"fire-fst",[Mt]:"fire-fst-compat",[Tt]:"fire-vertex","fire-js":"fire-js",[Ft]:"fire-js-all"},Ut=new Map,Pt=new Map,Dt=new Map;function Ot(e,t){try{e.container.addComponent(t)}catch(n){ot.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function zt(e){const t=e.name;if(Dt.has(t))return ot.debug("There were multiple attempts to register component ".concat(t,".")),!1;Dt.set(t,e);for(const n of Ut.values())Ot(n,e);for(const n of Pt.values())Ot(n,e);return!0}function Ht(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function jt(e){return void 0!==e.settings}const Qt=new xe("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Vt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Te("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qt.create("app-deleted",{appName:this._name})}}const Wt="10.14.1";function Gt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:Rt,automaticDataCollectionEnabled:!1},t),a=r.name;if("string"!==typeof a||!a)throw Qt.create("bad-app-name",{appName:String(a)});if(n||(n=me()),!n)throw Qt.create("no-options");const i=Ut.get(a);if(i){if(_e(n,i.options)&&_e(r,i.config))return i;throw Qt.create("duplicate-app",{appName:a})}const s=new Re(a);for(const l of Dt.values())s.addComponent(l);const o=new Vt(n,r,s);return Ut.set(a,o),o}function Kt(e,t,n){var r;let a=null!==(r=Lt[e])&&void 0!==r?r:e;n&&(a+="-".concat(n));const i=a.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const e=['Unable to register library "'.concat(a,'" with version "').concat(t,'":')];return i&&e.push('library name "'.concat(a,'" contains illegal characters (whitespace or "/")')),i&&s&&e.push("and"),s&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void ot.warn(e.join(" "))}zt(new Te("".concat(a,"-version"),()=>({library:a,version:t}),"VERSION"))}const qt="firebase-heartbeat-store";let Xt=null;function Yt(){return Xt||(Xt=function(e,t){let{blocked:n,upgrade:r,blocking:a,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),o=Ze(s);return r&&s.addEventListener("upgradeneeded",e=>{r(Ze(s.result),e.oldVersion,e.newVersion,Ze(s.transaction),e)}),n&&s.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(qt)}catch(n){console.warn(n)}}}).catch(e=>{throw Qt.create("idb-open",{originalErrorMessage:e.message})})),Xt}async function Jt(e,t){try{const n=(await Yt()).transaction(qt,"readwrite"),r=n.objectStore(qt);await r.put(t,Zt(e)),await n.done}catch(n){if(n instanceof be)ot.warn(n.message);else{const e=Qt.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});ot.warn(e.message)}}}function Zt(e){return"".concat(e.name,"!").concat(e.options.appId)}class $t{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tn(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=en();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(n){ot.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=en(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const a of e){const e=n.find(e=>e.agent===a.agent);if(e){if(e.dates.push(a.date),nn(n)>t){e.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),nn(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),a=he(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return ot.warn(t),""}}}function en(){return(new Date).toISOString().substring(0,10)}class tn{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"===typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{var e;t((null===(e=a.error)||void 0===e?void 0:e.message)||"")}}catch(_S){t(_S)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Yt()).transaction(qt),n=await t.objectStore(qt).get(Zt(e));return await t.done,n}catch(t){if(t instanceof be)ot.warn(t.message);else{const e=Qt.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});ot.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Jt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Jt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function nn(e){return he(JSON.stringify({version:2,heartbeats:e})).length}var rn;rn="",zt(new Te("platform-logger",e=>new at(e),"PRIVATE")),zt(new Te("heartbeat",e=>new $t(e),"PRIVATE")),Kt(it,st,rn),Kt(it,st,"esm2017"),Kt("fire-js","");function an(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function sn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const on=sn,ln=new xe("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),cn=new He("@firebase/auth");function un(e){if(cn.logLevel<=Ue.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];cn.error("Auth (".concat(Wt,"): ").concat(e),...n)}}function hn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw fn(e,...n)}function dn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return fn(e,...n)}function An(e,t,n){const r=Object.assign(Object.assign({},on()),{[t]:n});return new xe("auth","Firebase",r).create(t,{appName:e.name})}function pn(e){return An(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return ln.create(e,...n)}function mn(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];throw fn(t,...r)}}function gn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw un(t),new Error(t)}function yn(e,t){e||gn(t)}function vn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function bn(){return"http:"===xn()||"https:"===xn()}function xn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function wn(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(bn()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class _n{constructor(e,t){this.shortDelay=e,this.longDelay=t,yn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ve())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return wn()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Sn(e,t){yn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Cn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void gn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void gn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void gn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const En={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Nn=new _n(3e4,6e4);function Bn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function kn(e,t,n,r){return In(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let a={},i={};r&&("GET"===t?i=r:a={body:JSON.stringify(r)});const s=Ce(Object.assign({key:e.config.apiKey},i)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},a);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),Cn.fetch()(Mn(e,e.config.apiHost,n,s),l)})}async function In(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},En),t);try{const t=new Rn(e),a=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await a.json();if("needConfirmation"in i)throw Ln(e,"account-exists-with-different-credential",i);if(a.ok&&!("errorMessage"in i))return i;{const t=a.ok?i.errorMessage:i.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ln(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Ln(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Ln(e,"user-disabled",i);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw An(e,o,s);hn(e,o)}}catch(a){if(a instanceof be)throw a;hn(e,"network-request-failed",{message:String(a)})}}async function Tn(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await kn(e,t,n,r,a);return"mfaPendingCredential"in i&&hn(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Mn(e,t,n,r){const a="".concat(t).concat(n,"?").concat(r);return e.config.emulator?Sn(e.config,a):"".concat(e.config.apiScheme,"://").concat(a)}function Fn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Rn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(dn(this.auth,"network-request-failed")),Nn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ln(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=dn(e,t,r);return a.customData._tokenResponse=n,a}function Un(e){return void 0!==e&&void 0!==e.enterprise}class Pn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Fn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Dn(e,t){return kn(e,"GET","/v2/recaptchaConfig",Bn(e,t))}async function On(e,t){return kn(e,"POST","/v1/accounts:lookup",t)}function zn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Hn(e){return 1e3*Number(e)}function jn(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return un("JWT malformed, contained fewer than 3 sections"),null;try{const e=de(n);return e?JSON.parse(e):(un("Failed to decode base64 JWT payload"),null)}catch(a){return un("Caught error parsing JWT payload as JSON",null===a||void 0===a?void 0:a.toString()),null}}function Qn(e){const t=jn(e);return mn(t,"internal-error"),mn("undefined"!==typeof t.exp,"internal-error"),mn("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Vn(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof be&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Wn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Gn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zn(this.lastLoginAt),this.creationTime=zn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Kn(e){var t;const n=e.auth,r=await e.getIdToken(),a=await Vn(e,On(n,{idToken:r}));mn(null===a||void 0===a?void 0:a.users.length,n,"internal-error");const i=a.users[0];e._notifyReloadListener(i);const s=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?qn(i.providerUserInfo):[],o=function(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,s),l=e.isAnonymous,c=!(e.email&&i.passwordHash)&&!(null===o||void 0===o?void 0:o.length),u=!!l&&c,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Gn(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(e,h)}function qn(e){return e.map(e=>{var{providerId:t}=e,n=an(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Xn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mn(e.idToken,"internal-error"),mn("undefined"!==typeof e.idToken,"internal-error"),mn("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Qn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mn(0!==e.length,"internal-error");const t=Qn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(mn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:a}=await async function(e,t){const n=await In(e,{},async()=>{const n=Ce({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:a}=e.config,i=Mn(e,r,"/v1/token","key=".concat(a)),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Cn.fetch()(i,{method:"POST",headers:s,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:a}=t,i=new Xn;return n&&(mn("string"===typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(mn("string"===typeof r,"internal-error",{appName:e}),i.accessToken=r),a&&(mn("number"===typeof a,"internal-error",{appName:e}),i.expirationTime=a),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Xn,this.toJSON())}_performRefresh(){return gn("not implemented")}}function Yn(e,t){mn("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Jn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,a=an(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Gn(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await Vn(this,this.stsTokenManager.getToken(this.auth,e));return mn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Ie(e),r=await n.getIdToken(t),a=jn(r);mn(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const i="object"===typeof a.firebase?a.firebase:void 0,s=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:a,token:r,authTime:zn(Hn(a.auth_time)),issuedAtTime:zn(Hn(a.iat)),expirationTime:zn(Hn(a.exp)),signInProvider:s||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Ie(e);await Kn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(mn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Jn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){mn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Kn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jt(this.auth.app))return Promise.reject(pn(this.auth));const e=await this.getIdToken();return await Vn(this,async function(e,t){return kn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,a,i,s,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(a=t.phoneNumber)&&void 0!==a?a:void 0,A=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(s=t.tenantId)&&void 0!==s?s:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,g=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:v,isAnonymous:b,providerData:x,stsTokenManager:w}=t;mn(y&&w,e,"internal-error");const _=Xn.fromJSON(this.name,w);mn("string"===typeof y,e,"internal-error"),Yn(u,e.name),Yn(h,e.name),mn("boolean"===typeof v,e,"internal-error"),mn("boolean"===typeof b,e,"internal-error"),Yn(d,e.name),Yn(A,e.name),Yn(p,e.name),Yn(f,e.name),Yn(m,e.name),Yn(g,e.name);const S=new Jn({uid:y,auth:e,email:h,emailVerified:v,displayName:u,isAnonymous:b,photoURL:A,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:m,lastLoginAt:g});return x&&Array.isArray(x)&&(S.providerData=x.map(e=>Object.assign({},e))),f&&(S._redirectEventId=f),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Xn;r.updateFromServerResponse(t);const a=new Jn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Kn(a),a}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];mn(void 0!==r.localId,"internal-error");const a=void 0!==r.providerUserInfo?qn(r.providerUserInfo):[],i=!(r.email&&r.passwordHash)&&!(null===a||void 0===a?void 0:a.length),s=new Xn;s.updateFromIdToken(n);const o=new Jn({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:i}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Gn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===a||void 0===a?void 0:a.length)};return Object.assign(o,l),o}}const Zn=new Map;function $n(e){yn(e instanceof Function,"Expected a class definition");let t=Zn.get(e);return t?(yn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Zn.set(e,t),t)}class er{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}er.type="NONE";const tr=er;function nr(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class rr{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:a}=this.auth;this.fullUserKey=nr(this.userKey,r.apiKey,a),this.fullPersistenceKey=nr("persistence",r.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Jn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new rr($n(tr),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let a=r[0]||$n(tr);const i=nr(n,e.config.apiKey,e.name);let s=null;for(const l of t)try{const t=await l._get(i);if(t){const n=Jn._fromJSON(e,t);l!==a&&(s=n),a=l;break}}catch(hS){}const o=r.filter(e=>e._shouldAllowMigration);return a._shouldAllowMigration&&o.length?(a=o[0],s&&await a._set(i,s.toJSON()),await Promise.all(t.map(async e=>{if(e!==a)try{await e._remove(i)}catch(hS){}})),new rr(a,e,n)):new rr(a,e,n)}}function ar(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(lr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ir(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ur(t))return"Blackberry";if(hr(t))return"Webos";if(sr(t))return"Safari";if((t.includes("chrome/")||or(t))&&!t.includes("edge/"))return"Chrome";if(cr(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function ir(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/firefox\//i.test(e)}function sr(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function or(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/crios\//i.test(e)}function lr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/iemobile/i.test(e)}function cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/android/i.test(e)}function ur(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/blackberry/i.test(e)}function hr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/webos/i.test(e)}function dr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ar(){return function(){const e=ve();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function pr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve();return dr(e)||cr(e)||hr(e)||ur(e)||/windows phone/i.test(e)||lr(e)}function fr(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=ar(ve());break;case"Worker":t="".concat(ar(ve()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(Wt,"/").concat(r)}class mr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(a){r(a)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(nle){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class gr{constructor(e){var t,n,r,a;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(a=e.forceUpgradeOnSignin)&&void 0!==a&&a,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,a,i,s;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(a=o.containsUppercaseLetter)||void 0===a||a),o.isValid&&(o.isValid=null===(i=o.containsNumericCharacter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNonAlphanumericCharacter)||void 0===s||s),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}class yr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new br(this),this.idTokenSubscription=new br(this),this.beforeStateQueue=new mr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ln,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$n(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await rr.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(a){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await On(this,{idToken:e}),n=await Jn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(jt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null===r||void 0===r?void 0:r._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==i||!(null===s||void 0===s?void 0:s.user)||(r=s.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return mn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Kn(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jt(this.app))return Promise.reject(pn(this));const t=e?Ie(e):null;return t&&mn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&mn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jt(this.app)?Promise.reject(pn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jt(this.app)?Promise.reject(pn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($n(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return kn(e,"GET","/v2/passwordPolicy",Bn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new gr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new xe("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return kn(e,"POST","/v2/accounts:revokeToken",Bn(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$n(e)||this._popupRedirectResolver;mn(t,this,"argument-error"),this.redirectPersistenceManager=await rr.create(this,[$n(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const a="function"===typeof t?t:t.next.bind(t);let i=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(mn(s,this,"internal-error"),s.then(()=>{i||a(this.currentUser)}),"function"===typeof t){const a=e.addObserver(t,n,r);return()=>{i=!0,a()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(cn.logLevel<=Ue.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];cn.warn("Auth (".concat(Wt,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function vr(e){return Ie(e)}class br{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Be(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return mn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let xr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wr(e){return xr.loadJS(e)}function _r(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Sr{constructor(e){this.type="recaptcha-enterprise",this.auth=vr(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const a=window.grecaptcha;Un(a)?a.enterprise.ready(()=>{a.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Dn(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Pn(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(a=>{if(!t&&Un(window.grecaptcha))n(a,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=xr.recaptchaEnterpriseScript;0!==t.length&&(t+=a),wr(t).then(()=>{n(a,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Cr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=new Sr(e);let i;try{i=await a.verify(n)}catch(_S){i=await a.verify(n,!0)}const s=Object.assign({},t);return r?Object.assign(s,{captchaResp:i}):Object.assign(s,{captchaResponse:i}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Er(e,t,n,r){var a;if(null===(a=e._getRecaptchaConfig())||void 0===a?void 0:a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Cr(e,t,n,"getOobCode"===n);return r(e,a)}return r(e,t).catch(async a=>{if(a.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const a=await Cr(e,t,n,"getOobCode"===n);return r(e,a)}return Promise.reject(a)})}function Nr(e,t,n){const r=vr(e);mn(r._canInitEmulator,r,"emulator-config-failed"),mn(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const a=!!(null===n||void 0===n?void 0:n.disableWarnings),i=Br(t),{host:s,port:o}=function(e){const t=Br(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const e=a[1];return{host:e,port:kr(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:kr(t)}}}(t),l=null===o?"":":".concat(o);r.config.emulator={url:"".concat(i,"//").concat(s).concat(l,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:a})}),a||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Br(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function kr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ir{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return gn("not implemented")}_getIdTokenResponse(e){return gn("not implemented")}_linkToIdToken(e,t){return gn("not implemented")}_getReauthenticationResolver(e){return gn("not implemented")}}async function Tr(e,t){return kn(e,"POST","/v1/accounts:signUp",t)}async function Mr(e,t){return Tn(e,"POST","/v1/accounts:signInWithPassword",Bn(e,t))}class Fr extends Ir{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Fr(e,t,"password")}static _fromEmailAndCode(e,t){return new Fr(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Er(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Mr);case"emailLink":return async function(e,t){return Tn(e,"POST","/v1/accounts:signInWithEmailLink",Bn(e,t))}(e,{email:this._email,oobCode:this._password});default:hn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Er(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Tr);case"emailLink":return async function(e,t){return Tn(e,"POST","/v1/accounts:signInWithEmailLink",Bn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:hn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Rr(e,t){return Tn(e,"POST","/v1/accounts:signInWithIdp",Bn(e,t))}class Lr extends Ir{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Lr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):hn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,a=an(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Lr(n,r);return i.idToken=a.idToken||void 0,i.accessToken=a.accessToken||void 0,i.secret=a.secret,i.nonce=a.nonce,i.pendingToken=a.pendingToken||null,i}_getIdTokenResponse(e){return Rr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Rr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ce(t)}return e}}const Ur={USER_NOT_FOUND:"user-not-found"};class Pr extends Ir{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Pr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Pr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Tn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Tn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,t));if(n.temporaryProof)throw Ln(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Tn(e,"POST","/v1/accounts:signInWithPhoneNumber",Bn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ur)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:a}=e;return n||t||r||a?new Pr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:a}):null}}class Dr{constructor(e){var t,n,r,a,i,s;const o=Ee(Ne(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);mn(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(a=o.continueUrl)&&void 0!==a?a:null,this.languageCode=null!==(i=o.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(s=o.tenantId)&&void 0!==s?s:null}static parseLink(e){const t=function(e){const t=Ee(Ne(e)).link,n=t?Ee(Ne(t)).deep_link_id:null,r=Ee(Ne(e)).deep_link_id;return(r?Ee(Ne(r)).link:null)||r||n||t||e}(e);try{return new Dr(t)}catch(hS){return null}}}class Or{constructor(){this.providerId=Or.PROVIDER_ID}static credential(e,t){return Fr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Dr.parseLink(t);return mn(n,"argument-error"),Fr._fromEmailAndCode(e,n.code,n.tenantId)}}Or.PROVIDER_ID="password",Or.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Or.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class zr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Hr extends zr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class jr extends Hr{constructor(){super("facebook.com")}static credential(e){return Lr._fromParams({providerId:jr.PROVIDER_ID,signInMethod:jr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jr.credentialFromTaggedObject(e)}static credentialFromError(e){return jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return jr.credential(t.oauthAccessToken)}catch(hS){return null}}}jr.FACEBOOK_SIGN_IN_METHOD="facebook.com",jr.PROVIDER_ID="facebook.com";class Qr extends Hr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Lr._fromParams({providerId:Qr.PROVIDER_ID,signInMethod:Qr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Qr.credentialFromTaggedObject(e)}static credentialFromError(e){return Qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return Qr.credential(n,r)}catch(hS){return null}}}Qr.GOOGLE_SIGN_IN_METHOD="google.com",Qr.PROVIDER_ID="google.com";class Vr extends Hr{constructor(){super("github.com")}static credential(e){return Lr._fromParams({providerId:Vr.PROVIDER_ID,signInMethod:Vr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vr.credentialFromTaggedObject(e)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Vr.credential(t.oauthAccessToken)}catch(hS){return null}}}Vr.GITHUB_SIGN_IN_METHOD="github.com",Vr.PROVIDER_ID="github.com";class Wr extends Hr{constructor(){super("twitter.com")}static credential(e,t){return Lr._fromParams({providerId:Wr.PROVIDER_ID,signInMethod:Wr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Wr.credentialFromTaggedObject(e)}static credentialFromError(e){return Wr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return Wr.credential(n,r)}catch(hS){return null}}}Wr.TWITTER_SIGN_IN_METHOD="twitter.com",Wr.PROVIDER_ID="twitter.com";class Gr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=await Jn._fromIdTokenResponse(e,n,r),i=Kr(n);return new Gr({user:a,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Kr(n);return new Gr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Kr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class qr extends be{constructor(e,t,n,r){var a;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,qr.prototype),this.customData={appName:e.name,tenantId:null!==(a=e.tenantId)&&void 0!==a?a:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new qr(e,t,n,r)}}function Xr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw qr._fromErrorAndOperation(e,n,t,r);throw n})}async function Yr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Vn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Gr._forOperation(e,"link",r)}async function Jr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(jt(r.app))return Promise.reject(pn(r));const a="reauthenticate";try{const i=await Vn(e,Xr(r,a,t,e),n);mn(i.idToken,r,"internal-error");const s=jn(i.idToken);mn(s,r,"internal-error");const{sub:o}=s;return mn(e.uid===o,r,"user-mismatch"),Gr._forOperation(e,a,i)}catch(i){throw(null===i||void 0===i?void 0:i.code)==="auth/".concat("user-not-found")&&hn(r,"user-mismatch"),i}}async function Zr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(jt(e.app))return Promise.reject(pn(e));const r="signIn",a=await Xr(e,r,t),i=await Gr._fromIdTokenResponse(e,r,a);return n||await e._updateCurrentUser(i.user),i}async function $r(e,t){return Zr(vr(e),t)}async function ea(e){const t=vr(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const ta="__sak";class na{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ta,"1"),this.storage.removeItem(ta),Promise.resolve(!0)):Promise.resolve(!1)}catch(hS){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ra extends na{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},a=this.storage.getItem(n);Ar()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ra.type="LOCAL";const aa=ra;class ia extends na{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ia.type="SESSION";const sa=ia;class oa{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new oa(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:a}=t.data,i=this.handlersMap[r];if(!(null===i||void 0===i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(i).map(async e=>e(t.origin,a)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function la(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}oa.receivers=[];class ca{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let a,i;return new Promise((s,o)=>{const l=la("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),a=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),s(t.data.response);break;default:clearTimeout(c),clearTimeout(a),o(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ua(){return window}function ha(){return"undefined"!==typeof ua().WorkerGlobalScope&&"function"===typeof ua().importScripts}const da="firebaseLocalStorageDb",Aa="firebaseLocalStorage",pa="fbase_key";class fa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ma(e,t){return e.transaction([Aa],t?"readwrite":"readonly").objectStore(Aa)}function ga(){const e=indexedDB.open(da,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Aa,{keyPath:pa})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(Aa)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(da);return new fa(e).toPromise()}(),t(await ga()))})})}async function ya(e,t,n){const r=ma(e,!0).put({[pa]:t,value:n});return new fa(r).toPromise()}function va(e,t){const n=ma(e,!0).delete(t);return new fa(n).toPromise()}class ba{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ga()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ha()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=oa._getInstance(ha()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ca(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(hS){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ga();return await ya(e,ta,"1"),await va(e,ta),!0}catch(hS){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ya(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=ma(e,!1).get(t),r=await new fa(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>va(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=ma(e,!1).getAll();return new fa(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:a}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(a)&&(this.notifyListeners(r,a),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ba.type="LOCAL";const xa=ba;_r("rcb"),new _n(3e4,6e4);const wa="recaptcha";async function _a(e,t,n){var r;const a=await n.verify();try{let i;if(mn("string"===typeof a,e,"argument-error"),mn(n.type===wa,e,"argument-error"),i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){mn("enroll"===t.type,e,"internal-error");const n=await function(e,t){return kn(e,"POST","/v2/accounts/mfaEnrollment:start",Bn(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:a}});return n.phoneSessionInfo.sessionInfo}{mn("signin"===t.type,e,"internal-error");const n=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;mn(n,e,"missing-multi-factor-info");const s=await function(e,t){return kn(e,"POST","/v2/accounts/mfaSignIn:start",Bn(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:a}});return s.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return kn(e,"POST","/v1/accounts:sendVerificationCode",Bn(e,t))}(e,{phoneNumber:i.phoneNumber,recaptchaToken:a});return t}}finally{n._reset()}}class Sa{constructor(e){this.providerId=Sa.PROVIDER_ID,this.auth=vr(e)}verifyPhoneNumber(e,t){return _a(this.auth,e,Ie(t))}static credential(e,t){return Pr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Sa.credentialFromTaggedObject(t)}static credentialFromError(e){return Sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?Pr._fromTokenResponse(n,r):null}}function Ca(e,t){return t?$n(t):(mn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Sa.PROVIDER_ID="phone",Sa.PHONE_SIGN_IN_METHOD="phone";class Ea extends Ir{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Rr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Rr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Na(e){return Zr(e.auth,new Ea(e),e.bypassAuthState)}function Ba(e){const{auth:t,user:n}=e;return mn(n,t,"internal-error"),Jr(n,new Ea(e),e.bypassAuthState)}async function ka(e){const{auth:t,user:n}=e;return mn(n,t,"internal-error"),Yr(n,new Ea(e),e.bypassAuthState)}class Ia{constructor(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:a,error:i,type:s}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:a||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Na;case"linkViaPopup":case"linkViaRedirect":return ka;case"reauthViaPopup":case"reauthViaRedirect":return Ba;default:hn(this.auth,"internal-error")}}resolve(e){yn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ta=new _n(2e3,1e4);class Ma extends Ia{constructor(e,t,n,r,a){super(e,t,r,a),this.provider=n,this.authWindow=null,this.pollId=null,Ma.currentPopupAction&&Ma.currentPopupAction.cancel(),Ma.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mn(e,this.auth,"internal-error"),e}async onExecution(){yn(1===this.filter.length,"Popup operations only handle one event");const e=la();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(dn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(dn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ma.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dn(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ta.get())};e()}}Ma.currentPopupAction=null;const Fa=new Map;class Ra extends Ia{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Fa.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Pa(t),r=Ua(e);if(!await r._isAvailable())return!1;const a="true"===await r._get(n);return await r._remove(n),a}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Fa.set(this.auth._key(),e)}return this.bypassAuthState||Fa.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function La(e,t){Fa.set(e._key(),t)}function Ua(e){return $n(e._redirectPersistence)}function Pa(e){return nr("pendingRedirect",e.config.apiKey,e.name)}async function Da(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(jt(e.app))return Promise.reject(pn(e));const r=vr(e),a=Ca(r,t),i=new Ra(r,a,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}class Oa{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ha(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Ha(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(dn(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(za(e))}saveEventToCache(e){this.cachedEventUids.add(za(e)),this.lastProcessedEventTime=Date.now()}}function za(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ha(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const ja=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qa=/^https?/;async function Va(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return kn(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(Wa(n))return}catch(hS){}hn(e,"unauthorized-domain")}function Wa(e){const t=vn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const a=new URL(e);return""===a.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&a.hostname===r}if(!Qa.test(n))return!1;if(ja.test(e))return r===e;const a=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const Ga=new _n(3e4,6e4);function Ka(){const e=ua().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function qa(e){return new Promise((t,n)=>{var r,a,i;function s(){Ka(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Ka(),n(dn(e,"network-request-failed"))},timeout:Ga.get()})}if(null===(a=null===(r=ua().gapi)||void 0===r?void 0:r.iframes)||void 0===a?void 0:a.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=ua().gapi)||void 0===i?void 0:i.load)){const t=_r("iframefcb");return ua()[t]=()=>{gapi.load?s():n(dn(e,"network-request-failed"))},wr("".concat(xr.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}s()}}).catch(e=>{throw Xa=null,e})}let Xa=null;const Ya=new _n(5e3,15e3),Ja={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Za=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $a(e){const t=e.config;mn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Sn(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:Wt},a=Za.get(e.config.apiHost);a&&(r.eid=a);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),"".concat(n,"?").concat(Ce(r).slice(1))}async function ei(e){const t=await function(e){return Xa=Xa||qa(e),Xa}(e),n=ua().gapi;return mn(n,e,"internal-error"),t.open({where:document.body,url:$a(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ja,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const a=dn(e,"network-request-failed"),i=ua().setTimeout(()=>{r(a)},Ya.get());function s(){ua().clearTimeout(i),n(t)}t.ping(s).then(s,()=>{r(a)})}))}const ti={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ni{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ri(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const i=Math.max((window.screen.availHeight-a)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},ti),{width:r.toString(),height:a.toString(),top:i,left:s}),c=ve().toLowerCase();n&&(o=or(c)?"_blank":n),ir(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return dr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new ni(null);const h=window.open(t||"",o,u);mn(h,e,"popup-blocked");try{h.focus()}catch(d){}return new ni(h)}const ai="__/auth/handler",ii="emulator/auth/handler",si=encodeURIComponent("fac");async function oi(e,t,n,r,a,i){mn(e.config.authDomain,e,"auth-domain-config-required"),mn(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Wt,eventId:a};if(t instanceof zr){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))s[e]=t}if(t instanceof Hr){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const o=s;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const l=await e._getAppCheckToken(),c=l?"#".concat(si,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(ai);return Sn(t,ii)}(e),"?").concat(Ce(o).slice(1)).concat(c)}const li="webStorageSupport";const ci=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sa,this._completeRedirectFn=Da,this._overrideRedirectResult=La}async _openPopup(e,t,n,r){var a;yn(null===(a=this.eventManagers[e._key()])||void 0===a?void 0:a.manager,"_initialize() not called before _openPopup()");return ri(e,await oi(e,t,n,vn(),r),la())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){ua().location.href=e}(await oi(e,t,n,vn(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(yn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ei(e),n=new Oa(e);return t.register("authEvent",t=>{mn(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(li,{type:li},n=>{var r;const a=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[li];void 0!==a&&t(!!a),hn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Va(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return pr()||sr()||dr()}};var ui="@firebase/auth",hi="1.7.9";class di{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ai=ge("authIdTokenMaxAge")||300;let pi=null;var fi;!function(e){xr=e}({loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=dn("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),fi="Browser",zt(new Te("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=r.options;mn(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:s,authDomain:o,clientPlatform:fi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fr(fi)},c=new yr(r,a,i,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map($n);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),zt(new Te("auth-internal",e=>(e=>new di(e))(vr(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Kt(ui,hi,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(fi)),Kt(ui,hi,"esm2017");Kt("firebase","10.14.1","app");const mi={apiKey:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",authDomain:"crmbackend-470221.firebaseapp.com",projectId:"crmbackend-470221",storageBucket:"crmbackend-470221.firebasestorage.app",messagingSenderId:"874590395925",appId:"1:874590395925:web:41fff249ed9a7b349af81c"};if(!mi.apiKey)throw new Error("Firebase config is missing: `REACT_APP_FIREBASE_API_KEY` is not set.");const gi=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt;const t=Ut.get(e);if(!t&&e===Rt&&me())return Gt();if(!t)throw Qt.create("no-app",{appName:e});return t}();const t=Ht(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ht(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(_e(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;hn(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ci,persistence:[xa,aa,sa]}),r=ge("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(a=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ai)return;const r=null===t||void 0===t?void 0:t.token;pi!==r&&(pi=r,await fetch(a,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){Ie(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){Ie(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var a;const i=fe("auth");return i&&Nr(n,"http://".concat(i)),n}(Gt(mi));var yi=n(579);const vi=function(e){let{onLogin:t}=e;const[n,r]=(0,B.useState)({email:"",password:""}),[a,i]=(0,B.useState)(""),[s,o]=(0,B.useState)(!1);return(0,yi.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,yi.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-96",children:[(0,yi.jsxs)("div",{className:"text-center mb-6",children:[(0,yi.jsx)("div",{className:"bg-blue-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:(0,yi.jsx)(V,{className:"h-10 w-10 text-blue-600"})}),(0,yi.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Bhotch CRM"}),(0,yi.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Sign in to manage your leads"})]}),a&&(0,yi.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm",children:a}),(0,yi.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),o(!0),i("");try{await function(e,t,n){return jt(e.app)?Promise.reject(pn(e)):$r(Ie(e),Or.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&ea(e),t})}(gi,n.email,n.password),sessionStorage.setItem("isAuthenticated","true"),t()}catch(r){i("Login failed. Please check credentials.")}finally{o(!1)}},className:"space-y-4",children:[(0,yi.jsx)("input",{type:"email",placeholder:"Email",value:n.email,onChange:e=>r(t=>M(M({},t),{},{email:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,yi.jsx)("input",{type:"password",placeholder:"Password",value:n.password,onChange:e=>r(t=>M(M({},t),{},{password:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,yi.jsx)("button",{type:"submit",disabled:s,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center",children:s?(0,yi.jsx)(j,{className:"animate-spin h-5 w-5"}):"Sign In"})]})]})})},bi=B.memo(e=>{let{title:t,value:n,color:r,icon:a}=e;const i=(0,B.useMemo)(()=>({blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",green:"bg-green-100 text-green-800",purple:"bg-purple-100 text-purple-800"}),[]);return(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow p-5",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"p-3 rounded-full ".concat(i[r]),children:a&&(0,yi.jsx)(a,{size:24})}),(0,yi.jsxs)("div",{className:"ml-4",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-500 truncate",children:t}),(0,yi.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n})]})]})})}),xi=H("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),wi=H("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),_i=H("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const Si=function(e){let{stats:t,leads:n,jobCounts:r=[],onNavigateToTab:a}=e;const i=n.slice(0,5);return(0,yi.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,yi.jsx)("div",{className:"flex justify-between items-center",children:(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Dashboard"}),(0,yi.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Welcome to your roofing business overview"})]})}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,yi.jsx)(bi,{title:"Total Leads",value:t.totalLeads,icon:xi,color:"blue"}),(0,yi.jsx)(bi,{title:"Hot Leads",value:t.hotLeads,icon:wi,color:"red"}),(0,yi.jsx)(bi,{title:"Quoted Leads",value:t.quotedLeads,icon:_i,color:"green"}),(0,yi.jsx)(bi,{title:"Total Quote Value",value:(s=t.totalQuoteValue,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)),icon:Q,color:"purple"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 lg:p-6",children:[(0,yi.jsx)("h3",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:"Recent Leads"}),0===i.length?(0,yi.jsx)("p",{className:"text-sm lg:text-base text-gray-500",children:"No leads yet. Add your first lead to get started!"}):(0,yi.jsx)("div",{className:"overflow-x-auto",children:(0,yi.jsxs)("table",{className:"min-w-full",children:[(0,yi.jsx)("thead",{children:(0,yi.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,yi.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Name"}),(0,yi.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Quality"}),(0,yi.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm hidden sm:table-cell",children:"Disposition"}),(0,yi.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Quote"}),(0,yi.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm hidden md:table-cell",children:"Notes"})]})}),(0,yi.jsx)("tbody",{children:i.map((e,t)=>(0,yi.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,yi.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-900 text-xs lg:text-sm",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"}),(0,yi.jsx)("td",{className:"py-2 px-2 lg:px-4",children:(0,yi.jsx)("span",{className:"px-1.5 lg:px-2 py-0.5 lg:py-1 rounded-full text-xs font-medium ".concat("Hot"===e.quality?"bg-red-100 text-red-800":"Warm"===e.quality?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:e.quality})}),(0,yi.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-600 text-xs lg:text-sm hidden sm:table-cell",children:e.disposition||"New"}),(0,yi.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-900 text-xs lg:text-sm",children:e.dabellaQuote||"N/A"}),(0,yi.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-600 text-xs lg:text-sm max-w-xs truncate hidden md:table-cell",children:e.notes||"No notes"})]},e.id||t))})]})})]})]});var s},Ci=H("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ei=H("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ni=H("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),Bi=H("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),ki=H("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ii=H("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ti=H("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Mi=H("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),Fi=H("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ri=H("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),Li=H("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Ui=H("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Pi=H("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Di=function(e){let{leads:t,onAddLead:n,onEditLead:r,onDeleteLead:a,onRefreshLeads:i,onSelectLead:s}=e;const[o,l]=(0,B.useState)(""),[c,u]=(0,B.useState)(""),[h,d]=(0,B.useState)({key:null,direction:"asc"}),[A,p]=(0,B.useState)({}),[f,m]=(0,B.useState)(!1),[g,y]=(0,B.useState)(1),[v,b]=(0,B.useState)(25),[x,w]=(0,B.useState)(!1),_={id:!1,date:!0,createdDate:!1,modifiedDate:!1,customerName:!0,firstName:!1,lastName:!1,phoneNumber:!0,email:!1,address:!0,latitude:!1,longitude:!1,quality:!0,disposition:!0,leadSource:!0,status:!1,roofAge:!1,roofType:!1,sqFt:!0,ridgeLf:!0,valleyLf:!0,eavesLf:!1,dabellaQuote:!0,ridgeVents:!1,turbine:!1,rimeFlow:!1,highProfileRidgeCap:!1,valleyMetal:!1,pipes1Half:!1,pipes2:!1,pipes3:!1,pipes4:!1,gables:!1,turtleBacks:!1,satellite:!1,chimney:!1,solar:!1,swampCooler:!1,guttersLf:!1,downspouts:!1,gutterGuardLf:!1,permanentLighting:!1,notes:!1},S=()=>{try{const e=localStorage.getItem("leadsVisibleColumns");if(e)return JSON.parse(e)}catch(_S){console.error("Error loading saved columns:",_S)}return _},[C,E]=(0,B.useState)(S),[N,k]=(0,B.useState)(S),I=(0,B.useCallback)(()=>{try{localStorage.setItem("leadsVisibleColumns",JSON.stringify(N)),E(N),w(!1)}catch(_S){console.error("Error saving columns:",_S)}},[N]),T=(0,B.useCallback)(e=>{const t={New:{bg:"bg-blue-100",text:"text-blue-800",icon:Ci},Scheduled:{bg:"bg-cyan-100",text:"text-cyan-800",icon:q},Insurance:{bg:"bg-indigo-100",text:"text-indigo-800",icon:Ei},Quoted:{bg:"bg-yellow-100",text:"text-yellow-800",icon:Q},"Follow Up":{bg:"bg-orange-100",text:"text-orange-800",icon:ee},"Closed Sold":{bg:"bg-green-100",text:"text-green-800",icon:Z},"Closed Lost":{bg:"bg-red-100",text:"text-red-800",icon:J}}[e]||{bg:"bg-gray-100",text:"text-gray-800",icon:$},n=t.icon;return(0,yi.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.bg," ").concat(t.text),children:[(0,yi.jsx)(n,{className:"w-3 h-3 mr-1"}),e]})},[]),F=(0,B.useCallback)(e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",[]),R=(0,B.useCallback)(e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(t){return e}},[]),L=(0,B.useCallback)(e=>{const t=String(e||"");if(!t)return"-";const n=t.replace(/\D/g,"");return 10===n.length?"(".concat(n.slice(0,3),") ").concat(n.slice(3,6),"-").concat(n.slice(6)):t},[]),U=(0,B.useCallback)(e=>{d(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},[]),P=(0,B.useMemo)(()=>[{key:"id",label:"ID",type:"text",category:"Basic"},{key:"date",label:"Date",type:"date",category:"Basic"},{key:"createdDate",label:"Created Date",type:"date",category:"Basic"},{key:"modifiedDate",label:"Modified Date",type:"date",category:"Basic"},{key:"customerName",label:"Customer Name",type:"text",category:"Basic"},{key:"firstName",label:"First Name",type:"text",category:"Basic"},{key:"lastName",label:"Last Name",type:"text",category:"Basic"},{key:"phoneNumber",label:"Phone Number",type:"text",category:"Basic"},{key:"email",label:"Email",type:"text",category:"Basic"},{key:"address",label:"Address",type:"text",category:"Basic"},{key:"latitude",label:"Latitude",type:"number",category:"Basic"},{key:"longitude",label:"Longitude",type:"number",category:"Basic"},{key:"quality",label:"Quality",type:"text",category:"Lead Info"},{key:"disposition",label:"Disposition",type:"text",category:"Lead Info"},{key:"leadSource",label:"Lead Source",type:"text",category:"Lead Info"},{key:"status",label:"Status",type:"text",category:"Lead Info"},{key:"roofAge",label:"Roof Age",type:"text",category:"Roof Info"},{key:"roofType",label:"Roof Type",type:"text",category:"Roof Info"},{key:"sqFt",label:"SQ FT",type:"number",category:"Measurements"},{key:"ridgeLf",label:"Ridge LF",type:"number",category:"Measurements"},{key:"valleyLf",label:"Valley LF",type:"number",category:"Measurements"},{key:"eavesLf",label:"Eaves LF",type:"number",category:"Measurements"},{key:"dabellaQuote",label:"DaBella Quote",type:"number",category:"Financial"},{key:"ridgeVents",label:"Ridge Vents",type:"number",category:"Ventilation"},{key:"turbine",label:"Turbine",type:"number",category:"Ventilation"},{key:"rimeFlow",label:"Rime Flow",type:"number",category:"Ventilation"},{key:"highProfileRidgeCap",label:"High Profile Ridge Cap",type:"number",category:"Components"},{key:"valleyMetal",label:"Valley Metal",type:"number",category:"Components"},{key:"pipes1Half",label:'Pipes 1.5"',type:"number",category:"Pipes"},{key:"pipes2",label:'Pipes 2"',type:"number",category:"Pipes"},{key:"pipes3",label:'Pipes 3"',type:"number",category:"Pipes"},{key:"pipes4",label:'Pipes 4"',type:"number",category:"Pipes"},{key:"gables",label:"Gables",type:"number",category:"Features"},{key:"turtleBacks",label:"Turtle Backs",type:"number",category:"Features"},{key:"satellite",label:"Satellite",type:"number",category:"Features"},{key:"chimney",label:"Chimney",type:"number",category:"Features"},{key:"solar",label:"Solar",type:"number",category:"Features"},{key:"swampCooler",label:"Swamp Cooler",type:"number",category:"Features"},{key:"guttersLf",label:"Gutters LF",type:"number",category:"Gutters"},{key:"downspouts",label:"Downspouts",type:"number",category:"Gutters"},{key:"gutterGuardLf",label:"Gutter Guard LF",type:"number",category:"Gutters"},{key:"permanentLighting",label:"Permanent Lighting",type:"number",category:"Additional"},{key:"notes",label:"Notes",type:"text",category:"Additional"}],[]),D=(0,B.useCallback)((e,t)=>{const n=P.find(e=>e.key===t);return"customerName"===t?e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown":"number"===(null===n||void 0===n?void 0:n.type)?parseFloat(e[t])||0:e[t]||""},[P]),O=(0,B.useCallback)(e=>{k(t=>M(M({},t),{},{[e]:!t[e]}))},[]),z=(0,B.useCallback)((e,t)=>{p(n=>{const r=M({},n);return""===t||null===t||void 0===t?delete r[e]:r[e]=t,y(1),r})},[]),H=(0,B.useCallback)(()=>{p({}),l(""),u(""),y(1)},[]),j=(0,B.useMemo)(()=>{let e=t.filter(e=>{var t;const n=!o||[e.firstName,e.lastName,e.customerName,null===(t=e.phoneNumber)||void 0===t?void 0:t.toString(),e.address,e.quality,e.disposition,e.leadSource].some(e=>null===e||void 0===e?void 0:e.toLowerCase().includes(o.toLowerCase())),r=!c||e.date===c,a=Object.entries(A).every(t=>{let n,[r,a]=t;if(!a)return!0;if("customerName"===r)n=e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim();else{const t=P.find(e=>e.key===r);n="number"===(null===t||void 0===t?void 0:t.type)?parseFloat(e[r])||0:e[r]||""}const i=P.find(e=>e.key===r);return"number"===(null===i||void 0===i?void 0:i.type)?n>=parseFloat(a):n.toString().toLowerCase().includes(a.toLowerCase())});return n&&r&&a});return h.key&&e.sort((e,t)=>{const n=D(e,h.key),r=D(t,h.key);if("string"===typeof n&&"string"===typeof r){const e=n.toLowerCase().localeCompare(r.toLowerCase());return"asc"===h.direction?e:-e}{const e=n-r;return"asc"===h.direction?e:-e}}),e},[t,o,c,A,h,D,P]),V=(0,B.useMemo)(()=>{const e=(g-1)*v,t=e+v;return j.slice(e,t)},[j,g,v]),W=Math.ceil(j.length/v),G=(0,B.useMemo)(()=>o||c||Object.keys(A).length>0,[o,c,A]),K=e=>{var t;let{sortKey:n,children:r,className:a=""}=e;const i=A[n];return(0,yi.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(a),children:(0,yi.jsxs)("div",{className:"space-y-2",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors select-none p-1 rounded",onClick:()=>U(n),children:[(0,yi.jsx)("span",{className:i?"text-blue-600 font-semibold":"",children:r}),(0,yi.jsxs)("div",{className:"flex items-center space-x-1",children:[i&&(0,yi.jsx)(Ni,{className:"w-3 h-3 text-blue-600"}),(0,yi.jsxs)("div",{className:"flex flex-col",children:[(0,yi.jsx)(Bi,{className:"w-3 h-3 ".concat(h.key===n&&"asc"===h.direction?"text-blue-600":"text-gray-300")}),(0,yi.jsx)(ki,{className:"w-3 h-3 -mt-1 ".concat(h.key===n&&"desc"===h.direction?"text-blue-600":"text-gray-300")})]})]})]}),f&&(0,yi.jsx)(X,{column:n,value:A[n]||"",onChange:e=>z(n,e),type:(null===(t=P.find(e=>e.key===n))||void 0===t?void 0:t.type)||"text"})]})})},X=e=>{let{column:t,value:n,onChange:r,type:a}=e;const i="number"===a?"Min value...":"Filter...";return(0,yi.jsxs)("div",{className:"relative",children:[(0,yi.jsx)("input",{type:"number"===a?"number":"date"===a?"date":"text",value:n,onChange:e=>r(e.target.value),placeholder:i,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",onClick:e=>e.stopPropagation()}),n&&(0,yi.jsx)("button",{onClick:e=>{e.stopPropagation(),r("")},className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{className:"w-3 h-3"})})]})};return(0,yi.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,yi.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Lead Management"}),(0,yi.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Track and manage your sales leads"})]}),(0,yi.jsxs)("div",{className:"flex items-center space-x-2 lg:space-x-3",children:[(0,yi.jsxs)("button",{onClick:i,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-gray-300 rounded-lg text-xs lg:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[(0,yi.jsx)(Ti,{className:"w-3 h-3 lg:w-4 lg:h-4 lg:mr-2"}),(0,yi.jsx)("span",{className:"hidden lg:inline",children:"Refresh"})]}),(0,yi.jsxs)("button",{onClick:n,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-transparent rounded-lg text-xs lg:text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(Ci,{className:"w-3 h-3 lg:w-4 lg:h-4 mr-1 lg:mr-2"}),"Add Lead"]})]})]}),(0,yi.jsx)("div",{className:"bg-white p-3 lg:p-6 rounded-lg shadow-sm border",children:(0,yi.jsxs)("div",{className:"space-y-3 lg:space-y-4",children:[(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 lg:gap-4",children:[(0,yi.jsxs)("div",{className:"relative md:col-span-2",children:[(0,yi.jsx)(Mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,yi.jsx)("input",{type:"text",placeholder:"Search across all fields...",value:o,onChange:e=>l(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,yi.jsxs)("div",{className:"relative",children:[(0,yi.jsx)(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,yi.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,yi.jsxs)("button",{onClick:()=>m(!f),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(f?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,yi.jsx)(Ni,{className:"w-4 h-4 mr-2"}),"Column Filters",Object.keys(A).length>0&&(0,yi.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:Object.keys(A).length})]}),(0,yi.jsxs)("button",{onClick:()=>w(!x),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(x?"border-purple-500 text-purple-700 bg-purple-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,yi.jsx)(Fi,{className:"w-4 h-4 mr-2"}),"Manage Columns",(0,yi.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full",children:Object.values(C).filter(Boolean).length})]}),G&&(0,yi.jsxs)("button",{onClick:H,className:"inline-flex items-center px-3 py-2 border border-red-300 rounded-lg text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 transition-colors",children:[(0,yi.jsx)(Ii,{className:"w-4 h-4 mr-2"}),"Clear All Filters"]})]}),(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsxs)("select",{value:v,onChange:e=>{b(Number(e.target.value)),y(1)},className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,yi.jsx)("option",{value:10,children:"10 per page"}),(0,yi.jsx)("option",{value:25,children:"25 per page"}),(0,yi.jsx)("option",{value:50,children:"50 per page"}),(0,yi.jsx)("option",{value:100,children:"100 per page"})]}),(0,yi.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",0===j.length?0:(g-1)*v+1,"-",Math.min(g*v,j.length)," of ",j.length]})]})]})]})}),x&&(0,yi.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,yi.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,yi.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Visible Columns"}),(0,yi.jsx)("button",{onClick:()=>{k(C),w(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{className:"w-5 h-5"})})]}),(0,yi.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6",children:P.map(e=>(0,yi.jsxs)("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer",children:[(0,yi.jsx)("input",{type:"checkbox",checked:N[e.key],onChange:()=>O(e.key),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,yi.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,yi.jsx)("button",{onClick:()=>{k(C),w(!1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,yi.jsxs)("button",{onClick:I,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(Ri,{className:"w-4 h-4 mr-2"}),"Save Column Selection"]})]})]}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:(0,yi.jsxs)("div",{className:"overflow-x-auto",children:[(0,yi.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,yi.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,yi.jsxs)("tr",{children:[P.filter(e=>C[e.key]).map(e=>(0,yi.jsx)(K,{sortKey:e.key,children:e.label},e.key)),(0,yi.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,yi.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:V.map((e,t)=>(0,yi.jsxs)("tr",{className:"cursor-pointer transition-all duration-200 hover:bg-blue-50 hover:shadow-md transform hover:-translate-y-0.5 ".concat(t%2===0?"bg-white":"bg-gray-50"),onClick:()=>s(e),children:[P.filter(e=>C[e.key]).map(t=>(0,yi.jsx)("td",{className:"px-6 py-5 whitespace-nowrap",children:(()=>{if("date"===t.key||"createdDate"===t.key||"modifiedDate"===t.key)return(0,yi.jsx)("div",{className:"text-sm font-medium text-gray-900",children:R(e[t.key])});if("customerName"===t.key)return(0,yi.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"});if("phoneNumber"===t.key)return(0,yi.jsx)("a",{href:"tel:".concat(e.phoneNumber),onClick:e=>e.stopPropagation(),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:L(e.phoneNumber)});if("email"===t.key)return e.email?(0,yi.jsx)("a",{href:"mailto:".concat(e.email),onClick:e=>e.stopPropagation(),className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:e.email}):"-";if("address"===t.key)return(0,yi.jsx)("div",{className:"text-sm text-gray-700 truncate max-w-xs",children:e.address||"-"});if("disposition"===t.key)return T(e.disposition);if("dabellaQuote"===t.key)return e.dabellaQuote?(0,yi.jsxs)("span",{className:"text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-medium",children:["$",F(e.dabellaQuote)]}):"-";if("number"===t.type){const n=e[t.key];return n?(0,yi.jsx)("div",{className:"text-sm font-medium text-gray-900",children:F(n)}):"-"}return(0,yi.jsx)("div",{className:"text-sm text-gray-900",children:e[t.key]||"-"})})()},t.key)),(0,yi.jsx)("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium",children:(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-100 transition-all duration-200 hover:scale-110",title:"View Details",children:(0,yi.jsx)(Y,{className:"w-4 h-4"})}),(0,yi.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"text-orange-600 hover:text-orange-900 p-2 rounded-lg hover:bg-orange-100 transition-all duration-200 hover:scale-110",title:"Edit",children:(0,yi.jsx)(Li,{className:"w-4 h-4"})})]})})]},e.id||t))})]}),0===j.length&&(0,yi.jsxs)("div",{className:"text-center py-12",children:[(0,yi.jsx)($,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,yi.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No leads found"}),(0,yi.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:G?"Try adjusting your search or filter criteria.":"Get started by adding your first lead."})]})]})}),j.length>0&&W>1&&(0,yi.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,yi.jsx)("button",{onClick:()=>y(1),disabled:1===g,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,yi.jsxs)("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===g,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,yi.jsx)(Ui,{className:"w-4 h-4 mr-1"}),"Previous"]})]}),(0,yi.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(7,W)},(e,t)=>{let n;return n=W<=7||g<=4?t+1:g>=W-3?W-6+t:g-3+t,(0,yi.jsx)("button",{onClick:()=>y(n),className:"px-3 py-2 text-sm font-medium rounded-lg ".concat(g===n?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:n},n)})}),(0,yi.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,yi.jsxs)("button",{onClick:()=>y(e=>Math.min(W,e+1)),disabled:g===W,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",(0,yi.jsx)(Pi,{className:"w-4 h-4 ml-1"})]}),(0,yi.jsx)("button",{onClick:()=>y(W),disabled:g===W,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})})]})};const Oi=function(e){let{jobCounts:t,onAddJobCount:n,onEditJobCount:r,onDeleteJobCount:a,onRefreshJobCounts:i,onSelectJobCount:s}=e;const[o,l]=(0,B.useState)(""),[c,u]=(0,B.useState)(""),[h,d]=(0,B.useState)({key:null,direction:"asc"}),[A,p]=(0,B.useState)({}),[f,m]=(0,B.useState)(!1),[g,y]=(0,B.useState)(1),[v,b]=(0,B.useState)(25),[x,w]=(0,B.useState)(!1),_={date:!0,customer:!0,phone:!0,address:!0,email:!1,sqFt:!0,ridgeLf:!0,valleyLf:!0,eavesLf:!1,quote:!0,quality:!0,disposition:!0,leadSource:!0,roofAge:!1,roofType:!1,ridgeVents:!1,turbine:!1,rimeFlow:!1,highProfileRidgeCap:!1,valleyMetal:!1,pipes1Half:!1,pipes2:!1,pipes3:!1,pipes4:!1,gables:!1,turtleBacks:!1,satellite:!1,chimney:!1,solar:!1,swampCooler:!1,guttersLf:!1,downspouts:!1,gutterGuardLf:!1,permanentLighting:!1},S=()=>{try{const e=localStorage.getItem("jobCountVisibleColumns");if(e)return JSON.parse(e)}catch(_S){console.error("Error loading saved columns:",_S)}return _},[C,E]=(0,B.useState)(S),[N,k]=(0,B.useState)(S),I=(0,B.useCallback)(()=>{try{localStorage.setItem("jobCountVisibleColumns",JSON.stringify(N)),E(N),w(!1)}catch(_S){console.error("Error saving columns:",_S)}},[N]),T=(0,B.useCallback)(e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",[]),F=(0,B.useCallback)(e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(t){return e}},[]),R=(0,B.useCallback)(e=>{if(!e)return"-";const t=e.toString().replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e},[]),L=(0,B.useCallback)(e=>{d(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},[]),U=(0,B.useMemo)(()=>[{key:"date",label:"Date",type:"date",category:"Basic"},{key:"customer",label:"Customer",type:"text",category:"Basic"},{key:"phone",label:"Phone",type:"text",category:"Basic"},{key:"email",label:"Email",type:"text",category:"Basic"},{key:"address",label:"Address",type:"text",category:"Basic"},{key:"quality",label:"Quality",type:"text",category:"Job Info"},{key:"disposition",label:"Disposition",type:"text",category:"Job Info"},{key:"leadSource",label:"Lead Source",type:"text",category:"Job Info"},{key:"roofAge",label:"Roof Age",type:"text",category:"Job Info"},{key:"roofType",label:"Roof Type",type:"text",category:"Job Info"},{key:"sqFt",label:"SQ FT",type:"number",category:"Measurements"},{key:"ridgeLf",label:"Ridge LF",type:"number",category:"Measurements"},{key:"valleyLf",label:"Valley LF",type:"number",category:"Measurements"},{key:"eavesLf",label:"Eaves LF",type:"number",category:"Measurements"},{key:"quote",label:"Quote",type:"number",category:"Financial"},{key:"ridgeVents",label:"Ridge Vents",type:"number",category:"Ventilation"},{key:"turbine",label:"Turbine",type:"number",category:"Ventilation"},{key:"rimeFlow",label:"Rime Flow",type:"number",category:"Ventilation"},{key:"highProfileRidgeCap",label:"High Profile Ridge Cap",type:"number",category:"Components"},{key:"valleyMetal",label:"Valley Metal",type:"number",category:"Components"},{key:"pipes1Half",label:'Pipes 1.5"',type:"number",category:"Pipes"},{key:"pipes2",label:'Pipes 2"',type:"number",category:"Pipes"},{key:"pipes3",label:'Pipes 3"',type:"number",category:"Pipes"},{key:"pipes4",label:'Pipes 4"',type:"number",category:"Pipes"},{key:"gables",label:"Gables",type:"number",category:"Features"},{key:"turtleBacks",label:"Turtle Backs",type:"number",category:"Features"},{key:"satellite",label:"Satellite",type:"number",category:"Features"},{key:"chimney",label:"Chimney",type:"number",category:"Features"},{key:"solar",label:"Solar",type:"number",category:"Features"},{key:"swampCooler",label:"Swamp Cooler",type:"number",category:"Features"},{key:"guttersLf",label:"Gutters LF",type:"number",category:"Gutters"},{key:"downspouts",label:"Downspouts",type:"number",category:"Gutters"},{key:"gutterGuardLf",label:"Gutter Guard LF",type:"number",category:"Gutters"},{key:"permanentLighting",label:"Permanent Lighting",type:"number",category:"Additional"}],[]),P=(0,B.useCallback)((e,t)=>{const n=U.find(e=>e.key===t);return"customer"===t?e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown":"phone"===t?e.phoneNumber||"":"quote"===t?parseFloat(e.dabellaQuote)||0:"number"===(null===n||void 0===n?void 0:n.type)?parseFloat(e[t])||0:e[t]||""},[U]),D=(0,B.useCallback)(e=>{k(t=>M(M({},t),{},{[e]:!t[e]}))},[]),O=(0,B.useCallback)((e,t)=>{p(n=>{const r=M({},n);return""===t||null===t||void 0===t?delete r[e]:r[e]=t,y(1),r})},[]),z=(0,B.useCallback)(()=>{p({}),l(""),u(""),y(1)},[]),H=(0,B.useMemo)(()=>{let e=t.filter(e=>{var t;const n=!o||[e.firstName,e.lastName,e.customerName,null===(t=e.phoneNumber)||void 0===t?void 0:t.toString(),e.address,e.quality,e.disposition,e.leadSource].some(e=>null===e||void 0===e?void 0:e.toLowerCase().includes(o.toLowerCase())),r=!c||e.date===c,a=Object.entries(A).every(t=>{let n,[r,a]=t;if(!a)return!0;if("customer"===r)n=e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim();else if("phone"===r){var i;n=(null===(i=e.phoneNumber)||void 0===i?void 0:i.toString())||""}else if("quote"===r)n=parseFloat(e.dabellaQuote)||0;else{const t=U.find(e=>e.key===r);n="number"===(null===t||void 0===t?void 0:t.type)?parseFloat(e[r])||0:e[r]||""}const s=U.find(e=>e.key===r);return"number"===(null===s||void 0===s?void 0:s.type)?n>=parseFloat(a):n.toString().toLowerCase().includes(a.toLowerCase())});return n&&r&&a});return h.key&&e.sort((e,t)=>{const n=P(e,h.key),r=P(t,h.key);if("string"===typeof n&&"string"===typeof r){const e=n.toLowerCase().localeCompare(r.toLowerCase());return"asc"===h.direction?e:-e}{const e=n-r;return"asc"===h.direction?e:-e}}),e},[t,o,c,A,h,P,U]),j=(0,B.useMemo)(()=>{const e=(g-1)*v,t=e+v;return H.slice(e,t)},[H,g,v]),Q=Math.ceil(H.length/v),V=(0,B.useMemo)(()=>o||c||Object.keys(A).length>0,[o,c,A]),W=(0,B.useMemo)(()=>H.reduce((e,t)=>(e.totalJobs+=1,e.totalSqFt+=parseFloat(t.sqFt)||0,e.totalRidgeLf+=parseFloat(t.ridgeLf)||0,e.totalValleyLf+=parseFloat(t.valleyLf)||0,e),{totalJobs:0,totalSqFt:0,totalRidgeLf:0,totalValleyLf:0}),[H]),K=e=>{var t;let{sortKey:n,children:r,className:a=""}=e;const i=A[n];return(0,yi.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(a),children:(0,yi.jsxs)("div",{className:"space-y-2",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors select-none p-1 rounded",onClick:()=>L(n),children:[(0,yi.jsx)("span",{className:i?"text-blue-600 font-semibold":"",children:r}),(0,yi.jsxs)("div",{className:"flex items-center space-x-1",children:[i&&(0,yi.jsx)(Ni,{className:"w-3 h-3 text-blue-600"}),(0,yi.jsxs)("div",{className:"flex flex-col",children:[(0,yi.jsx)(Bi,{className:"w-3 h-3 ".concat(h.key===n&&"asc"===h.direction?"text-blue-600":"text-gray-300")}),(0,yi.jsx)(ki,{className:"w-3 h-3 -mt-1 ".concat(h.key===n&&"desc"===h.direction?"text-blue-600":"text-gray-300")})]})]})]}),f&&(0,yi.jsx)(X,{column:n,value:A[n]||"",onChange:e=>O(n,e),type:(null===(t=U.find(e=>e.key===n))||void 0===t?void 0:t.type)||"text"})]})})},X=e=>{let{column:t,value:n,onChange:r,type:a}=e;const i="number"===a?"Min value...":"Filter...";return(0,yi.jsxs)("div",{className:"relative",children:[(0,yi.jsx)("input",{type:"number"===a?"number":"date"===a?"date":"text",value:n,onChange:e=>r(e.target.value),placeholder:i,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",onClick:e=>e.stopPropagation()}),n&&(0,yi.jsx)("button",{onClick:e=>{e.stopPropagation(),r("")},className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{className:"w-3 h-3"})})]})};return(0,yi.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,yi.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Job Count Management"}),(0,yi.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Track roofing job counts, measurements, and customer information"})]}),(0,yi.jsxs)("div",{className:"flex items-center space-x-2 lg:space-x-3",children:[(0,yi.jsxs)("button",{onClick:i,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-gray-300 rounded-lg text-xs lg:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[(0,yi.jsx)(Ti,{className:"w-3 h-3 lg:w-4 lg:h-4 lg:mr-2"}),(0,yi.jsx)("span",{className:"hidden lg:inline",children:"Refresh"})]}),(0,yi.jsxs)("button",{onClick:n,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-transparent rounded-lg text-xs lg:text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(Ci,{className:"w-3 h-3 lg:w-4 lg:h-4 mr-1 lg:mr-2"}),"Add Job Count"]})]})]}),(0,yi.jsx)("div",{className:"bg-white p-3 lg:p-6 rounded-lg shadow-sm border",children:(0,yi.jsxs)("div",{className:"space-y-3 lg:space-y-4",children:[(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 lg:gap-4",children:[(0,yi.jsxs)("div",{className:"relative md:col-span-2",children:[(0,yi.jsx)(Mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,yi.jsx)("input",{type:"text",placeholder:"Search across all fields...",value:o,onChange:e=>l(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,yi.jsxs)("div",{className:"relative",children:[(0,yi.jsx)(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,yi.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,yi.jsxs)("button",{onClick:()=>m(!f),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(f?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,yi.jsx)(Ni,{className:"w-4 h-4 mr-2"}),"Column Filters",Object.keys(A).length>0&&(0,yi.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:Object.keys(A).length})]}),(0,yi.jsxs)("button",{onClick:()=>w(!x),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(x?"border-purple-500 text-purple-700 bg-purple-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,yi.jsx)(Fi,{className:"w-4 h-4 mr-2"}),"Manage Columns",(0,yi.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full",children:Object.values(C).filter(Boolean).length})]}),V&&(0,yi.jsxs)("button",{onClick:z,className:"inline-flex items-center px-3 py-2 border border-red-300 rounded-lg text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 transition-colors",children:[(0,yi.jsx)(Ii,{className:"w-4 h-4 mr-2"}),"Clear All Filters"]})]}),(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsxs)("select",{value:v,onChange:e=>{b(Number(e.target.value)),y(1)},className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,yi.jsx)("option",{value:10,children:"10 per page"}),(0,yi.jsx)("option",{value:25,children:"25 per page"}),(0,yi.jsx)("option",{value:50,children:"50 per page"}),(0,yi.jsx)("option",{value:100,children:"100 per page"})]}),(0,yi.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",0===H.length?0:(g-1)*v+1,"-",Math.min(g*v,H.length)," of ",H.length]})]})]})]})}),x&&(0,yi.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,yi.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,yi.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Visible Columns"}),(0,yi.jsx)("button",{onClick:()=>{k(C),w(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{className:"w-5 h-5"})})]}),(0,yi.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6",children:U.map(e=>(0,yi.jsxs)("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer",children:[(0,yi.jsx)("input",{type:"checkbox",checked:N[e.key],onChange:()=>D(e.key),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,yi.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,yi.jsx)("button",{onClick:()=>{k(C),w(!1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,yi.jsxs)("button",{onClick:I,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(Ri,{className:"w-4 h-4 mr-2"}),"Save Column Selection"]})]})]}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-6",children:[(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4 lg:p-6",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)(xi,{className:"h-8 w-8 text-blue-600"})}),(0,yi.jsxs)("div",{className:"ml-4",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Jobs"}),(0,yi.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:W.totalJobs})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)(G,{className:"h-8 w-8 text-green-600"})}),(0,yi.jsxs)("div",{className:"ml-4",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total SQ FT"}),(0,yi.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:T(W.totalSqFt)})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)(wi,{className:"h-8 w-8 text-purple-600"})}),(0,yi.jsxs)("div",{className:"ml-4",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Ridge LF"}),(0,yi.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:T(W.totalRidgeLf)})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)(wi,{className:"h-8 w-8 text-orange-600"})}),(0,yi.jsxs)("div",{className:"ml-4",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Valley LF"}),(0,yi.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:T(W.totalValleyLf)})]})]})})]}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:(0,yi.jsxs)("div",{className:"overflow-x-auto",children:[(0,yi.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,yi.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,yi.jsxs)("tr",{children:[U.filter(e=>C[e.key]).map(e=>(0,yi.jsx)(K,{sortKey:e.key,children:e.label},e.key)),(0,yi.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,yi.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:j.map((e,t)=>(0,yi.jsxs)("tr",{className:"cursor-pointer transition-all duration-200 hover:bg-blue-50 hover:shadow-md transform hover:-translate-y-0.5 ".concat(t%2===0?"bg-white":"bg-gray-50"),onClick:()=>s(e),children:[U.filter(e=>C[e.key]).map(t=>(0,yi.jsx)("td",{className:"px-6 py-5 whitespace-nowrap",children:(()=>{if("date"===t.key)return(0,yi.jsx)("div",{className:"text-sm font-medium text-gray-900",children:F(e.date)});if("customer"===t.key)return(0,yi.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"});if("phone"===t.key)return(0,yi.jsx)("a",{href:"tel:".concat(e.phoneNumber),onClick:e=>e.stopPropagation(),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:R(e.phoneNumber)});if("email"===t.key)return e.email?(0,yi.jsx)("a",{href:"mailto:".concat(e.email),onClick:e=>e.stopPropagation(),className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:e.email}):"-";if("address"===t.key)return(0,yi.jsx)("div",{className:"text-sm text-gray-700 truncate max-w-xs",children:e.address||"-"});if("quote"===t.key)return e.dabellaQuote?(0,yi.jsxs)("span",{className:"text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-medium",children:["$",T(e.dabellaQuote)]}):"-";if("number"===t.type){const n=e[t.key];return n?(0,yi.jsx)("div",{className:"text-sm font-medium text-gray-900",children:T(n)}):"-"}return(0,yi.jsx)("div",{className:"text-sm text-gray-900",children:e[t.key]||"-"})})()},t.key)),(0,yi.jsx)("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium",children:(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-100 transition-all duration-200 hover:scale-110",title:"View Details",children:(0,yi.jsx)(Y,{className:"w-4 h-4"})}),(0,yi.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"text-orange-600 hover:text-orange-900 p-2 rounded-lg hover:bg-orange-100 transition-all duration-200 hover:scale-110",title:"Edit",children:(0,yi.jsx)(Li,{className:"w-4 h-4"})})]})})]},e.id||t))})]}),0===H.length&&(0,yi.jsxs)("div",{className:"text-center py-12",children:[(0,yi.jsx)(G,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,yi.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job counts found"}),(0,yi.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:V?"Try adjusting your search or filter criteria.":"Get started by adding your first job count."})]})]})}),H.length>0&&Q>1&&(0,yi.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,yi.jsx)("button",{onClick:()=>y(1),disabled:1===g,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,yi.jsxs)("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===g,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,yi.jsx)(Ui,{className:"w-4 h-4 mr-1"}),"Previous"]})]}),(0,yi.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(7,Q)},(e,t)=>{let n;return n=Q<=7||g<=4?t+1:g>=Q-3?Q-6+t:g-3+t,(0,yi.jsx)("button",{onClick:()=>y(n),className:"px-3 py-2 text-sm font-medium rounded-lg ".concat(g===n?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:n},n)})}),(0,yi.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,yi.jsxs)("button",{onClick:()=>y(e=>Math.min(Q,e+1)),disabled:g===Q,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",(0,yi.jsx)(Pi,{className:"w-4 h-4 ml-1"})]}),(0,yi.jsx)("button",{onClick:()=>y(Q),disabled:g===Q,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})})]})},zi=H("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Hi=H("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),ji=H("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),Qi="AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4";let Vi=!1;function Wi(e){let{leads:t,onLeadClick:n,showDemoData:r,mapType:a,showTraffic:i,searchAddress:s,onSearchComplete:o,selectedCustomer:l,onCustomerLocated:c}=e;const u=(0,B.useRef)(null),h=(0,B.useRef)([]),d=(0,B.useRef)(null),A=(0,B.useRef)(null),[p,f]=(0,B.useState)(null),[m,g]=(0,B.useState)(!0),[y,v]=(0,B.useState)(null),b=(0,B.useMemo)(()=>[{id:"demo1",customerName:"John Smith",phoneNumber:"555-0123",address:"123 Main St, Ogden, UT",quality:"Hot",latitude:41.223,longitude:-111.9738},{id:"demo2",customerName:"Sarah Johnson",phoneNumber:"555-0456",address:"456 Oak Ave, Salt Lake City, UT",quality:"Warm",latitude:40.7608,longitude:-111.891},{id:"demo3",customerName:"Mike Wilson",phoneNumber:"555-0789",address:"789 Pine St, Provo, UT",quality:"Cold",latitude:40.2338,longitude:-111.6585},{id:"demo4",customerName:"Emily Davis",phoneNumber:"555-0321",address:"321 Elm Dr, West Valley, UT",quality:"Hot",latitude:40.6916,longitude:-112.0011},{id:"demo5",customerName:"Chris Brown",phoneNumber:"555-0654",address:"654 Cedar Ln, Layton, UT",quality:"Warm",latitude:41.0602,longitude:-111.9711}],[]),x=r?b:t,w=x.filter(e=>!e.address||""===e.address.trim()),_=(0,B.useCallback)(e=>{switch(e){case"Hot":return"#dc2626";case"Warm":return"#f59e0b";case"Cold":return"#3b82f6";default:return"#6b7280"}},[]),S=(0,B.useCallback)(e=>{const t=_(e);return{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('<svg width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">\n          <path d="M18 2c-7.7 0-14 6.3-14 14 0 10.5 14 18 14 18s14-7.5 14-18c0-7.7-6.3-14-14-14z" fill="'.concat(t,'" stroke="#ffffff" stroke-width="2"/>\n          <circle cx="18" cy="16" r="6" fill="#ffffff"/>\n          <circle cx="18" cy="16" r="3" fill="').concat(t,'"/>\n        </svg>')),scaledSize:new window.google.maps.Size(36,36),anchor:new window.google.maps.Point(18,36)}},[_]);(0,B.useEffect)(()=>{(async()=>{try{const e=await new Promise((e,t)=>{var n;if(Vi&&null!==(n=window.google)&&void 0!==n&&n.maps)return e(window.google);const r="google-maps-script",a=document.getElementById(r);if(a)return a.addEventListener("load",()=>{Vi=!0,e(window.google)}),void a.addEventListener("error",()=>{t(new Error("Failed to load Google Maps. Please check your API key and internet connection."))});const i=document.createElement("script");i.id=r,i.src="https://maps.googleapis.com/maps/api/js?key=".concat(Qi,"&libraries=geometry,places&loading=async"),i.async=!0,i.defer=!0,i.onload=()=>{Vi=!0,e(window.google)},i.onerror=()=>{document.head.removeChild(i),t(new Error("Failed to load Google Maps. Please check your API key and internet connection."))},document.head.appendChild(i)});if(!u.current)return;const t=[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]}],n=new e.maps.Map(u.current,{center:{lat:40.7608,lng:-111.891},zoom:9,styles:t,mapTypeId:a,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0});A.current=new e.maps.TrafficLayer,i&&A.current.setMap(n),d.current=new e.maps.InfoWindow,f(n)}catch(e){v(e.message)}finally{g(!1)}})()},[a,i]),(0,B.useEffect)(()=>{A.current&&p&&A.current.setMap(i?p:null)},[i,p]),(0,B.useEffect)(()=>{if(!p||!window.google||!s)return;(new window.google.maps.Geocoder).geocode({address:s},(e,t)=>{if("OK"===t&&e[0]){const t=e[0].geometry.location;p.setCenter(t),p.setZoom(15),new window.google.maps.Marker({position:t,map:p,title:s,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4F46E5",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}})}o&&o()})},[p,s,o]),(0,B.useEffect)(()=>(window.viewLeadDetails=e=>{const t=x.find(t=>t.id===e);t&&n&&n(t)},()=>{window.viewLeadDetails=null}),[x,n]);const C=(0,B.useCallback)((e,t)=>{if(!p||!window.google)return;(new window.google.maps.Geocoder).geocode({address:e},(e,n)=>{if("OK"===n&&e[0]){const n=e[0].geometry.location;t({lat:n.lat(),lng:n.lng(),success:!0})}else t({success:!1,error:n})})},[p]);return(0,B.useEffect)(()=>{l&&p&&window.google&&C(l.address,e=>{if(e.success){const t={lat:e.lat,lng:e.lng};h.current.forEach(e=>e.setMap(null)),h.current=[],p.setCenter(t),p.setZoom(15);const n=new window.google.maps.Marker({position:t,map:p,title:l.customerName,icon:S(l.quality),animation:window.google.maps.Animation.DROP});n.addListener("click",()=>{const e='\n            <div style="padding: 12px; min-width: 200px;">\n              <h3 style="margin: 0 0 8px 0; color: #1f2937; font-size: 16px; font-weight: 600;">\n                '.concat(l.customerName||"Unknown",'\n              </h3>\n              <div style="margin-bottom: 8px;">\n                <strong style="color: #374151;">Phone:</strong>\n                <a href="tel:').concat(l.phoneNumber,'" style="color: #3b82f6; text-decoration: none;">\n                  ').concat(l.phoneNumber||"N/A",'\n                </a>\n              </div>\n              <div style="margin-bottom: 8px;">\n                <strong style="color: #374151;">Quality:</strong>\n                <span style="background: ').concat(_(l.quality),"20; color: ").concat(_(l.quality),'; padding: 2px 6px; border-radius: 4px; font-size: 12px;">\n                  ').concat(l.quality,'\n                </span>\n              </div>\n              <div style="margin-bottom: 12px; color: #6b7280; font-size: 14px;">').concat(l.address,"</div>\n              <button onclick=\"window.viewLeadDetails('").concat(l.id,'\')"\n                      style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">\n                View Details\n              </button>\n            </div>\n          ');d.current.setContent(e),d.current.open(p,n)}),h.current.push(n),c&&c(M(M({},l),{},{lat:e.lat,lng:e.lng}))}else console.warn("Failed to geocode customer address:",l.address,e.error)})},[l,p,C,S,_,c]),m?(0,yi.jsx)("div",{className:"h-[70vh] w-full rounded-lg border border-gray-300 flex items-center justify-center bg-gray-50",children:(0,yi.jsxs)("div",{className:"text-center",children:[(0,yi.jsx)(j,{className:"animate-spin h-10 w-10 text-blue-600 mx-auto mb-3"}),(0,yi.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading Interactive Map..."}),(0,yi.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"Connecting to Google Maps"})]})}):y?(0,yi.jsx)("div",{className:"h-[70vh] w-full rounded-lg border border-red-300 flex items-center justify-center bg-red-50",children:(0,yi.jsxs)("div",{className:"text-center max-w-md",children:[(0,yi.jsx)($,{className:"h-12 w-12 text-red-600 mx-auto mb-3"}),(0,yi.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Map Loading Failed"}),(0,yi.jsx)("p",{className:"text-red-600 mb-3",children:y}),(0,yi.jsx)("p",{className:"text-sm text-gray-600",children:"Please check your Google Maps API key configuration and internet connection."})]})}):(0,yi.jsxs)("div",{children:[(0,yi.jsx)("div",{ref:u,className:"h-[70vh] w-full rounded-lg overflow-hidden border border-gray-300 shadow-sm"}),!r&&w.length>0&&(0,yi.jsxs)("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,yi.jsxs)("h4",{className:"text-sm font-semibold text-yellow-800 mb-3 flex items-center",children:[(0,yi.jsx)($,{className:"w-4 h-4 mr-2"}),"Leads Without Address Data (",w.length,")"]}),(0,yi.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:w.slice(0,4).map(e=>(0,yi.jsxs)("div",{className:"bg-white p-3 rounded border border-yellow-200 hover:shadow-sm transition-shadow cursor-pointer",onClick:()=>n&&n(e),children:[(0,yi.jsx)("div",{className:"font-medium text-gray-900",children:e.customerName||"Unknown"}),(0,yi.jsx)("div",{className:"text-sm text-gray-600",children:e.phoneNumber||"No phone"}),(0,yi.jsx)("div",{className:"text-xs text-gray-500",children:"No address provided"})]},e.id))}),w.length>4&&(0,yi.jsxs)("div",{className:"mt-3 text-sm text-yellow-700",children:["And ",w.length-4," more leads without addresses..."]})]})]})}const Gi=function(e){let{leads:t,onLeadClick:n,searchAddress:r,onSearchComplete:a}=e;const[i,s]=(0,B.useState)(!1),[o,l]=(0,B.useState)("roadmap"),[c,u]=(0,B.useState)(!1),[h,d]=(0,B.useState)(null),[A,p]=(0,B.useState)(""),[f,m]=(0,B.useState)(!1),g=(0,B.useMemo)(()=>t.filter(e=>e.address&&""!==e.address.trim()),[t]),y=g.length>0,v=(0,B.useMemo)(()=>A?g.filter(e=>{var t,n,r;return(null===(t=e.customerName)||void 0===t?void 0:t.toLowerCase().includes(A.toLowerCase()))||(null===(n=e.firstName)||void 0===n?void 0:n.toLowerCase().includes(A.toLowerCase()))||(null===(r=e.lastName)||void 0===r?void 0:r.toLowerCase().includes(A.toLowerCase()))}):g,[g,A]);(0,B.useEffect)(()=>{const e=e=>{e.target.closest(".customer-search-dropdown")||m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const b=(0,B.useMemo)(()=>{const e=i?[{quality:"Hot"},{quality:"Hot"},{quality:"Warm"},{quality:"Warm"},{quality:"Cold"}]:t;return{hot:e.filter(e=>"Hot"===e.quality).length,warm:e.filter(e=>"Warm"===e.quality).length,cold:e.filter(e=>"Cold"===e.quality).length,total:e.length,mapped:g.length}},[t,g,i]);return(0,yi.jsxs)("div",{className:"space-y-6",children:[(0,yi.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,yi.jsx)(zi,{className:"w-8 h-8 mr-3 text-blue-600"}),"Customer Locations"]}),(0,yi.jsx)("p",{className:"text-gray-600 mt-1",children:"Interactive map showing customer locations with lead quality indicators"})]}),(0,yi.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,yi.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[(0,yi.jsxs)("button",{onClick:()=>s(!1),className:"px-3 py-1 text-sm font-medium rounded-md transition-colors ".concat(i?"text-gray-600 hover:text-gray-900":"bg-white text-gray-900 shadow-sm"),children:["Real Data (",t.length,")"]}),(0,yi.jsx)("button",{onClick:()=>s(!0),className:"px-3 py-1 text-sm font-medium rounded-md transition-colors ".concat(i?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Demo Data (5)"})]}),(0,yi.jsxs)("div",{className:"relative customer-search-dropdown",children:[(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)(Mi,{className:"w-4 h-4 text-gray-400 absolute left-3 z-10"}),(0,yi.jsx)("input",{type:"text",placeholder:"Search customer...",value:A,onChange:e=>{p(e.target.value),m(!0)},onFocus:()=>m(!0),className:"pl-10 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"}),(0,yi.jsx)(ki,{className:"w-4 h-4 text-gray-400 absolute right-3"})]}),f&&v.length>0&&(0,yi.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-20",children:[v.slice(0,10).map(e=>(0,yi.jsxs)("button",{onClick:()=>(e=>{d(e),p(e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()),m(!1)})(e),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:[(0,yi.jsx)("div",{className:"font-medium text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"}),(0,yi.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.address}),(0,yi.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:(0,yi.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat("Hot"===e.quality?"bg-red-100 text-red-800":"Warm"===e.quality?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.quality})})]},e.id)),v.length>10&&(0,yi.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-500 bg-gray-50",children:["And ",v.length-10," more results..."]})]})]}),(0,yi.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,yi.jsx)("option",{value:"roadmap",children:"Road Map"}),(0,yi.jsx)("option",{value:"satellite",children:"Satellite"}),(0,yi.jsx)("option",{value:"hybrid",children:"Hybrid"}),(0,yi.jsx)("option",{value:"terrain",children:"Terrain"})]}),(0,yi.jsxs)("button",{onClick:()=>u(!c),className:"flex items-center px-3 py-2 text-sm font-medium rounded-lg border transition-colors ".concat(c?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,yi.jsx)(Hi,{className:"w-4 h-4 mr-2"}),"Traffic"]})]})]}),(0,yi.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,yi.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"})})}),(0,yi.jsxs)("div",{className:"ml-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Hot Leads"}),(0,yi.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.hot})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,yi.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"})})}),(0,yi.jsxs)("div",{className:"ml-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Warm Leads"}),(0,yi.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.warm})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-blue-500",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,yi.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})})}),(0,yi.jsxs)("div",{className:"ml-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Cold Leads"}),(0,yi.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.cold})]})]})}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-gray-500",children:(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"flex-shrink-0",children:(0,yi.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:(0,yi.jsx)(zi,{className:"w-4 h-4 text-gray-600"})})}),(0,yi.jsxs)("div",{className:"ml-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Mapped"}),(0,yi.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:i?5:b.mapped})]})]})})]}),y||i?(0,yi.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,yi.jsx)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,yi.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Interactive Map"}),(0,yi.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-600",children:[(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-1"}),"Hot (",b.hot,")"]}),(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-1"}),"Warm (",b.warm,")"]}),(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-1"}),"Cold (",b.cold,")"]})]})]}),i&&(0,yi.jsxs)("div",{className:"flex items-center text-sm text-blue-600 bg-blue-50 px-3 py-1 rounded-full",children:[(0,yi.jsx)(ji,{className:"w-4 h-4 mr-1"}),"Demo Mode"]})]})}),(0,yi.jsx)(Wi,{leads:t,onLeadClick:n,showDemoData:i,mapType:o,showTraffic:c,searchAddress:r,onSearchComplete:a,selectedCustomer:h,onCustomerLocated:e=>console.log("Customer located:",e)})]}):(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:(0,yi.jsxs)("div",{className:"text-center py-12",children:[(0,yi.jsx)(K,{className:"mx-auto h-20 w-20 text-gray-400 mb-6"}),(0,yi.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"No Location Data Available"}),(0,yi.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Your leads don't have geocoded coordinates yet. Add addresses to your leads or use demo data to see the map in action."}),(0,yi.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,yi.jsxs)("button",{onClick:()=>s(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(K,{className:"w-4 h-4 mr-2"}),"View Demo Data"]}),(0,yi.jsxs)("button",{className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,yi.jsx)(Mi,{className:"w-4 h-4 mr-2"}),"Learn About Geocoding"]})]})]})})]})},Ki=H("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),qi=H("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Xi=H("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Yi=H("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Ji=function(){const[e,t]=(0,B.useState)("MONTH"),n="brandon@rimehq.net",r=()=>{window.open("https://calendar.google.com/calendar/u/0/r?cid=".concat(n),"_blank")},a=()=>{const e=document.getElementById("google-calendar-iframe");if(e){const t=e.src;e.src="",e.src=t}};return(0,yi.jsxs)("div",{className:"space-y-6",children:[(0,yi.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,yi.jsx)(Ki,{className:"w-8 h-8 mr-3 text-blue-600"}),"Calendar"]}),(0,yi.jsxs)("p",{className:"text-gray-600 mt-1",children:["View and manage appointments from Google Calendar for ",n]})]}),(0,yi.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,yi.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[(0,yi.jsxs)("button",{onClick:()=>t("MONTH"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("MONTH"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,yi.jsx)(qi,{className:"w-4 h-4"}),"Month"]}),(0,yi.jsxs)("button",{onClick:()=>t("WEEK"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("WEEK"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,yi.jsx)(q,{className:"w-4 h-4"}),"Week"]}),(0,yi.jsxs)("button",{onClick:()=>t("AGENDA"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("AGENDA"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,yi.jsx)(Xi,{className:"w-4 h-4"}),"Agenda"]})]}),(0,yi.jsxs)("button",{onClick:a,className:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors shadow-sm",children:[(0,yi.jsx)(Ti,{className:"w-4 h-4 mr-2"}),"Refresh"]}),(0,yi.jsxs)("button",{onClick:r,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,yi.jsx)(Yi,{className:"w-4 h-4 mr-2"}),"Open in Google"]})]})]}),(0,yi.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start",children:[(0,yi.jsx)(ee,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Google Calendar Integration"}),(0,yi.jsxs)("p",{className:"text-sm text-blue-800",children:["This calendar displays all events from ",(0,yi.jsx)("span",{className:"font-semibold",children:n}),'. To add or edit appointments, click "Open in Google" to manage them directly in Google Calendar.']})]})]}),(0,yi.jsx)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200",children:(0,yi.jsx)("iframe",{id:"google-calendar-iframe",src:(()=>{const t=new URLSearchParams({src:n,ctz:"America/Denver",mode:e,showTitle:"0",showNav:"1",showDate:"1",showPrint:"0",showTabs:"1",showCalendars:"0",showTz:"0",bgcolor:"%23ffffff",color:"%232952A3"});return"".concat("https://calendar.google.com/calendar/embed","?").concat(t.toString())})(),style:{border:0},width:"100%",height:"700",frameBorder:"0",scrolling:"no",title:"Google Calendar",className:"w-full"})}),(0,yi.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[(0,yi.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,yi.jsx)(Ki,{className:"w-5 h-5 mr-2 text-blue-600"}),"Quick Actions"]}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,yi.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Create Appointment"}),(0,yi.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:'Click "Open in Google" above to create new appointments directly in Google Calendar.'}),(0,yi.jsx)("button",{onClick:r,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Go to Google Calendar \u2192"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,yi.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Sync with Leads"}),(0,yi.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Appointments created in Google Calendar will be automatically reflected here in real-time."}),(0,yi.jsx)("button",{onClick:a,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Refresh Calendar \u2192"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,yi.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Time Zone"}),(0,yi.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Calendar is set to Mountain Time (America/Denver). All appointments display in this time zone."}),(0,yi.jsx)("span",{className:"text-sm text-gray-500 font-medium",children:"MT (UTC-7/UTC-6)"})]})]})]})]})},Zi=H("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),$i=H("message-circle-reply",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}],["path",{d:"M7 12h8a2 2 0 0 1 2 2v1",key:"89sh1g"}]]),es=H("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),ts=H("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ns=H("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),rs=H("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),as=H("phone-call",[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),is=H("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),ss=H("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),os=H("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),ls=H("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),cs=H("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),us=H("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),hs=H("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);function ds(e){let{leads:t,jobCounts:n,communications:r=[]}=e;const[a,i]=(0,B.useState)(""),[s,o]=(0,B.useState)(null),[l,c]=(0,B.useState)(null),[u,h]=(0,B.useState)("all"),[d,A]=(0,B.useState)(""),[p,f]=(0,B.useState)(""),[m,g]=(0,B.useState)(""),[y,v]=(0,B.useState)(""),b=(0,B.useMemo)(()=>[...t.map(e=>({id:"lead-".concat(e.id),type:"lead",name:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||e.name||"Unknown",address:e.address,phone:e.phone,email:e.email||"",notes:e.notes||"",quality:e.quality,disposition:e.disposition,lastContact:e.lastContact||null,source:"Bhotchleads"})),...n.map(e=>({id:"job-".concat(e.id),type:"jobcount",name:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown",address:e.address,phone:e.phone||"",email:e.email||"",notes:e.notes||"",sqFt:e.sqFt,status:e.status,source:"Job Count"}))],[t,n]),x=(0,B.useMemo)(()=>{let e=b;if("all"!==u&&(e=e.filter(e=>e.type===u)),a.trim()){const t=a.toLowerCase();e=e.filter(e=>{var n,r,a,i;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(r=e.address)||void 0===r?void 0:r.toLowerCase().includes(t))||(null===(a=e.phone)||void 0===a?void 0:a.includes(t))||(null===(i=e.email)||void 0===i?void 0:i.toLowerCase().includes(t))})}return e.sort((e,t)=>{const n=e.lastContact?new Date(e.lastContact):new Date(0);return(t.lastContact?new Date(t.lastContact):new Date(0))-n})},[b,a,u]),w=(0,B.useMemo)(()=>s?r.filter(e=>e.customerId===s.id).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)):[],[s,r]),_=(0,B.useMemo)(()=>{const e=s?w:r;return{totalCalls:e.filter(e=>"call"===e.type).length,totalSMS:e.filter(e=>"sms"===e.type).length,totalEmails:e.filter(e=>"email"===e.type).length,lastContact:e.length>0?e[0].timestamp:null}},[s,w,r]),S=[{id:"sent",label:"Sent SMS",icon:Zi,color:"green"},{id:"received",label:"Received SMS",icon:$i,color:"teal"},{id:"follow-up",label:"Follow-up Needed",icon:es,color:"orange"},{id:"not-interested",label:"Not Interested",icon:ts,color:"red"}],C=e=>{if(l===e)c(null);else if(c(e),"call"===e){const e=s.phone.replace(/\D/g,"");window.open("https://voice.google.com/u/0/calls?a=nc,%2B1".concat(e),"_blank")}};return(0,yi.jsxs)("div",{className:"h-[calc(100vh-140px)] flex flex-col lg:flex-row gap-4 lg:gap-6",children:[(0,yi.jsxs)("div",{className:"w-full lg:w-1/3 bg-white rounded-lg shadow-sm border overflow-hidden flex flex-col max-h-[40vh] lg:max-h-none",children:[(0,yi.jsxs)("div",{className:"p-3 lg:p-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,yi.jsxs)("h2",{className:"text-lg lg:text-xl font-bold text-gray-900 mb-3 lg:mb-4 flex items-center",children:[(0,yi.jsx)(X,{className:"w-5 h-5 lg:w-6 lg:h-6 mr-2 text-blue-600"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Communications Hub"}),(0,yi.jsx)("span",{className:"sm:hidden",children:"Comms"})]}),(0,yi.jsxs)("div",{className:"relative mb-3",children:[(0,yi.jsx)(Mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,yi.jsx)("input",{type:"text",placeholder:"Search customers by name, address, phone...",value:a,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),(0,yi.jsxs)("div",{className:"flex gap-1 lg:gap-2",children:[(0,yi.jsxs)("button",{onClick:()=>h("all"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("all"===u?"bg-blue-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,yi.jsx)(Ni,{className:"w-3 h-3 lg:w-4 lg:h-4 inline mr-1"}),(0,yi.jsxs)("span",{className:"hidden sm:inline",children:["All (",b.length,")"]}),(0,yi.jsx)("span",{className:"sm:hidden",children:b.length})]}),(0,yi.jsxs)("button",{onClick:()=>h("lead"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("lead"===u?"bg-green-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,yi.jsxs)("span",{className:"hidden sm:inline",children:["Leads (",t.length,")"]}),(0,yi.jsxs)("span",{className:"sm:hidden",children:["L",t.length]})]}),(0,yi.jsxs)("button",{onClick:()=>h("jobcount"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("jobcount"===u?"bg-purple-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,yi.jsxs)("span",{className:"hidden sm:inline",children:["Jobs (",n.length,")"]}),(0,yi.jsxs)("span",{className:"sm:hidden",children:["J",n.length]})]})]})]}),(0,yi.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===x.length?(0,yi.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 p-8",children:[(0,yi.jsx)(Mi,{className:"w-16 h-16 mb-4 opacity-50"}),(0,yi.jsx)("p",{className:"text-lg font-medium",children:"No customers found"}),(0,yi.jsx)("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):x.map(e=>{return(0,yi.jsxs)("div",{onClick:()=>(e=>{o(e),c(null),A(""),f(""),g(""),v("")})(e),className:"p-4 border-b hover:bg-blue-50 cursor-pointer transition-all ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-blue-100 border-l-4 border-l-blue-600":""),children:[(0,yi.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center",children:[(0,yi.jsx)(ns,{className:"w-4 h-4 mr-2 text-gray-500"}),e.name]}),(0,yi.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,yi.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full border ".concat("lead"===e.type?"bg-green-50 text-green-700 border-green-200":"bg-purple-50 text-purple-700 border-purple-200"),children:e.source}),e.quality&&(0,yi.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full border ".concat((t=e.quality,{Hot:"bg-red-100 text-red-800 border-red-300",Warm:"bg-orange-100 text-orange-800 border-orange-300",Cold:"bg-blue-100 text-blue-800 border-blue-300"}[t]||"bg-gray-100 text-gray-800 border-gray-300")),children:e.quality})]})]}),(0,yi.jsx)(Pi,{className:"w-5 h-5 text-gray-400 transition-transform ".concat((null===s||void 0===s?void 0:s.id)===e.id?"rotate-90":"")})]}),(0,yi.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[e.phone&&(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)(rs,{className:"w-3 h-3 mr-2 text-gray-400"}),e.phone]}),e.address&&(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)(zi,{className:"w-3 h-3 mr-2 text-gray-400"}),e.address]})]})]},e.id);var t})})]}),s?(0,yi.jsxs)("div",{className:"flex-1 bg-white rounded-lg shadow-sm border overflow-hidden flex flex-col",children:[(0,yi.jsxs)("div",{className:"p-6 border-b bg-gradient-to-r from-indigo-50 to-purple-50",children:[(0,yi.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:s.name}),(0,yi.jsxs)("p",{className:"text-gray-600 flex items-center",children:[(0,yi.jsx)(zi,{className:"w-4 h-4 mr-2"}),s.address]})]}),(0,yi.jsx)("button",{onClick:()=>o(null),className:"p-2 hover:bg-white rounded-lg transition-colors",children:(0,yi.jsx)(Ii,{className:"w-5 h-5 text-gray-500"})})]}),(0,yi.jsxs)("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsx)(as,{className:"w-5 h-5 text-blue-600"}),(0,yi.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalCalls})]}),(0,yi.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Calls"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-green-100 shadow-sm",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsx)(is,{className:"w-5 h-5 text-green-600"}),(0,yi.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalSMS})]}),(0,yi.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"SMS"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-purple-100 shadow-sm",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsx)(ss,{className:"w-5 h-5 text-purple-600"}),(0,yi.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalEmails})]}),(0,yi.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Emails"})]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-orange-100 shadow-sm",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsx)(wi,{className:"w-5 h-5 text-orange-600"}),(0,yi.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:w.length})]}),(0,yi.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Total"})]})]}),s.notes&&(0,yi.jsx)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:(0,yi.jsxs)("div",{className:"flex items-start",children:[(0,yi.jsx)(os,{className:"w-4 h-4 mr-2 text-gray-500 mt-0.5"}),(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Notes"}),(0,yi.jsx)("p",{className:"text-sm text-gray-600",children:s.notes})]})]})})]}),(0,yi.jsx)("div",{className:"p-3 lg:p-4 border-b bg-gray-50",children:(0,yi.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2 lg:gap-3",children:[(0,yi.jsxs)("button",{onClick:()=>C("call"),disabled:!s.phone,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("call"===l?"bg-blue-600 text-white shadow-lg scale-105 ring-2 ring-blue-300":"bg-white text-gray-700 border-2 border-blue-200 hover:border-blue-400 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,yi.jsx)(as,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,yi.jsx)("span",{children:"\ud83d\udcde Call"})]}),(0,yi.jsxs)("button",{onClick:()=>C("sms"),disabled:!s.phone,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("sms"===l?"bg-green-600 text-white shadow-lg scale-105 ring-2 ring-green-300":"bg-white text-gray-700 border-2 border-green-200 hover:border-green-400 hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,yi.jsx)(X,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,yi.jsx)("span",{children:"\ud83d\udcac SMS"})]}),(0,yi.jsxs)("button",{onClick:()=>C("email"),disabled:!s.email,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("email"===l?"bg-purple-600 text-white shadow-lg scale-105 ring-2 ring-purple-300":"bg-white text-gray-700 border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,yi.jsx)(ss,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,yi.jsx)("span",{children:"\u2709\ufe0f Email"})]})]})}),l&&(0,yi.jsxs)("div",{className:"p-3 lg:p-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:["sms"===l&&(0,yi.jsxs)("div",{className:"space-y-4",children:[(0,yi.jsxs)("h3",{className:"text-sm lg:text-base font-semibold text-gray-900 flex items-center",children:[(0,yi.jsx)(X,{className:"w-4 h-4 lg:w-5 lg:h-5 mr-2 text-green-600"}),"\ud83d\udcac Log SMS Communication"]}),(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Select Quick Outcome ",(0,yi.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,yi.jsx)("div",{className:"grid grid-cols-2 gap-2",children:S.map(e=>{const t=e.icon,n=y===e.id,r={green:n?"bg-green-600 text-white ring-2 ring-green-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-green-200 hover:border-green-400 hover:bg-green-50",teal:n?"bg-teal-600 text-white ring-2 ring-teal-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-teal-200 hover:border-teal-400 hover:bg-teal-50",orange:n?"bg-orange-600 text-white ring-2 ring-orange-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-orange-200 hover:border-orange-400 hover:bg-orange-50",red:n?"bg-red-600 text-white ring-2 ring-red-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-red-200 hover:border-red-400 hover:bg-red-50"},a={sent:"\ud83d\udce4",received:"\ud83d\udce5","follow-up":"\ud83d\udcc5","not-interested":"\ud83d\udeab"};return(0,yi.jsxs)("button",{onClick:()=>v(e.id),className:"py-3 px-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ".concat(r[e.color]),children:[(0,yi.jsx)(t,{className:"w-4 h-4"}),(0,yi.jsxs)("span",{className:"hidden lg:inline",children:[a[e.id]," ",e.label]}),(0,yi.jsx)("span",{className:"lg:hidden",children:a[e.id]})]},e.id)})})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Message Content ",(0,yi.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,yi.jsx)("textarea",{value:d,onChange:e=>A(e.target.value),placeholder:"Enter the SMS message content or notes...",className:"w-full p-3 text-sm lg:text-base border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",rows:"4"})]}),(0,yi.jsxs)("button",{onClick:()=>{if(!d.trim()||!y)return;const e=s.phone.replace(/\D/g,"");console.log({customerId:s.id,type:"sms",outcome:y,notes:d,timestamp:(new Date).toISOString()}),"sent"===y&&window.open("https://voice.google.com/u/0/messages?itemId=t.%2B1".concat(e),"_blank"),A(""),v(""),c(null)},disabled:!d.trim()||!y,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 text-sm lg:text-base rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2",children:[(0,yi.jsx)(ls,{className:"w-5 h-5"}),"sent"===y?"\u2713 Log & Open Google Voice":"\u2713 Log SMS Communication"]}),(!d.trim()||!y)&&(0,yi.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Please select an outcome and enter message content"})]}),"email"===l&&(0,yi.jsxs)("div",{className:"space-y-4",children:[(0,yi.jsxs)("h3",{className:"text-sm lg:text-base font-semibold text-gray-900 flex items-center",children:[(0,yi.jsx)(ss,{className:"w-4 h-4 lg:w-5 lg:h-5 mr-2 text-purple-600"}),"\u2709\ufe0f Compose Email"]}),(0,yi.jsx)("div",{children:(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["To: ",(0,yi.jsx)("span",{className:"text-blue-600 font-semibold",children:s.email})]})}),(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Subject ",(0,yi.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,yi.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"Enter email subject...",className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Message ",(0,yi.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,yi.jsx)("textarea",{value:m,onChange:e=>g(e.target.value),placeholder:"Enter email message...",className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",rows:"5"})]}),(0,yi.jsxs)("button",{onClick:()=>{if(!p.trim()||!m.trim())return;const e="mailto:".concat(s.email,"?subject=").concat(encodeURIComponent(p),"&body=").concat(encodeURIComponent(m));window.location.href=e,f(""),g("")},disabled:!p.trim()||!m.trim(),className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2",children:[(0,yi.jsx)(cs,{className:"w-5 h-5"}),"\ud83d\udce7 Open Email Client"]})]}),"call"===l&&(0,yi.jsxs)("div",{className:"text-center py-8 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg border-2 border-blue-200",children:[(0,yi.jsxs)("div",{className:"relative inline-block mb-4",children:[(0,yi.jsx)(as,{className:"w-16 h-16 text-blue-600 animate-pulse"}),(0,yi.jsx)("div",{className:"absolute -top-2 -right-2 bg-green-500 rounded-full p-2",children:(0,yi.jsx)("span",{className:"text-white text-xl",children:"\ud83d\udcde"})})]}),(0,yi.jsx)("p",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Google Voice Call Window Opened"}),(0,yi.jsx)("p",{className:"text-blue-600 font-medium text-lg mb-1",children:s.phone}),(0,yi.jsx)("p",{className:"text-sm text-gray-600",children:s.name}),(0,yi.jsx)("div",{className:"mt-4 pt-4 border-t border-blue-200",children:(0,yi.jsx)("p",{className:"text-xs text-gray-500",children:"Complete the call in the Google Voice window"})})]})]}),(0,yi.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,yi.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center",children:[(0,yi.jsx)(us,{className:"w-5 h-5 mr-2 text-gray-600"}),"\ud83d\udcdc Communication History"]}),w.length>0&&(0,yi.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold",children:[w.length," interaction",1!==w.length?"s":""]})]}),0===w.length?(0,yi.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 bg-gradient-to-br from-gray-50 to-blue-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,yi.jsxs)("div",{className:"relative",children:[(0,yi.jsx)(hs,{className:"w-20 h-20 mb-4 opacity-30"}),(0,yi.jsx)("div",{className:"absolute -bottom-1 -right-1 text-4xl",children:"\ud83d\udcac"})]}),(0,yi.jsx)("p",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No communication history yet"}),(0,yi.jsx)("p",{className:"text-sm text-gray-500",children:"Start by making a call, sending an SMS, or email"})]}):(0,yi.jsx)("div",{className:"space-y-3",children:w.map((e,t)=>{var n;const r={sent:{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",icon:"\ud83d\udce4"},received:{bg:"bg-teal-50",border:"border-teal-200",text:"text-teal-700",icon:"\ud83d\udce5"},"follow-up":{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-700",icon:"\ud83d\udcc5"},"not-interested":{bg:"bg-red-50",border:"border-red-200",text:"text-red-700",icon:"\ud83d\udeab"},Completed:{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",icon:"\u2705"},"No Answer":{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-700",icon:"\ud83d\udcf5"}},a={call:{icon:as,color:"text-blue-600",emoji:"\ud83d\udcde",bg:"bg-blue-50"},sms:{icon:is,color:"text-green-600",emoji:"\ud83d\udcac",bg:"bg-green-50"},email:{icon:ss,color:"text-purple-600",emoji:"\u2709\ufe0f",bg:"bg-purple-50"}},i=(null===(n=a[e.type])||void 0===n?void 0:n.icon)||is,s=a[e.type]||a.sms;return(0,yi.jsxs)("div",{className:"".concat(s.bg," border-2 ").concat(e.outcome&&r[e.outcome]?r[e.outcome].border:"border-gray-200"," rounded-xl p-4 hover:shadow-lg transition-all hover:scale-[1.02]"),children:[(0,yi.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,yi.jsx)("div",{className:"p-2 ".concat(s.bg," rounded-lg border border-gray-200"),children:(0,yi.jsx)(i,{className:"w-5 h-5 ".concat(s.color)})}),(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("span",{className:"font-semibold text-gray-900 capitalize flex items-center gap-1",children:[s.emoji," ",e.type]}),e.outcome&&r[e.outcome]&&(0,yi.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full inline-flex items-center gap-1 mt-1 ".concat(r[e.outcome].bg," ").concat(r[e.outcome].text," border ").concat(r[e.outcome].border," font-medium"),children:[r[e.outcome].icon," ",e.outcome]})]})]}),(0,yi.jsxs)("div",{className:"flex items-center text-xs text-gray-600 bg-white px-2 py-1 rounded-full border border-gray-200",children:[(0,yi.jsx)(ee,{className:"w-3 h-3 mr-1"}),new Date(e.timestamp).toLocaleDateString()," ",new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.notes&&(0,yi.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mt-2",children:(0,yi.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:e.notes})})]},t)})})]})]}):(0,yi.jsx)("div",{className:"flex-1 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center",children:(0,yi.jsxs)("div",{className:"text-center text-gray-500 p-8 max-w-md",children:[(0,yi.jsxs)("div",{className:"relative inline-block mb-6",children:[(0,yi.jsx)(X,{className:"w-32 h-32 opacity-20"}),(0,yi.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl",children:"\ud83d\udcac"})]}),(0,yi.jsx)("h3",{className:"text-2xl font-bold mb-3 text-gray-700",children:"\ud83d\udc4b Select a Customer"}),(0,yi.jsx)("p",{className:"text-lg text-gray-600 mb-4",children:"Choose a customer from the list to:"}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-left bg-white rounded-lg p-4 border border-gray-200 shadow-sm",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,yi.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,yi.jsx)("span",{className:"text-gray-700",children:"Make phone calls via Google Voice"})]}),(0,yi.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,yi.jsx)("span",{className:"text-green-500",children:"\ud83d\udcac"}),(0,yi.jsx)("span",{className:"text-gray-700",children:"Send and log SMS messages"})]}),(0,yi.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,yi.jsx)("span",{className:"text-purple-500",children:"\u2709\ufe0f"}),(0,yi.jsx)("span",{className:"text-gray-700",children:"Compose and send emails"})]}),(0,yi.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,yi.jsx)("span",{className:"text-orange-500",children:"\ud83d\udcdc"}),(0,yi.jsx)("span",{className:"text-gray-700",children:"View communication history"})]})]})]})})]})}const As="180",ps={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},fs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ms=0,gs=1,ys=2,vs=3,bs=0,xs=1,ws=2,_s=3,Ss=0,Cs=1,Es=2,Ns=0,Bs=1,ks=2,Is=3,Ts=4,Ms=5,Fs=100,Rs=101,Ls=102,Us=103,Ps=104,Ds=200,Os=201,zs=202,Hs=203,js=204,Qs=205,Vs=206,Ws=207,Gs=208,Ks=209,qs=210,Xs=211,Ys=212,Js=213,Zs=214,$s=0,eo=1,to=2,no=3,ro=4,ao=5,io=6,so=7,oo=0,lo=1,co=2,uo=0,ho=1,Ao=2,po=3,fo=4,mo=5,go=6,yo=7,vo="attached",bo="detached",xo=300,wo=301,_o=302,So=303,Co=304,Eo=306,No=1e3,Bo=1001,ko=1002,Io=1003,To=1004,Mo=1004,Fo=1005,Ro=1005,Lo=1006,Uo=1007,Po=1007,Do=1008,Oo=1008,zo=1009,Ho=1010,jo=1011,Qo=1012,Vo=1013,Wo=1014,Go=1015,Ko=1016,qo=1017,Xo=1018,Yo=1020,Jo=35902,Zo=35899,$o=1021,el=1022,tl=1023,nl=1026,rl=1027,al=1028,il=1029,sl=1030,ol=1031,ll=1032,cl=1033,ul=33776,hl=33777,dl=33778,Al=33779,pl=35840,fl=35841,ml=35842,gl=35843,yl=36196,vl=37492,bl=37496,xl=37808,wl=37809,_l=37810,Sl=37811,Cl=37812,El=37813,Nl=37814,Bl=37815,kl=37816,Il=37817,Tl=37818,Ml=37819,Fl=37820,Rl=37821,Ll=36492,Ul=36494,Pl=36495,Dl=36283,Ol=36284,zl=36285,Hl=36286,jl=2200,Ql=2201,Vl=2202,Wl=2300,Gl=2301,Kl=2302,ql=2400,Xl=2401,Yl=2402,Jl=2500,Zl=2501,$l=0,ec=1,tc=2,nc=3200,rc=3201,ac=3202,ic=3203,sc=0,oc=1,lc="",cc="srgb",uc="srgb-linear",hc="linear",dc="srgb",Ac=0,pc=7680,fc=7681,mc=7682,gc=7683,yc=34055,vc=34056,bc=5386,xc=512,wc=513,_c=514,Sc=515,Cc=516,Ec=517,Nc=518,Bc=519,kc=512,Ic=513,Tc=514,Mc=515,Fc=516,Rc=517,Lc=518,Uc=519,Pc=35044,Dc=35048,Oc=35040,zc=35045,Hc=35049,jc=35041,Qc=35046,Vc=35050,Wc=35042,Gc="100",Kc="300 es",qc=2e3,Xc=2001,Yc={COMPUTE:"compute",RENDER:"render"},Jc={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Zc={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class $c{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}}const eu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let tu=1234567;const nu=Math.PI/180,ru=180/Math.PI;function au(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(eu[255&e]+eu[e>>8&255]+eu[e>>16&255]+eu[e>>24&255]+"-"+eu[255&t]+eu[t>>8&255]+"-"+eu[t>>16&15|64]+eu[t>>24&255]+"-"+eu[63&n|128]+eu[n>>8&255]+"-"+eu[n>>16&255]+eu[n>>24&255]+eu[255&r]+eu[r>>8&255]+eu[r>>16&255]+eu[r>>24&255]).toLowerCase()}function iu(e,t,n){return Math.max(t,Math.min(n,e))}function su(e,t){return(e%t+t)%t}function ou(e,t,n){return(1-n)*e+n*t}function lu(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function cu(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const uu={DEG2RAD:nu,RAD2DEG:ru,generateUUID:au,clamp:iu,euclideanModulo:su,mapLinear:function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:ou,damp:function(e,t,n,r){return ou(e,t,1-Math.exp(-n*r))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(su(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(tu=e);let t=tu+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*nu},radToDeg:function(e){return e*ru},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,a){const i=Math.cos,s=Math.sin,o=i(n/2),l=s(n/2),c=i((t+r)/2),u=s((t+r)/2),h=i((t-r)/2),d=s((t-r)/2),A=i((r-t)/2),p=s((r-t)/2);switch(a){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*A,o*c);break;case"YXY":e.set(l*A,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*A,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:cu,denormalize:lu};class hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;hu.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=iu(this.x,e.x,t.x),this.y=iu(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=iu(this.x,e,t),this.y=iu(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(iu(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(iu(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,a,i,s){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=a[i+0],d=a[i+1],A=a[i+2],p=a[i+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=A,void(e[t+3]=p);if(u!==p||o!==h||l!==d||c!==A){let e=1-s;const t=o*h+l*d+c*A+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const a=Math.sqrt(r),i=Math.atan2(a,t*n);e=Math.sin(e*i)/a,s=Math.sin(s*i)/a}const a=s*n;if(o=o*e+h*a,l=l*e+d*a,c=c*e+A*a,u=u*e+p*a,e===1-s){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,a,i){const s=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=a[i],h=a[i+1],d=a[i+2],A=a[i+3];return e[t]=s*A+c*u+o*d-l*h,e[t+1]=o*A+c*h+l*u-s*d,e[t+2]=l*A+c*d+s*h-o*u,e[t+3]=c*A-s*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,r=e._y,a=e._z,i=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(r/2),u=s(a/2),h=o(n/2),d=o(r/2),A=o(a/2);switch(i){case"XYZ":this._x=h*c*u+l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u-h*d*A;break;case"YXZ":this._x=h*c*u+l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u+h*d*A;break;case"ZXY":this._x=h*c*u-l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u-h*d*A;break;case"ZYX":this._x=h*c*u-l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u+h*d*A;break;case"YZX":this._x=h*c*u+l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u-h*d*A;break;case"XZY":this._x=h*c*u-l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u+h*d*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(a-l)*e,this._z=(i-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+i)/e,this._z=(a+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(a-l)/e,this._x=(r+i)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(i-r)/e,this._x=(a+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(iu(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,a=e._z,i=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+i*s+r*l-a*o,this._y=r*c+i*o+a*s-n*l,this._z=a*c+i*l+n*o-r*s,this._w=i*c-n*s-r*o-a*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,a=this._z,i=this._w;let s=i*e._w+n*e._x+r*e._y+a*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*i+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*a+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=i*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=a*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),a=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Au{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Au.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(fu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(fu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,s=e.z,o=e.w,l=2*(i*r-s*n),c=2*(s*t-a*r),u=2*(a*n-i*t);return this.x=t+o*l+i*u-s*c,this.y=n+o*c+s*l-a*u,this.z=r+o*u+a*c-i*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=iu(this.x,e.x,t.x),this.y=iu(this.y,e.y,t.y),this.z=iu(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=iu(this.x,e,t),this.y=iu(this.y,e,t),this.z=iu(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(iu(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,a=e.z,i=t.x,s=t.y,o=t.z;return this.x=r*o-a*s,this.y=a*i-n*o,this.z=n*s-r*i,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return pu.copy(this).projectOnVector(e),this.sub(pu)}reflect(e){return this.sub(pu.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(iu(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pu=new Au,fu=new du;class mu{constructor(e,t,n,r,a,i,s,o,l){mu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,a,i,s,o,l)}set(e,t,n,r,a,i,s,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=a,c[5]=o,c[6]=n,c[7]=i,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],s=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],A=n[8],p=r[0],f=r[3],m=r[6],g=r[1],y=r[4],v=r[7],b=r[2],x=r[5],w=r[8];return a[0]=i*p+s*g+o*b,a[3]=i*f+s*y+o*x,a[6]=i*m+s*v+o*w,a[1]=l*p+c*g+u*b,a[4]=l*f+c*y+u*x,a[7]=l*m+c*v+u*w,a[2]=h*p+d*g+A*b,a[5]=h*f+d*y+A*x,a[8]=h*m+d*v+A*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*i*c-t*s*l-n*a*c+n*s*o+r*a*l-r*i*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=c*i-s*l,h=s*o-c*a,d=l*a-i*o,A=t*u+n*h+r*d;if(0===A)return this.set(0,0,0,0,0,0,0,0,0);const p=1/A;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(s*n-r*i)*p,e[3]=h*p,e[4]=(c*t-r*o)*p,e[5]=(r*a-s*t)*p,e[6]=d*p,e[7]=(n*o-l*t)*p,e[8]=(i*t-n*a)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,a,i,s){const o=Math.cos(a),l=Math.sin(a);return this.set(n*o,n*l,-n*(o*i+l*s)+i+e,-r*l,r*o,-r*(-l*i+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(gu.makeScale(e,t)),this}rotate(e){return this.premultiply(gu.makeRotation(-e)),this}translate(e,t){return this.premultiply(gu.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const gu=new mu;function yu(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const vu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function bu(e,t){return new vu[e](t)}function xu(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function wu(){const e=xu("canvas");return e.style.display="block",e}const _u={};function Su(e){e in _u||(_u[e]=!0,console.warn(e))}const Cu=(new mu).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Eu=(new mu).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Nu(){const e={enabled:!0,workingColorSpace:uc,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===dc&&(e.r=ku(e.r),e.g=ku(e.g),e.b=ku(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===dc&&(e.r=Iu(e.r),e.g=Iu(e.g),e.b=Iu(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===lc?hc:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Su("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Su("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[uc]:{primaries:t,whitePoint:r,transfer:hc,toXYZ:Cu,fromXYZ:Eu,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:cc},outputColorSpaceConfig:{drawingBufferColorSpace:cc}},[cc]:{primaries:t,whitePoint:r,transfer:dc,toXYZ:Cu,fromXYZ:Eu,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:cc}}}),e}const Bu=Nu();function ku(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Iu(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Tu;class Mu{static getDataURL(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Tu&&(Tu=xu("canvas")),Tu.width=e.width,Tu.height=e.height;const n=Tu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Tu}return t.toDataURL(n)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=xu("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),a=r.data;for(let e=0;e<a.length;e++)a[e]=255*ku(a[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ku(t[e]/255)):t[e]=ku(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Fu=0;class Ru{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Fu++}),this.uuid=au(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Lu(r[t].image)):e.push(Lu(r[t]))}else e=Lu(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Lu(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Mu.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Uu=0;const Pu=new Au;class Du extends $c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Du.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Du.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bo,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bo,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Lo,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Do,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:tl,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:zo,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Du.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:lc;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Uu++}),this.uuid=au(),this.name="",this.source=new Ru(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=a,this.minFilter=i,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new hu(0,0),this.repeat=new hu(1,1),this.center=new hu(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Pu).x}get height(){return this.source.getSize(Pu).y}get depth(){return this.source.getSize(Pu).z}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Texture.setValues(): parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n:console.warn("THREE.Texture.setValues(): property '".concat(t,"' does not exist."))}}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==xo)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case No:e.x=e.x-Math.floor(e.x);break;case Bo:e.x=e.x<0?0:1;break;case ko:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case No:e.y=e.y-Math.floor(e.y);break;case Bo:e.y=e.y<0?0:1;break;case ko:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Du.DEFAULT_IMAGE=null,Du.DEFAULT_MAPPING=xo,Du.DEFAULT_ANISOTROPY=1;class Ou{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Ou.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,a;const i=.01,s=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],A=o[9],p=o[2],f=o[6],m=o[10];if(Math.abs(c-h)<i&&Math.abs(u-p)<i&&Math.abs(A-f)<i){if(Math.abs(c+h)<s&&Math.abs(u+p)<s&&Math.abs(A+f)<s&&Math.abs(l+d+m-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,g=(m+1)/2,y=(c+h)/4,v=(u+p)/4,b=(A+f)/4;return e>o&&e>g?e<i?(n=0,r=.707106781,a=.707106781):(n=Math.sqrt(e),r=y/n,a=v/n):o>g?o<i?(n=.707106781,r=0,a=.707106781):(r=Math.sqrt(o),n=y/r,a=b/r):g<i?(n=.707106781,r=.707106781,a=0):(a=Math.sqrt(g),n=v/a,r=b/a),this.set(n,r,a,t),this}let g=Math.sqrt((f-A)*(f-A)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(g)<.001&&(g=1),this.x=(f-A)/g,this.y=(u-p)/g,this.z=(h-c)/g,this.w=Math.acos((l+d+m-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=iu(this.x,e.x,t.x),this.y=iu(this.y,e.y,t.y),this.z=iu(this.z,e.z,t.z),this.w=iu(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=iu(this.x,e,t),this.y=iu(this.y,e,t),this.z=iu(this.z,e,t),this.w=iu(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(iu(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class zu extends $c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Lo,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Ou(0,0,e,t),this.scissorTest=!1,this.viewport=new Ou(0,0,e,t);const r={width:e,height:t,depth:n.depth},a=new Du(r);this.textures=[];const i=n.count;for(let s=0;s<i;s++)this.textures[s]=a.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={minFilter:Lo,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,a=this.textures.length;r<a;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new Ru(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Hu extends zu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class ju extends Du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Io,this.minFilter=Io,this.wrapR=Bo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Qu extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new ju(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Vu extends Du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Io,this.minFilter=Io,this.wrapR=Bo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Wu extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Vu(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Gu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(qu.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(qu.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=qu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,qu):qu.fromBufferAttribute(r,t),qu.applyMatrix4(e.matrixWorld),this.expandByPoint(qu);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Xu.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Xu.copy(n.boundingBox)),Xu.applyMatrix4(e.matrixWorld),this.union(Xu)}const r=e.children;for(let a=0,i=r.length;a<i;a++)this.expandByObject(r[a],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,qu),qu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nh),rh.subVectors(this.max,nh),Yu.subVectors(e.a,nh),Ju.subVectors(e.b,nh),Zu.subVectors(e.c,nh),$u.subVectors(Ju,Yu),eh.subVectors(Zu,Ju),th.subVectors(Yu,Zu);let t=[0,-$u.z,$u.y,0,-eh.z,eh.y,0,-th.z,th.y,$u.z,0,-$u.x,eh.z,0,-eh.x,th.z,0,-th.x,-$u.y,$u.x,0,-eh.y,eh.x,0,-th.y,th.x,0];return!!sh(t,Yu,Ju,Zu,rh)&&(t=[1,0,0,0,1,0,0,0,1],!!sh(t,Yu,Ju,Zu,rh)&&(ah.crossVectors($u,eh),t=[ah.x,ah.y,ah.z],sh(t,Yu,Ju,Zu,rh)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(qu).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ku[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ku[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ku[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ku[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ku[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ku[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ku[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ku[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ku)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ku=[new Au,new Au,new Au,new Au,new Au,new Au,new Au,new Au],qu=new Au,Xu=new Gu,Yu=new Au,Ju=new Au,Zu=new Au,$u=new Au,eh=new Au,th=new Au,nh=new Au,rh=new Au,ah=new Au,ih=new Au;function sh(e,t,n,r,a){for(let i=0,s=e.length-3;i<=s;i+=3){ih.fromArray(e,i);const s=a.x*Math.abs(ih.x)+a.y*Math.abs(ih.y)+a.z*Math.abs(ih.z),o=t.dot(ih),l=n.dot(ih),c=r.dot(ih);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}const oh=new Gu,lh=new Au,ch=new Au;class uh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):oh.setFromPoints(e).getCenter(n);let r=0;for(let a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;lh.subVectors(e,this.center);const t=lh.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(lh,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ch.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(lh.copy(e.center).add(ch)),this.expandByPoint(lh.copy(e.center).sub(ch))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const hh=new Au,dh=new Au,Ah=new Au,ph=new Au,fh=new Au,mh=new Au,gh=new Au;class yh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hh.copy(this.origin).addScaledVector(this.direction,t),hh.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){dh.copy(e).add(t).multiplyScalar(.5),Ah.copy(t).sub(e).normalize(),ph.copy(this.origin).sub(dh);const a=.5*e.distanceTo(t),i=-this.direction.dot(Ah),s=ph.dot(this.direction),o=-ph.dot(Ah),l=ph.lengthSq(),c=Math.abs(1-i*i);let u,h,d,A;if(c>0)if(u=i*o-s,h=i*s-o,A=a*c,u>=0)if(h>=-A)if(h<=A){const e=1/c;u*=e,h*=e,d=u*(u+i*h+2*s)+h*(i*u+h+2*o)+l}else h=a,u=Math.max(0,-(i*h+s)),d=-u*u+h*(h+2*o)+l;else h=-a,u=Math.max(0,-(i*h+s)),d=-u*u+h*(h+2*o)+l;else h<=-A?(u=Math.max(0,-(-i*a+s)),h=u>0?-a:Math.min(Math.max(-a,-o),a),d=-u*u+h*(h+2*o)+l):h<=A?(u=0,h=Math.min(Math.max(-a,-o),a),d=h*(h+2*o)+l):(u=Math.max(0,-(i*a+s)),h=u>0?a:Math.min(Math.max(-a,-o),a),d=-u*u+h*(h+2*o)+l);else h=i>0?-a:a,u=Math.max(0,-(i*h+s)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(dh).addScaledVector(Ah,h),d}intersectSphere(e,t){hh.subVectors(e.center,this.origin);const n=hh.dot(this.direction),r=hh.dot(hh)-n*n,a=e.radius*e.radius;if(r>a)return null;const i=Math.sqrt(a-r),s=n-i,o=n+i;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,a,i,s,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(a=(e.min.y-h.y)*c,i=(e.max.y-h.y)*c):(a=(e.max.y-h.y)*c,i=(e.min.y-h.y)*c),n>i||a>r?null:((a>n||isNaN(n))&&(n=a),(i<r||isNaN(r))&&(r=i),u>=0?(s=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||s>r?null:((s>n||n!==n)&&(n=s),(o<r||r!==r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,hh)}intersectTriangle(e,t,n,r,a){fh.subVectors(t,e),mh.subVectors(n,e),gh.crossVectors(fh,mh);let i,s=this.direction.dot(gh);if(s>0){if(r)return null;i=1}else{if(!(s<0))return null;i=-1,s=-s}ph.subVectors(this.origin,e);const o=i*this.direction.dot(mh.crossVectors(ph,mh));if(o<0)return null;const l=i*this.direction.dot(fh.cross(ph));if(l<0)return null;if(o+l>s)return null;const c=-i*ph.dot(gh);return c<0?null:this.at(c/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class vh{constructor(e,t,n,r,a,i,s,o,l,c,u,h,d,A,p,f){vh.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,a,i,s,o,l,c,u,h,d,A,p,f)}set(e,t,n,r,a,i,s,o,l,c,u,h,d,A,p,f){const m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=a,m[5]=i,m[9]=s,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=A,m[11]=p,m[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new vh).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/bh.setFromMatrixColumn(e,0).length(),a=1/bh.setFromMatrixColumn(e,1).length(),i=1/bh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),s=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(a),u=Math.sin(a);if("XYZ"===e.order){const e=i*c,n=i*u,r=s*c,a=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-a*l,t[9]=-s*o,t[2]=a-e*l,t[6]=r+n*l,t[10]=i*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,a=l*u;t[0]=e+a*s,t[4]=r*s-n,t[8]=i*l,t[1]=i*u,t[5]=i*c,t[9]=-s,t[2]=n*s-r,t[6]=a+e*s,t[10]=i*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,a=l*u;t[0]=e-a*s,t[4]=-i*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=i*c,t[9]=a-e*s,t[2]=-i*l,t[6]=s,t[10]=i*o}else if("ZYX"===e.order){const e=i*c,n=i*u,r=s*c,a=s*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+a,t[1]=o*u,t[5]=a*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*o,t[10]=i*o}else if("YZX"===e.order){const e=i*o,n=i*l,r=s*o,a=s*l;t[0]=o*c,t[4]=a-e*u,t[8]=r*u+n,t[1]=u,t[5]=i*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-a*u}else if("XZY"===e.order){const e=i*o,n=i*l,r=s*o,a=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+a,t[5]=i*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=a*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wh,e,_h)}lookAt(e,t,n){const r=this.elements;return Eh.subVectors(e,t),0===Eh.lengthSq()&&(Eh.z=1),Eh.normalize(),Sh.crossVectors(n,Eh),0===Sh.lengthSq()&&(1===Math.abs(n.z)?Eh.x+=1e-4:Eh.z+=1e-4,Eh.normalize(),Sh.crossVectors(n,Eh)),Sh.normalize(),Ch.crossVectors(Eh,Sh),r[0]=Sh.x,r[4]=Ch.x,r[8]=Eh.x,r[1]=Sh.y,r[5]=Ch.y,r[9]=Eh.y,r[2]=Sh.z,r[6]=Ch.z,r[10]=Eh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],A=n[2],p=n[6],f=n[10],m=n[14],g=n[3],y=n[7],v=n[11],b=n[15],x=r[0],w=r[4],_=r[8],S=r[12],C=r[1],E=r[5],N=r[9],B=r[13],k=r[2],I=r[6],T=r[10],M=r[14],F=r[3],R=r[7],L=r[11],U=r[15];return a[0]=i*x+s*C+o*k+l*F,a[4]=i*w+s*E+o*I+l*R,a[8]=i*_+s*N+o*T+l*L,a[12]=i*S+s*B+o*M+l*U,a[1]=c*x+u*C+h*k+d*F,a[5]=c*w+u*E+h*I+d*R,a[9]=c*_+u*N+h*T+d*L,a[13]=c*S+u*B+h*M+d*U,a[2]=A*x+p*C+f*k+m*F,a[6]=A*w+p*E+f*I+m*R,a[10]=A*_+p*N+f*T+m*L,a[14]=A*S+p*B+f*M+m*U,a[3]=g*x+y*C+v*k+b*F,a[7]=g*w+y*E+v*I+b*R,a[11]=g*_+y*N+v*T+b*L,a[15]=g*S+y*B+v*M+b*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+a*o*u-r*l*u-a*s*h+n*l*h+r*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+a*i*h-r*i*d+r*l*c-a*o*c)+e[11]*(+t*l*u-t*s*d-a*i*u+n*i*d+a*s*c-n*l*c)+e[15]*(-r*s*c-t*o*u+t*s*h+r*i*u-n*i*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],A=e[12],p=e[13],f=e[14],m=e[15],g=u*f*l-p*h*l+p*o*d-s*f*d-u*o*m+s*h*m,y=A*h*l-c*f*l-A*o*d+i*f*d+c*o*m-i*h*m,v=c*p*l-A*u*l+A*s*d-i*p*d-c*s*m+i*u*m,b=A*u*o-c*p*o-A*s*h+i*p*h+c*s*f-i*u*f,x=t*g+n*y+r*v+a*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=g*w,e[1]=(p*h*a-u*f*a-p*r*d+n*f*d+u*r*m-n*h*m)*w,e[2]=(s*f*a-p*o*a+p*r*l-n*f*l-s*r*m+n*o*m)*w,e[3]=(u*o*a-s*h*a-u*r*l+n*h*l+s*r*d-n*o*d)*w,e[4]=y*w,e[5]=(c*f*a-A*h*a+A*r*d-t*f*d-c*r*m+t*h*m)*w,e[6]=(A*o*a-i*f*a-A*r*l+t*f*l+i*r*m-t*o*m)*w,e[7]=(i*h*a-c*o*a+c*r*l-t*h*l-i*r*d+t*o*d)*w,e[8]=v*w,e[9]=(A*u*a-c*p*a-A*n*d+t*p*d+c*n*m-t*u*m)*w,e[10]=(i*p*a-A*s*a+A*n*l-t*p*l-i*n*m+t*s*m)*w,e[11]=(c*s*a-i*u*a-c*n*l+t*u*l+i*n*d-t*s*d)*w,e[12]=b*w,e[13]=(c*p*r-A*u*r+A*n*h-t*p*h-c*n*f+t*u*f)*w,e[14]=(A*s*r-i*p*r-A*n*o+t*p*o+i*n*f-t*s*f)*w,e[15]=(i*u*r-c*s*r+c*n*o-t*u*o-i*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,s=e.y,o=e.z,l=a*i,c=a*s;return this.set(l*i+n,l*s-r*o,l*o+r*s,0,l*s+r*o,c*s+n,c*o-r*i,0,l*o-r*s,c*o+r*i,a*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,a=t._x,i=t._y,s=t._z,o=t._w,l=a+a,c=i+i,u=s+s,h=a*l,d=a*c,A=a*u,p=i*c,f=i*u,m=s*u,g=o*l,y=o*c,v=o*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(p+m))*b,r[1]=(d+v)*b,r[2]=(A-y)*b,r[3]=0,r[4]=(d-v)*x,r[5]=(1-(h+m))*x,r[6]=(f+g)*x,r[7]=0,r[8]=(A+y)*w,r[9]=(f-g)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let a=bh.set(r[0],r[1],r[2]).length();const i=bh.set(r[4],r[5],r[6]).length(),s=bh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],xh.copy(this);const o=1/a,l=1/i,c=1/s;return xh.elements[0]*=o,xh.elements[1]*=o,xh.elements[2]*=o,xh.elements[4]*=l,xh.elements[5]*=l,xh.elements[6]*=l,xh.elements[8]*=c,xh.elements[9]*=c,xh.elements[10]*=c,t.setFromRotationMatrix(xh),n.x=a,n.y=i,n.z=s,this}makePerspective(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:qc,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*a/(t-e),u=2*a/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let A,p;if(o)A=a/(i-a),p=i*a/(i-a);else if(s===qc)A=-(i+a)/(i-a),p=-2*i*a/(i-a);else{if(s!==Xc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);A=-i/(i-a),p=-i*a/(i-a)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=A,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:qc,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(t-e),u=2/(n-r),h=-(t+e)/(t-e),d=-(n+r)/(n-r);let A,p;if(o)A=1/(i-a),p=i/(i-a);else if(s===qc)A=-2/(i-a),p=-(i+a)/(i-a);else{if(s!==Xc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);A=-1/(i-a),p=-a/(i-a)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=A,l[14]=p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const bh=new Au,xh=new vh,wh=new Au(0,0,0),_h=new Au(1,1,1),Sh=new Au,Ch=new Au,Eh=new Au,Nh=new vh,Bh=new du;class kh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kh.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,a=r[0],i=r[4],s=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(iu(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-iu(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(iu(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-i,l)):(this._y=0,this._z=Math.atan2(o,a));break;case"ZYX":this._y=Math.asin(-iu(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,a)):(this._x=0,this._z=Math.atan2(-i,l));break;case"YZX":this._z=Math.asin(iu(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-iu(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Nh.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Nh,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Bh.setFromEuler(this),this.setFromQuaternion(Bh,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}kh.DEFAULT_ORDER="XYZ";class Ih{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Th=0;const Mh=new Au,Fh=new du,Rh=new vh,Lh=new Au,Uh=new Au,Ph=new Au,Dh=new du,Oh=new Au(1,0,0),zh=new Au(0,1,0),Hh=new Au(0,0,1),jh={type:"added"},Qh={type:"removed"},Vh={type:"childadded",child:null},Wh={type:"childremoved",child:null};class Gh extends $c{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Th++}),this.uuid=au(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gh.DEFAULT_UP.clone();const e=new Au,t=new kh,n=new du,r=new Au(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new vh},normalMatrix:{value:new mu}}),this.matrix=new vh,this.matrixWorld=new vh,this.matrixAutoUpdate=Gh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Gh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ih,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Fh.setFromAxisAngle(e,t),this.quaternion.multiply(Fh),this}rotateOnWorldAxis(e,t){return Fh.setFromAxisAngle(e,t),this.quaternion.premultiply(Fh),this}rotateX(e){return this.rotateOnAxis(Oh,e)}rotateY(e){return this.rotateOnAxis(zh,e)}rotateZ(e){return this.rotateOnAxis(Hh,e)}translateOnAxis(e,t){return Mh.copy(e).applyQuaternion(this.quaternion),this.position.add(Mh.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Oh,e)}translateY(e){return this.translateOnAxis(zh,e)}translateZ(e){return this.translateOnAxis(Hh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Rh.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Lh.copy(e):Lh.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Uh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Rh.lookAt(Uh,Lh,this.up):Rh.lookAt(Lh,Uh,this.up),this.quaternion.setFromRotationMatrix(Rh),r&&(Rh.extractRotation(r.matrixWorld),Fh.setFromRotationMatrix(Rh),this.quaternion.premultiply(Fh.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(jh),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Qh),Wh.child=e,this.dispatchEvent(Wh),Wh.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Rh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Rh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Rh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(jh),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const r=this.children;for(let a=0,i=r.length;a<i;a++)r[a].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uh,e,Ph),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uh,Dh,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(e=>M(M({},e),{},{boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(e=>M({},e)),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];a(e.shapes,r)}else a(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(a(e.materials,this.material[n]));r.material=t}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(a(e.animations,n))}}if(t){const t=i(e.geometries),r=i(e.materials),a=i(e.textures),s=i(e.images),o=i(e.shapes),l=i(e.skeletons),c=i(e.animations),u=i(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),a.length>0&&(n.textures=a),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function i(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Gh.DEFAULT_UP=new Au(0,1,0),Gh.DEFAULT_MATRIX_AUTO_UPDATE=!0,Gh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Kh=new Au,qh=new Au,Xh=new Au,Yh=new Au,Jh=new Au,Zh=new Au,$h=new Au,ed=new Au,td=new Au,nd=new Au,rd=new Ou,ad=new Ou,id=new Ou;class sd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Au;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Kh.subVectors(e,t),r.cross(Kh);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(e,t,n,r,a){Kh.subVectors(r,t),qh.subVectors(n,t),Xh.subVectors(e,t);const i=Kh.dot(Kh),s=Kh.dot(qh),o=Kh.dot(Xh),l=qh.dot(qh),c=qh.dot(Xh),u=i*l-s*s;if(0===u)return a.set(0,0,0),null;const h=1/u,d=(l*o-s*c)*h,A=(i*c-s*o)*h;return a.set(1-d-A,A,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,Yh)&&(Yh.x>=0&&Yh.y>=0&&Yh.x+Yh.y<=1)}static getInterpolation(e,t,n,r,a,i,s,o){return null===this.getBarycoord(e,t,n,r,Yh)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(a,Yh.x),o.addScaledVector(i,Yh.y),o.addScaledVector(s,Yh.z),o)}static getInterpolatedAttribute(e,t,n,r,a,i){return rd.setScalar(0),ad.setScalar(0),id.setScalar(0),rd.fromBufferAttribute(e,t),ad.fromBufferAttribute(e,n),id.fromBufferAttribute(e,r),i.setScalar(0),i.addScaledVector(rd,a.x),i.addScaledVector(ad,a.y),i.addScaledVector(id,a.z),i}static isFrontFacing(e,t,n,r){return Kh.subVectors(n,t),qh.subVectors(e,t),Kh.cross(qh).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Kh.subVectors(this.c,this.b),qh.subVectors(this.a,this.b),.5*Kh.cross(qh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return sd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return sd.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,a){return sd.getInterpolation(e,this.a,this.b,this.c,t,n,r,a)}containsPoint(e){return sd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return sd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,a=this.c;let i,s;Jh.subVectors(r,n),Zh.subVectors(a,n),ed.subVectors(e,n);const o=Jh.dot(ed),l=Zh.dot(ed);if(o<=0&&l<=0)return t.copy(n);td.subVectors(e,r);const c=Jh.dot(td),u=Zh.dot(td);if(c>=0&&u<=c)return t.copy(r);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return i=o/(o-c),t.copy(n).addScaledVector(Jh,i);nd.subVectors(e,a);const d=Jh.dot(nd),A=Zh.dot(nd);if(A>=0&&d<=A)return t.copy(a);const p=d*l-o*A;if(p<=0&&l>=0&&A<=0)return s=l/(l-A),t.copy(n).addScaledVector(Zh,s);const f=c*A-d*u;if(f<=0&&u-c>=0&&d-A>=0)return $h.subVectors(a,r),s=(u-c)/(u-c+(d-A)),t.copy(r).addScaledVector($h,s);const m=1/(f+p+h);return i=p*m,s=h*m,t.copy(n).addScaledVector(Jh,i).addScaledVector(Zh,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const od={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ld={h:0,s:0,l:0},cd={h:0,s:0,l:0};function ud(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class hd{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cc;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Bu.colorSpaceToWorking(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bu.workingColorSpace;return this.r=e,this.g=t,this.b=n,Bu.colorSpaceToWorking(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bu.workingColorSpace;if(e=su(e,1),t=iu(t,0,1),n=iu(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=ud(a,r,e+1/3),this.g=ud(a,r,e),this.b=ud(a,r,e-1/3)}return Bu.colorSpaceToWorking(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cc;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const i=t[1],s=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],a=r.length;if(3===a)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===a)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cc;const n=od[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ku(e.r),this.g=ku(e.g),this.b=ku(e.b),this}copyLinearToSRGB(e){return this.r=Iu(e.r),this.g=Iu(e.g),this.b=Iu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cc;return Bu.workingToColorSpace(dd.copy(this),e),65536*Math.round(iu(255*dd.r,0,255))+256*Math.round(iu(255*dd.g,0,255))+Math.round(iu(255*dd.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cc;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bu.workingColorSpace;Bu.workingToColorSpace(dd.copy(this),t);const n=dd.r,r=dd.g,a=dd.b,i=Math.max(n,r,a),s=Math.min(n,r,a);let o,l;const c=(s+i)/2;if(s===i)o=0,l=0;else{const e=i-s;switch(l=c<=.5?e/(i+s):e/(2-i-s),i){case n:o=(r-a)/e+(r<a?6:0);break;case r:o=(a-n)/e+2;break;case a:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bu.workingColorSpace;return Bu.workingToColorSpace(dd.copy(this),t),e.r=dd.r,e.g=dd.g,e.b=dd.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cc;Bu.workingToColorSpace(dd.copy(this),e);const t=dd.r,n=dd.g,r=dd.b;return e!==cc?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}offsetHSL(e,t,n){return this.getHSL(ld),this.setHSL(ld.h+e,ld.s+t,ld.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ld),e.getHSL(cd);const n=ou(ld.h,cd.h,t),r=ou(ld.s,cd.s,t),a=ou(ld.l,cd.l,t);return this.setHSL(n,r,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,a=e.elements;return this.r=a[0]*t+a[3]*n+a[6]*r,this.g=a[1]*t+a[4]*n+a[7]*r,this.b=a[2]*t+a[5]*n+a[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const dd=new hd;hd.NAMES=od;let Ad=0;class pd extends $c{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ad++}),this.uuid=au(),this.name="",this.type="Material",this.blending=Bs,this.side=Ss,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=js,this.blendDst=Qs,this.blendEquation=Fs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new hd(0,0,0),this.blendAlpha=0,this.depthFunc=no,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Bc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=pc,this.stencilZFail=pc,this.stencilZPass=pc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Bs&&(n.blending=this.blending),this.side!==Ss&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==js&&(n.blendSrc=this.blendSrc),this.blendDst!==Qs&&(n.blendDst=this.blendDst),this.blendEquation!==Fs&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==no&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Bc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==pc&&(n.stencilFail=this.stencilFail),this.stencilZFail!==pc&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==pc&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),a=r(e.images);t.length>0&&(n.textures=t),a.length>0&&(n.images=a)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class fd extends pd{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new hd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kh,this.combine=oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const md=gd();function gd(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),a=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(r[l]=0,r[256|l]=32768,a[l]=24,a[256|l]=24):e<-14?(r[l]=1024>>-e-14,r[256|l]=1024>>-e-14|32768,a[l]=-e-1,a[256|l]=-e-1):e<=15?(r[l]=e+15<<10,r[256|l]=e+15<<10|32768,a[l]=13,a[256|l]=13):e<128?(r[l]=31744,r[256|l]=64512,a[l]=24,a[256|l]=24):(r[l]=31744,r[256|l]=64512,a[l]=13,a[256|l]=13)}const i=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,i[l]=e|t}for(let l=1024;l<2048;++l)i[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:a,mantissaTable:i,exponentTable:s,offsetTable:o}}function yd(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=iu(e,-65504,65504),md.floatView[0]=e;const t=md.uint32View[0],n=t>>23&511;return md.baseTable[n]+((8388607&t)>>md.shiftTable[n])}function vd(e){const t=e>>10;return md.uint32View[0]=md.mantissaTable[md.offsetTable[t]+(1023&e)]+md.exponentTable[t],md.floatView[0]}class bd{static toHalfFloat(e){return yd(e)}static fromHalfFloat(e){return vd(e)}}const xd=new Au,wd=new hu;let _d=0;class Sd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_d++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Pc,this.updateRanges=[],this.gpuType=Go,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)wd.fromBufferAttribute(this,t),wd.applyMatrix3(e),this.setXY(t,wd.x,wd.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)xd.fromBufferAttribute(this,t),xd.applyMatrix3(e),this.setXYZ(t,xd.x,xd.y,xd.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)xd.fromBufferAttribute(this,t),xd.applyMatrix4(e),this.setXYZ(t,xd.x,xd.y,xd.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)xd.fromBufferAttribute(this,t),xd.applyNormalMatrix(e),this.setXYZ(t,xd.x,xd.y,xd.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)xd.fromBufferAttribute(this,t),xd.transformDirection(e),this.setXYZ(t,xd.x,xd.y,xd.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=lu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=cu(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=lu(t,this.array)),t}setX(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=lu(t,this.array)),t}setY(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=lu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=lu(t,this.array)),t}setW(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array),a=cu(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Pc&&(e.usage=this.usage),e}}class Cd extends Sd{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Ed extends Sd{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Nd extends Sd{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Bd extends Sd{constructor(e,t,n){super(new Int16Array(e),t,n)}}class kd extends Sd{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Id extends Sd{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Td extends Sd{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Md extends Sd{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=vd(this.array[e*this.itemSize]);return this.normalized&&(t=lu(t,this.array)),t}setX(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize]=yd(t),this}getY(e){let t=vd(this.array[e*this.itemSize+1]);return this.normalized&&(t=lu(t,this.array)),t}setY(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+1]=yd(t),this}getZ(e){let t=vd(this.array[e*this.itemSize+2]);return this.normalized&&(t=lu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+2]=yd(t),this}getW(e){let t=vd(this.array[e*this.itemSize+3]);return this.normalized&&(t=lu(t,this.array)),t}setW(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+3]=yd(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array)),this.array[e+0]=yd(t),this.array[e+1]=yd(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array)),this.array[e+0]=yd(t),this.array[e+1]=yd(n),this.array[e+2]=yd(r),this}setXYZW(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array),a=cu(a,this.array)),this.array[e+0]=yd(t),this.array[e+1]=yd(n),this.array[e+2]=yd(r),this.array[e+3]=yd(a),this}}class Fd extends Sd{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Rd=0;const Ld=new vh,Ud=new Gh,Pd=new Au,Dd=new Gu,Od=new Gu,zd=new Au;class Hd extends $c{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Rd++}),this.uuid=au(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(yu(e)?Td:kd)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new mu).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ld.makeRotationFromQuaternion(e),this.applyMatrix4(Ld),this}rotateX(e){return Ld.makeRotationX(e),this.applyMatrix4(Ld),this}rotateY(e){return Ld.makeRotationY(e),this.applyMatrix4(Ld),this}rotateZ(e){return Ld.makeRotationZ(e),this.applyMatrix4(Ld),this}translate(e,t,n){return Ld.makeTranslation(e,t,n),this.applyMatrix4(Ld),this}scale(e,t,n){return Ld.makeScale(e,t,n),this.applyMatrix4(Ld),this}lookAt(e){return Ud.lookAt(e),Ud.updateMatrix(),this.applyMatrix4(Ud.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pd).negate(),this.translate(Pd.x,Pd.y,Pd.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Fd(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Gu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Au(-1/0,-1/0,-1/0),new Au(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];Dd.setFromBufferAttribute(e),this.morphTargetsRelative?(zd.addVectors(this.boundingBox.min,Dd.min),this.boundingBox.expandByPoint(zd),zd.addVectors(this.boundingBox.max,Dd.max),this.boundingBox.expandByPoint(zd)):(this.boundingBox.expandByPoint(Dd.min),this.boundingBox.expandByPoint(Dd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Au,1/0);if(e){const n=this.boundingSphere.center;if(Dd.setFromBufferAttribute(e),t)for(let e=0,a=t.length;e<a;e++){const n=t[e];Od.setFromBufferAttribute(n),this.morphTargetsRelative?(zd.addVectors(Dd.min,Od.min),Dd.expandByPoint(zd),zd.addVectors(Dd.max,Od.max),Dd.expandByPoint(zd)):(Dd.expandByPoint(Od.min),Dd.expandByPoint(Od.max))}Dd.getCenter(n);let r=0;for(let t=0,a=e.count;t<a;t++)zd.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(zd));if(t)for(let a=0,i=t.length;a<i;a++){const i=t[a],s=this.morphTargetsRelative;for(let t=0,a=i.count;t<a;t++)zd.fromBufferAttribute(i,t),s&&(Pd.fromBufferAttribute(e,t),zd.add(Pd)),r=Math.max(r,n.distanceToSquared(zd))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,a=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Sd(new Float32Array(4*n.count),4));const i=this.getAttribute("tangent"),s=[],o=[];for(let _=0;_<n.count;_++)s[_]=new Au,o[_]=new Au;const l=new Au,c=new Au,u=new Au,h=new hu,d=new hu,A=new hu,p=new Au,f=new Au;function m(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),h.fromBufferAttribute(a,e),d.fromBufferAttribute(a,t),A.fromBufferAttribute(a,r),c.sub(l),u.sub(l),d.sub(h),A.sub(h);const i=1/(d.x*A.y-A.x*d.y);isFinite(i)&&(p.copy(c).multiplyScalar(A.y).addScaledVector(u,-d.y).multiplyScalar(i),f.copy(u).multiplyScalar(d.x).addScaledVector(c,-A.x).multiplyScalar(i),s[e].add(p),s[t].add(p),s[r].add(p),o[e].add(f),o[t].add(f),o[r].add(f))}let g=this.groups;0===g.length&&(g=[{start:0,count:e.count}]);for(let _=0,S=g.length;_<S;++_){const t=g[_],n=t.start;for(let r=n,a=n+t.count;r<a;r+=3)m(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const y=new Au,v=new Au,b=new Au,x=new Au;function w(e){b.fromBufferAttribute(r,e),x.copy(b);const t=s[e];y.copy(t),y.sub(b.multiplyScalar(b.dot(t))).normalize(),v.crossVectors(x,t);const n=v.dot(o[e])<0?-1:1;i.setXYZW(e,y.x,y.y,y.z,n)}for(let _=0,S=g.length;_<S;++_){const t=g[_],n=t.start;for(let r=n,a=n+t.count;r<a;r+=3)w(e.getX(r+0)),w(e.getX(r+1)),w(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Sd(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Au,a=new Au,i=new Au,s=new Au,o=new Au,l=new Au,c=new Au,u=new Au;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),A=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),a.fromBufferAttribute(t,A),i.fromBufferAttribute(t,p),c.subVectors(i,a),u.subVectors(r,a),c.cross(u),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,A),l.fromBufferAttribute(n,p),s.add(c),o.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(A,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)r.fromBufferAttribute(t,e+0),a.fromBufferAttribute(t,e+1),i.fromBufferAttribute(t,e+2),c.subVectors(i,a),u.subVectors(r,a),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)zd.fromBufferAttribute(e,t),zd.normalize(),e.setXYZ(t,zd.x,zd.y,zd.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r);let s=0,o=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)i[o++]=n[s++]}return new Sd(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Hd,n=this.index.array,r=this.attributes;for(const s in r){const a=e(r[s],n);t.setAttribute(s,a)}const a=this.morphAttributes;for(const s in a){const r=[],i=a[s];for(let t=0,a=i.length;t<a;t++){const a=e(i[t],n);r.push(a)}t.morphAttributes[s]=r}t.morphTargetsRelative=this.morphTargetsRelative;const i=this.groups;for(let s=0,o=i.length;s<o;s++){const e=i[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const o in n){const t=n[o];e.data.attributes[o]=t.toJSON(e.data)}const r={};let a=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],n=[];for(let r=0,a=t.length;r<a;r++){const a=t[r];n.push(a.toJSON(e.data))}n.length>0&&(r[o]=n,a=!0)}a&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const i=this.groups;i.length>0&&(e.data.groups=JSON.parse(JSON.stringify(i)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere=s.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const a=e.morphAttributes;for(const l in a){const e=[],n=a[l];for(let r=0,a=n.length;r<a;r++)e.push(n[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const i=e.groups;for(let l=0,c=i.length;l<c;l++){const e=i[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const jd=new vh,Qd=new yh,Vd=new uh,Wd=new Au,Gd=new Au,Kd=new Au,qd=new Au,Xd=new Au,Yd=new Au,Jd=new Au,Zd=new Au;class $d extends Gh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fd;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,a=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(a&&s){Yd.set(0,0,0);for(let n=0,r=a.length;n<r;n++){const r=s[n],o=a[n];0!==r&&(Xd.fromBufferAttribute(o,e),i?Yd.addScaledVector(Xd,r):Yd.addScaledVector(Xd.sub(t),r))}t.add(Yd)}return t}raycast(e,t){const n=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Vd.copy(n.boundingSphere),Vd.applyMatrix4(a),Qd.copy(e.ray).recast(e.near),!1===Vd.containsPoint(Qd.origin)){if(null===Qd.intersectSphere(Vd,Wd))return;if(Qd.origin.distanceToSquared(Wd)>(e.far-e.near)**2)return}jd.copy(a).invert(),Qd.copy(e.ray).applyMatrix4(jd),null!==n.boundingBox&&!1===Qd.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Qd)}}_computeIntersections(e,t,n){let r;const a=this.geometry,i=this.material,s=a.index,o=a.attributes.position,l=a.attributes.uv,c=a.attributes.uv1,u=a.attributes.normal,h=a.groups,d=a.drawRange;if(null!==s)if(Array.isArray(i))for(let A=0,p=h.length;A<p;A++){const a=h[A],o=i[a.materialIndex];for(let i=Math.max(a.start,d.start),h=Math.min(s.count,Math.min(a.start+a.count,d.start+d.count));i<h;i+=3){r=eA(this,o,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let a=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);a<o;a+=3){r=eA(this,i,e,n,l,c,u,s.getX(a),s.getX(a+1),s.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(i))for(let A=0,p=h.length;A<p;A++){const a=h[A],s=i[a.materialIndex];for(let i=Math.max(a.start,d.start),h=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<h;i+=3){r=eA(this,s,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let a=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);a<s;a+=3){r=eA(this,i,e,n,l,c,u,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),t.push(r))}}}}function eA(e,t,n,r,a,i,s,o,l,c){e.getVertexPosition(o,Gd),e.getVertexPosition(l,Kd),e.getVertexPosition(c,qd);const u=function(e,t,n,r,a,i,s,o){let l;if(l=t.side===Cs?r.intersectTriangle(s,i,a,!0,o):r.intersectTriangle(a,i,s,t.side===Ss,o),null===l)return null;Zd.copy(o),Zd.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Zd);return c<n.near||c>n.far?null:{distance:c,point:Zd.clone(),object:e}}(e,t,n,r,Gd,Kd,qd,Jd);if(u){const e=new Au;sd.getBarycoord(Jd,Gd,Kd,qd,e),a&&(u.uv=sd.getInterpolatedAttribute(a,o,l,c,e,new hu)),i&&(u.uv1=sd.getInterpolatedAttribute(i,o,l,c,e,new hu)),s&&(u.normal=sd.getInterpolatedAttribute(s,o,l,c,e,new Au),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new Au,materialIndex:0};sd.getNormal(Gd,Kd,qd,t.normal),u.face=t,u.barycoord=e}return u}class tA extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:a,depthSegments:i};const s=this;r=Math.floor(r),a=Math.floor(a),i=Math.floor(i);const o=[],l=[],c=[],u=[];let h=0,d=0;function A(e,t,n,r,a,i,A,p,f,m,g){const y=i/f,v=A/m,b=i/2,x=A/2,w=p/2,_=f+1,S=m+1;let C=0,E=0;const N=new Au;for(let s=0;s<S;s++){const i=s*v-x;for(let o=0;o<_;o++){const h=o*y-b;N[e]=h*r,N[t]=i*a,N[n]=w,l.push(N.x,N.y,N.z),N[e]=0,N[t]=0,N[n]=p>0?1:-1,c.push(N.x,N.y,N.z),u.push(o/f),u.push(1-s/m),C+=1}}for(let s=0;s<m;s++)for(let e=0;e<f;e++){const t=h+e+_*s,n=h+e+_*(s+1),r=h+(e+1)+_*(s+1),a=h+(e+1)+_*s;o.push(t,n,a),o.push(n,r,a),E+=6}s.addGroup(d,E,g),d+=E,h+=C}A("z","y","x",-1,-1,n,t,e,i,a,0),A("z","y","x",1,-1,n,t,-e,i,a,1),A("x","z","y",1,1,e,n,t,r,i,2),A("x","z","y",1,-1,e,n,-t,r,i,3),A("x","y","z",1,-1,e,t,n,r,a,4),A("x","y","z",-1,-1,e,t,-n,r,a,5),this.setIndex(o),this.setAttribute("position",new Fd(l,3)),this.setAttribute("normal",new Fd(c,3)),this.setAttribute("uv",new Fd(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tA(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nA(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}}return t}function rA(e){const t={};for(let n=0;n<e.length;n++){const r=nA(e[n]);for(const e in r)t[e]=r[e]}return t}function aA(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Bu.workingColorSpace}const iA={clone:nA,merge:rA};class sA extends pd{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nA(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class oA extends Gh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new vh,this.projectionMatrix=new vh,this.projectionMatrixInverse=new vh,this.coordinateSystem=qc,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const lA=new Au,cA=new hu,uA=new hu;class hA extends oA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ru*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*nu*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ru*Math.atan(Math.tan(.5*nu*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){lA.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(lA.x,lA.y).multiplyScalar(-e/lA.z),lA.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(lA.x,lA.y).multiplyScalar(-e/lA.z)}getViewSize(e,t){return this.getViewBounds(e,cA,uA),t.subVectors(uA,cA)}setViewOffset(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*nu*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r;const i=this.view;if(null!==this.view&&this.view.enabled){const e=i.fullWidth,s=i.fullHeight;a+=i.offsetX*r/e,t-=i.offsetY*n/s,r*=i.width/e,n*=i.height/s}const s=this.filmOffset;0!==s&&(a+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const dA=-90;class AA extends Gh{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new hA(dA,1,e,t);r.layers=this.layers,this.add(r);const a=new hA(dA,1,e,t);a.layers=this.layers,this.add(a);const i=new hA(dA,1,e,t);i.layers=this.layers,this.add(i);const s=new hA(dA,1,e,t);s.layers=this.layers,this.add(s);const o=new hA(dA,1,e,t);o.layers=this.layers,this.add(o);const l=new hA(dA,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,a,i,s,o]=t;for(const l of t)this.remove(l);if(e===qc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),i.up.set(0,0,1),i.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Xc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),i.up.set(0,0,-1),i.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,i,s,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),A=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,a),e.setRenderTarget(n,1,r),e.render(t,i),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=A,n.texture.needsPMREMUpdate=!0}}class pA extends Du{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:wo,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class fA extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new pA(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new tA(5,5,5),s=new sA({name:"CubemapFromEquirect",uniforms:nA(n),vertexShader:r,fragmentShader:a,side:Cs,blending:Ns});s.uniforms.tEquirect.value=t;const o=new $d(i,s),l=t.minFilter;t.minFilter===Do&&(t.minFilter=Lo);return new AA(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}class mA extends Gh{constructor(){super(),this.isGroup=!0,this.type="Group"}}const gA={type:"move"};class yA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new mA,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new mA,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Au,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Au),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new mA,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Au,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Au),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,a=null,i=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){i=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],a=l.joints["thumb-tip"],s=r.position.distanceTo(a.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),null!==a&&(o.matrix.fromArray(a.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,a.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(a.linearVelocity)):o.hasLinearVelocity=!1,a.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(a.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==a&&(r=a),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(gA)))}return null!==s&&(s.visible=null!==r),null!==o&&(o.visible=null!==a),null!==l&&(l.visible=null!==i),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new mA;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class vA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new hd(e),this.density=t}clone(){return new vA(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class bA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new hd(e),this.near=t,this.far=n}clone(){return new bA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class xA extends Gh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new kh,this.environmentIntensity=1,this.environmentRotation=new kh,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class wA{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Pc,this.updateRanges=[],this.version=0,this.uuid=au()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=au()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=au()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _A=new Au;class SA{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)_A.fromBufferAttribute(this,t),_A.applyMatrix4(e),this.setXYZ(t,_A.x,_A.y,_A.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_A.fromBufferAttribute(this,t),_A.applyNormalMatrix(e),this.setXYZ(t,_A.x,_A.y,_A.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_A.fromBufferAttribute(this,t),_A.transformDirection(e),this.setXYZ(t,_A.x,_A.y,_A.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=lu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=cu(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=cu(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=cu(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=cu(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=cu(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=lu(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=lu(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=lu(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=lu(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=cu(t,this.array),n=cu(n,this.array),r=cu(r,this.array),a=cu(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Sd(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new SA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class CA extends pd{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new hd(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let EA;const NA=new Au,BA=new Au,kA=new Au,IA=new hu,TA=new hu,MA=new vh,FA=new Au,RA=new Au,LA=new Au,UA=new hu,PA=new hu,DA=new hu;class OA extends Gh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new CA;if(super(),this.isSprite=!0,this.type="Sprite",void 0===EA){EA=new Hd;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new wA(e,5);EA.setIndex([0,1,2,0,2,3]),EA.setAttribute("position",new SA(t,3,0,!1)),EA.setAttribute("uv",new SA(t,2,3,!1))}this.geometry=EA,this.material=e,this.center=new hu(.5,.5),this.count=1}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),BA.setFromMatrixScale(this.matrixWorld),MA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),kA.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&BA.multiplyScalar(-kA.z);const n=this.material.rotation;let r,a;0!==n&&(a=Math.cos(n),r=Math.sin(n));const i=this.center;zA(FA.set(-.5,-.5,0),kA,i,BA,r,a),zA(RA.set(.5,-.5,0),kA,i,BA,r,a),zA(LA.set(.5,.5,0),kA,i,BA,r,a),UA.set(0,0),PA.set(1,0),DA.set(1,1);let s=e.ray.intersectTriangle(FA,RA,LA,!1,NA);if(null===s&&(zA(RA.set(-.5,.5,0),kA,i,BA,r,a),PA.set(0,1),s=e.ray.intersectTriangle(FA,LA,RA,!1,NA),null===s))return;const o=e.ray.origin.distanceTo(NA);o<e.near||o>e.far||t.push({distance:o,point:NA.clone(),uv:sd.getInterpolation(NA,FA,RA,LA,UA,PA,DA,new hu),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function zA(e,t,n,r,a,i){IA.subVectors(e,n).addScalar(.5).multiply(r),void 0!==a?(TA.x=i*IA.x-a*IA.y,TA.y=a*IA.x+i*IA.y):TA.copy(IA),e.copy(t),e.x+=TA.x,e.y+=TA.y,e.applyMatrix4(MA)}const HA=new Au,jA=new Au;class QA extends Gh{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const r=this.levels;let a;for(a=0;a<r.length&&!(t<r[a].distance);a++);return r.splice(a,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){HA.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(HA);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){HA.setFromMatrixPosition(e.matrixWorld),jA.setFromMatrixPosition(this.matrixWorld);const n=HA.distanceTo(jA)/e.zoom;let r,a;for(t[0].object.visible=!0,r=1,a=t.length;r<a;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<a;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,a=n.length;r<a;r++){const e=n[r];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const VA=new Au,WA=new Ou,GA=new Ou,KA=new Au,qA=new vh,XA=new Au,YA=new uh,JA=new vh,ZA=new yh;class $A extends $d{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=vo,this.bindMatrix=new vh,this.bindMatrixInverse=new vh,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Gu),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,XA),this.boundingBox.expandByPoint(XA)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new uh),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,XA),this.boundingSphere.expandByPoint(XA)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),YA.copy(this.boundingSphere),YA.applyMatrix4(r),!1!==e.ray.intersectsSphere(YA)&&(JA.copy(r).invert(),ZA.copy(e.ray).applyMatrix4(JA),null!==this.boundingBox&&!1===ZA.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,ZA)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ou,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===vo?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===bo?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;WA.fromBufferAttribute(r.attributes.skinIndex,e),GA.fromBufferAttribute(r.attributes.skinWeight,e),VA.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const e=GA.getComponent(a);if(0!==e){const r=WA.getComponent(a);qA.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(KA.copy(VA).applyMatrix4(qA),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ep extends Gh{constructor(){super(),this.isBone=!0,this.type="Bone"}}class tp extends Du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Io,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Io,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const np=new vh,rp=new vh;class ap{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=au(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new vh)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new vh;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let a=0,i=e.length;a<i;a++){const r=e[a]?e[a].matrixWorld:rp;np.multiplyMatrices(r,t[a]),np.toArray(n,16*a)}null!==r&&(r.needsUpdate=!0)}clone(){return new ap(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new tp(t,e,e,tl,Go);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new ep),this.bones.push(a),this.boneInverses.push((new vh).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,a=t.length;r<a;r++){const a=t[r];e.bones.push(a.uuid);const i=n[r];e.boneInverses.push(i.toArray())}return e}}class ip extends Sd{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const sp=new vh,op=new vh,lp=[],cp=new Gu,up=new vh,hp=new $d,dp=new uh;class Ap extends $d{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ip(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,up)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Gu),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,sp),cp.copy(e.boundingBox).applyMatrix4(sp),this.boundingBox.union(cp)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new uh),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,sp),dp.copy(e.boundingSphere).applyMatrix4(sp),this.boundingSphere.union(dp)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,a=e*(n.length+1)+1;for(let i=0;i<n.length;i++)n[i]=r[a+i]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(hp.geometry=this.geometry,hp.material=this.material,void 0!==hp.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),dp.copy(this.boundingSphere),dp.applyMatrix4(n),!1!==e.ray.intersectsSphere(dp)))for(let a=0;a<r;a++){this.getMatrixAt(a,sp),op.multiplyMatrices(n,sp),hp.matrixWorld=op,hp.raycast(e,lp);for(let e=0,n=lp.length;e<n;e++){const n=lp[e];n.instanceId=a,n.object=this,t.push(n)}lp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new ip(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new tp(new Float32Array(r*this.count),r,this.count,al,Go));const a=this.morphTexture.source.data.data;let i=0;for(let l=0;l<n.length;l++)i+=n[l];const s=this.geometry.morphTargetsRelative?1:1-i,o=r*e;a[o]=s,a.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const pp=new Au,fp=new Au,mp=new mu;class gp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=pp.subVectors(n,t).cross(fp.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(pp),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(e.start).addScaledVector(n,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||mp.getNormalMatrix(e),r=this.coplanarPoint(pp).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const yp=new uh,vp=new hu(.5,.5),bp=new Au;class xp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gp,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gp,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new gp,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new gp,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new gp;this.planes=[e,t,n,r,a,i]}set(e,t,n,r,a,i){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(a),s[5].copy(i),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qc,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.planes,a=e.elements,i=a[0],s=a[1],o=a[2],l=a[3],c=a[4],u=a[5],h=a[6],d=a[7],A=a[8],p=a[9],f=a[10],m=a[11],g=a[12],y=a[13],v=a[14],b=a[15];if(r[0].setComponents(l-i,d-c,m-A,b-g).normalize(),r[1].setComponents(l+i,d+c,m+A,b+g).normalize(),r[2].setComponents(l+s,d+u,m+p,b+y).normalize(),r[3].setComponents(l-s,d-u,m-p,b-y).normalize(),n)r[4].setComponents(o,h,f,v).normalize(),r[5].setComponents(l-o,d-h,m-f,b-v).normalize();else if(r[4].setComponents(l-o,d-h,m-f,b-v).normalize(),t===qc)r[5].setComponents(l+o,d+h,m+f,b+v).normalize();else{if(t!==Xc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,h,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),yp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),yp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(yp)}intersectsSprite(e){yp.center.set(0,0,0);const t=vp.distanceTo(e.center);return yp.radius=.7071067811865476+t,yp.applyMatrix4(e.matrixWorld),this.intersectsSphere(yp)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(bp.x=r.normal.x>0?e.max.x:e.min.x,bp.y=r.normal.y>0?e.max.y:e.min.y,bp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(bp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const wp=new vh,_p=new xp;class Sp{constructor(){this.coordinateSystem=qc}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(wp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_p.setFromProjectionMatrix(wp,r.coordinateSystem,r.reversedDepth),_p.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(wp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_p.setFromProjectionMatrix(wp,r.coordinateSystem,r.reversedDepth),_p.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(wp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_p.setFromProjectionMatrix(wp,r.coordinateSystem,r.reversedDepth),_p.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(wp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_p.setFromProjectionMatrix(wp,r.coordinateSystem,r.reversedDepth),_p.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(wp.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),_p.setFromProjectionMatrix(wp,r.coordinateSystem,r.reversedDepth),_p.containsPoint(e))return!0}return!1}clone(){return new Sp}}function Cp(e,t){return e-t}function Ep(e,t){return e.z-t.z}function Np(e,t){return t.z-e.z}class Bp{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,r){const a=this.pool,i=this.list;this.index>=a.length&&a.push({start:-1,count:-1,z:-1,index:-1});const s=a[this.index];i.push(s),this.index++,s.start=e,s.count=t,s.z=n,s.index=r}reset(){this.list.length=0,this.index=0}}const kp=new vh,Ip=new hd(1,1,1),Tp=new xp,Mp=new Sp,Fp=new Gu,Rp=new uh,Lp=new Au,Up=new Au,Pp=new Au,Dp=new Bp,Op=new $d,zp=[];function Hp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const a=e.count;for(let i=0;i<a;i++)for(let a=0;a<r;a++)t.setComponent(i+n,a,e.getComponent(i,a))}else t.array.set(e.array,n*r);t.needsUpdate=!0}function jp(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)t[r]=e[r]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Qp extends $d{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,r=arguments.length>3?arguments[3]:void 0;super(new Hd,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new tp(t,e,e,tl,Go);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new tp(t,e,e,il,Wo);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new tp(t,e,e,tl,Go);n.colorSpace=Bu.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in e.attributes){const a=e.getAttribute(r),{array:i,itemSize:s,normalized:o}=a,l=new i.constructor(n*s),c=new Sd(l,s,o);t.setAttribute(r,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Sd(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error('THREE.BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));const r=e.getAttribute(n),a=t.getAttribute(n);if(r.itemSize!==a.itemSize||r.normalized!==a.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid instanceId ".concat(e,". Instance is either out of range or has been deleted."))}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid geometryId ".concat(e,". Geometry is either out of range or has been deleted."))}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Gu);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,kp),this.getBoundingBoxAt(r,Fp).applyMatrix4(kp),e.union(Fp)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uh);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,kp),this.getBoundingSphereAt(r,Rp).applyMatrix4(kp),e.union(Rp)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Cp),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const r=this._matricesTexture;kp.identity().toArray(r.image.data,16*n),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(Ip.toArray(a.image.data,4*n),a.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},a=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const i=e.getIndex();if(null!==i&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=-1===n?i.count:n),-1!==r.indexStart&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let s;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Cp),s=this._availableGeometryIds.shift(),a[s]=r):(s=this._geometryCount,this._geometryCount++,a.push(r)),this.setGeometryAt(s,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,s}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=null!==n.getIndex(),a=n.getIndex(),i=t.getIndex(),s=this._geometryInfo[e];if(r&&i.count>s.reservedIndexCount||t.attributes.position.count>s.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const o=s.vertexStart,l=s.reservedVertexCount;s.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),r=n.getAttribute(c);Hp(e,r,o);const a=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=o+t;for(let t=0;t<a;t++)r.setComponent(e,t,0)}r.needsUpdate=!0,r.addUpdateRange(o*a,l*a)}if(r){const e=s.indexStart,n=s.reservedIndexCount;s.indexCount=t.getIndex().count;for(let t=0;t<i.count;t++)a.setX(e+t,o+i.getX(t));for(let t=i.count,r=n;t<r;t++)a.setX(e+t,o);a.needsUpdate=!0,a.addUpdateRange(e,s.reservedIndexCount)}return s.start=r?s.indexStart:s.vertexStart,s.count=r?s.indexCount:s.vertexCount,s.boundingBox=null,null!==t.boundingBox&&(s.boundingBox=t.boundingBox.clone()),s.boundingSphere=null,null!==t.boundingSphere&&(s.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let r=0,a=n.length;r<a;r++)n[r].active&&n[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),a=this.geometry;for(let i=0,s=n.length;i<s;i++){const s=r[i],o=n[s];if(!1!==o.active){if(null!==a.index){if(o.indexStart!==t){const{indexStart:n,vertexStart:r,reservedIndexCount:i}=o,s=a.index,l=s.array,c=e-r;for(let e=n;e<n+i;e++)l[e]=l[e]+c;s.array.copyWithin(t,n,n+i),s.addUpdateRange(t,i),o.indexStart=t}t+=o.reservedIndexCount}if(o.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=o,r=a.attributes;for(const a in r){const i=r[a],{array:s,itemSize:o}=i;s.copyWithin(e*o,t*o,(t+n)*o),i.addUpdateRange(e*o,n*o)}o.vertexStart=e}e+=o.reservedVertexCount,o.start=a.index?o.indexStart:o.vertexStart,this._nextIndexStart=a.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingBox){const e=new Gu,t=n.index,a=n.attributes.position;for(let n=r.start,i=r.start+r.count;n<i;n++){let r=n;t&&(r=t.getX(r)),e.expandByPoint(Lp.fromBufferAttribute(a,r))}r.boundingBox=e}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingSphere){const t=new uh;this.getBoundingBoxAt(e,Fp),Fp.getCenter(t.center);const a=n.index,i=n.attributes.position;let s=0;for(let e=r.start,n=r.start+r.count;e<n;e++){let n=e;a&&(n=a.getX(n)),Lp.fromBufferAttribute(i,n),s=Math.max(s,t.center.distanceToSquared(Lp))}t.radius=Math.sqrt(s),r.boundingSphere=t}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Cp);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error("BatchedMesh: Instance ids outside the range ".concat(e," are being used. Cannot shrink instance count."));const r=new Int32Array(e),a=new Int32Array(e);jp(this._multiDrawCounts,r),jp(this._multiDrawStarts,a),this._multiDrawCounts=r,this._multiDrawStarts=a,this._maxInstanceCount=e;const i=this._indirectTexture,s=this._matricesTexture,o=this._colorsTexture;i.dispose(),this._initIndirectTexture(),jp(i.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),jp(s.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),jp(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(e=>e.active),r=Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount));if(r>e)throw new Error("BatchedMesh: Geometry vertex values are being used outside the range ".concat(t,". Cannot shrink further."));if(this.geometry.index){const e=Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount));if(e>t)throw new Error("BatchedMesh: Geometry index values are being used outside the range ".concat(t,". Cannot shrink further."))}const a=this.geometry;a.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Hd,this._initializeGeometry(a));const i=this.geometry;a.index&&jp(a.index.array,i.index.array);for(const s in a.attributes)jp(a.attributes[s].array,i.attributes[s].array)}raycast(e,t){const n=this._instanceInfo,r=this._geometryInfo,a=this.matrixWorld,i=this.geometry;Op.material=this.material,Op.geometry.index=i.index,Op.geometry.attributes=i.attributes,null===Op.geometry.boundingBox&&(Op.geometry.boundingBox=new Gu),null===Op.geometry.boundingSphere&&(Op.geometry.boundingSphere=new uh);for(let s=0,o=n.length;s<o;s++){if(!n[s].visible||!n[s].active)continue;const i=n[s].geometryIndex,o=r[i];Op.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(s,Op.matrixWorld).premultiply(a),this.getBoundingBoxAt(i,Op.geometry.boundingBox),this.getBoundingSphereAt(i,Op.geometry.boundingSphere),Op.raycast(e,zp);for(let e=0,n=zp.length;e<n;e++){const n=zp[e];n.object=this,n.batchId=s,t.push(n)}zp.length=0}Op.material=null,Op.geometry.index=null,Op.geometry.attributes={},Op.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>M(M({},e),{},{boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>M({},e)),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,r,a){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const i=r.getIndex(),s=null===i?1:i.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,A=d.image.data,p=n.isArrayCamera?Mp:Tp;h&&!n.isArrayCamera&&(kp.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Tp.setFromProjectionMatrix(kp,n.coordinateSystem,n.reversedDepth));let f=0;if(this.sortObjects){kp.copy(this.matrixWorld).invert(),Lp.setFromMatrixPosition(n.matrixWorld).applyMatrix4(kp),Up.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(kp);for(let r=0,a=o.length;r<a;r++)if(o[r].visible&&o[r].active){const e=o[r].geometryIndex;this.getMatrixAt(r,kp),this.getBoundingSphereAt(e,Rp).applyMatrix4(kp);let t=!1;if(h&&(t=!p.intersectsSphere(Rp,n)),!t){const t=u[e],n=Pp.subVectors(Rp.center,Lp).dot(Up);Dp.push(t.start,t.count,n,r)}}const e=Dp.list,t=this.customSort;null===t?e.sort(a.transparent?Np:Ep):t.call(this,e,n);for(let n=0,r=e.length;n<r;n++){const t=e[n];l[f]=t.start*s,c[f]=t.count,A[f]=t.index,f++}Dp.reset()}else for(let m=0,g=o.length;m<g;m++)if(o[m].visible&&o[m].active){const e=o[m].geometryIndex;let t=!1;if(h&&(this.getMatrixAt(m,kp),this.getBoundingSphereAt(e,Rp).applyMatrix4(kp),t=!p.intersectsSphere(Rp,n)),!t){const t=u[e];l[f]=t.start*s,c[f]=t.count,A[f]=m,f++}}d.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,a,i){this.onBeforeRender(e,null,r,a,i)}}class Vp extends pd{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new hd(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Wp=new Au,Gp=new Au,Kp=new vh,qp=new yh,Xp=new uh,Yp=new Au,Jp=new Au;class Zp extends Gh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vp;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Wp.fromBufferAttribute(t,e-1),Gp.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Wp.distanceTo(Gp);e.setAttribute("lineDistance",new Fd(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xp.copy(n.boundingSphere),Xp.applyMatrix4(r),Xp.radius+=a,!1===e.ray.intersectsSphere(Xp))return;Kp.copy(r).invert(),qp.copy(e.ray).applyMatrix4(Kp);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,i.start),r=Math.min(c.count,i.start+i.count);for(let a=n,i=r-1;a<i;a+=l){const n=c.getX(a),r=c.getX(a+1),i=$p(this,e,qp,o,n,r,a);i&&t.push(i)}if(this.isLineLoop){const a=c.getX(r-1),i=c.getX(n),s=$p(this,e,qp,o,a,i,r-1);s&&t.push(s)}}else{const n=Math.max(0,i.start),r=Math.min(u.count,i.start+i.count);for(let a=n,i=r-1;a<i;a+=l){const n=$p(this,e,qp,o,a,a+1,a);n&&t.push(n)}if(this.isLineLoop){const a=$p(this,e,qp,o,r-1,n,r-1);a&&t.push(a)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function $p(e,t,n,r,a,i,s){const o=e.geometry.attributes.position;Wp.fromBufferAttribute(o,a),Gp.fromBufferAttribute(o,i);if(n.distanceSqToSegment(Wp,Gp,Yp,Jp)>r)return;Yp.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(Yp);return l<t.near||l>t.far?void 0:{distance:l,point:Jp.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}const ef=new Au,tf=new Au;class nf extends Zp{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)ef.fromBufferAttribute(t,e),tf.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+ef.distanceTo(tf);e.setAttribute("lineDistance",new Fd(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class rf extends Zp{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class af extends pd{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new hd(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const sf=new vh,of=new yh,lf=new uh,cf=new Au;class uf extends Gh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new af;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),lf.copy(n.boundingSphere),lf.applyMatrix4(r),lf.radius+=a,!1===e.ray.intersectsSphere(lf))return;sf.copy(r).invert(),of.copy(e.ray).applyMatrix4(sf);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,i.start),a=Math.min(l.count,i.start+i.count);n<a;n++){const a=l.getX(n);cf.fromBufferAttribute(c,a),hf(cf,a,o,r,e,t,this)}}else{for(let n=Math.max(0,i.start),a=Math.min(c.count,i.start+i.count);n<a;n++)cf.fromBufferAttribute(c,n),hf(cf,n,o,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function hf(e,t,n,r,a,i,s){const o=of.distanceSqToPoint(e);if(o<n){const n=new Au;of.closestPointToPoint(e,n),n.applyMatrix4(r);const l=a.ray.origin.distanceTo(n);if(l<a.near||l>a.far)return;i.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:s})}}class df extends Du{constructor(e,t,n,r){super(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:Lo,arguments.length>5&&void 0!==arguments[5]?arguments[5]:Lo,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const a=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){a.needsUpdate=!0,a._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class Af extends df{constructor(e,t,n,r,a,i,s,o){super({},e,t,n,r,a,i,s,o),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class pf extends Du{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Io,this.minFilter=Io,this.generateMipmaps=!1,this.needsUpdate=!0}}class ff extends Du{constructor(e,t,n,r,a,i,s,o,l,c,u,h){super(null,i,s,o,l,c,r,a,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class mf extends ff{constructor(e,t,n,r,a,i){super(e,t,n,a,i),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Bo,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class gf extends ff{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,wo),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class yf extends Du{constructor(e,t,n,r,a,i,s,o,l){super(e,t,n,r,a,i,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class vf extends Du{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wo,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Io,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Io,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:nl,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(c!==nl&&c!==rl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:u},r,a,i,s,o,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Ru(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class bf extends Du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class xf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:r,heightSegments:a},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),r=Math.max(3,Math.floor(r)),a=Math.max(1,Math.floor(a));const i=[],s=[],o=[],l=[],c=t/2,u=Math.PI/2*e,h=t,d=2*u+h,A=2*n+a,p=r+1,f=new Au,m=new Au;for(let g=0;g<=A;g++){let y=0,v=0,b=0,x=0;if(g<=n){const t=g/n,r=t*Math.PI/2;v=-c-e*Math.cos(r),b=e*Math.sin(r),x=-e*Math.cos(r),y=t*u}else if(g<=n+a){const r=(g-n)/a;v=r*t-c,b=e,x=0,y=u+r*h}else{const t=(g-n-a)/n,r=t*Math.PI/2;v=c+e*Math.sin(r),b=e*Math.cos(r),x=e*Math.sin(r),y=u+h+t*u}const w=Math.max(0,Math.min(1,y/d));let _=0;0===g?_=.5/r:g===A&&(_=-.5/r);for(let e=0;e<=r;e++){const t=e/r,n=t*Math.PI*2,a=Math.sin(n),i=Math.cos(n);m.x=-b*i,m.y=v,m.z=b*a,s.push(m.x,m.y,m.z),f.set(-b*i,x,b*a),f.normalize(),o.push(f.x,f.y,f.z),l.push(t+_,w)}if(g>0){const e=(g-1)*p;for(let t=0;t<r;t++){const n=e+t,r=e+t+1,a=g*p+t,s=g*p+t+1;i.push(n,r,a),i.push(r,s,a)}}}this.setIndex(i),this.setAttribute("position",new Fd(s,3)),this.setAttribute("normal",new Fd(o,3)),this.setAttribute("uv",new Fd(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xf(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class wf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const a=[],i=[],s=[],o=[],l=new Au,c=new hu;i.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const a=n+u/t*r;l.x=e*Math.cos(a),l.y=e*Math.sin(a),i.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(i[h]/e+1)/2,c.y=(i[h+1]/e+1)/2,o.push(c.x,c.y)}for(let u=1;u<=t;u++)a.push(u,u+1,0);this.setIndex(a),this.setAttribute("position",new Fd(i,3)),this.setAttribute("normal",new Fd(s,3)),this.setAttribute("uv",new Fd(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wf(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class _f extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:a,openEnded:i,thetaStart:s,thetaLength:o};const l=this;r=Math.floor(r),a=Math.floor(a);const c=[],u=[],h=[],d=[];let A=0;const p=[],f=n/2;let m=0;function g(n){const a=A,i=new hu,p=new Au;let g=0;const y=!0===n?e:t,v=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,f*v,0),h.push(0,v,0),d.push(.5,.5),A++;const b=A;for(let e=0;e<=r;e++){const t=e/r*o+s,n=Math.cos(t),a=Math.sin(t);p.x=y*a,p.y=f*v,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,v,0),i.x=.5*n+.5,i.y=.5*a*v+.5,d.push(i.x,i.y),A++}for(let e=0;e<r;e++){const t=a+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),g+=3}l.addGroup(m,g,!0===n?1:2),m+=g}!function(){const i=new Au,g=new Au;let y=0;const v=(t-e)/n;for(let l=0;l<=a;l++){const c=[],m=l/a,y=m*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,a=t*o+s,l=Math.sin(a),p=Math.cos(a);g.x=y*l,g.y=-m*n+f,g.z=y*p,u.push(g.x,g.y,g.z),i.set(l,v,p).normalize(),h.push(i.x,i.y,i.z),d.push(t,1-m),c.push(A++)}p.push(c)}for(let n=0;n<r;n++)for(let r=0;r<a;r++){const i=p[r][n],s=p[r+1][n],o=p[r+1][n+1],l=p[r][n+1];(e>0||0!==r)&&(c.push(i,s,l),y+=3),(t>0||r!==a-1)&&(c.push(s,o,l),y+=3)}l.addGroup(m,y,0),m+=y}(),!1===i&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new Fd(u,3)),this.setAttribute("normal",new Fd(h,3)),this.setAttribute("uv",new Fd(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _f(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Sf extends _f{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,r,a,i,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:i,thetaLength:s}}static fromJSON(e){return new Sf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Cf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const a=[],i=[];function s(e,t,n,r){const a=r+1,i=[];for(let s=0;s<=a;s++){i[s]=[];const r=e.clone().lerp(n,s/a),o=t.clone().lerp(n,s/a),l=a-s;for(let e=0;e<=l;e++)i[s][e]=0===e&&s===a?r:r.clone().lerp(o,e/l)}for(let s=0;s<a;s++)for(let e=0;e<2*(a-s)-1;e++){const t=Math.floor(e/2);e%2===0?(o(i[s][t+1]),o(i[s+1][t]),o(i[s][t])):(o(i[s][t+1]),o(i[s+1][t+1]),o(i[s+1][t]))}}function o(e){a.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(i[t]=e.x-1),0===n.x&&0===n.z&&(i[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new Au,r=new Au,a=new Au;for(let i=0;i<t.length;i+=3)l(t[i+0],n),l(t[i+1],r),l(t[i+2],a),s(n,r,a,e)}(r),function(e){const t=new Au;for(let n=0;n<a.length;n+=3)t.x=a[n+0],t.y=a[n+1],t.z=a[n+2],t.normalize().multiplyScalar(e),a[n+0]=t.x,a[n+1]=t.y,a[n+2]=t.z}(n),function(){const e=new Au;for(let t=0;t<a.length;t+=3){e.x=a[t+0],e.y=a[t+1],e.z=a[t+2];const n=u(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;i.push(n,1-r)}(function(){const e=new Au,t=new Au,n=new Au,r=new Au,s=new hu,o=new hu,l=new hu;for(let h=0,d=0;h<a.length;h+=9,d+=6){e.set(a[h+0],a[h+1],a[h+2]),t.set(a[h+3],a[h+4],a[h+5]),n.set(a[h+6],a[h+7],a[h+8]),s.set(i[d+0],i[d+1]),o.set(i[d+2],i[d+3]),l.set(i[d+4],i[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const A=u(r);c(s,d+0,e,A),c(o,d+2,t,A),c(l,d+4,n,A)}})(),function(){for(let e=0;e<i.length;e+=6){const t=i[e+0],n=i[e+2],r=i[e+4],a=Math.max(t,n,r),s=Math.min(t,n,r);a>.9&&s<.1&&(t<.2&&(i[e+0]+=1),n<.2&&(i[e+2]+=1),r<.2&&(i[e+4]+=1))}}()}(),this.setAttribute("position",new Fd(a,3)),this.setAttribute("normal",new Fd(a.slice(),3)),this.setAttribute("uv",new Fd(i,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cf(e.vertices,e.indices,e.radius,e.details)}}class Ef extends Cf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ef(e.radius,e.detail)}}const Nf=new Au,Bf=new Au,kf=new Au,If=new sd;class Tf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),a=Math.cos(nu*t),i=e.getIndex(),s=e.getAttribute("position"),o=i?i.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){i?(l[0]=i.getX(e),l[1]=i.getX(e+1),l[2]=i.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=If;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),o.fromBufferAttribute(s,l[2]),If.getNormal(kf),u[0]="".concat(Math.round(t.x*r),",").concat(Math.round(t.y*r),",").concat(Math.round(t.z*r)),u[1]="".concat(Math.round(n.x*r),",").concat(Math.round(n.y*r),",").concat(Math.round(n.z*r)),u[2]="".concat(Math.round(o.x*r),",").concat(Math.round(o.y*r),",").concat(Math.round(o.z*r)),u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],i=If[c[e]],s=If[c[t]],o="".concat(n,"_").concat(r),A="".concat(r,"_").concat(n);A in h&&h[A]?(kf.dot(h[A].normal)<=a&&(d.push(i.x,i.y,i.z),d.push(s.x,s.y,s.z)),h[A]=null):o in h||(h[o]={index0:l[e],index1:l[t],normal:kf.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];Nf.fromBufferAttribute(s,t),Bf.fromBufferAttribute(s,n),d.push(Nf.x,Nf.y,Nf.z),d.push(Bf.x,Bf.y,Bf.z)}this.setAttribute("position",new Fd(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Mf{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),a=0;t.push(0);for(let i=1;i<=e;i++)n=this.getPoint(i/e),a+=n.distanceTo(r),t.push(a),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let r=0;const a=n.length;let i;i=t||e*n[a-1];let s,o=0,l=a-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),s=n[r]-i,s<0)o=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(a-1);const c=n[r];return(r+(i-c)/(n[r+1]-c))/(a-1)}getTangent(e,t){const n=1e-4;let r=e-n,a=e+n;r<0&&(r=0),a>1&&(a=1);const i=this.getPoint(r),s=this.getPoint(a),o=t||(i.isVector2?new hu:new Au);return o.copy(s).sub(i).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new Au,r=[],a=[],i=[],s=new Au,o=new vh;for(let d=0;d<=e;d++){const t=d/e;r[d]=this.getTangentAt(t,new Au)}a[0]=new Au,i[0]=new Au;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],s),i[0].crossVectors(r[0],a[0]);for(let d=1;d<=e;d++){if(a[d]=a[d-1].clone(),i[d]=i[d-1].clone(),s.crossVectors(r[d-1],r[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(iu(r[d-1].dot(r[d]),-1,1));a[d].applyMatrix4(o.makeRotationAxis(s,e))}i[d].crossVectors(r[d],a[d])}if(!0===t){let t=Math.acos(iu(a[0].dot(a[e]),-1,1));t/=e,r[0].dot(s.crossVectors(a[0],a[e]))>0&&(t=-t);for(let n=1;n<=e;n++)a[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),i[n].crossVectors(r[n],a[n])}return{tangents:r,normals:a,binormals:i}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ff extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=i,this.aClockwise=s,this.aRotation=o}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);const i=this.aStartAngle+e*r;let s=this.aX+this.xRadius*Math.cos(i),o=this.aY+this.yRadius*Math.sin(i);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=o-this.aY;s=n*e-r*t+this.aX,o=n*t+r*e+this.aY}return t.set(s,o)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Rf extends Ff{constructor(e,t,n,r,a,i){super(e,t,n,n,r,a,i),this.isArcCurve=!0,this.type="ArcCurve"}}function Lf(){let e=0,t=0,n=0,r=0;function a(a,i,s,o){e=a,t=s,n=-3*a+3*i-2*s-o,r=2*a-2*i+s+o}return{initCatmullRom:function(e,t,n,r,i){a(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,s,o){let l=(t-e)/i-(n-e)/(i+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+o)+(r-n)/o;l*=s,c*=s,a(t,n,l,c)},calc:function(a){const i=a*a;return e+t*a+n*i+r*(i*a)}}}const Uf=new Au,Pf=new Lf,Df=new Lf,Of=new Lf;class zf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=this.points,r=n.length,a=(r-(this.closed?0:1))*e;let i,s,o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:0===l&&o===r-1&&(o=r-2,l=1),this.closed||o>0?i=n[(o-1)%r]:(Uf.subVectors(n[0],n[1]).add(n[0]),i=Uf);const c=n[o%r],u=n[(o+1)%r];if(this.closed||o+2<r?s=n[(o+2)%r]:(Uf.subVectors(n[r-1],n[r-2]).add(n[r-1]),s=Uf),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(i.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Pf.initNonuniformCatmullRom(i.x,c.x,u.x,s.x,t,n,r),Df.initNonuniformCatmullRom(i.y,c.y,u.y,s.y,t,n,r),Of.initNonuniformCatmullRom(i.z,c.z,u.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Pf.initCatmullRom(i.x,c.x,u.x,s.x,this.tension),Df.initCatmullRom(i.y,c.y,u.y,s.y,this.tension),Of.initCatmullRom(i.z,c.z,u.z,s.z,this.tension));return t.set(Pf.calc(l),Df.calc(l),Of.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Au).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Hf(e,t,n,r,a){const i=.5*(r-t),s=.5*(a-n),o=e*e;return(2*n-2*r+i+s)*(e*o)+(-3*n+3*r-2*i-s)*o+i*e+n}function jf(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Qf(e,t,n,r,a){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,a)}class Vf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hu,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new hu;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=this.v0,r=this.v1,a=this.v2,i=this.v3;return t.set(Qf(e,n.x,r.x,a.x,i.x),Qf(e,n.y,r.y,a.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Wf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Au,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Au;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=this.v0,r=this.v1,a=this.v2,i=this.v3;return t.set(Qf(e,n.x,r.x,a.x,i.x),Qf(e,n.y,r.y,a.y,i.y),Qf(e,n.z,r.z,a.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Gf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Kf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hu;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=this.v0,r=this.v1,a=this.v2;return t.set(jf(e,n.x,r.x,a.x),jf(e,n.y,r.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Xf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Au;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au,n=this.v0,r=this.v1,a=this.v2;return t.set(jf(e,n.x,r.x,a.x),jf(e,n.y,r.y,a.y),jf(e,n.z,r.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Yf extends Mf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu,n=this.points,r=(n.length-1)*e,a=Math.floor(r),i=r-a,s=n[0===a?a:a-1],o=n[a],l=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return t.set(Hf(i,s.x,o.x,l.x,c.x),Hf(i,s.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new hu).fromArray(n))}return this}}var Jf=Object.freeze({__proto__:null,ArcCurve:Rf,CatmullRomCurve3:zf,CubicBezierCurve:Vf,CubicBezierCurve3:Wf,EllipseCurve:Ff,LineCurve:Gf,LineCurve3:Kf,QuadraticBezierCurve:qf,QuadraticBezierCurve3:Xf,SplineCurve:Yf});class Zf extends Mf{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Jf[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let a=0;for(;a<r.length;){if(r[a]>=n){const e=r[a]-n,i=this.curves[a],s=i.getLength(),o=0===s?0:1-e/s;return i.getPointAt(o,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let r=0,a=this.curves;r<a.length;r++){const i=a[r],s=i.isEllipseCurve?2*e:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?e*i.points.length:e,o=i.getPoints(s);for(let e=0;e<o.length;e++){const r=o[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Jf[n.type]).fromJSON(n))}return this}}class $f extends Zf{constructor(e){super(),this.type="Path",this.currentPoint=new hu,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Gf(this.currentPoint.clone(),new hu(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const a=new qf(this.currentPoint.clone(),new hu(e,t),new hu(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,a,i){const s=new Vf(this.currentPoint.clone(),new hu(e,t),new hu(n,r),new hu(a,i));return this.curves.push(s),this.currentPoint.set(a,i),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Yf(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,a,i){const s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,n,r,a,i),this}absarc(e,t,n,r,a,i){return this.absellipse(e,t,n,n,r,a,i),this}ellipse(e,t,n,r,a,i,s,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,a,i,s,o),this}absellipse(e,t,n,r,a,i,s,o){const l=new Ff(e,t,n,r,a,i,s,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class em extends $f{constructor(e){super(e),this.uuid=au(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new $f).fromJSON(n))}return this}}function tm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,a=r?t[0]*n:e.length;let i=nm(e,0,a,n,!0);const s=[];if(!i||i.next===i.prev)return s;let o,l,c;if(r&&(i=function(e,t,n,r){const a=[];for(let i=0,s=t.length;i<s;i++){const n=nm(e,t[i]*r,i<s-1?t[i+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),a.push(Am(n))}a.sort(cm);for(let i=0;i<a.length;i++)n=um(a[i],n);return n}(e,t,i,n)),e.length>80*n){o=1/0,l=1/0;let t=-1/0,r=-1/0;for(let i=n;i<a;i+=n){const n=e[i],a=e[i+1];n<o&&(o=n),a<l&&(l=a),n>t&&(t=n),a>r&&(r=a)}c=Math.max(t-o,r-l),c=0!==c?32767/c:0}return am(i,s,n,o,l,c,0),s}function nm(e,t,n,r,a){let i;if(a===function(e,t,n,r){let a=0;for(let i=t,s=n-r;i<n;i+=r)a+=(e[s]-e[i])*(e[i+1]+e[s+1]),s=i;return a}(e,t,n,r)>0)for(let s=t;s<n;s+=r)i=Sm(s/r|0,e[s],e[s+1],i);else for(let s=n-r;s>=t;s-=r)i=Sm(s/r|0,e[s],e[s+1],i);return i&&ym(i,i.next)&&(Cm(i),i=i.next),i}function rm(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!ym(r,r.next)&&0!==gm(r.prev,r,r.next))r=r.next;else{if(Cm(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function am(e,t,n,r,a,i,s){if(!e)return;!s&&i&&function(e,t,n,r){let a=e;do{0===a.z&&(a.z=dm(a.x,a.y,t,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){let t,n=1;do{let r,a=e;e=null;let i=null;for(t=0;a;){t++;let s=a,o=0;for(let e=0;e<n&&(o++,s=s.nextZ,s);e++);let l=n;for(;o>0||l>0&&s;)0!==o&&(0===l||!s||a.z<=s.z)?(r=a,a=a.nextZ,o--):(r=s,s=s.nextZ,l--),i?i.nextZ=r:e=r,r.prevZ=i,i=r;a=s}i.nextZ=null,n*=2}while(t>1)}(a)}(e,r,a,i);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(i?sm(e,r,a,i):im(e))t.push(l.i,e.i,c.i),Cm(e),e=c.next,o=c.next;else if((e=c)===o){s?1===s?am(e=om(rm(e),t),t,n,r,a,i,2):2===s&&lm(e,t,n,r,a,i):am(rm(e),t,n,r,a,i,1);break}}}function im(e){const t=e.prev,n=e,r=e.next;if(gm(t,n,r)>=0)return!1;const a=t.x,i=n.x,s=r.x,o=t.y,l=n.y,c=r.y,u=Math.min(a,i,s),h=Math.min(o,l,c),d=Math.max(a,i,s),A=Math.max(o,l,c);let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=A&&fm(a,o,i,l,s,c,p.x,p.y)&&gm(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function sm(e,t,n,r){const a=e.prev,i=e,s=e.next;if(gm(a,i,s)>=0)return!1;const o=a.x,l=i.x,c=s.x,u=a.y,h=i.y,d=s.y,A=Math.min(o,l,c),p=Math.min(u,h,d),f=Math.max(o,l,c),m=Math.max(u,h,d),g=dm(A,p,t,n,r),y=dm(f,m,t,n,r);let v=e.prevZ,b=e.nextZ;for(;v&&v.z>=g&&b&&b.z<=y;){if(v.x>=A&&v.x<=f&&v.y>=p&&v.y<=m&&v!==a&&v!==s&&fm(o,u,l,h,c,d,v.x,v.y)&&gm(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=A&&b.x<=f&&b.y>=p&&b.y<=m&&b!==a&&b!==s&&fm(o,u,l,h,c,d,b.x,b.y)&&gm(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=g;){if(v.x>=A&&v.x<=f&&v.y>=p&&v.y<=m&&v!==a&&v!==s&&fm(o,u,l,h,c,d,v.x,v.y)&&gm(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=A&&b.x<=f&&b.y>=p&&b.y<=m&&b!==a&&b!==s&&fm(o,u,l,h,c,d,b.x,b.y)&&gm(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function om(e,t){let n=e;do{const r=n.prev,a=n.next.next;!ym(r,a)&&vm(r,n,n.next,a)&&wm(r,a)&&wm(a,r)&&(t.push(r.i,n.i,a.i),Cm(n),Cm(n.next),n=e=a),n=n.next}while(n!==e);return rm(n)}function lm(e,t,n,r,a,i){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&mm(s,e)){let o=_m(s,e);return s=rm(s,s.next),o=rm(o,o.next),am(s,t,n,r,a,i,0),void am(o,t,n,r,a,i,0)}e=e.next}s=s.next}while(s!==e)}function cm(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function um(e,t){const n=function(e,t){let n=t;const r=e.x,a=e.y;let i,s=-1/0;if(ym(e,n))return n;do{if(ym(e,n.next))return n.next;if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){const e=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s&&(s=e,i=n.x<n.next.x?n:n.next,e===r))return i}n=n.next}while(n!==t);if(!i)return null;const o=i,l=i.x,c=i.y;let u=1/0;n=i;do{if(r>=n.x&&n.x>=l&&r!==n.x&&pm(a<c?r:s,a,l,c,a<c?s:r,a,n.x,n.y)){const t=Math.abs(a-n.y)/(r-n.x);wm(n,e)&&(t<u||t===u&&(n.x>i.x||n.x===i.x&&hm(i,n)))&&(i=n,u=t)}n=n.next}while(n!==o);return i}(e,t);if(!n)return t;const r=_m(n,e);return rm(r,r.next),rm(n,n.next)}function hm(e,t){return gm(e.prev,e,t.prev)<0&&gm(t.next,e,e.next)<0}function dm(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Am(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function pm(e,t,n,r,a,i,s,o){return(a-s)*(t-o)>=(e-s)*(i-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(i-o)>=(a-s)*(r-o)}function fm(e,t,n,r,a,i,s,o){return!(e===s&&t===o)&&pm(e,t,n,r,a,i,s,o)}function mm(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&vm(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(wm(e,t)&&wm(t,e)&&function(e,t){let n=e,r=!1;const a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!==n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(gm(e.prev,e,t.prev)||gm(e,t.prev,t))||ym(e,t)&&gm(e.prev,e,e.next)>0&&gm(t.prev,t,t.next)>0)}function gm(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ym(e,t){return e.x===t.x&&e.y===t.y}function vm(e,t,n,r){const a=xm(gm(e,t,n)),i=xm(gm(e,t,r)),s=xm(gm(n,r,e)),o=xm(gm(n,r,t));return a!==i&&s!==o||(!(0!==a||!bm(e,n,t))||(!(0!==i||!bm(e,r,t))||(!(0!==s||!bm(n,e,r))||!(0!==o||!bm(n,t,r)))))}function bm(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function xm(e){return e>0?1:e<0?-1:0}function wm(e,t){return gm(e.prev,e,e.next)<0?gm(e,t,e.next)>=0&&gm(e,e.prev,t)>=0:gm(e,t,e.prev)<0||gm(e,e.next,t)<0}function _m(e,t){const n=Em(e.i,e.x,e.y),r=Em(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function Sm(e,t,n,r){const a=Em(e,t,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function Cm(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Em(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Nm{static triangulate(e,t){return tm(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:2)}}class Bm{static area(e){const t=e.length;let n=0;for(let r=t-1,a=0;a<t;r=a++)n+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*n}static isClockWise(e){return Bm.area(e)<0}static triangulateShape(e,t){const n=[],r=[],a=[];km(e),Im(n,e);let i=e.length;t.forEach(km);for(let o=0;o<t.length;o++)r.push(i),i+=t[o].length,Im(n,t[o]);const s=Nm.triangulate(n,r);for(let o=0;o<s.length;o+=3)a.push(s.slice(o,o+3));return a}}function km(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Im(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Tm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new em([new hu(.5,.5),new hu(-.5,.5),new hu(-.5,-.5),new hu(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],a=[];for(let s=0,o=e.length;s<o;s++){i(e[s])}function i(e){const i=[],s=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,A=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:Mm;let m,g,y,v,b,x=!1;p&&(m=p.getSpacedPoints(o),x=!0,c=!1,g=p.computeFrenetFrames(o,!1),y=new Au,v=new Au,b=new Au),c||(A=0,u=0,h=0,d=0);const w=e.extractPoints(s);let _=w.shape;const S=w.holes;if(!Bm.isClockWise(_)){_=_.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];Bm.isClockWise(t)&&(S[e]=t.reverse())}}function C(e){const t=1e-10*1e-10;let n=e[0];for(let r=1;r<=e.length;r++){const a=r%e.length,i=e[a],s=i.x-n.x,o=i.y-n.y,l=s*s+o*o,c=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(a,1),r--):n=i}}C(_),S.forEach(C);const E=S.length,N=_;for(let t=0;t<E;t++){const e=S[t];_=_.concat(e)}function B(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const k=_.length;function I(e,t,n){let r,a,i;const s=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+o*o,h=s*c-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),A=t.x-o/h,p=t.y+s/h,f=((n.x-c/d-A)*c-(n.y+l/d-p)*l)/(s*c-o*l);r=A+s*f-e.x,a=p+o*f-e.y;const m=r*r+a*a;if(m<=2)return new hu(r,a);i=Math.sqrt(m/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(r=-o,a=s,i=Math.sqrt(u)):(r=s,a=o,i=Math.sqrt(u/2))}return new hu(r/i,a/i)}const T=[];for(let t=0,n=N.length,r=n-1,a=t+1;t<n;t++,r++,a++)r===n&&(r=0),a===n&&(a=0),T[t]=I(N[t],N[r],N[a]);const M=[];let F,R,L=T.concat();for(let t=0,n=E;t<n;t++){const e=S[t];F=[];for(let t=0,n=e.length,r=n-1,a=t+1;t<n;t++,r++,a++)r===n&&(r=0),a===n&&(a=0),F[t]=I(e[t],e[r],e[a]);M.push(F),L=L.concat(F)}if(0===A)R=Bm.triangulateShape(N,S);else{const e=[],t=[];for(let n=0;n<A;n++){const r=n/A,a=u*Math.cos(r*Math.PI/2),i=h*Math.sin(r*Math.PI/2)+d;for(let t=0,n=N.length;t<n;t++){const n=B(N[t],T[t],i);O(n.x,n.y,-a),0===r&&e.push(n)}for(let e=0,n=E;e<n;e++){const n=S[e];F=M[e];const s=[];for(let e=0,t=n.length;e<t;e++){const t=B(n[e],F[e],i);O(t.x,t.y,-a),0===r&&s.push(t)}0===r&&t.push(s)}}R=Bm.triangulateShape(e,t)}const U=R.length,P=h+d;for(let t=0;t<k;t++){const e=c?B(_[t],L[t],P):_[t];x?(v.copy(g.normals[0]).multiplyScalar(e.x),y.copy(g.binormals[0]).multiplyScalar(e.y),b.copy(m[0]).add(v).add(y),O(b.x,b.y,b.z)):O(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<k;e++){const n=c?B(_[e],L[e],P):_[e];x?(v.copy(g.normals[t]).multiplyScalar(n.x),y.copy(g.binormals[t]).multiplyScalar(n.y),b.copy(m[t]).add(v).add(y),O(b.x,b.y,b.z)):O(n.x,n.y,l/o*t)}for(let t=A-1;t>=0;t--){const e=t/A,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,a=N.length;t<a;t++){const e=B(N[t],T[t],r);O(e.x,e.y,l+n)}for(let t=0,a=S.length;t<a;t++){const e=S[t];F=M[t];for(let t=0,a=e.length;t<a;t++){const a=B(e[t],F[t],r);x?O(a.x,a.y+m[o-1].y,m[o-1].x+n):O(a.x,a.y,l+n)}}}function D(e,t){let n=e.length;for(;--n>=0;){const r=n;let a=n-1;a<0&&(a=e.length-1);for(let e=0,n=o+2*A;e<n;e++){const n=k*e,i=k*(e+1);H(t+r+n,t+a+n,t+a+i,t+r+i)}}}function O(e,t,n){i.push(e),i.push(t),i.push(n)}function z(e,t,a){j(e),j(t),j(a);const i=r.length/3,s=f.generateTopUV(n,r,i-3,i-2,i-1);Q(s[0]),Q(s[1]),Q(s[2])}function H(e,t,a,i){j(e),j(t),j(i),j(t),j(a),j(i);const s=r.length/3,o=f.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);Q(o[0]),Q(o[1]),Q(o[3]),Q(o[1]),Q(o[2]),Q(o[3])}function j(e){r.push(i[3*e+0]),r.push(i[3*e+1]),r.push(i[3*e+2])}function Q(e){a.push(e.x),a.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=k*e;for(let n=0;n<U;n++){const e=R[n];z(e[2]+t,e[1]+t,e[0]+t)}e=o+2*A,t=k*e;for(let n=0;n<U;n++){const e=R[n];z(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<U;e++){const t=R[e];z(t[2],t[1],t[0])}for(let e=0;e<U;e++){const t=R[e];z(t[0]+k*o,t[1]+k*o,t[2]+k*o)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;D(N,t),t+=N.length;for(let n=0,r=S.length;n<r;n++){const e=S[n];D(e,t),t+=e.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Fd(r,3)),this.setAttribute("uv",new Fd(a,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let r=0,a=e.length;r<a;r++){const t=e[r];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let a=0,i=e.shapes.length;a<i;a++){const r=t[e.shapes[a]];n.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Jf[r.type]).fromJSON(r)),new Tm(n,e.options)}}const Mm={generateTopUV:function(e,t,n,r,a){const i=t[3*n],s=t[3*n+1],o=t[3*r],l=t[3*r+1],c=t[3*a],u=t[3*a+1];return[new hu(i,s),new hu(o,l),new hu(c,u)]},generateSideWallUV:function(e,t,n,r,a,i){const s=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*a],A=t[3*a+1],p=t[3*a+2],f=t[3*i],m=t[3*i+1],g=t[3*i+2];return Math.abs(o-u)<Math.abs(s-c)?[new hu(s,1-l),new hu(c,1-h),new hu(d,1-p),new hu(f,1-g)]:[new hu(o,1-l),new hu(u,1-h),new hu(A,1-p),new hu(m,1-g)]}};class Fm extends Cf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fm(e.radius,e.detail)}}class Rm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new hu(0,-.5),new hu(.5,0),new hu(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=iu(r,0,2*Math.PI);const a=[],i=[],s=[],o=[],l=[],c=1/t,u=new Au,h=new hu,d=new Au,A=new Au,p=new Au;let f=0,m=0;for(let g=0;g<=e.length-1;g++)switch(g){case 0:f=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=1*m,d.y=-f,d.z=0*m,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:f=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=1*m,d.y=-f,d.z=0*m,A.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(A)}for(let g=0;g<=t;g++){const a=n+g*c*r,d=Math.sin(a),A=Math.cos(a);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*A,i.push(u.x,u.y,u.z),h.x=g/t,h.y=n/(e.length-1),s.push(h.x,h.y);const r=o[3*n+0]*d,a=o[3*n+1],c=o[3*n+0]*A;l.push(r,a,c)}}for(let g=0;g<t;g++)for(let t=0;t<e.length-1;t++){const n=t+g*e.length,r=n,i=n+e.length,s=n+e.length+1,o=n+1;a.push(r,i,o),a.push(s,o,i)}this.setIndex(a),this.setAttribute("position",new Fd(i,3)),this.setAttribute("uv",new Fd(s,2)),this.setAttribute("normal",new Fd(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rm(e.points,e.segments,e.phiStart,e.phiLength)}}class Lm extends Cf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Lm(e.radius,e.detail)}}class Um extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const a=e/2,i=t/2,s=Math.floor(n),o=Math.floor(r),l=s+1,c=o+1,u=e/s,h=t/o,d=[],A=[],p=[],f=[];for(let m=0;m<c;m++){const e=m*h-i;for(let t=0;t<l;t++){const n=t*u-a;A.push(n,-e,0),p.push(0,0,1),f.push(t/s),f.push(1-m/o)}}for(let m=0;m<o;m++)for(let e=0;e<s;e++){const t=e+l*m,n=e+l*(m+1),r=e+1+l*(m+1),a=e+1+l*m;d.push(t,n,a),d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new Fd(A,3)),this.setAttribute("normal",new Fd(p,3)),this.setAttribute("uv",new Fd(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Um(e.width,e.height,e.widthSegments,e.heightSegments)}}class Pm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:a,thetaLength:i},n=Math.max(3,n),r=Math.max(1,r);const s=[],o=[],l=[],c=[];let u=e;const h=(t-e)/r,d=new Au,A=new hu;for(let p=0;p<=r;p++){for(let e=0;e<=n;e++){const r=a+e/n*i;d.x=u*Math.cos(r),d.y=u*Math.sin(r),o.push(d.x,d.y,d.z),l.push(0,0,1),A.x=(d.x/t+1)/2,A.y=(d.y/t+1)/2,c.push(A.x,A.y)}u+=h}for(let p=0;p<r;p++){const e=p*(n+1);for(let t=0;t<n;t++){const r=t+e,a=r,i=r+n+1,o=r+n+2,l=r+1;s.push(a,i,l),s.push(i,o,l)}}this.setIndex(s),this.setAttribute("position",new Fd(o,3)),this.setAttribute("normal",new Fd(l,3)),this.setAttribute("uv",new Fd(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pm(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Dm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new em([new hu(0,.5),new hu(-.5,-.5),new hu(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],a=[],i=[];let s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,o,c),s+=o,o=0;function l(e){const s=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Bm.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===Bm.isClockWise(e)&&(u[t]=e.reverse())}const h=Bm.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];r.push(e.x,e.y,0),a.push(0,0,1),i.push(e.x,e.y)}for(let t=0,r=h.length;t<r;t++){const e=h[t],r=e[0]+s,a=e[1]+s,i=e[2]+s;n.push(r,a,i),o+=3}}this.setIndex(n),this.setAttribute("position",new Fd(r,3)),this.setAttribute("normal",new Fd(a,3)),this.setAttribute("uv",new Fd(i,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,a=e.shapes.length;r<a;r++){const a=t[e.shapes[r]];n.push(a)}return new Dm(n,e.curveSegments)}}class Om extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:a,thetaStart:i,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(i+s,Math.PI);let l=0;const c=[],u=new Au,h=new Au,d=[],A=[],p=[],f=[];for(let m=0;m<=n;m++){const d=[],g=m/n;let y=0;0===m&&0===i?y=.5/t:m===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(r+o*a)*Math.sin(i+g*s),u.y=e*Math.cos(i+g*s),u.z=e*Math.sin(r+o*a)*Math.sin(i+g*s),A.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),f.push(o+y,1-g),d.push(l++)}c.push(d)}for(let m=0;m<n;m++)for(let e=0;e<t;e++){const t=c[m][e+1],r=c[m][e],a=c[m+1][e],s=c[m+1][e+1];(0!==m||i>0)&&d.push(t,r,s),(m!==n-1||o<Math.PI)&&d.push(r,a,s)}this.setIndex(d),this.setAttribute("position",new Fd(A,3)),this.setAttribute("normal",new Fd(p,3)),this.setAttribute("uv",new Fd(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Om(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class zm extends Cf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zm(e.radius,e.detail)}}class Hm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:a},n=Math.floor(n),r=Math.floor(r);const i=[],s=[],o=[],l=[],c=new Au,u=new Au,h=new Au;for(let d=0;d<=n;d++)for(let i=0;i<=r;i++){const A=i/r*a,p=d/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(A),u.y=(e+t*Math.cos(p))*Math.sin(A),u.z=t*Math.sin(p),s.push(u.x,u.y,u.z),c.x=e*Math.cos(A),c.y=e*Math.sin(A),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(i/r),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=r;e++){const t=(r+1)*d+e-1,n=(r+1)*(d-1)+e-1,a=(r+1)*(d-1)+e,s=(r+1)*d+e;i.push(t,n,s),i.push(n,a,s)}this.setIndex(i),this.setAttribute("position",new Fd(s,3)),this.setAttribute("normal",new Fd(o,3)),this.setAttribute("uv",new Fd(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hm(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class jm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:a,q:i},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],l=[],c=[],u=new Au,h=new Au,d=new Au,A=new Au,p=new Au,f=new Au,m=new Au;for(let y=0;y<=n;++y){const s=y/n*a*Math.PI*2;g(s,a,i,e,d),g(s+.01,a,i,e,A),f.subVectors(A,d),m.addVectors(A,d),p.crossVectors(f,m),m.crossVectors(p,f),p.normalize(),m.normalize();for(let e=0;e<=r;++e){const a=e/r*Math.PI*2,i=-t*Math.cos(a),s=t*Math.sin(a);u.x=d.x+(i*m.x+s*p.x),u.y=d.y+(i*m.y+s*p.y),u.z=d.z+(i*m.z+s*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(e/r)}}for(let y=1;y<=n;y++)for(let e=1;e<=r;e++){const t=(r+1)*(y-1)+(e-1),n=(r+1)*y+(e-1),a=(r+1)*y+e,i=(r+1)*(y-1)+e;s.push(t,n,i),s.push(n,a,i)}function g(e,t,n,r,a){const i=Math.cos(e),s=Math.sin(e),o=n/t*e,l=Math.cos(o);a.x=r*(2+l)*.5*i,a.y=r*(2+l)*s*.5,a.z=r*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new Fd(o,3)),this.setAttribute("normal",new Fd(l,3)),this.setAttribute("uv",new Fd(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jm(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Qm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Xf(new Au(-1,-1,0),new Au(-1,1,0),new Au(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:a};const i=e.computeFrenetFrames(t,a);this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals;const s=new Au,o=new Au,l=new hu;let c=new Au;const u=[],h=[],d=[],A=[];function p(a){c=e.getPointAt(a/t,c);const l=i.normals[a],d=i.binormals[a];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,a=Math.sin(t),i=-Math.cos(t);o.x=i*l.x+a*d.x,o.y=i*l.y+a*d.y,o.z=i*l.z+a*d.z,o.normalize(),h.push(o.x,o.y,o.z),s.x=c.x+n*o.x,s.y=c.y+n*o.y,s.z=c.z+n*o.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===a?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),a=(r+1)*e+(t-1),i=(r+1)*e+t,s=(r+1)*(e-1)+t;A.push(n,a,s),A.push(a,i,s)}}()}(),this.setIndex(A),this.setAttribute("position",new Fd(u,3)),this.setAttribute("normal",new Fd(h,3)),this.setAttribute("uv",new Fd(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Qm((new Jf[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Vm extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new Au,a=new Au;if(null!==e.index){const i=e.attributes.position,s=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let l=0;l<3;l++){const o=s.getX(e+l),c=s.getX(e+(l+1)%3);r.fromBufferAttribute(i,o),a.fromBufferAttribute(i,c),!0===Wm(r,a,n)&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}}else{const i=e.attributes.position;for(let e=0,s=i.count/3;e<s;e++)for(let o=0;o<3;o++){const s=3*e+o,l=3*e+(o+1)%3;r.fromBufferAttribute(i,s),a.fromBufferAttribute(i,l),!0===Wm(r,a,n)&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new Fd(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Wm(e,t,n){const r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),a="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(r)&&!0!==n.has(a)&&(n.add(r),n.add(a),!0)}var Gm=Object.freeze({__proto__:null,BoxGeometry:tA,CapsuleGeometry:xf,CircleGeometry:wf,ConeGeometry:Sf,CylinderGeometry:_f,DodecahedronGeometry:Ef,EdgesGeometry:Tf,ExtrudeGeometry:Tm,IcosahedronGeometry:Fm,LatheGeometry:Rm,OctahedronGeometry:Lm,PlaneGeometry:Um,PolyhedronGeometry:Cf,RingGeometry:Pm,ShapeGeometry:Dm,SphereGeometry:Om,TetrahedronGeometry:zm,TorusGeometry:Hm,TorusKnotGeometry:jm,TubeGeometry:Qm,WireframeGeometry:Vm});class Km extends pd{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new hd(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class qm extends sA{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Xm extends pd{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new hd(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kh,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ym extends Xm{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new hu(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return iu(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new hd(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new hd(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new hd(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Jm extends pd{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new hd(16777215),this.specular=new hd(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kh,this.combine=oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Zm extends pd{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new hd(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class $m extends pd{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class eg extends pd{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new hd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kh,this.combine=oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tg extends pd{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=nc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ng extends pd{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class rg extends pd{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new hd(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sc,this.normalScale=new hu(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ag extends Vp{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ig(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function sg(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function og(e){const t=e.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(function(t,n){return e[t]-e[n]}),n}function lg(e,t,n){const r=e.length,a=new e.constructor(r);for(let i=0,s=0;s!==r;++i){const r=n[i]*t;for(let n=0;n!==t;++n)a[s++]=e[r+n]}return a}function cg(e,t,n,r){let a=1,i=e[0];for(;void 0!==i&&void 0===i[r];)i=e[a++];if(void 0===i)return;let s=i[r];if(void 0!==s)if(Array.isArray(s))do{s=i[r],void 0!==s&&(t.push(i.time),n.push(...s)),i=e[a++]}while(void 0!==i);else if(void 0!==s.toArray)do{s=i[r],void 0!==s&&(t.push(i.time),s.toArray(n,n.length)),i=e[a++]}while(void 0!==i);else do{s=i[r],void 0!==s&&(t.push(i.time),n.push(s)),i=e[a++]}while(void 0!==i)}class ug{static convertArray(e,t){return ig(e,t)}static isTypedArray(e){return sg(e)}static getKeyframeOrder(e){return og(e)}static sortedArray(e,t,n){return lg(e,t,n)}static flattenJSON(e,t,n,r){cg(e,t,n,r)}static subclip(e,t,n,r){return function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const i=e.clone();i.name=t;const s=[];for(let l=0;l<i.tracks.length;++l){const e=i.tracks[l],t=e.getValueSize(),o=[],c=[];for(let i=0;i<e.times.length;++i){const s=e.times[i]*a;if(!(s<n||s>=r)){o.push(e.times[i]);for(let n=0;n<t;++n)c.push(e.values[i*t+n])}}0!==o.length&&(e.times=ig(o,e.times.constructor),e.values=ig(c,e.values.constructor),s.push(e))}i.tracks=s;let o=1/0;for(let l=0;l<i.tracks.length;++l)o>i.tracks[l].times[0]&&(o=i.tracks[l].times[0]);for(let l=0;l<i.tracks.length;++l)i.tracks[l].shift(-1*o);return i.resetDuration(),i}(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:30)}static makeClipAdditive(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);const a=n.tracks.length,i=t/r;for(let s=0;s<a;++s){const t=n.tracks[s],r=t.ValueTypeName;if("bool"===r||"string"===r)continue;const a=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===r});if(void 0===a)continue;let o=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=t.times.length-1;let d;if(i<=t.times[0]){const e=o,n=l-o;d=t.values.slice(e,n)}else if(i>=t.times[h]){const e=h*l+o,n=e+l-o;d=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=o,r=l-o;e.evaluate(i),d=e.resultBuffer.slice(n,r)}"quaternion"===r&&(new du).fromArray(d).normalize().conjugate().toArray(d);const A=a.times.length;for(let e=0;e<A;++e){const t=e*u+c;if("quaternion"===r)du.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=Zl,e}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:30)}}class hg{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{let i;n:{r:if(!(e<r)){for(let i=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===i)break;if(a=r,r=t[++n],e<r)break t}i=t.length;break n}if(!(e>=a)){const s=t[1];e<s&&(n=2,a=s);for(let i=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===i)break;if(r=a,a=t[--n-1],e>=a)break t}i=n,n=0;break n}break e}for(;n<i;){const r=n+i>>>1;e<t[r]?i=r:n=r+1}if(r=t[n],a=t[n-1],void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r;for(let i=0;i!==r;++i)t[i]=n[a+i];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class dg extends hg{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ql,endingEnd:ql}}intervalChanged_(e,t,n){const r=this.parameterPositions;let a=e-2,i=e+1,s=r[a],o=r[i];if(void 0===s)switch(this.getSettings_().endingStart){case Xl:a=e,s=2*t-n;break;case Yl:a=r.length-2,s=t+r[a]-r[a+1];break;default:a=e,s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Xl:i=e,o=2*n-t;break;case Yl:i=1,o=n+r[1]-r[0];break;default:i=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=a*c,this._offsetNext=i*c}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,A=(n-t)/(r-t),p=A*A,f=p*A,m=-h*f+2*h*p-h*A,g=(1+h)*f+(-1.5-2*h)*p+(-.5+h)*A+1,y=(-1-d)*f+(1.5+d)*p+.5*A,v=d*f-d*p;for(let b=0;b!==s;++b)a[b]=m*i[c+b]+g*i[l+b]+y*i[o+b]+v*i[u+b];return a}}class Ag extends hg{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(n-t)/(r-t),u=1-c;for(let h=0;h!==s;++h)a[h]=i[l+h]*u+i[o+h]*c;return a}}class pg extends hg{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fg{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ig(t,this.TimeBufferType),this.values=ig(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ig(e.times,Array),values:ig(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new pg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ag(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new dg(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Wl:t=this.InterpolantFactoryMethodDiscrete;break;case Gl:t=this.InterpolantFactoryMethodLinear;break;case Kl:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wl;case this.InterpolantFactoryMethodLinear:return Gl;case this.InterpolantFactoryMethodSmooth:return Kl}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let a=0,i=r-1;for(;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(i=Math.max(i,1),a=i-1);const e=this.getValueSize();this.times=n.slice(a,i),this.values=this.values.slice(a*e,i*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let i=null;for(let s=0;s!==a;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==i&&i>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,i),e=!1;break}i=t}if(void 0!==r&&sg(r))for(let s=0,o=r.length;s!==o;++s){const t=r[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Kl,a=e.length-1;let i=1;for(let s=1;s<a;++s){let a=!1;const o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(r)a=!0;else{const e=s*n,r=e-n,i=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[i+s]){a=!0;break}}}if(a){if(s!==i){e[i]=e[s];const r=s*n,a=i*n;for(let e=0;e!==n;++e)t[a+e]=t[r+e]}++i}}if(a>0){e[i]=e[a];for(let e=a*n,r=i*n,s=0;s!==n;++s)t[r+s]=t[e+s];++i}return i!==e.length?(this.times=e.slice(0,i),this.values=t.slice(0,i*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}fg.prototype.ValueTypeName="",fg.prototype.TimeBufferType=Float32Array,fg.prototype.ValueBufferType=Float32Array,fg.prototype.DefaultInterpolation=Gl;class mg extends fg{constructor(e,t,n){super(e,t,n)}}mg.prototype.ValueTypeName="bool",mg.prototype.ValueBufferType=Array,mg.prototype.DefaultInterpolation=Wl,mg.prototype.InterpolantFactoryMethodLinear=void 0,mg.prototype.InterpolantFactoryMethodSmooth=void 0;class gg extends fg{constructor(e,t,n,r){super(e,t,n,r)}}gg.prototype.ValueTypeName="color";class yg extends fg{constructor(e,t,n,r){super(e,t,n,r)}}yg.prototype.ValueTypeName="number";class vg extends hg{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=(n-t)/(r-t);let l=e*s;for(let c=l+s;l!==c;l+=4)du.slerpFlat(a,0,i,l-s,i,l,o);return a}}class bg extends fg{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new vg(this.times,this.values,this.getValueSize(),e)}}bg.prototype.ValueTypeName="quaternion",bg.prototype.InterpolantFactoryMethodSmooth=void 0;class xg extends fg{constructor(e,t,n){super(e,t,n)}}xg.prototype.ValueTypeName="string",xg.prototype.ValueBufferType=Array,xg.prototype.DefaultInterpolation=Wl,xg.prototype.InterpolantFactoryMethodLinear=void 0,xg.prototype.InterpolantFactoryMethodSmooth=void 0;class wg extends fg{constructor(e,t,n,r){super(e,t,n,r)}}wg.prototype.ValueTypeName="vector";class _g{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Jl;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=au(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let i=0,s=n.length;i!==s;++i)t.push(Sg(n[i]).scale(r));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a.userData=JSON.parse(e.userData||"{}"),a}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let a=0,i=n.length;a!==i;++a)t.push(fg.toJSON(n[a]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const a=t.length,i=[];for(let s=0;s<a;s++){let e=[],o=[];e.push((s+a-1)%a,s,(s+1)%a),o.push(0,1,0);const l=og(e);e=lg(e,1,l),o=lg(o,1,l),r||0!==e[0]||(e.push(a),o.push(o[0])),i.push(new yg(".morphTargetInfluences["+t[s].name+"]",e,o).scale(1/n))}return new this(e,-1,i)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},a=/^([\w-]*?)([\d]+)$/;for(let s=0,o=e.length;s<o;s++){const t=e[s],n=t.name.match(a);if(n&&n.length>1){const e=n[1];let a=r[e];a||(r[e]=a=[]),a.push(t)}}const i=[];for(const s in r)i.push(this.CreateFromMorphTargetSequence(s,r[s],t,n));return i}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,a){if(0!==n.length){const i=[],s=[];cg(n,i,s,r),0!==i.length&&a.push(new e(t,i,s))}},r=[],a=e.name||"default",i=e.fps||30,s=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let r=0;r<e[n].morphTargets.length;r++)t[e[n].morphTargets[r]]=-1;for(const a in t){const t=[],i=[];for(let r=0;r!==e[n].morphTargets.length;++r){const r=e[n];t.push(r.time),i.push(r.morphTarget===a?1:0)}r.push(new yg(".morphTargetInfluence["+a+"]",t,i))}o=t.length*i}else{const a=".bones["+t[c].name+"]";n(wg,a+".position",e,"pos",r),n(bg,a+".quaternion",e,"rot",r),n(wg,a+".scale",e,"scl",r)}}if(0===r.length)return null;return new this(a,o,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function Sg(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yg;case"vector":case"vector2":case"vector3":case"vector4":return wg;case"color":return gg;case"quaternion":return bg;case"bool":case"boolean":return mg;case"string":return xg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];cg(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Cg={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Eg{constructor(e,t,n){const r=this;let a,i=!1,s=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,s,o),i=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const Ng=new Eg;class Bg{constructor(e){this.manager=void 0!==e?e:Ng,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,a){n.load(e,r,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Bg.DEFAULT_MATERIAL_NAME="__DEFAULT";const kg={};class Ig extends Error{constructor(e,t){super(e),this.response=t}}class Tg extends Bg{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Cg.get("file:".concat(e));if(void 0!==a)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(void 0!==kg[e])return void kg[e].push({onLoad:t,onProgress:n,onError:r});kg[e]=[],kg[e].push({onLoad:t,onProgress:n,onError:r});const i=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),s=this.mimeType,o=this.responseType;fetch(i).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=kg[e],r=t.body.getReader(),a=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),i=a?parseInt(a):0,s=0!==i;let o=0;const l=new ReadableStream({start(e){!function t(){r.read().then(r=>{let{done:a,value:l}=r;if(a)e.close();else{o+=l.byteLength;const r=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:i});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(l),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new Ig('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,s));case"json":return e.json();default:if(""===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{Cg.add("file:".concat(e),t);const n=kg[e];delete kg[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=kg[e];if(void 0===n)throw this.manager.itemError(e),t;delete kg[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class Mg extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new Tg(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=_g.parse(e[n]);t.push(r)}return t}}class Fg extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=[],s=new ff,o=new Tg(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(a.withCredentials);let l=0;function c(c){o.load(e[c],function(e){const n=a.parse(e,!0);i[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=Lo),s.image=i,s.format=n.format,s.needsUpdate=!0,t&&t(s))},n,r)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)c(u);else o.load(e,function(e){const n=a.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){i[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)i[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),i[t].format=n.format,i[t].width=n.width,i[t].height=n.height}s.image=i}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=Lo),s.format=n.format,s.needsUpdate=!0,t&&t(s)},n,r);return s}}const Rg=new WeakMap;class Lg extends Bg{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Cg.get("image:".concat(e));if(void 0!==i){if(!0===i.complete)a.manager.itemStart(e),setTimeout(function(){t&&t(i),a.manager.itemEnd(e)},0);else{let e=Rg.get(i);void 0===e&&(e=[],Rg.set(i,e)),e.push({onLoad:t,onError:r})}return i}const s=xu("img");function o(){c(),t&&t(this);const n=Rg.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}Rg.delete(this),a.manager.itemEnd(e)}function l(t){c(),r&&r(t),Cg.remove("image:".concat(e));const n=Rg.get(this)||[];for(let e=0;e<n.length;e++){const r=n[e];r.onError&&r.onError(t)}Rg.delete(this),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),Cg.add("image:".concat(e),s),a.manager.itemStart(e),s.src=e,s}}class Ug extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=new pA;a.colorSpace=cc;const i=new Lg(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);let s=0;function o(n){i.load(e[n],function(e){a.images[n]=e,s++,6===s&&(a.needsUpdate=!0,t&&t(a))},void 0,r)}for(let l=0;l<e.length;++l)o(l);return a}}class Pg extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new tp,s=new Tg(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(a.withCredentials),s.load(e,function(e){let n;try{n=a.parse(e)}catch(_S){if(void 0===r)return void console.error(_S);r(_S)}void 0!==n.image?i.image=n.image:void 0!==n.data&&(i.image.width=n.width,i.image.height=n.height,i.image.data=n.data),i.wrapS=void 0!==n.wrapS?n.wrapS:Bo,i.wrapT=void 0!==n.wrapT?n.wrapT:Bo,i.magFilter=void 0!==n.magFilter?n.magFilter:Lo,i.minFilter=void 0!==n.minFilter?n.minFilter:Lo,i.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(i.colorSpace=n.colorSpace),void 0!==n.flipY&&(i.flipY=n.flipY),void 0!==n.format&&(i.format=n.format),void 0!==n.type&&(i.type=n.type),void 0!==n.mipmaps&&(i.mipmaps=n.mipmaps,i.minFilter=Do),1===n.mipmapCount&&(i.minFilter=Lo),void 0!==n.generateMipmaps&&(i.generateMipmaps=n.generateMipmaps),i.needsUpdate=!0,t&&t(i,n)},n,r),i}}class Dg extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=new Du,i=new Lg(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)},n,r),a}}class Og extends Gh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new hd(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class zg extends Og{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gh.DEFAULT_UP),this.updateMatrix(),this.groundColor=new hd(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Hg=new vh,jg=new Au,Qg=new Au;class Vg{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new hu(512,512),this.mapType=zo,this.map=null,this.mapPass=null,this.matrix=new vh,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xp,this._frameExtents=new hu(1,1),this._viewportCount=1,this._viewports=[new Ou(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;jg.setFromMatrixPosition(e.matrixWorld),t.position.copy(jg),Qg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Qg),t.updateMatrixWorld(),Hg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hg,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Hg)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Wg extends Vg{constructor(){super(new hA(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*ru*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,a=e.distance||t.far;n===t.fov&&r===t.aspect&&a===t.far||(t.fov=n,t.aspect=r,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Gg extends Og{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gh.DEFAULT_UP),this.updateMatrix(),this.target=new Gh,this.distance=n,this.angle=r,this.penumbra=a,this.decay=i,this.map=null,this.shadow=new Wg}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Kg=new vh,qg=new Au,Xg=new Au;class Yg extends Vg{constructor(){super(new hA(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new hu(4,2),this._viewportCount=6,this._viewports=[new Ou(2,1,1,1),new Ou(0,1,1,1),new Ou(3,1,1,1),new Ou(1,1,1,1),new Ou(3,0,1,1),new Ou(1,0,1,1)],this._cubeDirections=[new Au(1,0,0),new Au(-1,0,0),new Au(0,0,1),new Au(0,0,-1),new Au(0,1,0),new Au(0,-1,0)],this._cubeUps=[new Au(0,1,0),new Au(0,1,0),new Au(0,1,0),new Au(0,1,0),new Au(0,0,1),new Au(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),qg.setFromMatrixPosition(e.matrixWorld),n.position.copy(qg),Xg.copy(n.position),Xg.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Xg),n.updateMatrixWorld(),r.makeTranslation(-qg.x,-qg.y,-qg.z),Kg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kg,n.coordinateSystem,n.reversedDepth)}}class Jg extends Og{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Yg}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Zg extends oA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=a,this.far=i,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=n-e,i=n+e,s=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=e*this.view.offsetX,i=a+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(a,i,s,o,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class $g extends Vg{constructor(){super(new Zg(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ey extends Og{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gh.DEFAULT_UP),this.updateMatrix(),this.target=new Gh,this.shadow=new $g}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ty extends Og{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class ny extends Og{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class ry{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Au)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*r),t.addScaledVector(i[2],.488603*a),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*r*1.092548),t.addScaledVector(i[5],r*a*1.092548),t.addScaledVector(i[6],.315392*(3*a*a-1)),t.addScaledVector(i[7],n*a*1.092548),t.addScaledVector(i[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*r),t.addScaledVector(i[2],1.023328*a),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*r),t.addScaledVector(i[5],.858086*r*a),t.addScaledVector(i[6],.743125*a*a-.247708),t.addScaledVector(i[7],.858086*n*a),t.addScaledVector(i[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-r*r)}}class ay extends Og{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ry;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class iy extends Bg{constructor(e){super(e),this.textures={}}load(e,t,n,r){const a=this,i=new Tg(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new hd).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const a in e.uniforms){const t=e.uniforms[a];switch(r.uniforms[a]={},t.type){case"t":r.uniforms[a].value=n(t.value);break;case"c":r.uniforms[a].value=(new hd).setHex(t.value);break;case"v2":r.uniforms[a].value=(new hu).fromArray(t.value);break;case"v3":r.uniforms[a].value=(new Au).fromArray(t.value);break;case"v4":r.uniforms[a].value=(new Ou).fromArray(t.value);break;case"m3":r.uniforms[a].value=(new mu).fromArray(t.value);break;case"m4":r.uniforms[a].value=(new vh).fromArray(t.value);break;default:r.uniforms[a].value=t.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new hu).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new hu).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return iy.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Km,SpriteMaterial:CA,RawShaderMaterial:qm,ShaderMaterial:sA,PointsMaterial:af,MeshPhysicalMaterial:Ym,MeshStandardMaterial:Xm,MeshPhongMaterial:Jm,MeshToonMaterial:Zm,MeshNormalMaterial:$m,MeshLambertMaterial:eg,MeshDepthMaterial:tg,MeshDistanceMaterial:ng,MeshBasicMaterial:fd,MeshMatcapMaterial:rg,LineDashedMaterial:ag,LineBasicMaterial:Vp,Material:pd}[e]}}class sy{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class oy extends Hd{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class ly extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new Tg(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const a=e.interleavedBuffers[r],i=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers,a=r[t],i=new Uint32Array(a).buffer;return n[t]=i,i}(e,a.buffer),s=bu(a.type,i),o=new wA(s,a.stride);return o.uuid=a.uuid,t[r]=o,o}const a=e.isInstancedBufferGeometry?new oy:new Hd,i=e.data.index;if(void 0!==i){const e=bu(i.type,i.array);a.setIndex(new Sd(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute){const a=r(e.data,t.data);n=new SA(a,t.itemSize,t.offset,t.normalized)}else{const e=bu(t.type,t.array);n=new(t.isInstancedBufferAttribute?ip:Sd)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),a.setAttribute(u,n)}const o=e.data.morphAttributes;if(o)for(const u in o){const t=o[u],n=[];for(let a=0,i=t.length;a<i;a++){const i=t[a];let s;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);s=new SA(t,i.itemSize,i.offset,i.normalized)}else{const e=bu(i.type,i.array);s=new Sd(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),n.push(s)}a.morphAttributes[u]=n}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const e=l[u];a.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;return void 0!==c&&(a.boundingSphere=(new uh).fromJSON(c)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class cy extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=""===this.path?sy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new Tg(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){let i=null;try{i=JSON.parse(n)}catch(_S){return void 0!==r&&r(_S),void console.error("THREE:ObjectLoader: Can't parse "+e+".",_S.message)}const s=i.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);a.parse(i,t)},n,r)}async loadAsync(e,t){const n=""===this.path?sy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Tg(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const a=await r.loadAsync(e,t),i=JSON.parse(a),s=i.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(i)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(l)}),s=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,a,o,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in i)if(i[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),a=await this.parseImagesAsync(e.images),i=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,i),o=this.parseObject(e.object,r,s,i,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new em).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let a=0,i=e.length;a<i;a++){const t=(new ap).fromJSON(e[a],r);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new ly;for(let a=0,i=e.length;a<i;a++){let i;const s=e[a];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":i=r.parse(s);break;default:s.type in Gm?i=Gm[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}i.uuid=s.uuid,void 0!==s.name&&(i.name=s.name),void 0!==s.userData&&(i.userData=s.userData),n[s.uuid]=i}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const a=new iy;a.setTextures(t);for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0===n[i.uuid]&&(n[i.uuid]=a.parse(i)),r[i.uuid]=n[i.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],a=_g.parse(r);t[a.uuid]=a}return t}parseImages(e,t){const n=this,r={};let a;function i(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),a.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:bu(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Eg(t);a=new Lg(n),a.setCrossOrigin(this.crossOrigin);for(let t=0,a=e.length;t<a;t++){const n=e[t],a=n.url;if(Array.isArray(a)){const e=[];for(let t=0,n=a.length;t<n;t++){const n=i(a[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new tp(n.data,n.width,n.height)))}r[n.uuid]=new Ru(e)}else{const e=i(n.url);r[n.uuid]=new Ru(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function a(e){if("string"===typeof e){const n=e,a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(a)}return e.data?{data:bu(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Lg(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],i=r.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=i[t],r=await a(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new tp(r.data,r.width,r.height)))}n[r.uuid]=new Ru(e)}else{const e=await a(r.url);n[r.uuid]=new Ru(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let a=0,i=e.length;a<i;a++){const i=e[a];void 0===i.image&&console.warn('THREE.ObjectLoader: No "image" specified for',i.uuid),void 0===t[i.image]&&console.warn("THREE.ObjectLoader: Undefined image",i.image);const s=t[i.image],o=s.data;let l;Array.isArray(o)?(l=new pA,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new tp:new Du,o&&(l.needsUpdate=!0)),l.source=s,l.uuid=i.uuid,void 0!==i.name&&(l.name=i.name),void 0!==i.mapping&&(l.mapping=n(i.mapping,uy)),void 0!==i.channel&&(l.channel=i.channel),void 0!==i.offset&&l.offset.fromArray(i.offset),void 0!==i.repeat&&l.repeat.fromArray(i.repeat),void 0!==i.center&&l.center.fromArray(i.center),void 0!==i.rotation&&(l.rotation=i.rotation),void 0!==i.wrap&&(l.wrapS=n(i.wrap[0],hy),l.wrapT=n(i.wrap[1],hy)),void 0!==i.format&&(l.format=i.format),void 0!==i.internalFormat&&(l.internalFormat=i.internalFormat),void 0!==i.type&&(l.type=i.type),void 0!==i.colorSpace&&(l.colorSpace=i.colorSpace),void 0!==i.minFilter&&(l.minFilter=n(i.minFilter,dy)),void 0!==i.magFilter&&(l.magFilter=n(i.magFilter,dy)),void 0!==i.anisotropy&&(l.anisotropy=i.anisotropy),void 0!==i.flipY&&(l.flipY=i.flipY),void 0!==i.generateMipmaps&&(l.generateMipmaps=i.generateMipmaps),void 0!==i.premultiplyAlpha&&(l.premultiplyAlpha=i.premultiplyAlpha),void 0!==i.unpackAlignment&&(l.unpackAlignment=i.unpackAlignment),void 0!==i.compareFunction&&(l.compareFunction=i.compareFunction),void 0!==i.userData&&(l.userData=i.userData),r[i.uuid]=l}return r}parseObject(e,t,n,r,a){let i,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,a=e.length;r<a;r++){const a=e[r];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":i=new xA,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new hd(e.background):i.background=u(e.background)),void 0!==e.environment&&(i.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new bA(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new vA(e.fog.color,e.fog.density)),""!==e.fog.name&&(i.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(i.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(i.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&i.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(i.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&i.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":i=new hA(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Zg(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new ty(e.color,e.intensity);break;case"DirectionalLight":i=new ey(e.color,e.intensity),i.target=e.target||"";break;case"PointLight":i=new Jg(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new ny(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Gg(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),i.target=e.target||"";break;case"HemisphereLight":i=new zg(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new ay).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),o=c(e.material),i=new $A(s,o),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),o=c(e.material),i=new $d(s,o);break;case"InstancedMesh":s=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;i=new Ap(s,o,t),i.instanceMatrix=new ip(new Float32Array(n.array),16),void 0!==r&&(i.instanceColor=new ip(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=c(e.material),i=new Qp(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),i.geometry=s,i.perObjectFrustumCulled=e.perObjectFrustumCulled,i.sortObjects=e.sortObjects,i._drawRanges=e.drawRanges,i._reservedRanges=e.reservedRanges,i._geometryInfo=e.geometryInfo.map(e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new Gu).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new uh).fromJSON(e.boundingSphere)),M(M({},e),{},{boundingBox:t,boundingSphere:n})}),i._instanceInfo=e.instanceInfo,i._availableInstanceIds=e._availableInstanceIds,i._availableGeometryIds=e._availableGeometryIds,i._nextIndexStart=e.nextIndexStart,i._nextVertexStart=e.nextVertexStart,i._geometryCount=e.geometryCount,i._maxInstanceCount=e.maxInstanceCount,i._maxVertexCount=e.maxVertexCount,i._maxIndexCount=e.maxIndexCount,i._geometryInitialized=e.geometryInitialized,i._matricesTexture=u(e.matricesTexture.uuid),i._indirectTexture=u(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(i._colorsTexture=u(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(i.boundingSphere=(new uh).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(i.boundingBox=(new Gu).fromJSON(e.boundingBox));break;case"LOD":i=new QA;break;case"Line":i=new Zp(l(e.geometry),c(e.material));break;case"LineLoop":i=new rf(l(e.geometry),c(e.material));break;case"LineSegments":i=new nf(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":i=new uf(l(e.geometry),c(e.material));break;case"Sprite":i=new OA(c(e.material));break;case"Group":i=new mA;break;case"Bone":i=new ep;break;default:i=new Gh}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.up&&i.up.fromArray(e.up),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(i.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)i.add(this.parseObject(s[e],t,n,r,a))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];i.animations.push(a[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance,n.hysteresis)}}return i}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,r=e.getObjectByProperty("uuid",n);t.target=void 0!==r?r:new Gh}})}}const uy={UVMapping:xo,CubeReflectionMapping:wo,CubeRefractionMapping:_o,EquirectangularReflectionMapping:So,EquirectangularRefractionMapping:Co,CubeUVReflectionMapping:Eo},hy={RepeatWrapping:No,ClampToEdgeWrapping:Bo,MirroredRepeatWrapping:ko},dy={NearestFilter:Io,NearestMipmapNearestFilter:To,NearestMipmapLinearFilter:Fo,LinearFilter:Lo,LinearMipmapNearestFilter:Uo,LinearMipmapLinearFilter:Do},Ay=new WeakMap;class py extends Bg{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Cg.get("image-bitmap:".concat(e));if(void 0!==i)return a.manager.itemStart(e),i.then?void i.then(n=>{if(!0!==Ay.has(i))return t&&t(n),a.manager.itemEnd(e),n;r&&r(Ay.get(i)),a.manager.itemError(e),a.manager.itemEnd(e)}):(setTimeout(function(){t&&t(i),a.manager.itemEnd(e)},0),i);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,s.signal="function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const o=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(n){return Cg.add("image-bitmap:".concat(e),n),t&&t(n),a.manager.itemEnd(e),n}).catch(function(t){r&&r(t),Ay.set(o,t),Cg.remove("image-bitmap:".concat(e)),a.manager.itemError(e),a.manager.itemEnd(e)});Cg.add("image-bitmap:".concat(e),o),a.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let fy;class my{static getContext(){return void 0===fy&&(fy=new(window.AudioContext||window.webkitAudioContext)),fy}static setContext(e){fy=e}}class gy extends Bg{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new Tg(this.manager);function s(t){r?r(t):console.error(t),a.manager.itemError(e)}i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(e){try{const n=e.slice(0);my.getContext().decodeAudioData(n,function(e){t(e)}).catch(s)}catch(n){s(n)}},n,r)}}const yy=new vh,vy=new vh,by=new vh;class xy{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new hA,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new hA,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,by.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,a=t.near*Math.tan(nu*t.fov*.5)/t.zoom;let i,s;vy.elements[12]=-n,yy.elements[12]=n,i=-a*t.aspect+r,s=a*t.aspect+r,by.elements[0]=2*t.near/(s-i),by.elements[8]=(s+i)/(s-i),this.cameraL.projectionMatrix.copy(by),i=-a*t.aspect-r,s=a*t.aspect-r,by.elements[0]=2*t.near/(s-i),by.elements[8]=(s+i)/(s-i),this.cameraR.projectionMatrix.copy(by)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vy),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(yy)}}class wy extends hA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class _y{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Sy=new Au,Cy=new du,Ey=new Au,Ny=new Au,By=new Au;class ky extends Gh{constructor(){super(),this.type="AudioListener",this.context=my.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _y}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sy,Cy,Ey),Ny.set(0,0,-1).applyQuaternion(Cy),By.set(0,1,0).applyQuaternion(Cy),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Sy.x,e),t.positionY.linearRampToValueAtTime(Sy.y,e),t.positionZ.linearRampToValueAtTime(Sy.z,e),t.forwardX.linearRampToValueAtTime(Ny.x,e),t.forwardY.linearRampToValueAtTime(Ny.y,e),t.forwardZ.linearRampToValueAtTime(Ny.z,e),t.upX.linearRampToValueAtTime(By.x,e),t.upY.linearRampToValueAtTime(By.y,e),t.upZ.linearRampToValueAtTime(By.z,e)}else t.setPosition(Sy.x,Sy.y,Sy.z),t.setOrientation(Ny.x,Ny.y,Ny.z,By.x,By.y,By.z)}}class Iy extends Gh{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Ty=new Au,My=new du,Fy=new Au,Ry=new Au;class Ly extends Iy{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ty,My,Fy),Ry.set(0,0,1).applyQuaternion(My);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ty.x,e),t.positionY.linearRampToValueAtTime(Ty.y,e),t.positionZ.linearRampToValueAtTime(Ty.z,e),t.orientationX.linearRampToValueAtTime(Ry.x,e),t.orientationY.linearRampToValueAtTime(Ry.y,e),t.orientationZ.linearRampToValueAtTime(Ry.z,e)}else t.setPosition(Ty.x,Ty.y,Ty.z),t.setOrientation(Ry.x,Ry.y,Ry.z)}}class Uy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Py{constructor(e,t,n){let r,a,i;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,a=this._slerpAdditive,i=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,i=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,a=this._lerpAdditive,i=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=i,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,a=e*r+r;let i=this.cumulativeWeight;if(0===i){for(let e=0;e!==r;++e)n[a+e]=n[e];i=t}else{i+=t;const e=t/i;this._mixBufferRegion(n,a,0,e,r)}this.cumulativeWeight=i}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,a=this.cumulativeWeight,i=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-a,t)}i>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(n[o]!==n[o+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let a=n,i=r;a!==i;++a)t[a]=t[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,a){if(r>=.5)for(let i=0;i!==a;++i)e[t+i]=e[n+i]}_slerp(e,t,n,r){du.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,a){const i=this._workIndex*a;du.multiplyQuaternionsFlat(e,i,e,t,e,n),du.slerpFlat(e,t,e,t,e,i,r)}_lerp(e,t,n,r,a){const i=1-r;for(let s=0;s!==a;++s){const a=t+s;e[a]=e[a]*i+e[n+s]*r}}_lerpAdditive(e,t,n,r,a){for(let i=0;i!==a;++i){const a=t+i;e[a]=e[a]+e[n+i]*r}}}const Dy="\\[\\]\\.:\\/",Oy=new RegExp("["+Dy+"]","g"),zy="[^"+Dy+"]",Hy="[^"+Dy.replace("\\.","")+"]",jy=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",zy)+/(WCOD+)?/.source.replace("WCOD",Hy)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zy)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zy)+"$"),Qy=["material","materials","bones","map"];class Vy{constructor(e,t,n){this.path=t,this.parsedPath=n||Vy.parseTrackName(t),this.node=Vy.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Vy.Composite(e,t,n):new Vy(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Oy,"")}static parseTrackName(e){const t=jy.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Qy.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const a=e[r];if(a.name===t||a.uuid===t)return a;const i=n(a.children);if(i)return i}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let a=t.propertyIndex;if(e||(e=Vy.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const i=e[r];if(void 0===i){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?s=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[a]&&(a=e.morphTargetDictionary[a])}o=this.BindingType.ArrayElement,this.resolvedProperty=i,this.propertyIndex=a}else void 0!==i.fromArray&&void 0!==i.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=i):Array.isArray(i)?(o=this.BindingType.EntireArray,this.resolvedProperty=i):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Vy.Composite=class{constructor(e,t,n){const r=n||Vy.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Vy.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Vy.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Vy.prototype.GetterByBindingType=[Vy.prototype._getValue_direct,Vy.prototype._getValue_array,Vy.prototype._getValue_arrayElement,Vy.prototype._getValue_toArray],Vy.prototype.SetterByBindingTypeAndVersioning=[[Vy.prototype._setValue_direct,Vy.prototype._setValue_direct_setNeedsUpdate,Vy.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vy.prototype._setValue_array,Vy.prototype._setValue_array_setNeedsUpdate,Vy.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vy.prototype._setValue_arrayElement,Vy.prototype._setValue_arrayElement_setNeedsUpdate,Vy.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vy.prototype._setValue_fromArray,Vy.prototype._setValue_fromArray_setNeedsUpdate,Vy.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Wy{constructor(){this.isAnimationObjectGroup=!0,this.uuid=au(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,a=this._bindings,i=a.length;let s,o=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(u);for(let e=0,t=i;e!==t;++e)a[e].push(new Vy(u,n[e],r[e]))}else if(d<l){s=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[h]=o,e[o]=u;for(let e=0,t=i;e!==t;++e){const t=a[e],i=t[o];let s=t[d];t[d]=i,void 0===s&&(s=new Vy(u,n[e],r[e])),t[o]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let a=this.nCachedObjects_;for(let i=0,s=arguments.length;i!==s;++i){const s=arguments[i],o=s.uuid,l=t[o];if(void 0!==l&&l>=a){const i=a++,c=e[i];t[c.uuid]=l,e[l]=c,t[o]=i,e[i]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[i],a=t[l];t[l]=r,t[i]=a}}}this.nCachedObjects_=a}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let a=this.nCachedObjects_,i=e.length;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<a){const s=--a,o=e[s],c=--i,u=e[c];t[o.uuid]=l,e[l]=o,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],a=t[c];t[l]=r,t[s]=a,t.pop()}}else{const a=--i,s=e[a];a>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[a],t.pop()}}}this.nCachedObjects_=a}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const a=this._bindings;if(void 0!==r)return a[r];const i=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,u=new Array(l);r=a.length,n[e]=r,i.push(e),s.push(t),a.push(u);for(let h=c,d=o.length;h!==d;++h){const n=o[h];u[h]=new Vy(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,a=this._parsedPaths,i=this._bindings,s=i.length-1,o=i[s];t[e[s]]=n,i[n]=o,i.pop(),a[n]=a[s],a.pop(),r[n]=r[s],r.pop()}}}class Gy{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const a=t.tracks,i=a.length,s=new Array(i),o={endingStart:ql,endingEnd:ql};for(let l=0;l!==i;++l){const e=a[l].createInterpolant(null);s[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ql,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,r=e._clip.duration,a=r/n,i=n/r;e.warp(1,a,t),this.warp(i,1,t)}return this}crossFadeTo(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,a=r.time,i=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=a,o[1]=a+n,l[0]=e/i,l[1]=t/i,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(null!==a){const r=(e-a)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const i=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Zl)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(i),t[n].accumulateAdditive(s);else for(let n=0,a=e.length;n!==a;++n)e[n].evaluate(i),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,a=this._loopCount;const i=n===Vl;if(0===e)return-1===a?r:i&&1===(1&a)?t-r:r;if(n===jl){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,a+=Math.abs(n);const s=this.repetitions-a;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,i)}else this._setEndings(!1,!1,i);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(i&&1===(1&a))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Xl,r.endingEnd=Xl):(r.endingStart=e?this.zeroSlopeAtStart?Xl:ql:Yl,r.endingEnd=t?this.zeroSlopeAtEnd?Xl:ql:Yl)}_scheduleFading(e,t,n){const r=this._mixer,a=r.time;let i=this._weightInterpolant;null===i&&(i=r._lendControlInterpolant(),this._weightInterpolant=i);const s=i.parameterPositions,o=i.sampleValues;return s[0]=a,o[0]=t,s[1]=a+e,o[1]=n,this}}const Ky=new Float32Array(1);class qy extends $c{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,a=r.length,i=e._propertyBindings,s=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let u=0;u!==a;++u){const e=r[u],a=e.name;let l=c[a];if(void 0!==l)++l.referenceCount,i[u]=l;else{if(l=i[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,a));continue}const r=t&&t._propertyBindings[u].binding.parsedPath;l=new Py(Vy.create(n,a,r),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,a),i[u]=l}s[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,a=this._actionsByClip;let i=a[t];if(void 0===i)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=i;else{const t=i.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),i.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,i=this._actionsByClip,s=i[a],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete i[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,a=this._bindings;let i=r[t];void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,a=n.path,i=this._bindingsByRootAndName,s=i[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[a],0===Object.keys(s).length&&delete i[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Ag(new Float32Array(2),new Float32Array(2),1,Ky),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=n,t[n]=a}clipAction(e,t,n){const r=t||this._root,a=r.uuid;let i="string"===typeof e?_g.findByName(r,e):e;const s=null!==i?i.uuid:e,o=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==i?i.blendMode:Jl),void 0!==o){const e=o.actionByRoot[a];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===i&&(i=l._clip)}if(null===i)return null;const c=new Gy(this,i,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,a),c}existingAction(e,t){const n=t||this._root,r=n.uuid,a="string"===typeof e?_g.findByName(n,e):e,i=a?a.uuid:e,s=this._actionsByClip[i];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),i=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(r,e,a,i)}const s=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)s[l].apply(i);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,a=r[n];if(void 0!==a){const e=a.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const a=r._cacheIndex,i=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,i._cacheIndex=a,t[a]=i,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const e=n[a].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const a in r){const e=r[a];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Xy extends zu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Vu(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Yy{constructor(e){this.value=e}clone(){return new Yy(void 0===this.value.clone?this.value:this.value.clone())}}let Jy=0;class Zy extends $c{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Jy++}),this.name="",this.usage=Pc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class $y extends wA{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class ev{constructor(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=a,this.normalized=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const tv=new vh;class nv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new yh(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Ih,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return tv.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(tv),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return av(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(rv),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let r=0,a=e.length;r<a;r++)av(e[r],this,n,t);return n.sort(rv),n}}function rv(e,t){return e.distance-t.distance}function av(e,t,n,r){let a=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(a=!1)}if(!0===a&&!0===r){const r=e.children;for(let e=0,a=r.length;e<a;e++)av(r[e],t,n,!0)}}class iv{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=sv.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function sv(){!1===this._document.hidden&&this.reset()}class ov{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=iu(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(iu(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}class cv{constructor(e,t,n,r){cv.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const a=this.elements;return a[0]=e,a[2]=t,a[1]=n,a[3]=r,this}}const uv=new hu;class hv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hu(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=uv.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,uv).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const dv=new Au,Av=new Au,pv=new Au,fv=new Au,mv=new Au,gv=new Au,yv=new Au;class vv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){dv.subVectors(e,this.start),Av.subVectors(this.end,this.start);const n=Av.dot(Av);let r=Av.dot(dv)/n;return t&&(r=iu(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}distanceSqToLine3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yv;const r=1e-8*1e-8;let a,i;const s=this.start,o=e.start,l=this.end,c=e.end;pv.subVectors(l,s),fv.subVectors(c,o),mv.subVectors(s,o);const u=pv.dot(pv),h=fv.dot(fv),d=fv.dot(mv);if(u<=r&&h<=r)return t.copy(s),n.copy(o),t.sub(n),t.dot(t);if(u<=r)a=0,i=d/h,i=iu(i,0,1);else{const e=pv.dot(mv);if(h<=r)i=0,a=iu(-e/u,0,1);else{const t=pv.dot(fv),n=u*h-t*t;a=0!==n?iu((t*d-e*h)/n,0,1):0,i=(t*a+d)/h,i<0?(i=0,a=iu(-e/u,0,1)):i>1&&(i=1,a=iu((t-e)/u,0,1))}}return t.copy(s).add(pv.multiplyScalar(a)),n.copy(o).add(fv.multiplyScalar(i)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const bv=new Au;class xv extends Gh{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Hd,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let i=0,s=1,o=32;i<o;i++,s++){const e=i/o*Math.PI*2,t=s/o*Math.PI*2;r.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Fd(r,3));const a=new Vp({fog:!1,toneMapped:!1});this.cone=new nf(n,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),bv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(bv),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const wv=new Au,_v=new vh,Sv=new vh;class Cv extends nf{constructor(e){const t=Ev(e),n=new Hd,r=[],a=[];for(let o=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),a.push(0,0,0),a.push(0,0,0))}n.setAttribute("position",new Fd(r,3)),n.setAttribute("color",new Fd(a,3));super(n,new Vp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const i=new hd(255),s=new hd(65280);this.setColors(i,s)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Sv.copy(this.root.matrixWorld).invert();for(let a=0,i=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(_v.multiplyMatrices(Sv,e.matrixWorld),wv.setFromMatrixPosition(_v),r.setXYZ(i,wv.x,wv.y,wv.z),_v.multiplyMatrices(Sv,e.parent.matrixWorld),wv.setFromMatrixPosition(_v),r.setXYZ(i+1,wv.x,wv.y,wv.z),i+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let r=0;r<n.count;r+=2)n.setXYZ(r,e.r,e.g,e.b),n.setXYZ(r+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ev(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...Ev(e.children[n]));return t}class Nv extends $d{constructor(e,t,n){super(new Om(t,4,2),new fd({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Bv=new Au,kv=new hd,Iv=new hd;class Tv extends Gh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Lm(t);r.rotateY(.5*Math.PI),this.material=new fd({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const a=r.getAttribute("position"),i=new Float32Array(3*a.count);r.setAttribute("color",new Sd(i,3)),this.add(new $d(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");kv.copy(this.light.color),Iv.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?kv:Iv;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Bv.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Mv extends nf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new hd(n),r=new hd(r);const a=t/2,i=e/t,s=e/2,o=[],l=[];for(let u=0,h=0,d=-s;u<=t;u++,d+=i){o.push(-s,0,d,s,0,d),o.push(d,0,-s,d,0,s);const e=u===a?n:r;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const c=new Hd;c.setAttribute("position",new Fd(o,3)),c.setAttribute("color",new Fd(l,3));super(c,new Vp({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Fv extends nf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;a=new hd(a),i=new hd(i);const s=[],o=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),r=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(r,0,l);const u=1&c?a:i;o.push(u.r,u.g,u.b),o.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?a:i,l=e-e/n*c;for(let e=0;e<r;e++){let n=e/r*(2*Math.PI),a=Math.sin(n)*l,i=Math.cos(n)*l;s.push(a,0,i),o.push(t.r,t.g,t.b),n=(e+1)/r*(2*Math.PI),a=Math.sin(n)*l,i=Math.cos(n)*l,s.push(a,0,i),o.push(t.r,t.g,t.b)}}const l=new Hd;l.setAttribute("position",new Fd(s,3)),l.setAttribute("color",new Fd(o,3));super(l,new Vp({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Rv=new Au,Lv=new Au,Uv=new Au;class Pv extends Gh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Hd;r.setAttribute("position",new Fd([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const a=new Vp({fog:!1,toneMapped:!1});this.lightPlane=new Zp(r,a),this.add(this.lightPlane),r=new Hd,r.setAttribute("position",new Fd([0,0,0,0,0,1],3)),this.targetLine=new Zp(r,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Rv.setFromMatrixPosition(this.light.matrixWorld),Lv.setFromMatrixPosition(this.light.target.matrixWorld),Uv.subVectors(Lv,Rv),this.lightPlane.lookAt(Lv),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Lv),this.targetLine.scale.z=Uv.length()}}const Dv=new Au,Ov=new oA;class zv extends nf{constructor(e){const t=new Hd,n=new Vp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],a=[],i={};function s(e,t){o(e),o(t)}function o(e){r.push(0,0,0),a.push(0,0,0),void 0===i[e]&&(i[e]=[]),i[e].push(r.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new Fd(r,3)),t.setAttribute("color",new Fd(a,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update();const l=new hd(16755200),c=new hd(16711680),u=new hd(43775),h=new hd(16777215),d=new hd(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,r,a){const i=this.geometry.getAttribute("color");return i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,r.r,r.g,r.b),i.setXYZ(39,r.r,r.g,r.b),i.setXYZ(40,a.r,a.g,a.b),i.setXYZ(41,a.r,a.g,a.b),i.setXYZ(42,a.r,a.g,a.b),i.setXYZ(43,a.r,a.g,a.b),i.setXYZ(44,a.r,a.g,a.b),i.setXYZ(45,a.r,a.g,a.b),i.setXYZ(46,a.r,a.g,a.b),i.setXYZ(47,a.r,a.g,a.b),i.setXYZ(48,a.r,a.g,a.b),i.setXYZ(49,a.r,a.g,a.b),i.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,r;if(Ov.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,r=0;else if(this.camera.coordinateSystem===qc)n=-1,r=1;else{if(this.camera.coordinateSystem!==Xc)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,r=1}Hv("c",t,e,Ov,0,0,n),Hv("t",t,e,Ov,0,0,r),Hv("n1",t,e,Ov,-1,-1,n),Hv("n2",t,e,Ov,1,-1,n),Hv("n3",t,e,Ov,-1,1,n),Hv("n4",t,e,Ov,1,1,n),Hv("f1",t,e,Ov,-1,-1,r),Hv("f2",t,e,Ov,1,-1,r),Hv("f3",t,e,Ov,-1,1,r),Hv("f4",t,e,Ov,1,1,r),Hv("u1",t,e,Ov,.7,1.1,n),Hv("u2",t,e,Ov,-.7,1.1,n),Hv("u3",t,e,Ov,0,2,n),Hv("cf1",t,e,Ov,-1,0,r),Hv("cf2",t,e,Ov,1,0,r),Hv("cf3",t,e,Ov,0,-1,r),Hv("cf4",t,e,Ov,0,1,r),Hv("cn1",t,e,Ov,-1,0,n),Hv("cn2",t,e,Ov,1,0,n),Hv("cn3",t,e,Ov,0,-1,n),Hv("cn4",t,e,Ov,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Hv(e,t,n,r,a,i,s){Dv.set(a,i,s).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Dv.x,Dv.y,Dv.z)}}const jv=new Gu;class Qv extends nf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),a=new Hd;a.setIndex(new Sd(n,1)),a.setAttribute("position",new Sd(r,3)),super(a,new Vp({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&jv.setFromObject(this.object),jv.isEmpty())return;const e=jv.min,t=jv.max,n=this.geometry.attributes.position,r=n.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Vv extends nf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Hd;r.setIndex(new Sd(n,1)),r.setAttribute("position",new Fd([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Vp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Wv extends Zp{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,r=new Hd;r.setAttribute("position",new Fd([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Vp({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=new Hd;a.setAttribute("position",new Fd([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new $d(a,new fd({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Gv=new Au;let Kv,qv;class Xv extends Gh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Au(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Au(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*a;super(),this.type="ArrowHelper",void 0===Kv&&(Kv=new Hd,Kv.setAttribute("position",new Fd([0,0,0,0,1,0],3)),qv=new Sf(.5,1,5,1),qv.translate(0,-.5,0)),this.position.copy(t),this.line=new Zp(Kv,new Vp({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new $d(qv,new fd({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,a,i)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Gv.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Gv,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Yv extends nf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Hd;n.setAttribute("position",new Fd(t,3)),n.setAttribute("color",new Fd([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Vp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new hd,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Jv{constructor(){this.type="ShapePath",this.color=new hd,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new $f,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,a,i){return this.currentPath.bezierCurveTo(e,t,n,r,a,i),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let a=n-1,i=0;i<n;a=i++){let n=t[a],s=t[i],o=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[i],o=-o,s=t[a],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const n=Bm.isClockWise,r=this.subPaths;if(0===r.length)return[];let a,i,s;const o=[];if(1===r.length)return i=r[0],s=new em,s.curves=i.curves,o.push(s),o;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,A=[],p=0;u[p]=void 0,A[p]=[];for(let f=0,m=r.length;f<m;f++)i=r[f],h=i.getPoints(),a=n(h),a=e?!a:a,a?(!l&&u[p]&&p++,u[p]={s:new em,p:h},u[p].s.curves=i.curves,l&&p++,A[p]=[]):A[p].push({h:i,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],a=new em;a.curves=r.curves,t.push(a)}return t}(r);if(u.length>1){let e=!1,n=0;for(let t=0,r=u.length;t<r;t++)c[t]=[];for(let r=0,a=u.length;r<a;r++){const a=A[r];for(let i=0;i<a.length;i++){const s=a[i];let o=!0;for(let a=0;a<u.length;a++)t(s.p,u[a].p)&&(r!==a&&n++,o?(o=!1,c[a].push(s)):e=!0);o&&c[r].push(s)}}n>0&&!1===e&&(A=c)}for(let f=0,m=u.length;f<m;f++){s=u[f].s,o.push(s),d=A[f];for(let e=0,t=d.length;e<t;e++)s.holes.push(d[e].h)}return o}}class Zv extends $c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function $v(e,t,n,r){const a=function(e){switch(e){case zo:case Ho:return{byteLength:1,components:1};case Qo:case jo:case Ko:return{byteLength:2,components:1};case qo:case Xo:return{byteLength:2,components:4};case Wo:case Vo:case Go:return{byteLength:4,components:1};case Jo:case Zo:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(e,"."))}(r);switch(n){case $o:return e*t;case al:case il:return e*t/a.components*a.byteLength;case sl:case ol:return e*t*2/a.components*a.byteLength;case el:return e*t*3/a.components*a.byteLength;case tl:case cl:return e*t*4/a.components*a.byteLength;case ul:case hl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case dl:case Al:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case fl:case gl:return Math.max(e,16)*Math.max(t,8)/4;case pl:case ml:return Math.max(e,8)*Math.max(t,8)/2;case yl:case vl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case bl:case xl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case wl:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case _l:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case Sl:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case Cl:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case El:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case Nl:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Bl:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case kl:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Il:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Tl:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Ml:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Fl:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Rl:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case Ll:case Ul:case Pl:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Dl:case Ol:return Math.ceil(e/4)*Math.ceil(t/4)*8;case zl:case Hl:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}class eb{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,r){return $v(e,t,n,r)}}function tb(){let e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function nb(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const a=t.get(n);if(void 0===a)t.set(n,function(t,n){const r=t.array,a=t.usage,i=r.byteLength,s=e.createBuffer();let o;if(e.bindBuffer(n,s),e.bufferData(n,r,a),t.onUploadCallback(),r instanceof Float32Array)o=e.FLOAT;else if("undefined"!==typeof Float16Array&&r instanceof Float16Array)o=e.HALF_FLOAT;else if(r instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=e.SHORT;else if(r instanceof Uint32Array)o=e.UNSIGNED_INT;else if(r instanceof Int32Array)o=e.INT;else if(r instanceof Int8Array)o=e.BYTE;else if(r instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=e.UNSIGNED_BYTE}return{buffer:s,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:i}}(n,r));else if(a.version<n.version){if(a.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const a=n.array,i=n.updateRanges;if(e.bindBuffer(r,t),0===i.length)e.bufferSubData(r,0,a);else{i.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<i.length;e++){const n=i[t],r=i[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,i[t]=r)}i.length=t+1;for(let n=0,s=i.length;n<s;n++){const t=i[n];e.bufferSubData(r,t.start*a.BYTES_PER_ELEMENT,a,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(a.buffer,n,r),a.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:As}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=As);const rb={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare, distribution.x );\n\t\t#endif\n\t\tif ( hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ab={common:{diffuse:{value:new hd(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new mu},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new mu}},envmap:{envMap:{value:null},envMapRotation:{value:new mu},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new mu}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new mu}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new mu},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new mu},normalScale:{value:new hu(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new mu},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new mu}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new mu}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new mu}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new hd(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new hd(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0},uvTransform:{value:new mu}},sprite:{diffuse:{value:new hd(16777215)},opacity:{value:1},center:{value:new hu(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new mu},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0}}},ib={basic:{uniforms:rA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.fog]),vertexShader:rb.meshbasic_vert,fragmentShader:rb.meshbasic_frag},lambert:{uniforms:rA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,ab.lights,{emissive:{value:new hd(0)}}]),vertexShader:rb.meshlambert_vert,fragmentShader:rb.meshlambert_frag},phong:{uniforms:rA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,ab.lights,{emissive:{value:new hd(0)},specular:{value:new hd(1118481)},shininess:{value:30}}]),vertexShader:rb.meshphong_vert,fragmentShader:rb.meshphong_frag},standard:{uniforms:rA([ab.common,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.roughnessmap,ab.metalnessmap,ab.fog,ab.lights,{emissive:{value:new hd(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rb.meshphysical_vert,fragmentShader:rb.meshphysical_frag},toon:{uniforms:rA([ab.common,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.gradientmap,ab.fog,ab.lights,{emissive:{value:new hd(0)}}]),vertexShader:rb.meshtoon_vert,fragmentShader:rb.meshtoon_frag},matcap:{uniforms:rA([ab.common,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,{matcap:{value:null}}]),vertexShader:rb.meshmatcap_vert,fragmentShader:rb.meshmatcap_frag},points:{uniforms:rA([ab.points,ab.fog]),vertexShader:rb.points_vert,fragmentShader:rb.points_frag},dashed:{uniforms:rA([ab.common,ab.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rb.linedashed_vert,fragmentShader:rb.linedashed_frag},depth:{uniforms:rA([ab.common,ab.displacementmap]),vertexShader:rb.depth_vert,fragmentShader:rb.depth_frag},normal:{uniforms:rA([ab.common,ab.bumpmap,ab.normalmap,ab.displacementmap,{opacity:{value:1}}]),vertexShader:rb.meshnormal_vert,fragmentShader:rb.meshnormal_frag},sprite:{uniforms:rA([ab.sprite,ab.fog]),vertexShader:rb.sprite_vert,fragmentShader:rb.sprite_frag},background:{uniforms:{uvTransform:{value:new mu},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:rb.background_vert,fragmentShader:rb.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new mu}},vertexShader:rb.backgroundCube_vert,fragmentShader:rb.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:rb.cube_vert,fragmentShader:rb.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rb.equirect_vert,fragmentShader:rb.equirect_frag},distanceRGBA:{uniforms:rA([ab.common,ab.displacementmap,{referencePosition:{value:new Au},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rb.distanceRGBA_vert,fragmentShader:rb.distanceRGBA_frag},shadow:{uniforms:rA([ab.lights,ab.fog,{color:{value:new hd(0)},opacity:{value:1}}]),vertexShader:rb.shadow_vert,fragmentShader:rb.shadow_frag}};ib.physical={uniforms:rA([ib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new mu},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new mu},clearcoatNormalScale:{value:new hu(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new mu},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new mu},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new mu},sheen:{value:0},sheenColor:{value:new hd(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new mu},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new mu},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new mu},transmissionSamplerSize:{value:new hu},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new mu},attenuationDistance:{value:0},attenuationColor:{value:new hd(0)},specularColor:{value:new hd(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new mu},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new mu},anisotropyVector:{value:new hu},anisotropyMap:{value:null},anisotropyMapTransform:{value:new mu}}]),vertexShader:rb.meshphysical_vert,fragmentShader:rb.meshphysical_frag};const sb={r:0,b:0,g:0},ob=new kh,lb=new vh;function cb(e,t,n,r,a,i,s){const o=new hd(0);let l,c,u=!0===i?0:1,h=null,d=0,A=null;function p(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function f(t,n){t.getRGB(sb,aA(e)),r.buffers.color.setClear(sb.r,sb.g,sb.b,n,s)}return{getClearColor:function(){return o},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o.set(e),u=t,f(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(o,u)},render:function(t){let n=!1;const a=p(t);null===a?f(o,u):a&&a.isColor&&(f(a,1),n=!0);const i=e.xr.getEnvironmentBlendMode();"additive"===i?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===i&&r.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=p(n);r&&(r.isCubeTexture||r.mapping===Eo)?(void 0===c&&(c=new $d(new tA(1,1,1),new sA({name:"BackgroundCubeMaterial",uniforms:nA(ib.backgroundCube.uniforms),vertexShader:ib.backgroundCube.vertexShader,fragmentShader:ib.backgroundCube.fragmentShader,side:Cs,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(c)),ob.copy(n.backgroundRotation),ob.x*=-1,ob.y*=-1,ob.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(ob.y*=-1,ob.z*=-1),c.material.uniforms.envMap.value=r,c.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(lb.makeRotationFromEuler(ob)),c.material.toneMapped=Bu.getTransfer(r.colorSpace)!==dc,h===r&&d===r.version&&A===e.toneMapping||(c.material.needsUpdate=!0,h=r,d=r.version,A=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new $d(new Um(2,2),new sA({name:"BackgroundMaterial",uniforms:nA(ib.background.uniforms),vertexShader:ib.background.vertexShader,fragmentShader:ib.background.fragmentShader,side:Ss,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Bu.getTransfer(r.colorSpace)!==dc,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&d===r.version&&A===e.toneMapping||(l.material.needsUpdate=!0,h=r,d=r.version,A=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function ub(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},a=c(null);let i=a,s=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],r=[],a=[];for(let i=0;i<n;i++)t[i]=0,r[i]=0,a[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:a,object:e,attributes:{},index:null}}function u(){const e=i.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const r=i.newAttributes,a=i.enabledAttributes,s=i.attributeDivisors;r[t]=1,0===a[t]&&(e.enableVertexAttribArray(t),a[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function A(){const t=i.newAttributes,n=i.enabledAttributes;for(let r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,r,a,i,s,o){!0===o?e.vertexAttribIPointer(t,n,r,i,s):e.vertexAttribPointer(t,n,r,a,i,s)}function f(){m(),s=!0,i!==a&&(i=a,o(i.object))}function m(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:function(n,a,l,f,m){let g=!1;const y=function(t,n,a){const i=!0===a.wireframe;let s=r[t.id];void 0===s&&(s={},r[t.id]=s);let o=s[n.id];void 0===o&&(o={},s[n.id]=o);let l=o[i];void 0===l&&(l=c(e.createVertexArray()),o[i]=l);return l}(f,l,a);i!==y&&(i=y,o(i.object)),g=function(e,t,n,r){const a=i.attributes,s=t.attributes;let o=0;const l=n.getAttributes();for(const i in l){if(l[i].location>=0){const t=a[i];let n=s[i];if(void 0===n&&("instanceMatrix"===i&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return i.attributesNum!==o||i.index!==r}(n,f,l,m),g&&function(e,t,n,r){const a={},s=t.attributes;let o=0;const l=n.getAttributes();for(const i in l){if(l[i].location>=0){let t=s[i];void 0===t&&("instanceMatrix"===i&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===i&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),a[i]=n,o++}}i.attributes=a,i.attributesNum=o,i.index=r}(n,f,l,m),null!==m&&t.update(m,e.ELEMENT_ARRAY_BUFFER),(g||s)&&(s=!1,function(n,r,a,i){u();const s=i.attributes,o=a.getAttributes(),l=r.defaultAttributeValues;for(const c in o){const r=o[c];if(r.location>=0){let a=s[c];if(void 0===a&&("instanceMatrix"===c&&n.instanceMatrix&&(a=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(a=n.instanceColor)),void 0!==a){const s=a.normalized,o=a.itemSize,l=t.get(a);if(void 0===l)continue;const c=l.buffer,u=l.type,A=l.bytesPerElement,f=u===e.INT||u===e.UNSIGNED_INT||a.gpuType===Vo;if(a.isInterleavedBufferAttribute){const t=a.data,l=t.stride,m=a.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)d(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,o/r.locationSize,u,s,l*A,(m+o/r.locationSize*e)*A,f)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)d(r.location+e,a.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,o/r.locationSize,u,s,o*A,o/r.locationSize*e*A,f)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}A()}(n,a,l,f),null!==m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(m).buffer))},reset:f,resetDefaultState:m,dispose:function(){f();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const a=n[e.id];for(const e in a)l(a[e].object),delete a[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:A}}function hb(e,t,n){let r;function a(t,a,i){0!==i&&(e.drawArraysInstanced(r,t,a,i),n.update(a,r,i))}this.setMode=function(e){r=e},this.render=function(t,a){e.drawArrays(r,t,a),n.update(a,r,1)},this.renderInstances=a,this.renderMultiDraw=function(e,a,i){if(0===i)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,a,0,i);let s=0;for(let t=0;t<i;t++)s+=a[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,i,s,o){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)a(e[t],i[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,i,0,o,0,s);let t=0;for(let e=0;e<s;e++)t+=i[e]*o[e];n.update(t,r,1)}}}function db(e,t,n,r){let a;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const o=i(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==a)return a;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");a=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a},getMaxPrecision:i,textureFormatReadable:function(t){return t===tl||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const a=n===Ko&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==zo&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Go&&!a)},precision:s,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function Ab(e){const t=this;let n=null,r=0,a=!1,i=!1;const s=new gp,o=new mu,l={value:null,needsUpdate:!1};function c(e,n,r,a){const i=null!==e?e.length:0;let c=null;if(0!==i){if(c=l.value,!0!==a||null===c){const t=r+4*i,a=n.matrixWorldInverse;o.getNormalMatrix(a),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=r;n!==i;++n,l+=4)s.copy(e[n]).applyMatrix4(a,o),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||a;return a=t,r=e.length,n},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,o,u){const h=s.clippingPlanes,d=s.clipIntersection,A=s.clipShadows,p=e.get(s);if(!a||null===h||0===h.length||i&&!A)i?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=i?0:r,t=4*e;let a=p.clippingState||null;l.value=a,a=c(h,o,t,u);for(let r=0;r!==t;++r)a[r]=n[r];p.clippingState=a,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function pb(e){let t=new WeakMap;function n(e,t){return t===So?e.mapping=wo:t===Co&&(e.mapping=_o),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){const i=a.mapping;if(i===So||i===Co){if(t.has(a)){return n(t.get(a).texture,a.mapping)}{const i=a.image;if(i&&i.height>0){const s=new fA(i.height);return s.fromEquirectangularTexture(e,a),t.set(a,s),a.addEventListener("dispose",r),n(s.texture,a.mapping)}return null}}}return a},dispose:function(){t=new WeakMap}}}const fb=[.125,.215,.35,.446,.526,.582],mb=20,gb=new Zg,yb=new hd;let vb=null,bb=0,xb=0,wb=!1;const _b=(1+Math.sqrt(5))/2,Sb=1/_b,Cb=[new Au(-_b,Sb,0),new Au(_b,Sb,0),new Au(-Sb,0,_b),new Au(Sb,0,_b),new Au(0,_b,-Sb),new Au(0,_b,Sb),new Au(-1,1,-1),new Au(1,1,-1),new Au(-1,1,1),new Au(1,1,1)],Eb=new Au;class Nb{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:i=256,position:s=Eb}=a;vb=this._renderer.getRenderTarget(),bb=this._renderer.getActiveCubeFace(),xb=this._renderer.getActiveMipmapLevel(),wb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(i);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,r,o,s),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Tb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ib(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(vb,bb,xb),this._renderer.xr.enabled=wb,e.scissorTest=!1,kb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===wo||e.mapping===_o?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),vb=this._renderer.getRenderTarget(),bb=this._renderer.getActiveCubeFace(),xb=this._renderer.getActiveMipmapLevel(),wb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Lo,minFilter:Lo,generateMipmaps:!1,type:Ko,format:tl,colorSpace:uc,depthBuffer:!1},r=Bb(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Bb(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let a=e;const i=e-4+1+fb.length;for(let s=0;s<i;s++){const i=Math.pow(2,a);n.push(i);let o=1/i;s>e-4?o=fb[s-e+4-1]:0===s&&(o=0),r.push(o);const l=1/(i-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,A=6,p=3,f=2,m=1,g=new Float32Array(p*A*d),y=new Float32Array(f*A*d),v=new Float32Array(m*A*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,p*A*e),y.set(h,f*A*e);const a=[e,e,e,e,e,e];v.set(a,m*A*e)}const b=new Hd;b.setAttribute("position",new Sd(g,p)),b.setAttribute("uv",new Sd(y,f)),b.setAttribute("faceIndex",new Sd(v,m)),t.push(b),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(mb),a=new Au(0,1,0),i=new sA({name:"SphericalGaussianBlur",defines:{n:mb,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Ns,depthTest:!1,depthWrite:!1});return i}(r,e,t)}return r}_compileMaterial(e){const t=new $d(this._lodPlanes[0],e);this._renderer.compile(t,gb)}_sceneToCubeUV(e,t,n,r,a){const i=new hA(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(yb),l.toneMapping=uo,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(r),l.clearDepth(),l.setRenderTarget(null));const h=new fd({name:"PMREM.Background",side:Cs,depthWrite:!1,depthTest:!1}),d=new $d(new tA,h);let A=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,A=!0):(h.color.copy(yb),A=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(i.up.set(0,s[f],0),i.position.set(a.x,a.y,a.z),i.lookAt(a.x+o[f],a.y,a.z)):1===t?(i.up.set(0,0,s[f]),i.position.set(a.x,a.y,a.z),i.lookAt(a.x,a.y+o[f],a.z)):(i.up.set(0,s[f],0),i.position.set(a.x,a.y,a.z),i.lookAt(a.x,a.y,a.z+o[f]));const n=this._cubeSize;kb(r,t*n,f>2?n:0,n,n),l.setRenderTarget(r),A&&l.render(d,i),l.render(e,i)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===wo||e.mapping===_o;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Tb()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ib());const a=r?this._cubemapMaterial:this._equirectMaterial,i=new $d(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const s=this._cubeSize;kb(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(i,gb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let a=1;a<r;a++){const t=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),n=Cb[(r-a-1)%Cb.length];this._blur(e,a-1,a,t,n)}t.autoClear=n}_blur(e,t,n,r,a){const i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}_halfBlur(e,t,n,r,a,i,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new $d(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(a)?Math.PI/(2*h):2*Math.PI/39,A=a/d,p=isFinite(a)?1+Math.floor(3*A):mb;p>mb&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(mb));const f=[];let m=0;for(let v=0;v<mb;++v){const e=v/A,t=Math.exp(-e*e/2);f.push(t),0===v?m+=t:v<p&&(m+=2*t)}for(let v=0;v<f.length;v++)f[v]=f[v]/m;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=f,u.latitudinal.value="latitudinal"===i,s&&(u.poleAxis.value=s);const{_lodMax:g}=this;u.dTheta.value=d,u.mipInt.value=g-n;const y=this._sizeLods[r];kb(t,3*y*(r>g-4?r-g+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,gb)}}function Bb(e,t,n){const r=new Hu(e,t,n);return r.texture.mapping=Eo,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function kb(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function Ib(){return new sA({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Ns,depthTest:!1,depthWrite:!1})}function Tb(){return new sA({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Ns,depthTest:!1,depthWrite:!1})}function Mb(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){const i=a.mapping,s=i===So||i===Co,o=i===wo||i===_o;if(s||o){let i=t.get(a);const l=void 0!==i?i.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==l)return null===n&&(n=new Nb(e)),i=s?n.fromEquirectangular(a,i):n.fromCubemap(a,i),i.texture.pmremVersion=a.pmremVersion,t.set(a,i),i.texture;if(void 0!==i)return i.texture;{const l=a.image;return s&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)?(null===n&&(n=new Nb(e)),i=s?n.fromEquirectangular(a):n.fromCubemap(a),i.texture.pmremVersion=a.pmremVersion,t.set(a,i),a.addEventListener("dispose",r),i.texture):null}}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Fb(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Su("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Rb(e,t,n,r){const a={},i=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const n in o.attributes)t.remove(o.attributes[n]);o.removeEventListener("dispose",s),delete a[o.id];const l=i.get(o);l&&(t.remove(l),i.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,a=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],a=e[t+1],i=e[t+2];n.push(r,a,a,i,i,r)}}else{if(void 0===a)return;{const e=a.array;s=a.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,a=t+2;n.push(e,r,r,a,a,e)}}}const o=new(yu(n)?Td:kd)(n,1);o.version=s;const l=i.get(e);l&&t.remove(l),i.set(e,o)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",s),a[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const a in r)t.update(r[a],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=i.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return i.get(e)}}}function Lb(e,t,n){let r,a,i;function s(t,s,o){0!==o&&(e.drawElementsInstanced(r,s,a,t*i,o),n.update(s,r,o))}this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,i=e.bytesPerElement},this.render=function(t,s){e.drawElements(r,s,a,t*i),n.update(s,r,1)},this.renderInstances=s,this.renderMultiDraw=function(e,i,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,i,0,a,e,0,s);let o=0;for(let t=0;t<s;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/i,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(r,o,0,a,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];n.update(t,r,1)}}}function Ub(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,a){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=a*(n/3);break;case e.LINES:t.lines+=a*(n/2);break;case e.LINE_STRIP:t.lines+=a*(n-1);break;case e.LINE_LOOP:t.lines+=a*n;break;case e.POINTS:t.points+=a*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Pb(e,t,n){const r=new WeakMap,a=new Ou;return{update:function(i,s,o){const l=i.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==c?c.length:0;let h=r.get(s);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==s.morphAttributes.position,A=void 0!==s.morphAttributes.normal,p=void 0!==s.morphAttributes.color,f=s.morphAttributes.position||[],m=s.morphAttributes.normal||[],g=s.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===A&&(y=2),!0===p&&(y=3);let v=s.attributes.position.count*y,b=1;v>t.maxTextureSize&&(b=Math.ceil(v/t.maxTextureSize),v=t.maxTextureSize);const x=new Float32Array(v*b*4*u),w=new ju(x,v,b,u);w.type=Go,w.needsUpdate=!0;const _=4*y;for(let C=0;C<u;C++){const E=f[C],N=m[C],B=g[C],k=v*b*4*C;for(let I=0;I<E.count;I++){const T=I*_;!0===d&&(a.fromBufferAttribute(E,I),x[k+T+0]=a.x,x[k+T+1]=a.y,x[k+T+2]=a.z,x[k+T+3]=0),!0===A&&(a.fromBufferAttribute(N,I),x[k+T+4]=a.x,x[k+T+5]=a.y,x[k+T+6]=a.z,x[k+T+7]=0),!0===p&&(a.fromBufferAttribute(B,I),x[k+T+8]=a.x,x[k+T+9]=a.y,x[k+T+10]=a.z,x[k+T+11]=4===B.itemSize?a.w:1)}}function S(){w.dispose(),r.delete(s),s.removeEventListener("dispose",S)}h={count:u,texture:w,size:new hu(v,b)},r.set(s,h),s.addEventListener("dispose",S)}if(!0===i.isInstancedMesh&&null!==i.morphTexture)o.getUniforms().setValue(e,"morphTexture",i.morphTexture,n);else{let M=0;for(let R=0;R<l.length;R++)M+=l[R];const F=s.morphTargetsRelative?1:1-M;o.getUniforms().setValue(e,"morphTargetBaseInfluence",F),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function Db(e,t,n,r){let a=new WeakMap;function i(e){const t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const o=r.render.frame,l=s.geometry,c=t.get(s,l);if(a.get(c)!==o&&(t.update(c),a.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",i)&&s.addEventListener("dispose",i),a.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),a.set(s,o))),s.isSkinnedMesh){const e=s.skeleton;a.get(e)!==o&&(e.update(),a.set(e,o))}return c},dispose:function(){a=new WeakMap}}}const Ob=new Du,zb=new vf(1,1),Hb=new ju,jb=new Vu,Qb=new pA,Vb=[],Wb=[],Gb=new Float32Array(16),Kb=new Float32Array(9),qb=new Float32Array(4);function Xb(e,t,n){const r=e[0];if(r<=0||r>0)return e;const a=t*n;let i=Vb[a];if(void 0===i&&(i=new Float32Array(a),Vb[a]=i),0!==t){r.toArray(i,0);for(let r=1,a=0;r!==t;++r)a+=n,e[r].toArray(i,a)}return i}function Yb(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Jb(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Zb(e,t){let n=Wb[t];void 0===n&&(n=new Int32Array(t),Wb[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function $b(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ex(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yb(n,t))return;e.uniform2fv(this.addr,t),Jb(n,t)}}function tx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Yb(n,t))return;e.uniform3fv(this.addr,t),Jb(n,t)}}function nx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yb(n,t))return;e.uniform4fv(this.addr,t),Jb(n,t)}}function rx(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yb(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Jb(n,t)}else{if(Yb(n,r))return;qb.set(r),e.uniformMatrix2fv(this.addr,!1,qb),Jb(n,r)}}function ax(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yb(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Jb(n,t)}else{if(Yb(n,r))return;Kb.set(r),e.uniformMatrix3fv(this.addr,!1,Kb),Jb(n,r)}}function ix(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yb(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Jb(n,t)}else{if(Yb(n,r))return;Gb.set(r),e.uniformMatrix4fv(this.addr,!1,Gb),Jb(n,r)}}function sx(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ox(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yb(n,t))return;e.uniform2iv(this.addr,t),Jb(n,t)}}function lx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yb(n,t))return;e.uniform3iv(this.addr,t),Jb(n,t)}}function cx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yb(n,t))return;e.uniform4iv(this.addr,t),Jb(n,t)}}function ux(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function hx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yb(n,t))return;e.uniform2uiv(this.addr,t),Jb(n,t)}}function dx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yb(n,t))return;e.uniform3uiv(this.addr,t),Jb(n,t)}}function Ax(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yb(n,t))return;e.uniform4uiv(this.addr,t),Jb(n,t)}}function px(e,t,n){const r=this.cache,a=n.allocateTextureUnit();let i;r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),this.type===e.SAMPLER_2D_SHADOW?(zb.compareFunction=Mc,i=zb):i=Ob,n.setTexture2D(t||i,a)}function fx(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||jb,a)}function mx(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||Qb,a)}function gx(e,t,n){const r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||Hb,a)}function yx(e,t){e.uniform1fv(this.addr,t)}function vx(e,t){const n=Xb(t,this.size,2);e.uniform2fv(this.addr,n)}function bx(e,t){const n=Xb(t,this.size,3);e.uniform3fv(this.addr,n)}function xx(e,t){const n=Xb(t,this.size,4);e.uniform4fv(this.addr,n)}function wx(e,t){const n=Xb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function _x(e,t){const n=Xb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Sx(e,t){const n=Xb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Cx(e,t){e.uniform1iv(this.addr,t)}function Ex(e,t){e.uniform2iv(this.addr,t)}function Nx(e,t){e.uniform3iv(this.addr,t)}function Bx(e,t){e.uniform4iv(this.addr,t)}function kx(e,t){e.uniform1uiv(this.addr,t)}function Ix(e,t){e.uniform2uiv(this.addr,t)}function Tx(e,t){e.uniform3uiv(this.addr,t)}function Mx(e,t){e.uniform4uiv(this.addr,t)}function Fx(e,t,n){const r=this.cache,a=t.length,i=Zb(n,a);Yb(r,i)||(e.uniform1iv(this.addr,i),Jb(r,i));for(let s=0;s!==a;++s)n.setTexture2D(t[s]||Ob,i[s])}function Rx(e,t,n){const r=this.cache,a=t.length,i=Zb(n,a);Yb(r,i)||(e.uniform1iv(this.addr,i),Jb(r,i));for(let s=0;s!==a;++s)n.setTexture3D(t[s]||jb,i[s])}function Lx(e,t,n){const r=this.cache,a=t.length,i=Zb(n,a);Yb(r,i)||(e.uniform1iv(this.addr,i),Jb(r,i));for(let s=0;s!==a;++s)n.setTextureCube(t[s]||Qb,i[s])}function Ux(e,t,n){const r=this.cache,a=t.length,i=Zb(n,a);Yb(r,i)||(e.uniform1iv(this.addr,i),Jb(r,i));for(let s=0;s!==a;++s)n.setTexture2DArray(t[s]||Hb,i[s])}class Px{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return $b;case 35664:return ex;case 35665:return tx;case 35666:return nx;case 35674:return rx;case 35675:return ax;case 35676:return ix;case 5124:case 35670:return sx;case 35667:case 35671:return ox;case 35668:case 35672:return lx;case 35669:case 35673:return cx;case 5125:return ux;case 36294:return hx;case 36295:return dx;case 36296:return Ax;case 35678:case 36198:case 36298:case 36306:case 35682:return px;case 35679:case 36299:case 36307:return fx;case 35680:case 36300:case 36308:case 36293:return mx;case 36289:case 36303:case 36311:case 36292:return gx}}(t.type)}}class Dx{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return yx;case 35664:return vx;case 35665:return bx;case 35666:return xx;case 35674:return wx;case 35675:return _x;case 35676:return Sx;case 5124:case 35670:return Cx;case 35667:case 35671:return Ex;case 35668:case 35672:return Nx;case 35669:case 35673:return Bx;case 5125:return kx;case 36294:return Ix;case 36295:return Tx;case 36296:return Mx;case 35678:case 36198:case 36298:case 36306:case 35682:return Fx;case 35679:case 36299:case 36307:return Rx;case 35680:case 36300:case 36308:case 36293:return Lx;case 36289:case 36303:case 36311:case 36292:return Ux}}(t.type)}}class Ox{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let a=0,i=r.length;a!==i;++a){const i=r[a];i.setValue(e,t[i.id],n)}}}const zx=/(\w+)(\])?(\[|\.)?/g;function Hx(e,t){e.seq.push(t),e.map[t.id]=t}function jx(e,t,n){const r=e.name,a=r.length;for(zx.lastIndex=0;;){const i=zx.exec(r),s=zx.lastIndex;let o=i[1];const l="]"===i[2],c=i[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===a){Hx(n,void 0===c?new Px(o,e,t):new Dx(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Ox(o),Hx(n,e)),n=e}}}class Qx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);jx(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const a=this.map[t];void 0!==a&&a.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let a=0,i=t.length;a!==i;++a){const i=t[a],s=n[i.id];!1!==s.needsUpdate&&i.setValue(e,s.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,a=e.length;r!==a;++r){const a=e[r];a.id in t&&n.push(a)}return n}}function Vx(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let Wx=0;const Gx=new mu;function Kx(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),a=(e.getShaderInfoLog(t)||"").trim();if(r&&""===a)return"";const i=/ERROR: 0:(\d+)/.exec(a);if(i){const r=parseInt(i[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){const n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length);for(let s=a;s<i;s++){const e=s+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[s]))}return r.join("\n")}(e.getShaderSource(t),r)}return a}function qx(e,t){const n=function(e){Bu._getMatrix(Gx,Bu.workingColorSpace,e);const t="mat3( ".concat(Gx.elements.map(e=>e.toFixed(4))," )");switch(Bu.getTransfer(e)){case hc:return[t,"LinearTransferOETF"];case dc:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return["vec4 ".concat(e,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function Xx(e,t){let n;switch(t){case ho:n="Linear";break;case Ao:n="Reinhard";break;case po:n="Cineon";break;case fo:n="ACESFilmic";break;case go:n="AgX";break;case yo:n="Neutral";break;case mo:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Yx=new Au;function Jx(){Bu.getLuminanceCoefficients(Yx);const e=Yx.x.toFixed(4),t=Yx.y.toFixed(4),n=Yx.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(e,", ").concat(t,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function Zx(e){return""!==e}function $x(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ew(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const tw=/^[ \t]*#include +<([\w\d./]+)>/gm;function nw(e){return e.replace(tw,aw)}const rw=new Map;function aw(e,t){let n=rb[t];if(void 0===n){const e=rw.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=rb[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return nw(n)}const iw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sw(e){return e.replace(iw,ow)}function ow(e,t,n,r){let a="";for(let i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function lw(e){let t="precision ".concat(e.precision," float;\n\tprecision ").concat(e.precision," int;\n\tprecision ").concat(e.precision," sampler2D;\n\tprecision ").concat(e.precision," samplerCube;\n\tprecision ").concat(e.precision," sampler3D;\n\tprecision ").concat(e.precision," sampler2DArray;\n\tprecision ").concat(e.precision," sampler2DShadow;\n\tprecision ").concat(e.precision," samplerCubeShadow;\n\tprecision ").concat(e.precision," sampler2DArrayShadow;\n\tprecision ").concat(e.precision," isampler2D;\n\tprecision ").concat(e.precision," isampler3D;\n\tprecision ").concat(e.precision," isamplerCube;\n\tprecision ").concat(e.precision," isampler2DArray;\n\tprecision ").concat(e.precision," usampler2D;\n\tprecision ").concat(e.precision," usampler3D;\n\tprecision ").concat(e.precision," usamplerCube;\n\tprecision ").concat(e.precision," usampler2DArray;\n\t");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function cw(e,t,n,r){const a=e.getContext(),i=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===xs?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===ws?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===_s&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case wo:case _o:t="ENVMAP_TYPE_CUBE";break;case Eo:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===_o&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case oo:t="ENVMAP_BLENDING_MULTIPLY";break;case lo:t="ENVMAP_BLENDING_MIX";break;case co:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),A=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Zx).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(i),f=a.createProgram();let m,g,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Zx).join("\n"),m.length>0&&(m+="\n"),g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Zx).join("\n"),g.length>0&&(g+="\n")):(m=[lw(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Zx).join("\n"),g=[lw(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==uo?"#define TONE_MAPPING":"",n.toneMapping!==uo?rb.tonemapping_pars_fragment:"",n.toneMapping!==uo?Xx("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",rb.colorspace_pars_fragment,qx("linearToOutputTexel",n.outputColorSpace),Jx(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Zx).join("\n")),s=nw(s),s=$x(s,n),s=ew(s,n),o=nw(o),o=$x(o,n),o=ew(o,n),s=sw(s),o=sw(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",m=[A,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",n.glslVersion===Kc?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Kc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const v=y+m+s,b=y+g+o,x=Vx(a,a.VERTEX_SHADER,v),w=Vx(a,a.FRAGMENT_SHADER,b);function _(t){if(e.debug.checkShaderErrors){const n=a.getProgramInfoLog(f)||"",r=a.getShaderInfoLog(x)||"",i=a.getShaderInfoLog(w)||"",s=n.trim(),o=r.trim(),l=i.trim();let c=!0,u=!0;if(!1===a.getProgramParameter(f,a.LINK_STATUS))if(c=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(a,f,x,w);else{const e=Kx(a,x,"vertex"),n=Kx(a,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(f,a.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+s+"\n"+e+"\n"+n)}else""!==s?console.warn("THREE.WebGLProgram: Program Info Log:",s):""!==o&&""!==l||(u=!1);u&&(t.diagnostics={runnable:c,programLog:s,vertexShader:{log:o,prefix:m},fragmentShader:{log:l,prefix:g}})}a.deleteShader(x),a.deleteShader(w),S=new Qx(a,f),C=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let a=0;a<r;a++){const r=e.getActiveAttrib(t,a),i=r.name;let s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[i]={type:r.type,location:e.getAttribLocation(t,i),locationSize:s}}return n}(a,f)}let S,C;a.attachShader(f,x),a.attachShader(f,w),void 0!==n.index0AttributeName?a.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(f,0,"position"),a.linkProgram(f),this.getUniforms=function(){return void 0===S&&_(this),S},this.getAttributes=function(){return void 0===C&&_(this),C};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=a.getProgramParameter(f,37297)),E},this.destroy=function(){r.releaseStatesOfProgram(this),a.deleteProgram(f),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Wx++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=x,this.fragmentShader=w,this}let uw=0;class hw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new dw(e),t.set(e,n)),n}}class dw{constructor(e){this.id=uw++,this.code=e,this.usedTimes=0}}function Aw(e,t,n,r,a,i,s){const o=new Ih,l=new hw,c=new Set,u=[],h=a.logarithmicDepthBuffer,d=a.vertexTextures;let A=a.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(e){return c.add(e),0===e?"uv":"uv".concat(e)}return{getParameters:function(i,o,u,m,g){const y=m.fog,v=g.geometry,b=i.isMeshStandardMaterial?m.environment:null,x=(i.isMeshStandardMaterial?n:t).get(i.envMap||b),w=x&&x.mapping===Eo?x.image.height:null,_=p[i.type];null!==i.precision&&(A=a.getMaxPrecision(i.precision),A!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",A,"instead."));const S=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,C=void 0!==S?S.length:0;let E,N,B,k,I=0;if(void 0!==v.morphAttributes.position&&(I=1),void 0!==v.morphAttributes.normal&&(I=2),void 0!==v.morphAttributes.color&&(I=3),_){const e=ib[_];E=e.vertexShader,N=e.fragmentShader}else E=i.vertexShader,N=i.fragmentShader,l.update(i),B=l.getVertexShaderID(i),k=l.getFragmentShaderID(i);const T=e.getRenderTarget(),M=e.state.buffers.depth.getReversed(),F=!0===g.isInstancedMesh,R=!0===g.isBatchedMesh,L=!!i.map,U=!!i.matcap,P=!!x,D=!!i.aoMap,O=!!i.lightMap,z=!!i.bumpMap,H=!!i.normalMap,j=!!i.displacementMap,Q=!!i.emissiveMap,V=!!i.metalnessMap,W=!!i.roughnessMap,G=i.anisotropy>0,K=i.clearcoat>0,q=i.dispersion>0,X=i.iridescence>0,Y=i.sheen>0,J=i.transmission>0,Z=G&&!!i.anisotropyMap,$=K&&!!i.clearcoatMap,ee=K&&!!i.clearcoatNormalMap,te=K&&!!i.clearcoatRoughnessMap,ne=X&&!!i.iridescenceMap,re=X&&!!i.iridescenceThicknessMap,ae=Y&&!!i.sheenColorMap,ie=Y&&!!i.sheenRoughnessMap,se=!!i.specularMap,oe=!!i.specularColorMap,le=!!i.specularIntensityMap,ce=J&&!!i.transmissionMap,ue=J&&!!i.thicknessMap,he=!!i.gradientMap,de=!!i.alphaMap,Ae=i.alphaTest>0,pe=!!i.alphaHash,fe=!!i.extensions;let me=uo;i.toneMapped&&(null!==T&&!0!==T.isXRRenderTarget||(me=e.toneMapping));const ge={shaderID:_,shaderType:i.type,shaderName:i.name,vertexShader:E,fragmentShader:N,defines:i.defines,customVertexShaderID:B,customFragmentShaderID:k,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:A,batching:R,batchingColor:R&&null!==g._colorsTexture,instancing:F,instancingColor:F&&null!==g.instanceColor,instancingMorph:F&&null!==g.morphTexture,supportsVertexTextures:d,outputColorSpace:null===T?e.outputColorSpace:!0===T.isXRRenderTarget?T.texture.colorSpace:uc,alphaToCoverage:!!i.alphaToCoverage,map:L,matcap:U,envMap:P,envMapMode:P&&x.mapping,envMapCubeUVHeight:w,aoMap:D,lightMap:O,bumpMap:z,normalMap:H,displacementMap:d&&j,emissiveMap:Q,normalMapObjectSpace:H&&i.normalMapType===oc,normalMapTangentSpace:H&&i.normalMapType===sc,metalnessMap:V,roughnessMap:W,anisotropy:G,anisotropyMap:Z,clearcoat:K,clearcoatMap:$,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:q,iridescence:X,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:Y,sheenColorMap:ae,sheenRoughnessMap:ie,specularMap:se,specularColorMap:oe,specularIntensityMap:le,transmission:J,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===i.transparent&&i.blending===Bs&&!1===i.alphaToCoverage,alphaMap:de,alphaTest:Ae,alphaHash:pe,combine:i.combine,mapUv:L&&f(i.map.channel),aoMapUv:D&&f(i.aoMap.channel),lightMapUv:O&&f(i.lightMap.channel),bumpMapUv:z&&f(i.bumpMap.channel),normalMapUv:H&&f(i.normalMap.channel),displacementMapUv:j&&f(i.displacementMap.channel),emissiveMapUv:Q&&f(i.emissiveMap.channel),metalnessMapUv:V&&f(i.metalnessMap.channel),roughnessMapUv:W&&f(i.roughnessMap.channel),anisotropyMapUv:Z&&f(i.anisotropyMap.channel),clearcoatMapUv:$&&f(i.clearcoatMap.channel),clearcoatNormalMapUv:ee&&f(i.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&f(i.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&f(i.iridescenceMap.channel),iridescenceThicknessMapUv:re&&f(i.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&f(i.sheenColorMap.channel),sheenRoughnessMapUv:ie&&f(i.sheenRoughnessMap.channel),specularMapUv:se&&f(i.specularMap.channel),specularColorMapUv:oe&&f(i.specularColorMap.channel),specularIntensityMapUv:le&&f(i.specularIntensityMap.channel),transmissionMapUv:ce&&f(i.transmissionMap.channel),thicknessMapUv:ue&&f(i.thicknessMap.channel),alphaMapUv:de&&f(i.alphaMap.channel),vertexTangents:!!v.attributes.tangent&&(H||G),vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,pointsUvs:!0===g.isPoints&&!!v.attributes.uv&&(L||de),fog:!!y,useFog:!0===i.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===i.flatShading&&!1===i.wireframe,sizeAttenuation:!0===i.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:M,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:C,morphTextureStride:I,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:L&&!0===i.map.isVideoTexture&&Bu.getTransfer(i.map.colorSpace)===dc,decodeVideoTextureEmissive:Q&&!0===i.emissiveMap.isVideoTexture&&Bu.getTransfer(i.emissiveMap.colorSpace)===dc,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===Es,flipSided:i.side===Cs,useDepthPacking:i.depthPacking>=0,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionClipCullDistance:fe&&!0===i.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===i.extensions.multiDraw||R)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:i.customProgramCacheKey()};return ge.vertexUv1s=c.has(1),ge.vertexUv2s=c.has(2),ge.vertexUv3s=c.has(3),c.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);t.gradientMap&&o.enable(22);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reversedDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=ib[t];n=iA.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,a=u.length;e<a;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new cw(e,n,t,i),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function pw(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function fw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function mw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function gw(){const e=[];let t=0;const n=[],r=[],a=[];function i(n,r,a,i,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=a,l.groupOrder=i,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,s,o,l,c){const u=i(e,t,s,o,l,c);s.transmission>0?r.push(u):!0===s.transparent?a.push(u):n.push(u)},unshift:function(e,t,s,o,l,c){const u=i(e,t,s,o,l,c);s.transmission>0?r.unshift(u):!0===s.transparent?a.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||fw),r.length>1&&r.sort(t||mw),a.length>1&&a.sort(t||mw)}}}function yw(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let a;return void 0===r?(a=new gw,e.set(t,[a])):n>=r.length?(a=new gw,r.push(a)):a=r[n],a},dispose:function(){e=new WeakMap}}}function vw(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Au,color:new hd};break;case"SpotLight":n={position:new Au,direction:new Au,color:new hd,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Au,color:new hd,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Au,skyColor:new hd,groundColor:new hd};break;case"RectAreaLight":n={color:new hd,position:new Au,halfWidth:new Au,halfHeight:new Au}}return e[t.id]=n,n}}}let bw=0;function xw(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function ww(e){const t=new vw,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hu};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hu,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)r.probe.push(new Au);const a=new Au,i=new vh,s=new vh;return{setup:function(a){let i=0,s=0,o=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,A=0,p=0,f=0,m=0,g=0,y=0;a.sort(xw);for(let e=0,b=a.length;e<b;e++){const v=a[e],b=v.color,x=v.intensity,w=v.distance,_=v.shadow&&v.shadow.map?v.shadow.map.texture:null;if(v.isAmbientLight)i+=b.r*x,s+=b.g*x,o+=b.b*x;else if(v.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(v.sh.coefficients[e],x);y++}else if(v.isDirectionalLight){const e=t.get(v);if(e.color.copy(v.color).multiplyScalar(v.intensity),v.castShadow){const e=v.shadow,t=n.get(v);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=_,r.directionalShadowMatrix[l]=v.shadow.matrix,A++}r.directional[l]=e,l++}else if(v.isSpotLight){const e=t.get(v);e.position.setFromMatrixPosition(v.matrixWorld),e.color.copy(b).multiplyScalar(x),e.distance=w,e.coneCos=Math.cos(v.angle),e.penumbraCos=Math.cos(v.angle*(1-v.penumbra)),e.decay=v.decay,r.spot[u]=e;const a=v.shadow;if(v.map&&(r.spotLightMap[m]=v.map,m++,a.updateMatrices(v),v.castShadow&&g++),r.spotLightMatrix[u]=a.matrix,v.castShadow){const e=n.get(v);e.shadowIntensity=a.intensity,e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=_,f++}u++}else if(v.isRectAreaLight){const e=t.get(v);e.color.copy(b).multiplyScalar(x),e.halfWidth.set(.5*v.width,0,0),e.halfHeight.set(0,.5*v.height,0),r.rectArea[h]=e,h++}else if(v.isPointLight){const e=t.get(v);if(e.color.copy(v.color).multiplyScalar(v.intensity),e.distance=v.distance,e.decay=v.decay,v.castShadow){const e=v.shadow,t=n.get(v);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[c]=t,r.pointShadowMap[c]=_,r.pointShadowMatrix[c]=v.shadow.matrix,p++}r.point[c]=e,c++}else if(v.isHemisphereLight){const e=t.get(v);e.skyColor.copy(v.color).multiplyScalar(x),e.groundColor.copy(v.groundColor).multiplyScalar(x),r.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ab.LTC_FLOAT_1,r.rectAreaLTC2=ab.LTC_FLOAT_2):(r.rectAreaLTC1=ab.LTC_HALF_1,r.rectAreaLTC2=ab.LTC_HALF_2)),r.ambient[0]=i,r.ambient[1]=s,r.ambient[2]=o;const v=r.hash;v.directionalLength===l&&v.pointLength===c&&v.spotLength===u&&v.rectAreaLength===h&&v.hemiLength===d&&v.numDirectionalShadows===A&&v.numPointShadows===p&&v.numSpotShadows===f&&v.numSpotMaps===m&&v.numLightProbes===y||(r.directional.length=l,r.spot.length=u,r.rectArea.length=h,r.point.length=c,r.hemi.length=d,r.directionalShadow.length=A,r.directionalShadowMap.length=A,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=f,r.spotShadowMap.length=f,r.directionalShadowMatrix.length=A,r.pointShadowMatrix.length=p,r.spotLightMatrix.length=f+m-g,r.spotLightMap.length=m,r.numSpotLightShadowsWithMaps=g,r.numLightProbes=y,v.directionalLength=l,v.pointLength=c,v.spotLength=u,v.rectAreaLength=h,v.hemiLength=d,v.numDirectionalShadows=A,v.numPointShadows=p,v.numSpotShadows=f,v.numSpotMaps=m,v.numLightProbes=y,r.version=bw++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,A=e.length;d<A;d++){const t=e[d];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),i.copy(t.matrixWorld),i.premultiply(h),s.extractRotation(i),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=r.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function _w(e){const t=new ww(e),n=[],r=[];const a={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){a.camera=e,n.length=0,r.length=0},state:a,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Sw(e){let t=new WeakMap;return{get:function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=t.get(n);let i;return void 0===a?(i=new _w(e),t.set(n,[i])):r>=a.length?(i=new _w(e),a.push(i)):i=a[r],i},dispose:function(){t=new WeakMap}}}function Cw(e,t,n){let r=new xp;const a=new hu,i=new hu,s=new Ou,o=new tg({depthPacking:rc}),l=new ng,c={},u=n.maxTextureSize,h={[Ss]:Cs,[Cs]:Ss,[Es]:Es},d=new sA({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new hu},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),A=d.clone();A.defines.HORIZONTAL_PASS=1;const p=new Hd;p.setAttribute("position",new Sd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new $d(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=xs;let g=this.type;function y(n,r){const i=t.update(f);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,A.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,A.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Hu(a.x,a.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,f,null),A.uniforms.shadow_pass.value=n.mapPass.texture,A.uniforms.resolution.value=n.mapSize,A.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,A,f,null)}function v(t,n,r,a){let i=null;const s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)i=s;else if(i=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=i.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let a=r[t];void 0===a&&(a=i.clone(),r[t]=a,n.addEventListener("dispose",x)),i=a}if(i.visible=n.visible,i.wireframe=n.wireframe,i.side=a===_s?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],i.alphaMap=n.alphaMap,i.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,i.map=n.map,i.clipShadows=n.clipShadows,i.clippingPlanes=n.clippingPlanes,i.clipIntersection=n.clipIntersection,i.displacementMap=n.displacementMap,i.displacementScale=n.displacementScale,i.displacementBias=n.displacementBias,i.wireframeLinewidth=n.wireframeLinewidth,i.linewidth=n.linewidth,!0===r.isPointLight&&!0===i.isMeshDistanceMaterial){e.properties.get(i).light=r}return i}function b(n,a,i,s,o){if(!1===n.visible)return;if(n.layers.test(a.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===_s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=v(n,h,s,o);n.onBeforeShadow(e,n,a,i,r,t,u),e.renderBufferDirect(i,null,r,t,n,u),n.onAfterShadow(e,n,a,i,r,t,u)}}}else if(l.visible){const t=v(n,l,s,o);n.onBeforeShadow(e,n,a,i,r,t,null),e.renderBufferDirect(i,null,r,t,n,null),n.onAfterShadow(e,n,a,i,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],a,i,s,o)}function x(e){e.target.removeEventListener("dispose",x);for(const t in c){const n=c[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,o){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(Ns),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const A=g!==_s&&this.type===_s,p=g===_s&&this.type!==_s;for(let f=0,m=t.length;f<m;f++){const l=t[f],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;a.copy(c.mapSize);const h=c.getFrameExtents();if(a.multiply(h),i.copy(c.mapSize),(a.x>u||a.y>u)&&(a.x>u&&(i.x=Math.floor(u/h.x),a.x=i.x*h.x,c.mapSize.x=i.x),a.y>u&&(i.y=Math.floor(u/h.y),a.y=i.y*h.y,c.mapSize.y=i.y)),null===c.map||!0===A||!0===p){const e=this.type!==_s?{minFilter:Io,magFilter:Io}:{};null!==c.map&&c.map.dispose(),c.map=new Hu(a.x,a.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const m=c.getViewportCount();for(let e=0;e<m;e++){const t=c.getViewport(e);s.set(i.x*t.x,i.y*t.y,i.x*t.z,i.y*t.w),d.viewport(s),c.updateMatrices(l,e),r=c.getFrustum(),b(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===_s&&y(c,o),c.needsUpdate=!1}g=this.type,m.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const Ew={[$s]:eo,[to]:io,[ro]:so,[no]:ao,[eo]:$s,[io]:to,[so]:ro,[ao]:no};function Nw(e,t){const n=new function(){let t=!1;const n=new Ou;let r=null;const a=new Ou(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,s,o){!0===o&&(t*=s,r*=s,i*=s),n.set(t,r,i,s),!1===a.equals(n)&&(e.clearColor(t,r,i,s),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,a=null,i=null,s=null;return{setReversed:function(e){if(r!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),r=e;const a=s;s=null,this.setClear(a)}},getReversed:function(){return r},setTest:function(t){t?z(e.DEPTH_TEST):H(e.DEPTH_TEST)},setMask:function(t){a===t||n||(e.depthMask(t),a=t)},setFunc:function(t){if(r&&(t=Ew[t]),i!==t){switch(t){case $s:e.depthFunc(e.NEVER);break;case eo:e.depthFunc(e.ALWAYS);break;case to:e.depthFunc(e.LESS);break;case no:e.depthFunc(e.LEQUAL);break;case ro:e.depthFunc(e.EQUAL);break;case ao:e.depthFunc(e.GEQUAL);break;case io:e.depthFunc(e.GREATER);break;case so:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){n=e},setClear:function(t){s!==t&&(r&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){n=!1,a=null,i=null,s=null,r=!1}}},a=new function(){let t=!1,n=null,r=null,a=null,i=null,s=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):H(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&a===n&&i===s||(e.stencilFunc(t,n,s),r=t,a=n,i=s)},setOp:function(t,n,r){s===t&&o===n&&l===r||(e.stencilOp(t,n,r),s=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,s=null,o=null,l=null,c=null}}},i=new WeakMap,s=new WeakMap;let o={},l={},c=new WeakMap,u=[],h=null,d=!1,A=null,p=null,f=null,m=null,g=null,y=null,v=null,b=new hd(0,0,0),x=0,w=!1,_=null,S=null,C=null,E=null,N=null;const B=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,I=0;const T=e.getParameter(e.VERSION);-1!==T.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(T)[1]),k=I>=1):-1!==T.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),k=I>=2);let M=null,F={};const R=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),U=(new Ou).fromArray(R),P=(new Ou).fromArray(L);function D(t,n,r,a){const i=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,i):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return s}const O={};function z(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function H(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}O[e.TEXTURE_2D]=D(e.TEXTURE_2D,e.TEXTURE_2D,1),O[e.TEXTURE_CUBE_MAP]=D(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),O[e.TEXTURE_2D_ARRAY]=D(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),O[e.TEXTURE_3D]=D(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),a.setClear(0),z(e.DEPTH_TEST),r.setFunc(no),W(!1),G(gs),z(e.CULL_FACE),V(Ns);const j={[Fs]:e.FUNC_ADD,[Rs]:e.FUNC_SUBTRACT,[Ls]:e.FUNC_REVERSE_SUBTRACT};j[Us]=e.MIN,j[Ps]=e.MAX;const Q={[Ds]:e.ZERO,[Os]:e.ONE,[zs]:e.SRC_COLOR,[js]:e.SRC_ALPHA,[qs]:e.SRC_ALPHA_SATURATE,[Gs]:e.DST_COLOR,[Vs]:e.DST_ALPHA,[Hs]:e.ONE_MINUS_SRC_COLOR,[Qs]:e.ONE_MINUS_SRC_ALPHA,[Ks]:e.ONE_MINUS_DST_COLOR,[Ws]:e.ONE_MINUS_DST_ALPHA,[Xs]:e.CONSTANT_COLOR,[Ys]:e.ONE_MINUS_CONSTANT_COLOR,[Js]:e.CONSTANT_ALPHA,[Zs]:e.ONE_MINUS_CONSTANT_ALPHA};function V(t,n,r,a,i,s,o,l,c,u){if(t!==Ns){if(!1===d&&(z(e.BLEND),d=!0),t===Ms)i=i||n,s=s||r,o=o||a,n===p&&i===g||(e.blendEquationSeparate(j[n],j[i]),p=n,g=i),r===f&&a===m&&s===y&&o===v||(e.blendFuncSeparate(Q[r],Q[a],Q[s],Q[o]),f=r,m=a,y=s,v=o),!1!==l.equals(b)&&c===x||(e.blendColor(l.r,l.g,l.b,c),b.copy(l),x=c),A=t,w=!1;else if(t!==A||u!==w){if(p===Fs&&g===Fs||(e.blendEquation(e.FUNC_ADD),p=Fs,g=Fs),u)switch(t){case Bs:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case ks:e.blendFunc(e.ONE,e.ONE);break;case Is:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Ts:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Bs:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case ks:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case Is:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ts:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,y=null,v=null,b.set(0,0,0),x=0,A=t,w=u}}else!0===d&&(H(e.BLEND),d=!1)}function W(t){_!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),_=t)}function G(t){t!==ms?(z(e.CULL_FACE),t!==S&&(t===gs?e.cullFace(e.BACK):t===ys?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):H(e.CULL_FACE),S=t}function K(t,n,r){t?(z(e.POLYGON_OFFSET_FILL),E===n&&N===r||(e.polygonOffset(n,r),E=n,N=r)):H(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:a},enable:z,disable:H,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=u,a=!1;if(t){r=c.get(n),void 0===r&&(r=[],c.set(n,r));const i=t.textures;if(r.length!==i.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=i.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=i.length,a=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,a=!0);a&&e.drawBuffers(r)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:V,setMaterial:function(t,i){t.side===Es?H(e.CULL_FACE):z(e.CULL_FACE);let s=t.side===Cs;i&&(s=!s),W(s),t.blending===Bs&&!1===t.transparent?V(Ns):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;a.setTest(o),o&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),K(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):H(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:G,setLineWidth:function(t){t!==C&&(k&&e.lineWidth(t),C=t)},setPolygonOffset:K,setScissorTest:function(t){t?z(e.SCISSOR_TEST):H(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+B-1),M!==t&&(e.activeTexture(t),M=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===M?e.TEXTURE0+B-1:M);let a=F[r];void 0===a&&(a={type:void 0,texture:void 0},F[r]=a),a.type===t&&a.texture===n||(M!==r&&(e.activeTexture(r),M=r),e.bindTexture(t,n||O[t]),a.type=t,a.texture=n)},unbindTexture:function(){const t=F[M];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},updateUBOMapping:function(t,n){let r=s.get(n);void 0===r&&(r=new WeakMap,s.set(n,r));let a=r.get(t);void 0===a&&(a=e.getUniformBlockIndex(n,t.name),r.set(t,a))},uniformBlockBinding:function(t,n){const r=s.get(n).get(t);i.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),i.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(_S){console.error("THREE.WebGLState:",_S)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===P.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),P.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},M=null,F={},l={},c=new WeakMap,u=[],h=null,d=!1,A=null,p=null,f=null,m=null,g=null,y=null,v=null,b=new hd(0,0,0),x=0,w=!1,_=null,S=null,C=null,E=null,N=null,U.set(0,0,e.canvas.width,e.canvas.height),P.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),a.reset()}}}function Bw(e,t,n,r,a,i,s){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new hu,u=new WeakMap;let h;const d=new WeakMap;let A=!1;try{A="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function p(e,t){return A?new OffscreenCanvas(e,t):xu("canvas")}function f(e,t,n){let r=1;const a=Q(e);if((a.width>n||a.height>n)&&(r=n/Math.max(a.width,a.height)),r<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*a.width),i=Math.floor(r*a.height);void 0===h&&(h=p(n,i));const s=t?p(n,i):h;s.width=n,s.height=i;return s.getContext("2d").drawImage(e,0,0,n,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+a.width+"x"+a.height+") to ("+n+"x"+i+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+")."),e}return e}function m(e){return e.generateMipmaps}function g(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function v(n,r,a,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;if(r===e.RED&&(a===e.FLOAT&&(o=e.R32F),a===e.HALF_FLOAT&&(o=e.R16F),a===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RED_INTEGER&&(a===e.UNSIGNED_BYTE&&(o=e.R8UI),a===e.UNSIGNED_SHORT&&(o=e.R16UI),a===e.UNSIGNED_INT&&(o=e.R32UI),a===e.BYTE&&(o=e.R8I),a===e.SHORT&&(o=e.R16I),a===e.INT&&(o=e.R32I)),r===e.RG&&(a===e.FLOAT&&(o=e.RG32F),a===e.HALF_FLOAT&&(o=e.RG16F),a===e.UNSIGNED_BYTE&&(o=e.RG8)),r===e.RG_INTEGER&&(a===e.UNSIGNED_BYTE&&(o=e.RG8UI),a===e.UNSIGNED_SHORT&&(o=e.RG16UI),a===e.UNSIGNED_INT&&(o=e.RG32UI),a===e.BYTE&&(o=e.RG8I),a===e.SHORT&&(o=e.RG16I),a===e.INT&&(o=e.RG32I)),r===e.RGB_INTEGER&&(a===e.UNSIGNED_BYTE&&(o=e.RGB8UI),a===e.UNSIGNED_SHORT&&(o=e.RGB16UI),a===e.UNSIGNED_INT&&(o=e.RGB32UI),a===e.BYTE&&(o=e.RGB8I),a===e.SHORT&&(o=e.RGB16I),a===e.INT&&(o=e.RGB32I)),r===e.RGBA_INTEGER&&(a===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),a===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),a===e.UNSIGNED_INT&&(o=e.RGBA32UI),a===e.BYTE&&(o=e.RGBA8I),a===e.SHORT&&(o=e.RGBA16I),a===e.INT&&(o=e.RGBA32I)),r===e.RGB&&(a===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),a===e.UNSIGNED_INT_10F_11F_11F_REV&&(o=e.R11F_G11F_B10F)),r===e.RGBA){const t=s?hc:Bu.getTransfer(i);a===e.FLOAT&&(o=e.RGBA32F),a===e.HALF_FLOAT&&(o=e.RGBA16F),a===e.UNSIGNED_BYTE&&(o=t===dc?e.SRGB8_ALPHA8:e.RGBA8),a===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),a===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function b(t,n){let r;return t?null===n||n===Wo||n===Yo?r=e.DEPTH24_STENCIL8:n===Go?r=e.DEPTH32F_STENCIL8:n===Qo&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Wo||n===Yo?r=e.DEPTH_COMPONENT24:n===Go?r=e.DEPTH_COMPONENT32F:n===Qo&&(r=e.DEPTH_COMPONENT16),r}function x(e,t){return!0===m(e)||e.isFramebufferTexture&&e.minFilter!==Io&&e.minFilter!==Lo?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,a=d.get(n);if(a){const r=a[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(e),0===Object.keys(a).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function _(t){const n=t.target;n.removeEventListener("dispose",_),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const a=t.textures;for(let i=0,o=a.length;i<o;i++){const t=r.get(a[i]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),r.remove(a[i])}r.remove(t)}(n)}function S(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const a=t.source;delete d.get(a)[n.__cacheKey],s.memory.textures--}let C=0;function E(t,a){const i=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&i.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void F(i,t,a);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else t.isExternalTexture&&(i.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,i.__webglTexture,e.TEXTURE0+a)}const N={[No]:e.REPEAT,[Bo]:e.CLAMP_TO_EDGE,[ko]:e.MIRRORED_REPEAT},B={[Io]:e.NEAREST,[To]:e.NEAREST_MIPMAP_NEAREST,[Fo]:e.NEAREST_MIPMAP_LINEAR,[Lo]:e.LINEAR,[Uo]:e.LINEAR_MIPMAP_NEAREST,[Do]:e.LINEAR_MIPMAP_LINEAR},k={[kc]:e.NEVER,[Uc]:e.ALWAYS,[Ic]:e.LESS,[Mc]:e.LEQUAL,[Tc]:e.EQUAL,[Lc]:e.GEQUAL,[Fc]:e.GREATER,[Rc]:e.NOTEQUAL};function I(n,i){if(i.type!==Go||!1!==t.has("OES_texture_float_linear")||i.magFilter!==Lo&&i.magFilter!==Uo&&i.magFilter!==Fo&&i.magFilter!==Do&&i.minFilter!==Lo&&i.minFilter!==Uo&&i.minFilter!==Fo&&i.minFilter!==Do||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,N[i.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,N[i.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,N[i.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,B[i.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,B[i.minFilter]),i.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,k[i.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(i.magFilter===Io)return;if(i.minFilter!==Fo&&i.minFilter!==Do)return;if(i.type===Go&&!1===t.has("OES_texture_float_linear"))return;if(i.anisotropy>1||r.get(i).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy}}}function T(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const a=n.source;let i=d.get(a);void 0===i&&(i={},d.set(a,i));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===i[o]&&(i[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),i[o].usedTimes++;const a=i[t.__cacheKey];void 0!==a&&(i[t.__cacheKey].usedTimes--,0===a.usedTimes&&S(n)),t.__cacheKey=o,t.__webglTexture=i[o].texture}return r}function M(e,t,n){return Math.floor(Math.floor(e/n)/t)}function F(t,s,o){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=T(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=r.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=Bu.getPrimaries(Bu.workingColorSpace),r=s.colorSpace===lc?null:Bu.getPrimaries(s.colorSpace),d=s.colorSpace===lc||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let A=f(s.image,!1,a.maxTextureSize);A=j(s,A);const p=i.convert(s.format,s.colorSpace),y=i.convert(s.type);let w,_=v(s.internalFormat,p,y,s.colorSpace,s.isVideoTexture);I(l,s);const S=s.mipmaps,C=!0!==s.isVideoTexture,E=void 0===h.__version||!0===c,N=u.dataReady,B=x(s,A);if(s.isDepthTexture)_=b(s.format===rl,s.type),E&&(C?n.texStorage2D(e.TEXTURE_2D,1,_,A.width,A.height):n.texImage2D(e.TEXTURE_2D,0,_,A.width,A.height,0,p,y,null));else if(s.isDataTexture)if(S.length>0){C&&E&&n.texStorage2D(e.TEXTURE_2D,B,_,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)w=S[t],C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,p,y,w.data);s.generateMipmaps=!1}else C?(E&&n.texStorage2D(e.TEXTURE_2D,B,_,A.width,A.height),N&&function(t,r,a,i){const s=t.updateRanges;if(0===s.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,a,i,r.data);else{s.sort((e,t)=>e.start-t.start);let o=0;for(let e=1;e<s.length;e++){const t=s[o],n=s[e],a=t.start+t.count,i=M(n.start,r.width,4),l=M(t.start,r.width,4);n.start<=a+1&&i===l&&M(n.start+n.count-1,r.width,4)===i?t.count=Math.max(t.count,n.start+n.count-t.start):(++o,s[o]=n)}s.length=o+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),u=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width);for(let t=0,h=s.length;t<h;t++){const o=s[t],l=Math.floor(o.start/4),c=Math.ceil(o.count/4),u=l%r.width,h=Math.floor(l/r.width),d=c,A=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,h),n.texSubImage2D(e.TEXTURE_2D,0,u,h,d,A,a,i,r.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,u)}}(s,A,p,y)):n.texImage2D(e.TEXTURE_2D,0,_,A.width,A.height,0,p,y,A.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){C&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,B,_,S[0].width,S[0].height,A.depth);for(let t=0,r=S.length;t<r;t++)if(w=S[t],s.format!==tl)if(null!==p)if(C){if(N)if(s.layerUpdates.size>0){const r=$v(w.width,w.height,s.format,s.type);for(const a of s.layerUpdates){const i=w.data.subarray(a*r/w.data.BYTES_PER_ELEMENT,(a+1)*r/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,a,w.width,w.height,1,p,i)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,A.depth,p,w.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,w.width,w.height,A.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else C?N&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,A.depth,p,y,w.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,w.width,w.height,A.depth,0,p,y,w.data)}else{C&&E&&n.texStorage2D(e.TEXTURE_2D,B,_,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)w=S[t],s.format!==tl?null!==p?C?N&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,w.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,p,y,w.data)}else if(s.isDataArrayTexture)if(C){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,B,_,A.width,A.height,A.depth),N)if(s.layerUpdates.size>0){const t=$v(A.width,A.height,s.format,s.type);for(const r of s.layerUpdates){const a=A.data.subarray(r*t/A.data.BYTES_PER_ELEMENT,(r+1)*t/A.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,A.width,A.height,1,p,y,a)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,A.width,A.height,A.depth,p,y,A.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,A.width,A.height,A.depth,0,p,y,A.data);else if(s.isData3DTexture)C?(E&&n.texStorage3D(e.TEXTURE_3D,B,_,A.width,A.height,A.depth),N&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,A.width,A.height,A.depth,p,y,A.data)):n.texImage3D(e.TEXTURE_3D,0,_,A.width,A.height,A.depth,0,p,y,A.data);else if(s.isFramebufferTexture){if(E)if(C)n.texStorage2D(e.TEXTURE_2D,B,_,A.width,A.height);else{let t=A.width,r=A.height;for(let a=0;a<B;a++)n.texImage2D(e.TEXTURE_2D,a,_,t,r,0,p,y,null),t>>=1,r>>=1}}else if(S.length>0){if(C&&E){const t=Q(S[0]);n.texStorage2D(e.TEXTURE_2D,B,_,t.width,t.height)}for(let t=0,r=S.length;t<r;t++)w=S[t],C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,y,w):n.texImage2D(e.TEXTURE_2D,t,_,p,y,w);s.generateMipmaps=!1}else if(C){if(E){const t=Q(A);n.texStorage2D(e.TEXTURE_2D,B,_,t.width,t.height)}N&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,y,A)}else n.texImage2D(e.TEXTURE_2D,0,_,p,y,A);m(s)&&g(l),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function R(t,a,s,l,c,u){const h=i.convert(s.format,s.colorSpace),d=i.convert(s.type),A=v(s.internalFormat,h,d,s.colorSpace),p=r.get(a),f=r.get(s);if(f.__renderTarget=a,!p.__hasExternalTextures){const t=Math.max(1,a.width>>u),r=Math.max(1,a.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,A,t,r,a.depth,0,h,d,null):n.texImage2D(c,u,A,t,r,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),H(a)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,f.__webglTexture,0,z(a)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,f.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const a=n.depthTexture,i=a&&a.isDepthTexture?a.type:null,s=b(n.stencilBuffer,i),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=z(n);H(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let a=0;a<t.length;a++){const s=t[a],l=i.convert(s.format,s.colorSpace),c=i.convert(s.type),u=v(s.internalFormat,l,c,s.colorSpace),h=z(n);r&&!1===H(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):H(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function U(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const i=r.get(a.depthTexture);i.__renderTarget=a,i.__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),E(a.depthTexture,0);const s=i.__webglTexture,l=z(a);if(a.depthTexture.format===nl)H(a)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(a.depthTexture.format!==rl)throw new Error("Unknown depthTexture format");H(a)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}function P(t){const a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(a.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(a.__depthDisposeCallback&&a.__depthDisposeCallback(),e){const t=()=>{delete a.__boundDepthTexture,delete a.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),a.__depthDisposeCallback=t}a.__boundDepthTexture=e}if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?U(a.__webglFramebuffer[0],t):U(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[r]),void 0===a.__webglDepthbuffer[r])a.__webglDepthbuffer[r]=e.createRenderbuffer(),L(a.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=a.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}}else{const r=t.texture.mipmaps;if(r&&r.length>0?n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer),void 0===a.__webglDepthbuffer)a.__webglDepthbuffer=e.createRenderbuffer(),L(a.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=a.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const D=[],O=[];function z(e){return Math.min(a.maxSamples,e.samples)}function H(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function j(e,t){const n=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==uc&&n!==lc&&(Bu.getTransfer(n)===dc?r===tl&&a===zo||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function Q(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=C;return e>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+a.maxTextures),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=E,this.setTexture2DArray=function(t,a){const i=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version?F(i,t,a):n.bindTexture(e.TEXTURE_2D_ARRAY,i.__webglTexture,e.TEXTURE0+a)},this.setTexture3D=function(t,a){const i=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&i.__version!==t.version?F(i,t,a):n.bindTexture(e.TEXTURE_3D,i.__webglTexture,e.TEXTURE0+a)},this.setTextureCube=function(t,s){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,s,o){if(6!==s.image.length)return;const l=T(t,s),c=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=r.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=Bu.getPrimaries(Bu.workingColorSpace),r=s.colorSpace===lc?null:Bu.getPrimaries(s.colorSpace),h=s.colorSpace===lc||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=s.isCompressedTexture||s.image[0].isCompressedTexture,A=s.image[0]&&s.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=d||A?A?s.image[e].image:s.image[e]:f(s.image[e],!0,a.maxCubemapSize),p[e]=j(s,p[e]);const y=p[0],b=i.convert(s.format,s.colorSpace),w=i.convert(s.type),_=v(s.internalFormat,b,w,s.colorSpace),S=!0!==s.isVideoTexture,C=void 0===u.__version||!0===l,E=c.dataReady;let N,B=x(s,y);if(I(e.TEXTURE_CUBE_MAP,s),d){S&&C&&n.texStorage2D(e.TEXTURE_CUBE_MAP,B,_,y.width,y.height);for(let t=0;t<6;t++){N=p[t].mipmaps;for(let r=0;r<N.length;r++){const a=N[r];s.format!==tl?null!==b?S?E&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,b,a.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,a.width,a.height,b,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,a.width,a.height,0,b,w,a.data)}}}else{if(N=s.mipmaps,S&&C){N.length>0&&B++;const t=Q(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,B,_,t.width,t.height)}for(let t=0;t<6;t++)if(A){S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,b,w,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,p[t].width,p[t].height,0,b,w,p[t].data);for(let r=0;r<N.length;r++){const a=N[r].image[t].image;S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,a.width,a.height,b,w,a.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,a.width,a.height,0,b,w,a.data)}}else{S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,b,w,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,b,w,p[t]);for(let r=0;r<N.length;r++){const a=N[r];S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,b,w,a.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,b,w,a.image[t])}}}m(s)&&g(e.TEXTURE_CUBE_MAP),u.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(o,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,a){const i=r.get(t);void 0!==n&&R(i.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==a&&P(t)},this.setupRenderTarget=function(t){const a=t.texture,o=r.get(t),l=r.get(a);t.addEventListener("dispose",_);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=a.version,s.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(a.mipmaps&&a.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<a.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(a.mipmaps&&a.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<a.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=r.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===H(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const a=i.convert(r.format,r.colorSpace),s=i.convert(r.type),l=v(r.internalFormat,a,s,r.colorSpace,!0===t.isXRRenderTarget),u=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),L(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),I(e.TEXTURE_CUBE_MAP,a);for(let n=0;n<6;n++)if(a.mipmaps&&a.mipmaps.length>0)for(let r=0;r<a.mipmaps.length;r++)R(o.__webglFramebuffer[n][r],t,a,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else R(o.__webglFramebuffer[n],t,a,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);m(a)&&g(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let a=0,i=c.length;a<i;a++){const i=c[a],s=r.get(i);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,s.__webglTexture),I(l,i),R(o.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0+a,l,0),m(i)&&g(l)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),I(r,a),a.mipmaps&&a.mipmaps.length>0)for(let n=0;n<a.mipmaps.length;n++)R(o.__webglFramebuffer[n],t,a,e.COLOR_ATTACHMENT0,r,n);else R(o.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0,r,0);m(a)&&g(r),n.unbindTexture()}t.depthBuffer&&P(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let a=0,i=t.length;a<i;a++){const i=t[a];if(m(i)){const t=y(e),a=r.get(i).__webglTexture;n.bindTexture(t,a),g(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===H(t)){const a=t.textures,i=t.width,s=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=a.length>1;if(h)for(let t=0;t<a.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const d=t.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<a.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=r.get(a[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,i,s,0,0,i,s,o,e.NEAREST),!0===l&&(D.length=0,O.length=0,D.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(D.push(c),O.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,O)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,D))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<a.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const i=r.get(a[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,i,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=P,this.setupFrameBufferTexture=R,this.useMultisampledRTT=H}function kw(e,t){return{convert:function(n){let r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lc;const i=Bu.getTransfer(a);if(n===zo)return e.UNSIGNED_BYTE;if(n===qo)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Xo)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Jo)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Zo)return e.UNSIGNED_INT_10F_11F_11F_REV;if(n===Ho)return e.BYTE;if(n===jo)return e.SHORT;if(n===Qo)return e.UNSIGNED_SHORT;if(n===Vo)return e.INT;if(n===Wo)return e.UNSIGNED_INT;if(n===Go)return e.FLOAT;if(n===Ko)return e.HALF_FLOAT;if(n===$o)return e.ALPHA;if(n===el)return e.RGB;if(n===tl)return e.RGBA;if(n===nl)return e.DEPTH_COMPONENT;if(n===rl)return e.DEPTH_STENCIL;if(n===al)return e.RED;if(n===il)return e.RED_INTEGER;if(n===sl)return e.RG;if(n===ol)return e.RG_INTEGER;if(n===cl)return e.RGBA_INTEGER;if(n===ul||n===hl||n===dl||n===Al)if(i===dc){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===ul)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===hl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===dl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Al)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===ul)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===hl)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===dl)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Al)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===pl||n===fl||n===ml||n===gl){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===pl)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===fl)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===ml)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===gl)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===yl||n===vl||n===bl){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===yl||n===vl)return i===dc?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===bl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===xl||n===wl||n===_l||n===Sl||n===Cl||n===El||n===Nl||n===Bl||n===kl||n===Il||n===Tl||n===Ml||n===Fl||n===Rl){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===xl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===wl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===_l)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Sl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Cl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===El)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Nl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Bl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===kl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Il)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Tl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ml)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Fl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Rl)return i===dc?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Ll||n===Ul||n===Pl){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Ll)return i===dc?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Ul)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Pl)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Dl||n===Ol||n===zl||n===Hl){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Dl)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Ol)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===zl)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Hl)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Yo?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class Iw{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new bf(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new sA({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new $d(new Um(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Tw extends $c{constructor(e,t){super();const n=this;let r=null,a=1,i=null,s="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,A=null;const p="undefined"!==typeof XRWebGLBinding,f=new Iw,m={},g=t.getContextAttributes();let y=null,v=null;const b=[],x=[],w=new hu;let _=null;const S=new hA;S.viewport=new Ou;const C=new hA;C.viewport=new Ou;const E=[S,C],N=new wy;let B=null,k=null;function I(e){const t=x.indexOf(e.inputSource);if(-1===t)return;const n=b[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||i),n.dispatchEvent({type:e.type,data:e.inputSource}))}function T(){r.removeEventListener("select",I),r.removeEventListener("selectstart",I),r.removeEventListener("selectend",I),r.removeEventListener("squeeze",I),r.removeEventListener("squeezestart",I),r.removeEventListener("squeezeend",I),r.removeEventListener("end",T),r.removeEventListener("inputsourceschange",M);for(let e=0;e<b.length;e++){const t=x[e];null!==t&&(x[e]=null,b[e].disconnect(t))}B=null,k=null,f.reset();for(const e in m)delete m[e];e.setRenderTarget(y),d=null,h=null,u=null,r=null,v=null,P.stop(),n.isPresenting=!1,e.setPixelRatio(_),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}function M(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=x.indexOf(n);r>=0&&(x[r]=null,b[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=x.indexOf(n);if(-1===r){for(let e=0;e<b.length;e++){if(e>=x.length){x.push(n),r=e;break}if(null===x[e]){x[e]=n,r=e;break}}if(-1===r)break}const a=b[r];a&&a.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new yA,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new yA,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new yA,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||i},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===u&&p&&(u=new XRWebGLBinding(r,t)),u},this.getFrame=function(){return A},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){y=e.getRenderTarget(),r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",T),r.addEventListener("inputsourceschange",M),!0!==g.xrCompatible&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(w);if(p&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,i=null,s=null;g.depth&&(s=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=g.stencil?rl:nl,i=g.stencil?Yo:Wo);const o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:a};u=this.getBinding(),h=u.createProjectionLayer(o),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new Hu(h.textureWidth,h.textureHeight,{format:tl,type:zo,depthTexture:new vf(h.textureWidth,h.textureHeight,i,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:a};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Hu(d.framebufferWidth,d.framebufferHeight,{format:tl,type:zo,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,i=await r.requestReferenceSpace(s),P.setContext(r),P.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const F=new Au,R=new Au;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),N.near=C.near=S.near=t,N.far=C.far=S.far=n,B===N.near&&k===N.far||(r.updateRenderState({depthNear:N.near,depthFar:N.far}),B=N.near,k=N.far),N.layers.mask=6|e.layers.mask,S.layers.mask=3&N.layers.mask,C.layers.mask=5&N.layers.mask;const a=e.parent,i=N.cameras;L(N,a);for(let r=0;r<i.length;r++)L(i[r],a);2===i.length?function(e,t,n){F.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const r=F.distanceTo(R),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,s=a[14]/(a[10]-1),o=a[14]/(a[10]+1),l=(a[9]+1)/a[5],c=(a[9]-1)/a[5],u=(a[8]-1)/a[0],h=(i[8]+1)/i[0],d=s*u,A=s*h,p=r/(-u+h),f=p*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===a[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+p,n=o+p,a=d-f,i=A+(r-f),u=l*o/n*t,h=c*o/n*t;e.projectionMatrix.makePerspective(a,i,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(N,S,C):N.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*ru*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,N,a)},this.getCamera=function(){return N},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(N)},this.getCameraTexture=function(e){return m[e]};let U=null;const P=new tb;P.setAnimationLoop(function(t,a){if(c=a.getViewerPose(l||i),A=a,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let a=!1;t.length!==N.cameras.length&&(N.cameras.length=0,a=!0);for(let n=0;n<t.length;n++){const r=t[n];let i=null;if(null!==d)i=d.getViewport(r);else{const t=u.getViewSubImage(h,r);i=t.viewport,0===n&&(e.setRenderTargetTextures(v,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(v))}let s=E[n];void 0===s&&(s=new hA,s.layers.enable(n),s.viewport=new Ou,E[n]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(i.x,i.y,i.width,i.height),0===n&&(N.matrix.copy(s.matrix),N.matrix.decompose(N.position,N.quaternion,N.scale)),!0===a&&N.cameras.push(s)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&p){u=n.getBinding();const e=u.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&f.init(e,r.renderState)}if(i&&i.includes("camera-access")&&p){e.state.unbindTexture(),u=n.getBinding();for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=m[n];e||(e=new bf,m[n]=e);const t=u.getCameraImage(n);e.sourceTexture=t}}}}for(let e=0;e<b.length;e++){const t=x[e],n=b[e];null!==t&&void 0!==n&&n.update(t,a,l||i)}U&&U(t,a),a.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:a}),A=null}),this.setAnimationLoop=function(e){U=e},this.dispose=function(){}}}const Mw=new kh,Fw=new vh;function Rw(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,r.side===Cs&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),r.side===Cs&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const a=t.get(r),i=a.envMap,s=a.envMapRotation;i&&(e.envMap.value=i,Mw.copy(s),Mw.x*=-1,Mw.y*=-1,Mw.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Mw.y*=-1,Mw.z*=-1),e.envMapRotation.value.setFromMatrix4(Fw.makeRotationFromEuler(Mw)),e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,aA(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,a,i,s,o){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(e,a):a.isMeshToonMaterial?(r(e,a),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,a)):a.isMeshPhongMaterial?(r(e,a),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,a)):a.isMeshStandardMaterial?(r(e,a),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,a),a.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===Cs&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,a,o)):a.isMeshMatcapMaterial?(r(e,a),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,a)):a.isMeshDepthMaterial?r(e,a):a.isMeshDistanceMaterial?(r(e,a),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,a)):a.isMeshNormalMaterial?r(e,a):a.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,a),a.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,a)):a.isPointsMaterial?function(e,t,r,a){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*a,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a,i,s):a.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,a):a.isShadowMaterial?(e.color.value.copy(a.color),e.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function Lw(e,t,n,r){let a={},i={},s=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const a=e.value,i=t+"_"+n;if(void 0===r[i])return r[i]="number"===typeof a||"boolean"===typeof a?a:a.clone(),!0;{const e=r[i];if("number"===typeof a||"boolean"===typeof a){if(e!==a)return r[i]=a,!0}else if(!1===e.equals(a))return e.copy(a),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(a[n.id]),delete a[n.id],delete i[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=a[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let i=0,s=t.length;i<s;i++){const e=Array.isArray(t[i])?t[i]:[t[i]];for(let t=0,a=e.length;t<a;t++){const a=e[t],i=Array.isArray(a.value)?a.value:[a.value];for(let e=0,t=i.length;e<t;e++){const t=c(i[e]),s=n%r,o=s%t.boundary,l=s+o;n+=o,0!==l&&r-l<t.storage&&(n+=r-l),a.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),a.__offset=n,n+=t.storage}}}const a=n%r;a>0&&(n+=r-a);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),a=t.__size,i=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,a,i),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),a[n.id]=d,n.addEventListener("dispose",u));const A=h.program;r.updateUBOMapping(n,A);const p=t.render.frame;i[n.id]!==p&&(!function(t){const n=a[t.id],r=t.uniforms,i=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let a=0,s=r.length;a<s;a++){const t=Array.isArray(r[a])?r[a]:[r[a]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===l(r,a,n,i)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let a=0;for(let i=0;i<n.length;i++){const s=n[i],o=c(s);"number"===typeof s||"boolean"===typeof s?(r.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+a,r.__data)):s.isMatrix3?(r.__data[0]=s.elements[0],r.__data[1]=s.elements[1],r.__data[2]=s.elements[2],r.__data[3]=0,r.__data[4]=s.elements[3],r.__data[5]=s.elements[4],r.__data[6]=s.elements[5],r.__data[7]=0,r.__data[8]=s.elements[6],r.__data[9]=s.elements[7],r.__data[10]=s.elements[8],r.__data[11]=0):(s.toArray(r.__data,a),a+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),i[n.id]=p)},dispose:function(){for(const t in a)e.deleteBuffer(a[t]);s=[],a={},i={}}}}class Uw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=wu(),context:n=null,depth:r=!0,stencil:a=!1,alpha:i=!1,antialias:s=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:h=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=i;const A=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=uo,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const v=this;let b=!1;this._outputColorSpace=cc;let x=0,w=0,_=null,S=-1,C=null;const E=new Ou,N=new Ou;let B=null;const k=new hd(0);let I=0,T=t.width,M=t.height,F=1,R=null,L=null;const U=new Ou(0,0,T,M),P=new Ou(0,0,T,M);let D=!1;const O=new xp;let z=!1,H=!1;const j=new vh,Q=new Au,V=new Ou,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let G=!1;function K(){return null===_?F:1}let q,X,Y,J,Z,$,ee,te,ne,re,ae,ie,se,oe,le,ce,ue,he,de,Ae,pe,fe,me,ge,ye=n;function ve(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(As)),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",_e,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ye){const t="webgl2";if(ye=ve(t,e),null===ye)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(_S){throw console.error("THREE.WebGLRenderer: "+_S.message),_S}function be(){q=new Fb(ye),q.init(),fe=new kw(ye,q),X=new db(ye,q,e,fe),Y=new Nw(ye,q),X.reversedDepthBuffer&&h&&Y.buffers.depth.setReversed(!0),J=new Ub(ye),Z=new pw,$=new Bw(ye,q,Y,Z,X,fe,J),ee=new pb(v),te=new Mb(v),ne=new nb(ye),me=new ub(ye,ne),re=new Rb(ye,ne,J,me),ae=new Db(ye,re,ne,J),de=new Pb(ye,X,$),ce=new Ab(Z),ie=new Aw(v,ee,te,q,X,me,ce),se=new Rw(v,Z),oe=new yw,le=new Sw(q),he=new cb(v,ee,te,Y,ae,d,o),ue=new Cw(v,ae,X),ge=new Lw(ye,J,X,Y),Ae=new hb(ye,q,J),pe=new Lb(ye,q,J),J.programs=ie.programs,v.capabilities=X,v.extensions=q,v.properties=Z,v.renderLists=oe,v.shadowMap=ue,v.state=Y,v.info=J}be();const xe=new Tw(v,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=J.autoReset,t=ue.enabled,n=ue.autoUpdate,r=ue.needsUpdate,a=ue.type;be(),J.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=r,ue.type=a}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){ie.releaseProgram(e)}),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&e.side===Es&&!1===e.forceSinglePass?(e.side=Cs,e.needsUpdate=!0,Ue(e,t,n),e.side=Ss,e.needsUpdate=!0,Ue(e,t,n),e.side=Es):Ue(e,t,n)}this.xr=xe,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(e){void 0!==e&&(F=e,this.setSize(T,M,!1))},this.getSize=function(e){return e.set(T,M)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=e,M=n,t.width=Math.floor(e*F),t.height=Math.floor(n*F),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(T*F,M*F).floor()},this.setDrawingBufferSize=function(e,n,r){T=e,M=n,F=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(U)},this.setViewport=function(e,t,n,r){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,r),Y.viewport(E.copy(U).multiplyScalar(F).round())},this.getScissor=function(e){return e.copy(P)},this.setScissor=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),Y.scissor(N.copy(P).multiplyScalar(F).round())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){Y.setScissorTest(D=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor(...arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==_){const t=_.texture.format;e=t===cl||t===ol||t===il}if(e){const e=_.texture.type,t=e===zo||e===Wo||e===Qo||e===Yo||e===qo||e===Xo,n=he.getClearColor(),r=he.getClearAlpha(),a=n.r,i=n.g,s=n.b;t?(A[0]=a,A[1]=i,A[2]=s,A[3]=r,ye.clearBufferuiv(ye.COLOR,0,A)):(p[0]=a,p[1]=i,p[2]=s,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else n|=ye.COLOR_BUFFER_BIT}e&&(n|=ye.DEPTH_BUFFER_BIT),t&&(n|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",_e,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),he.dispose(),oe.dispose(),le.dispose(),Z.dispose(),ee.dispose(),te.dispose(),ae.dispose(),me.dispose(),ge.dispose(),ie.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Be),xe.removeEventListener("sessionend",ke),Ie.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=W);const s=a.isMesh&&a.matrixWorld.determinant()<0,o=function(e,t,n,r,a){!0!==t.isScene&&(t=W);$.resetTextureUnits();const i=t.fog,s=r.isMeshStandardMaterial?t.environment:null,o=null===_?v.outputColorSpace:!0===_.isXRRenderTarget?_.texture.colorSpace:uc,l=(r.isMeshStandardMaterial?te:ee).get(r.envMap||s),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,A=!!n.morphAttributes.color;let p=uo;r.toneMapped&&(null!==_&&!0!==_.isXRRenderTarget||(p=v.toneMapping));const f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==f?f.length:0,y=Z.get(r),b=m.state.lights;if(!0===z&&(!0===H||e!==C)){const t=e===C&&r.id===S;ce.setState(r,e,t)}let x=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputColorSpace!==o||a.isBatchedMesh&&!1===y.batching?x=!0:a.isBatchedMesh||!0!==y.batching?a.isBatchedMesh&&!0===y.batchingColor&&null===a.colorTexture||a.isBatchedMesh&&!1===y.batchingColor&&null!==a.colorTexture||a.isInstancedMesh&&!1===y.instancing?x=!0:a.isInstancedMesh||!0!==y.instancing?a.isSkinnedMesh&&!1===y.skinning?x=!0:a.isSkinnedMesh||!0!==y.skinning?a.isInstancedMesh&&!0===y.instancingColor&&null===a.instanceColor||a.isInstancedMesh&&!1===y.instancingColor&&null!==a.instanceColor||a.isInstancedMesh&&!0===y.instancingMorph&&null===a.morphTexture||a.isInstancedMesh&&!1===y.instancingMorph&&null!==a.morphTexture||y.envMap!==l||!0===r.fog&&y.fog!==i?x=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ce.numPlanes&&y.numIntersection===ce.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==h||y.morphNormals!==d||y.morphColors!==A||y.toneMapping!==p||y.morphTargetsCount!==g)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,y.__version=r.version);let w=y.currentProgram;!0===x&&(w=Ue(r,t,a));let E=!1,N=!1,B=!1;const k=w.getUniforms(),I=y.uniforms;Y.useProgram(w.program)&&(E=!0,N=!0,B=!0);r.id!==S&&(S=r.id,N=!0);if(E||C!==e){Y.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),k.setValue(ye,"projectionMatrix",e.projectionMatrix),k.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=k.map.cameraPosition;void 0!==t&&t.setValue(ye,Q.setFromMatrixPosition(e.matrixWorld)),X.logarithmicDepthBuffer&&k.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&k.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),C!==e&&(C=e,N=!0,B=!0)}if(a.isSkinnedMesh){k.setOptional(ye,a,"bindMatrix"),k.setOptional(ye,a,"bindMatrixInverse");const e=a.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),k.setValue(ye,"boneTexture",e.boneTexture,$))}a.isBatchedMesh&&(k.setOptional(ye,a,"batchingTexture"),k.setValue(ye,"batchingTexture",a._matricesTexture,$),k.setOptional(ye,a,"batchingIdTexture"),k.setValue(ye,"batchingIdTexture",a._indirectTexture,$),k.setOptional(ye,a,"batchingColorTexture"),null!==a._colorsTexture&&k.setValue(ye,"batchingColorTexture",a._colorsTexture,$));const T=n.morphAttributes;void 0===T.position&&void 0===T.normal&&void 0===T.color||de.update(a,n,w);(N||y.receiveShadow!==a.receiveShadow)&&(y.receiveShadow=a.receiveShadow,k.setValue(ye,"receiveShadow",a.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(I.envMapIntensity.value=t.environmentIntensity);N&&(k.setValue(ye,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&(L=B,(R=I).ambientLightColor.needsUpdate=L,R.lightProbe.needsUpdate=L,R.directionalLights.needsUpdate=L,R.directionalLightShadows.needsUpdate=L,R.pointLights.needsUpdate=L,R.pointLightShadows.needsUpdate=L,R.spotLights.needsUpdate=L,R.spotLightShadows.needsUpdate=L,R.rectAreaLights.needsUpdate=L,R.hemisphereLights.needsUpdate=L),i&&!0===r.fog&&se.refreshFogUniforms(I,i),se.refreshMaterialUniforms(I,r,F,M,m.state.transmissionRenderTarget[e.id]),Qx.upload(ye,Pe(y),I,$));var R,L;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Qx.upload(ye,Pe(y),I,$),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&k.setValue(ye,"center",a.center);if(k.setValue(ye,"modelViewMatrix",a.modelViewMatrix),k.setValue(ye,"normalMatrix",a.normalMatrix),k.setValue(ye,"modelMatrix",a.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ge.update(n,w),ge.bind(n,w)}}return w}(e,t,n,r,a);Y.setMaterial(r,s);let l=n.index,c=1;if(!0===r.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,A=(u.start+u.count)*c;null!==i&&(d=Math.max(d,i.start*c),A=Math.min(A,(i.start+i.count)*c)),null!==l?(d=Math.max(d,0),A=Math.min(A,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),A=Math.min(A,h.count));const p=A-d;if(p<0||p===1/0)return;let f;me.setup(a,r,o,n,l);let g=Ae;if(null!==l&&(f=ne.get(l),g=pe,g.setIndex(f)),a.isMesh)!0===r.wireframe?(Y.setLineWidth(r.wireframeLinewidth*K()),g.setMode(ye.LINES)):g.setMode(ye.TRIANGLES);else if(a.isLine){let e=r.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*K()),a.isLineSegments?g.setMode(ye.LINES):a.isLineLoop?g.setMode(ye.LINE_LOOP):g.setMode(ye.LINE_STRIP)}else a.isPoints?g.setMode(ye.POINTS):a.isSprite&&g.setMode(ye.TRIANGLES);if(a.isBatchedMesh)if(null!==a._multiDrawInstances)Su("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount,a._multiDrawInstances);else if(q.get("WEBGL_multi_draw"))g.renderMultiDraw(a._multiDrawStarts,a._multiDrawCounts,a._multiDrawCount);else{const e=a._multiDrawStarts,t=a._multiDrawCounts,n=a._multiDrawCount,i=l?ne.get(l).bytesPerElement:1,s=Z.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)s.setValue(ye,"_gl_DrawID",r),g.render(e[r]/i,t[r])}else if(a.isInstancedMesh)g.renderInstances(d,p,a.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,p,t)}else g.render(d,p)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),m=le.get(n),m.init(t),y.push(m),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let a=0;a<t.length;a++){const i=t[a];Ee(i,n,e),r.add(i)}else Ee(t,n,e),r.add(t)}),m=y.pop(),r},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==q.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ne=null;function Be(){Ie.stop()}function ke(){Ie.start()}const Ie=new tb;function Te(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);const t=ae.update(e),a=e.material;a.visible&&f.push(e,t,a,n,V.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||O.intersectsObject(e))){const t=ae.update(e),a=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),V.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center)),V.applyMatrix4(e.matrixWorld).applyMatrix4(j)),Array.isArray(a)){const r=t.groups;for(let i=0,s=r.length;i<s;i++){const s=r[i],o=a[s.materialIndex];o&&o.visible&&f.push(e,t,o,n,V.z,s)}}else a.visible&&f.push(e,t,a,n,V.z,null)}const a=e.children;for(let i=0,s=a.length;i<s;i++)Te(a[i],t,n,r)}function Me(e,t,n,r){const a=e.opaque,i=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===z&&ce.setGlobalState(v.clippingPlanes,n),r&&Y.viewport(E.copy(r)),a.length>0&&Re(a,t,n),i.length>0&&Re(i,t,n),s.length>0&&Re(s,t,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Fe(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[r.id]&&(m.state.transmissionRenderTarget[r.id]=new Hu(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")||q.has("EXT_color_buffer_float")?Ko:zo,minFilter:Do,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Bu.workingColorSpace}));const i=m.state.transmissionRenderTarget[r.id],s=r.viewport||E;i.setSize(s.z*v.transmissionResolutionScale,s.w*v.transmissionResolutionScale);const o=v.getRenderTarget(),l=v.getActiveCubeFace(),c=v.getActiveMipmapLevel();v.setRenderTarget(i),v.getClearColor(k),I=v.getClearAlpha(),I<1&&v.setClearColor(16777215,.5),v.clear(),G&&he.render(n);const u=v.toneMapping;v.toneMapping=uo;const h=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),m.setupLightsView(r),!0===z&&ce.setGlobalState(v.clippingPlanes,r),Re(e,n,r),$.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i),!1===q.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let a=0,i=t.length;a<i;a++){const i=t[a],s=i.object,o=i.geometry,l=i.material,c=i.group;if(l.side===Es&&s.layers.test(r.layers)){const t=l.side;l.side=Cs,l.needsUpdate=!0,Le(s,n,r,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&($.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i))}v.setRenderTarget(o,l,c),v.setClearColor(k,I),void 0!==h&&(r.viewport=h),v.toneMapping=u}function Re(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let a=0,i=e.length;a<i;a++){const i=e[a],s=i.object,o=i.geometry,l=i.group;let c=i.material;!0===c.allowOverride&&null!==r&&(c=r),s.layers.test(n.layers)&&Le(s,t,n,o,c,l)}}function Le(e,t,n,r,a,i){e.onBeforeRender(v,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(v,t,n,r,e,i),!0===a.transparent&&a.side===Es&&!1===a.forceSinglePass?(a.side=Cs,a.needsUpdate=!0,v.renderBufferDirect(n,t,r,a,e,i),a.side=Ss,a.needsUpdate=!0,v.renderBufferDirect(n,t,r,a,e,i),a.side=Es):v.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(v,t,n,r,a,i)}function Ue(e,t,n){!0!==t.isScene&&(t=W);const r=Z.get(e),a=m.state.lights,i=m.state.shadowsArray,s=a.state.version,o=ie.getParameters(e,a.state,i,t,n),l=ie.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ce),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return De(e,o),u}else o.uniforms=ie.getUniforms(e),e.onBeforeCompile(o,v),u=ie.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ce.uniform),De(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=a.state.ambient,h.lightProbe.value=a.state.probe,h.directionalLights.value=a.state.directional,h.directionalLightShadows.value=a.state.directionalShadow,h.spotLights.value=a.state.spot,h.spotLightShadows.value=a.state.spotShadow,h.rectAreaLights.value=a.state.rectArea,h.ltc_1.value=a.state.rectAreaLTC1,h.ltc_2.value=a.state.rectAreaLTC2,h.pointLights.value=a.state.point,h.pointLightShadows.value=a.state.pointShadow,h.hemisphereLights.value=a.state.hemi,h.directionalShadowMap.value=a.state.directionalShadowMap,h.directionalShadowMatrix.value=a.state.directionalShadowMatrix,h.spotShadowMap.value=a.state.spotShadowMap,h.spotLightMatrix.value=a.state.spotLightMatrix,h.spotLightMap.value=a.state.spotLightMap,h.pointShadowMap.value=a.state.pointShadowMap,h.pointShadowMatrix.value=a.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Pe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Qx.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function De(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ie.setAnimationLoop(function(e){Ne&&Ne(e)}),"undefined"!==typeof self&&Ie.setContext(self),this.setAnimationLoop=function(e){Ne=e,xe.setAnimationLoop(e),null===e?Ie.stop():Ie.start()},xe.addEventListener("sessionstart",Be),xe.addEventListener("sessionend",ke),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,_),m=le.get(e,y.length),m.init(t),y.push(m),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(j,qc,t.reversedDepth),H=this.localClippingEnabled,z=ce.init(this.clippingPlanes,H),f=oe.get(e,g.length),f.init(),g.push(f),!0===xe.enabled&&!0===xe.isPresenting){const e=v.xr.getDepthSensingMesh();null!==e&&Te(e,t,-1/0,v.sortObjects)}Te(e,t,0,v.sortObjects),f.finish(),!0===v.sortObjects&&f.sort(R,L),G=!1===xe.enabled||!1===xe.isPresenting||!1===xe.hasDepthSensing(),G&&he.addToRenderList(f,e),this.info.render.frame++,!0===z&&ce.beginShadows();const n=m.state.shadowsArray;ue.render(n,e,t),!0===z&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=f.opaque,a=f.transmissive;if(m.setupLights(),t.isArrayCamera){const n=t.cameras;if(a.length>0)for(let t=0,i=n.length;t<i;t++){Fe(r,a,e,n[t])}G&&he.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Me(f,e,r,r.viewport)}}else a.length>0&&Fe(r,a,e,t),G&&he.render(e),Me(f,e,t);null!==_&&0===w&&($.updateMultisampleRenderTarget(_),$.updateRenderTargetMipmap(_)),!0===e.isScene&&e.onAfterRender(v,e,t),me.resetDefaultState(),S=-1,C=null,y.pop(),y.length>0?(m=y[y.length-1],!0===z&&ce.setGlobalState(v.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(e,t,n){const r=Z.get(e);r.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:n,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Oe=ye.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=e,x=t,w=n;let r=!0,a=null,i=!1,s=!1;if(e){const o=Z.get(e);if(void 0!==o.__useDefaultFramebuffer)Y.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1;else if(void 0===o.__webglFramebuffer)$.setupRenderTarget(e);else if(o.__hasExternalTextures)$.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&Z.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");$.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=Array.isArray(c[t])?c[t][n]:c[t],i=!0):a=e.samples>0&&!1===$.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),N.copy(e.scissor),B=e.scissorTest}else E.copy(U).multiplyScalar(F).floor(),N.copy(P).multiplyScalar(F).floor(),B=D;0!==n&&(a=Oe);if(Y.bindFramebuffer(ye.FRAMEBUFFER,a)&&r&&Y.drawBuffers(e,a),Y.viewport(E),Y.scissor(N),Y.setScissorTest(B),i){const r=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){const r=t;for(let t=0;t<e.textures.length;t++){const a=Z.get(e.textures[t]);ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0+t,a.__webglTexture,n,r)}}else if(null!==e&&0!==n){const t=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,t.__webglTexture,n)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,s){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(l=l[s]),l){Y.bindFramebuffer(ye.FRAMEBUFFER,l);try{const s=e.textures[o],l=s.format,c=s.type;if(!X.textureFormatReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!X.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&(e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+o),ye.readPixels(t,n,r,a,fe.convert(l),fe.convert(c),i))}finally{const e=null!==_?Z.get(_).__webglFramebuffer:null;Y.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,a,i,s){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(l=l[s]),l){if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a){Y.bindFramebuffer(ye.FRAMEBUFFER,l);const s=e.textures[o],c=s.format,u=s.type;if(!X.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!X.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.bufferData(ye.PIXEL_PACK_BUFFER,i.byteLength,ye.STREAM_READ),e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+o),ye.readPixels(t,n,r,a,fe.convert(c),fe.convert(u),0);const d=null!==_?Z.get(_).__webglFramebuffer:null;Y.bindFramebuffer(ye.FRAMEBUFFER,d);const A=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t,n){return new Promise(function(r,a){setTimeout(function i(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:a();break;case e.TIMEOUT_EXPIRED:setTimeout(i,n);break;default:r()}},n)})}(ye,A,4),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,i),ye.deleteBuffer(h),ye.deleteSync(A),i}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),a=Math.floor(e.image.width*r),i=Math.floor(e.image.height*r),s=null!==t?t.x:0,o=null!==t?t.y:0;$.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,s,o,a,i),Y.unbindTexture()};const ze=ye.createFramebuffer(),He=ye.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,r,a,i,s,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===p&&(0!==A?(Su("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),p=A,A=0):p=0);const f=e.isCompressedTexture?e.mipmaps[p]:e.image;if(null!==h)n=h.max.x-h.min.x,r=h.max.y-h.min.y,a=h.isBox3?h.max.z-h.min.z:1,i=h.min.x,s=h.min.y,o=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-A);n=Math.floor(f.width*t),r=Math.floor(f.height*t),a=e.isDataArrayTexture?f.depth:e.isData3DTexture?Math.floor(f.depth*t):1,i=0,s=0,o=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const m=fe.convert(t.format),g=fe.convert(t.type);let y;t.isData3DTexture?($.setTexture3D(t,0),y=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?($.setTexture2DArray(t,0),y=ye.TEXTURE_2D_ARRAY):($.setTexture2D(t,0),y=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const v=ye.getParameter(ye.UNPACK_ROW_LENGTH),b=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),x=ye.getParameter(ye.UNPACK_SKIP_PIXELS),w=ye.getParameter(ye.UNPACK_SKIP_ROWS),_=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,f.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,i),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,s),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,o);const S=e.isDataArrayTexture||e.isData3DTexture,C=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=Z.get(e),d=Z.get(t),f=Z.get(h.__renderTarget),m=Z.get(d.__renderTarget);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,f.__webglFramebuffer),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,m.__webglFramebuffer);for(let g=0;g<a;g++)S&&(ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(e).__webglTexture,A,o+g),ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(t).__webglTexture,p,u+g)),ye.blitFramebuffer(i,s,n,r,l,c,n,r,ye.DEPTH_BUFFER_BIT,ye.NEAREST);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else if(0!==A||e.isRenderTargetTexture||Z.has(e)){const h=Z.get(e),d=Z.get(t);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,ze),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,He);for(let e=0;e<a;e++)S?ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,h.__webglTexture,A,o+e):ye.framebufferTexture2D(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,h.__webglTexture,A),C?ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,d.__webglTexture,p,u+e):ye.framebufferTexture2D(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,d.__webglTexture,p),0!==A?ye.blitFramebuffer(i,s,n,r,l,c,n,r,ye.COLOR_BUFFER_BIT,ye.NEAREST):C?ye.copyTexSubImage3D(y,p,l,c,u+e,i,s,n,r):ye.copyTexSubImage2D(y,p,l,c,i,s,n,r);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else C?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(y,p,l,c,u,n,r,a,m,g,f.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(y,p,l,c,u,n,r,a,m,f.data):ye.texSubImage3D(y,p,l,c,u,n,r,a,m,g,f):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,p,l,c,n,r,m,g,f.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,p,l,c,f.width,f.height,m,f.data):ye.texSubImage2D(ye.TEXTURE_2D,p,l,c,n,r,m,g,f);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,v),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,b),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,w),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,_),0===p&&t.generateMipmaps&&ye.generateMipmap(y),Y.unbindTexture()},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&$.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?$.setTextureCube(e,0):e.isData3DTexture?$.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?$.setTexture2DArray(e,0):$.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){x=0,w=0,_=null,Y.reset(),me.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Bu._getDrawingBufferColorSpace(e),t.unpackColorSpace=Bu._getUnpackColorSpace()}}var Pw=n(7205);function Dw(e){let t;const n=new Set,r=(e,r)=>{const a="function"===typeof e?e(t):e;if(a!==t){const e=t;t=r?a:Object.assign({},t,a),n.forEach(n=>n(t,e))}},a=()=>t,i={setState:r,getState:a,subscribe:(e,r,i)=>r||i?function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=r(t);function o(){const n=r(t);if(!i(s,n)){const t=s;e(s=n,t)}}return n.add(o),()=>n.delete(o)}(e,r,i):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,a,i),i}const Ow="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?B.useEffect:B.useLayoutEffect;const zw=[];function Hw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}function jw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(const s of zw)if(Hw(t,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const a={keys:t,equal:r.equal,remove:()=>{const e=zw.indexOf(a);-1!==e&&zw.splice(e,1)},promise:(i=e,"object"===typeof i&&"function"===typeof i.then?e:e(...t)).then(e=>{a.response=e,r.lifespan&&r.lifespan>0&&(a.timeout=setTimeout(a.remove,r.lifespan))}).catch(e=>a.error=e)};var i;if(zw.push(a),!n)throw a.promise}var Qw=n(2016),Vw=n.n(Qw),Ww=n(8784);const Gw=["args","attach"],Kw=["args","children"],qw=["args","children"],Xw=["children","key","ref"],Yw=["children","key","ref"],Jw=["params"];const Zw={};var $w,e_;const t_=e=>"colorSpace"in e||"outputColorSpace"in e,n_=()=>{var e;return null!=(e=Zw.ColorManagement)?e:null},r_=e=>e&&e.isOrthographicCamera,a_="undefined"!==typeof window&&(null!=($w=window.document)&&$w.createElement||"ReactNative"===(null==(e_=window.navigator)?void 0:e_.product))?B.useLayoutEffect:B.useEffect;function i_(e){const t=B.useRef(e);return a_(()=>{t.current=e},[e]),t}function s_(e){let{set:t}=e;return a_(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class o_ extends B.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}o_.getDerivedStateFromError=()=>({error:!0});const l_="__default",c_=new Map,u_=e=>e&&!!e.memoized&&!!e.changes;function h_(e){var t;const n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const d_=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function A_(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const p_={obj:e=>e===Object(e)&&!p_.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,boo:e=>"boolean"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){let{arrays:n="shallow",objects:r="reference",strict:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof e!==typeof t||!!e!==!!t)return!1;if(p_.str(e)||p_.num(e)||p_.boo(e))return e===t;const i=p_.obj(e);if(i&&"reference"===r)return e===t;const s=p_.arr(e);if(s&&"reference"===n)return e===t;if((s||i)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(i&&"shallow"===n&&"shallow"===r){for(o in a?t:e)if(!p_.equ(e[o],t[o],{strict:a,objects:"reference"}))return!1}else for(o in a?t:e)if(e[o]!==t[o])return!1;if(p_.und(o)){if(s&&0===e.length&&0===t.length)return!0;if(i&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function f_(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}function m_(e,t){return e.__r3f=M({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t),e}function g_(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),a=r.pop();return n=r.reduce((e,t)=>e[t],e),{target:n,key:a}}return{target:n,key:t}}const y_=/-\d+$/;function v_(e,t,n){if(p_.str(n)){if(y_.test(n)){const t=n.replace(y_,""),{target:r,key:a}=g_(e,t);Array.isArray(r[a])||(r[a]=[])}const{target:r,key:a}=g_(e,n);t.__r3f.previousAttach=r[a],r[a]=t}else t.__r3f.previousAttach=n(e,t)}function b_(e,t,n){var r,a;if(p_.str(n)){const{target:r,key:a}=g_(e,n),i=t.__r3f.previousAttach;void 0===i?delete r[a]:r[a]=i}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(a=t.__r3f)||delete a.previousAttach}function x_(e,t){let{children:n,key:r,ref:a}=t,i=F(t,Xw),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{children:o,key:l,ref:c}=s,u=F(s,Yw),h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=e.__r3f,A=Object.entries(i),p=[];if(h){const e=Object.keys(u);for(let t=0;t<e.length;t++)i.hasOwnProperty(e[t])||A.unshift([e[t],l_+"remove"])}A.forEach(t=>{let[n,r]=t;var a;if(null!=(a=e.__r3f)&&a.primitive&&"object"===n)return;if(p_.equ(r,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return p.push([n,r,!0,[]]);let s=[];n.includes("-")&&(s=n.split("-")),p.push([n,r,!1,s]);for(const e in i){const t=i[e];e.startsWith("".concat(n,"-"))&&p.push([e,t,!1,e.split("-")])}});const f=M({},i);return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(f.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(f.attach=d.memoizedProps.attach),{memoized:f,changes:p}}const w_="undefined"!==typeof process&&!1;function __(e,t){var n;const r=e.__r3f,a=null==r?void 0:r.root,i=null==a||null==a.getState?void 0:a.getState(),{memoized:s,changes:o}=u_(t)?t:x_(e,t),l=null==r?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let h=0;h<o.length;h++){let[t,n,a,s]=o[h];if(t_(e)){const e=3001,r="srgb",a="srgb-linear";"encoding"===t?(t="colorSpace",n=n===e?r:a):"outputEncoding"===t&&(t="outputColorSpace",n=n===e?r:a)}let l=e,d=l[t];if(s.length&&(d=s.reduce((e,t)=>e[t],e),!d||!d.set)){const[n,...r]=s.reverse();l=r.reverse().reduce((e,t)=>e[t],e),t=n}if(n===l_+"remove")if(l.constructor){let e=c_.get(l.constructor);e||(e=new l.constructor,c_.set(l.constructor,e)),n=e[t]}else n=0;if(a&&r)n?r.handlers[t]=n:delete r.handlers[t],r.eventCount=Object.keys(r.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Ih)){if(Array.isArray(n))d.fromArray?d.fromArray(n):d.set(...n);else if(d.copy&&n&&n.constructor&&(w_?d.constructor.name===n.constructor.name:d.constructor===n.constructor))d.copy(n);else if(void 0!==n){var c;const e=null==(c=d)?void 0:c.isColor;!e&&d.setScalar?d.setScalar(n):d instanceof Ih&&n instanceof Ih?d.mask=n.mask:d.set(n),!n_()&&i&&!i.linear&&e&&d.convertSRGBToLinear()}}else{var u;if(l[t]=n,null!=(u=l[t])&&u.isTexture&&l[t].format===tl&&l[t].type===zo&&i){const e=l[t];t_(e)&&t_(i.gl)?e.colorSpace=i.gl.outputColorSpace:e.encoding=i.gl.outputEncoding}}S_(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const t=A_(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),r.eventCount&&t.interaction.push(e)}return!(1===o.length&&"onUpdate"===o[0][0])&&o.length&&null!=(n=e.__r3f)&&n.parent&&C_(e),e}function S_(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function C_(e){null==e.onUpdate||e.onUpdate(e)}function E_(e,t){e.manual||(r_(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function N_(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function B_(e,t,n,r){const a=n.get(t);a&&(n.delete(t),0===n.size&&(e.delete(r),a.target.releasePointerCapture(r)))}function k_(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f,a=null==r?void 0:r.handlers;if(n.hovered.delete(N_(e)),null!=r&&r.eventCount){const n=M(M({},e),{},{intersections:t});null==a.onPointerOut||a.onPointerOut(n),null==a.onPointerLeave||a.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(i){const{onPointerMissed:s,internal:o}=e.getState();o.lastEvent.current=i;const l="onPointerMove"===a,c="onClick"===a||"onContextMenu"===a||"onDoubleClick"===a,u=function(t,n){const r=e.getState(),a=new Set,i=[],s=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<s.length;e++){const t=d_(s[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let o=s.flatMap(function(e){const n=d_(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=d_(e.object),r=d_(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=N_(e);return!a.has(t)&&(a.add(t),!0)});r.events.filter&&(o=r.events.filter(o,r));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&i.push(M(M({},e),{},{eventObject:t})),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())a.has(N_(e.intersection))||i.push(e.intersection);return i}(i,l?t:void 0),h=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],a=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+a*a))}(i):0;"onPointerDown"===a&&(o.initialClick=[i.offsetX,i.offsetY],o.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&h<=2&&(r(i,o.interaction),s&&s(i)),l&&n(u),function(t,r,a,i){const s=e.getState();if(t.length){const e={stopped:!1};for(const o of t){const l=d_(o.object)||s,{raycaster:c,pointer:u,camera:h,internal:d}=l,A=new Au(u.x,u.y,0).unproject(h),p=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},f=e=>{const t={intersection:o,target:r.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,t):d.capturedMap.set(e,new Map([[o.eventObject,t]])),r.target.setPointerCapture(e)},m=e=>{const t=d.capturedMap.get(e);t&&B_(d.capturedMap,o.eventObject,t,e)};let g={};for(let e in r){let t=r[e];"function"!==typeof t&&(g[e]=t)}let y=M(M(M({},o),g),{},{pointer:u,intersections:t,stopped:e.stopped,delta:a,unprojectedPoint:A,ray:c.ray,camera:h,stopPropagation(){const a="pointerId"in r&&d.capturedMap.get(r.pointerId);(!a||a.has(o.eventObject))&&(y.stopped=e.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...t.slice(0,t.indexOf(o)),o])},target:{hasPointerCapture:p,setPointerCapture:f,releasePointerCapture:m},currentTarget:{hasPointerCapture:p,setPointerCapture:f,releasePointerCapture:m},nativeEvent:r});if(i(y),!0===e.stopped)break}}}(u,i,h,function(e){const t=e.eventObject,n=t.__r3f,s=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(s.onPointerOver||s.onPointerEnter||s.onPointerOut||s.onPointerLeave){const t=N_(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==s.onPointerOver||s.onPointerOver(e),null==s.onPointerEnter||s.onPointerEnter(e))}null==s.onPointerMove||s.onPointerMove(e)}else{const n=s[a];n?c&&!o.initialHits.includes(t)||(r(i,o.interaction.filter(e=>!o.initialHits.includes(e))),n(e)):c&&o.initialHits.includes(t)&&r(i,o.interaction.filter(e=>!o.initialHits.includes(e)))}})}}}}const I_=e=>!(null==e||!e.render),T_=B.createContext(null),M_=(e,t)=>{const n=function(e){const t="function"===typeof e?Dw(e):e,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,B.useReducer)(e=>e+1,0),a=t.getState(),i=(0,B.useRef)(a),s=(0,B.useRef)(e),o=(0,B.useRef)(n),l=(0,B.useRef)(!1),c=(0,B.useRef)();let u;void 0===c.current&&(c.current=e(a));let h=!1;(i.current!==a||s.current!==e||o.current!==n||l.current)&&(u=e(a),h=!n(c.current,u)),Ow(()=>{h&&(c.current=u),i.current=a,s.current=e,o.current=n,l.current=!1});const d=(0,B.useRef)(a);Ow(()=>{const e=()=>{try{const e=t.getState(),n=s.current(e);o.current(c.current,n)||(i.current=e,c.current=n,r())}catch(_S){l.current=!0,r()}},n=t.subscribe(e);return t.getState()!==d.current&&e(),n},[]);const A=h?u:c.current;return(0,B.useDebugValue)(A),A};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}((n,r)=>{const a=new Au,i=new Au,s=new Au;function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:o,height:l,top:c,left:u}=n,h=o/l;t.isVector3?s.copy(t):s.set(...t);const d=e.getWorldPosition(a).distanceTo(s);if(r_(e))return{width:o/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*d,r=n*(o/l);return{width:r,height:n,top:c,left:u,factor:o/r,distance:d,aspect:h}}}let l;const c=e=>n(t=>({performance:M(M({},t.performance),{},{current:e})})),u=new hu,h={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new _y,pointer:u,mouse:u,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();l&&clearTimeout(l),e.performance.current!==e.performance.min&&c(e.performance.min),l=setTimeout(()=>c(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:o},setEvents:e=>n(t=>M(M({},t),{},{events:M(M({},t.events),e)})),setSize:(e,t,a,s,l)=>{const c=r().camera,u={width:e,height:t,top:s||0,left:l||0,updateStyle:a};n(e=>({size:u,viewport:M(M({},e.viewport),o(c,i,u))}))},setDpr:e=>n(t=>{const n=h_(e);return{viewport:M(M({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:B.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const a=r().internal;return a.priority=a.priority+(t>0?1:0),a.subscribers.push({ref:e,priority:t,store:n}),a.subscribers=a.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return h}),r=n.getState();let a=r.size,i=r.viewport.dpr,s=r.camera;return n.subscribe(()=>{const{camera:e,size:t,viewport:r,gl:o,set:l}=n.getState();if(t.width!==a.width||t.height!==a.height||r.dpr!==i){var c;a=t,i=r.dpr,E_(e,t),o.setPixelRatio(r.dpr);const n=null!=(c=t.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&o.domElement instanceof HTMLCanvasElement;o.setSize(t.width,t.height,n)}e!==s&&(s=e,l(t=>({viewport:M(M({},t.viewport),t.viewport.getCurrentViewport(e))})))}),n.subscribe(t=>e(t)),n};let F_,R_=new Set,L_=new Set,U_=new Set;function P_(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function D_(e,t){switch(e){case"before":return P_(R_,t);case"after":return P_(L_,t);case"tail":return P_(U_,t)}}let O_,z_;function H_(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),O_=t.internal.subscribers,F_=0;F_<O_.length;F_++)z_=O_[F_],z_.ref.current(z_.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function j_(){const e=B.useContext(T_);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Q_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return j_()(e,t)}function V_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=j_(),r=n.getState().internal.subscribe,a=i_(e);return a_(()=>r(a,t,n),[t,r,n]),null}const W_=new WeakMap;function G_(e,t){return function(n){let r=W_.get(n);r||(r=new n,W_.set(n,r)),e&&e(r);for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];return Promise.all(i.map(e=>new Promise((n,a)=>r.load(e,e=>{e.scene&&Object.assign(e,f_(e.scene)),n(e)},t,t=>a(new Error("Could not load ".concat(e,": ").concat(null==t?void 0:t.message)))))))}}function K_(e,t,n,r){const a=Array.isArray(t)?t:[t],i=((e,t,n)=>jw(e,t,!1,n))(G_(n,r),[e,...a],{equal:p_.equ});return Array.isArray(t)?i:i[0]}K_.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return((e,t,n)=>{jw(e,t,!0,n)})(G_(n),[e,...r])},K_.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)zw.splice(0,zw.length);else{const t=zw.find(t=>Hw(e,t.keys,t.equal));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const q_=new Map,{invalidate:X_,advance:Y_}=function(e){let t,n,r,a=!1,i=!1;function s(o){n=requestAnimationFrame(s),a=!0,t=0,D_("before",o),i=!0;for(const n of e.values()){var l;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=H_(o,r))}if(i=!1,D_("after",o),0===t)return D_("tail",o),a=!1,cancelAnimationFrame(n)}return{loop:s,invalidate:function t(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var o;if(!n)return e.forEach(e=>t(e.store.getState(),r));null!=(o=n.gl.xr)&&o.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):i?2:1,a||(a=!0,requestAnimationFrame(s)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(n&&D_("before",t),r)H_(t,r,a);else for(const i of e.values())H_(t,i.store.getState());n&&D_("after",t)}}}(q_),{reconciler:J_,applyProps:Z_}=function(e,t){function n(e,t,n){let r,{args:a=[],attach:i}=t,s=F(t,Gw),o="".concat(e[0].toUpperCase()).concat(e.slice(1));if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");r=m_(s.object,{type:e,root:n,attach:i,primitive:!0})}else{const t=Zw[o];if(!t)throw new Error("R3F: ".concat(o," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(a))throw new Error("R3F: The args prop must be an array!");r=m_(new t(...a),{type:e,root:n,attach:i,memoizedProps:{args:a}})}return void 0===r.__r3f.attach&&(r.isBufferGeometry?r.__r3f.attach="geometry":r.isMaterial&&(r.__r3f.attach="material")),"inject"!==o&&__(r,s),r}function r(e,t){let n=!1;var r,a;t&&(null!=(r=t.__r3f)&&r.attach?v_(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||m_(t,{}),t.__r3f.parent=e,C_(t),S_(t))}function a(e,t,n){let r=!1;if(t){var a,i;if(null!=(a=t.__r3f)&&a.attach)v_(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const a=e.children.filter(e=>e!==t),i=a.indexOf(n);e.children=[...a.slice(0,i),t,...a.slice(i)],r=!0}r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||m_(t,{}),t.__r3f.parent=e,C_(t),S_(t)}}function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach(e=>s(t,e,n))}function s(e,t,n){if(t){var r,a,s;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(a=t.__r3f)&&a.attach)b_(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var o;e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{B_(n.capturedMap,t,e,r)})}(A_(t),t)}const c=null==(s=t.__r3f)?void 0:s.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)i(null==(l=t.__r3f)?void 0:l.objects,t,u),i(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,Ww.unstable_scheduleCallback)(Ww.unstable_IdlePriority,e):e()}S_(e)}}const o=()=>{};return{reconciler:Vw()({createInstance:n,removeChild:s,appendChild:r,appendInitialChild:r,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&s(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&a(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var a;if((null!=(a=null==e?void 0:e.__r3f)?a:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:a}=r,i=F(r,Kw),{args:s=[],children:o}=n,l=F(n,qw);if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==s[t]))return[!0];const c=x_(e,i,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,t,a,i,o,l){let[c,u]=t;c?function(e,t,a,i){var o;const l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;const c=n(t,a,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(c,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>r(c,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||s(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),r(l,c),c.raycast&&c.__r3f.eventCount&&A_(c).getState().internal.interaction.push(c);[i,i.alternate].forEach(e=>{null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))})}(e,a,o,l):__(e,u)},commitMount(e,t,n,r){var a;const i=null!=(a=e.__r3f)?a:{};e.raycast&&i.handlers&&i.eventCount&&A_(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>m_(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&b_(r,e,n),e.isObject3D&&(e.visible=!1),S_(e)},unhideInstance(e,t){var n;const{attach:r,parent:a}=null!=(n=e.__r3f)?n:{};r&&a&&v_(a,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),S_(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():Pw.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&p_.fun(performance.now)?performance.now:p_.fun(Date.now)?Date.now:()=>0,scheduleTimeout:p_.fun(setTimeout)?setTimeout:void 0,cancelTimeout:p_.fun(clearTimeout)?clearTimeout:void 0}),applyProps:__}}(0,function(){var e;const t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return Pw.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Pw.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Pw.ContinuousEventPriority;default:return Pw.DefaultEventPriority}}),$_={objects:"shallow",strict:!1},eS=(e,t)=>{const n="function"===typeof e?e(t):e;return I_(n)?n:new Uw(M({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function tS(e){const t=q_.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a="function"===typeof reportError?reportError:console.error,i=r||M_(X_,Y_),s=n||J_.createContainer(i,Pw.ConcurrentRoot,null,!1,null,"",a,null);let o;t||q_.set(e,{fiber:s,store:i});let l,c=!1;return{configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:r,scene:a,events:s,onCreated:u,shadows:h=!1,linear:d=!1,flat:A=!1,legacy:p=!1,orthographic:f=!1,frameloop:m="always",dpr:g=[1,2],performance:y,raycaster:v,camera:b,onPointerMissed:x}=t,w=i.getState(),_=w.gl;w.gl||w.set({gl:_=eS(n,e)});let S=w.raycaster;S||w.set({raycaster:S=new nv});const C=v||{},{params:E}=C,N=F(C,Jw);if(p_.equ(N,S,$_)||Z_(S,M({},N)),p_.equ(E,S.params,$_)||Z_(S,{params:M(M({},S.params),E)}),!w.camera||w.camera===l&&!p_.equ(l,b,$_)){l=b;const e=b instanceof oA,t=e?b:f?new Zg(0,0,0,0,.1,1e3):new hA(75,0,.1,1e3);e||(t.position.z=5,b&&(Z_(t,b),("aspect"in b||"left"in b||"right"in b||"bottom"in b||"top"in b)&&(t.manual=!0,t.updateProjectionMatrix())),w.camera||null!=b&&b.rotation||t.lookAt(0,0,0)),w.set({camera:t}),S.camera=t}if(!w.scene){let e;null!=a&&a.isScene?e=a:(e=new xA,a&&Z_(e,a)),w.set({scene:m_(e)})}if(!w.xr){var B;const e=(e,t)=>{const n=i.getState();"never"!==n.frameloop&&Y_(e,!0,n,t)},t=()=>{const t=i.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||X_(t)},n={connect(){const e=i.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=i.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"===typeof(null==(B=_.xr)?void 0:B.addEventListener)&&n.connect(),w.set({xr:n})}if(_.shadowMap){const e=_.shadowMap.enabled,t=_.shadowMap.type;if(_.shadowMap.enabled=!!h,p_.boo(h))_.shadowMap.type=ws;else if(p_.str(h)){var k;const e={basic:bs,percentage:xs,soft:ws,variance:_s};_.shadowMap.type=null!=(k=e[h])?k:ws}else p_.obj(h)&&Object.assign(_.shadowMap,h);e===_.shadowMap.enabled&&t===_.shadowMap.type||(_.shadowMap.needsUpdate=!0)}const I=n_();if(I&&("enabled"in I?I.enabled=!p:"legacyMode"in I&&(I.legacyMode=p)),!c){Z_(_,{outputEncoding:d?3e3:3001,toneMapping:A?uo:fo})}w.legacy!==p&&w.set(()=>({legacy:p})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==A&&w.set(()=>({flat:A})),!n||p_.fun(n)||I_(n)||p_.equ(n,_,$_)||Z_(_,n),s&&!w.events.handlers&&w.set({events:s(i)});const T=function(e,t){const n="undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:a,left:i,updateStyle:s=n}=t;return{width:e,height:r,top:a,left:i,updateStyle:s}}if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:a,left:i}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:a,left:i,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return p_.equ(T,w.size,$_)||w.setSize(T.width,T.height,T.updateStyle,T.top,T.left),g&&w.viewport.dpr!==h_(g)&&w.setDpr(g),w.frameloop!==m&&w.setFrameloop(m),w.onPointerMissed||w.set({onPointerMissed:x}),y&&!p_.equ(y,w.performance,$_)&&w.set(e=>({performance:M(M({},e.performance),y)})),o=u,c=!0,this},render(t){return c||this.configure(),J_.updateContainer((0,yi.jsx)(nS,{store:i,children:t,onCreated:o,rootElement:e}),s,null,()=>{}),i},unmount(){rS(e)}}}function nS(e){let{store:t,children:n,onCreated:r,rootElement:a}=e;return a_(()=>{const e=t.getState();e.set(e=>({internal:M(M({},e.internal),{},{active:!0})})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(a)},[]),(0,yi.jsx)(T_.Provider,{value:t,children:n})}function rS(e,t){const n=q_.get(e),r=null==n?void 0:n.fiber;if(r){const a=null==n?void 0:n.store.getState();a&&(a.internal.active=!1),J_.updateContainer(null,r,null,()=>{a&&setTimeout(()=>{try{var n,r,i,s;null==a.events.disconnect||a.events.disconnect(),null==(n=a.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=a.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(s=a.gl)&&s.xr&&a.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(a),q_.delete(e),t&&t(e)}catch(o){}},500)})}}J_.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:B.version});B.unstable_act;const aS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function iS(e){const{handlePointer:t}=k_(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(aS).reduce((e,n)=>M(M({},e),{},{[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:a}=e.getState();null==a.disconnect||a.disconnect(),r(e=>({events:M(M({},e.events),{},{connected:t})})),Object.entries(null!=(n=a.handlers)?n:[]).forEach(e=>{let[n,r]=e;const[a,i]=aS[n];t.addEventListener(a,r,{passive:i})})},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach(e=>{let[t,r]=e;if(n&&n.connected instanceof HTMLElement){const[e]=aS[t];n.connected.removeEventListener(e,r)}}),t(e=>({events:M(M({},e.events),{},{connected:void 0})})))}}}function sS(e,t){let n;return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];window.clearTimeout(n),n=window.setTimeout(()=>e(...a),t)}}function oS(){let{debounce:e,scroll:t,polyfill:n,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const a=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[i,s]=(0,B.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=(0,B.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i,orientationHandler:null}),l=e?"number"==typeof e?e:e.scroll:null,c=e?"number"==typeof e?e:e.resize:null,u=(0,B.useRef)(!1);(0,B.useEffect)(()=>(u.current=!0,()=>{u.current=!1}));const[h,d,A]=(0,B.useMemo)(()=>{const e=()=>{if(!o.current.element)return;const{left:e,top:t,width:n,height:a,bottom:i,right:l,x:c,y:h}=o.current.element.getBoundingClientRect(),d={left:e,top:t,width:n,height:a,bottom:i,right:l,x:c,y:h};o.current.element instanceof HTMLElement&&r&&(d.height=o.current.element.offsetHeight,d.width=o.current.element.offsetWidth),Object.freeze(d),u.current&&!uS(o.current.lastBounds,d)&&s(o.current.lastBounds=d)};return[e,c?sS(e,c):e,l?sS(e,l):e]},[s,r,l,c]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",A,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function f(){o.current.element&&(o.current.resizeObserver=new a(A),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(e=>e.addEventListener("scroll",A,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{A()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}return function(e,t){(0,B.useEffect)(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(A,!!t),function(e){(0,B.useEffect)(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(d),(0,B.useEffect)(()=>{p(),f()},[t,A,d]),(0,B.useEffect)(()=>p,[]),[e=>{!e||e===o.current.element||(p(),o.current.element=e,o.current.scrollContainers=lS(e),f())},i,h]}function lS(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:a}=window.getComputedStyle(e);return[n,r,a].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...lS(e.parentElement)]}const cS=["x","y","top","bottom","left","right","width","height"],uS=(e,t)=>cS.every(n=>e[n]===t[n]);var hS,dS,AS=Object.defineProperty,pS=Object.defineProperties,fS=Object.getOwnPropertyDescriptors,mS=Object.getOwnPropertySymbols,gS=Object.prototype.hasOwnProperty,yS=Object.prototype.propertyIsEnumerable,vS=(e,t,n)=>t in e?AS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bS=(e,t)=>{for(var n in t||(t={}))gS.call(t,n)&&vS(e,n,t[n]);if(mS)for(var n of mS(t))yS.call(t,n)&&vS(e,n,t[n]);return e};"undefined"===typeof window||!(null==(hS=window.document)?void 0:hS.createElement)&&"ReactNative"!==(null==(dS=window.navigator)?void 0:dS.product)?B.useEffect:B.useLayoutEffect;function xS(e,t,n){if(!e)return;if(!0===n(e))return e;let r=t?e.return:e.child;for(;r;){const e=xS(r,t,n);if(e)return e;r=t?null:r.sibling}}function wS(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(nle){return e}}const _S=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return _S.apply(this,arguments);console.error=_S};const SS=wS(B.createContext(null));class CS extends B.Component{render(){return B.createElement(SS.Provider,{value:this._reactInternals},this.props.children)}}function ES(){const e=B.useContext(SS);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=B.useId();return B.useMemo(()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=xS(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}function NS(){const e=function(){const e=ES(),[t]=B.useState(()=>new Map);t.clear();let n=e;for(;n;){if(n.type&&"object"===typeof n.type){const e=void 0===n.type._context&&n.type.Provider===n.type?n.type:n.type._context;e&&e!==SS&&!t.has(e)&&t.set(e,B.useContext(wS(e)))}n=n.return}return t}();return B.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>B.createElement(t,null,B.createElement(n.Provider,((e,t)=>pS(e,fS(t)))(bS({},r),{value:e.get(n)}))),e=>B.createElement(CS,bS({},e))),[e])}const BS=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],kS=B.forwardRef(function(t,n){let{children:r,fallback:a,resize:i,style:s,gl:o,events:l=iS,eventSource:c,eventPrefix:u,shadows:h,linear:d,flat:A,legacy:p,orthographic:f,frameloop:m,dpr:g,performance:y,raycaster:v,camera:b,scene:x,onPointerMissed:w,onCreated:_}=t,S=F(t,BS);B.useMemo(()=>{return t=e,void Object.assign(Zw,t);var t},[]);const C=NS(),[E,N]=oS(M({scroll:!0,debounce:{scroll:50,resize:0}},i)),k=B.useRef(null),I=B.useRef(null);B.useImperativeHandle(n,()=>k.current);const T=i_(w),[R,L]=B.useState(!1),[U,P]=B.useState(!1);if(R)throw R;if(U)throw U;const D=B.useRef(null);a_(()=>{const e=k.current;N.width>0&&N.height>0&&e&&(D.current||(D.current=tS(e)),D.current.configure({gl:o,events:l,shadows:h,linear:d,flat:A,legacy:p,orthographic:f,frameloop:m,dpr:g,performance:y,raycaster:v,camera:b,scene:x,size:N,onPointerMissed:function(){return null==T.current?void 0:T.current(...arguments)},onCreated:e=>{var t;null==e.events.connect||e.events.connect(c?(t=c)&&t.hasOwnProperty("current")?c.current:c:I.current),u&&e.setEvents({compute:(e,t)=>{const n=e[u+"X"],r=e[u+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==_||_(e)}}),D.current.render((0,yi.jsx)(C,{children:(0,yi.jsx)(o_,{set:P,children:(0,yi.jsx)(B.Suspense,{fallback:(0,yi.jsx)(s_,{set:L}),children:null!=r?r:null})})})))}),B.useEffect(()=>{const e=k.current;if(e)return()=>rS(e)},[]);const O=c?"none":"auto";return(0,yi.jsx)("div",M(M({ref:I,style:M({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:O},s)},S),{},{children:(0,yi.jsx)("div",{ref:E,style:{width:"100%",height:"100%"},children:(0,yi.jsx)("canvas",{ref:k,style:{display:"block"},children:a})})}))}),IS=B.forwardRef(function(e,t){return(0,yi.jsx)(CS,{children:(0,yi.jsx)(kS,M(M({},e),{},{ref:t}))})}),TS=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function MS(e,t){const n=Q_(e=>e.gl),r=K_(Dg,TS(e)?Object.values(e):e);(0,B.useLayoutEffect)(()=>{null==t||t(r)},[t]),(0,B.useEffect)(()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof Du?e=[r]:TS(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof Du&&n.initTexture(e)})}},[n,r]);const a=(0,B.useMemo)(()=>{if(TS(e)){const t={};let n=0;for(const a in e)t[a]=r[n++];return t}return r},[e,r]);return a}MS.preload=e=>K_.preload(Dg,e),MS.clear=e=>K_.clear(Dg,e);function FS(){return FS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},FS.apply(null,arguments)}const RS=["args","children"];function LS(e,t){const n=e+"Geometry";return B.forwardRef((e,r)=>{let{args:a,children:i}=e,s=F(e,RS);const o=B.useRef(null);return B.useImperativeHandle(r,()=>o.current),B.useLayoutEffect(()=>{null==t||t(o.current)}),B.createElement("mesh",FS({ref:o},s),B.createElement(n,{attach:"geometry",args:a}),i)})}const US=LS("sphere"),PS=["samples","depth"];function DS(e,t,n){const r=Q_(e=>e.size),a=Q_(e=>e.viewport),i="number"===typeof e?e:r.width*a.dpr,s="number"===typeof t?t:r.height*a.dpr,o=("number"===typeof e?n:e)||{},{samples:l=0,depth:c}=o,u=F(o,PS),h=B.useMemo(()=>{const e=new Hu(i,s,M({minFilter:Lo,magFilter:Lo,type:Ko},u));return c&&(e.depthTexture=new vf(i,s,Go)),e.samples=l,e},[]);return B.useLayoutEffect(()=>{h.setSize(i,s),l&&(h.samples=l)},[l,h,i,s]),B.useEffect(()=>()=>h.dispose(),[]),h}const OS=["envMap","resolution","frames","makeDefault","children"],zS=B.forwardRef((e,t)=>{let{envMap:n,resolution:r=256,frames:a=1/0,makeDefault:i,children:s}=e,o=F(e,OS);const l=Q_(e=>{let{set:t}=e;return t}),c=Q_(e=>{let{camera:t}=e;return t}),u=Q_(e=>{let{size:t}=e;return t}),h=B.useRef(null);B.useImperativeHandle(t,()=>h.current,[]);const d=B.useRef(null),A=DS(r);B.useLayoutEffect(()=>{o.manual||(h.current.aspect=u.width/u.height)},[u,o]),B.useLayoutEffect(()=>{h.current.updateProjectionMatrix()});let p=0,f=null;const m="function"===typeof s;return V_(e=>{m&&(a===1/0||p<a)&&(d.current.visible=!1,e.gl.setRenderTarget(A),f=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,h.current),e.scene.background=f,e.gl.setRenderTarget(null),d.current.visible=!0,p++)}),B.useLayoutEffect(()=>{if(i){const e=c;return l(()=>({camera:h.current})),()=>l(()=>({camera:e}))}},[h,i,l]),B.createElement(B.Fragment,null,B.createElement("perspectiveCamera",FS({ref:h},o),!m&&s),B.createElement("group",{ref:d},m&&s(A.texture)))});var HS=Object.defineProperty,jS=(e,t,n)=>(((e,t,n)=>{t in e?HS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class QS{constructor(){jS(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}var VS=Object.defineProperty,WS=(e,t,n)=>(((e,t,n)=>{t in e?VS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const GS=new yh,KS=new gp,qS=Math.cos(Math.PI/180*70),XS=(e,t)=>(e%t+t)%t;class YS extends QS{constructor(e,t){super(),WS(this,"object"),WS(this,"domElement"),WS(this,"enabled",!0),WS(this,"target",new Au),WS(this,"minDistance",0),WS(this,"maxDistance",1/0),WS(this,"minZoom",0),WS(this,"maxZoom",1/0),WS(this,"minPolarAngle",0),WS(this,"maxPolarAngle",Math.PI),WS(this,"minAzimuthAngle",-1/0),WS(this,"maxAzimuthAngle",1/0),WS(this,"enableDamping",!1),WS(this,"dampingFactor",.05),WS(this,"enableZoom",!0),WS(this,"zoomSpeed",1),WS(this,"enableRotate",!0),WS(this,"rotateSpeed",1),WS(this,"enablePan",!0),WS(this,"panSpeed",1),WS(this,"screenSpacePanning",!0),WS(this,"keyPanSpeed",7),WS(this,"zoomToCursor",!1),WS(this,"autoRotate",!1),WS(this,"autoRotateSpeed",2),WS(this,"reverseOrbit",!1),WS(this,"reverseHorizontalOrbit",!1),WS(this,"reverseVerticalOrbit",!1),WS(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),WS(this,"mouseButtons",{LEFT:ps.ROTATE,MIDDLE:ps.DOLLY,RIGHT:ps.PAN}),WS(this,"touches",{ONE:fs.ROTATE,TWO:fs.DOLLY_PAN}),WS(this,"target0"),WS(this,"position0"),WS(this,"zoom0"),WS(this,"_domElementKeyEvents",null),WS(this,"getPolarAngle"),WS(this,"getAzimuthalAngle"),WS(this,"setPolarAngle"),WS(this,"setAzimuthalAngle"),WS(this,"getDistance"),WS(this,"getZoomScale"),WS(this,"listenToKeyEvents"),WS(this,"stopListenToKeyEvents"),WS(this,"saveState"),WS(this,"reset"),WS(this,"update"),WS(this,"connect"),WS(this,"dispose"),WS(this,"dollyIn"),WS(this,"dollyOut"),WS(this,"getScale"),WS(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=XS(e,2*Math.PI),r=c.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-r);2*Math.PI-a<a&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=XS(e,2*Math.PI),r=c.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let a=Math.abs(t-r);2*Math.PI-a<a&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Y),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Y),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),o=s.NONE},this.update=(()=>{const t=new Au,a=new Au(0,1,0),i=(new du).setFromUnitVectors(e.up,a),A=i.clone().invert(),p=new Au,f=new du,m=2*Math.PI;return function(){const g=n.object.position;i.setFromUnitVectors(e.up,a),A.copy(i).invert(),t.copy(g).sub(n.target),t.applyQuaternion(i),c.setFromVector3(t),n.autoRotate&&o===s.NONE&&B(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=n.minAzimuthAngle,v=n.maxAzimuthAngle;isFinite(y)&&isFinite(v)&&(y<-Math.PI?y+=m:y>Math.PI&&(y-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),c.theta=y<=v?Math.max(y,Math.min(v,c.theta)):c.theta>(y+v)/2?Math.max(y,c.theta):Math.min(v,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&S||n.object.isOrthographicCamera?c.radius=P(c.radius):c.radius=P(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(A),g.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0));let b=!1;if(n.zoomToCursor&&S){let r=null;if(n.object instanceof hA&&n.object.isPerspectiveCamera){const e=t.length();r=P(e*h);const a=e-r;n.object.position.addScaledVector(w,a),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new Au(_.x,_.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix(),b=!0;const a=new Au(_.x,_.y,0);a.unproject(n.object),n.object.position.sub(a).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(GS.origin.copy(n.object.position),GS.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(GS.direction))<qS?e.lookAt(n.target):(KS.setFromNormalAndCoplanarPoint(n.object.up,n.target),GS.intersectPlane(KS,n.target))))}else n.object instanceof Zg&&n.object.isOrthographicCamera&&(b=1!==h,b&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix()));return h=1,S=!1,!!(b||p.distanceToSquared(n.object.position)>l||8*(1-f.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),p.copy(n.object.position),f.copy(n.object.quaternion),b=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",J),n.domElement.addEventListener("pointerdown",G),n.domElement.addEventListener("pointercancel",q),n.domElement.addEventListener("wheel",X)},this.dispose=()=>{var e,t,r,a,i,s;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",J),null==(t=n.domElement)||t.removeEventListener("pointerdown",G),null==(r=n.domElement)||r.removeEventListener("pointercancel",q),null==(a=n.domElement)||a.removeEventListener("wheel",X),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",K),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointerup",q),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Y)};const n=this,r={type:"change"},a={type:"start"},i={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const l=1e-6,c=new ov,u=new ov;let h=1;const d=new Au,A=new hu,p=new hu,f=new hu,m=new hu,g=new hu,y=new hu,v=new hu,b=new hu,x=new hu,w=new Au,_=new hu;let S=!1;const C=[],E={};function N(){return Math.pow(.95,n.zoomSpeed)}function B(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function k(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const I=(()=>{const e=new Au;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}})(),T=(()=>{const e=new Au;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}})(),M=(()=>{const e=new Au;return function(t,r){const a=n.domElement;if(a&&n.object instanceof hA&&n.object.isPerspectiveCamera){const i=n.object.position;e.copy(i).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),I(2*t*s/a.clientHeight,n.object.matrix),T(2*r*s/a.clientHeight,n.object.matrix)}else a&&n.object instanceof Zg&&n.object.isOrthographicCamera?(I(t*(n.object.right-n.object.left)/n.object.zoom/a.clientWidth,n.object.matrix),T(r*(n.object.top-n.object.bottom)/n.object.zoom/a.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function F(e){n.object instanceof hA&&n.object.isPerspectiveCamera||n.object instanceof Zg&&n.object.isOrthographicCamera?h=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){F(h/e)}function L(e){F(h*e)}function U(e){if(!n.zoomToCursor||!n.domElement)return;S=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top,i=t.width,s=t.height;_.x=r/i*2-1,_.y=-a/s*2+1,w.set(_.x,_.y,1).unproject(n.object).sub(n.object.position).normalize()}function P(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function D(e){A.set(e.clientX,e.clientY)}function O(e){m.set(e.clientX,e.clientY)}function z(){if(1==C.length)A.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);A.set(e,t)}}function H(){if(1==C.length)m.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);m.set(e,t)}}function j(){const e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,n=Math.sqrt(e*e+t*t);v.set(0,n)}function Q(e){if(1==C.length)p.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}f.subVectors(p,A).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(B(2*Math.PI*f.x/t.clientHeight),k(2*Math.PI*f.y/t.clientHeight)),A.copy(p)}function V(e){if(1==C.length)g.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(n,r)}y.subVectors(g,m).multiplyScalar(n.panSpeed),M(y.x,y.y),m.copy(g)}function W(e){const t=$(e),r=e.pageX-t.x,a=e.pageY-t.y,i=Math.sqrt(r*r+a*a);b.set(0,i),x.set(0,Math.pow(b.y/v.y,n.zoomSpeed)),R(x.y),v.copy(b)}function G(e){var t,r;!1!==n.enabled&&(0===C.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",K),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",q)),function(e){C.push(e)}(e),"touch"===e.pointerType?function(e){switch(Z(e),C.length){case 1:switch(n.touches.ONE){case fs.ROTATE:if(!1===n.enableRotate)return;z(),o=s.TOUCH_ROTATE;break;case fs.PAN:if(!1===n.enablePan)return;H(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case fs.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&j(),n.enablePan&&H(),o=s.TOUCH_DOLLY_PAN;break;case fs.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&j(),n.enableRotate&&z(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(a)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case ps.DOLLY:if(!1===n.enableZoom)return;!function(e){U(e),v.set(e.clientX,e.clientY)}(e),o=s.DOLLY;break;case ps.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;O(e),o=s.PAN}else{if(!1===n.enableRotate)return;D(e),o=s.ROTATE}break;case ps.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;D(e),o=s.ROTATE}else{if(!1===n.enablePan)return;O(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(a)}(e))}function K(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Z(e),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;Q(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;V(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&W(e),n.enablePan&&V(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&W(e),n.enableRotate&&Q(e)}(e),n.update();break;default:o=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,A).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(B(2*Math.PI*f.x/t.clientHeight),k(2*Math.PI*f.y/t.clientHeight)),A.copy(p),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,v),x.y>0?R(N()):x.y<0&&L(N()),v.copy(b),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){g.set(e.clientX,e.clientY),y.subVectors(g,m).multiplyScalar(n.panSpeed),M(y.x,y.y),m.copy(g),n.update()}(e)}}(e))}function q(e){var t,r,a;!function(e){delete E[e.pointerId];for(let t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}(e),0===C.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",K),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointerup",q)),n.dispatchEvent(i),o=s.NONE}function X(e){!1===n.enabled||!1===n.enableZoom||o!==s.NONE&&o!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(a),function(e){U(e),e.deltaY<0?L(N()):e.deltaY>0&&R(N()),n.update()}(e),n.dispatchEvent(i))}function Y(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:M(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:M(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:M(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:M(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function J(e){!1!==n.enabled&&e.preventDefault()}function Z(e){let t=E[e.pointerId];void 0===t&&(t=new hu,E[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===C[0].pointerId?C[1]:C[0];return E[t.pointerId]}this.dollyIn=function(){L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:N()),n.update()},this.dollyOut=function(){R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:N()),n.update()},this.getScale=()=>h,this.setScale=e=>{F(e),n.update()},this.getZoomScale=()=>N(),void 0!==t&&this.connect(t),this.update()}}const JS=["makeDefault","camera","regress","domElement","enableDamping","keyEvents","onChange","onStart","onEnd"],ZS=B.forwardRef((e,t)=>{let{makeDefault:n,camera:r,regress:a,domElement:i,enableDamping:s=!0,keyEvents:o=!1,onChange:l,onStart:c,onEnd:u}=e,h=F(e,JS);const d=Q_(e=>e.invalidate),A=Q_(e=>e.camera),p=Q_(e=>e.gl),f=Q_(e=>e.events),m=Q_(e=>e.setEvents),g=Q_(e=>e.set),y=Q_(e=>e.get),v=Q_(e=>e.performance),b=r||A,x=i||f.connected||p.domElement,w=B.useMemo(()=>new YS(b),[b]);return V_(()=>{w.enabled&&w.update()},-1),B.useEffect(()=>(o&&w.connect(!0===o?x:o),w.connect(x),()=>{w.dispose()}),[o,x,a,w,d]),B.useEffect(()=>{const e=e=>{d(),a&&v.regress(),l&&l(e)},t=e=>{c&&c(e)},n=e=>{u&&u(e)};return w.addEventListener("change",e),w.addEventListener("start",t),w.addEventListener("end",n),()=>{w.removeEventListener("start",t),w.removeEventListener("end",n),w.removeEventListener("change",e)}},[l,c,u,w,d,m]),B.useEffect(()=>{if(n){const e=y().controls;return g({controls:w}),()=>g({controls:e})}},[n,w]),B.createElement("primitive",FS({ref:t,object:w,enableDamping:s},h))}),$S=["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","castShadow","receiveShadow","material","geometry","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents"],eC=new Au,tC=new Au,nC=new Au,rC=new hu;function aC(e,t,n){const r=eC.setFromMatrixPosition(e.matrixWorld);r.project(t);const a=n.width/2,i=n.height/2;return[r.x*a+a,-r.y*i+i]}const iC=e=>Math.abs(e)<1e-10?0:e;function sC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r="matrix3d(";for(let a=0;16!==a;a++)r+=iC(t[a]*e.elements[a])+(15!==a?",":")");return n+r}const oC=(lC=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>sC(e,lC));var lC;const cC=(e,t)=>sC(e,(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1])(t),"translate(-50%,-50%)");const uC=B.forwardRef((e,t)=>{let{children:n,eps:r=.001,style:a,className:i,prepend:s,center:o,fullscreen:l,portal:c,distanceFactor:u,sprite:h=!1,transform:d=!1,occlude:A,onOcclude:p,castShadow:f,receiveShadow:m,material:g,geometry:y,zIndexRange:v=[16777271,0],calculatePosition:b=aC,as:x="div",wrapperClass:w,pointerEvents:_="auto"}=e,S=F(e,$S);const{gl:C,camera:E,scene:N,size:I,raycaster:T,events:R,viewport:L}=Q_(),[U]=B.useState(()=>document.createElement(x)),P=B.useRef(),D=B.useRef(null),O=B.useRef(0),z=B.useRef([0,0]),H=B.useRef(null),j=B.useRef(null),Q=(null==c?void 0:c.current)||R.connected||C.domElement.parentNode,V=B.useRef(null),W=B.useRef(!1),G=B.useMemo(()=>A&&"blending"!==A||Array.isArray(A)&&A.length&&function(e){return e&&"object"===typeof e&&"current"in e}(A[0]),[A]);B.useLayoutEffect(()=>{const e=C.domElement;A&&"blending"===A?(e.style.zIndex="".concat(Math.floor(v[0]/2)),e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[A]),B.useLayoutEffect(()=>{if(D.current){const e=P.current=k.createRoot(U);if(N.updateMatrixWorld(),d)U.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=b(D.current,E,I);U.style.cssText="position:absolute;top:0;left:0;transform:translate3d(".concat(e[0],"px,").concat(e[1],"px,0);transform-origin:0 0;")}return Q&&(s?Q.prepend(U):Q.appendChild(U)),()=>{Q&&Q.removeChild(U),e.unmount()}}},[Q,d]),B.useLayoutEffect(()=>{w&&(U.className=w)},[w]);const K=B.useMemo(()=>d?{position:"absolute",top:0,left:0,width:I.width,height:I.height,transformStyle:"preserve-3d",pointerEvents:"none"}:M(M({position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none"},l&&{top:-I.height/2,left:-I.width/2,width:I.width,height:I.height}),a),[a,o,l,I,d]),q=B.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);B.useLayoutEffect(()=>{var e,r;(W.current=!1,d)?null==(e=P.current)||e.render(B.createElement("div",{ref:H,style:K},B.createElement("div",{ref:j,style:q},B.createElement("div",{ref:t,className:i,style:a,children:n})))):null==(r=P.current)||r.render(B.createElement("div",{ref:t,style:K,className:i,children:n}))});const X=B.useRef(!0);V_(e=>{if(D.current){E.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const e=d?z.current:b(D.current,E,I);if(d||Math.abs(O.current-E.zoom)>r||Math.abs(z.current[0]-e[0])>r||Math.abs(z.current[1]-e[1])>r){const t=function(e,t){const n=eC.setFromMatrixPosition(e.matrixWorld),r=tC.setFromMatrixPosition(t.matrixWorld),a=n.sub(r),i=t.getWorldDirection(nC);return a.angleTo(i)>Math.PI/2}(D.current,E);let n=!1;G&&(Array.isArray(A)?n=A.map(e=>e.current):"blending"!==A&&(n=[N]));const r=X.current;if(n){const e=function(e,t,n,r){const a=eC.setFromMatrixPosition(e.matrixWorld),i=a.clone();i.project(t),rC.set(i.x,i.y),n.setFromCamera(rC,t);const s=n.intersectObjects(r,!0);if(s.length){const e=s[0].distance;return a.distanceTo(n.ray.origin)<e}return!0}(D.current,E,T,n);X.current=e&&!t}else X.current=!t;r!==X.current&&(p?p(!X.current):U.style.display=X.current?"block":"none");const a=Math.floor(v[0]/2),i=A?G?[v[0],a]:[a-1,0]:v;if(U.style.zIndex="".concat(function(e,t,n){if(t instanceof hA||t instanceof Zg){const r=eC.setFromMatrixPosition(e.matrixWorld),a=tC.setFromMatrixPosition(t.matrixWorld),i=r.distanceTo(a),s=(n[1]-n[0])/(t.far-t.near),o=n[1]-s*t.far;return Math.round(s*i+o)}}(D.current,E,i)),d){const[e,t]=[I.width/2,I.height/2],n=E.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:a,left:i,bottom:s,right:o}=E,l=oC(E.matrixWorldInverse),c=r?"scale(".concat(n,")translate(").concat(iC(-(o+i)/2),"px,").concat(iC((a+s)/2),"px)"):"translateZ(".concat(n,"px)");let d=D.current.matrixWorld;h&&(d=E.matrixWorldInverse.clone().transpose().copyPosition(d).scale(D.current.scale),d.elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),U.style.width=I.width+"px",U.style.height=I.height+"px",U.style.perspective=r?"":"".concat(n,"px"),H.current&&j.current&&(H.current.style.transform="".concat(c).concat(l,"translate(").concat(e,"px,").concat(t,"px)"),j.current.style.transform=cC(d,1/((u||10)/400)))}else{const t=void 0===u?1:function(e,t){if(t instanceof Zg)return t.zoom;if(t instanceof hA){const n=eC.setFromMatrixPosition(e.matrixWorld),r=tC.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,i=n.distanceTo(r);return 1/(2*Math.tan(a/2)*i)}return 1}(D.current,E)*u;U.style.transform="translate3d(".concat(e[0],"px,").concat(e[1],"px,0) scale(").concat(t,")")}z.current=e,O.current=E.zoom}}if(!G&&V.current&&!W.current)if(d){if(H.current){const e=H.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=E;if(t||y)S.scale&&(Array.isArray(S.scale)?S.scale instanceof Au?V.current.scale.copy(S.scale.clone().divideScalar(1)):V.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):V.current.scale.setScalar(1/S.scale));else{const t=(u||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;V.current.scale.set(n,r,1)}W.current=!0}}}else{const t=U.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/L.factor,n=t.clientWidth*e,r=t.clientHeight*e;V.current.scale.set(n,r,1),W.current=!0}V.current.lookAt(e.camera.position)}});const Y=B.useMemo(()=>({vertexShader:d?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[d]);return B.createElement("group",FS({},S,{ref:D}),A&&!G&&B.createElement("mesh",{castShadow:f,receiveShadow:m,ref:V},y||B.createElement("planeGeometry",null),g||B.createElement("shaderMaterial",{side:Es,vertexShader:Y.vertexShader,fragmentShader:Y.fragmentShader})))}),hC=e=>{let t;const n=new Set,r=(e,r)=>{const a="function"===typeof e?e(t):e;if(!Object.is(a,t)){const e=t;t=(null!=r?r:"object"!==typeof a||null===a)?a:Object.assign({},t,a),n.forEach(n=>n(t,e))}},a=()=>t,i={setState:r,getState:a,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(r,a,i);return i},dC=e=>e;const AC=e=>{const t=(e=>e?hC(e):hC)(e),n=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dC;const n=B.useSyncExternalStore(e.subscribe,B.useCallback(()=>t(e.getState()),[e,t]),B.useCallback(()=>t(e.getInitialState()),[e,t]));return B.useDebugValue(n),n}(t,e);return Object.assign(n,t),n},pC=(fC=(e,t)=>({images:{before:null,after:null,captured:[],panorama:null},setBeforeImage:t=>e(e=>({images:M(M({},e.images),{},{before:t})})),setAfterImage:t=>e(e=>({images:M(M({},e.images),{},{after:t})})),addCapturedImage:t=>e(e=>({images:M(M({},e.images),{},{captured:[...e.images.captured,t]})})),clearCapturedImages:()=>e(e=>({images:M(M({},e.images),{},{captured:[]})})),viewMode:"before",setViewMode:t=>e({viewMode:t}),shingles:{selectedColor:"weathered-wood",appliedRegions:[],opacity:.95},setShingleColor:t=>e(e=>({shingles:M(M({},e.shingles),{},{selectedColor:t})})),addShingleRegion:t=>e(e=>({shingles:M(M({},e.shingles),{},{appliedRegions:[...e.shingles.appliedRegions,t]})})),removeShingleRegion:t=>e(e=>({shingles:M(M({},e.shingles),{},{appliedRegions:e.shingles.appliedRegions.filter(e=>e.id!==t)})})),setShingleOpacity:t=>e(e=>({shingles:M(M({},e.shingles),{},{opacity:t})})),lighting:{enabled:!1,trackColor:"white",lights:[],pattern:"solid",color:"#ffffff",brightness:100},toggleLighting:()=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:!e.lighting.enabled})})),setLightingEnabled:t=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:t})})),setTrackColor:t=>e(e=>({lighting:M(M({},e.lighting),{},{trackColor:t})})),addLight:t=>e(e=>({lighting:M(M({},e.lighting),{},{lights:[...e.lighting.lights,M(M({},t),{},{id:Date.now()})]})})),removeLight:t=>e(e=>({lighting:M(M({},e.lighting),{},{lights:e.lighting.lights.filter(e=>e.id!==t)})})),updateLight:(t,n)=>e(e=>({lighting:M(M({},e.lighting),{},{lights:e.lighting.lights.map(e=>e.id===t?M(M({},e),n):e)})})),setLightingPattern:t=>e(e=>({lighting:M(M({},e.lighting),{},{pattern:t})})),setLightingColor:t=>e(e=>({lighting:M(M({},e.lighting),{},{color:t})})),setLightingBrightness:t=>e(e=>({lighting:M(M({},e.lighting),{},{brightness:t})})),generateDefaultLighting:()=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:!0,lights:[{id:Date.now()+1,position:[-15,8,-25],color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12},{id:Date.now()+2,position:[15,8,-25],color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12},{id:Date.now()+3,position:[-10,4,-20],color:"#fffacd",intensity:2,range:15,beamWidth:2,beamLength:10},{id:Date.now()+4,position:[10,4,-20],color:"#fffacd",intensity:2,range:15,beamWidth:2,beamLength:10},{id:Date.now()+5,position:[0,3,-18],color:"#ffffff",intensity:1.8,range:12,beamWidth:1.8,beamLength:8}]})})),roofProducts:[],addRoofProduct:t=>e(e=>({roofProducts:[...e.roofProducts,M(M({},t),{},{id:Date.now()})]})),removeRoofProduct:t=>e(e=>({roofProducts:e.roofProducts.filter(e=>e.id!==t)})),updateRoofProduct:(t,n)=>e(e=>({roofProducts:e.roofProducts.map(e=>e.id===t?M(M({},e),n):e)})),photoCapture:{isCapturing:!1,currentStep:0,requiredPhotos:[{id:1,name:"Front Left Corner",angle:"front-left",captured:!1},{id:2,name:"Front Right Corner",angle:"front-right",captured:!1},{id:3,name:"Left Side Elevation",angle:"left-side",captured:!1},{id:4,name:"Right Side Elevation",angle:"right-side",captured:!1},{id:5,name:"Back Left Corner",angle:"back-left",captured:!1},{id:6,name:"Back Right Corner",angle:"back-right",captured:!1},{id:7,name:"Overhead/Drone View",angle:"overhead",captured:!1},{id:8,name:"Roof Detail Close-up",angle:"detail",captured:!1}],capturedPhotos:[]},startPhotoCapture:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{isCapturing:!0,currentStep:0})})),stopPhotoCapture:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{isCapturing:!1})})),nextCaptureStep:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{currentStep:Math.min(e.photoCapture.currentStep+1,7)})})),capturePhoto:t=>e(e=>{const n=[...e.photoCapture.requiredPhotos];return n[e.photoCapture.currentStep].captured=!0,{photoCapture:M(M({},e.photoCapture),{},{requiredPhotos:n,capturedPhotos:[...e.photoCapture.capturedPhotos,t]})}}),ui:{activePanel:"products",showControls:!0,isLoading:!1,uploadProgress:0},setActivePanel:t=>e(e=>({ui:M(M({},e.ui),{},{activePanel:t})})),toggleControls:()=>e(e=>({ui:M(M({},e.ui),{},{showControls:!e.ui.showControls})})),setLoading:t=>e(e=>({ui:M(M({},e.ui),{},{isLoading:t})})),setUploadProgress:t=>e(e=>({ui:M(M({},e.ui),{},{uploadProgress:t})})),scene:{cameraPosition:[0,0,.1],fov:75,controls:{enableZoom:!0,enablePan:!1,enableRotate:!0}},setCameraPosition:t=>e(e=>({scene:M(M({},e.scene),{},{cameraPosition:t})})),setFov:t=>e(e=>({scene:M(M({},e.scene),{},{fov:t})})),measurements:{roofArea:0,perimeter:0,pitch:0,sqFt:0},setMeasurements:t=>e({measurements:t}),export:{format:"png",quality:.95,includeWatermark:!1},setExportFormat:t=>e(e=>({export:M(M({},e.export),{},{format:t})})),setExportQuality:t=>e(e=>({export:M(M({},e.export),{},{quality:t})})),resetAll:()=>e({images:{before:null,after:null,captured:[],panorama:null},viewMode:"before",shingles:{selectedColor:"weathered-wood",appliedRegions:[],opacity:.95},lighting:{enabled:!1,trackColor:"white",lights:[],pattern:"solid",color:"#ffffff",brightness:100},roofProducts:[],ui:{activePanel:"products",showControls:!0,isLoading:!1,uploadProgress:0}})}),fC?AC(fC):AC);var fC;const mC={"weathered-wood":{name:"Weathered Wood",hex:"#8B7355",baseColor:new hd(9139029),roughness:.85,metalness:0},driftwood:{name:"Driftwood",hex:"#A0907A",baseColor:new hd(10522746),roughness:.82,metalness:0},"storm-gray":{name:"Storm Gray",hex:"#6B6B6B",baseColor:new hd(7039851),roughness:.8,metalness:0},"coal-black":{name:"Coal Black",hex:"#2F2F2F",baseColor:new hd(3092271),roughness:.88,metalness:0},"antique-brown":{name:"Antique Brown",hex:"#8B4513",baseColor:new hd(9127187),roughness:.84,metalness:0},"forest-green":{name:"Forest Green",hex:"#355E3B",baseColor:new hd(3497531),roughness:.83,metalness:0},"brick-red":{name:"Brick Red",hex:"#B22222",baseColor:new hd(11674146),roughness:.86,metalness:0},"slate-blue":{name:"Slate Blue",hex:"#6A5ACD",baseColor:new hd(6970061),roughness:.81,metalness:0}},gC={white:{name:"White",hex:"#FFFFFF",color:new hd(16777215)},black:{name:"Black",hex:"#000000",color:new hd(0)},bronze:{name:"Bronze",hex:"#CD7F32",color:new hd(13467442)},silver:{name:"Silver",hex:"#C0C0C0",color:new hd(12632256)},charcoal:{name:"Charcoal",hex:"#36454F",color:new hd(3556687)},brown:{name:"Brown",hex:"#8B4513",color:new hd(9127187)},beige:{name:"Beige",hex:"#F5F5DC",color:new hd(16119260)},gray:{name:"Gray",hex:"#808080",color:new hd(8421504)}};function yC(e){let{type:t,data:n}=e;if("shingle"===t){const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95;const n=mC[e]||mC["weathered-wood"];return new Xm({color:n.baseColor,roughness:n.roughness,metalness:n.metalness,transparent:t<1,opacity:t,side:Es})}(n.color,n.opacity);return(0,yi.jsxs)("mesh",{position:n.position||[0,20,-50],scale:n.scale||[10,10,1],rotation:n.rotation||[0,0,0],children:[(0,yi.jsx)("planeGeometry",{args:[1,1]}),(0,yi.jsx)("primitive",{object:e,attach:"material"})]})}return"roof-product"===t?(0,yi.jsxs)("mesh",{position:n.position||[0,15,-40],scale:n.scale||[5,5,1],rotation:n.rotation||[0,0,0],children:[(0,yi.jsx)("planeGeometry",{args:[1,1]}),(0,yi.jsx)("meshStandardMaterial",{color:new hd(8947848),transparent:!0,opacity:.9,side:Es})]}):null}function vC(e){let{lights:t=[]}=e;return(0,yi.jsx)("group",{children:t.map(e=>(0,yi.jsxs)("group",{position:e.position||[0,5,-20],children:[(0,yi.jsx)("pointLight",{color:e.color||"#ffffff",intensity:e.intensity||2,distance:e.range||15,decay:2}),(0,yi.jsxs)("mesh",{children:[(0,yi.jsx)("sphereGeometry",{args:[.3,16,16]}),(0,yi.jsx)("meshBasicMaterial",{color:e.color||"#ffffff"})]}),(0,yi.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,yi.jsx)("coneGeometry",{args:[e.beamWidth||2,e.beamLength||10,32,1,!0]}),(0,yi.jsx)("meshBasicMaterial",{color:e.color||"#ffffff",transparent:!0,opacity:.15,side:Es,blending:ks,depthWrite:!1})]})]},e.id))})}function bC(e){let{imageUrl:t,opacity:n=1}=e;const r=MS(t);return(0,B.useEffect)(()=>{r&&(r.mapping=So,r.colorSpace=cc)},[r]),(0,yi.jsx)(US,{args:[500,60,40],scale:[-1,1,1],children:(0,yi.jsx)("meshBasicMaterial",{map:r,side:Cs,transparent:n<1,opacity:n})})}function xC(){const{camera:e}=Q_(),{images:t,viewMode:n,shingles:r,lighting:a,roofProducts:i}=pC();(0,B.useEffect)(()=>{e.position.set(0,0,.1)},[e]);const s="before"===n||"compare"===n,o="after"===n||"compare"===n,l="compare"===n?.5:1,c="compare"===n?.5:1;return(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)("ambientLight",{intensity:.6}),(0,yi.jsx)("directionalLight",{position:[10,10,5],intensity:.8}),s&&t.before&&(0,yi.jsx)(bC,{imageUrl:t.before,opacity:l}),o&&t.before&&(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)(bC,{imageUrl:t.after||t.before,opacity:c}),r.appliedRegions.map(e=>(0,yi.jsx)(yC,{type:"shingle",data:e},e.id)),i.map(e=>(0,yi.jsx)(yC,{type:"roof-product",data:e},e.id)),a.enabled&&(0,yi.jsx)(vC,{lights:a.lights})]})]})}function wC(e){let{className:t=""}=e;const{images:n}=pC();return(0,yi.jsxs)("div",{className:"house-360-viewer w-full h-full relative ".concat(t),children:[(0,yi.jsxs)(IS,{gl:{antialias:!0,alpha:!1,preserveDrawingBuffer:!0},dpr:[1,2],children:[(0,yi.jsx)(zS,{makeDefault:!0,fov:75,position:[0,0,.1]}),(0,yi.jsx)(ZS,{enableZoom:!0,enablePan:!1,enableDamping:!0,dampingFactor:.05,rotateSpeed:-.5,minDistance:.1,maxDistance:100,minPolarAngle:0,maxPolarAngle:Math.PI}),(0,yi.jsx)(B.Suspense,{fallback:(0,yi.jsx)(uC,{center:!0,children:(0,yi.jsx)("div",{className:"text-white text-lg font-medium bg-gray-900 bg-opacity-75 px-4 py-2 rounded",children:"Loading visualization..."})}),children:n.before?(0,yi.jsx)(xC,{}):(0,yi.jsx)(uC,{center:!0,children:(0,yi.jsxs)("div",{className:"text-center bg-white bg-opacity-90 p-6 rounded-lg shadow-lg max-w-sm",children:[(0,yi.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Upload a Photo to Begin"}),(0,yi.jsx)("p",{className:"text-sm text-gray-600",children:"Upload a 360\xb0 panorama or standard house photo to start visualizing products"})]})})})]}),n.before&&(0,yi.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-60 text-white px-4 py-2 rounded-lg text-sm pointer-events-none",children:"Click & drag to rotate \u2022 Scroll to zoom"})]})}const _C=H("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),SC=H("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),CC=H("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),EC=H("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),NC=H("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),BC=H("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function kC(e){let{file:t,onValidationComplete:n}=e;const[r,a]=(0,B.useState)({isValidating:!0,dimensions:null,quality:null,brightness:null,errors:[],warnings:[]});(0,B.useEffect)(()=>{t&&i(t)},[t]);const i=async e=>{const t=[],r=[];try{const i=await(async e=>new Promise((t,n)=>{if(!e)return void n(new Error("No file provided"));if(!e.type.startsWith("image/"))return void n(new Error("File must be an image"));if(e.size>10485760)return void n(new Error("Image must be less than 10MB"));const r=new Image,a=URL.createObjectURL(e);r.onload=()=>{URL.revokeObjectURL(a),r.width<800||r.height<600?n(new Error("Image must be at least 800x600 pixels")):t({width:r.width,height:r.height,aspectRatio:r.width/r.height,size:e.size,type:e.type})},r.onerror=()=>{URL.revokeObjectURL(a),n(new Error("Failed to load image"))},r.src=a}))(e);i.width<1200&&r.push("Image resolution is low. Higher resolution recommended for better results.");const s=new Image,o=URL.createObjectURL(e);s.onload=async()=>{URL.revokeObjectURL(o);const e=await(async e=>new Promise(t=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=e.width,n.height=e.height,r.drawImage(e,0,0);const a=r.getImageData(0,0,n.width,n.height).data;let i=0;for(let e=0;e<1e3;e++){const e=Math.floor(Math.random()*(n.width-1)),t=4*(Math.floor(Math.random()*(n.height-1))*n.width+e),r=a[t],s=a[t+4];i+=Math.abs(r-s)}const s=i/1e3,o=s<10;t({isBlurry:o,score:s,quality:o?"poor":s>30?"excellent":"good"})}))(s);e.isBlurry&&r.push("Image appears to be slightly blurry. Consider retaking for best results.");const l=await(async e=>new Promise(t=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=e.width,n.height=e.height,r.drawImage(e,0,0);const a=r.getImageData(0,0,n.width,n.height).data;let i=0;const s=a.length/4;for(let e=0;e<a.length;e+=4)i+=.299*a[e]+.587*a[e+1]+.114*a[e+2];const o=i/s;t({brightness:o,quality:o<50?"too-dark":o>200?"too-bright":"good",percentage:o/255*100})}))(s);"too-dark"===l.quality?r.push("Image is too dark. Try taking the photo in better lighting."):"too-bright"===l.quality&&r.push("Image is overexposed. Reduce brightness or avoid direct sunlight."),a({isValidating:!1,dimensions:i,quality:e.quality,brightness:l.quality,errors:t,warnings:r}),n({valid:0===t.length,errors:t,warnings:r,imageData:i})},s.onerror=()=>{URL.revokeObjectURL(o),t.push("Failed to load image. File may be corrupted."),a({isValidating:!1,dimensions:null,quality:null,brightness:null,errors:t,warnings:r}),n({valid:!1,errors:t,warnings:r})},s.src=o}catch(_S){t.push(_S.message),a({isValidating:!1,dimensions:null,quality:null,brightness:null,errors:t,warnings:r}),n({valid:!1,errors:t,warnings:r})}};if(r.isValidating)return(0,yi.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[(0,yi.jsx)(j,{className:"w-5 h-5 text-blue-600 animate-spin"}),(0,yi.jsx)("span",{className:"text-sm text-blue-800",children:"Validating image quality..."})]});const s=r.errors.length>0,o=r.warnings.length>0,l=!s;return(0,yi.jsxs)("div",{className:"space-y-2",children:[(0,yi.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg ".concat(l?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[l?(0,yi.jsx)(Z,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):(0,yi.jsx)($,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("p",{className:"text-sm font-medium ".concat(l?"text-green-800":"text-red-800"),children:l?"Image looks good!":"Image has quality issues"}),r.dimensions&&(0,yi.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[r.dimensions.width," \xd7 ",r.dimensions.height," pixels \u2022"," ",(r.dimensions.size/1024/1024).toFixed(2)," MB \u2022"," ","Quality: ",r.quality]})]})]}),s&&(0,yi.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-red-800 mb-2",children:"Errors:"}),(0,yi.jsx)("ul",{className:"space-y-1",children:r.errors.map((e,t)=>(0,yi.jsxs)("li",{className:"text-xs text-red-700 flex items-start gap-2",children:[(0,yi.jsx)("span",{children:"\u2022"}),(0,yi.jsx)("span",{children:e})]},t))})]}),o&&(0,yi.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,yi.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Warnings:"}),(0,yi.jsx)("ul",{className:"space-y-1",children:r.warnings.map((e,t)=>(0,yi.jsxs)("li",{className:"text-xs text-yellow-700 flex items-start gap-2",children:[(0,yi.jsx)("span",{children:"\u2022"}),(0,yi.jsx)("span",{children:e})]},t))})]})]})}const IC=H("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),TC=H("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),MC=H("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function FC(e){let{onComplete:t,className:n=""}=e;const[r,a]=(0,B.useState)(!1),[i,s]=(0,B.useState)(0),[o,l]=(0,B.useState)([]),[c,u]=(0,B.useState)(null),[h,d]=(0,B.useState)(null),[A,p]=(0,B.useState)("environment"),f=(0,B.useRef)(null),m=(0,B.useRef)(null),g=(0,B.useRef)(null),{photoCapture:y,addCapturedImage:v}=pC(),b=[{id:1,name:"Front Left Corner",angle:"front-left",instruction:"Stand at the front left corner of the house. Capture the front and left side.",tips:"Include both the front facade and left side wall in frame"},{id:2,name:"Front Right Corner",angle:"front-right",instruction:"Move to the front right corner. Capture the front and right side.",tips:"Overlap slightly with the previous photo"},{id:3,name:"Left Side Elevation",angle:"left-side",instruction:"Position yourself to capture the full left side of the house.",tips:"Keep the camera level and capture the entire roof line"},{id:4,name:"Right Side Elevation",angle:"right-side",instruction:"Move to capture the full right side of the house.",tips:"Maintain consistent distance from previous photos"},{id:5,name:"Back Left Corner",angle:"back-left",instruction:"Position at the back left corner to capture rear and left side.",tips:"Include chimney, vents, and other roof features"},{id:6,name:"Back Right Corner",angle:"back-right",instruction:"Move to the back right corner to complete the perimeter.",tips:"Ensure good overlap with previous photos"},{id:7,name:"Overhead/Drone View",angle:"overhead",instruction:"Capture from elevated position (ladder, drone, or 2nd story window).",tips:"This is crucial for roof detail. Use a drone if available."},{id:8,name:"Roof Detail Close-up",angle:"detail",instruction:"Close-up of roof surface showing shingle texture and condition.",tips:"Focus on shingle detail, valleys, and flashing"}],x=async()=>{try{const e={video:{facingMode:A,width:{ideal:1920},height:{ideal:1080}}},t=await navigator.mediaDevices.getUserMedia(e);g.current=t,f.current&&(f.current.srcObject=t,f.current.play()),a(!0),d(null)}catch(_S){console.error("Camera access error:",_S),d("Unable to access camera. Please grant camera permissions.")}},w=()=>{g.current&&(g.current.getTracks().forEach(e=>e.stop()),g.current=null),f.current&&(f.current.srcObject=null),a(!1)},_=()=>new Promise(e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},()=>e(null),{timeout:5e3}):e(null)}),S=()=>{var e;return null!==(e=window.screen)&&void 0!==e&&e.orientation?window.screen.orientation.type:"unknown"};(0,B.useEffect)(()=>()=>{w(),o.forEach(e=>{null!==e&&void 0!==e&&e.preview&&URL.revokeObjectURL(e.preview)})},[]);const C=o.filter(e=>e).length/b.length*100;return(0,yi.jsxs)("div",{className:"camera-integration bg-white rounded-lg shadow-lg ".concat(n),children:[(0,yi.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-t-lg",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,yi.jsx)(NC,{className:"w-6 h-6"}),(0,yi.jsx)("h3",{className:"text-lg font-bold",children:"8-Photo Capture"})]}),(0,yi.jsxs)("div",{className:"text-sm font-medium",children:[o.filter(e=>e).length," / ",b.length]})]}),(0,yi.jsx)("div",{className:"w-full bg-blue-800 rounded-full h-2",children:(0,yi.jsx)("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:"".concat(C,"%")}})})]}),(0,yi.jsxs)("div",{className:"p-4",children:[h&&(0,yi.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:(0,yi.jsx)("p",{className:"text-sm text-red-800",children:h})}),(0,yi.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded p-4 mb-4",children:(0,yi.jsxs)("div",{className:"flex items-start gap-3",children:[(0,yi.jsx)(IC,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:b[i].name}),(0,yi.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:b[i].instruction}),(0,yi.jsxs)("p",{className:"text-xs text-blue-700",children:["\ud83d\udca1 ",b[i].tips]})]})]})}),r&&!c&&(0,yi.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden mb-4",children:[(0,yi.jsx)("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto"}),(0,yi.jsxs)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-4",children:[(0,yi.jsx)("button",{onClick:()=>{w(),p(e=>"user"===e?"environment":"user"),setTimeout(()=>x(),100)},className:"p-3 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full",title:"Switch Camera",children:(0,yi.jsx)(TC,{className:"w-5 h-5 text-gray-800"})}),(0,yi.jsx)("button",{onClick:()=>{if(!f.current||!m.current)return;const e=f.current,n=m.current,r=n.getContext("2d");n.width=e.videoWidth,n.height=e.videoHeight,r.drawImage(e,0,0),n.toBlob(async e=>{const n={id:Date.now(),angle:b[i].angle,name:b[i].name,blob:e,preview:URL.createObjectURL(e),timestamp:(new Date).toISOString(),gps:await _(),orientation:S(),file:new File([e],"photo-".concat(i+1,".jpg"),{type:"image/jpeg"})},r=[...o];r[i]=n,l(r),v(n),u(n.preview),setTimeout(()=>{u(null),i<b.length-1?s(i+1):(w(),t&&t(r))},2e3)},"image/jpeg",.95)},className:"p-4 bg-blue-600 hover:bg-blue-700 rounded-full shadow-lg",title:"Capture Photo",children:(0,yi.jsx)(NC,{className:"w-8 h-8 text-white"})})]})]}),c&&(0,yi.jsxs)("div",{className:"relative mb-4",children:[(0,yi.jsx)("img",{src:c,alt:"Preview",className:"w-full h-auto rounded-lg"}),(0,yi.jsx)("div",{className:"absolute top-4 right-4",children:(0,yi.jsx)("div",{className:"bg-green-500 text-white p-2 rounded-full",children:(0,yi.jsx)(Z,{className:"w-6 h-6"})})}),(0,yi.jsx)("button",{onClick:()=>{u(null);const e=[...o];e[i]=null,l(e)},className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-white hover:bg-gray-100 text-gray-800 rounded-lg shadow-lg font-medium",children:"Retake"})]}),!r&&!c&&(0,yi.jsxs)("button",{onClick:x,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium flex items-center justify-center gap-2 mb-4",children:[(0,yi.jsx)(NC,{className:"w-5 h-5"}),"Start Camera"]}),(0,yi.jsx)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:b.map((e,t)=>{const n=o[t],r=t===i;return(0,yi.jsxs)("div",{className:"relative aspect-square rounded border-2 ".concat(r?"border-blue-500":n?"border-green-500":"border-gray-300"," cursor-pointer hover:border-blue-400 transition-colors"),onClick:()=>(s(t),void u(null)),children:[n?(0,yi.jsx)("img",{src:n.preview,alt:e.name,className:"w-full h-full object-cover rounded"}):(0,yi.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,yi.jsx)(MC,{className:"w-6 h-6 text-gray-400"})}),n&&(0,yi.jsx)("div",{className:"absolute top-1 right-1 bg-green-500 rounded-full p-0.5",children:(0,yi.jsx)(Z,{className:"w-3 h-3 text-white"})}),(0,yi.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-1 py-0.5 text-center",children:t+1})]},e.id)})}),(0,yi.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,yi.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Or upload existing photos:"}),(0,yi.jsxs)("label",{className:"block w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded border border-gray-300 text-center cursor-pointer",children:[(0,yi.jsx)("input",{type:"file",accept:"image/*",onChange:e=>((e,t)=>{const n=e.target.files[0];if(!n)return;const r={id:Date.now(),angle:b[t].angle,name:b[t].name,blob:n,preview:URL.createObjectURL(n),timestamp:(new Date).toISOString(),gps:null,orientation:"unknown",file:n},a=[...o];a[t]=r,l(a),v(r)})(e,i),className:"hidden"}),"Upload Photo ",i+1]})]}),o.filter(e=>e).length===b.length&&(0,yi.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,yi.jsxs)("button",{onClick:()=>{o.forEach((e,t)=>{if(!e)return;const n=document.createElement("a");n.href=e.preview,n.download="".concat(e.angle,"-").concat(t+1,".jpg"),n.click()})},className:"flex-1 py-2 px-4 bg-gray-600 hover:bg-gray-700 text-white rounded flex items-center justify-center gap-2",children:[(0,yi.jsx)(BC,{className:"w-4 h-4"}),"Export All"]}),(0,yi.jsx)("button",{onClick:()=>t&&t(o),className:"flex-1 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Process Photos"})]})]}),(0,yi.jsx)("canvas",{ref:m,className:"hidden"})]})}const RC=H("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),LC=H("triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]),UC=H("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),PC=H("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function DC(e){let{className:t=""}=e;const[n,r]=(0,B.useState)(null),[a,i]=(0,B.useState)([]),[s,o]=(0,B.useState)(null),[l,c]=(0,B.useState)("feet"),{images:u,setMeasurements:h}=((0,B.useRef)(null),pC()),d=[{id:"distance",name:"Distance",icon:EC,description:"Measure linear distance"},{id:"area",name:"Area",icon:RC,description:"Measure surface area"},{id:"pitch",name:"Roof Pitch",icon:LC,description:"Calculate roof pitch"},{id:"perimeter",name:"Perimeter",icon:UC,description:"Measure perimeter"}],A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;e&&e.value&&(i(t=>[...t,e]),o(null),r(null),p([...a,e]))},p=e=>{const t={roofArea:0,perimeter:0,pitch:0,sqFt:0};e.forEach(e=>{"area"===e.type?(t.roofArea+=e.value,t.sqFt+=e.value):"perimeter"===e.type?t.perimeter+=e.value:"pitch"===e.type&&e.value.degrees&&(t.pitch=Math.max(t.pitch,parseFloat(e.value.degrees)))}),h(t)},f=e=>{const{type:t,value:n,unit:r}=e;if(!n)return"-";switch(t){case"distance":case"perimeter":return"".concat(n.toFixed(2)," ").concat(r);case"area":return"".concat(n.toFixed(2)," sq ").concat(r);case"pitch":return"".concat(n.ratio," (").concat(n.degrees,"\xb0)");default:return n.toString()}};return(0,yi.jsxs)("div",{className:"measurement-tools bg-white rounded-lg shadow-lg p-4 ".concat(t),children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,yi.jsx)(G,{className:"w-5 h-5 text-blue-600"}),(0,yi.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Measurement Tools"})]}),(0,yi.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm",children:[(0,yi.jsx)("option",{value:"feet",children:"Feet"}),(0,yi.jsx)("option",{value:"meters",children:"Meters"}),(0,yi.jsx)("option",{value:"inches",children:"Inches"})]})]}),(0,yi.jsx)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:d.map(e=>{const t=e.icon,a=n===e.id;return(0,yi.jsxs)("button",{onClick:()=>{return t=e.id,r(t),void o({id:Date.now(),type:t,points:[],value:null,unit:l});var t},className:"flex items-center gap-2 px-3 py-2 rounded border-2 transition-all ".concat(a?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300 text-gray-700"),title:e.description,children:[(0,yi.jsx)(t,{className:"w-4 h-4"}),(0,yi.jsx)("span",{className:"text-sm font-medium",children:e.name})]},e.id)})}),n&&s&&(0,yi.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[(0,yi.jsxs)("p",{className:"text-sm text-blue-800 font-medium",children:["distance"===s.type&&"Click two points to measure distance","area"===s.type&&"Click points to define area (double-click to finish)","pitch"===s.type&&"Click base point, then peak point","perimeter"===s.type&&"Click points around perimeter"]}),(0,yi.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:["Points: ",s.points.length]}),(0,yi.jsxs)("div",{className:"flex gap-2 mt-2",children:[s.points.length>=2&&(0,yi.jsx)("button",{onClick:()=>A(),className:"px-3 py-1 bg-blue-600 text-white rounded text-xs font-medium hover:bg-blue-700",children:"Finish"}),(0,yi.jsx)("button",{onClick:()=>{o(null),r(null)},className:"px-3 py-1 bg-gray-300 text-gray-700 rounded text-xs font-medium hover:bg-gray-400",children:"Cancel"})]})]}),(0,yi.jsxs)("div",{className:"space-y-2 mb-4 max-h-64 overflow-y-auto",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Saved Measurements"}),a.length>0&&(0,yi.jsxs)("button",{onClick:()=>{const e=[["Type","Value","Unit","Points"].join(","),...a.map(e=>[e.type,"object"===typeof e.value?JSON.stringify(e.value):e.value,e.unit,e.points.length].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="measurements-".concat(Date.now(),".csv"),r.click()},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[(0,yi.jsx)(Ri,{className:"w-3 h-3"}),"Export CSV"]})]}),0===a.length?(0,yi.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No measurements yet. Select a tool to begin."}):a.map(e=>(0,yi.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("div",{className:"text-sm font-medium text-gray-800 capitalize",children:e.type}),(0,yi.jsx)("div",{className:"text-sm text-gray-600",children:f(e)})]}),(0,yi.jsx)("button",{onClick:()=>(e=>{const t=a.filter(t=>t.id!==e);i(t),p(t)})(e.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete measurement",children:(0,yi.jsx)(PC,{className:"w-4 h-4"})})]},e.id))]}),a.length>0&&(0,yi.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Summary"}),(0,yi.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("span",{className:"text-gray-600",children:"Total Area:"}),(0,yi.jsxs)("span",{className:"ml-2 font-semibold text-gray-800",children:[a.filter(e=>"area"===e.type).reduce((e,t)=>e+t.value,0).toFixed(2)," sq ",l]})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("span",{className:"text-gray-600",children:"Max Pitch:"}),(0,yi.jsxs)("span",{className:"ml-2 font-semibold text-gray-800",children:[a.filter(e=>"pitch"===e.type).reduce((e,t)=>Math.max(e,parseFloat(t.value.degrees)||0),0).toFixed(1),"\xb0"]})]})]})]}),(0,yi.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[(0,yi.jsx)("button",{className:"w-full px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded border border-blue-200",children:"Set Scale / Calibrate"}),(0,yi.jsx)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Click to set a known distance for accurate measurements"})]})]})}class OC{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class zC{refCount(e){return HC("refCount")}incRef(e){return HC("incRef")}timerAvailable(){return!0}time(e){return HC("time")}read(e){return HC("read")}readSync(e){return HC("readSync")}readToGPU(e,t){return HC("readToGPU")}numDataIds(){return HC("numDataIds")}disposeData(e,t){return HC("disposeData")}write(e,t,n){return HC("write")}move(e,t,n,r,a){return HC("move")}createTensorFromGPUData(e,t,n){return HC("createTensorFromGPUData")}memory(){return HC("memory")}floatPrecision(){return HC("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return HC("dispose")}}function HC(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function jC(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,WC(e,t,n)}function QC(e,t,n){return Math.max(e,Math.min(t,n))}function VC(e){return e%2===0?e:e+1}function WC(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function GC(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function KC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";GC(YC(e,t),()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}function qC(e){GC(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function XC(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function YC(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function JC(e){return e%1===0}function ZC(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function $C(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function eE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((a,i)=>{let s=0;const o=()=>{if(e())return void a();s++;const l=t(s);null!=n&&s>=n?i():null!=r?r(o,l):setTimeout(o,l)};o()})}function tE(e,t){let n=1,r=-1;for(let i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(i));r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found ".concat(e[i]," at dim ").concat(i));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const a=e.slice();return a[r]=t/n,a}function nE(e,t){const n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),GC(e.every(e=>e>=-n&&e<n),()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)),GC(e.every(e=>JC(e)),()=>"All values in axis param must be integers but "+"got axis ".concat(e)),e.map(e=>e<0?n+e:e)}function rE(e,t){const n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:nE(t,e).sort();let s=0;for(let o=0;o<e.length;++o){if(null!=i){if(i[s]===o&&1!==e[o])throw new Error("Can't squeeze axis ".concat(o," since its dim '").concat(e[o],"' is not 1"));(null==i[s]||i[s]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),i[s]<=o&&s++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function aE(e,t){return iE(e,t)}function iE(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function sE(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function oE(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function lE(e){return"string"===typeof e||e instanceof String}function cE(e){return"number"===typeof e}function uE(e){return Array.isArray(e)?uE(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":cE(e)?"float32":lE(e)?"string":"boolean"===typeof e?"bool":"float32"}function hE(e){return!!(e&&e.constructor&&e.call&&e.apply)}function dE(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function AE(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function pE(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=new Array;if(1===t.length){const i=t[0]*(r?2:1);for(let t=0;t<i;t++)a[t]=n[e+t]}else{const i=t[0],s=t.slice(1),o=s.reduce((e,t)=>e*t)*(r?2:1);for(let t=0;t<i;t++)a[t]=pE(e+t*o,s,n,r)}return a}function fE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const r=e.reduce((e,t)=>e*t)*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return pE(0,e,t,n)}function mE(e,t){const n=gE(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function gE(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function yE(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return fE(e,new Float32Array(n));if("int32"===t)return fE(e,new Int32Array(n));if("bool"===t)return fE(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function vE(e){e.forEach(t=>{GC(Number.isInteger(t)&&t>=0,()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"]."))})}function bE(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function xE(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function wE(e){return e&&e.then&&"function"===typeof e.then}const _E="tfjsflags";class SE{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=CE,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(EE().getBool("IS_TEST")||EE().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];EE().getBool("IS_TEST")||EE().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(wE(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(_E in e){e[_E].split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)})}}}function CE(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")}),t}function EE(){return BE}let NE,BE=null;function kE(){if(null==NE){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}NE=e}return NE}function IE(e,t){const n=function(){const e=kE();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const TE="Abs",ME="Acos",FE="Acosh",RE="Add",LE="AddN",UE="All",PE="Any",DE="ArgMax",OE="ArgMin",zE="Asin",HE="Asinh",jE="Atan",QE="Atanh",VE="Atan2",WE="AvgPool",GE="AvgPoolGrad",KE="AvgPool3D",qE="AvgPool3DGrad",XE="BatchMatMul",YE="BatchToSpaceND",JE="Bincount",ZE="BitwiseAnd",$E="BroadcastArgs",eN="Cast",tN="Ceil",nN="ClipByValue",rN="Complex",aN="ComplexAbs",iN="Concat",sN="Conv2D",oN="Conv2DBackpropFilter",lN="Conv2DBackpropInput",cN="Conv3D",uN="Conv3DBackpropFilterV2",hN="Conv3DBackpropInputV2",dN="Cos",AN="Cosh",pN="Cumprod",fN="Cumsum",mN="CropAndResize",gN="DenseBincount",yN="DepthToSpace",vN="DepthwiseConv2dNative",bN="DepthwiseConv2dNativeBackpropFilter",xN="DepthwiseConv2dNativeBackpropInput",wN="Diag",_N="Dilation2D",SN="Dilation2DBackpropInput",CN="Dilation2DBackpropFilter",EN="Draw",NN="RealDiv",BN="Einsum",kN="Elu",IN="EluGrad",TN="Erf",MN="Equal",FN="Exp",RN="ExpandDims",LN="Expm1",UN="FFT",PN="Fill",DN="FlipLeftRight",ON="Floor",zN="FloorDiv",HN="FusedBatchNorm",jN="GatherV2",QN="GatherNd",VN="Greater",WN="GreaterEqual",GN="Identity",KN="IFFT",qN="Imag",XN="IsFinite",YN="IsInf",JN="IsNan",ZN="LeakyRelu",$N="Less",eB="LessEqual",tB="LinSpace",nB="Log",rB="Log1p",aB="LogicalAnd",iB="LogicalNot",sB="LogicalOr",oB="LRN",lB="LRNGrad",cB="Max",uB="Maximum",hB="MaxPool",dB="MaxPoolGrad",AB="MaxPool3D",pB="MaxPool3DGrad",fB="MaxPoolWithArgmax",mB="Mean",gB="Min",yB="Minimum",vB="MirrorPad",bB="Mod",xB="Multinomial",wB="Multiply",_B="Neg",SB="NotEqual",CB="NonMaxSuppressionV3",EB="NonMaxSuppressionV4",NB="NonMaxSuppressionV5",BB="OnesLike",kB="OneHot",IB="Pack",TB="PadV2",MB="Pow",FB="Prelu",RB="Prod",LB="RaggedGather",UB="RaggedRange",PB="RaggedTensorToTensor",DB="Range",OB="Real",zB="Reciprocal",HB="Relu",jB="Reshape",QB="ResizeNearestNeighbor",VB="ResizeNearestNeighborGrad",WB="ResizeBilinear",GB="ResizeBilinearGrad",KB="Relu6",qB="Reverse",XB="Round",YB="Rsqrt",JB="ScatterNd",ZB="TensorScatterUpdate",$B="SearchSorted",ek="Select",tk="Selu",nk="Slice",rk="Sin",ak="Sinh",ik="Sign",sk="Sigmoid",ok="Softplus",lk="Sqrt",ck="Sum",uk="SpaceToBatchND",hk="SplitV",dk="Softmax",Ak="SparseFillEmptyRows",pk="SparseReshape",fk="SparseSegmentMean",mk="SparseSegmentSum",gk="SparseToDense",yk="SquaredDifference",vk="Square",bk="StaticRegexReplace",xk="StridedSlice",wk="StringNGrams",_k="StringSplit",Sk="StringToHashBucketFast",Ck="Sub",Ek="Tan",Nk="Tanh",Bk="Tile",kk="TopK",Ik="Transform",Tk="Transpose",Mk="Unique",Fk="Unpack",Rk="UnsortedSegmentSum",Lk="ZerosLike",Uk="Step",Pk="FromPixels",Dk="RotateWithOffset",Ok="_FusedMatMul",zk="FusedConv2D",Hk="FusedDepthwiseConv2D";function jk(){EE().getBool("IS_TEST")||EE().getBool("PROD")||console.warn(...arguments)}function Qk(){EE().getBool("IS_TEST")||EE().getBool("PROD")||console.log(...arguments)}const Vk=IE("kernelRegistry",()=>new Map),Wk=IE("gradRegistry",()=>new Map);function Gk(e,t){const n=Jk(e,t);return Vk.get(n)}function Kk(e){return Wk.get(e)}function qk(e){const t=Vk.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[i,s]=a,[o]=i.split("_");o===e&&n.push(s)}return n}function Xk(e){const{kernelName:t,backendName:n}=e,r=Jk(t,n);Vk.has(r)&&jk("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),Vk.set(r,e)}function Yk(e){const{kernelName:t}=e;Wk.has(t)&&EE().getBool("DEBUG")&&jk("Overriding the gradient for '".concat(t,"'")),Wk.set(t,e)}function Jk(e,t){return"".concat(t,"_").concat(e)}function Zk(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var $k=n(8818);const eI=n.n($k)()||$k;function tI(e){return eI.fromString(e,!0,16)}const nI=tI("c3a5c85c97cb3127"),rI=tI("b492b66fbe98f273"),aI=tI("9ae16a3b2f90404f");function iI(e){return e.xor(e.shru(47))}function sI(e,t,n){const r=e.slice(t,t+n);return eI.fromBytes(Array.from(r),!0,!0)}function oI(e,t){return sI(e,t,8)}function lI(e,t){return sI(e,t,4)}function cI(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function uI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tI("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function hI(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=cI(i.add(a).add(r),21);const s=a;return a=(a=a.add(t)).add(n),i=i.add(cI(a,44)),[a.add(r),i.add(s)]}(oI(e,t),oI(e,t+8),oI(e,t+16),oI(e,t+24),n,r)}function dI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=eI.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=aI.add(2*t),r=oI(e,0).add(aI),a=oI(e,t-8);return uI(cI(a,37).mul(n).add(r),cI(r,25).add(a).mul(n),n)}if(t>=4){const n=aI.add(2*t);return uI(lI(e,0).shl(3).add(t),lI(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return iI(aI.mul(n).xor(nI.mul(r))).mul(aI)}return aI}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=aI.add(2*t),r=oI(e,0).mul(rI),a=oI(e,8),i=oI(e,t-8).mul(n),s=oI(e,t-16).mul(aI);return uI(cI(r.add(a),43).add(cI(i,30)).add(s),r.add(cI(a.add(aI),18)).add(i),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=aI.add(2*t),r=oI(e,0).mul(aI),a=oI(e,8),i=oI(e,t-8).mul(n),s=oI(e,t-16).mul(aI),o=cI(r.add(a),43).add(cI(i,30)).add(s),l=uI(o,r.add(cI(a.add(aI),18)).add(i),n),c=oI(e,16).mul(n),u=oI(e,24),h=o.add(oI(e,t-32)).mul(n),d=l.add(oI(e,t-24)).mul(n);return uI(cI(c.add(u),43).add(cI(h,30)).add(d),c.add(cI(u.add(r),18)).add(h),n)}(e,t);let r=n,a=n.mul(rI).add(113),i=iI(a.mul(aI).add(113)).mul(aI),s=[eI.UZERO,eI.UZERO],o=[eI.UZERO,eI.UZERO];r=r.mul(aI).add(oI(e,0));let l=0;const c=64*(t-1>>6),u=c+(t-1&63)-63;do{r=cI(r.add(a).add(s[0]).add(oI(e,l+8)),37).mul(rI),a=cI(a.add(s[1]).add(oI(e,l+48)),42).mul(rI),r=r.xor(o[1]),a=a.add(s[0]).add(oI(e,l+40)),i=cI(i.add(o[0]),33).mul(rI),s=hI(e,l,s[1].mul(rI),r.add(o[0])),o=hI(e,l+32,i.add(o[1]),a.add(oI(e,l+16))),[i,r]=[r,i],l+=64}while(l!==c);const h=rI.add(i.and(255).shl(1));return l=u,o[0]=o[0].add(t-1&63),s[0]=s[0].add(o[0]),o[0]=o[0].add(s[0]),r=cI(r.add(a).add(s[0]).add(oI(e,l+8)),37).mul(h),a=cI(a.add(s[1]).add(oI(e,l+48)),42).mul(h),r=r.xor(o[1].mul(9)),a=a.add(s[0].mul(9).add(oI(e,l+40))),i=cI(i.add(o[0]),33).mul(h),s=hI(e,l,s[1].mul(h),r.add(o[0])),o=hI(e,l+32,i.add(o[1]),a.add(oI(e,l+16))),[i,r]=[r,i],uI(uI(s[0],o[0],h).add(iI(a).mul(nI)).add(i),uI(s[1],o[1],h).add(r),h)}function AI(e,t){return"string"===t?mI(e):pI([e],t)}function pI(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=vI(e)),EE().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function fI(){return EE().platform.now()}function mI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",EE().platform.encode(e,t)}function gI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",EE().platform.decode(e,t)}function yI(e){return null!=EE().platform.isTypedArray?EE().platform.isTypedArray(e):Zk(e)}function vI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||wE(e)||null==e||yI(e)&&n)t.push(e);else if(Array.isArray(e)||yI(e))for(let r=0;r<e.length;++r)vI(e[r],t,n);else{let r=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let a=0;a<=r;a++)vI(e[a],t,n)}return t}class bI{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new wI)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let i;const s=fI();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();i=Promise.resolve({kernelMs:fI()-s})}if(EE().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<r.length;o++){const t=r[o];t.data().then(n=>{xI(n,t.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(e=>e.kernelMs),extraInfo:i.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:i}=e;n.forEach(e=>{Promise.all([e.data(),r,i]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])})})}}function xI(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class wI{logKernelProfile(e,t,n,r,a,i){const s="number"===typeof r?$C("".concat(r,"ms"),9):r.error,o=$C(e,25),l=t.rank,c=t.size,u=$C(t.shape.toString(),14);let h="";for(const d in a){const e=a[d];if(null!=e){const n=e.shape||t.shape,r=n.length;h+="".concat(d,": ").concat(r,"D ").concat(r>0?n:""," ")}}console.log("%c".concat(o,"\t%c").concat(s,"\t%c").concat(l,"D ").concat(u,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function _I(e,t,n,r){const a=AE(t),i=function(e,t,n,r){const a=XC(t),i=r[r.length-1],s=new Array(i).fill(0),o=t.length,l="complex64"===n?NI(e):e;if(o>1)for(let c=0;c<a/i;c++){const e=c*i;for(let t=0;t<i;t++)s[t]=Math.max(s[t],SI(l[e+t],0,n).length)}return s}(e,t,n,a),s=t.length,o=EI(e,t,n,a,i),l=["Tensor"];return r&&(l.push("  dtype: ".concat(n)),l.push("  rank: ".concat(s)),l.push("  shape: [".concat(t,"]")),l.push("  values:")),l.push(o.map(e=>"    "+e).join("\n")),l.join("\n")}function SI(e,t,n){let r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):lE(e)?"'".concat(e,"'"):"bool"===n?CI(e):parseFloat(e.toFixed(7)).toString(),$C(r,t)}function CI(e){return 0===e?"false":"true"}function EI(e,t,n,r,a){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s="complex64"===n?2:1,o=t[0],l=t.length;if(0===l){if("complex64"===n){return[SI(NI(e)[0],0,n)]}return"bool"===n?[CI(e[0])]:[e[0].toString()]}if(1===l){if(o>20){const t=3*s;let r=Array.from(e.slice(0,t)),i=Array.from(e.slice((o-3)*s,o*s));return"complex64"===n&&(r=NI(r),i=NI(i)),["["+r.map((e,t)=>SI(e,a[t],n)).join(", ")+", ..., "+i.map((e,t)=>SI(e,a[o-3+t],n)).join(", ")+"]"]}return["["+("complex64"===n?NI(e):Array.from(e)).map((e,t)=>SI(e,a[t],n)).join(", ")+"]"]}const c=t.slice(1),u=r.slice(1),h=r[0]*s,d=[];if(o>20){for(let t=0;t<3;t++){const r=t*h,i=r+h;d.push(...EI(e.slice(r,i),c,n,u,a,!1))}d.push("...");for(let t=o-3;t<o;t++){const r=t*h,i=r+h;d.push(...EI(e.slice(r,i),c,n,u,a,t===o-1))}}else for(let f=0;f<o;f++){const t=f*h,r=t+h;d.push(...EI(e.slice(t,r),c,n,u,a,f===o-1))}const A=2===l?",":"";d[0]="["+(o>0?d[0]+A:"");for(let f=1;f<d.length-1;f++)d[f]=" "+d[f]+A;let p=",\n";for(let f=2;f<l;f++)p+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":p),d}function NI(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class BI{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=XC(e),null!=n){const e=n.length;GC(e===this.size,()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'."))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||iE(t,this.size),this.strides=AE(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),GC(n.length===this.rank,()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")"));const a=this.locToIndex(n);this.values[a]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let r=0;for(const i of t){if(i<0||i>=this.shape[r]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}r++}let a=t[t.length-1];for(let i=0;i<t.length-1;++i)a+=this.strides[i]*t[i];return this.values[a]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return kI().makeTensor(this.values,this.shape,this.dtype)}}let kI=null,II=null,TI=null;class MI{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=XC(e),this.strides=AE(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return II.buffer(this.shape,this.dtype,e)}bufferSync(){return II.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return fE(this.shape,e,"complex64"===this.dtype)}arraySync(){return fE(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=kI().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map(e=>gI(e))}catch(hS){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),kI().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=kI().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>gI(e))}catch(hS){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await kI().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),kI().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return II.print(this,e)}clone(){return this.throwIfDisposed(),II.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _I(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),II.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),kI().makeVariable(this,e,t,n)}}function FI(){return IE("Tensor",()=>MI)}Object.defineProperty(MI,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),FI();class RI extends MI{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!YC(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));kI().disposeTensor(this),this.dataId=e.dataId,kI().incRef(this,null)}dispose(){kI().disposeVariable(this),this.isDisposedInternal=!0}}var LI,UI,PI,DI,OI;Object.defineProperty(RI,Symbol.hasInstance,{value:e=>e instanceof MI&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(LI||(LI={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(UI||(UI={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(PI||(PI={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(DI||(DI={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(OI||(OI={}));const zI={float32:DI,int32:UI,bool:PI,complex64:OI};function HI(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return zI[e][t]}function jI(e){return HI(e,"int32")}function QI(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function VI(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function WI(e,t){if(e.dtype===t.dtype)return[e,t];const n=HI(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function GI(e,t){return t.some(t=>t.id===e.id)}function KI(e){const t=[];return qI(e,t,new Set),t}function qI(e,t,n){if(null==e)return;if(e instanceof MI)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!==typeof r)return;var r;const a=e;for(const i in a){const e=a[i];n.has(e)||(n.add(e),qI(e,t,n))}}function XI(e){return null!=e.kernelName}class YI{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class JI{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new YI}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(jk("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new bI(this.backendInstance),!0}setupRegisteredKernels(){qk(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){qk(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof zC||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,jk("Initialization of backend ".concat(e," failed")),jk(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return jk("Initialization of backend ".concat(e," failed")),jk(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return JI.nextTensorId++}nextVariableId(){return JI.nextVariableId++}clone(e){const t=$I.runKernel(GN,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return $I.runKernel(eN,t,n)}}),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=Gk(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach(e=>{a+="complex64"===e.dtype?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-a-i;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),a=this.state.numBytes,i=this.state.numTensors;let s,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=XI(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(XI(e)){const{kernelName:t,inputs:a,attrs:i}=e;null==this.backendName&&this.backend;const l=Gk(t,this.backendName);GC(null!=l,()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'")),s=()=>{const e=this.backend.numDataIds();o=l.kernelFunc({inputs:a,attrs:i,backend:this.backend});const s=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,s);const c=s.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(r){const e=this.getTensorsForGradient(t,a,c);n=this.saveTensorsForBackwardMode(e)}return c}}else{const{forwardFunc:t}=e,a=e=>{r&&(n=e.map(e=>this.keep(this.clone(e))))};s=()=>{const e=this.backend.numDataIds();o=this.tidy(()=>t(this.backend,a));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:c,attrs:u}=e,h=XI(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,c,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=s()}),r&&this.addTapeNode(l,c,t,h,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(e=>null!=c[e]?c[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){const t=e.map(e=>this.keep(this.clone(e)));return t}getTensorsForGradient(e,t,n){const r=Kk(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let i;r.saveAllInputs?(GC(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),i=Object.keys(t).map(e=>t[e])):i=e.map(e=>t[e]);const s=n.filter((e,t)=>a[t]);return i.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&lE(e[0])&&(a=e.map(e=>mI(e)));const i=r.write(a,t,n),s=new MI(t,n,i,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){const e=this.state.tensorInfo.get(i),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){const a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:a}=e,i=new MI(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new RI(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*oE(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof RI||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*oE(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,i){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},o=Kk(e);null!=o&&(r=o.gradFunc),null!=r&&(s.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=gE(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],a,i))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=KI(e),n=new Set(t.map(e=>e.id));for(let a=0;a<this.state.activeScope.track.length;a++){const e=this.state.activeScope.track[a];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(GC(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));GC(a instanceof MI,()=>"The result y returned by f() must be a tensor.");const i=function(e,t,n){const r={},a={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],i=n.inputs;for(const e in i){const s=i[e];let o=!1;for(let e=0;e<t.length;e++)if(r[s.id]){n.outputs.forEach(e=>r[e.id]=!0),o=!0,a[n.id]=!0;break}if(o)break}}const i={};i[n.id]=!0;const s={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(i[t.outputs[e].id]){for(const e in n)i[n[e].id]=!0,s[t.id]=!0;break}}const o=[];for(let l=0;l<e.length;l++){const t=e[l];if(a[t.id]&&s[t.id]){const e={};for(const a in t.inputs){const n=t.inputs[a];r[n.id]&&(e[a]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,o.push(n)}}return o}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[a.id]=null==n?function(e){const t=mE(XC(e),"float32");return $I.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const i=t[a],s=[];if(i.outputs.forEach(t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)}),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));const o=i.gradient(s);for(const t in i.inputs){if(!(t in o))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(o),"."));const a=n(()=>o[t]());if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));const s=i.inputs[t];if(!YC(a.shape,s.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(s.shape,"'"));if(null==e[s.id])e[s.id]=a;else{const t=e[s.id];e[s.id]=r(t,a),t.dispose()}}}}(e,i,e=>this.tidy(e),eT);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:a,grads:r}})}customGrad(e){var t=this;return GC(hE(e),()=>"The f passed in customGrad(f) must be a function."),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];let i;GC(r.every(e=>e instanceof MI),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const s={};r.forEach((e,t)=>{s[t]=e});return t.runKernelFunc({forwardFunc:(t,n)=>(i=e(...r,n),GC(i.value instanceof MI,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),GC(hE(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),backwardsFunc:(e,t)=>{const n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];GC(a.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),GC(a.every(e=>e instanceof MI),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const s={};return a.forEach((e,t)=>{s[t]=()=>e}),s},inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=fI(),n=await this.backend.time(e);return n.wallMs=fI()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new YI;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function ZI(){const e=kE();if(null==e._tfengine){const t=new SE(e);e._tfengine=new JI(t)}var t;return t=e._tfengine.ENV,BE=t,kI=()=>e._tfengine,e._tfengine}JI.nextTensorId=0,JI.nextVariableId=0;const $I=ZI();function eT(e,t){const n={a:e,b:t};return $I.runKernel(RE,n)}let tT;function nT(e){if(void 0!==tT)return tT;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function rT(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}const aT=EE();function iT(e,t){let n=e;if(yI(e))return"string"===t?[]:[e.length];if(QI(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(VI(e))return[e.buffer.size/(null==t?4:oE(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||yI(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&EE().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&sT(e,r,[]),r}function sT(e,t,n){if(n=n||[],!Array.isArray(e)&&!yI(e))return void GC(0===t.length,()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements"));GC(t.length>0,()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")),GC(e.length===t[0],()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements"));const r=t.slice(1);for(let a=0;a<e.length;++a)sT(e[a],r,n.concat(a))}function oT(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function lT(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof FI())return oT(r,e.dtype,t,n),e;let a=uE(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),oT(r,a,t,n),null==e||!yI(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const r=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(r,"'"))}const i=iT(e,a);yI(e)||Array.isArray(e)||(e=[e]);const s="string"!==a?pI(e,a):vI(e,[],!0);return $I.makeTensor(s,i,a)}function cT(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((e,a)=>lT(e,"".concat(t,"[").concat(a,"]"),n,r))}aT.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),aT.registerFlag("IS_BROWSER",()=>rT()),aT.registerFlag("IS_NODE",()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node),aT.registerFlag("IS_CHROME",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),aT.registerFlag("IS_SAFARI",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),aT.registerFlag("PROD",()=>!1),aT.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>aT.getBool("DEBUG")),aT.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),aT.registerFlag("IS_TEST",()=>!1),aT.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>aT.getBool("DEBUG")),aT.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),aT.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),aT.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);const uT="__op";function hT(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=uT;const a=function(){$I.startScope(n);try{const e=r(...arguments);return wE(e)&&console.error("Cannot return a Promise inside of tidy."),$I.endScope(e),e}catch(e){throw $I.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const dT=hT({complex_:function(e,t){const n=lT(e,"real","complex"),r=lT(t,"imag","complex");KC(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");const a={real:n,imag:r};return $I.runKernel(rN,a)}});function AT(e,t,n,r){if(null==r)r=uE(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(VI(e)||QI(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return $I.backend.createTensorFromGPUData(e,t||n,r)}if(!yI(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){vE(t);const e=XC(t),r=XC(n);GC(e===r,()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(r));for(let a=0;a<n.length;++a){const e=n[a],r=a!==n.length-1||e!==XC(t.slice(a));GC(n[a]===t[a]||!r,()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). "))}}return yI(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?pI(e,r):vI(e,[],!0),$I.makeTensor(e,t,r)}function pT(e,t,n){return AT(e,t,iT(e,n),n)}const fT={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class mT{static join(e){return new mT(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map(e=>yI(e)?e.buffer:e)).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const a=t+r.byteLength;this.shards.push({buffer:r,start:t,end:a}),t=a}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const r=new ArrayBuffer(t-e),a=new Uint8Array(r);let i=0;for(let s=n;s<this.shards.length;s++){const n=this.shards[s],r=e+i-n.start,o=i,l=Math.min(t,n.end)-n.start,c=new Uint8Array(n.buffer,r,l-r);if(a.set(c,o),i+=c.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,r=e.length;for(;n<=r;){const a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function gT(){return $I}function yT(){return $I.memory()}function vT(e,t){return $I.tidy(e,t)}function bT(e){KI(e).forEach(e=>e.dispose())}function xT(e){return $I.keep(e)}function wT(){return $I.backendName}function _T(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return $I.registerBackend(e,t,n)}function ST(){return $I.backend}TI=function(e){EE().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")};const CT=4;async function ET(e,t){const n=[],r=[],a=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let i=0;i<a.length;++i){const s=a[i],o=Array.isArray(e)?e[i].tensor:e[s];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(o.dtype));const l={name:s,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise(async e=>{const t=await o.bytes(),n=t.reduce((e,t)=>e+t.length,0)+CT*t.length,r=new Uint8Array(n);let a=0;for(let i=0;i<t.length;i++){const e=t[i],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,a),a+=CT,r.set(e,a),a+=e.length}e(r)});r.push(e)}else r.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:FT(await Promise.all(r)),specs:n}}function NT(e,t){const n=new mT(e),r={};let a=0;for(const i of t){const e=BT(i,(e,t)=>n.slice(a+e,a+t));r[i.name]=IT(i,n.slice(a,a+e)),a+=e}return r}function BT(e,t){const n=XC(e.shape);let r;if("quantization"in e){const t=e.quantization;r=fT[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=CT+new Uint32Array(t(e,e+CT))[0];return e}r=fT[e.dtype]}return n*r}async function kT(e,t){const n=XC(e.shape);let r;if("quantization"in e){const t=e.quantization;r=fT[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=CT+new Uint32Array(await t(e,e+CT))[0];return e}r=fT[e.dtype]}return n*r}function IT(e,t){const n=e.name,r=e.dtype,a=e.shape,i=XC(a);let s,o=0;if("quantization"in e){const a=e.quantization;if("uint8"===a.dtype||"uint16"===a.dtype){if(!("min"in a)||!("scale"in a))throw new Error("Weight ".concat(e.name," with quantization ").concat(a.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==a.dtype)throw new Error("Weight ".concat(e.name," has unknown ")+"quantization dtype ".concat(a.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==r)throw new Error("Weight ".concat(e.name," is quantized with ").concat(a.dtype," ")+"which only supports weights of type float32 not ".concat(r,"."))}const l=fT[a.dtype],c="uint8"===a.dtype?new Uint8Array(t):new Uint16Array(t);if("float32"===r)if("uint8"===a.dtype||"uint16"===a.dtype){s=new Float32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];s[e]=t*a.scale+a.min}}else{if("float16"!==a.dtype)throw new Error("Unsupported quantization type ".concat(a.dtype," ")+"for weight type float32.");{const e=function(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0===(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const a=new ArrayBuffer(4*r.length),i=new Uint32Array(a);for(let s=0;s<r.length;s++){const a=r[s],o=e[n[a>>10]+(1023&a)]+t[a>>10];i[s]=o}return new Float32Array(a)}}();s=e(c)}}else{if("int32"!==r)throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(r));if("uint8"!==a.dtype&&"uint16"!==a.dtype)throw new Error("Unsupported quantization type ".concat(a.dtype," ")+"for weight type int32.");s=new Int32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];s[e]=Math.round(t*a.scale+a.min)}}o+=i*l}else if("string"===r){const n=XC(e.shape);s=[];for(let e=0;e<n;e++){const e=new Uint32Array(t.slice(o,o+CT))[0];o+=CT;const n=new Uint8Array(t.slice(o,o+e));s.push(n),o+=e}}else{const e=fT[r];if("float32"===r)s=new Float32Array(t);else if("int32"===r)s=new Int32Array(t);else{if("bool"!==r){if("complex64"===r){s=new Float32Array(t);const e=new Float32Array(s.length/2),n=new Float32Array(s.length/2);for(let t=0;t<e.length;t++)e[t]=s[2*t],n[t]=s[2*t+1];const r=pT(e,a,"float32"),i=pT(n,a,"float32"),o=dT(r,i);return r.dispose(),i.dispose(),o}throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(r))}s=new Uint8Array(t)}o+=i*e}return pT(s,a,r)}async function TT(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){const{done:t,value:a}=await e.read();if(t&&null==a){const e=n-r.byteLength;throw new Error("Reader is done but ".concat(e," bytes are still expected"))}const i=new Uint8Array(r.length+a.byteLength);i.set(r,0),i.set(new Uint8Array(a),r.length),r=i}return r.buffer}async function MT(e,t){const n={},r=e.getReader();let a=new ArrayBuffer(0);for(const i of t){const e=await kT(i,async(e,t)=>(a=await TT(r,a,t),a.slice(e,t)));a=await TT(r,a,e);const t=a.slice(0,e);a=a.slice(e);const s=IT(i,t);if(n[i.name]=s,"webgpu"===wT()){const e=ST();"uploadToGPU"in e&&XC(s.shape)>=EE().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&e.uploadToGPU(s.dataId)}}return n}function FT(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))});const r=new Uint8Array(t);let a=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),a),a+=e.byteLength}),r.buffer}const RT="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function LT(e){return RT?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function UT(e){return mT.join(e)}function PT(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function DT(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function OT(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function zT(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),OT(e,n,r)}function HT(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:LT(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:LT(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new mT(e.weightData).byteLength}}function jT(e){const t=[];for(const n of e)t.push(...n.weights);return t}class QT{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==QT.instance&&(QT.instance=new QT),QT.instance}static registerSaveRouter(e){QT.getInstance().saveRouters.push(e)}static registerLoadRouter(e){QT.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return QT.getHandlers(e,"save")}static getLoadHandlers(e,t){return QT.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?QT.getInstance().loadRouters:QT.getInstance().saveRouters).forEach(t=>{const a=t(e,n);null!==a&&r.push(a)}),r}}const VT=e=>QT.registerSaveRouter(e),WT=e=>QT.registerLoadRouter(e),GT=e=>QT.getSaveHandlers(e),KT=(e,t)=>QT.getLoadHandlers(e,t),qT="tensorflowjs",XT="models_store",YT="model_info_store";function JT(){if(!EE().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function ZT(e){const t=e.result;t.createObjectStore(XT,{keyPath:"modelPath"}),t.createObjectStore(YT,{keyPath:"modelPath"})}class $T{constructor(e){if(this.indexedDB=JT(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const r=this.indexedDB.open(qT,1);r.onupgradeneeded=()=>ZT(r),r.onsuccess=()=>{const a=r.result;if(null==t){const t=a.transaction(XT,"readonly"),r=t.objectStore(XT).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return a.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(r.result.modelArtifacts)},r.onerror=e=>(a.close(),n(r.error)),t.oncomplete=()=>a.close()}else{t.weightData=mT.join(t.weightData);const r=HT(t),i=a.transaction(YT,"readwrite");let s,o,l=i.objectStore(YT);try{s=l.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(_S){return n(_S)}s.onsuccess=()=>{o=a.transaction(XT,"readwrite");const s=o.objectStore(XT);let c;try{c=s.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(_S){return n(_S)}c.onsuccess=()=>e({modelArtifactsInfo:r}),c.onerror=e=>{l=i.objectStore(YT);const t=l.delete(this.modelPath);t.onsuccess=()=>(a.close(),n(c.error)),t.onerror=e=>(a.close(),n(c.error))}},s.onerror=e=>(a.close(),n(s.error)),i.oncomplete=()=>{null==o?a.close():o.oncomplete=()=>a.close()}}},r.onerror=e=>n(r.error)})}}$T.URL_SCHEME="indexeddb://";const eM=e=>{return EE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith($T.URL_SCHEME)?(t=e.slice($T.URL_SCHEME.length),new $T(t)):null;var t};QT.registerSaveRouter(eM),QT.registerLoadRouter(eM);class tM{constructor(){this.indexedDB=JT()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(qT,1);n.onupgradeneeded=()=>ZT(n),n.onsuccess=()=>{const r=n.result,a=r.transaction(YT,"readonly"),i=a.objectStore(YT).getAll();i.onsuccess=()=>{const t={};for(const e of i.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},i.onerror=e=>(r.close(),t(i.error)),a.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith($T.URL_SCHEME)?t.slice($T.URL_SCHEME.length):t,new Promise((t,n)=>{const r=this.indexedDB.open(qT,1);r.onupgradeneeded=()=>ZT(r),r.onsuccess=()=>{const a=r.result,i=a.transaction(YT,"readwrite"),s=i.objectStore(YT),o=s.get(e);let l;o.onsuccess=()=>{if(null==o.result)return a.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const r=s.delete(e),i=()=>{l=a.transaction(XT,"readwrite");const r=l.objectStore(XT).delete(e);r.onsuccess=()=>t(o.result.modelArtifactsInfo),r.onerror=e=>n(o.error)};r.onsuccess=i,r.onerror=e=>(i(),a.close(),n(o.error))}},o.onerror=e=>(a.close(),n(o.error)),i.oncomplete=()=>{null==l?a.close():l.oncomplete=()=>a.close()}},r.onerror=e=>n(r.error)})}}const nM="/",rM="tensorflowjs_models",aM="info",iM="model_topology",sM="weight_specs",oM="weight_data",lM="model_metadata";function cM(e){return{info:[rM,e,aM].join(nM),topology:[rM,e,iM].join(nM),weightSpecs:[rM,e,sM].join(nM),weightData:[rM,e,oM].join(nM),modelMetadata:[rM,e,lM].join(nM)}}function uM(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function hM(e){const t=e.split(nM);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(nM)}class dM{constructor(e){if(!EE().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=cM(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=HT(e),i=mT.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(RT)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(i));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:a}}catch(t){throw uM(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=r;const a=this.LS.getItem(this.keys.modelMetadata);if(null!=a){const e=JSON.parse(a);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(null==i)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(RT){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(i),t}}dM.URL_SCHEME="localstorage://";const AM=e=>{return EE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(dM.URL_SCHEME)?(t=e.slice(dM.URL_SCHEME.length),new dM(t)):null;var t};QT.registerSaveRouter(AM),QT.registerLoadRouter(AM);class pM{constructor(){GC(EE().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),GC("undefined"===typeof window||"undefined"!==typeof window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=rM+nM,n=nM+aM;for(let r=0;r<this.LS.length;++r){const a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){e[hM(a)]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){var t;const n=cM(e=(t=e).startsWith(dM.URL_SCHEME)?t.slice(dM.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const r=JSON.parse(this.LS.getItem(n.info));return uM(n),r}}const fM="://";class mM{constructor(){this.managers={}}static getInstance(){return null==mM.instance&&(mM.instance=new mM),mM.instance}static registerManager(e,t){GC(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(fM)&&(e=e.slice(0,e.indexOf(fM))),GC(e.length>0,()=>"scheme must not be an empty string.");const n=mM.getInstance();GC(null==n.managers[e],()=>"A model store manager is already registered for scheme '".concat(e,"'.")),n.managers[e]=t}static getManager(e){const t=mM.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(mM.getInstance().managers)}}function gM(e){if(-1===e.indexOf(fM))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(mM.getSchemes().join(",")));return{scheme:e.split(fM)[0],path:e.split(fM)[1]}}async function yM(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];GC(e!==t,()=>"Old path and new path are the same: '".concat(e,"'"));const r=QT.getLoadHandlers(e);GC(r.length>0,()=>"Copying failed because no load handler is found for source URL ".concat(e,".")),GC(r.length<2,()=>"Copying failed because more than one (".concat(r.length,") ")+"load handlers for source URL ".concat(e,"."));const a=r[0],i=QT.getSaveHandlers(t);GC(i.length>0,()=>"Copying failed because no save handler is found for destination "+"URL ".concat(t,".")),GC(i.length<2,()=>"Copying failed because more than one (".concat(r.length,") ")+"save handlers for destination URL ".concat(t,"."));const s=i[0],o=gM(e).scheme,l=gM(e).path,c=o===gM(e).scheme,u=await a.load();n&&c&&await mM.getManager(o).removeModel(l);const h=await s.save(u);return n&&!c&&await mM.getManager(o).removeModel(l),h.modelArtifactsInfo}async function vM(){const e=mM.getSchemes(),t={};for(const n of e){const e=await mM.getManager(n).listModels();for(const r in e){t[n+fM+r]=e[r]}}return t}async function bM(e){const t=gM(e);return mM.getManager(t.scheme).removeModel(t.path)}async function xM(e,t){return yM(e,t,!1)}async function wM(e,t){return yM(e,t,!0)}class _M{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!==typeof window&&EE().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))):setTimeout(e,t)}isTypedArray(e){return Zk(e)}}if(EE().get("IS_BROWSER")){EE().setPlatform("browser",new _M);try{mM.registerManager(dM.URL_SCHEME,new pM)}catch(lhe){}try{mM.registerManager($T.URL_SCHEME,new tM)}catch(lhe){}}const SM=()=>n(5817);let CM;class EM{constructor(){this.util=n(8590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=EE().global.fetch?EE().global.fetch(e,t):(null==CM&&(CM=SM()),CM(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function NM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",vE(e),new BI(e,t,n)}EE().get("IS_NODE")&&!EE().get("IS_BROWSER")&&EE().setPlatform("node",new EM);const BM=hT({cast_:function(e,t){const n=lT(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},a={dtype:t};return $I.runKernel(eN,r,a)}});const kM=hT({clone_:function(e){const t={x:lT(e,"x","clone","string_or_numeric")};return $I.runKernel(GN,t)}});function IM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}ZI();II={buffer:NM,cast:BM,clone:kM,print:IM};const TM=hT({add_:function(e,t){let n=lT(e,"a","add"),r=lT(t,"b","add");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(RE,a)}});const MM=hT({floorDiv_:function(e,t){let n=lT(e,"a","floorDiv"),r=lT(t,"b","floorDiv");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(zN,a)}});const FM=hT({div_:function(e,t){let n=lT(e,"a","div"),r=lT(t,"b","div");if([n,r]=WI(n,r),"int32"===n.dtype&&"int32"===r.dtype)return MM(n,r);const a={a:n,b:r};return $I.runKernel(NN,a,{})}});const RM=hT({mul_:function(e,t){let n=lT(e,"a","mul"),r=lT(t,"b","mul");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(wB,a)}});const LM=hT({sqrt_:function(e){const t={x:lT(e,"x","sqrt","float32")};return $I.runKernel(lk,t)}});const UM=hT({square_:function(e){const t=lT(e,"x","square");return $I.runKernel("Square",{x:t},{})}});const PM=hT({zerosLike_:function(e){const t={x:lT(e,"x","zerosLike")};return $I.runKernel(Lk,t)}});function DM(e){return $I.customGrad(e)}function OM(e,t){if((yI(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&yI(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return AT(e,[],[],t)}const zM=new Map,HM=new Map;class jM{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class QM{constructor(){this.classNameMap={}}static getMap(){return null==QM.instance&&(QM.instance=new QM),QM.instance}static register(e){QM.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function VM(e,t,n){GC(null!=e.className,()=>"Class being registered does not have the static className property defined."),GC("string"===typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),GC(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),"undefined"===typeof t&&(t="Custom"),"undefined"===typeof n&&(n=e.className);const r=t+">"+n;return QM.register(e),zM.set(r,e),HM.set(e,r),e}class WM extends jM{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:r,grads:a}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:a[e.name]}));this.applyGradients(e)}else this.applyGradients(a);return bT(a),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){GC(hE(e),()=>"The f passed in variableGrads(f) must be a function"),GC(null==t||Array.isArray(t)&&t.every(e=>e instanceof RI),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in $I.registeredVariables)t.push($I.registeredVariables[e])}const r=n?t.filter(e=>!e.trainable):null,a=t.length;t=t.filter(e=>e.trainable),GC(t.length>0,()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(a," variables is ")+"trainable.");const{value:i,grads:s}=$I.gradients(e,t,null,!0);GC(s.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),GC(0===i.rank,()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(i.rank," tensor"));const o={};return t.forEach((e,t)=>{null!=s[t]&&(o[e.name]=s[t])}),null!=r&&r.forEach(e=>o[e.name]=null),{value:i,grads:o}}(e,t)}dispose(){null!=this.iterations_&&bT(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:OM(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(WM,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class GM extends WM{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=$I.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=$I.registeredVariables[t],a=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:vT(()=>PM(r).variable(a))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:vT(()=>PM(r).variable(a))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;vT(()=>{const e=TM(RM(s,this.rho),RM(UM(i),1-this.rho)),t=RM(FM(LM(TM(o,this.epsilon)),LM(TM(s,this.epsilon))),i),n=TM(RM(o,this.rho),RM(UM(t),1-this.rho));s.assign(e),o.assign(n);const a=TM(RM(t,-this.learningRate),r);r.assign(a)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(bT(this.accumulatedGrads.map(e=>e.variable)),bT(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function KM(e,t,n){vE(e);const r={shape:e,value:t,dtype:n=n||uE(t)};return $I.runKernel(PN,{},r)}class qM extends WM{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=$I.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:vT(()=>KM(r.shape,this.initialAccumulatorValue).variable(e))}}const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const i=this.accumulatedGrads[n].variable;vT(()=>{const e=TM(i,UM(a));i.assign(e);const t=TM(RM(FM(a,LM(TM(e,$I.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&bT(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}const XM=hT({pow_:function(e,t){let n=lT(e,"base","pow"),r=lT(t,"exp","pow");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(MB,a)}});const YM=hT({sub_:function(e,t){let n=lT(e,"a","sub"),r=lT(t,"b","sub");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(Ck,a)}});class JM extends WM{static get className(){return"Adam"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],vT(()=>{this.accBeta1=OM(t).variable(),this.accBeta2=OM(n).variable()}),null==r&&(this.epsilon=$I.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);vT(()=>{const n=YM(1,this.accBeta1),r=YM(1,this.accBeta2);t.forEach((t,a)=>{const i=$I.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:vT(()=>PM(i).variable(s))}),null==this.accumulatedSecondMoment[a]&&(this.accumulatedSecondMoment[a]={originalName:"".concat(t,"/v"),variable:vT(()=>PM(i).variable(s))});const o=Array.isArray(e)?e[a].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[a].variable,c=this.accumulatedSecondMoment[a].variable,u=TM(RM(l,this.beta1),RM(o,1-this.beta1)),h=TM(RM(c,this.beta2),RM(UM(o),1-this.beta2)),d=FM(u,n),A=FM(h,r);l.assign(u),c.assign(h);const p=TM(RM(FM(d,TM(LM(A),this.epsilon)),-this.learningRate),i);i.assign(p)}),this.accBeta1.assign(RM(this.accBeta1,this.beta1)),this.accBeta2.assign(RM(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&bT(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&bT(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),vT(()=>{this.accBeta1.assign(XM(this.beta1,this.iterations_+1)),this.accBeta2.assign(XM(this.beta2,this.iterations_+1))});const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}const ZM=hT({abs_:function(e){const t=lT(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return $I.runKernel(aN,e)}{const e={x:t};return $I.runKernel(TE,e)}}});function $M(e,t){const n=e.length,r=[];for(let a=0;a<n;a++){const i=n-1-a,s=e[i]||1;(t[t.length-1-a]||1)>1&&1===s&&r.unshift(i)}return r}function eF(e,t){const n=[];for(let r=0;r<t.length;r++){const a=e[e.length-r-1],i=t.length-r-1,s=t[i];(null==a||1===a&&s>1)&&n.unshift(i)}return n}function tF(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let i=e[e.length-a-1];null==i&&(i=1);let s=t[t.length-a-1];if(null==s&&(s=1),1===i)r[n-a-1]=s;else if(1===s)r[n-a-1]=i;else{if(i!==s){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}r[n-a-1]=i}}return r}const nF=hT({maximum_:function(e,t){let n=lT(e,"a","maximum"),r=lT(t,"b","maximum");[n,r]=WI(n,r),"bool"===n.dtype&&(n=BM(n,"int32"),r=BM(r,"int32")),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(uB,a)}});class rF extends WM{static get className(){return"Adamax"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],vT(()=>{this.iteration=OM(0).variable(),this.accBeta1=OM(t).variable()}),null==r&&(this.epsilon=$I.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);vT(()=>{const n=YM(1,this.accBeta1),r=FM(-this.learningRate,TM(RM(this.iteration,this.decay),1));t.forEach((t,a)=>{const i=$I.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[a]&&(this.accumulatedFirstMoment[a]={originalName:"".concat(t,"/m"),variable:PM(i).variable(s)}),null==this.accumulatedWeightedInfNorm[a]&&(this.accumulatedWeightedInfNorm[a]={originalName:"".concat(t,"/v"),variable:PM(i).variable(s)});const o=Array.isArray(e)?e[a].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[a].variable,c=this.accumulatedWeightedInfNorm[a].variable,u=TM(RM(l,this.beta1),RM(o,1-this.beta1)),h=RM(c,this.beta2),d=ZM(o),A=nF(h,d);l.assign(u),c.assign(A);const p=TM(RM(FM(r,n),FM(u,TM(A,this.epsilon))),i);i.assign(p)}),this.iteration.assign(TM(this.iteration,1)),this.accBeta1.assign(RM(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&bT(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&bT(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class aF extends WM{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);t.forEach((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const a=$I.registeredVariables[t];vT(()=>{const e=TM(RM(this.c,r),a);a.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=xT(OM(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class iF extends aF{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=OM(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=$I.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:vT(()=>PM(r).variable(e))}}const a=this.accumulations[n].variable,i=Array.isArray(e)?e[n].tensor:e[t];null!=i&&vT(()=>{let e;const t=TM(RM(this.m,a),i);e=this.useNesterov?TM(RM(this.c,TM(i,RM(t,this.m))),r):TM(RM(this.c,t),r),a.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&bT(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class sF extends WM{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,null==r&&(this.epsilon=$I.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=$I.registeredVariables[t],a=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:vT(()=>PM(r).variable(a))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:vT(()=>PM(r).variable(a))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:vT(()=>PM(r).variable(a))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;vT(()=>{const e=TM(RM(s,this.decay),RM(UM(i),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,a=TM(RM(t,this.decay),RM(i,1-this.decay)),l=FM(RM(i,this.learningRate),LM(YM(e,TM(UM(a),this.epsilon)))),c=TM(RM(o,this.momentum),l);s.assign(e),t.assign(a),o.assign(c);const u=YM(r,c);r.assign(u)}else{const e=TM(RM(s,this.decay),RM(UM(i),1-this.decay)),t=TM(RM(o,this.momentum),FM(RM(i,this.learningRate),LM(TM(e,this.epsilon))));s.assign(e),o.assign(t);const n=YM(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&bT(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&bT(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&bT(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const oF=[GM,qM,JM,rF,iF,sF,aF];function lF(e){return new Promise(e=>setTimeout(e)).then(e)}class cF{constructor(e){if(!EE().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(cF.URL_SCHEME)&&(e=e.slice(cF.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=mT.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=DT(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),a=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=r,await lF(()=>a.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await lF(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:HT(e)}}}}cF.URL_SCHEME="downloads://";class uF{constructor(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),a=r.modelTopology;if(null==a)return void t(new Error("modelTopology field is missing from file ".concat(this.jsonFile.name)));if(null==r.weightsManifest)return void t(new Error("weightManifest field is missing from file ".concat(this.jsonFile.name)));if(0===this.weightsFiles.length)return void e({modelTopology:a});const i=zT(r,e=>this.loadWeights(e));e(i)},n.onerror=e=>t("Failed to read model topology and weights manifest JSON "+"from file '".concat(this.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only."),n.readAsText(this.jsonFile)})}loadWeights(e){const t=[],n=[];for(const i of e)t.push(...i.weights),n.push(...i.paths);const r=this.checkManifestAndWeightFiles(e),a=n.map(e=>this.loadWeightsFile(e,r[e]));return Promise.all(a).then(e=>[t,e])}loadWeightsFile(e,t){return new Promise((n,r)=>{const a=new FileReader;a.onload=e=>{const t=e.target.result;n(t)},a.onerror=t=>r("Failed to weights data from file of path '".concat(e,"'.")),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],n=this.weightsFiles.map(e=>PT(e.name)),r={};for(const a of e)a.paths.forEach(e=>{const a=PT(e);if(-1!==t.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(a,"'"));if(t.push(a),-1===n.indexOf(a))throw new Error("Weight file with basename '".concat(a,"' is not provided."));r[e]=this.weightsFiles[n.indexOf(a)]});if(t.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(t.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return r}}function hF(e){return new uF(e)}function dF(e,t,n,r){!function(e){GC(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){GC(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)),GC(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)),GC(t>=e,()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t))}(n=null==n?0:n,r=null==r?1:r);let a=0;return Promise.all(e.map(i=>(i.then(i=>{const s=n+ ++a/e.length*(r-n);return t(s),i}),i)))}async function AF(e,t){null==t&&(t={});const n=null==t.fetchFunc?EE().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),a=(null==t.onProgress?await Promise.all(r):await dF(r,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(a):await dF(a,t.onProgress,.5,1)}async function pF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return fF(e=>AF(e,{requestInit:r}))(e,t,n)}function fF(e){return async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;const a=t.map(()=>!1),i={},s=null!=r?r.map(()=>!1):[],o=[];if(t.forEach((e,t)=>{let n=0;e.weights.forEach(e=>{const l="quantization"in e?e.quantization.dtype:e.dtype,c=fT[l]*XC(e.shape),u=()=>{a[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=r?r.forEach((t,n)=>{t===e.name&&(u(),s[n]=!0)}):u(),o.push(e.name),n+=c})}),!s.every(e=>e)){const e=r.filter((e,t)=>!s[t]);throw new Error("Could not find weights in manifest with names: "+"".concat(e.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(o.join(", "),"."))}const l=a.reduce((e,t,n)=>(t&&e.push(n),e),[]),c=[];l.forEach(e=>{t[e].paths.forEach(e=>{const t=n+(n.endsWith("/")?"":"/")+e;c.push(t)})});const u=await e(c),h={};let d=0;return l.forEach(e=>{const n=t[e].paths.length,r=new mT(u.slice(d,d+n));i[e].forEach(e=>{const t=NT(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)h[n]=t[n]}),d+=n}),h}}QT.registerSaveRouter(e=>EE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cF.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new cF(e)}(e.slice(cF.URL_SCHEME.length)):null);class mF{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(GC("function"===typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=EE().platform.fetch,GC(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&GC(2===e.length,()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=DT(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=mT.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:HT(e),responses:[r]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(r.status,"."))}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch(a){let e="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();return zT(await this.loadModelJSON(),e=>this.loadWeights(e))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=jT(e.weightsManifest);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:()=>function(e,t){var n;const r=null==t.fetchFunc?EE().platform.fetch:t.fetchFunc;let a,i=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var s;i<e.length;){if(!a){const n=(await r(e[i],t.requestInit,{isBinary:!0})).body;a=n.getReader()}const{done:o,value:l}=await a.read();if(!o)return void n.enqueue(l);i++,a=void 0,null===(s=t.onProgress)||void 0===s||s.call(t,i/e.length)}n.close()}})}(t,this.loadOptions)})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}(t),a=this.weightPathPrefix||n,i=[],s=[];for(const o of e)for(const e of o.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(e)):i.push(a+e+r);return this.weightUrlConverter&&i.push(...await Promise.all(s)),i}async loadWeights(e){const t=await this.getWeightUrls(e);return[jT(e),await AF(t,this.loadOptions)]}}function gF(e){return null!=e.match(mF.URL_SCHEME_REGEX)}mF.URL_SCHEME_REGEX=/^https?:\/\//;const yF=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>gF(e)):gF(e),n)return vF(e,t)}return null};function vF(e,t){return new mF(e,t)}function bF(e,t){return vF(e,t)}QT.registerSaveRouter(yF),QT.registerLoadRouter(yF);class xF{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class wF{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class _F{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function SF(e,t,n,r){return new _F(CF(...arguments))}function CF(e,t,n,r){if(1===arguments.length){return null!=e.modelTopology||null!=e.weightSpecs?new xF(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xF({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xF({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function EF(e){return new wF(e)}function NF(e){return new wF(e)}function BF(e,t,n){if(qC(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=iT(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return AT(e,t,r,n)}let kF;function IF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,i=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));o=!0}if(null!=Gk(Pk,$I.backendName)){const n={pixels:e},r={numChannels:t};return $I.runKernel(Pk,n,r)}const[l,c]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height];let u,h;if(s)u=e.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)u=e.data;else if(i||a||o){if(null==kF)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");kF=new OffscreenCanvas(1,1).getContext("2d")}else kF=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});kF.canvas.width=l,kF.canvas.height=c,kF.drawImage(e,0,0,l,c),u=kF.getImageData(0,0,l,c).data}if(4===t)h=new Int32Array(u);else{const e=l*c;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=u[4*n+e]}return BF(h,[c,l,t],"int32")}const TF=hT({fromPixels_:IF}),MF=-2,FF=-1;function RF(e,t,n){const r=e.shape.length;GC(r===t.length,()=>"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")),GC(r===n.length,()=>"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,")."));for(let a=0;a<r;++a)GC(t[a]+n[a]<=e.shape[a],()=>"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")"))}function LF(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function UF(e,t,n){const r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function PF(e,t,n,r){const a=[...e];for(let i=a.length;i<r.length;i++)a.push(1);for(let i=0;i<n;i++)0===i?a[t]=1:(a.splice(t,0,1),a.pop());return a}function DF(e,t,n){return n<=e?n:n-(t-1)}function OF(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function zF(e,t,n,r,a,i,s,o,l){const c=e.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;u=HF(s,l,c,r,e),h=jF(o,l,c,a,e),d=PF(i,l,c,e)}else for(let A=0;A<c;A++)u[A]=VF(s,r,i,e,A,l),h[A]=WF(o,a,i,e,A,l),d[A]=QF(i,A,l);return{begin:u,end:h,strides:d}}function HF(e,t,n,r,a){const i=[...a],s=OF(n,t);for(let o=0;o<i.length;o++)if(s.indexOf(o)>-1)i[o]=0;else{const a=DF(t,n,o);let s=r[a];e&1<<a&&(s=0),i[o]=s}return i}function jF(e,t,n,r,a){const i=[...a],s=OF(n,t);for(let o=0;o<i.length;o++)if(s.indexOf(o)>-1)i[o]=Number.MAX_SAFE_INTEGER;else{const a=DF(t,n,o);let s=r[a];e&1<<a&&(s=Number.MAX_SAFE_INTEGER),i[o]=s}for(let o=0;o<i.length;o++){const e=a[o];i[o]<0&&(i[o]+=e),i[o]=QC(0,i[o],a[o])}return i}function QF(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function VF(e,t,n,r,a,i){let s=t[a];const o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=r[a];return s<0&&(s+=l),s=QC(0,s,l-1),s}function WF(e,t,n,r,a,i){let s=t[a];const o=n[a]||1;(e&1<<a||i&1<<a||null==s)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[a];return s<0&&(s+=l),s=o>0?QC(0,s,l):QC(-1,s,l-1),s}function GF(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function KF(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function qF(e,t,n){let r;const a=e.shape.length;let i;return r="number"===typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),r.forEach(e=>{GC(-1!==e,()=>"slice() does not support negative begin indexing.")}),i=null==n?new Array(a).fill(-1):"number"===typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,i=i.map((t,n)=>t>=0?t:(GC(-1===t,()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")),e.shape[n]-r[n])),[r,i]}function XF(e,t,n,r,a,i,s,o,l){let c;if(null==r?(c=new Array(t.length),c.fill(1)):c=r,null!=s&&0!==(s&s-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)u&&0!==(1<<v&o)&&h.numAddAxisAfterEllipsis++,1<<v&s&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(MF),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(FF),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let A=!0,p=!0,f=!0;const m=[],g=[];for(let v=0;v<e.length;++v){if(0===d.strides[v])throw Error("strides[".concat(v,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<v),n=e[v];if(-1===n){m.push(t?1:-1);continue}const r=[d.beginMask&1<<v,d.endMask&1<<v],a=[d.strides[v]>0?0:-1,d.strides[v]>0?n:n-1];if(t&&d.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");f=f&&1===d.strides[v];const i=!!(d.beginMask&1<<v&&d.endMask&1<<v);if(d.beginValid&&d.endValid){if(t){const e=d.begin[v]<0?n+d.begin[v]:d.begin[v];if(d.begin[v]=e,d.end[v]=d.begin[v]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[v]," of dimension ").concat(v," out of bounds."))}else d.begin[v]=YF(d.begin[v],0,d.strides[v],n,r,a),d.end[v]=YF(d.end[v],1,d.strides[v],n,r,a);const e=1===d.strides[v]&&0===d.begin[v]&&d.end[v]===n;A=A&&e,p=p&&(0===v&&1===d.strides[v]||e)}else A=A&&1===d.strides[v]&&i,p=p&&(0===v&&1===d.strides[v]||i);let s,o=!1;if(d.beginValid&&d.endValid?(s=d.end[v]-d.begin[v],o=!0):t?(s=1,o=!0):i&&n>=0&&(s=d.strides[v]<0?-n:n,o=!0),o){let e;e=0===s||s<0!==d.strides[v]<0?0:Math.trunc(s/d.strides[v])+(s%d.strides[v]!==0?1:0),m.push(e)}else m.push(-1)}for(let v=0;v<d.finalShapeGatherIndices.length;++v){const e=d.finalShapeGatherIndices[v];e>=0?g.push(m[e]):e===MF&&g.push(1)}const y=g.filter((e,t)=>d.finalShapeGatherIndices[t]!==MF);return{finalShapeSparse:y,finalShape:g,isIdentity:A,sliceDim0:p,isSimpleSlice:f,begin:d.begin,end:d.end,strides:d.strides}}function YF(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];{const t=e<0?r+e:e;return t<i[0]?i[0]:t>i[1]?i[1]:t}}const JF=hT({acos_:function(e){const t={x:lT(e,"x","acos")};return $I.runKernel(ME,t)}});const ZF=hT({acosh_:function(e){const t={x:lT(e,"x","acosh")};return $I.runKernel(FE,t)}});const $F=hT({addN_:function(e){GC(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),GC(e.length>=1,()=>"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length));const t=e.map((e,t)=>lT(e,"tensors".concat(t),"addN")),n=t[0];t.forEach(e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(e=>{if(!YC(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=t;return $I.runKernel(LE,r)}});const eR=hT({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:lT(e,"x","all","bool")},a={axis:t,keepDims:n};return $I.runKernel(UE,r,a)}});const tR=hT({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:lT(e,"x","any","bool")},a={axis:t,keepDims:n};return $I.runKernel(PE,r,a)}});const nR=hT({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:lT(e,"x","argMax")},r={axis:t};return $I.runKernel(DE,n,r)}});const rR=hT({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:lT(e,"x","argMin")},r={axis:t};return $I.runKernel(OE,n,r)}});const aR=hT({asin_:function(e){const t={x:lT(e,"x","asin")};return $I.runKernel(zE,t)}});const iR=hT({asinh_:function(e){const t={x:lT(e,"x","asinh")};return $I.runKernel(HE,t)}});const sR=hT({atan_:function(e){const t={x:lT(e,"x","atan")};return $I.runKernel(jE,t)}});const oR=hT({atan2_:function(e,t){let n=lT(e,"a","atan2"),r=lT(t,"b","atan2");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(VE,a)}});const lR=hT({atanh_:function(e){const t={x:lT(e,"x","atanh")};return $I.runKernel(QE,t)}});function cR(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return dR(e,[...t,e[3]],n,i,r,null,null,wR(a))}function uR(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[o,l]=fR(t);let c;if("channelsLast"===s)c=[o,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));c=[o,l,e[1],e[1]]}return dR(e,c,n,r,a,i,!1,s)}function hR(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[o,l,c]=mR(t);let u,h;if("NDHWC"===s)h="channelsLast",u=[o,l,c,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat ".concat(s));h="channelsFirst",u=[o,l,c,e[1],e[1]]}return AR(e,u,n,r,a,!1,h,i)}function dR(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[l,c,u,h]=[-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,h]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));[l,h,c,u]=e}const[d,A,,p]=t,[f,m]=fR(n),[g,y]=fR(r),v=gR(d,g),b=gR(A,y),{padInfo:x,outHeight:w,outWidth:_}=function(e,t,n,r,a,i,s,o,l){let c,u,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,a){null==r&&(r=pR(e,t,n));const i=e[0],s=e[1],o=yR((i-t+2*r)/n+1,a),l=yR((s-t+2*r)/n+1,a);return[o,l]}([t,n],i,r,e,o);u=a[0],h=a[1]}else if("same"===e){u=Math.ceil(t/r),h=Math.ceil(n/a);const e=Math.max(0,(u-1)*r+i-t),o=Math.max(0,(h-1)*a+s-n),l=Math.floor(e/2),d=e-l,A=Math.floor(o/2);c={top:l,bottom:d,left:A,right:o-A,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-i+1)/r),h=Math.ceil((n-s+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===l?e[1][0]:e[2][0],A="channelsLast"===l?e[1][1]:e[2][1],p="channelsLast"===l?e[2][0]:e[3][0],f="channelsLast"===l?e[2][1]:e[3][1];c={top:d,bottom:A,left:p,right:f,type:0===d&&0===A&&0===p&&0===f?"VALID":"EXPLICIT"},u=yR((t-i+d+A)/r+1,o),h=yR((n-s+p+f)/a+1,o)}}return{padInfo:c,outHeight:u,outWidth:h}}(a,c,u,f,m,v,b,i,o),S=s?p*h:p;let C;return"channelsFirst"===o?C=[l,S,w,_]:"channelsLast"===o&&(C=[l,w,_,S]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:u,inChannels:h,outHeight:w,outWidth:_,outChannels:S,padInfo:x,strideHeight:f,strideWidth:m,filterHeight:d,filterWidth:A,effectiveFilterHeight:v,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:e,outShape:C,filterShape:t}}function AR(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",o=arguments.length>7?arguments[7]:void 0,[l,c,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[l,c,u,h,d]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[l,d,c,u,h]=e}const[A,p,f,,m]=t,[g,y,v]=mR(n),[b,x,w]=mR(r),_=gR(A,b),S=gR(p,x),C=gR(f,w),{padInfo:E,outDepth:N,outHeight:B,outWidth:k}=function(e,t,n,r,a,i,s,o,l,c,u){let h,d,A,p;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const f=function(e,t,n,r,a,i){null==a&&(a=pR(e,t[0],r[0]));const s=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*a>=t[o]&&(s[o]=yR((e[o]-t[o]+2*a)/r[o]+1,i));return s}([t,n,r,1],[o,l,c],1,[a,i,s],e,u);d=f[0],A=f[1],p=f[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/a),A=Math.ceil(n/i),p=Math.ceil(r/s);const e=(d-1)*a+o-t,u=(A-1)*i+l-n,f=(p-1)*s+c-r,m=Math.floor(e/2),g=e-m,y=Math.floor(u/2),v=u-y,b=Math.floor(f/2);h={top:y,bottom:v,left:b,right:f-b,front:m,back:g,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:A,outWidth:p}}(a,c,u,h,g,y,v,_,S,C,o),I=i?m*d:m;let T;return"channelsFirst"===s?T=[l,I,N,B,k]:"channelsLast"===s&&(T=[l,N,B,k,I]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:N,outHeight:B,outWidth:k,outChannels:I,padInfo:E,strideDepth:g,strideHeight:y,strideWidth:v,filterDepth:A,filterHeight:p,filterWidth:f,effectiveFilterDepth:_,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationDepth:b,dilationHeight:x,dilationWidth:w,inShape:e,outShape:T,filterShape:t}}function pR(e,t,n){const r=gR(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function fR(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function mR(e){return"number"===typeof e?[e,e,e]:e}function gR(e,t){return t<=1?e:e+(e-1)*(t-1)}function yR(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function vR(e){const[t,n,r]=fR(e);return 1===t&&1===n&&1===r}function bR(e,t){return vR(e)||vR(t)}function xR(e){return fR(e).every(e=>e>0)}function wR(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function _R(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)GC(JC(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach(t=>{t.forEach(t=>{GC(JC(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."))})})}}}const SR=hT({reshape_:function(e,t){const n={x:lT(e,"x","reshape","string_or_numeric")},r={shape:t};return $I.runKernel(jB,n,r)}});const CR=hT({avgPool_:function(e,t,n,r,a){const i=lT(e,"x","avgPool","float32");GC(bR(n,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"));let s=i,o=!1;3===i.rank&&(o=!0,s=SR(i,[1,i.shape[0],i.shape[1],i.shape[2]])),GC(4===s.rank,()=>"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")),_R("avgPool",r,a);const l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a};let u=$I.runKernel(WE,l,c);return u=BM(u,i.dtype),o?SR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const ER=hT({avgPool3d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const s=lT(e,"x","avgPool3d","float32");let o=s,l=!1;4===s.rank&&(l=!0,o=SR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),GC(5===o.rank,()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),GC("NDHWC"===i,()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)),GC("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")),_R("avgPool3d",r,a);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i};let h=$I.runKernel(KE,c,u);return h=BM(h,o.dtype),l?SR(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const NR=hT({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;GC(e.length>=1,()=>"Pass at least one tensor to concat");const n=cT(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}),1===n.length)return kM(n[0]);const r=n,a={axis:t};return $I.runKernel(iN,r,a)}});const BR=hT({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=lT(e,"a","matMul"),i=lT(t,"b","matMul");[a,i]=WI(a,i);const s={a:a,b:i},o={transposeA:n,transposeB:r};return $I.runKernel(XE,s,o)}});const kR=hT({sigmoid_:function(e){const t={x:lT(e,"x","sigmoid","float32")};return $I.runKernel(sk,t)}});const IR=hT({slice_:function(e,t,n){const r=lT(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const a={x:r},i={begin:t,size:n};return $I.runKernel(nk,a,i)}});const TR=hT({tanh_:function(e){const t={x:lT(e,"x","tanh","float32")};return $I.runKernel(Nk,t)}});const MR=hT({basicLSTMCell_:function(e,t,n,r,a,i){const s=lT(e,"forgetBias","basicLSTMCell"),o=lT(t,"lstmKernel","basicLSTMCell"),l=lT(n,"lstmBias","basicLSTMCell"),c=lT(r,"data","basicLSTMCell"),u=lT(a,"c","basicLSTMCell"),h=lT(i,"h","basicLSTMCell"),d=NR([c,h],1),A=BR(d,o),p=TM(A,l),f=p.shape[0],m=p.shape[1]/4,g=[f,m],y=IR(p,[0,0],g),v=IR(p,[0,m],g),b=IR(p,[0,2*m],g),x=IR(p,[0,3*m],g),w=TM(RM(kR(y),TR(v)),RM(u,kR(TM(s,b))));return[w,RM(TR(w),kR(x))]}});const FR=hT({batchToSpaceND_:function(e,t,n){const r=lT(e,"x","batchToSpaceND"),a=t.reduce((e,t)=>e*t);GC(r.rank>=1+t.length,()=>"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)),GC(n.length===t.length,()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)),GC(r.shape[0]%a===0,()=>"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a));const i={x:r},s={blockShape:t,crops:n};return $I.runKernel(YE,i,s)}});const RR=hT({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);const s=lT(e,"x","batchNorm"),o=lT(t,"mean","batchNorm"),l=lT(n,"variance","batchNorm");let c,u;null!=a&&(c=lT(a,"scale","batchNorm")),null!=r&&(u=lT(r,"offset","batchNorm")),GC(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),GC(null==u||o.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),GC(null==c||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h=function(e){let t;return t=0===e.rank||1===e.rank?SR(e,[1,1,1,e.size]):2===e.rank?SR(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?SR(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(s),d={x:h,scale:c,offset:u,mean:o,variance:l},A={varianceEpsilon:i},p=$I.runKernel(HN,d,A);return SR(p,s.shape)}});const LR=hT({batchNorm2d_:function(e,t,n,r,a,i){const s=lT(e,"x","batchNorm"),o=lT(t,"mean","batchNorm"),l=lT(n,"variance","batchNorm");let c,u;return null!=a&&(c=lT(a,"scale","batchNorm")),null!=r&&(u=lT(r,"offset","batchNorm")),GC(2===s.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(s.rank,".")),GC(2===o.rank||1===o.rank,()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(o.rank,".")),GC(2===l.rank||1===l.rank,()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&GC(2===c.rank||1===c.rank,()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&GC(2===u.rank||1===u.rank,()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")),RR(s,o,l,u,c,i)}});const UR=hT({batchNorm3d_:function(e,t,n,r,a,i){const s=lT(e,"x","batchNorm"),o=lT(t,"mean","batchNorm"),l=lT(n,"variance","batchNorm");let c,u;return null!=a&&(c=lT(a,"scale","batchNorm")),null!=r&&(u=lT(r,"offset","batchNorm")),GC(3===s.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(s.rank,".")),GC(3===o.rank||1===o.rank,()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(o.rank,".")),GC(3===l.rank||1===l.rank,()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&GC(3===c.rank||1===c.rank,()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&GC(3===u.rank||1===u.rank,()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")),RR(s,o,l,u,c,i)}});const PR=hT({batchNorm4d_:function(e,t,n,r,a,i){const s=lT(e,"x","batchNorm"),o=lT(t,"mean","batchNorm"),l=lT(n,"variance","batchNorm");let c,u;return null!=a&&(c=lT(a,"scale","batchNorm")),null!=r&&(u=lT(r,"offset","batchNorm")),GC(4===s.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(s.rank,".")),GC(4===o.rank||1===o.rank,()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(o.rank,".")),GC(4===l.rank||1===l.rank,()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&GC(4===c.rank||1===c.rank,()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&GC(4===u.rank||1===u.rank,()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")),RR(s,o,l,u,c,i)}});const DR=hT({bincount_:function(e,t,n){const r=lT(e,"x","bincount"),a=lT(t,"weights","bincount");GC("int32"===r.dtype,()=>"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)),GC(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),GC(a.size===r.size||0===a.size,()=>"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,"."));const i={x:r,weights:a},s={size:n};return $I.runKernel(JE,i,s)}});const OR=hT({bitwiseAnd_:function(e,t){const n=lT(e,"x","bitwiseAnd"),r=lT(t,"y","bitwiseAnd");if(!YC(n.shape,r.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(r.shape));if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(r.dtype));const a={a:n,b:r};return $I.runKernel(ZE,a)}});const zR=hT({broadcastArgs_:function(e,t){const n=lT(e,"s0","broadcastArgs","int32"),r=lT(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));const a={s0:n,s1:r};return $I.runKernel($E,a)}});const HR=hT({broadcastTo_:function(e,t){let n=lT(e,"broadcastTo","x");const r=n.shape;if(vE(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=SR(n,e)}const a=n.shape,i=Array.from(t);for(let c=t.length-1;c>=0;c--)if(a[c]===t[c])i[c]=1;else if(1!==n.shape[c])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));const s=i.map((e,t)=>e>1?t:-1).filter(e=>e>=0);if(0===s.length)return kM(n);const o={x:n},l={reps:i};return $I.runKernel(Bk,o,l)}});const jR=hT({ceil_:function(e){const t={x:lT(e,"x","ceil","float32")};return $I.runKernel(tN,t)}});const QR=hT({clipByValue_:function(e,t,n){const r=lT(e,"x","clipByValue");if(GC(t<=n,()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")),t===n)return KM(r.shape,t,r.dtype);const a={x:r},i={clipValueMin:t,clipValueMax:n};return $I.runKernel(nN,a,i)}});const VR=hT({concat1d_:function(e){return NR(e,0)}});const WR=hT({concat2d_:function(e,t){return NR(e,t)}});const GR=hT({concat3d_:function(e,t){return NR(e,t)}});const KR=hT({concat4d_:function(e,t){return NR(e,t)}});const qR=hT({conv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const o=lT(e,"x","conv2d","float32"),l=lT(t,"filter","conv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=SR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),GC(4===c.rank,()=>"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")),GC(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(l.rank,".")),_R("conv2d",r,s);const h="NHWC"===a?c.shape[3]:c.shape[1];GC(h===l.shape[2],()=>"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(l.shape[2],".")),GC(bR(n,i),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")),GC(xR(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),GC(xR(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:c,filter:l},A={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},p=$I.runKernel(sN,d,A);return u?SR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const XR=hT({conv1d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;const o=lT(e,"x","conv1d"),l=lT(t,"filter","conv1d");let c=o,u=!1;2===o.rank&&(u=!0,c=SR(o,[1,o.shape[0],o.shape[1]])),GC(3===c.rank,()=>"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")),GC(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(l.rank,".")),_R("conv1d",r,s),GC(c.shape[2]===l.shape[1],()=>"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(l.shape[1],".")),GC(bR(n,i),()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")),GC(xR(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),GC(xR(n),()=>"Error in conv1D: Stride should be larger than 0."),GC("NWC"===a,()=>"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported."));const h=SR(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=SR(c,[c.shape[0],1,c.shape[1],c.shape[2]]),A=qR(d,h,[1,n],r,"NHWC",[1,i],s);return SR(A,u?[A.shape[2],A.shape[3]]:[A.shape[0],A.shape[2],A.shape[3]])}});const YR=hT({conv2DBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0;GC(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let o=e,l=t,c=!1;3===t.rank&&(c=!0,l=SR(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),GC(4===o.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(o.length,".")),GC(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(l.rank)),GC(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank));const u="NHWC"===i?o[3]:o[1],h="NHWC"===i?l.shape[3]:l.shape[1];GC(u===n.shape[2],()=>"Error in conv2dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[2],".")),GC(h===n.shape[3],()=>"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")),_R("conv2dDerInput",a,s);const d={dy:l,filter:n},A={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,inputShape:o},p=$I.runKernel(lN,d,A);return c?SR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const JR=hT({conv2dTranspose_:function(e,t,n,r,a,i){const s=lT(e,"x","conv2dTranspose"),o=lT(t,"filter","conv2dTranspose");return YR(n,s,o,r,a,"NHWC",i)}});const ZR=hT({conv3d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const s=lT(e,"x","conv3d"),o=lT(t,"filter","conv3d");let l=s,c=!1;4===s.rank&&(c=!0,l=SR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),GC(5===l.rank,()=>"Error in conv3d: input must be rank 5, but got rank ".concat(l.rank,".")),GC(5===o.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(o.rank,".")),GC(l.shape[4]===o.shape[3],()=>"Error in conv3d: depth of input (".concat(l.shape[4],") must match ")+"input depth for filter ".concat(o.shape[3],".")),GC(bR(n,i),()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")),GC("NDHWC"===a,()=>"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")),GC(xR(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),GC(xR(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:o},h={strides:n,pad:r,dataFormat:a,dilations:i},d=$I.runKernel(cN,u,h);return c?SR(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const $R=hT({conv3DBackpropInput_:function(e,t,n,r,a){GC(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let i=e,s=t,o=!1;4===t.rank&&(o=!0,s=SR(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);const l=i[4],c=s.shape[4];GC(5===i.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")),GC(5===s.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(s.rank)),GC(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)),GC(l===n.shape[3],()=>"Error in conv3dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[3],".")),GC(c===n.shape[4],()=>"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],"."));const u={dy:s,filter:n},h={pad:a,strides:r,inputShape:i},d=$I.runKernel(hN,u,h);return o?SR(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const eL=hT({conv3dTranspose_:function(e,t,n,r,a){const i=lT(e,"x","conv3dTranspose"),s=lT(t,"filter","conv3dTranspose");return $R(n,i,s,r,a)}});const tL=hT({cos_:function(e){const t={x:lT(e,"x","cos","float32")};return $I.runKernel(dN,t)}});const nL=hT({cosh_:function(e){const t={x:lT(e,"x","cosh","float32")};return $I.runKernel(AN,t)}});const rL=hT({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:lT(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return $I.runKernel(pN,a,i)}});const aL=hT({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={x:lT(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return $I.runKernel(fN,a,i)}});const iL=hT({denseBincount_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=lT(e,"x","denseBincount"),i=lT(t,"weights","denseBincount");GC("int32"===a.dtype,()=>"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)),GC(a.rank<=2,()=>"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")),GC(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),GC(i.size===a.size||0===i.size,()=>"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,"."));const s={x:a,weights:i},o={size:n,binaryOutput:r};return $I.runKernel(gN,s,o)}});const sL=hT({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const r=lT(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];GC(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t)),GC(a*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)),GC(i*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)),GC(s%(t*t)===0,()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(s," for depthToSpace with input shape ").concat(r.shape));const o={x:r},l={blockSize:t,dataFormat:n};return $I.runKernel(yN,o,l)}});const oL=hT({depthwiseConv2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const o=lT(e,"x","depthwiseConv2d","float32"),l=lT(t,"filter","depthwiseConv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=SR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),GC(4===c.rank,()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")),GC(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(l.rank,"."));const h="NHWC"===a?c.shape[3]:c.shape[1];GC(h===l.shape[2],()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(l.shape[2],".")),_R("depthwiseConv2d",r,s);const d={x:c,filter:l},A={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:s},p=$I.runKernel(vN,d,A);return u?SR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const lL=hT({diag_:function(e){const t={x:lT(e,"x","diag")};return $I.runKernel(wN,t)}});const cL=hT({dilation2d_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const s=lT(e,"x","dilation2d"),o=lT(t,"filter","dilation2d");GC(3===s.rank||4===s.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(s.rank,".")),GC(3===o.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(o.rank,".")),GC("NHWC"===i,()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i));let l=s,c=!1;3===s.rank&&(l=SR(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0),GC(l.shape[3]===o.shape[2],()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(l.shape[3]," vs ").concat(o.shape[2]));const u={x:l,filter:o},h={strides:n,pad:r,dilations:a},d=$I.runKernel(_N,u,h);return c?SR(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const uL=hT({equal_:function(e,t){let n=lT(e,"a","equal","string_or_numeric"),r=lT(t,"b","equal","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(MN,a)}});const hL=hT({where_:function(e,t,n){const r=lT(t,"a","where"),a=lT(n,"b","where"),i=lT(e,"condition","where","bool"),s=tF(tF(i.shape,r.shape),a.shape),o={condition:HR(i,s),t:HR(r,s),e:HR(a,s)};return $I.runKernel(ek,o)}});const dL=hT({divNoNan_:function(e,t){let n=lT(e,"a","div"),r=lT(t,"b","div");[n,r]=WI(n,r);const a=FM(n,r),i=PM(a),s=uL(r,i);return hL(s,i,a)}});const AL=hT({dot_:function(e,t){const n=lT(e,"t1","dot"),r=lT(t,"t2","dot");GC((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,"."));const a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(GC(a===i,()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")),1===n.rank&&1===r.rank){const e=SR(n,[1,-1]),t=SR(r,[-1,1]),a=BR(e,t);return SR(a,[])}if(1===n.rank&&2===r.rank){const e=SR(n,[1,-1]),t=SR(r,[r.shape[0],r.shape[1]]),a=BR(e,t);return SR(a,[a.size])}if(2===n.rank&&1===r.rank){const e=SR(r,[-1,1]),t=BR(n,e);return SR(t,[t.size])}{const e=SR(r,[r.shape[0],r.shape[1]]);return BR(n,e)}}});const pL=hT({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const a=n.map((e,t)=>lT(e,"tensors".concat(t),"einsum")),i={equation:e};return $I.runKernel(BN,a,i)}});const fL=hT({elu_:function(e){const t={x:lT(e,"x","elu","float32")};return $I.runKernel(kN,t)}});const mL=hT({ensureShape_:function(e,t){const n=lT(e,"x","ensureShape","string_or_numeric");if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});const gL=hT({erf_:function(e){let t=lT(e,"x","erf");GC("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=BM(t,"float32"));const n={x:t};return $I.runKernel(TN,n)}});function yL(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function vL(e,t,n){const r=e.length+t.length,a=[];let i=0,s=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?a.push(e[i++]):a.push(t[s++]);return a}function bL(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(t=>e[t])]}function xL(e,t){return vL(e,t.map(e=>1),t)}function wL(e,t,n){GC(yL(t,n),()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input."))}function _L(e,t){if(yL(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function SL(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function CL(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const EL=hT({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:lT(e,"x","max")},a={reductionIndices:t,keepDims:n};return $I.runKernel(cB,r,a)}});const NL=hT({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:lT(e,"x","min")},a={axis:t,keepDims:n};return $I.runKernel(gB,r,a)}});const BL=hT({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=lT(e,"x","sum");"bool"===r.dtype&&(r=BM(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return $I.runKernel(ck,a,i)}});function kL(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return ZM(e);if(1!==e.rank&&null===n)return kL(SR(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return BL(ZM(e),n);if(t===1/0)return EL(ZM(e),n);if(t===-1/0)return NL(ZM(e),n);if("euclidean"===t||2===t)return LM(BL(XM(ZM(e),OM(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return EL(BL(ZM(e),n[0]),n[1]-1);if(t===1/0)return EL(BL(ZM(e),n[1]),n[0]);if(t===-1/0)return NL(BL(ZM(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return LM(BL(UM(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const IL=hT({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=kL(e=lT(e,"x","norm"),t,n);let i=a.shape;if(r){const t=nE(n,e.shape);i=xL(a.shape,t)}return SR(a,i)}});const TL=hT({euclideanNorm_:function(e){return IL(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});const ML=hT({exp_:function(e){const t={x:lT(e,"x","exp")};return $I.runKernel(FN,t)}});const FL=hT({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=lT(e,"x","expandDims","string_or_numeric");GC(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},a={dim:t};return $I.runKernel(RN,r,a)}});const RL=hT({expm1_:function(e){const t={x:lT(e,"x","expm1")};return $I.runKernel(LN,t)}});const LL=hT({tile_:function(e,t){const n=lT(e,"x","tile","string_or_numeric");GC(n.rank===t.length,()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,"."));const r={x:n},a={reps:t};return $I.runKernel(Bk,r,a)}});const UL=hT({eye_:function(e,t,n){null==t&&(t=e);const r=NM([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t;for(let s=0;s<a;++s)r.set(1,s,s);const i=SR(r.toTensor(),[e,t]);if(null==n)return i;if(1===n.length)return LL(FL(i,0),[n[0],1,1]);if(2===n.length)return LL(FL(FL(i,0),0),[n[0],n[1],1,1]);if(3===n.length)return LL(FL(FL(FL(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});const PL=hT({floor_:function(e){const t={x:lT(e,"x","floor","float32")};return $I.runKernel(ON,t)}});const DL=hT({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a={x:lT(e,"x","gather"),indices:lT(t,"indices","gather","int32")},i={axis:n,batchDims:r};return $I.runKernel(jN,a,i)}});const OL=hT({greater_:function(e,t){let n=lT(e,"a","greater","string_or_numeric"),r=lT(t,"b","greater","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(VN,a)}});const zL=hT({greaterEqual_:function(e,t){let n=lT(e,"a","greaterEqual","string_or_numeric"),r=lT(t,"b","greaterEqual","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(WN,a)}});const HL=hT({imag_:function(e){const t={input:lT(e,"input","imag")};return $I.runKernel(qN,t)}});const jL=hT({isFinite_:function(e){const t={x:lT(e,"x","isFinite")};return $I.runKernel(XN,t)}});const QL=hT({isInf_:function(e){const t={x:lT(e,"x","isInf")};return $I.runKernel(YN,t)}});const VL=hT({isNaN_:function(e){const t={x:lT(e,"x","isNaN")};return $I.runKernel(JN,t)}});const WL=hT({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:lT(e,"x","leakyRelu")},r={alpha:t};return $I.runKernel(ZN,n,r)}});const GL=hT({less_:function(e,t){let n=lT(e,"a","less","string_or_numeric"),r=lT(t,"b","less","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel($N,a)}});const KL=hT({lessEqual_:function(e,t){let n=lT(e,"a","lessEqual","string_or_numeric"),r=lT(t,"b","lessEqual","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(eB,a)}});function qL(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return $I.runKernel(tB,{},r)}const XL=hT({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const i=lT(e,"x","localResponseNormalization");GC(4===i.rank||3===i.rank,()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")),GC(JC(t),()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,"."));let s=i,o=!1;3===i.rank&&(o=!0,s=SR(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:s},c={depthRadius:t,bias:n,alpha:r,beta:a},u=$I.runKernel(oB,l,c);return o?SR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const YL=hT({log_:function(e){const t={x:lT(e,"x","log","float32")};return $I.runKernel(nB,t)}});const JL=hT({log1p_:function(e){const t={x:lT(e,"x","log1p")};return $I.runKernel(rB,t)}});const ZL=hT({neg_:function(e){const t={x:lT(e,"x","neg")};return $I.runKernel(_B,t)}});const $L=hT({softplus_:function(e){const t={x:lT(e,"x","softplus")};return $I.runKernel(ok,t)}});const eU=hT({logSigmoid_:function(e){const t=lT(e,"x","logSigmoid"),n=DM(e=>({value:ZL($L(ZL(e))),gradFunc:t=>RM(t,kR(ZL(e)))}));return n(t)}});const tU=hT({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=lT(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const r=DM((e,n)=>{const r=EL(e,t,!0),a=YM(e,r),i=YM(BM(a,"float32"),YL(BL(ML(a),t,!0)));n([i]);return{value:i,gradFunc:(e,n)=>{const[r]=n,a=ML(r);return YM(e,RM(BL(e,t,!0),a))}}});return r(n)}});const nU=hT({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=lT(e,"x","logSumExp"),a=nE(t,r.shape),i=EL(r,a,!0),s=YM(r,i),o=ML(s),l=BL(o,a),c=YL(l),u=TM(SR(i,c.shape),c);if(n){const e=xL(u.shape,a);return SR(u,e)}return u}});const rU=hT({logicalAnd_:function(e,t){const n=lT(e,"a","logicalAnd","bool"),r=lT(t,"b","logicalAnd","bool");tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(aB,a)}});const aU=hT({logicalNot_:function(e){const t={x:lT(e,"x","logicalNot","bool")};return $I.runKernel(iB,t)}});const iU=hT({logicalOr_:function(e,t){const n=lT(e,"a","logicalOr","bool"),r=lT(t,"b","logicalOr","bool");tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(sB,a)}});const sU=hT({logicalXor_:function(e,t){const n=lT(e,"a","logicalXor","bool"),r=lT(t,"b","logicalXor","bool");return tF(n.shape,r.shape),rU(iU(e,t),aU(rU(e,t)))}}),oU=2147483648;const lU=hT({searchSorted_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left";const r=lT(e,"sortedSequence","searchSorted"),a=lT(t,"values","searchSorted"),i=r.shape[r.shape.length-1],s=a.shape[a.shape.length-1],o=SR(r,[-1,i]),l=SR(a,[-1,s]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(XC(l.shape)>=oU)throw new Error("values tensor size must less than ".concat(oU));if(o.shape[1]>=oU)throw new Error("trailing dim_size must less than ".concat(oU," for int32 output type, was ").concat(o.shape[1]));const c={sortedSequence:o,values:l},u={side:n};return $I.runKernel($B,c,u)}});function cU(e,t){return lU(e,t,"left")}const uU=hT({maxPool_:function(e,t,n,r,a){const i=lT(e,"x","maxPool");let s=i,o=!1;3===i.rank&&(o=!0,s=SR(i,[1,i.shape[0],i.shape[1],i.shape[2]])),GC(4===s.rank,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")),GC(bR(n,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")),_R("maxPool",r,a);const l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},u=$I.runKernel(hB,l,c);return o?SR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const hU=hT({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const s=lT(e,"x","maxPool3d");let o=s,l=!1;4===s.rank&&(l=!0,o=SR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),GC(5===o.rank,()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),GC("NDHWC"===i,()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)),_R("maxPool3d",r,a);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=$I.runKernel(AB,c,u);return l?SR(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const dU=hT({maxPoolWithArgmax_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i={x:lT(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},o=$I.runKernel(fB,i,s);return{result:o[0],indexes:o[1]}}});const AU=hT({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:lT(e,"x","mean")},a={axis:t,keepDims:n};return $I.runKernel(mB,r,a)}});function pU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(vE(e),"complex64"===t){const t=pU(e,"float32"),n=pU(e,"float32");return dT(t,n)}const n=gE(XC(e),t);return $I.makeTensor(n,e,t)}function fU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(vE(e),"complex64"===t){const t=fU(e,"float32"),n=pU(e,"float32");return dT(t,n)}const n=mE(XC(e),t);return $I.makeTensor(n,e,t)}function mU(e,t){let{indexing:n="xy"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("xy"!==n&&"ij"!==n)throw new TypeError("".concat(n," is not a valid third argument to meshgrid"));if(void 0===e)return[];let r=lT(e,"x","meshgrid",e instanceof MI?e.dtype:"float32");if(void 0===t)return[r];let a=lT(t,"y","meshgrid",t instanceof MI?t.dtype:"float32");const i=XC(r.shape),s=XC(a.shape);return"xy"===n?(r=SR(r,[1,-1]),a=SR(a,[-1,1]),[BR(fU([s,1],r.dtype),r),BR(a,fU([1,i],a.dtype))]):(r=SR(r,[-1,1]),a=SR(a,[1,-1]),[BR(r,fU([1,s],r.dtype)),BR(fU([i,1],a.dtype),a)])}const gU=hT({minimum_:function(e,t){let n=lT(e,"a","minimum"),r=lT(t,"b","minimum");[n,r]=WI(n,r),"bool"===n.dtype&&(n=BM(n,"int32"),r=BM(r,"int32")),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(yB,a)}});const yU=hT({mirrorPad_:function(e,t,n){GC("reflect"===n||"symmetric"===n,()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,"."));const r=lT(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");GC(t.length===r.rank,()=>"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,"."));const a="reflect"===n?1:0;for(let o=0;o<r.rank;o++)GC(2===t[o].length,()=>"Invalid number of paddings. Must be length of 2 each."),GC(t[o][0]>=0&&t[o][0]<=r.shape[o]-a&&t[o][1]>=0&&t[o][1]<=r.shape[o]-a,()=>"Padding in dimension ".concat(o," cannot be greater than or equal ")+"to ".concat(r.shape[o]-a," or less than 0 for input of ")+"shape ".concat(r.shape));const i={paddings:t,mode:n},s={x:r};return $I.runKernel(vB,s,i)}});const vU=hT({mod_:function(e,t){let n=lT(e,"a","mod"),r=lT(t,"b","mod");[n,r]=WI(n,r);const a={a:n,b:r};return $I.runKernel(bB,a)}});const bU=hT({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=nE(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=lT(e,"x","moments")).shape),r=AU(e,n,t);let a=r.shape;t||(a=xL(r.shape,n));const i=UM(YM(BM(e,"float32"),SR(r,a)));return{mean:r,variance:AU(i,n,t)}}});const xU=hT({multiRNNCell_:function(e,t,n,r){const a=lT(t,"data","multiRNNCell"),i=cT(n,"c","multiRNNCell"),s=cT(r,"h","multiRNNCell");let o=a;const l=[];for(let h=0;h<e.length;h++){const t=e[h](o,i[h],s[h]);l.push(t[0]),l.push(t[1]),o=t[1]}const c=[],u=[];for(let h=0;h<l.length;h+=2)c.push(l[h]),u.push(l[h+1]);return[c,u]}});const wU=hT({multinomial_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=lT(e,"logits","multinomial"),i=a.size,s=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(s));n=n||Math.random();const o={logits:1===s?SR(a,[1,-1]):a},l={numSamples:t,seed:n,normalized:r},c=$I.runKernel(xB,o,l);return 1===s?SR(c,[c.size]):c}});const _U=hT({notEqual_:function(e,t){let n=lT(e,"a","notEqual","string_or_numeric"),r=lT(t,"b","notEqual","string_or_numeric");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(SB,a)}});const SU=hT({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const i={indices:lT(e,"indices","oneHot","int32")},s={dtype:a,depth:t,onValue:n,offValue:r};return $I.runKernel(kB,i,s)}});const CU=hT({onesLike_:function(e){const t={x:lT(e,"x","onesLike")};return $I.runKernel(BB,t)}});const EU=hT({outerProduct_:function(e,t){const n=lT(e,"v1","outerProduct"),r=lT(t,"v2","outerProduct");GC(1===n.rank&&1===r.rank,()=>"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,"."));const a=SR(n,[-1,1]),i=SR(r,[1,-1]);return BR(a,i)}});const NU=hT({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=lT(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const a={paddings:t,constantValue:n},i={x:r};return $I.runKernel(TB,i,a)}});const BU=hT({pad1d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return GC(2===t.length,()=>"Invalid number of paddings. Must be length of 2."),NU(e,[t],n)}});const kU=hT({pad2d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return GC(2===t.length&&2===t[0].length&&2===t[1].length,()=>"Invalid number of paddings. Must be length of 2 each."),NU(e,t,n)}});const IU=hT({pad3d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return GC(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,()=>"Invalid number of paddings. Must be length of 2 each."),NU(e,t,n)}});const TU=hT({pad4d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return GC(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,()=>"Invalid number of paddings. Must be length of 2 each."),NU(e,t,n)}});const MU=hT({spaceToBatchND_:function(e,t,n){const r=lT(e,"x","spaceToBatchND");GC(r.rank>=1+t.length,()=>"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)),GC(n.length===t.length,()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)),GC(r.shape.reduce((e,r,a)=>a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e,!0),()=>"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString()));const a={x:r},i={blockShape:t,paddings:n};return $I.runKernel(uk,a,i)}});const FU=hT({pool_:function(e,t,n,r,a,i,s){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");const o=lT(e,"x","maxPool");let l=o,c=!1;3===o.rank&&(c=!0,l=SR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),GC(bR(i,a),()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'"));const u=uR(l.shape,t,i,a,r),h=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)),r=n.map(e=>e-1),a=r.map(e=>Math.floor(e/2)),i=r.map((e,t)=>e-a[t]);return r.map((e,t)=>[a[t],i[t]])}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];const A=1===h[0]&&1===h[1],[p,f]=function(e,t,n){const r=n.map(e=>e[0]),a=n.map(e=>e[1]),i=e.concat(r,a),s=t.map((e,t)=>(e-i[t]%e)%e),o=a.map((e,t)=>e+s[t]),l=t.map((e,t)=>[r[t],o[t]]),c=t.map((e,t)=>[0,s[t]]);return[l,c]}([u.inHeight,u.inWidth],h,d),m=A?r:"valid",g=A?l:MU(l,h,p),y=("avg"===n?()=>CR(g,t,i,m,s):()=>uU(g,t,i,m,s))(),v=A?y:FR(y,h,f);return c?SR(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});const RU=hT({prelu_:function(e,t){const n={x:lT(e,"x","prelu"),alpha:lT(t,"alpha","prelu")};return $I.runKernel(FB,n)}});const LU=hT({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=lT(e,"x","prod");"bool"===r.dtype&&(r=BM(r,"int32"));const a={x:r},i={axis:t,keepDims:n};return $I.runKernel(RB,a,i)}});const UU=hT({raggedGather_:function(e,t,n,r){const a=e.map((e,t)=>lT(e,"tensors".concat(t),"raggedGather","int32")),i={paramsNestedSplits:a,paramsDenseValues:lT(t,"paramsDenseValues","raggedGather"),indices:lT(n,"indices","raggedGather","int32")},s={outputRaggedRank:r},o=$I.runKernel(LB,i,s);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});const PU=hT({raggedRange_:function(e,t,n){const r=lT(e,"starts","raggedRange"),a={starts:r,limits:lT(t,"limits","raggedRange",r.dtype),deltas:lT(n,"deltas","raggedRange",r.dtype)},i=$I.runKernel(UB,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});const DU=hT({raggedTensorToTensor_:function(e,t,n,r,a){const i=lT(e,"shape","raggedTensorToTensor","int32"),s=lT(t,"values","raggedTensorToTensor"),o=lT(n,"defaultValue","raggedTensorToTensor",s.dtype),l=r.map((e,t)=>lT(e,"tensors".concat(t),"raggedTensorToTensor","int32")),c={shape:i,values:s,defaultValue:o,rowPartitionTensors:l},u={rowPartitionTypes:a};return $I.runKernel(PB,c,u)}});const OU=hT({rand_:function(e,t,n){vE(e);const r=XC(e);let a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(let i=0;i<r;i++)a[i]=t();return $I.makeTensor(a,e,n)}});var zU=n(4334);class HU{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const i=a||Math.random();this.random=zU.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,a,i;do{r=2*this.random()-1,a=2*this.random()-1,i=r*r+a*a}while(i>=1||0===i);const s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class jU{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const a=r||Math.random();this.randu=zU.alea(a.toString()),this.randn=new HU(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,i;for(;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-i+Math.log(i)),a=this.randu(),a<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class QU{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"===typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=zU.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const VU=hT({randomGamma_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(vE(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));const i=new jU(t,n,r,a),s=NM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}});const WU=hT({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(vE(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));const i=new HU(t,n,r,!1,a),s=NM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}});const GU=hT({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return WU(e,0,1,t,n)}});const KU=hT({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;vE(e);const i=NM(e,r),s=new QU(t,n,null,a);for(let o=0;o<i.values.length;o++)i.values[o]=s.nextValue();return i.toTensor()}});const qU=hT({randomUniformInt_:function(e,t,n,r){return KU(e,t,n,"int32",r)}});function XU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const a={start:e,stop:t,step:n,dtype:r};return $I.runKernel(DB,{},a)}const YU=hT({real_:function(e){const t={input:lT(e,"input","real")};return $I.runKernel(OB,t)}});const JU=hT({reciprocal_:function(e){const t={x:lT(e,"x","reciprocal")};return $I.runKernel(zB,t)}});const ZU=hT({relu_:function(e){const t={x:lT(e,"x","relu")};return $I.runKernel(HB,t)}});const $U=hT({relu6_:function(e){const t={x:lT(e,"x","relu6")};return $I.runKernel(KB,t)}});const eP=hT({reverse_:function(e,t){const n={x:lT(e,"x","reverse")},r={dims:t};return $I.runKernel(qB,n,r)}});const tP=hT({reverse1d_:function(e){const t=lT(e,"x","reverse");return GC(1===t.rank,()=>"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")),eP(t,0)}});const nP=hT({reverse2d_:function(e,t){const n=lT(e,"x","reverse");return GC(2===n.rank,()=>"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")),eP(n,t)}});const rP=hT({reverse3d_:function(e,t){const n=lT(e,"x","reverse");return GC(3===n.rank,()=>"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")),eP(n,t)}});const aP=hT({reverse4d_:function(e,t){const n=lT(e,"x","reverse");return GC(4===n.rank,()=>"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")),eP(n,t)}});const iP=hT({round_:function(e){const t={x:lT(e,"x","round")};return $I.runKernel(XB,t)}});const sP=hT({rsqrt_:function(e){const t={x:lT(e,"x","rsqrt","float32")};return $I.runKernel(YB,t)}});const oP=hT({selu_:function(e){const t={x:lT(e,"x","selu")};return $I.runKernel(tk,t)}});const lP=hT({separableConv2d_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const o=lT(e,"x","separableConv2d"),l=lT(t,"depthwiseFilter","separableConv2d"),c=lT(n,"pointwiseFilter","separableConv2d");let u=o,h=!1;if(3===o.rank&&(h=!0,u=SR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");GC(4===u.rank,()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,".")),GC(4===l.rank,()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),GC(4===c.rank,()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),GC(1===c.shape[0],()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")),GC(1===c.shape[1],()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],"."));const d=l.shape[2],A=l.shape[3];GC(c.shape[2]===d*A,()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*A,", ")+"but got ".concat(c.shape[2],"."));const p=oL(u,l,r,a,s,i),f=qR(p,c,1,"valid",s);return h?SR(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const cP=async function(e,t){const n=lT(e,"x","setdiff1d"),r=lT(t,"y","setdiff1d");GC(n.dtype===r.dtype,()=>"x and y should have the same dtype, but got x (".concat(n.dtype,") and y (").concat(r.dtype,").")),GC(1===n.rank,()=>"x should be 1D tensor, but got x (".concat(n.shape,").")),GC(1===r.rank,()=>"y should be 1D tensor, but got y (".concat(r.shape,")."));const a=await n.data(),i=await r.data(),s=new Set(i);let o=0;for(let u=0;u<a.length;u++)s.has(a[u])||o++;const l=new BI([o],n.dtype),c=new BI([o],"int32");for(let u=0,h=0;u<a.length;u++)s.has(a[u])||(l.values[h]=a[u],c.values[h]=u,h++);return[l.toTensor(),c.toTensor()]};const uP=hT({sign_:function(e){const t={x:lT(e,"x","sign")};return $I.runKernel(ik,t)}});const hP=hT({sin_:function(e){const t={x:lT(e,"x","sin","float32")};return $I.runKernel(rk,t)}});const dP=hT({sinh_:function(e){const t={x:lT(e,"x","sinh")};return $I.runKernel(ak,t)}});const AP=hT({slice1d_:function(e,t,n){const r=lT(e,"x","slice1d");return GC(1===r.rank,()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")),IR(r,[t],[n])}});const pP=hT({slice2d_:function(e,t,n){const r=lT(e,"x","slice2d");return GC(2===r.rank,()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")),IR(r,t,n)}});const fP=hT({slice3d_:function(e,t,n){const r=lT(e,"x","slice3d");return GC(3===r.rank,()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")),IR(r,t,n)}});const mP=hT({slice4d_:function(e,t,n){const r=lT(e,"x","slice4d");return GC(4===r.rank,()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")),IR(r,t,n)}});const gP=hT({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=lT(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const r={logits:n},a={dim:t};return $I.runKernel(dk,r,a)}});const yP=hT({fft_:function(e){GC("complex64"===e.dtype,()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return $I.runKernel(UN,t)}});const vP=hT({ifft_:function(e){GC("complex64"===e.dtype,()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return $I.runKernel(KN,t)}});const bP=hT({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const a=SR(e,[n,t]);r=vP(a)}else{const a=[n,2*(t-1)],i=SR(YU(e),[n,t]),s=SR(HL(e),[n,t]),o=eP(IR(i,[0,1],[n,t-2]),1),l=RM(eP(IR(s,[0,1],[n,t-2]),1),OM(-1)),c=NR([i,o],1),u=NR([s,l],1),h=SR(dT(c,u),[a[0],a[1]]);r=vP(h)}if(r=YU(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=SR(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});const xP=hT({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={x:lT(e,"x","split")},a={numOrSizeSplits:t,axis:n};return $I.runKernel(hk,r,a)}});const wP=hT({rfft_:function(e,t){GC("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got ".concat(e.dtype));let n=e.shape[e.shape.length-1];const r=e.size/n;let a;if(null!=t&&t<n){const r=e.shape.map(e=>0),i=e.shape.map(e=>e);i[e.shape.length-1]=t,a=IR(e,r,i),n=t}else if(null!=t&&t>n){const r=e.shape.map(e=>e);r[e.shape.length-1]=t-n,a=NR([e,pU(r)],e.shape.length-1),n=t}else a=e;const i=PM(a),s=SR(dT(a,i),[r,n]),o=yP(s),l=Math.floor(n/2)+1,c=YU(o),u=HL(o),h=xP(c,[l,n-l],c.shape.length-1),d=xP(u,[l,n-l],u.shape.length-1),A=a.shape.slice();return A[a.shape.length-1]=l,SR(dT(h[0],d[0]),A)}});const _P=hT({squaredDifference_:function(e,t){let n=lT(e,"a","squaredDifference"),r=lT(t,"b","squaredDifference");[n,r]=WI(n,r),tF(n.shape,r.shape);const a={a:n,b:r};return $I.runKernel(yk,a,{})}});const SP=hT({squeeze_:function(e,t){const n=lT(e,"x","squeeze","string_or_numeric");return SR(n,rE(n.shape,t).newShape)}});const CP=hT({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=cT(e,"tensors","stack","string_or_numeric");GC(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&GC(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,a={axis:t};return $I.runKernel(IB,r,a)}});const EP=hT({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:lT(e,"x","step")},r={alpha:t};return $I.runKernel(Uk,n,r)}});const NP=hT({stridedSlice_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const c={x:lT(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};return $I.runKernel(xk,c,u)}});const BP=hT({tan_:function(e){const t={x:lT(e,"x","tan","float32")};return $I.runKernel(Ek,t)}});function kP(e,t){qC(e);const n=iT(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return AT(e,null,n,t)}function IP(e,t,n){if(qC(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=iT(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return AT(e,t,r,n)}function TP(e,t,n){if(qC(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=iT(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return AT(e,t,r,n)}function MP(e,t,n){if(qC(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=iT(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return AT(e,t,r,n)}function FP(e,t,n){if(qC(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=iT(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return AT(e,t=t||r,r,n)}function RP(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(let s=0;s<a;++s)if(n.shape[s]!==t.shape[s])throw new Error(i+" updates.shape[".concat(s,"] (").concat(n.shape[s],") != indices.shape[").concat(s,"] (").concat(t.shape[s],")."));for(let s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function LP(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}RP(n,t,e)}function UP(e,t,n){const r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length;let s=1;for(let l=a;l<i;++l)s*=n[l];const o=a<1?1:a;return{sliceRank:a,numUpdates:XC(t.shape)/o,sliceSize:s,strides:[...AE(n.slice(0,a)),1],outputSize:XC(n)}}const PP=hT({tensorScatterUpdate_:function(e,t,n){const r=lT(e,"tensor","tensorScatterupdate"),a=lT(t,"indices","tensorScatterupdate","int32"),i=lT(n,"updates","tensorScatterupdate");if(LP(i,a,r.shape),r.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(r.dtype," and ").concat(i.dtype,"."));const s={tensor:r,indices:a,updates:i};return $I.runKernel(ZB,s,{})}});const DP=hT({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=lT(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));const i={x:r},s={k:t,sorted:n},[o,l]=$I.runKernel(kk,i,s);return{values:o,indices:l}}});const OP=hT({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(vE(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const i=new HU(t,n,r,!0,a),s=NM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=i.nextValue();return s.toTensor()}});const zP=hT({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=lT(e,"x","unique","string_or_numeric");GC(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},a={axis:t},[i,s]=$I.runKernel(Mk,r,a);return{values:i,indices:s}}});const HP=hT({unsortedSegmentSum_:function(e,t,n){const r=lT(e,"x","unsortedSegmentSum"),a=lT(t,"segmentIds","unsortedSegmentSum","int32");GC(JC(n),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:a},s={numSegments:n};return $I.runKernel(Rk,i,s)}});const jP=hT({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=lT(e,"x","unstack","string_or_numeric");GC(t>=-n.shape.length&&t<n.shape.length,()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")"));const r={value:n},a={axis:t};return $I.runKernel(Fk,r,a)}});function QP(e,t){return lU(e,t,"right")}function VP(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return $I.makeVariable(e,t,n,r)}function WP(e,t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(i);const r=NM(e,"int32"),a=NM([n.length,e.length],"int32");for(let i=0;i<n.length;i++){const t=r.indexToLoc(n[i]),s=i*e.length;a.values.set(t,s)}return a.toTensor()}const GP=async function(e){const t=lT(e,"condition","whereAsync","bool"),n=await t.data(),r=WP(t.shape,n);return e!==t&&t.dispose(),r};const KP=async function(e,t,n){const r=lT(e,"tensor","boolMask"),a=lT(t,"mask","boolMask","bool"),i=null==n?0:n,s=a.rank,o=r.shape;GC(s>0,()=>"mask cannot be scalar"),KC(o.slice(i,i+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let f=i;f<i+s;f++)l*=o[f];const c=o.slice(0,i).concat([l],o.slice(i+s)),u=SR(r,c),h=SR(a,[-1]),d=await GP(h),A=SP(d,[1]),p=DL(u,A,i);return e!==r&&r.dispose(),t!==a&&a.dispose(),A.dispose(),u.dispose(),h.dispose(),d.dispose(),p};const qP=hT({transpose_:function(e,t,n){const r=lT(e,"x","transpose");if(null==t&&(t=r.shape.map((e,t)=>t).reverse()),GC(r.rank===t.length,()=>"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")),t.forEach(e=>{GC(e>=0&&e<r.rank,()=>"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t))}),r.rank<=1)return r.clone();const a={x:r},i={perm:t};return"complex64"===r.dtype?vT(()=>{let e=YU(r),t=HL(r);return e=$I.runKernel(Tk,{x:e},i),t=$I.runKernel(Tk,{x:t},i),n&&(t=ZL(t)),dT(e,t)}):$I.runKernel(Tk,a,i)}});const XP=hT({movingAverage_:function(e,t,n,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const i=lT(e,"v","movingAverage"),s=lT(t,"x","movingAverage"),o=lT(n,"decay","movingAverage");!function(e,t){GC(e.dtype===t.dtype,()=>"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match"))}(i,s),GC(YC(i.shape,s.shape),()=>"Shape mismatch in v and x");const l=OM(1),c=YM(l,o);let u=RM(YM(s,i),c);if(a){GC(null!=r,()=>"When using zeroDebias: true, step is required.");const e=lT(r,"step","movingAverage");u=FM(u,YM(l,XM(o,e)))}return TM(i,u)}});const YP=hT({scatterND_:function(e,t,n){vE(n);const r=lT(e,"indices","scatterND","int32"),a=lT(t,"updates","scatterND");LP(a,r,n);const i={indices:r,updates:a},s={shape:n};return $I.runKernel(JB,i,s)}});const JP=hT({sparseToDense_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;vE(n);const a=lT(e,"sparseIndices","sparseToDense","int32"),i=lT(t,"sparseValues","sparseToDense","string_or_numeric"),s=lT(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));const a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));const s=t.size;if(0!==t.rank&&(1!==t.rank||s!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,s);const o={sparseIndices:a,sparseValues:i,defaultValue:s},l={outputShape:n};return $I.runKernel(gk,o,l)}});const ZP=hT({gatherND_:function(e,t){const n=lT(t,"indices","gatherND","int32"),r={params:lT(e,"x","gatherND","string_or_numeric"),indices:n};return $I.runKernel(QN,r)}});const $P=hT({dropout_:function(e,t,n,r){const a=lT(e,"x","dropout");if(GC("float32"===a.dtype,()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")),GC(t>=0&&t<1,()=>"rate must be a float in the range [0, 1), but got ".concat(t,".")),0===t)return e instanceof MI?a.clone():a;const i=function(e,t){if(null==t)return e.shape.slice();if(YC(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),s=1-t,o=FM(PL(TM(KU(i,0,1,"float32",r),s)),s);return RM(a,o)}});function eD(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function tD(e,t,n){const r=1-e%2,a=new Float32Array(e);for(let i=0;i<e;++i){const s=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(s)}return kP(a,"float32")}const nD=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=lT(e,"predictions","inTopK"),a=lT(t,"targets","inTopK");GC(r.rank>1,()=>"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)),GC(r.rank-1===a.rank,()=>"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)),KC(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=r.shape[r.shape.length-1];GC(n>0&&n<=i,()=>"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(n));const s=await r.data(),o=await a.data(),[l,c]=[s.length/i,i],u=aE("bool",l);for(let h=0;h<l;h++){const e=h*c,t=s.subarray(e,e+c),r=[];for(let n=0;n<t.length;n++)r.push({value:t[n],index:n});r.sort((e,t)=>t.value-e.value),u[h]=0;for(let a=0;a<n;a++)if(r[a].index===o[h]){u[h]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),pT(u,a.shape,"bool")};const rD=hT({conv2DBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=SR(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=SR(t,[1,t.shape[0],t.shape[1],t.shape[2]])),GC(4===o.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(o.shape,".")),GC(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(l.shape,".")),GC(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,"."));const c="NHWC"===i?o.shape[3]:o.shape[1],u="NHWC"===i?l.shape[3]:l.shape[1];GC(c===n[2],()=>"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")),GC(u===n[3],()=>"Error in conv2dDerFilter: depth of dy (".concat(u,") must ")+"match output depth for filter (".concat(n[3],").")),_R("conv2dDerFilter",a,s);const h={x:o,dy:l},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:s,filterShape:n};return $I.runKernel(oN,h,d)}});function aD(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return RM(e,EP(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function iD(e,t){let n=t;const r=eF(e.shape,t.shape);return r.length>0&&(n=BL(n,r)),SR(n,e.shape)}function sD(e,t,n,r){if("linear"===t)return e;if("relu"===t)return ZU(e);if("elu"===t)return fL(e);if("relu6"===t)return $U(e);if("prelu"===t)return RU(e,n);if("leakyrelu"===t)return WL(e,r);if("sigmoid"===t)return kR(e);throw new Error("Unknown fused activation ".concat(t,"."))}const oD=(e,t)=>!(e>0)||"linear"===t;const lD=hT({fusedConv2d_:function(e){let{x:t,filter:n,strides:r,pad:a,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(c=c||"linear",!1===oD($I.state.gradientDepth,c)){GC("NHWC"===i,()=>"Error in fused conv2d: got dataFormat of ".concat(i," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.");let e=qR(t,n,r,a,i,s,o);return null!=l&&(e=TM(e,l)),sD(e,c,u,h)}const d=lT(t,"x","conv2d","float32"),A=lT(n,"filter","conv2d","float32");let p=d,f=!1;3===d.rank&&(f=!0,p=SR(d,[1,d.shape[0],d.shape[1],d.shape[2]])),GC(4===p.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(p.rank,".")),GC(4===A.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(A.rank,".")),_R("fused conv2d",a,o);const m="NHWC"===i?p.shape[3]:p.shape[1];GC(A.shape[2]===m,()=>"Error in conv2d: depth of input (".concat(m,") must match ")+"input depth for filter ".concat(A.shape[2],".")),GC(bR(r,s),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(s,"'"));const g=dR(p.shape,A.shape,r,s,a,o);let y,v;if(null!=l&&(y=lT(l,"bias","fused conv2d"),[y]=WI(y,d),"NHWC"===i?tF(g.outShape,y.shape):(GC(y.shape.length<=1,()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(y.shape.length,".")),GC(0===y.shape.length||y.shape[0]===g.outChannels||1===y.shape[0],()=>"Error in fused conv2d: bias shape (".concat(y.shape,") is not ")+"compatible with the number of output channels "+"(".concat(g.outChannels,")")))),null!=u){const e=u.shape;if(GC(e.length<=1||3===e.length,()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(e.length,".")),1===e.length)GC(1===e[0]||e[0]===g.outChannels,()=>"Error in fused conv2d: PReLU activation weights "+"(".concat(e,") is not compatible with the number of output ")+"channels (".concat(g.outChannels,")."));else if(3===e.length)try{tF(e,g.outShape)}catch(_){const t="Error in fused conv2d: PReLU activation weights (".concat(e,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(g.outShape,").");throw Error(t)}v=lT(u,"prelu weights","fused conv2d")}const b=(e,t)=>{GC("NHWC"===i,()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(i," but only NHWC is currently supported."));const[n,o,l,u]=t,h=aD(e,l,c);GC(vR(s),()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(s,"'"));const d=[YR(o.shape,h,n,r,a),rD(o,h,n.shape,r,a)];if(null!=u){const e=iD(u,h);d.push(e)}return d},x={x:p,filter:A,bias:y,preluActivationWeights:v},w={strides:r,pad:a,dataFormat:i,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:h};if(null==l){const e=DM((e,t,n)=>{let r=$I.runKernel(zk,x,w);return n([t,e,r]),f&&(r=SR(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}});return e(p,A)}{const e=DM((e,t,n,r)=>{let a=$I.runKernel(zk,x,w);return r([t,e,a,n]),f&&(a=SR(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:b}});return e(p,A,y)}}});const cD=hT({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=SR(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=SR(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={x:o,dy:l},u={strides:r,pad:a,dimRoundingMode:s,dilations:i,filterShape:n};return $I.runKernel(bN,c,u)}});const uD=hT({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,o=t,l=!1;3===t.rank&&(l=!0,o=SR(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={dy:o,filter:n},u={strides:r,pad:a,dimRoundingMode:s,dilations:i,inputShape:e},h=$I.runKernel(xN,c,u);return l?SR(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const hD=hT({fusedDepthwiseConv2d_:function(e){let{x:t,filter:n,strides:r,pad:a,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(!1===oD($I.state.gradientDepth,c)){let e=oL(t,n,r,a,i,s,o);return null!=l&&(e=TM(e,l)),sD(e,c,u,h)}const d=lT(t,"x","depthwiseConv2d","float32"),A=lT(n,"filter","depthwiseConv2d","float32");let p=d,f=!1;3===d.rank&&(f=!0,p=SR(d,[1,d.shape[0],d.shape[1],d.shape[2]])),GC(4===p.rank,()=>"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(p.rank,".")),GC(4===A.rank,()=>"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(A.rank,".")),GC(p.shape[3]===A.shape[2],()=>"Error in fused depthwiseConv2d: number of input channels "+"(".concat(p.shape[3],") must match the inChannels dimension in ")+"filter ".concat(A.shape[2],".")),null==s&&(s=[1,1]),GC(bR(r,s),()=>"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(s,"'")),_R("fused depthwiseConv2d",a,o);const m=dR(p.shape,A.shape,r,s,a,o,!0);let g,y;null!=l&&(g=lT(l,"bias","fused conv2d"),[g]=WI(g,d),tF(m.outShape,g.shape)),null!=u&&(y=lT(u,"prelu weights","fused depthwiseConv2d"));const v=(e,t)=>{GC(vR(s),()=>"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'"));const[n,i,l,u]=t,h=aD(e,l,c),d=uD(i.shape,h,n,r,a,s,o),A=cD(i,h,n.shape,r,a,s,o);if(null!=u){return[d,A,iD(g,h)]}return[d,A]},b={x:p,filter:A,bias:g,preluActivationWeights:y},x={strides:r,pad:a,dataFormat:i,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:h};if(null==l){const e=DM((e,t,n)=>{let r=$I.runKernel(Hk,b,x);return n([t,e,r]),f&&(r=SR(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}});return e(p,A)}{const e=DM((e,t,n,r)=>{let a=$I.runKernel(Hk,b,x);return r([t,e,a,n]),f&&(a=SR(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:v}});return e(p,A,g)}}});const dD=hT({fusedMatMul_:function(e){let{a:t,b:n,transposeA:r=!1,transposeB:a=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}=e;if(!1===oD($I.state.gradientDepth,s)){let e=BR(t,n,r,a);return null!=i&&(e=TM(e,i)),sD(e,s,o,l)}let c=lT(t,"a","fused matMul"),u=lT(n,"b","fused matMul");[c,u]=WI(c,u);const h=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=a?u.shape[u.rank-1]:u.shape[u.rank-2],A=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=a?u.shape[u.rank-2]:u.shape[u.rank-1],f=c.shape.slice(0,-2),m=u.shape.slice(0,-2),g=XC(f),y=XC(m);GC(h===d,()=>"Error in fused matMul: inner shapes (".concat(h,") and (")+"".concat(d,") of Tensors with shapes ").concat(c.shape," and ")+"".concat(u.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match."));const v=tF(c.shape.slice(0,-2),u.shape.slice(0,-2)).concat([A,p]),b=SR(c,r?[g,h,A]:[g,A,h]),x=SR(u,a?[y,p,d]:[y,d,p]);let w,_;null!=i&&(w=lT(i,"bias","fused matMul"),[w]=WI(w,c),tF(v,w.shape)),null!=o&&(_=lT(o,"prelu weights","fused matMul"));const S=(e,t)=>{const[n,o,l,c]=t,u=aD(SR(e,l.shape),l,s);let h,d;if(r||a?!r&&a?(h=BR(u,o,!1,!1),d=BR(u,n,!0,!1)):r&&!a?(h=BR(o,u,!1,!0),d=BR(n,u,!1,!1)):(h=BR(o,u,!0,!0),d=BR(u,n,!0,!0)):(h=BR(u,o,!1,!0),d=BR(n,u,!0,!1)),null!=i){return[h,d,iD(c,u)]}return[h,d]},C={a:b,b:x,bias:w,preluActivationWeights:_},E={transposeA:r,transposeB:a,activation:s,leakyreluAlpha:l};if(null==i){const e=DM((e,t,n)=>{const r=$I.runKernel(Ok,C,E);return n([e,t,r]),{value:SR(r,v),gradFunc:S}});return e(b,x)}{const e=DM((e,t,n,r)=>{const a=$I.runKernel(Ok,C,E);return r([e,t,a,n]),{value:SR(a,v),gradFunc:S}});return e(b,x,w)}}});const AD=hT({hammingWindow_:function(e){return tD(e,.54,.46)}});const pD=hT({hannWindow_:function(e){return tD(e,.5,.5)}});const fD=hT({frame_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0;const s=[];for(;i+t<=e.size;)s.push(IR(e,i,t)),i+=n;if(r)for(;i<e.size;){const r=i+t-e.size,o=NR([IR(e,i,t-r),KM([r],a)]);s.push(o),i+=n}return 0===s.length?IP([],[0,t]):SR(NR(s),[s.length,t])}});const mD=hT({stft_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:pD;null==r&&(r=eD(t));const i=fD(e,t,n),s=RM(i,a(t));return wP(s,r)}});const gD=hT({cropAndResize_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=lT(e,"image","cropAndResize"),o=lT(t,"boxes","cropAndResize","float32"),l=lT(n,"boxInd","cropAndResize","int32"),c=o.shape[0];GC(4===s.rank,()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(s.rank,".")),GC(2===o.rank&&4===o.shape[1],()=>"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(o.shape,".")),GC(1===l.rank&&l.shape[0]===c,()=>"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(o.shape,".")),GC(2===r.length,()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")),GC(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was ".concat(r)),GC("bilinear"===a||"nearest"===a,()=>"method must be bilinear or nearest, but was ".concat(a));const u={image:s,boxes:o,boxInd:l},h={method:a,extrapolationValue:i,cropSize:r};return $I.runKernel(mN,u,h)}});const yD=hT({flipLeftRight_:function(e){const t=lT(e,"image","flipLeftRight","float32");GC(4===t.rank,()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,"."));const n={image:t};return $I.runKernel(DN,n,{})}});const vD=hT({grayscaleToRGB_:function(e){const t=lT(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];GC(t.rank>=2,()=>"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),GC(1===r,()=>"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,"."));const a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,LL(t,a)}});const bD=hT({rgbToGrayscale_:function(e){const t=lT(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];GC(t.rank>=2,()=>"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),GC(3===r,()=>"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(r,"."));const a=t.dtype,i=BM(t,"float32"),s=kP([.2989,.587,.114]);let o;switch(t.rank){case 2:o=pL("ij,j->i",i,s);break;case 3:o=pL("ijk,k->ij",i,s);break;case 4:o=pL("ijkl,l->ijk",i,s);break;case 5:o=pL("ijklm,m->ijkl",i,s);break;case 6:o=pL("ijklmn,n->ijklm",i,s);break;default:throw new Error("Not a valid tensor rank.")}return o=FL(o,-1),BM(o,a)}});const xD=hT({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=lT(e,"image","rotateWithOffset","float32");GC(4===a.rank,()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,"."));const i={image:a},s={radians:t,fillValue:n,center:r};return $I.runKernel(Dk,i,s)}});function wD(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);const s=e.shape[0];return n=Math.min(n,s),GC(0<=r&&r<=1,()=>"iouThreshold must be in [0, 1], but was '".concat(r,"'")),GC(2===e.rank,()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")),GC(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])),GC(1===t.rank,()=>"scores must be a 1D tensor"),GC(t.shape[0]===s,()=>"scores has incompatible shape with boxes. Expected ".concat(s,", ")+"but was ".concat(t.shape[0])),GC(0<=i&&i<=1,()=>"softNmsSigma must be in [0, 1], but was '".concat(i,"'")),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}const _D=hT({nonMaxSuppression_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=lT(e,"boxes","nonMaxSuppression","float32"),s=lT(t,"scores","nonMaxSuppression","float32"),o=wD(i,s,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;const l={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return $I.runKernel(CB,{boxes:i,scores:s},l)}});function SD(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,a=e.length,i=0,s=!1;for(;r<a;){i=r+(a-r>>>1);const o=n(t,e[i]);o>0?r=i+1:(a=i,s=!o)}return s?r:-r-1}(e,t,n||CD)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function CD(e,t){return e>t?1:e<t?-1:0}function ED(e,t,n,r,a){return kD(e,t,n,r,a,0)}function ND(e,t,n,r,a,i){return kD(e,t,n,r,a,0,!1,i,!0)}function BD(e,t,n,r,a,i){return kD(e,t,n,r,a,i,!0)}function kD(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const c=[];for(let m=0;m<t.length;m++)t[m]>a&&c.push({score:t[m],boxIndex:m,suppressBeginIndex:0});c.sort(MD);const u=i>0?-.5/i:0,h=[],d=[];for(;h.length<n&&c.length>0;){const t=c.pop(),{score:n,boxIndex:i,suppressBeginIndex:s}=t;if(n<a)break;let o=!1;for(let l=h.length-1;l>=s;--l){const n=ID(e,i,h[l]);if(n>=r){o=!0;break}if(t.score=t.score*TD(r,u,n),t.score<=a)break}t.suppressBeginIndex=h.length,o||(t.score===n?(h.push(i),d.push(t.score)):t.score>a&&SD(c,t,MD))}const A=h.length,p=n-A;o&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const f={selectedIndices:h};return s&&(f.selectedScores=d),l&&(f.validOutputs=A),f}function ID(e,t,n){const r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),u=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),A=(o-i)*(l-s),p=(h-c)*(d-u);if(A<=0||p<=0)return 0;const f=Math.max(i,c),m=Math.max(s,u),g=Math.min(o,h),y=Math.min(l,d),v=Math.max(g-f,0)*Math.max(y-m,0);return v/(A+p-v)}function TD(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function MD(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const FD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const i=lT(e,"boxes","nonMaxSuppressionAsync"),s=lT(t,"scores","nonMaxSuppressionAsync"),o=wD(i,s,n,r,a);n=o.maxOutputSize,r=o.iouThreshold,a=o.scoreThreshold;const l=await Promise.all([i.data(),s.data()]),c=l[0],u=l[1],{selectedIndices:h}=ED(c,u,n,r,a);return i!==e&&i.dispose(),s!==t&&s.dispose(),kP(h,"int32")};const RD=hT({nonMaxSuppressionWithScore_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=lT(e,"boxes","nonMaxSuppression"),o=lT(t,"scores","nonMaxSuppression"),l=wD(s,o,n,r,a,i);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:s,scores:o},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},h=$I.runKernel(NB,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}});const LD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=lT(e,"boxes","nonMaxSuppressionAsync"),o=lT(t,"scores","nonMaxSuppressionAsync"),l=wD(s,o,n,r,a,i);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([s.data(),o.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:A}=BD(u,h,n,r,a,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:kP(d,"int32"),selectedScores:kP(A)}};const UD=hT({nonMaxSuppressionPadded_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=lT(e,"boxes","nonMaxSuppression"),o=lT(t,"scores","nonMaxSuppression"),l=wD(s,o,n,r,a,null),c={boxes:s,scores:o},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:i},h=$I.runKernel(EB,c,u);return{selectedIndices:h[0],validOutputs:h[1]}}});const PD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=lT(e,"boxes","nonMaxSuppressionAsync"),o=lT(t,"scores","nonMaxSuppressionAsync"),l=wD(s,o,n,r,a,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,A]=await Promise.all([s.data(),o.data()]),{selectedIndices:p,validOutputs:f}=ND(d,A,c,u,h,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:kP(p,"int32"),validOutputs:OM(f,"int32")}};const DD=hT({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=lT(e,"images","resizeBilinear");GC(3===a.rank||4===a.rank,()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")),GC(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")),GC(!1===r||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,s=!1;3===a.rank&&(s=!0,i=SR(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},c=$I.runKernel(WB,o,l);return s?SR(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const OD=hT({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=lT(e,"images","resizeNearestNeighbor");GC(3===a.rank||4===a.rank,()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")),GC(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")),GC("float32"===a.dtype||"int32"===a.dtype,()=>"`images` must have `int32` or `float32` as dtype"),GC(!1===r||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,s=!1;3===a.rank&&(s=!0,i=SR(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const[]=t,o={images:i},l={alignCorners:n,halfPixelCenters:r,size:t},c=$I.runKernel(QB,o,l);return s?SR(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const zD=hT({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const a=lT(e,"image","threshold"),i=a.shape[0]*a.shape[1];let s,o,l,c,u=RM(kP([r]),255);if(GC(3===a.rank,()=>"Error in threshold: image must be rank 3,"+"but got rank ".concat(a.rank,".")),GC(3===a.shape[2]||1===a.shape[2],()=>"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(a.shape[2],".")),GC("int32"===a.dtype||"float32"===a.dtype,()=>"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(a.dtype,".")),GC("otsu"===t||"binary"===t,()=>"Method must be binary or otsu, but was ".concat(t)),3===a.shape[2]){[s,o,l]=xP(a,[1,1,1],-1);const e=RM(s,.2989),t=RM(o,.587),n=RM(l,.114);c=TM(TM(e,t),n)}else c=e;if("otsu"===t){u=function(e,t){let n,r,a,i,s,o,l=kP([-1]),c=kP([0]),u=kP([0]);for(let h=0;h<e.size-1;h++){n=IR(e,0,h+1),r=IR(e,h+1),s=FM(BL(n),t),o=FM(BL(r),t);const d=BL(RM(n,XU(0,n.size)));a=FM(d,BL(n));const A=KM(r.shape,n.size),p=TM(XU(0,r.size),A),f=RM(r,p);i=FM(BL(f),BL(r));const m=YM(a,i),g=YM(a,i),y=RM(s,o);u=RM(RM(y,m),g);const v=OL(u,c);c=hL(v,u,c),l=hL(v,kP([h]),l)}return l}(DR(BM(iP(c),"int32"),pT([]),256),i)}const h=n?KL(c,u):OL(c,u);return BM(RM(h,255),"int32")}});const HD=hT({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;const s=lT(e,"image","transform","float32"),o=lT(t,"transforms","transform","float32");GC(4===s.rank,()=>"Error in transform: image must be rank 4,"+"but got rank ".concat(s.rank,".")),GC(2===o.rank&&(o.shape[0]===s.shape[0]||1===o.shape[0])&&8===o.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),GC(null==i||2===i.length,()=>"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,"."));const l={image:s,transforms:o},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return $I.runKernel(Ik,l,c)}});const jD=hT({bandPart_:function(e,t,n){const r=lT(e,"a","bandPart");GC(r.rank>=2,()=>"bandPart(): Rank must be at least 2, got ".concat(r.rank,"."));const a=r.shape,[i,s]=r.shape.slice(-2);let o,l;"number"===typeof t?(GC(t%1===0,()=>"bandPart(): numLower must be an integer, got ".concat(t,".")),GC(t<=i,()=>"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(i,").")),o=lT(t<0?i:t,"numLower","bandPart")):(GC("int32"===t.dtype,()=>"bandPart(): numLower's dtype must be an int32."),o=hL(GL(t,0),i,gU(t,i))),"number"===typeof n?(GC(n%1===0,()=>"bandPart(): numUpper must be an integer, got ".concat(n,".")),GC(n<=s,()=>"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,").")),l=lT(n<0?s:n,"numUpper","bandPart")):(GC("int32"===n.dtype,()=>"bandPart(): numUpper's dtype must be an int32."),l=hL(GL(n,0),s,gU(n,s)));const c=SR(XU(0,i,1,"int32"),[-1,1]),u=XU(0,s,1,"int32"),h=YM(c,u),d=rU(KL(h,o),zL(h,ZL(l))),A=pU([i,s],r.dtype);return SR(CP(jP(SR(r,[-1,i,s])).map(e=>hL(d,e,A))),a)}});const QD=hT({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,GC(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)GC(e[t].shape[0]===n,()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")"))}else t=!0,e=xP(e,e.shape[0],0).map(e=>SP(e,[0]));GC(e.length<=e[0].shape[0],()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],")."));const n=[],r=e;for(let a=0;a<e.length;++a)n.push($I.tidy(()=>{let e=r[a];if(a>0)for(let t=0;t<a;++t){const r=RM(BL(RM(n[t],e)),n[t]);e=YM(e,r)}return FM(e,IL(e,"euclidean"))}));return t?CP(n,0):n}});function VD(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $I.tidy(()=>{GC(2===e.shape.length,()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor."));const n=e.shape[0],r=e.shape[1];let a=UL(n),i=kM(e);const s=IP([[1]],[1,1]);let o=kM(s);const l=n>=r?r:n;for(let e=0;e<l;++e){const t=i,l=o,c=a;[o,i,a]=$I.tidy(()=>{const t=IR(i,[e,e],[n-e,1]),l=IL(t),c=IR(i,[e,e],[1,1]),u=hL(OL(c,0),IP([[-1]]),IP([[1]])),h=YM(c,RM(u,l)),d=FM(t,h);o=1===d.shape[0]?kM(s):NR([s,IR(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const A=ZL(FM(BR(u,h),l)),p=IR(i,[e,0],[n-e,r]),f=RM(A,o),m=qP(o);if(0===e)i=YM(p,BR(f,BR(m,p)));else{const t=YM(p,BR(f,BR(m,p)));i=NR([IR(i,[0,0],[e,r]),t],0)}const g=qP(f),y=IR(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=YM(y,BR(BR(y,o),g));else{const t=YM(y,BR(BR(y,o),g));a=NR([IR(a,[0,0],[n,e]),t],1)}return[o,i,a]}),bT([t,l,c])}return!t&&n>r&&(a=IR(a,[0,0],[n,r]),i=IR(i,[0,0],[r,r])),[a,i]})}const WD=hT({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(GC(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)),2===e.rank)return VD(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=jP(SR(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach(e=>{const[n,r]=VD(e,t);a.push(n),i.push(r)});return[SR(CP(a,0),e.shape),SR(CP(i,0),e.shape)]}}});var GD;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(GD||(GD={}));const KD=hT({computeWeightedLoss_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GD.SUM_BY_NONZERO_WEIGHTS;const r=lT(e,"losses","computeWeightedLoss");let a=null;null!=t&&(a=lT(t,"weights","computeWeightedLoss"));const i=null==a?r:RM(r,a);if(n===GD.NONE)return i;if(n===GD.SUM)return BL(i);if(n===GD.MEAN){if(null==a)return AU(i);{const e=r.size/a.size,t=FM(BL(i),BL(a));return e>1?FM(t,OM(e)):t}}if(n===GD.SUM_BY_NONZERO_WEIGHTS){if(null==a)return FM(BL(i),OM(r.size));{const e=RM(a,fU(r.shape)),t=BM(BL(_U(e,OM(0))),"float32");return FM(BL(i),t)}}throw Error("Unknown reduction: ".concat(n))}});const qD=hT({absoluteDifference_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:GD.SUM_BY_NONZERO_WEIGHTS;const a=lT(e,"labels","absoluteDifference"),i=lT(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=lT(n,"weights","absoluteDifference")),KC(a.shape,i.shape,"Error in absoluteDifference: ");const o=ZM(YM(a,i));return KD(o,s,r)}});const XD=hT({cosineDistance_:function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:GD.SUM_BY_NONZERO_WEIGHTS;const i=lT(e,"labels","cosineDistance"),s=lT(t,"predictions","cosineDistance");let o=null;null!=r&&(o=lT(r,"weights","cosineDistance")),KC(i.shape,s.shape,"Error in cosineDistance: ");const l=OM(1),c=YM(l,BL(RM(i,s),n,!0));return KD(c,o,a)}});const YD=hT({hingeLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:GD.SUM_BY_NONZERO_WEIGHTS,a=lT(e,"labels","hingeLoss");const i=lT(t,"predictions","hingeLoss");let s=null;null!=n&&(s=lT(n,"weights","hingeLoss")),KC(a.shape,i.shape,"Error in hingeLoss: ");const o=OM(1);a=YM(RM(OM(2),a),o);const l=ZU(YM(o,RM(a,i)));return KD(l,s,r)}});const JD=hT({huberLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:GD.SUM_BY_NONZERO_WEIGHTS;const i=lT(e,"labels","huberLoss"),s=lT(t,"predictions","huberLoss");let o=null;null!=n&&(o=lT(n,"weights","huberLoss")),KC(i.shape,s.shape,"Error in huberLoss: ");const l=OM(r),c=ZM(YM(s,i)),u=gU(c,l),h=YM(c,u),d=TM(RM(OM(.5),UM(u)),RM(l,h));return KD(d,o,a)}});const ZD=hT({logLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:GD.SUM_BY_NONZERO_WEIGHTS;const i=lT(e,"labels","logLoss"),s=lT(t,"predictions","logLoss");let o=null;null!=n&&(o=lT(n,"weights","logLoss")),KC(i.shape,s.shape,"Error in logLoss: ");const l=OM(1),c=OM(r),u=ZL(RM(i,YL(TM(s,c)))),h=RM(YM(l,i),YL(TM(YM(l,s),c))),d=YM(u,h);return KD(d,o,a)}});const $D=hT({meanSquaredError_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:GD.SUM_BY_NONZERO_WEIGHTS;const a=lT(e,"labels","meanSquaredError"),i=lT(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=lT(n,"weights","meanSquaredError")),KC(a.shape,i.shape,"Error in meanSquaredError: ");const o=_P(a,i);return KD(o,s,r)}});const eO=hT({sigmoidCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:GD.SUM_BY_NONZERO_WEIGHTS,i=lT(e,"multiClassLabels","sigmoidCrossEntropy");const s=lT(t,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=lT(n,"weights","sigmoidCrossEntropy")),KC(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=OM(r),t=OM(1),n=OM(.5);i=TM(RM(i,YM(t,e)),RM(n,e))}const l=function(e,t){const n=lT(e,"labels","sigmoidCrossEntropyWithLogits"),r=lT(t,"logits","sigmoidCrossEntropyWithLogits");KC(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const a=ZU(r),i=RM(r,n),s=JL(ML(ZL(ZM(r))));return TM(YM(a,i),s)}(i,s);return KD(l,o,a)}});const tO=hT({softmaxCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:GD.SUM_BY_NONZERO_WEIGHTS,i=lT(e,"onehotLabels","softmaxCrossEntropy");const s=lT(t,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=lT(n,"weights","softmaxCrossEntropy")),KC(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=OM(r),t=OM(1),n=OM(i.shape[1]);i=TM(RM(i,YM(t,e)),FM(e,n))}const l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));const r=DM((e,t,r)=>{const a=nU(t,[n],!0),i=YM(BM(t,"float32"),a);r([e,i]);const s=ZL(RM(i,e));return{value:BL(s,[n]),gradFunc:(e,t)=>{const[r,a]=t,i=xL(e.shape,[n]);return[RM(SR(e,i),YM(BM(r,"float32"),ML(a))),RM(SR(e,i),YM(ML(a),BM(r,"float32")))]}}});return r(e,t)}(i,s);return KD(l,o,a)}});const nO=hT({sparseFillEmptyRows_:function(e,t,n,r){const a=lT(e,"indices","sparseFillEmptyRows","int32"),i=lT(t,"values","sparseFillEmptyRows"),s=lT(n,"denseShape","sparseFillEmptyRows","int32"),o=lT(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==s.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(s.shape));if(0!==o.rank)throw new Error("Default value should be a scalar but received shape ".concat(o.shape));const l={indices:a,values:i,denseShape:s,defaultValue:o},c=$I.runKernel(Ak,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});const rO=hT({sparseReshape_:function(e,t,n){const r=lT(e,"inputIndices","sparseReshape","int32"),a=lT(t,"inputShape","sparseReshape","int32"),i=lT(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));const s={inputIndices:r,inputShape:a,newShape:i},o=$I.runKernel(pk,s);return{outputIndices:o[0],outputShape:o[1]}}});const aO=hT({sparseSegmentMean_:function(e,t,n){const r=lT(e,"data","sparseSegmentMean"),a=lT(t,"indices","sparseSegmentMean","int32"),i=lT(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));const s={data:r,indices:a,segmentIds:i};return $I.runKernel(fk,s)}});const iO=hT({sparseSegmentSum_:function(e,t,n){const r=lT(e,"data","sparseSegmentSum"),a=lT(t,"indices","sparseSegmentSum","int32"),i=lT(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));const s={data:r,indices:a,segmentIds:i};return $I.runKernel(mk,s)}});const sO=hT({stringNGrams_:function(e,t,n,r,a,i,s,o){const l=lT(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error("Data must be a vector, saw: ".concat(l.shape));const c=lT(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:s,preserveShortSequences:o},h={data:l,dataSplits:c},d=$I.runKernel(wk,h,u);return{nGrams:d[0],nGramsSplits:d[1]}}});const oO=hT({stringSplit_:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=lT(e,"input","stringSplit","string"),a=lT(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));const i={skipEmpty:n},s={input:r,delimiter:a},o=$I.runKernel(_k,s,i);return{indices:o[0],values:o[1],shape:o[2]}}});const lO=hT({stringToHashBucketFast_:function(e,t){const n=lT(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const a={input:n};return $I.runKernel(Sk,a,r)}});const cO=hT({staticRegexReplace_:function(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=lT(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return $I.runKernel(bk,{x:a},i)}}),uO={fft:yP,ifft:vP,rfft:wP,irfft:bP},hO={hammingWindow:AD,hannWindow:pD,frame:fD,stft:mD},dO={flipLeftRight:yD,grayscaleToRGB:vD,resizeNearestNeighbor:OD,resizeBilinear:DD,rgbToGrayscale:bD,rotateWithOffset:xD,cropAndResize:gD,nonMaxSuppression:_D,nonMaxSuppressionAsync:FD,nonMaxSuppressionWithScore:RD,nonMaxSuppressionWithScoreAsync:LD,nonMaxSuppressionPadded:UD,nonMaxSuppressionPaddedAsync:PD,threshold:zD,transform:HD},AO={bandPart:jD,gramSchmidt:QD,qr:WD},pO={absoluteDifference:qD,computeWeightedLoss:KD,cosineDistance:XD,hingeLoss:YD,huberLoss:JD,logLoss:ZD,meanSquaredError:$D,sigmoidCrossEntropy:eO,softmaxCrossEntropy:tO},fO={sparseFillEmptyRows:nO,sparseReshape:rO,sparseSegmentMean:aO,sparseSegmentSum:iO},mO={stringNGrams:sO,stringSplit:oO,stringToHashBucketFast:lO,staticRegexReplace:cO};const gO=class{static sgd(e){return new aF(e)}static momentum(e,t){return new iF(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new sF(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new JM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new GM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new rF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new qM(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}},yO="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function vO(){return new Promise(e=>yO(()=>e()))}function bO(e,t){const n=e[0].length;e.forEach((e,t)=>{GC(e.length===n,()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")"))}),GC(t>=0&&t<n,()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,"."));const r=e[0];e.forEach((e,a)=>{for(let i=0;i<n;i++)GC(i===t||e[i]===r[i],()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,"."))})}function xO(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var wO;function _O(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(let a=1;a<n.length;++a){const i=n[a],s=r[r.length-n.length+a],o=r[s];if(i>=0)if(o>=0){if(o!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(o))}else r[s]=i}return r}function SO(e){const t={FIRST_DIM_SIZE:wO.FIRST_DIM_SIZE,VALUE_ROWIDS:wO.VALUE_ROWIDS,ROW_LENGTHS:wO.ROW_LENGTHS,ROW_SPLITS:wO.ROW_SPLITS,ROW_LIMITS:wO.ROW_LIMITS,ROW_STARTS:wO.ROW_STARTS},n=[];for(const r of e){if(!(r in t))break;n.push(t[r])}return n}function CO(e){return 0===e.length?0:e[0]===wO.FIRST_DIM_SIZE?e.length-1:e.length}function EO(e,t){if(null==e||null==t)return;const n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(let a=0;a<Math.min(n,r-1);++a){const n=e[a],r=t[a+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(r))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(wO||(wO={}));const NO=30;function BO(e){return e<=NO?e:dE(e,Math.floor(Math.sqrt(e)))}function kO(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function IO(e,t,n){let r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let a=0;a<n;++a)r=r.concat([e[a+1]/t[a],t[a]]);r=r.concat(e.slice(n+1))}return r}function TO(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{const r=[],a=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?a.push(n):r.push(n);n.push(...r),n.push(0),n.push(...a)}return n}function MO(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function FO(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function RO(e,t,n){const r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function LO(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===XC(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const a=t.shape,i=a[a.length-1];let s=1;for(let h=0;h<a.length-1;++h)s*=a[h];const o=e.shape,l=a.slice();l.pop();let c=1;for(let h=i;h<n;++h)c*=o[h],l.push(o[h]);const u=[...AE(e.shape).map(e=>e/c),1].slice(0,i);return[l,s,c,u]}const UO=1.7580993408473768,PO=1.0507009873554805,DO=.3275911,OO=.254829592,zO=-.284496736,HO=1.421413741,jO=-1.453152027,QO=1.061405429;function VO(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function WO(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function GO(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function KO(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function qO(e,t){return{real:e[2*t],imag:e[2*t+1]}}function XO(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function YO(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){const i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function JO(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}const ZO="->",$O=/->/g,ez=",",tz="...";function nz(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace($O,"").length)/ZO.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(ZO,'").'));const[r,a]=e.split(ZO);GC(-1===r.indexOf(tz),()=>'The ellipsis notation ("'.concat(tz,'") is not supported yet.'));const i=r.split(ez),s=i.length;if(t!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(t));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let h=0;h<a.length;++h){const e=a[h];if(!i.some(t=>-1!==t.indexOf(e)))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===o.indexOf(e)&&o.push(e)}for(let h=0;h<r.length;++h){const e=r[h];-1===o.indexOf(e)&&e!==ez&&o.push(e)}const l=new Array(i.length);for(let h=0;h<s;++h){if(new Set(i[h].split("")).size!==i[h].length)throw new Error("Found duplicate axes in input component ".concat(i[h],". ")+"Support for duplicate axes in input is not implemented yet.");l[h]=[];for(let e=0;e<i[h].length;++e)l[h].push(o.indexOf(i[h][e]))}const c=o.length,u=[];for(let h=a.length;h<c;++h)u.push(h);return{allDims:o,summedDims:u,idDims:l}}function rz(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;const r=[];for(let a=0;a<e;++a)-1===n[a]&&r.push(a);return n=n.filter(e=>-1!==e),{permutationIndices:n,expandDims:r}}function az(e,t,n){const r=new Array(e);for(let a=0;a<n.length;++a){const e=n[a].shape;for(let n=0;n<t[a].length;++n)void 0===r[t[a][n]]?r[t[a][n]]=e[n]:GC(r[t[a][n]]===e[n],()=>"Expected dimension ".concat(r[t[a][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(e),", ")+"but got dimension ".concat(e[n]))}}function iz(e,t){const n=e,r=[];let a=0;0===e.length&&n.push(-1),a=e.length+1;for(let s=0;s<a;++s)r.push([]);const i=[];for(let s=0;s<n.length;++s){const e=oz(t,n[s]);for(const t of e)-1===i.indexOf(t)&&(r[s].push(t),i.push(t))}return{path:n,steps:r}}function sz(e){return e.every((e,t)=>e===t)}function oz(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function lz(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)GC(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const a=t.reduce((e,t)=>(-1===t&&(e+=1),e),0);GC(a<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(-1!==i){const r=t.reduce((e,t)=>t>0?e+t:e);t[i]=e.shape[n]-r}GC(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function cz(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function uz(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function hz(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function dz(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Az(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function pz(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function fz(e,t){const n=XC(e),r=XC(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function mz(e,t){const n=XC(e),r=XC(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function gz(){return"segment ids must be >= 0"}function yz(){return"segment ids are not increasing"}function vz(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function bz(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function xz(e,t){let n,r=!1;for(e<=NO?(n=e,r=!0):n=dE(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=dE(e,n+1);return n}function wz(e,t,n){const r=[],a=e.length;for(let i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function _z(e,t,n,r){const a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error("x.shape[".concat(h,"]: ").concat(e.shape[h]," should be equal to indices.shape[").concat(h,"]: ").concat(t.shape[h],"."));const s=e.shape[n],o=[];let l=1,c=1,u=1;for(let h=0;h<r;++h)o.push(e.shape[h]),l*=e.shape[h];for(let h=r;h<n;h++)o.push(e.shape[h]),c*=e.shape[h];for(let h=r;h<a;h++)o.push(t.shape[h]);for(let h=n+1;h<i;h++)o.push(e.shape[h]),u*=e.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:o}}function Sz(e){try{return e.map(e=>gI(e))}catch(lhe){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(lhe))}}function Cz(e){return e.map(e=>mI(e))}!function(){for(const e of oF)VM(e)}();const Ez={kernelName:TE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,EP(BM(n,"float32"),-1))}}},Nz={kernelName:ME,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=UM(BM(n,"float32")),r=LM(YM(OM(1),t));return ZL(FM(e,r))}}}},Bz={kernelName:FE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=LM(YM(UM(BM(n,"float32")),1));return FM(e,t)}}}},kz={kernelName:RE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{let t=e;const r=eF(n.shape,a);return r.length>0&&(t=BL(t,r)),SR(t,n.shape)},b:()=>{let t=e;const n=eF(r.shape,a);return n.length>0&&(t=BL(t,n)),SR(t,r.shape)}}}},Iz={kernelName:LE,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},Tz={kernelName:DE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>PM(n)}}},Mz={kernelName:OE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>PM(n)}}},Fz={kernelName:zE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,LM(YM(OM(1),UM(BM(n,"float32")))))}}},Rz={kernelName:HE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=LM(TM(OM(1),UM(BM(n,"float32"))));return FM(e,t)}}}},Lz={kernelName:VE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{const t=TM(UM(n),UM(r));let i=RM(e,FM(r,t));const s=eF(n.shape,a);return s.length>0&&(i=BL(i,s)),SR(i,n.shape)},b:()=>{const t=TM(UM(n),UM(r));let i=ZL(RM(e,FM(n,t)));const s=eF(r.shape,a);return s.length>0&&(i=BL(i,s)),SR(i,r.shape)}}}},Uz={kernelName:jE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,TM(UM(BM(n,"float32")),1))}}},Pz={kernelName:QE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,YM(OM(1),UM(BM(n,"float32"))))}}};const Dz=hT({avgPool3dGrad_:function(e,t,n,r,a,i){const s=lT(e,"dy","avgPool3dGrad"),o=lT(t,"input","avgPool3dGrad");let l=s,c=o,u=!1;4===o.rank&&(u=!0,l=SR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=SR(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),GC(5===l.rank,()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")),GC(5===c.rank,()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")),_R("avgPool3dGrad",a,i);const h={dy:l,input:c},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},A=$I.runKernel(qE,h,d);return u?SR(A,[A.shape[1],A.shape[2],A.shape[3],A.shape[4]]):A}}),Oz={kernelName:KE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:s,dimRoundingMode:o}=n;return{x:()=>Dz(e,r,a,i,s,o)}}};const zz=hT({avgPoolGrad_:function(e,t,n,r,a){const i=lT(e,"dy","avgPoolGrad"),s=lT(t,"input","avgPoolGrad");GC(s.rank===i.rank,()=>"Rank of input (".concat(s.rank,") does not match rank of dy (").concat(i.rank,")"));let o=s,l=i,c=!1;3===s.rank&&(c=!0,o=SR(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=SR(i,[1,i.shape[0],i.shape[1],i.shape[2]])),GC(4===l.rank,()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(l.rank,".")),GC(4===o.rank,()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(o.rank,"."));const u={dy:l,input:o},h={filterSize:n,strides:r,pad:a},d=$I.runKernel(GE,u,h);return c?SR(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Hz={kernelName:WE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:a,strides:i,pad:s}=n;return{x:()=>zz(e,r,a,i,s)}}},jz={kernelName:XE,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,a]=t,{transposeA:i,transposeB:s}=n;return i||s?!i&&s?{a:()=>BR(e,a,!1,!1),b:()=>BR(e,r,!0,!1)}:i&&!s?{a:()=>BR(a,e,!1,!0),b:()=>BR(r,e,!1,!1)}:{a:()=>BR(a,e,!0,!0),b:()=>BR(e,r,!0,!0)}:{a:()=>BR(e,a,!1,!0),b:()=>BR(r,e,!0,!1)}}},Qz={kernelName:YE,gradFunc:(e,t,n)=>{const{blockShape:r,crops:a}=n;return{x:()=>MU(e,r,a)}}},Vz={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const r=n,a=r.inputShape,i=r.shape,s=Array.from(i);for(let l=a.length-1;l>=0;l--)if(a[l]===i[l])s[l]=1;else if(1!==a[l])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));const o=[];for(let l=0;l<s.length;l++)s[l]>1&&o.push(l);return{x:()=>BL(e,o,!0)}}},Wz={kernelName:eN,gradFunc:e=>({x:()=>e.clone()})},Gz={kernelName:tN,gradFunc:e=>({x:()=>PM(e)})},Kz={kernelName:nN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:a,clipValueMax:i}=n;return{x:()=>hL(rU(zL(r,a),KL(r,i)),e,PM(e))}}},qz={kernelName:aN,inputsToSave:["x"],gradFunc:Ez.gradFunc},Xz={kernelName:iN,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(e=>e.shape),{axis:a}=n,i=nE(a,t[0].shape)[0],s=r.map(e=>e[i]);return xP(e,s,i).map(e=>()=>e)}},Yz={kernelName:sN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{dilations:i,strides:s,pad:o,dataFormat:l}=n;return GC(vR(i),()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(i,"'")),{x:()=>YR(r.shape,e,a,s,o,l),filter:()=>rD(r,e,a.shape,s,o,l)}}},Jz={kernelName:lN,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,{strides:i,pad:s,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>qR(e,a,i,s,o,1,l),filter:()=>rD(e,r,a.shape,i,s,o,l)}}};const Zz=hT({conv3DBackpropFilter_:function(e,t,n,r,a){let i=e;4===e.rank&&(i=SR(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let s=t;4===s.rank&&(s=SR(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),GC(5===i.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")),GC(5===s.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(s.shape,".")),GC(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")),GC(i.shape[4]===n[3],()=>"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")),GC(s.shape[4]===n[4],()=>"Error in conv3dDerFilter: depth of dy (".concat(s.shape[4],") must ")+"match output depth for filter (".concat(n[4],")."));const o={x:i,dy:s},l={strides:r,pad:a,filterShape:n};return $I.runKernel(uN,o,l)}}),$z={kernelName:cN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i}=n;GC(vR(r),()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'"));const[s,o]=t;return{x:()=>$R(s.shape,e,o,a,i),filter:()=>Zz(s,e,o.shape,a,i)}}},eH={kernelName:dN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(ZL(hP(BM(n,"float32"))),e)}}},tH={kernelName:AN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(dP(BM(n,"float32")),e)}}},nH={kernelName:fN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a,exclusive:i,reverse:s}=n;return{x:()=>{const t=_L([a],r.rank);let n=aL(e,a,i,!s);return null!=t&&(n=qP(n,t)),n}}}},rH={kernelName:vN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:a,pad:i,dimRoundingMode:s}=n,o=null==r?[1,1]:r;GC(vR(o),()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(o,"'"));const[l,c]=t;return GC(4===l.rank,()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(l.rank,".")),GC(4===c.rank,()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(c.rank,".")),GC(l.shape[3]===c.shape[2],()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(l.shape[3],") must match the inChannels dimension ")+"in filter ".concat(c.shape[2],".")),GC(bR(a,o),()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(o,"'.")),_R("depthwiseConv2d",i,s),{x:()=>uD(l.shape,e,c,a,i,o,s),filter:()=>cD(l,e,c.shape,a,i,o,s)}}},aH={kernelName:_N,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,a]=t,i={x:r,filter:a,dy:e},s={x:r,filter:a,dy:e};return{x:()=>$I.runKernel(SN,i,n),filter:()=>$I.runKernel(CN,s,n)}}},iH={kernelName:kN,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>$I.runKernel(IN,r)}}},sH={kernelName:TN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=RM(ML(ZL(UM(n))),2/Math.sqrt(Math.PI));return{x:()=>RM(e,r)}}},oH={kernelName:FN,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,n)}}},lH={kernelName:RN,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>SR(e,n.shape)}}},cH={kernelName:LN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,ML(n))}}},uH={kernelName:ON,gradFunc:e=>({x:()=>PM(e)})},hH={kernelName:zN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{const t=FM(e,BM(r,"float32")),i=eF(n.shape,a);return i.length>0?SR(BL(t,i),n.shape):t},b:()=>{let t=RM(e,BM(n,"float32"));const i=eF(r.shape,a);i.length>0&&(t=SR(BL(t,i),r.shape));const s=UM(r);return ZL(FM(t,BM(s,"float32")))}}}},dH={kernelName:HN,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[a,i,s,o]=t,l=null==o?OM(1):o,c=eF(i.shape,a.shape),u=[];if(1===i.rank){for(let e=0;e<a.shape.length-1;++e)u.push(a.shape[e]);u.push(1)}const h=YM(a,i),d=RM(e,l),A=sP(TM(s,OM(r))),p=RM(RM(RM(A,A),A),OM(-.5));return{x:()=>1===i.rank?SR(RM(RM(e,LL(SR(A,[1,1,1,i.shape[0]]),u)),l),a.shape):SR(RM(RM(e,A),l),a.shape),mean:()=>{let e=RM(RM(A,OM(-1)),d);return 1===i.rank&&(e=BL(e,c)),SR(e,i.shape)},variance:()=>{let e=RM(RM(p,h),d);return 1===i.rank&&(e=BL(e,c)),SR(e,i.shape)},scale:()=>{const t=RM(h,A);let n=RM(e,t);return 1===i.rank&&(n=BL(n,c)),SR(n,i.shape)},offset:()=>{let t=e;return 1===i.rank&&(t=BL(t,c)),SR(t,i.shape)}}}},AH={kernelName:jN,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,a]=t,{axis:i,batchDims:s}=n,o=nE(i,r.shape)[0],l=(e,t,n)=>()=>{const r=e.shape,a=t.size,s=r.slice(0,o),l=s.length,c=r.slice(i,r.length).slice(1),u=c.length,h=pH(0,l),d=pH(l+1,l+1+u),A=fH([s,[a],c]),p=SR(n,A),f=SR(t,[a]),m=fH([[l],h,d]),g=qP(p,m);let y=HP(g,f,e.shape[o]);const v=SL(m);return y=qP(y,v),y};if(1===s){const t=r.shape[0],n=r.split(t,0),i=()=>{const t=CP(n.map((t,n)=>l(t,a.slice(n,1),e.slice(n,1))()));return t.reshape(r.shape)};return{x:i,indices:()=>a}}return{x:l(r,a,e),indices:()=>a}}};function pH(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function fH(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const mH={kernelName:WN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>PM(n),b:()=>PM(r)}}},gH={kernelName:GN,gradFunc:e=>({x:()=>BM(e,"float32")})},yH={kernelName:XN,gradFunc:e=>({x:()=>PM(e)})},vH={kernelName:YN,gradFunc:e=>({x:()=>PM(e)})},bH={kernelName:JN,gradFunc:e=>({x:()=>PM(e)})},xH={kernelName:ZN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:a}=n,i=OL(r,0);return{x:()=>hL(i,e,RM(e,a))}}},wH={kernelName:rB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,TM(n,1))}}},_H={kernelName:nB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,BM(n,"float32"))}}},SH={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;return{logits:()=>{const t=ML(r);return YM(e,RM(BL(e,a,!0),t))}}}};const CH=hT({localResponseNormalizationBackprop_:function(e,t,n){const r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return $I.runKernel(lB,r,a)}}),EH={kernelName:oB,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{depthRadius:i,bias:s,alpha:o,beta:l}=n;return{x:()=>CH(r,a,e,i,s,o,l)}}};function NH(e,t,n,r){return t.rank<n.rank&&(t=SR(t,xL(t.shape,r))),e.rank<n.rank&&(e=SR(e,xL(e.shape,r))),{x:()=>RM(e,BM(uL(n,t),e.dtype))}}const BH={kernelName:cB,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:a}=r,i=t[0],s=NH(e,t[1],i,nE(a,i.shape));return{x:()=>s.x()}}},kH={kernelName:uB,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>RM(e,BM(zL(n,r),"float32")),b:()=>RM(e,BM(GL(n,r),"float32"))}}};const IH=hT({maxPool3dGrad_:function(e,t,n,r,a,i,s){const o=lT(e,"dy","maxPool3dGrad"),l=lT(t,"input","maxPool3dGrad"),c=lT(n,"output","maxPool3dGrad");let u=o,h=l,d=c,A=!1;4===l.rank&&(A=!0,u=SR(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=SR(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=SR(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),GC(5===u.rank,()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")),GC(5===h.rank,()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")),GC(5===d.rank,()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")),_R("maxPool3dGrad",i,s);const p={dy:u,input:h,output:d},f={filterSize:r,strides:a,pad:i,dimRoundingMode:s},m=$I.runKernel(pB,p,f);return A?SR(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),TH={kernelName:AB,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=n;return{x:()=>IH(e,r,a,i,s,o,l)}}};const MH=hT({maxPoolGrad_:function(e,t,n,r,a,i,s){const o=lT(e,"dy","maxPoolGrad"),l=lT(t,"input","maxPoolGrad"),c=lT(n,"output","maxPoolGrad");GC(l.rank===o.rank,()=>"Rank of input (".concat(l.rank,") does not match rank of dy ")+"(".concat(o.rank,")")),GC(4===o.rank,()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(o.rank,".")),GC(4===l.rank,()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(l.rank,".")),_R("maxPoolGrad",i,s);const u={dy:o,input:l,output:c},h={filterSize:r,strides:a,pad:i,dimRoundingMode:s};return $I.runKernel(dB,u,h)}}),FH={kernelName:hB,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,a]=t,{filterSize:i,strides:s,pad:o}=n;return{x:()=>MH(e,r,a,i,s,o)}}},RH={kernelName:mB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n,i=nE(a,r.shape),s=XC(bL(r.shape,i)[1]);return{x:()=>{const t=r.shape.slice();i.forEach(e=>{t[e]=1});const n=SR(e,t);return FM(RM(n,fU(r.shape,"float32")),s)}}}},LH={kernelName:gB,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:a}=r,[i,s]=t,o=NH(e,s,i,nE(a,i.shape));return{x:()=>o.x()}}},UH={kernelName:yB,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>RM(e,BM(KL(n,r),"float32")),b:()=>RM(e,BM(OL(n,r),"float32"))}}},PH={kernelName:vB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map(e=>e[0]);return{x:()=>IR(e,i,r.shape)}}},DH={kernelName:bB,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{const t=eF(n.shape,a);return t.length>0?SR(BL(e,t),n.shape):e},b:()=>{const t=RM(e,ZL(PL(FM(n,r)))),i=eF(r.shape,a);return i.length>0?SR(BL(t,i),r.shape):t}}}},OH={kernelName:wB,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{const t=RM(e,BM(r,"float32")),i=eF(n.shape,a);return i.length>0?SR(BL(t,i),n.shape):t},b:()=>{const t=RM(e,BM(n,"float32")),i=eF(r.shape,a);return i.length>0?SR(BL(t,i),r.shape):t}}}},zH={kernelName:IB,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return jP(e,r).map(e=>()=>e)}},HH={kernelName:TB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:a}=n,i=a.map(e=>e[0]);return{x:()=>IR(e,i,r.shape)}}},jH={kernelName:MB,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,a]=t,i=n,s=r,o=tF(i.shape,s.shape);return{a:()=>{const t=BM(s,"float32");let n=RM(e,RM(t,XM(i,YM(t,OM(1)))));const r=eF(i.shape,o);return r.length>0&&(n=BL(n,r)),SR(n,i.shape)},b:()=>{const t=OL(i,0),n=hL(t,YL(i),PM(i));let r=RM(e,RM(a,n));const l=eF(s.shape,o);return l.length>0&&(r=BL(r,l)),SR(r,s.shape)}}}},QH={kernelName:FB,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,a=OL(n,0);return{x:()=>hL(a,e,RM(e,r)),alpha:()=>{let t=hL(a,PM(e),RM(e,n));const i=eF(r.shape,e.shape);return i.length>0&&(t=BL(t,i)),SR(t,r.shape)}}}};function VH(e,t,n){const r=e.shape.length,a=r-n.length,i=_L(n,r);let s=e;null!=i&&(s=qP(e,i));const o=s.shape.slice(),l=o.splice(r-n.length,n.length).reduce((e,t)=>e*t,1);o.push(l);let c=function(e,t,n){const r=e.shape.slice();r[n]=1;const a=SR(t,r),i=rL(e,n,!0,!1),s=rL(e,n,!0,!0),o=RM(i,s);return RM(a,o)}(s.reshape(o),t,a);if(c=c.reshape(s.shape),null!=i){const e=SL(i);c=qP(c,e)}return c}const WH={kernelName:RB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:a}=n;let i=[];return i=void 0===a||null===a?r.shape.map((e,t)=>t):"number"===typeof a?[a]:a,{x:()=>VH(r,e,i)}}},GH={kernelName:NN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{const t=FM(e,BM(r,"float32")),i=eF(n.shape,a);return i.length>0?SR(BL(t,i),n.shape):t},b:()=>{let t=RM(e,BM(n,"float32"));const i=eF(r.shape,a);i.length>0&&(t=SR(BL(t,i),r.shape));const s=UM(r);return ZL(FM(t,BM(s,"float32")))}}}},KH={kernelName:zB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,ZL(UM(n)))}}},qH={kernelName:KB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=RM(KL(n,6),EP(n));return{x:()=>RM(e,BM(r,"float32"))}}},XH={kernelName:HB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,BM(EP(n),"float32"))}}},YH={kernelName:jB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>SR(e,n.shape)}}},JH={kernelName:YB,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>ZL(FM(e,RM(XM(n,1.5),2)))}}},ZH={kernelName:tk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=OL(n,OM(0)),r=OM(UO),a=OM(PO),i=RM(e,a),s=RM(RM(e,r),ML(BM(n,"float32")));return hL(t,i,s)}}}},$H={kernelName:sk,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,RM(n,YM(OM(1),n)))}}},ej={kernelName:rk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(tL(BM(n,"float32")),e)}}},tj={kernelName:ak,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(nL(BM(n,"float32")),e)}}},nj={kernelName:nk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:a,size:i}=n,s=r.shape,[o,l]=qF(r,a,i),c=[];for(let u=0;u<e.rank;u++)c.push([o[u],s[u]-o[u]-l[u]]);return{x:()=>NU(e,c)}}},rj={kernelName:dk,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:a}=n,i=RM(e,r);return{logits:()=>YM(i,RM(BL(i,[a],true),r))}}},aj={kernelName:ok,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,kR(n))}}},ij={kernelName:uk,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:a}=n;return{x:()=>FR(e,r,a)}}},sj={kernelName:hk,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>NR(e,r)}}},oj={kernelName:lk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,RM(LM(BM(n,"float32")),2))}}},lj={kernelName:vk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,RM(BM(n,"float32"),2))}}},cj={kernelName:yk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=OM(2);return{a:()=>RM(e,RM(a,YM(n,r))),b:()=>RM(e,RM(a,YM(r,n)))}}},uj={kernelName:Ck,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,a=tF(n.shape,r.shape);return{a:()=>{let t=e;const r=eF(n.shape,a);return r.length>0&&(t=BL(t,r)),SR(t,n.shape)},b:()=>{let t=e;const n=eF(r.shape,a);return n.length>0&&(t=BL(t,n)),SR(ZL(t),r.shape)}}}},hj={kernelName:ck,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,a=r.shape.slice(),{axis:i}=n;nE(i,r.shape).forEach(e=>{a[e]=1});const s=SR(e,a),o=RM(s,fU(r.shape,"float32"));return{x:()=>o}}},dj={kernelName:Ek,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>FM(e,UM(tL(n)))}}},Aj={kernelName:Nk,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(YM(OM(1),UM(n)),e)}}},pj={kernelName:Bk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:a}=n;return{x:()=>{let t=PM(r);if(1===r.rank)for(let n=0;n<a[0];++n)t=TM(t,IR(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)t=TM(t,IR(e,[n*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let s=0;s<a[2];++s)t=TM(t,IR(e,[n*r.shape[0],i*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(let n=0;n<a[0];++n)for(let i=0;i<a[1];++i)for(let s=0;s<a[2];++s)for(let o=0;o<a[3];++o)t=TM(t,IR(e,[n*r.shape[0],i*r.shape[1],s*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},fj={kernelName:Rk,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=nF(t,PM(t)),r=DL(e,n);let a=zL(t,OM(0,"int32"));const i=r.rank-a.rank;for(let o=0;o<i;++o)a=FL(a,o+1);a=rU(a,fU(r.shape,"bool"));const s=PM(r);return hL(a,r,s)}(e,n)}}};const mj=[Ez,Nz,Bz,kz,Iz,Tz,Mz,Fz,Rz,Lz,Uz,Pz,Oz,Hz,jz,Qz,Vz,Wz,Gz,Kz,qz,Xz,Jz,Yz,$z,eH,tH,nH,rH,aH,GH,iH,sH,oH,lH,cH,hH,uH,dH,AH,mH,gH,yH,vH,bH,xH,wH,_H,SH,EH,BH,BH,kH,TH,FH,RH,LH,UH,PH,DH,OH,{kernelName:_B,gradFunc:e=>({x:()=>ZL(e)})},{kernelName:kB,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>pU(n.shape,"float32")}}},{kernelName:BB,gradFunc:e=>({x:()=>PM(e)})},zH,HH,HH,jH,QH,WH,KH,qH,XH,YH,{kernelName:WB,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>$I.runKernel(GB,a,n)}}},{kernelName:QB,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,a={dy:e,images:r};return{images:()=>$I.runKernel(VB,a,n)}}},{kernelName:qB,gradFunc:(e,t,n)=>{const{dims:r}=n,a=nE(r,e.shape);return{x:()=>eP(e,a)}}},{kernelName:XB,gradFunc:e=>({x:()=>PM(e)})},JH,{kernelName:ek,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>BM(PM(n),"float32"),t:()=>RM(e,BM(n,e.dtype)),e:()=>RM(e,BM(aU(n),e.dtype))}}},ZH,$H,{kernelName:ik,gradFunc:e=>({x:()=>PM(e)})},ej,tj,nj,rj,aj,ij,ij,sj,sj,oj,cj,lj,{kernelName:Uk,gradFunc:e=>({x:()=>PM(e)})},uj,hj,dj,Aj,pj,{kernelName:Tk,gradFunc:(e,t,n)=>{const r=n,{perm:a}=r,i=SL(a);return{x:()=>qP(e,i)}}},{kernelName:Fk,gradFunc:(e,t,n)=>{const r=n,{axis:a}=r;return{value:()=>CP(e,a)}}},fj,{kernelName:Lk,gradFunc:e=>({x:()=>PM(e)})}];for(const n of mj)Yk(n);FI().prototype.abs=function(){return this.throwIfDisposed(),ZM(this)},FI().prototype.acos=function(){return this.throwIfDisposed(),JF(this)},FI().prototype.acosh=function(){return this.throwIfDisposed(),ZF(this)},FI().prototype.add=function(e){return this.throwIfDisposed(),TM(this,e)},FI().prototype.all=function(e,t){return this.throwIfDisposed(),eR(this,e,t)},FI().prototype.any=function(e,t){return this.throwIfDisposed(),tR(this,e,t)},FI().prototype.argMax=function(e){return this.throwIfDisposed(),nR(this,e)},FI().prototype.argMin=function(e){return this.throwIfDisposed(),rR(this,e)},FI().prototype.asScalar=function(){return this.throwIfDisposed(),GC(1===this.size,()=>"The array must have only 1 element."),SR(this,[])},FI().prototype.asType=function(e){return this.throwIfDisposed(),BM(this,e)},FI().prototype.as1D=function(){return this.throwIfDisposed(),SR(this,[this.size])},FI().prototype.as2D=function(e,t){return this.throwIfDisposed(),SR(this,[e,t])},FI().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),SR(this,[e,t,n])},FI().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),SR(this,[e,t,n,r])},FI().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),SR(this,[e,t,n,r,a])},FI().prototype.asin=function(){return this.throwIfDisposed(),aR(this)},FI().prototype.asinh=function(){return this.throwIfDisposed(),iR(this)},FI().prototype.atan=function(){return this.throwIfDisposed(),sR(this)},FI().prototype.atan2=function(e){return this.throwIfDisposed(),oR(this,e)},FI().prototype.atanh=function(){return this.throwIfDisposed(),lR(this)},FI().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),CR(this,e,t,n,r)},FI().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),FR(this,e,t)},FI().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),RR(this,e,t,n,r,a)},FI().prototype.broadcastTo=function(e){return this.throwIfDisposed(),HR(this,e)},FI().prototype.cast=function(e){return this.throwIfDisposed(),BM(this,e)},FI().prototype.ceil=function(){return this.throwIfDisposed(),jR(this)},FI().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),QR(this,e,t)},FI().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof MI&&(e=[e]),NR([this,...e],t)},FI().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),XR(this,e,t,n,r,a,i)},FI().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),JR(this,e,t,n,r,a)},FI().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),qR(this,e,t,n,r,a,i)},FI().prototype.cos=function(){return this.throwIfDisposed(),tL(this)},FI().prototype.cosh=function(){return this.throwIfDisposed(),nL(this)},FI().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),rL(this,e,t,n)},FI().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),aL(this,e,t,n)},FI().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),sL(this,e,t)},FI().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),oL(this,e,t,n,r,a,i)},FI().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),cL(this,e,t,n,r,a)},FI().prototype.divNoNan=function(e){return this.throwIfDisposed(),dL(this,e)},FI().prototype.div=function(e){return this.throwIfDisposed(),FM(this,e)},FI().prototype.dot=function(e){return this.throwIfDisposed(),AL(this,e)},FI().prototype.elu=function(){return this.throwIfDisposed(),fL(this)},FI().prototype.equal=function(e){return this.throwIfDisposed(),uL(this,e)},FI().prototype.erf=function(){return this.throwIfDisposed(),gL(this)},FI().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),TL(this,e,t)},FI().prototype.exp=function(){return this.throwIfDisposed(),ML(this)},FI().prototype.expandDims=function(e){return this.throwIfDisposed(),FL(this,e)},FI().prototype.expm1=function(){return this.throwIfDisposed(),RL(this)},FI().prototype.fft=function(){return this.throwIfDisposed(),yP(this)},FI().prototype.flatten=function(){return this.throwIfDisposed(),SR(this,[this.size])},FI().prototype.floor=function(){return this.throwIfDisposed(),PL(this)},FI().prototype.floorDiv=function(e){return this.throwIfDisposed(),MM(this,e)},FI().prototype.gather=function(e,t,n){return this.throwIfDisposed(),DL(this,e,t,n)},FI().prototype.greaterEqual=function(e){return this.throwIfDisposed(),zL(this,e)},FI().prototype.greater=function(e){return this.throwIfDisposed(),OL(this,e)},FI().prototype.ifft=function(){return this.throwIfDisposed(),vP(this)},FI().prototype.irfft=function(){return this.throwIfDisposed(),bP(this)},FI().prototype.isFinite=function(){return this.throwIfDisposed(),jL(this)},FI().prototype.isInf=function(){return this.throwIfDisposed(),QL(this)},FI().prototype.isNaN=function(){return this.throwIfDisposed(),VL(this)},FI().prototype.leakyRelu=function(e){return this.throwIfDisposed(),WL(this,e)},FI().prototype.lessEqual=function(e){return this.throwIfDisposed(),KL(this,e)},FI().prototype.less=function(e){return this.throwIfDisposed(),GL(this,e)},FI().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),XL(this,e,t,n,r)},FI().prototype.logSigmoid=function(){return this.throwIfDisposed(),eU(this)},FI().prototype.logSoftmax=function(e){return this.throwIfDisposed(),tU(this,e)},FI().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),nU(this,e,t)},FI().prototype.log=function(){return this.throwIfDisposed(),YL(this)},FI().prototype.log1p=function(){return this.throwIfDisposed(),JL(this)},FI().prototype.logicalAnd=function(e){return this.throwIfDisposed(),rU(this,e)},FI().prototype.logicalNot=function(){return this.throwIfDisposed(),aU(this)},FI().prototype.logicalOr=function(e){return this.throwIfDisposed(),iU(this,e)},FI().prototype.logicalXor=function(e){return this.throwIfDisposed(),sU(this,e)},FI().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),BR(this,e,t,n)},FI().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),uU(this,e,t,n,r)},FI().prototype.max=function(e,t){return this.throwIfDisposed(),EL(this,e,t)},FI().prototype.maximum=function(e){return this.throwIfDisposed(),nF(this,e)},FI().prototype.mean=function(e,t){return this.throwIfDisposed(),AU(this,e,t)},FI().prototype.min=function(e,t){return this.throwIfDisposed(),NL(this,e,t)},FI().prototype.minimum=function(e){return this.throwIfDisposed(),gU(this,e)},FI().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),yU(this,e,t)},FI().prototype.mod=function(e){return this.throwIfDisposed(),vU(this,e)},FI().prototype.mul=function(e){return this.throwIfDisposed(),RM(this,e)},FI().prototype.neg=function(){return this.throwIfDisposed(),ZL(this)},FI().prototype.norm=function(e,t,n){return this.throwIfDisposed(),IL(this,e,t,n)},FI().prototype.notEqual=function(e){return this.throwIfDisposed(),_U(this,e)},FI().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),SU(this,e,t,n)},FI().prototype.onesLike=function(){return this.throwIfDisposed(),CU(this)},FI().prototype.pad=function(e,t){return this.throwIfDisposed(),NU(this,e,t)},FI().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),FU(this,e,t,n,r,a,i)},FI().prototype.pow=function(e){return this.throwIfDisposed(),XM(this,e)},FI().prototype.prelu=function(e){return this.throwIfDisposed(),RU(this,e)},FI().prototype.prod=function(e,t){return this.throwIfDisposed(),LU(this,e,t)},FI().prototype.reciprocal=function(){return this.throwIfDisposed(),JU(this)},FI().prototype.relu=function(){return this.throwIfDisposed(),ZU(this)},FI().prototype.relu6=function(){return this.throwIfDisposed(),$U(this)},FI().prototype.reshapeAs=function(e){return this.throwIfDisposed(),SR(this,e.shape)},FI().prototype.reshape=function(e){return this.throwIfDisposed(),SR(this,e)},FI().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),DD(this,e,t,n)},FI().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),OD(this,e,t,n)},FI().prototype.reverse=function(e){return this.throwIfDisposed(),eP(this,e)},FI().prototype.rfft=function(){return this.throwIfDisposed(),wP(this)},FI().prototype.round=function(){return this.throwIfDisposed(),iP(this)},FI().prototype.rsqrt=function(){return this.throwIfDisposed(),sP(this)},FI().prototype.selu=function(){return this.throwIfDisposed(),oP(this)},FI().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),lP(this,e,t,n,r,a,i)},FI().prototype.sigmoid=function(){return this.throwIfDisposed(),kR(this)},FI().prototype.sign=function(){return this.throwIfDisposed(),uP(this)},FI().prototype.sin=function(){return this.throwIfDisposed(),hP(this)},FI().prototype.sinh=function(){return this.throwIfDisposed(),dP(this)},FI().prototype.slice=function(e,t){return this.throwIfDisposed(),IR(this,e,t)},FI().prototype.softmax=function(e){return this.throwIfDisposed(),gP(this,e)},FI().prototype.softplus=function(){return this.throwIfDisposed(),$L(this)},FI().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),MU(this,e,t)},FI().prototype.split=function(e,t){return this.throwIfDisposed(),xP(this,e,t)},FI().prototype.sqrt=function(){return this.throwIfDisposed(),LM(this)},FI().prototype.square=function(){return this.throwIfDisposed(),UM(this)},FI().prototype.squaredDifference=function(e){return this.throwIfDisposed(),_P(this,e)},FI().prototype.squeeze=function(e){return this.throwIfDisposed(),SP(this,e)},FI().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof MI?[this,e]:[this,...e];return CP(n,t)},FI().prototype.step=function(e){return this.throwIfDisposed(),EP(this,e)},FI().prototype.stridedSlice=function(e,t,n,r,a,i,s,o){return this.throwIfDisposed(),NP(this,e,t,n,r,a,i,s,o)},FI().prototype.sub=function(e){return this.throwIfDisposed(),YM(this,e)},FI().prototype.sum=function(e,t){return this.throwIfDisposed(),BL(this,e,t)},FI().prototype.tan=function(){return this.throwIfDisposed(),BP(this)},FI().prototype.tanh=function(){return this.throwIfDisposed(),TR(this)},FI().prototype.tile=function(e){return this.throwIfDisposed(),LL(this,e)},FI().prototype.toBool=function(){return this.throwIfDisposed(),BM(this,"bool")},FI().prototype.toFloat=function(){return this.throwIfDisposed(),BM(this,"float32")},FI().prototype.toInt=function(){return this.throwIfDisposed(),BM(this,"int32")},FI().prototype.topk=function(e,t){return this.throwIfDisposed(),DP(this,e,t)},FI().prototype.transpose=function(e){return this.throwIfDisposed(),qP(this,e)},FI().prototype.unique=function(e){return this.throwIfDisposed(),zP(this,e)},FI().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),HP(this,e,t)},FI().prototype.unstack=function(e){return this.throwIfDisposed(),jP(this,e)},FI().prototype.where=function(e,t){return this.throwIfDisposed(),hL(e,this,t)},FI().prototype.zerosLike=function(){return this.throwIfDisposed(),PM(this)};class gj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,gj.prototype)}}class yj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yj.prototype)}}class vj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vj.prototype)}}class bj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bj.prototype)}}class xj extends Error{constructor(e){super(e),Object.setPrototypeOf(this,xj.prototype)}}Error;class wj{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function _j(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function Sj(e,t){if(!e)throw new xj(t)}function Cj(e,t){let n=0;for(const r of e)r===t&&n++;return n}function Ej(e){return 1===e.length?e[0]:e}function Nj(e){return Array.isArray(e)?e:[e]}function Bj(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function kj(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Ij={};function Tj(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Mj(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach(e=>Mj(e));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?Mj(t):e[n]=t.value)}}}function Fj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const a=e;let i;if(a in n)i=n[a];else if(a in Ij)i=Ij[a];else if(i=t[a],null==i)throw new vj("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}{const i=e;if(null==i.className||null==i.config)throw new vj("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(i),".\n")+"'className' and 'config' must set.");const s=i.className;let o,l;if(s in n?[o,l]=n[s]:s in Ij?[o,l]=Ij.className:s in t&&([o,l]=t[s]),null==o)throw new vj("Unknown ".concat(r,": ").concat(s,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){const e={};for(const n of Object.keys(Ij))e[n]=Ij[n];for(const a of Object.keys(n))e[a]=n[a];i.config.customObjects=e;const t=Object.assign({},Ij);for(const a of Object.keys(n))Ij[a]=n[a];Mj(i.config);const r=l(o,i.config,n,a);return Ij=Object.assign({},t),r}{const e=Object.assign({},Ij);for(const r of Object.keys(n))Ij[r]=n[r];const t=new o(i.config);return Ij=Object.assign({},e),t}}}function Rj(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Lj(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function Uj(e){if(null==e)throw new vj("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Pj(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new vj("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Dj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Sj(n>=0),Sj(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function Oj(e,t){Array.isArray(e)?(GC(e.length>0,()=>"".concat(t," is unexpectedly an empty array.")),e.forEach((e,n)=>Oj(e,"element ".concat(n+1," of ").concat(t)))):GC(Number.isInteger(e)&&e>0,()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(zj(e),"."))}function zj(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>zj(e)).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function Hj(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let jj=0;function Qj(){return jj++}const Vj={};function Wj(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Vj||(Vj[e]=0),Vj[e]+=1,e+Vj[e].toString()}const Gj=["channelsFirst","channelsLast"],Kj=["nearest","bilinear"],qj=["valid","same","causal"],Xj=["max","avg"],Yj=["sum","mul","concat","ave"],Jj=new Map;function Zj(e){Pj(Gj,"DataFormat",e)}function $j(e){Pj(qj,"PaddingMode",e)}function eQ(e){Pj(Xj,"PoolMode",e)}const tQ=[];function nQ(e,t){tQ.push(e);try{const e=t();return tQ.pop(),e}catch(n){throw tQ.pop(),n}}function rQ(e){if(!sQ(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===tQ.length?"":tQ.join("/")+"/")+e}function aQ(e){if(!sQ(e))throw new Error("Not a valid tensor name: '"+e+"'");Jj.has(e)||Jj.set(e,0);const t=Jj.get(e);if(Jj.set(e,Jj.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return Jj.set(n,1),n}return e}const iQ=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function sQ(e){return!!e.match(iQ)}function oQ(e){return e===parseInt(e.toString(),10)}function lQ(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function cQ(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function uQ(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function hQ(e,t){if(t<e)throw new vj("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let r=e;r<t;++r)n.push(r);return n}let dQ;function AQ(){return null==dQ&&(dQ=ST().epsilon()),dQ}function pQ(e,t){return BM(e,t)}function fQ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),SR(e,n)}function mQ(e,t,n){return vT(()=>{switch(e.rank){case 1:return AP(e,t,n);case 2:return pP(e,[t,0],[n,e.shape[1]]);case 3:return fP(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return mP(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return IR(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return IR(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new vj("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function gQ(e,t,n){return vT(()=>{switch(e.rank){case 1:return AP(e,t,n);case 2:return pP(e,[0,t],[e.shape[0],n]);case 3:return fP(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return mP(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new vj("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function yQ(e,t,n,r){return vT(()=>{switch(e.rank){case 1:return AP(e,t,n);case 2:switch(r){case 1:return mQ(e,t,n);case 2:return gQ(e,t,n);default:throw new vj("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return mQ(e,t,n);case 2:return fP(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return gQ(e,t,n);default:throw new vj("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return mQ(e,t,n);case 2:return mP(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return mP(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return gQ(e,t,n);default:throw new vj("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new vj("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function vQ(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),NR(e,n)}function bQ(e,t){switch(e.rank){case 1:return VR([e,t]);case 2:return WR([e,t],0);case 3:return GR([e,t],0);case 4:return KR([e,t],0);default:throw new vj("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function xQ(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new vj("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return LL(e,t)}function wQ(e){return WU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function _Q(e,t,n,r){if(e.rank<2||t.rank<2)throw new bj("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new bj("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return dD({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?EQ(e.rank,r,"channelsLast"):null,activation:n})}{const a=e.shape.slice(),i=a.pop();e=SR(e,[-1,i]);const s=t.shape.slice(),o=s.pop(),l=s.pop(),c=[...s,o],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=SR(qP(t,u),[l,-1]);const h=[...a,...c];return SR(dD({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?EQ(e.rank,r,"channelsLast"):null,activation:n}),h)}}function SQ(e,t,n){return vT(()=>(t=Array.isArray(t)?kP(t,"int32"):BM(t,"int32"),DL(e,t,n)))}function CQ(e){return RM(e,e)}function EQ(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new vj("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?SR(t,[1,r[0],1,1,1]):SR(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?SR(t,[1,1,1,1,r[0]]):SR(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?SR(t,[1,r[0],1,1]):SR(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?SR(t,[1,1,1,r[0]]):SR(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?SR(t,[1,r[0],1]):SR(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?SR(t,[1,1,r[0]]):SR(t,[1].concat(r))}else if(e<3)return t;throw new vj("Unsupported input rank by biasAdd: ".concat(t.rank))}function NQ(e,t,n){return vT(()=>(null==n&&(n="channelsLast"),Zj(n),TM(e,EQ(e.rank,t,n))))}function BQ(e,t,n,r){return vT(()=>$P(e,t,n,r))}function kQ(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const IQ=["fanIn","fanOut","fanAvg"],TQ=["normal","uniform","truncatedNormal"];class MQ extends jM{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class FQ extends MQ{apply(e,t){return pU(e,t)}}FQ.className="Zeros",VM(FQ);class RQ extends MQ{apply(e,t){return fU(e,t)}}RQ.className="Ones",VM(RQ);class LQ extends MQ{constructor(e){if(super(),"object"!==typeof e)throw new vj("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new vj("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return vT(()=>RM(OM(this.value),fU(e,t)))}getConfig(){return{value:this.value}}}LQ.className="Constant",VM(LQ);class UQ extends MQ{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return KU(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}UQ.className="RandomUniform",VM(UQ);class PQ extends MQ{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new bj("randomNormal does not support dType ".concat(t,"."));return wQ(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}PQ.className="RandomNormal",VM(PQ);class DQ extends MQ{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new bj("truncatedNormal does not support dType ".concat(t,"."));return OP(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}DQ.className="TruncatedNormal",VM(DQ);class OQ extends MQ{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return vT(()=>{if(2!==e.length||e[0]!==e[1])throw new vj("Identity matrix initializer can only be used for 2D square matrices.");return RM(this.gain,UL(e[0]))})}getConfig(){return{gain:this.gain}}}OQ.className="Identity",VM(OQ);class zQ extends MQ{constructor(e){if(super(),e.scale<0)throw new vj("scale must be a positive float. Got: ".concat(e.scale));var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,Pj(IQ,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){Pj(TQ,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Zj(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){const r=lQ(e,2);t=e[1]*r,n=e[0]*r}else if("channelsLast"===r){const r=lQ(e,0,e.length-2);t=e[e.length-2]*r,n=e[e.length-1]*r}}else{const r=lQ(e);t=Math.sqrt(r),n=Math.sqrt(r)}return[t,n]}(e),r=n[0],a=n[1];let i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){const n=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new bj("".concat(this.getClassName()," does not support dType ").concat(t,"."));return OP(e,0,n,t,this.seed)}{const n=Math.sqrt(3*i);return KU(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}zQ.className="VarianceScaling",VM(zQ);class HQ extends zQ{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}HQ.className="GlorotUniform",VM(HQ);class jQ extends zQ{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}jQ.className="GlorotNormal",VM(jQ);class QQ extends zQ{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}QQ.className="HeNormal",VM(QQ);class VQ extends zQ{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}VQ.className="HeUniform",VM(VQ);class WQ extends zQ{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}WQ.className="LeCunNormal",VM(WQ);class GQ extends zQ{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}GQ.className="LeCunUniform",VM(GQ);class KQ extends MQ{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return vT(()=>{if(e.length<2)throw new bj("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=XC(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(a,") elements: ")+"Slowness may result.");const i=wQ([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),s=AO.qr(i,!1);let o=s[0];const l=s[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return o=RM(o,l.sign()),n<r&&(o=o.transpose()),RM(OM(this.gain),o.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}KQ.className="Orthogonal",VM(KQ);const qQ={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XQ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fj(e,QM.getMap().classNameMap,t,"initializer")}function YQ(e){return Tj(e)}function JQ(e){if("string"===typeof e){const t=e in qQ?qQ[e]:e;if("GlorotNormal"===t)return new jQ;if("GlorotUniform"===t)return new HQ;if("HeNormal"===t)return new QQ;if("HeUniform"===t)return new VQ;if("LeCunNormal"===t)return new WQ;if("LeCunUniform"===t)return new GQ;{const e={};return e.className=t,e.config={},XQ(e)}}return e instanceof MQ?e:XQ(e)}function ZQ(e){return Array.isArray(e)&&Array.isArray(e[0])}function $Q(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function eV(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new vj("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function tV(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new vj("Expected exactly 1 Shape; got ".concat(e.length))}return e}function nV(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}const rV="Variable";class aV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rV,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Qj(),n=null==n?rV:n,this.originalName=rQ(n),this.name=aQ(this.originalName),this.trainable_=r,this.constraint=a,this.val=VP(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function iV(e){return e.map(e=>e.read())}function sV(e){e.forEach(e=>{e[0].write(e[1])})}class oV{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class lV{constructor(e,t,n,r,a,i,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=s,this.id=Qj(),null!=i&&(this.originalName=rQ(i),this.name=aQ(this.originalName)),this.rank=t.length}}let cV=0;class uV{constructor(e,t){this.callArgs=t,this.id=cV++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let hV=0;class dV extends jM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=hV++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=Bj(e)+"_"+Wj(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new yj("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new vj("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return Ej(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Ej(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new gj("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new gj("Layer ".concat(this.name)+" is not connected, no input to return.");return Ej(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new gj("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new gj("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Ej(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Nj(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=Nj(this.inputSpec);if(t.length!==n.length)throw new vj("Layer ".concat(this.name," expects ").concat(n.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(e));for(let r=0;r<t.length;r++){const e=t[r],a=n[r];if(null==a)continue;const i=e.rank;if(null!=a.ndim&&i!==a.ndim)throw new vj("Input ".concat(r," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new vj("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new vj("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&e.dtype!==a.dtype)throw new vj("Input ".concat(r," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(e.dtype,"."));if(a.axes){const t=e.shape;for(const e in a.axes){const n=Number(e),i=a.axes[e],s=n>=0?t[n]:t[t.length+n];if(null!=i&&-1===[i,null].indexOf(s))throw new vj("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(n," of input shape to ")+"have value ".concat(i," but got shape ").concat(t,"."))}}if(null!=a.shape)for(let t=0;t<a.shape.length;++t){const n=a.shape[t],i=e.shape[t];if(null!=n&&null!=i&&n!==i)throw new vj("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(e.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=Nj(e),r=function(e){let t=!0;for(const n of Nj(e))if(!(n instanceof lV)){t=!1;break}return t}(e),a=function(e){let t=!0;for(const n of Nj(e))if(n instanceof lV){t=!1;break}return t}(e);if(r===a)throw new vj("Arguments to apply() must be all SymbolicTensors or all Tensors");return nQ(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of Nj(e))t.push(n.shape);this.build(Ej(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);const a=Nj(r),i=[];for(let e of a)-1!==n.indexOf(e)&&(e=e.clone()),i.push(e);if(r=Ej(i),null!=this.activityRegularizer)throw new bj("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=Nj(e);const t=[];for(const n of e)t.push(n.shape);return Ej(t)}(e),r=this.computeOutputShape(n);let a;const i="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),a=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new lV(i,n,this,Nj(e),t,this.name,r)):new lV(i,r,this,Nj(e),t,this.name),this.addInboundNode(e,a,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new bj("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new gj("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new gj("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new yj("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return nV(this.weights)}build(e){this.built=!0}getWeights(){return iV(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){vT(()=>{const t=this.weights;if(t.length!==e.length)throw new vj('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],r=iV(t);for(let a=0;a<r.length;++a){const i=r[a],s=t[a],o=e[a];if(!YC(i.shape,o.shape))throw new vj("Layer weight shape ".concat(i.shape," ")+"not compatible with provided weight shape ".concat(o.shape));n.push([s,o])}sV(n)})}addWeight(e,t,n,r,a,i,s,o){if(-1!==this._addedWeightNames.indexOf(e))throw new vj("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():JQ("zeros"));const l=r.apply(t,n),c=new aV(l,n,e,i,s);return l.dispose(),null!=a&&this.addLoss(()=>a.apply(c.read())),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=Nj(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach(e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")})}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),a=Nj(t),i=Nj(r);if(a.length!==i.length)throw new Error("".concat(this.name," outputs ").concat(a.length," tensors ")+"but ".concat(a.length," masks for those tensors"));for(let s=0;s<a.length;s++)a[s].kerasMask=i[s]}addInboundNode(e,t,n,r,a,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const o=Nj(e);t=Nj(t),n=Nj(n),r=Nj(r),a=$Q(a),i=$Q(i);const l=[],c=[],u=[];for(const h of o)l.push(h.sourceLayer),c.push(h.nodeIndex),u.push(h.tensorIndex);new uV({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},s);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function AV(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=AV(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class pV extends dV{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:Wj("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new vj("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new vj("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new vj("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new lV(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new uV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new vj("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}pV.className="InputLayer",VM(pV);class fV{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof fV)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new vj("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return BM(t,e.dtype)}catch(lhe){throw new vj("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof lV){if(null==this.id2Value[e.id])throw new vj("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new vj("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof lV){if(null==this.id2Value[e.id])throw new vj("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new vj("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&bT(this.id2Mask)}}const mV=new wj,gV=new wj;function yV(e,t,n,r){const a=null!=n&&n.training,i=Array.isArray(e),s=i?e:[e],o=s.map(e=>e.name),l=[],c=t.names();for(const p of o)-1!==c.indexOf(p)?l.push(t.getValue(p)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=o.join(",")+"|"+t.names().sort().join(",");let h,d=mV.get(u);if(null==d){const e=function(e,t){GC(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(1===e.length){const a=bV(e[0],t);n=a.sorted,r=a.recipientMap}else{const a=new Set;for(const i of e){const{sorted:e,recipientMap:s}=bV(i,t);for(const t of e)a.has(t.name)||(n.push(t),a.add(t.name));for(const t in s)null==r[t]&&(r[t]=new Set),s[t].forEach(e=>r[t].add(e))}}return{sorted:n,recipientCounts:vV(r)}}(s,t);d=e.sorted,h=e.recipientCounts,mV.put(u,d),gV.put(u,h)}h={},a||Object.assign(h,gV.get(u));const A=new fV(t);for(let p=0;p<d.length;++p){if(null!=r){const e=yT().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[p],i=e.sourceLayer;if(i instanceof pV)continue;const s=[],c=[],u=[];let f=!1;for(const n of e.inputs){const e=A.getValue(n),r=A.getMask(n);s.push(e),c.push(r),null!=r&&(f=!0),a||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==o.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}f&&((n=n||{}).mask=c[0]);const m=Nj(i.apply(s,n));let g=null;i.supportsMasking&&(g=i.computeMask(s,c));const y=xV(e),v=Array.isArray(y)?y:[y];for(let t=0;t<v.length;++t){A.hasKey(v[t])||A.add(v[t],m[t],Array.isArray(g)?g[0]:g);const e=o.indexOf(v[t].name);-1!==e&&(l[e]=m[t])}a||bT(u)}return A.disposeMasks(),i?l:l[0]}function vV(e){const t={};for(const n in e)t[n]=e[n].size;return t}function bV(e,t){const n=new Set,r=[],a={};for(const o of t.names())n.add(o);const i=[],s=[];for(i.push(e);i.length>0;){const e=i[i.length-1];if(n.has(e.name)){i.pop();continue}const t=s[s.length-1]===i.length-1;if(0===e.inputs.length||t)i.pop(),r.push(e),n.add(e.name),t&&s.pop();else{s.push(i.length-1);for(const t of e.inputs)null==a[t.name]&&(a[t.name]=new Set),a[t.name].add(e.name),n.has(t.name)||i.push(t)}}return{sorted:r,recipientMap:a}}function xV(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function wV(e,t){return vT(()=>LM(BL(RM(e,e),t,!0)))}EE().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,function(e){null!=mV&&mV.setMaxEntries(e),null!=gV&&gV.setMaxEntries(e)});class _V extends jM{getConfig(){return{}}}class SV extends _V{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return vT(()=>{const t=wV(e,this.axis),n=QR(t,0,this.maxValue);return RM(e,FM(n,TM(AQ(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}SV.className="MaxNorm",VM(SV);class CV extends _V{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return vT(()=>FM(e,TM(AQ(),wV(e,this.axis))))}getConfig(){return{axis:this.axis}}}CV.className="UnitNorm",VM(CV);class EV extends _V{apply(e){return ZU(e)}}EV.className="NonNeg",VM(EV);class NV extends _V{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return vT(()=>{const t=wV(e,this.axis),n=TM(RM(this.rate,QR(t,this.minValue,this.maxValue)),RM(1-this.rate,t));return RM(e,FM(n,TM(AQ(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}NV.className="MinMaxNorm",VM(NV);const BV={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function kV(e){return Tj(e)}function IV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fj(e,QM.getMap().classNameMap,t,"constraint")}function TV(e){if(null==e)return null;if("string"===typeof e){return IV({className:e in BV?BV[e]:e,config:{}})}return e instanceof _V?e:IV(e)}async function MV(e){if(null==e)return;const t=[],n=[],r=[];for(const a in e){const i=e[a];if("number"!==typeof i){const e=i;t.push(e.data()),n.push(a),r.push(e)}}if(t.length>0){const a=await Promise.all(t);for(let t=0;t<a.length;++t)e[n[t]]=a[t][0];bT(r)}}function FV(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var RV;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(RV||(RV={}));class LV{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class UV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class PV extends LV{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"===typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const a=vT(()=>TM(this.totals[r],RM(e,n)));this.totals[r]=a,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:vT(()=>{const e=RM(FM(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),xT(t[n])}))}}class DV extends LV{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const a in this.history){const r=this.history[a];for(let i=0;i<r.length;++i)if("number"!==typeof r[i]){const s=r[i];e.push(s.data()),t.push(a),n.push(i)}}const r=await Promise.all(e);for(let a=0;a<r.length;++a){this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}}}class OV extends LV{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||vO,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");cE(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let r,a=null!=n?n():fI();return function(){const i=null!=n?n():fI();return i-a<t||(a=i,r=e(...arguments)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await MV(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await MV(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await MV(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await MV(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await MV(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):cE(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await MV(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await MV(e),await this.trainEnd(e))}}function zV(e,t){if(null==e&&(e={}),e instanceof LV)return[e];if(Array.isArray(e)&&e[0]instanceof LV)return e;return Nj(e).map(e=>new OV(e,t))}class HV{constructor(){}static registerCallbackConstructor(e,t){GC(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)),HV.checkForDuplicate(t),null==HV.constructors[e]&&(HV.constructors[e]=[]),HV.constructors[e].push(t)}static checkForDuplicate(e){for(const t in HV.constructors){HV.constructors[+t].forEach(t=>{if(t===e)throw new vj("Duplicate callback constructor.")})}}static clear(){HV.constructors={}}static createCallbacks(e){const t=[];for(const n in HV.constructors){const r=+n;e>=r&&t.push(...HV.constructors[r])}return t.map(e=>new e)}}function jV(e,t,n,r,a,i,s,o,l){const c=new DV,u=[new PV,...HV.createCallbacks(t)];null!=e&&u.push(...e),u.push(c);const h=new UV(u);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:s,verbose:t,doValidation:o,metrics:l}),{callbackList:h,history:c}}function QV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Fj(e,QM.getMap().classNameMap,t,"layer",n)}function VV(e,t){return vT(()=>{"float32"!==e.dtype&&(e=BM(e,"float32"));const n=BL(CQ(e),t,!0),r=KM(n.shape,AQ()),a=LM(nF(n,r));return FM(e,a)})}function WV(e,t){return vT(()=>AU(CQ(YM(t,e)),-1))}function GV(e,t){return vT(()=>AU(ZM(YM(t,e)),-1))}function KV(e,t){return vT(()=>{const n=YM(e,t),r=QR(ZM(e),AQ(),Number.MAX_VALUE),a=ZM(FM(n,r));return RM(100,AU(a,-1))})}function qV(e,t){return vT(()=>{const n=QR(t,AQ(),Number.MAX_VALUE),r=YL(TM(1,n)),a=QR(e,AQ(),Number.MAX_VALUE),i=YL(TM(1,a));return AU(CQ(YM(r,i)),-1)})}function XV(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return vT(()=>{if(n)t=gP(t);else{const e=BL(t,t.shape.length-1,!0);t=FM(t,e)}return t=QR(t,AQ(),1-AQ()),ZL(BL(RM(BM(e,"float32"),YL(t)),t.shape.length-1))})}function YV(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return vT(()=>{const r=BM(PL(function(e){const t=[lQ(e.shape)];return SR(e,t)}(e)),"int32"),a=(t=QR(t,AQ(),1-AQ())).shape;return XV(SR(SU(r,a[a.length-1]),a),t,n)})}function JV(e,t){return vT(()=>{let n;return n=QR(t,AQ(),1-AQ()),n=YL(FM(n,YM(1,n))),AU(function(e,t){if(!YC(e.shape,t.shape))throw new vj("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return vT(()=>{const n=ZU(t),r=ZL(ZM(t));return TM(YM(n,RM(t,e)),JL(ML(r)))})}(e,n),-1)})}function ZV(e,t){return vT(()=>{const n=QR(e,AQ(),1),r=QR(t,AQ(),1);return BL(RM(e,YL(FM(n,r))),-1)})}function $V(e,t){return vT(()=>{const n=VV(e,-1),r=VV(t,-1),a=RM(n,r);return ZL(BL(a,-1))})}HV.constructors={};const eW={meanSquaredError:WV,meanAbsoluteError:GV,meanAbsolutePercentageError:KV,meanSquaredLogarithmicError:qV,squaredHinge:function(e,t){return vT(()=>{const n=nF(0,YM(1,RM(e,t)));return AU(CQ(n),-1)})},hinge:function(e,t){return vT(()=>{const n=nF(0,YM(1,RM(e,t)));return AU(n,-1)})},categoricalHinge:function(e,t){return vT(()=>{const n=BL(RM(e,t),-1),r=EL(RM(YM(1,e),t),-1);return nF(0,TM(1,YM(r,n)))})},logcosh:function(e,t){return vT(()=>{const n=Math.log(2),r=YM(t,e),a=YM(TM(r,$L(RM(-2,r))),n);return AU(a,-1)})},categoricalCrossentropy:XV,sparseCategoricalCrossentropy:YV,binaryCrossentropy:JV,kullbackLeiblerDivergence:ZV,poisson:function(e,t){return vT(()=>{const n=YL(TM(AQ(),t));return AU(YM(t,RM(e,n)),-1)})},cosineProximity:$V};function tW(e){if("string"===typeof e){if(e in eW)return eW[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new vj(t)}return e}function nW(e,t){return vT(()=>{const n=RM(.5,CU(t)),r=pQ(OL(t,n),e.dtype);return AU(uL(e,r),-1)})}function rW(e,t){return vT(()=>pQ(uL(nR(e,-1),nR(t,-1)),"float32"))}function aW(e,t){return vT(()=>BM(BL(rU(uL(e,1),uL(t,1))),"float32"))}function iW(e,t){return JV(e,t)}function sW(e,t){return e.rank===t.rank&&(e=SP(e,[e.rank-1])),(t=nR(t,-1)).dtype!==e.dtype&&(t=BM(t,e.dtype)),BM(uL(e,t),"float32")}const oW=XV,lW=YV,cW={binaryAccuracy:nW,categoricalAccuracy:rW,precision:function(e,t){return vT(()=>{const n=aW(e,t),r=function(e,t){return vT(()=>BM(BL(rU(uL(e,0),uL(t,1))),"float32"))}(e,t),a=TM(n,r);return BM(hL(OL(a,0),FM(n,a),0),"float32")})},categoricalCrossentropy:oW,sparseCategoricalCrossentropy:lW,mse:WV,MSE:WV,mae:GV,MAE:GV,mape:KV,MAPE:KV,cosine:$V};function uW(e){if("string"===typeof e&&e in cW)return cW[e];if("string"!==typeof e&&null!=e)return e;throw new vj("Unknown metric ".concat(e))}function hW(e){if(Sj(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(eW))if(eW[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(cW))if(cW[n]===e){t=n;break}return void 0!==t?t:e.name}}const dW=1048576;function AW(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!pW(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>dW&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(dW,"."))}}function pW(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!pW(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!pW(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function fW(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const a=function(e){let t=!0;const n=[],r=[];for(const a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(const a of n){if(a.length>1||1===a.length&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(const a of e.layers){let e=!1;for(const n of a.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),i=["Layer (type)","Input Shape","Output shape","Param #"];let s;if(a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!a){i.push("Receives inputs"),s=[];for(const t in e.nodesByDepth)s.push(...e.nodesByDepth[t])}r("_".repeat(t)),mW(i,n,r),r("=".repeat(t));const o=e.layers;for(let u=0;u<o.length;++u)a?gW(o[u],n,r):yW(o[u],n,s,r),r((u===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;t=null!=e.collectedTrainableWeights?nV(e.collectedTrainableWeights):nV(e.trainableWeights);return t}(e),c=nV(e.nonTrainableWeights);r("Total params: ".concat(l+c)),r("Trainable params: ".concat(l)),r("Non-trainable params: ".concat(c)),r("_".repeat(t))}function mW(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function gW(e,t,n){let r,a;try{a=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(lhe){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(lhe){r="multiple"}const i=e.name,s=e.getClassName();mW(["".concat(i," (").concat(s,")"),a,r,e.countParams().toString()],t,n)}function yW(e,t,n,r){let a,i;try{i=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(lhe){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(lhe){a="multiple"}const s=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e){const t=u.inboundLayers[e].name,n=u.nodeIndices[e],r=u.tensorIndices[e];s.push("".concat(t,"[").concat(n,"][").concat(r,"]"))}const o=e.name,l=e.getClassName(),c=0===s.length?"":s[0];mW(["".concat(o," (").concat(l,")"),i,a,e.countParams().toString(),c],t,r);for(let u=1;u<s.length;++u)mW(["","","","",s[u]],t,r)}function vW(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function bW(e,t){if(null===e)return null;if("string"===typeof e)return kj(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];vW(t,a,r)?n.push(r):n.push(bW(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"===typeof r)t[n]=r;else{const e=kj(n);t[e]=bW(r,e)}}return t}}function xW(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return Bj(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let a=0;a<r;++a){const r=e[a];vW(t,a,r)?n.push(r):n.push(xW(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],a=Bj(n);t[a]="name"!==n&&"className"!==n||"string"!==typeof r?xW(r,n):r}return t}}const wW="4.22.0";class _W extends dV{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=Wj(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Lj(this.inputs).length!==this.inputs.length)throw new vj("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map(e=>e.name)));Lj(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map(e=>e.name))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const g of this.outputs){const e=g.sourceLayer,t=g.nodeIndex,n=g.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const g of this.inputs){const e=g.sourceLayer,t=g.nodeIndex,n=g.tensorIndex;Sj(0===t,"input layer has >1 nodes"),Sj(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let g=0;g<this.inputLayers.length;g++){const t=this.inputLayers[g];if(!(t instanceof pV))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const g of this.outputLayers)this.outputNames.push(g.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},r={},a={},i={},s=[],o=(e,t,n,r,a,l)=>{null!=r&&null!=a&&null!=l||(r=e.sourceLayer,a=e.nodeIndex,l=e.tensorIndex);const c=r.inboundNodes[a];if(-1!==n.indexOf(c))throw new yj("The tensor ".concat(e.name,' at layer "').concat(r.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(c))return;this.containerNodes.add(_W.nodeKey(r,a)),r.id in i||(i[r.id]=Object.keys(i).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let i=0;i<u;i++){const e=c.inputTensors[i],r=c.inboundLayers[i],a=c.nodeIndices[i],s=c.tensorIndices[i];o(e,t,n,r,a,s)}for(t.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);s.push(c)},l=[],c=[];for(const g of this.outputs)o(g,l,c);const u=s.slice().reverse();for(const g of u){n[g.id]=g,g.id in t||(t[g.id]=0);let e=t[g.id];const i=null==r[g.outboundLayer.id]?0:r[g.outboundLayer.id];e=Math.max(e,i),r[g.outboundLayer.id]=e,a[g.outboundLayer.id]=g.outboundLayer,t[g.id]=e;for(let r=0;r<g.inboundLayers.length;r++){const a=g.inboundLayers[r],i=g.nodeIndices[r],s=a.inboundNodes[i],o=null==t[s.id]?0:t[s.id];t[s.id]=Math.max(e+1,o),n[s.id]=s}}const h={};for(const g in t){const e=t[g];e in h||(h[e]=[]),h[e].push(n[g])}const d={};for(const g in r){const e=r[g];e in d||(d[e]=[]),d[e].push(a[g])}let A=Object.keys(d).map(e=>parseInt(e,10)).sort(Rj);this.layers=[];for(const g of A){const e=d[g];e.sort((e,t)=>{const n=i[e.id],r=i[t.id];return n<r?-1:n>r?1:0});for(const t of e)t instanceof _W&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,A=Object.keys(h).map(e=>parseInt(e,10)).sort(Rj);const p=this.inputs.slice(),f=[];for(const g of A)for(const e of h[g]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new yj("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(f));for(const t of e.outputTensors)p.push(t);f.push(t.name)}}this.nodesByDepth=h;const m=this.layers.map(e=>e.name);for(const g of m){const e=m.filter(e=>e===g).length;if(1!==e)throw new yj('The name "'.concat(g,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new uV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new vj("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let r=0;const a=(e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))})(e);a&&this.parseWeights(e);for(const s of this.layers)for(const[e,t]of s.weights.entries()){const i=a?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[i])throw new vj("Duplicate weight name: ".concat(i));n[i]=t,r++}const i=[];for(const s in e){let r=s;if(null==n[s]){const e=s.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])i.push([n[r],e[s]]);else if(t)throw new vj("Provided weight data has no target variable: ".concat(s));delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new vj("".concat(e.length," of ").concat(r," weights are not set: ")+"".concat(e))}sV(i)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],a=n.map(e=>e.startsWith("_")?e.slice(1):e).filter(e=>!r.includes(e)).join("/");a!==t&&(e[a]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(wW),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=xW(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return vT(()=>{e=Nj(e);const n=new fV;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return yV(this.outputs,n,t)})}computeMask(e,t){return vT(()=>{let n;return e=Nj(e),n=null==t?_j(null,e.length):Nj(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=$Q(e);if(t.length!==this.inputLayers.length)throw new vj("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let s=0;s<t.length;s++){const e=this.inputLayers[s],r=t[s];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Rj);if(r.length>1)for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const r=[];for(let s=0;s<t.inboundLayers.length;s++){const e=t.inboundLayers[s],a=t.nodeIndices[s],i=t.tensorIndices[s],o=n["".concat(e.name,"_").concat(a,"_").concat(i)];r.push(o)}const a=$Q(e.computeOutputShape(Ej(r))),i=e.inboundNodes.indexOf(t);for(let t=0;t<a.length;t++){n["".concat(e.name,"_").concat(i,"_").concat(t)]=a[t]}}}const a=[],i=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],t=this.outputLayersNodeIndices[s],n=this.outputLayersTensorIndices[s],r="".concat(e.name,"_").concat(t,"_").concat(n);i.push(r)}for(let s=0;s<i.length;s++){const e=i[s];Sj(e in n),a.push(n[e])}return Ej(a)}runInternalGraph(e,t){null==t&&(t=_j(null,e.length));const n={};for(let o=0;o<this.inputs.length;++o){const r=this.inputs[o],a=e[o],i=t[o];n[r.id]=[a,i]}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(Rj);for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,a=t.outputTensors,i=new Array;for(const t of r)t.id in n&&i.push(n[t.id]);if(i.length===r.length){let r,s,o,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===i.length){const[t,n]=i[0];null==c.mask&&(c.mask=n),o=Nj(e.call(t,c)),l=Nj(e.computeMask(t,n)),r=[t],s=[n]}else r=i.map(e=>e[0]),s=i.map(e=>e[1]),null==c.mask&&(c.mask=s),o=Nj(e.call(r,c)),l=Nj(e.computeMask(r,s));if(e.activityRegularizer)throw new bj("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<a.length;++e){const t=a[e],r=o[e],i=l[e];n[t.id]=[r,i]}}}}const a=[],i=[],s=[];for(const o of this.outputs){Sj(o.id in n,"Could not compute output ".concat(o.name," : ").concat(o.id));const[e,t]=n[o.id];s.push(e.shape),a.push(e),i.push(t)}return[a,i,s]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof _W?1:0;for(let e=0;e<r.inboundNodes.length;e++){const a=_W.nodeKey(r,e);this.containerNodes.has(a)&&(t[a]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new vj("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new vj("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new vj("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return vT(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=_W.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const i of this.layers){const e=i.getClassName(),r=i.getConfig(),a=[];for(let n=0;n<i.inboundNodes.length;n++){const e=i.inboundNodes[n],r=_W.nodeKey(i,n);let s={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),s=e.callArgs}catch(lhe){console.warn("Layer ".concat(i.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),s={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const a=e.inboundLayers[r],i=e.nodeIndices[r],o=e.tensorIndices[r];let l=t[_W.nodeKey(a,i)];null==l&&(l=0),n.push([a.name,l,o,s])}a.push(n)}}}const s={};s.name=i.name,s.className=e,s.config=r,s.inboundNodes=a,n.push(s)}e.layers=n;const r=[];for(let i=0;i<this.inputLayers.length;i++){const e=this.inputLayers[i],n=this.inputLayersNodeIndices[i],a=_W.nodeKey(e,n);if(!this.containerNodes.has(a))continue;let s=t[a];null!==s&&void 0!==s||(s=0);const o=this.inputLayersTensorIndices[i];r.push([e.name,s,o])}e.inputLayers=r;const a=[];for(let i=0;i<this.outputLayers.length;i++){const e=this.outputLayers[i],n=this.outputLayersNodeIndices[i],r=_W.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let s=t[r];null!==s&&void 0!==s||(s=0);const o=this.outputLayersTensorIndices[i];a.push([e.name,s,o])}return e.outputLayers=a,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function s(e,t){const n=[];let a;for(const s of t){const o=s[0],l=s[1],c=s[2];if(a=null==s[3]?{}:s[3],!(o in r))return void i(e,t);const u=r[o];if(u.inboundNodes.length<=l)return void i(e,t);const h=u.inboundNodes[l];n.push(h.outputTensors[c])}n.length>0&&e.apply(Ej(n),a)}function o(e){const a=e.name,s=QV(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(n),r[a]=s;e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new vj("Corrupted configuration, expected array for nodeData: ".concat(e));i(s,e)})}const l=t.name,c=t.layers;for(const p of c)o(p);for(;!Uj(a);)for(const e of c){const t=r[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)s(t,n)}}const u=[],h=[],d=t.inputLayers;for(const p of d){const e=p[0],t=p[1],n=p[2];Sj(e in r);const a=r[e].inboundNodes[t].outputTensors;u.push(a[n])}const A=t.outputLayers;for(const p of A){const e=p[0],t=p[1],n=p[2];Sj(e in r);const a=r[e].inboundNodes[t].outputTensors;h.push(a[n])}return new e({inputs:u,outputs:h,name:l})}get stateful(){if(this._stateful)throw new vj("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){vT(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function SW(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function CW(e,t){return SW(e,t,"classWeight")}async function EW(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=vT(()=>{if(1===e.shape.length)return kM(e);if(2===e.shape.length){if(e.shape[1]>1){return nR(e,1)}if(1===e.shape[1])return SR(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),r=Array.from(await t.data());bT(t);const a=[];return r.forEach(e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");a.push(n[e])}),kP(a,"float32")}return null}function NW(e,t){return RM(e,t)}function BW(e,t){let n,r;const a=t;n=a.xs,r=a.ys,GC(null!=n&&null!=r,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t));const i=kW("input",e.inputNames,n),s=kW("output",e.outputNames,r),o=i[0].shape[0];GC(i.length===e.inputs.length,()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")),GC(s.length===e.outputs.length,()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(s.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")"));for(let l=0;l<i.length;l++)GC(i[l].shape[0]===o,()=>"Batch size mismatch: input "+"".concat(e.inputNames[l]," has ").concat(i[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));for(let l=0;l<s.length;l++)GC(s[l].shape[0]===o,()=>"Batch size mismatch: output "+"".concat(e.outputNames[l]," has ").concat(s[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));return{xs:i,ys:s}}function kW(e,t,n){if(n instanceof MI)return[n];if(Array.isArray(n))return GC(n.length===t.length,()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")),n;{const r=[];for(const a of t){if(null==n[a])throw new vj("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(a,"'."));r.push(n[a])}return r}}async function IW(e,t,n){const r=null!=n.batchesPerEpoch;if(GC(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),GC(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),GC(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs)),GC(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch)),GC(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const a=null!=n.validationData;let i,s;if(a)if(TW(n.validationData))GC(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches));else{const e=function(e){if(3===e.length)throw new bj("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);i=e.xs,s=e.ys}const o=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=a?l.slice().concat(l.map(e=>"val_"+e)):l.slice();const u=zV(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:A}=jV(u,h,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,a,c);d.setModel(e),e.history=A,await d.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,f=await t.iterator();for(;p<n.epochs;){const c={};await d.onEpochBegin(p);let u=0,h=0;for(r||(f=await t.iterator());!r||u<n.batchesPerEpoch;){const t=await f.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(u," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:a}=BW(e,t.value),i={};i.batch=h,i.size=r[0].shape[0],await d.onBatchBegin(h,i);const s=[];if(null!=n.classWeight){const t=CW(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)s.push(await EW(a[e],null,t[e]))}const c=r.concat(a).concat(s),A=o(c);bT(c);for(let e=0;e<l.length;++e){const t=l[e],n=A[e];i[t]=n,xT(n)}await d.onBatchEnd(h,i),FV(i),h++,u++}if(r?u>=n.batchesPerEpoch:t.done){if(a){let t;t=TW(n.validationData)?Nj(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):Nj(e.evaluate(i,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(p,c),p++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function TW(e){return"function"===typeof e.iterator}function MW(e){GC(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got ".concat(e))}function FW(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>mQ(e,t,n-t)):mQ(e,t,n-t)}function RW(e,t){return vT(()=>null==e?null:Array.isArray(e)?e.map(e=>RW(e,t)):SQ(e,"int32"===t.dtype?t:BM(t,"int32")))}function LW(e,t){const n=[];let r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function UW(e){const t=[];e instanceof MI&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(fQ(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function PW(e,t){if(null==e)return;const n=[];if(t instanceof MI)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const a in t){const e=t[a];n.push(e.id)}const r=[];if(e instanceof MI)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(const a in e){const t=e[a];-1===n.indexOf(t.id)&&r.push(t)}r.forEach(e=>{e.isDisposed||e.dispose()})}function DW(e){return Array.isArray(e)}function OW(e){return!function(e){return e instanceof MI}(e)&&!DW(e)}function zW(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(DW(e)&&e.length>0)t=!0;else if(OW(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new vj("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map(e=>null);if(OW(e)){r=[];for(const n of t){if(null==e[n])throw new vj('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));r.push(e[n])}}else if(DW(e)){if(e.length!==t.length)throw new vj("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new vj("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=UW(r),null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new vj("Error when checking ".concat(i,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let t=0;t<n[s].length;++t){if(0===t&&!a)continue;const r=e.shape[t],o=n[s][t];if(null!=o&&o>=0&&r!==o)throw new vj("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[s].slice(1,n[s].length),"] ")+"(i.e.,tensor shape [*,".concat(n[s].slice(1,n[s].length),"])")+" but the ".concat(i," received an input with ").concat(e.shape[0])+" examples, each with shape [".concat(e.shape.slice(1,e.shape.length),"]")+" (tensor shape [".concat(e.shape,"])"))}}return r}function HW(e,t,n){let r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new vj("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new vj("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new vj("Error when checking ".concat(i,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let r=0;r<n[s].length;++r){if(0===r&&!a)continue;const o=e.shape[r],l=n[s][r];if(null!=l&&l!==o)throw new vj("Error when checking ".concat(i,": expected ")+"".concat(t[s]," to have shape ").concat(JSON.stringify(n[s])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class jW extends _W{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new vj("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");fW(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>gO.adagrad(.01),Adadelta:()=>gO.adadelta(1,.95,AQ()),Adam:()=>gO.adam(.001,.9,.999,AQ()),Adamax:()=>gO.adamax(.002,.9,.999,AQ(),0),RMSProp:()=>gO.rmsprop(.001,.9,0,AQ()),SGD:()=>gO.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new vj("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof WM))throw new vj("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new vj("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map(e=>tW(e))}else{const n=tW(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new vj('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(tW(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const e=this.internalOutputShapes[i],t=this.outputNames[i];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[i])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],nQ("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),a=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};nQ("metric",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,i;for(const s of t){if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){const t=this.internalOutputShapes[e];let a;1===t[t.length-1]||this.lossFunctions[e]===JV?-1!==["accuracy","acc"].indexOf(s)?r=nW:-1!==["crossentropy","ce"].indexOf(s)&&(r=iW):this.lossFunctions[e]===YV?-1!==["accuracy","acc"].indexOf(s)?r=sW:-1!==["crossentropy","ce"].indexOf(s)&&(r=lW):-1!==["accuracy","acc"].indexOf(s)?r=rW:-1!==["crossentropy","ce"].indexOf(s)&&(r=oW),-1!==["accuracy","acc"].indexOf(s)?a="acc":-1!==["crossentropy","ce"].indexOf(s)&&(a="ce"),i=r,n=""+a}else{const e=uW(s);i=e,n=""+hW(s)}let t;nQ(n,()=>{t=i}),a(e,n,t)}})(r[e])}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null==n.batchSize?32:n.batchSize;MW(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const e=a[0].concat(a[1]);this.makeTestFunction();const t=this.testFunction;return Ej(this.testLoop(t,e,r,n.verbose,n.steps))}finally{PW(a[0],e),PW(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,a=e.testFunction;let i=[];if(n.verbose>0)throw new bj("Verbose mode is not implemented yet.");GC(!r||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches)));const s="function"===typeof t.next?t:await t.iterator();let o=0,l=0;for(;!r||l<n.batches;){const t=await s.next();if(i=vT(()=>{if(t.value){const{xs:n,ys:r}=BW(e,t.value),s=n.concat(r),c=vT(()=>a(s));if(bT(s),0===l)for(let e=0;e<c.length;++e)i.push(OM(0));const u=s[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=i[e];i[e]=vT(()=>TM(i[e],RM(u,t))),l>0&&bT(n)}bT(c),o+=u,++l}return i}),t.done){r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let c=0;c<i.length;++c){const e=i[c];i[c]=FM(i[c],o),bT(e)}return Ej(i)}(this,e,t)}checkNumSamples(e,t,n){let r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new vj("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new vj("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new vj("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new fV;if(e instanceof MI&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new vj("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)i.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new vj("No value is provided for the model's input ".concat(o.name));i.add(o,t)}const s=yV(a,i);return n?s:s[0]}retrieveSymbolicTensors(e){const t=_j(null,e.length);let n=e.length;for(const r of this.layers){const a=Array.isArray(r.output)?r.output:[r.output],i=a.map(e=>e.name);for(let r=0;r<e.length;++r){const s=i.indexOf(e[r]);if(-1!==s&&(t[r]=a[s],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new vj("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return vT(()=>{const r=this.checkNumSamples(e);if(n)throw new bj("Verbose predictLoop() is not implemented yet.");const a=LW(r,t),i=this.outputs.map(e=>[]);for(let t=0;t<a.length;++t){const n=vT(()=>{const n=a[t][0],r=a[t][1],i=FW(e,n,r),s=[];if(Array.isArray(i))for(let e=0;e<i.length;++e)s.push({key:this.inputs[e],value:i[e]});else s.push({key:this.inputs[0],value:i});const o=new fV(s);return yV(this.outputs,o)});n.forEach((e,t)=>i[t].push(e))}return Ej(i.map(e=>NR(e,0)))})}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=UW(e);HW(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return MW(e),this.predictLoop(n,e)}finally{PW(n,e)}}predictOnBatch(e){HW(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new yj("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let a=0;a<this.feedOutputShapes.length;++a){const e=this.feedOutputShapes[a];this.feedLossFns[a]===YV?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=Lj(e.map(e=>e.shape[0]));n.sort();const r=Lj(t.map(e=>e.shape[0]));if(r.sort(),n.length>1)throw new vj("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(e=>e.shape))));if(r.length>1)throw new vj("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map(e=>e.shape))));if(n.length>0&&r.length>0&&!YC(n,r))throw new vj("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(r[0]," target ")+"sample(s).")}(e=zW(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=zW(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const r=[WV,JV,XV];for(let a=0;a<e.length;++a){const i=e[a],s=t[a],o=n[a];if(null!=s){if(s===XV&&1===i.shape[i.shape.length-1])throw new vj("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(s)){const e=i.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const r=e[n],a=t[n];if(null!=a&&r!==a)throw new vj("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(o,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new vj("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5?arguments[5]:void 0;const[s,o]=this.standardizeUserDataXY(e,t,a,i);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const e=CW(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await EW(o[t],null,e[t]))}return[s,o,l]}testLoop(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;return vT(()=>{const i=this.checkNumSamples(t,n,a,"steps"),s=[];if(r>0)throw new bj("Verbose mode is not implemented yet.");if(null!=a)throw new bj("steps mode in testLoop() is not implemented yet");{const r=LW(i,n),a=kP(hQ(0,i));for(let n=0;n<r.length;++n){const i=r[n][0],o=r[n][1],l=mQ(a,i,o-i),c=RW(t,l),u=e(c);if(0===n)for(let e=0;e<u.length;++e)s.push(OM(0));for(let e=0;e<u.length;++e){const t=u[e];s[e]=TM(s[e],RM(o-i,t))}}for(let e=0;e<s.length;++e)s[e]=FM(s[e],i)}return s})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let a=r;if(Cj(e,r)>1){const t=Cj(e.slice(0,n),r);a+="_".concat(t)}t.push(a)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),i=[],s=this.collectedTrainableWeights.map(e=>e.read()),o=this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const s=new fV(e),o=yV(this.outputs,s,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],o[n]);null!=a[n]&&(e=NW(e,a[n]));const i=AU(e);t.push(i),l=0===n?e:TM(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],a=this.metricsTensors[n][1];e=AU(t(r[a],o[a]))}xT(e),i.push(e)}return l=AU(l),this.calculateLosses().forEach(e=>{l=TM(l,e)}),l},!0,s);return[o].concat(i)}}makeTestFunction(){this.testFunction=e=>vT(()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let e=0;e<this.inputs.length;++e)i.push({key:this.inputs[e],value:r[e]});const s=new fV(i),o=yV(this.outputs,s);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],i=AU(r(a[e],o[e]));n=0===e?i:TM(n,i),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],i=AU(n(a[r],o[r]));t.push(i)}return t})}async fit(e,t){let n,r,a,i,s,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==h.batchSize?32:h.batchSize;MW(d);const A=!1,p=await this.standardizeUserData(e,t,h.sampleWeight,h.classWeight,A,d);n=p[0],r=p[1],u=p[2];let f,m=!1;if(null!=h.validationData&&h.validationData.length>0){if(m=!0,2!==h.validationData.length)throw 3===h.validationData.length?new bj("validationData including sample weights is not supported yet."):new vj("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(h.validationData," is invalid."));s=h.validationData[0],o=h.validationData[1];const e=!0,t=await this.standardizeUserData(s,o,null,null,e,d);l=t[0],c=t[1],f=l.concat(c)}else if(null!=h.validationSplit&&h.validationSplit>0&&h.validationSplit<1){m=!0;const e=Math.floor(n[0].shape[0]*(1-h.validationSplit)),t=n[0].shape[0];l=FW(n,e,t),a=n,n=FW(n,0,e),c=FW(r,e,t),i=r,r=FW(r,0,e),f=l.concat(c)}else null!=h.validationSteps&&(m=!0);const g=n.concat(r).concat(u);this.checkTrainableWeightsConsistency();const y=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let b,x;m?(this.makeTestFunction(),b=this.testFunction,x=v.slice().concat(v.map(e=>"val_"+e))):(b=null,f=[],x=v.slice());const w=zV(h.callbacks,h.yieldEvery);return await this.fitLoop(y,g,v,d,h.epochs,h.verbose,w,b,f,h.shuffle,x,h.initialEpoch,null,null)}finally{this.isTraining=!1,PW(n,e),PW(r,t),PW(a,e),PW(i,t),PW(l,s),PW(c,o),null!=u&&bT(u)}}async fitLoop(e,t,n,r,a,i,s,o,l,c,u,h,d,A){null==r&&(r=32),null==a&&(a=1),null==c&&(c=!0),null==h&&(h=0);let p=!1;if(null!=o&&null!=l&&(p=!0),null!=A&&(p=!0,null==d))throw new vj("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const f=this.checkNumSamples(t,r,d,"steps_per_epoch");let m;null!=f&&(m=hQ(0,f)),null==i&&(i=1);const{callbackList:g,history:y}=jV(s,i,a,h,f,d,r,p,u);g.setModel(this),this.history=y,await g.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<a;++v){await g.onEpochBegin(v);const a={};if(null!=d)throw new bj("stepsPerEpoch mode is not implemented yet.");{if("batch"===c)throw new bj("batch shuffling is not implemneted yet");c&&jC(m);const i=kP(m),s=LW(f,r);for(let c=0;c<s.length;++c){const u={};if(await g.onBatchBegin(c,u),vT(()=>{const h=s[c][0],d=s[c][1],A=mQ(i,h,d-h);u.batch=c,u.size=d-h;const f=RW(t,A),m=e(f);for(let e=0;e<n.length;++e){const t=n[e],r=m[e];u[t]=r,xT(r)}if(c===s.length-1&&p){const e=this.testLoop(o,l,r);for(let t=0;t<n.length;++t){const r=n[t],i=e[t];xT(i),a["val_"+r]=i}}}),await g.onBatchEnd(c,u),FV(u),this.stopTraining_)break}i.dispose()}if(await g.onEpochEnd(v,a),this.stopTraining_)break}return await g.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return IW(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],a=n[1],i=this.makeTrainFunction()(r.concat(a)),s=[];for(const o of i){const e=await o.data();s.push(e[0])}return bT(i),PW(n[0],e),PW(n[1],t),Ej(s)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=yT().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-yT().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=Bj(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>Bj(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!==typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=Bj(n[r])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[Bj(hW(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Bj(hW(e)));{const e={};for(const t in this.metrics)e[t]=Bj(hW(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=QV(bW(e.optimizer_config));let n,r;if("string"===typeof e.loss)n=kj(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>kj(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=kj(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map(e=>kj(e));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=kj(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"===typeof e){const t=GT(e);if(0===t.length)throw new vj("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new vj("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new vj("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await ET(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(wW),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:a}=await ET(await this.optimizer.getWeights(),e);n.specs.push(...a),n.data=UT([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;AW(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){AW(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}jW.className="Model",VM(jW);class QW extends jW{}QW.className="Functional",VM(QW);class VW extends jW{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:Wj("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new vj("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof VW||e instanceof jW;let n;if(t){if(n=e,1!==n.outputs.length)throw new vj("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new vj("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new vj("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new vj("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new pV({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new vj("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new vj("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=AV(this.outputs[0])}this.inboundNodes=[],new uV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:_j(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(tV(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new jW({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new yj("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new yj("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new yj("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new yj("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new vj("Legacy serialization format not supported yet.");n=t}else GC(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),n=t.layers,delete t.layers,a=t;const i=new e(a);if(!(i instanceof VW))throw new bj("Sequential.fromConfig called on non-Sequential input: ".concat(i));for(const s of n){const e=QV(s,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),i.add(e)}return i}set stopTraining(e){if(null==this.model)throw new vj("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new vj("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}VW.className="Sequential",VM(VW);class WW extends jM{getConfig(){return{}}}class GW extends WW{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new bj("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return fL(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}GW.className="elu",VM(GW);class KW extends WW{apply(e){return oP(e)}}KW.className="selu",VM(KW);class qW extends WW{apply(e){return ZU(e)}}qW.className="relu",VM(qW);class XW extends WW{apply(e){return vT(()=>gU(6,ZU(e)))}}XW.className="relu6",VM(XW);class YW extends WW{apply(e){return e}}YW.className="linear",VM(YW);class JW extends WW{apply(e){return kR(e)}}JW.className="sigmoid",VM(JW);class ZW extends WW{apply(e){return function(e){return vT(()=>{const t=TM(.5,RM(.2,e));return QR(t,0,1)})}(e)}}ZW.className="hardSigmoid",VM(ZW);class $W extends WW{apply(e){return $L(e)}}$W.className="softplus",VM($W);class eG extends WW{apply(e){return function(e){return vT(()=>FM(e,TM(ZM(e),1)))}(e)}}eG.className="softsign",VM(eG);class tG extends WW{apply(e){return TR(e)}}tG.className="tanh",VM(tG);class nG extends WW{apply(e){return gP(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}nG.className="softmax",VM(nG);class rG extends WW{apply(e){return tU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}rG.className="logSoftmax",VM(rG);class aG extends WW{apply(e){return vT(()=>vT(()=>{const t=Math.sqrt(2),n=RM(.5,TM(1,gL(FM(e,t))));return RM(e,n)}))}}aG.className="gelu",VM(aG);class iG extends WW{apply(e){return vT(()=>RM(.5,RM(e,TM(1,TR(RM(LM(FM(2,Math.PI)),TM(e,RM(.044715,XM(e,3)))))))))}}iG.className="gelu_new",VM(iG);class sG extends WW{apply(e){return vT(()=>RM(e,TR($L(e))))}}sG.className="mish",VM(sG);class oG extends WW{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return vT(()=>RM(kR(RM(e,t)),e))}}function lG(e){return e.getClassName()}function cG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fj(e,QM.getMap().classNameMap,t,"activation")}function uG(e){if(null==e){const e={className:"linear",config:{}};return cG(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},cG(t)}return e instanceof WW?e:cG(e)}function hG(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}oG.className="swish",VM(oG);class dG extends jM{}class AG extends dG{constructor(e){super(),hG(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return vT(()=>{let t=pU([1]);return this.hasL1&&(t=TM(t,BL(RM(this.l1,ZM(e))))),this.hasL2&&(t=TM(t,BL(RM(this.l2,CQ(e))))),SR(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}AG.className="L1L2",VM(AG);const pG={l1l2:"L1L2"};function fG(e){return Tj(e)}function mG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Fj(e,QM.getMap().classNameMap,t,"regularizer")}function gG(e){if(null==e)return null;if("string"===typeof e){return mG({className:e in pG?pG[e]:e,config:{}})}return e instanceof dG?e:mG(e)}class yG extends dV{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=eV(e);let n=ZU(e);return null!=this.maxValue&&(n=QR(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}yG.className="ReLU",VM(yG);class vG extends dV{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=eV(e);return WL(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}vG.className="LeakyReLU",VM(vG);class bG extends dV{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=JQ(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=gG(e.alphaRegularizer),this.alphaConstraint=TV(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new vj("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=tV(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new oV({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=eV(e),RU(e,this.alpha.read())}getConfig(){const e={alphaInitializer:YQ(this.alphaInitializer),alphaRegularizer:fG(this.alphaRegularizer),alphaConstraint:kV(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}bG.className="PReLU",VM(bG);class xG extends dV{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new bj("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=eV(e);return fL(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}xG.className="ELU",VM(xG);class wG extends dV{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=eV(e);return RM(n,BM(OL(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}wG.className="ThresholdedReLU",VM(wG);class _G extends dV{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new nG).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return vT(()=>{let n=eV(e);const r=t.mask;if(null!=r){const e=RM(YM(fU(n.shape),BM(r,n.dtype)),OM(-1e9));n=TM(n,e)}return this.axis instanceof Array?this.axis.length>1?ML(YM(n,nU(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function SG(e,t,n){if("number"===typeof e)return _j(e,t);if(e.length!==t)throw new vj("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let r=0;r<t;++r){const a=e[r];if(!oQ(a))throw new vj("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function CG(e,t,n,r){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r)}function EG(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+uQ([n-t,0]);else{if("same"!==r)throw new vj("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function NG(e,t){return vT(()=>(Zj(t),"channelsFirst"===t?qP(e,[0,2,3,1]):e))}function BG(e,t){return vT(()=>(Zj(t),"channelsFirst"===t?qP(e,[0,2,3,4,1]):e))}function kG(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return vT(()=>{if(null==i&&(i="channelsLast"),Zj(i),3!==e.shape.length)throw new vj("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new vj("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new vj("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(n.shape.length," instead"));if("channelsFirst"===i&&(e=qP(e,[0,2,1])),"causal"===a)throw new bj("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=XR(e,t,r,"same"===a?"same":"valid","NWC",s);return null!=n&&(o=NQ(o,n)),o})}function IG(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return vT(()=>{if(null==i&&(i="channelsLast"),Zj(i),3!==e.rank&&4!==e.rank)throw new vj("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new vj("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let l=NG(e,i);if("causal"===a)throw new bj("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=lD({x:l,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===i&&(l=qP(l,[0,3,1,2])),l})}function TG(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;return vT(()=>{if(null==i&&(i="channelsLast"),Zj(i),4!==e.rank&&5!==e.rank)throw new vj("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new vj("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let o=BG(e,i);if("causal"===a)throw new bj("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=ZR(o,t,r,"same"===a?"same":"valid","NDHWC",s),null!=n&&(o=NQ(o,n)),"channelsFirst"===i&&(o=qP(o,[0,4,1,2,3])),o})}_G.className="Softmax",VM(_G);class MG extends dV{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",MG.verifyArgs(t),this.rank=e,Oj(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new bj("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=SG(t.kernelSize,e,"kernelSize"),this.strides=SG(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,$j(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Zj(this.dataFormat),this.activation=uG(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=JQ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=TV(t.biasConstraint),this.biasRegularizer=gG(t.biasRegularizer),this.activityRegularizer=gG(t.activityRegularizer),this.dilationRate=SG(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new vj("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new vj("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new vj("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(Sj("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Dj(e.kernelSize,"number",1,3))throw new vj("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:lG(this.activation),useBias:this.useBias,biasInitializer:YQ(this.biasInitializer),biasRegularizer:fG(this.biasRegularizer),activityRegularizer:fG(this.activityRegularizer),biasConstraint:kV(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class FG extends MG{constructor(e,t){super(e,t),this.kernel=null,FG.verifyArgs(t),this.filters=t.filters,Oj(this.filters,"filters"),this.kernelInitializer=JQ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=TV(t.kernelConstraint),this.kernelRegularizer=gG(t.kernelRegularizer)}build(e){e=tV(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new vj("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return vT(()=>{let t;e=eV(e);const n=null==this.bias?null:this.bias.read(),r=Hj(this.activation.getClassName());if(null!=r&&2===this.rank)t=IG(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=kG(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=IG(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new bj("convolutions greater than 3D are not implemented yet.");t=TG(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=tV(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let a=0;a<n.length;++a){const e=CG(n[a],this.kernelSize[a],this.padding,this.strides[a],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[a]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:YQ(this.kernelInitializer),kernelRegularizer:fG(this.kernelRegularizer),kernelConstraint:kV(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new vj("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class RG extends FG{constructor(e){super(2,e),RG.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Dj(e.kernelSize,"number",1,2))throw new vj("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}RG.className="Conv2D",VM(RG);class LG extends FG{constructor(e){super(3,e),LG.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new vj("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}LG.className="Conv3D",VM(LG);class UG extends RG{constructor(e){if(super(e),this.inputSpec=[new oV({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new vj("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=tV(e)).length)throw new vj("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new vj("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new oV({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return vT(()=>{let t=eV(e);if(4!==t.shape.length)throw new vj("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i;"channelsFirst"===this.dataFormat?(a=2,i=3):(a=1,i=2);const s=n[a],o=n[i],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,EG(s,u,l,this.padding),EG(o,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=qP(t,[0,2,3,1]));let A=JR(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(A=qP(A,[0,3,1,2])),null!=this.bias&&(A=NQ(A,this.bias.read(),this.dataFormat)),null!=this.activation&&(A=this.activation.apply(A)),A})}computeOutputShape(e){const t=(e=tV(e)).slice();let n,r,a;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3):(n=3,r=1,a=2);const i=this.kernelSize[0],s=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=EG(t[r],o,i,this.padding),t[a]=EG(t[a],l,s,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}UG.className="Conv2DTranspose",VM(UG);class PG extends LG{constructor(e){if(super(e),this.inputSpec=[new oV({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new vj("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=tV(e)).length)throw new vj("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new vj("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new oV({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return vT(()=>{let t=eV(e);if(5!==t.shape.length)throw new vj("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let a,i,s;"channelsFirst"===this.dataFormat?(s=2,a=3,i=4):(s=1,a=2,i=3);const o=n[s],l=n[a],c=n[i],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],A=this.strides[0],p=this.strides[1],f=this.strides[2],m=[r,EG(o,A,u,this.padding),EG(l,p,h,this.padding),EG(c,f,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=qP(t,[0,2,3,4,1]));let g=eL(t,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(g=qP(g,[0,4,1,2,3])),null!==this.bias&&(g=NQ(g,this.bias.read(),this.dataFormat)),null!==this.activation&&(g=this.activation.apply(g)),g})}computeOutputShape(e){const t=(e=tV(e)).slice();let n,r,a,i;"channelsFirst"===this.dataFormat?(n=1,r=2,a=3,i=4):(n=4,r=1,a=2,i=3);const s=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=EG(t[r],c,s,this.padding),t[a]=EG(t[a],u,o,this.padding),t[i]=EG(t[i],h,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}PG.className="Conv3DTranspose",VM(PG);class DG extends FG{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new vj("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new vj("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new vj("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=JQ(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=gG(t.depthwiseRegularizer),this.depthwiseConstraint=TV(t.depthwiseConstraint),this.pointwiseInitializer=JQ(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=gG(t.pointwiseRegularizer),this.pointwiseConstraint=TV(t.pointwiseConstraint)}build(e){if((e=tV(e)).length<this.rank+2)throw new vj("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new vj("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let s=0;s<this.rank;++s)a.push(1);a.push(n*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new oV({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return vT(()=>{let t;if(e=eV(e),1===this.rank)throw new bj("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=qP(e,[0,2,3,1])),t=lP(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=NQ(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=qP(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=YQ(this.depthwiseInitializer),e.pointwiseInitializer=YQ(this.pointwiseInitializer),e.depthwiseRegularizer=fG(this.depthwiseRegularizer),e.pointwiseRegularizer=fG(this.pointwiseRegularizer),e.depthwiseConstraint=kV(this.depthwiseConstraint),e.pointwiseConstraint=kV(this.pointwiseConstraint),e}}DG.className="SeparableConv";class OG extends DG{constructor(e){super(2,e)}}OG.className="SeparableConv2D",VM(OG);class zG extends FG{constructor(e){super(1,e),zG.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Dj(e.kernelSize,"number",1,1))throw new vj("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}zG.className="Conv1D",VM(zG);class HG extends dV{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return vT(()=>{if(e=eV(e),"channelsLast"===this.dataFormat){const t=yQ(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return yQ(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=yQ(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return yQ(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}HG.className="Cropping2D",VM(HG);class jG extends dV{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Zj(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,Pj(Kj,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return vT(()=>{let t=eV(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=qP(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],a="nearest"===this.interpolation?dO.resizeNearestNeighbor(t,[e,r]):dO.resizeBilinear(t,[e,r]);return qP(a,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?dO.resizeNearestNeighbor(t,[e,r]):dO.resizeBilinear(t,[e,r])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}jG.className="UpSampling2D",VM(jG);class QG extends MG{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=JQ(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=TV(e.depthwiseConstraint),this.depthwiseRegularizer=gG(e.depthwiseRegularizer)}build(e){if((e=tV(e)).length<4)throw new vj("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new vj("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return vT(()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return vT(()=>{null==a&&(a="channelsLast"),Zj(a);let s=NG(e,a);if(4!==e.rank)throw new vj("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new vj("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return s=oL(s,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(s=qP(s,[0,3,1,2])),s})}(e=eV(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=NQ(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=tV(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=CG(t,this.kernelSize[0],this.padding,this.strides[0]),i=CG(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=YQ(this.depthwiseInitializer),e.depthwiseRegularizer=fG(this.depthwiseRegularizer),e.depthwiseConstraint=kV(this.depthwiseRegularizer),e}}function VG(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new vj("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function WG(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return vT(()=>{const l=t.shape.length;if(l<3)throw new vj("Input should be at least 3D, but is ".concat(l,"D."));const c=[1,0].concat(hQ(2,l));if(t=qP(t,c),null!=i)throw new bj("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&(a=BM(BM(a,"bool"),"float32"),a.rank===l-1&&(a=FL(a,-1)),a=qP(a,c)),r&&(t=eP(t,0),null!=a&&(a=eP(a,0)));const u=[];let h,d=n;const A=t.shape[0],p=jP(t);let f,m;null!=a&&(f=jP(a));for(let t=0;t<A;++t){const n=p[t],r=vT(()=>e(n,d));if(null==a)h=r[0],d=r[1];else{const e=vT(()=>{const e=f[t],n=YM(CU(e),e),a=TM(RM(r[0],e),RM(d[0],n)),i=d.map((t,a)=>TM(RM(r[1][a],e),RM(t,n)));return{output:a,newStates:i}});h=e.output,d=e.newStates}o&&u.push(h)}if(o){m=CP(u,1)}return[h,m,d]})}QG.className="DepthwiseConv2D",VM(QG);class GG extends dV{constructor(e){let t;if(super(e),null==e.cell)throw new vj("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new eK({cells:e.cell}):e.cell,null==t.stateSize)throw new vj("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new oV({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return hQ(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null)}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){ZQ(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return vT(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new bj("Constants support is not implemented in RNN yet.");ZQ(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new oV({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let a;if(this.cell.build(r),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!YC(this.stateSpec.map(e=>e.shape[e.shape.length-1]),a))throw new vj("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=a.map(e=>new oV({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];vT(()=>{if(!this.stateful)throw new gj("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new vj("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>pU([n,e])):this.states_=[pU([n,this.cell.stateSize])];else if(null==e)bT(this.states_),null!=this.keptStates&&(bT(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>pU([n,e])):this.states_[0]=pU([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new vj("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):bT(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,i=[n,a];if(!YC(r.shape,i))throw new vj("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(i,", received shape=").concat(r.shape));this.states_[t]=r}}this.states_=this.states_.map(e=>xT(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=VG(e,n,r,this.numConstants);e=a.inputs,n=a.initialState,r=a.constants;let i=[],s=[];if(null!=n){t.initialState=n,i=i.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new oV({shape:e.shape}));s=s.concat(this.stateSpec)}null!=r&&(t.constants=r,i=i.concat(r),this.numConstants=r.length);if(i[0]instanceof lV){const n=[e].concat(i),r=this.inputSpec.concat(s),a=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=a,o}return super.apply(e,t)}call(e,t){return vT(()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let a=null==t?null:t.initialState;e=eV(e),null==a&&(a=this.stateful?this.states_:this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==i)throw new vj("RNN Layer has ".concat(i," state(s) but was passed ")+"".concat(a.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:r},o=WG((e,t)=>{const n=this.cell.call([e].concat(t),s);return[n[0],n.slice(1)]},e,a,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],c=o[1],u=o[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?c:l;return this.returnState?[h].concat(u):h})}getInitialState(e){return vT(()=>{let t=pU(e.shape);return t=BL(t,[1,2]),t=fQ(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?xQ(t,[1,e]):t):this.cell.stateSize>1?[xQ(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===GG.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=QV(t.cell,n);return new e(Object.assign(t,{cell:r}))}}GG.className="RNN",VM(GG);class KG extends dV{}class qG extends KG{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Oj(this.units,"units"),this.activation=uG(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=JQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=JQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=JQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gG(e.kernelRegularizer),this.recurrentRegularizer=gG(e.recurrentRegularizer),this.biasRegularizer=gG(e.biasRegularizer),this.kernelConstraint=TV(e.kernelConstraint),this.recurrentConstraint=TV(e.recurrentConstraint),this.biasConstraint=TV(e.biasConstraint),this.dropout=cQ([1,uQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cQ([1,uQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=tV(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return vT(()=>{if(2!==e.length)throw new vj("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const r=null!=t.training&&t.training;let a;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tK({ones:()=>CU(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tK({ones:()=>CU(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;a=_Q(null!=i?RM(e,i):e,this.kernel.read()),null!=this.bias&&(a=NQ(a,this.bias.read())),null!=s&&(n=RM(n,s));let o=TM(a,_Q(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lG(this.activation),useBias:this.useBias,kernelInitializer:YQ(this.kernelInitializer),recurrentInitializer:YQ(this.recurrentInitializer),biasInitializer:YQ(this.biasInitializer),kernelRegularizer:fG(this.kernelRegularizer),recurrentRegularizer:fG(this.recurrentRegularizer),biasRegularizer:fG(this.biasRegularizer),activityRegularizer:fG(this.activityRegularizer),kernelConstraint:kV(this.kernelConstraint),recurrentConstraint:kV(this.recurrentConstraint),biasConstraint:kV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}qG.className="SimpleRNNCell",VM(qG);class XG extends GG{constructor(e){e.cell=new qG(e),super(e)}call(e,t){return vT(()=>{null!=this.cell.dropoutMask&&(bT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(bT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}}XG.className="SimpleRNN",VM(XG);class YG extends KG{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new vj("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Oj(this.units,"units"),this.activation=uG(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=uG(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=JQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=JQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=JQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gG(e.kernelRegularizer),this.recurrentRegularizer=gG(e.recurrentRegularizer),this.biasRegularizer=gG(e.biasRegularizer),this.kernelConstraint=TV(e.kernelConstraint),this.recurrentConstraint=TV(e.recurrentConstraint),this.biasConstraint=TV(e.biasConstraint),this.dropout=cQ([1,uQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cQ([1,uQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=tV(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return vT(()=>{if(2!==e.length)throw new vj("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tK({ones:()=>CU(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tK({ones:()=>CU(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let s,o,l;0<this.dropout&&this.dropout<1&&(e=RM(e,a[0]));let c=_Q(e,this.kernel.read());this.useBias&&(c=NQ(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=RM(r,i[0]));const u=this.recurrentKernel.read(),[h,d]=xP(u,[2*this.units,this.units],u.rank-1),A=_Q(r,h),[p,f,m]=xP(c,3,c.rank-1),[g,y]=xP(A,2,A.rank-1);s=this.recurrentActivation.apply(TM(p,g)),o=this.recurrentActivation.apply(TM(f,y));const v=_Q(RM(o,r),d);l=this.activation.apply(TM(m,v));const b=TM(RM(s,r),RM(TM(1,ZL(s)),l));return[b,b]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lG(this.activation),recurrentActivation:lG(this.recurrentActivation),useBias:this.useBias,kernelInitializer:YQ(this.kernelInitializer),recurrentInitializer:YQ(this.recurrentInitializer),biasInitializer:YQ(this.biasInitializer),kernelRegularizer:fG(this.kernelRegularizer),recurrentRegularizer:fG(this.recurrentRegularizer),biasRegularizer:fG(this.biasRegularizer),activityRegularizer:fG(this.activityRegularizer),kernelConstraint:kV(this.kernelConstraint),recurrentConstraint:kV(this.recurrentConstraint),biasConstraint:kV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}YG.className="GRUCell",VM(YG);class JG extends GG{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new YG(e),super(e)}call(e,t){return vT(()=>{null!=this.cell.dropoutMask&&(bT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(bT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}JG.className="GRU",VM(JG);class ZG extends KG{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Oj(this.units,"units"),this.activation=uG(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=uG(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=JQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=JQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=JQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=gG(e.kernelRegularizer),this.recurrentRegularizer=gG(e.recurrentRegularizer),this.biasRegularizer=gG(e.biasRegularizer),this.kernelConstraint=TV(e.kernelConstraint),this.recurrentConstraint=TV(e.recurrentConstraint),this.biasConstraint=TV(e.biasConstraint),this.dropout=cQ([1,uQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cQ([1,uQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=tV(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends MQ{apply(t,r){const a=e.apply([n]),i=(new RQ).apply([n]),s=e.apply([2*n]);return bQ(bQ(a,i),s)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return vT(()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new vj("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let r=e[1];const a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tK({ones:()=>CU(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tK({ones:()=>CU(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let o,l,c,u;0<this.dropout&&this.dropout<1&&(e=RM(e,i[0]));let h=_Q(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=RM(r,s[0])),h=TM(h,_Q(r,this.recurrentKernel.read())),this.useBias&&(h=NQ(h,this.bias.read()));const[d,A,p,f]=xP(h,4,h.rank-1);o=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(A),c=TM(RM(l,a),RM(o,this.activation.apply(p))),u=this.recurrentActivation.apply(f);const m=RM(u,this.activation.apply(c));return[m,m,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lG(this.activation),recurrentActivation:lG(this.recurrentActivation),useBias:this.useBias,kernelInitializer:YQ(this.kernelInitializer),recurrentInitializer:YQ(this.recurrentInitializer),biasInitializer:YQ(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:fG(this.kernelRegularizer),recurrentRegularizer:fG(this.recurrentRegularizer),biasRegularizer:fG(this.biasRegularizer),activityRegularizer:fG(this.activityRegularizer),kernelConstraint:kV(this.kernelConstraint),recurrentConstraint:kV(this.recurrentConstraint),biasConstraint:kV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}ZG.className="LSTMCell",VM(ZG);class $G extends GG{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new ZG(e),super(e)}call(e,t){return vT(()=>{null!=this.cell.dropoutMask&&(bT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(bT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}$G.className="LSTM",VM($G);class eK extends KG{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return vT(()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const a=[];let i;for(let s=0;s<this.cells.length;++s){const o=this.cells[s];n=r[s],i=0===s?[e[0]].concat(n):[i[0]].concat(n),i=o.call(i,t),a.push(i.slice(1))}n=[];for(const e of a.slice().reverse())n.push(...e);return[i[0]].concat(n)})}build(e){let t;ZQ(e)&&(e=e[0]),this.cells.forEach((n,r)=>{nQ("RNNCell_".concat(r),()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[];for(const a of t.cells)r.push(QV(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return iV(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,a=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],a[e]])}sV(t)}}function tK(e){const{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:i}=e,s=()=>null!=i?i(t(),n):BQ(t(),n),o=()=>kQ(s,t,r);if(!a||a<=1)return xT(o().clone());return Array(a).fill(void 0).map(o).map(e=>xT(e.clone()))}eK.className="StackedRNNCells",VM(eK);var nK=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class rK extends GG{constructor(e){if(e.unroll)throw new bj("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new bj("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new oV({ndim:5})]}call(e,t){return vT(()=>{if(null!=this.cell.dropoutMask&&(bT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(bT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new vj("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,a=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return vT(()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=pU([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(a):[a]})}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];vT(()=>{if(!this.stateful)throw new gj("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(null==n[0])throw new vj("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>pU(a)):this.states_=[pU(a)];else if(null==e)bT(this.states_),null!=this.keptStates&&(bT(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>pU(a)):this.states_[0]=pU(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new vj("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):bT(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=a;if(!YC(n.shape,r))throw new vj("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(r,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map(e=>xT(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:i,dilationRate:s}=this.cell,o="channelsFirst"===t,l=e[o?3:2],c=e[o?4:3],u=CG(l,r[0],a,i[0],s[0]),h=CG(c,r[1],a,i[1],s[1]);return[...e.slice(0,2),...o?[n,u,h]:[u,h,n]]}}rK.className="ConvRNN2D";class aK extends ZG{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:i,dilationRate:s}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Oj(this.filters,"filters"),this.kernelSize=SG(n,2,"kernelSize"),this.kernelSize.forEach(e=>Oj(e,"kernelSize")),this.strides=SG(r||1,2,"strides"),this.strides.forEach(e=>Oj(e,"strides")),this.padding=a||"valid",$j(this.padding),this.dataFormat=i||"channelsLast",Zj(this.dataFormat),this.dilationRate=SG(s||1,2,"dilationRate"),this.dilationRate.forEach(e=>Oj(e,"dilationRate"))}build(e){var t;e=tV(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new vj("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends MQ{apply(e,t){return vQ([n.apply([r]),fU([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return vT(()=>{if(3!==e.length)throw new vj("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,r=e[0],a=e[1],i=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tK({ones:()=>CU(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=(e,t,n)=>t&&t[n]?RM(t[n],e):e;let l=o(r,s,0),c=o(r,s,1),u=o(r,s,2),h=o(r,s,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tK({ones:()=>CU(a),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let A=o(a,d,0),p=o(a,d,1),f=o(a,d,2),m=o(a,d,3);const[g,y,v,b]=xP(this.kernel.read(),4,3),[x,w,_,S]=this.useBias?xP(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,g,x,this.padding),c=this.inputConv(c,y,w,this.padding),u=this.inputConv(u,v,_,this.padding),h=this.inputConv(h,b,S,this.padding);const[C,E,N,B]=xP(this.recurrentKernel.read(),4,3);A=this.recurrentConv(A,C),p=this.recurrentConv(p,E),f=this.recurrentConv(f,N),m=this.recurrentConv(m,B);const k=this.recurrentActivation.apply(TM(l,A)),I=this.recurrentActivation.apply(TM(c,p)),T=TM(RM(I,i),RM(k,this.activation.apply(TM(u,f)))),M=RM(this.recurrentActivation.apply(TM(h,m)),this.activation.apply(T));return[M,M,T]})}getConfig(){const e=super.getConfig(),{units:t}=e,n=nK(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){const a=qR(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?NQ(a,n,this.dataFormat):a}recurrentConv(e,t){return qR(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}aK.className="ConvLSTM2DCell",VM(aK);class iK extends rK{constructor(e){const t=new aK(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}iK.className="ConvLSTM2D",VM(iK);class sK extends dV{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return kQ(()=>BQ(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}sK.className="Dropout",VM(sK);class oK extends sK{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}oK.className="SpatialDropout1D",VM(oK);class lK extends dV{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Oj(this.units,"units"),this.activation=uG(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=JQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=JQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=TV(e.kernelConstraint),this.biasConstraint=TV(e.biasConstraint),this.kernelRegularizer=gG(e.kernelRegularizer),this.biasRegularizer=gG(e.biasRegularizer),this.activityRegularizer=gG(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=tV(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=tV(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e),r=Hj(this.activation.getClassName());let a;return null!=r?a=_Q(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=_Q(n,this.kernel.read()),null!=this.bias&&(a=NQ(a,this.bias.read())),null!=this.activation&&(a=this.activation.apply(a))),a})}getConfig(){const e={units:this.units,activation:lG(this.activation),useBias:this.useBias,kernelInitializer:YQ(this.kernelInitializer),biasInitializer:YQ(this.biasInitializer),kernelRegularizer:fG(this.kernelRegularizer),biasRegularizer:fG(this.biasRegularizer),activityRegularizer:fG(this.activityRegularizer),kernelConstraint:kV(this.kernelConstraint),biasConstraint:kV(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}lK.className="Dense",VM(lK);class cK extends dV{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=tV(e);for(const t of e.slice(1))if(null==t)throw new vj('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],lQ(e,1)]}call(e,t){return vT(()=>{this.invokeCallHook(e,t);let n=eV(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=qP(n,e)}return function(e){if(e.rank<=1)throw new vj("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],lQ(e.shape,1)];return SR(e,t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}cK.className="Flatten",VM(cK);class uK extends dV{constructor(e){super(e),this.supportsMasking=!0,this.activation=uG(e.activation)}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e);return this.activation.apply(n)})}getConfig(){const e={activation:lG(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}uK.className="Activation",VM(uK);class hK extends dV{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return vT(()=>function(e,t){return vT(()=>{if(2!==e.shape.length)throw new vj("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return xQ(fQ(e,1),[1,t,1])})}(e=eV(e),this.n))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}hK.className="RepeatVector",VM(hK);class dK extends dV{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let a=1,i=null;for(let o=0;o<r.length;++o){const e=r[o];if(this.isUnknown(e)){if(null!==i)throw new vj("Can only specifiy one unknown dimension.");i=o}else a*=e}const s=lQ(e);if(null!==i){if(0===a||s%a!==0)throw new vj(n);r[i]=s/a}else if(s!==a)throw new vj(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return SR(n,a)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}dK.className="Reshape",VM(dK);class AK extends dV{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=hQ(1,e.dims.length+1);if(!YC(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new oV({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=tV(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return qP(eV(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}AK.className="Permute",VM(AK);class pK extends dV{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=eV(e);return tR(_U(n,this.maskValue),-1)}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e),r=tR(_U(n,this.maskValue),-1,!0);return RM(n,BM(r,n.dtype))})}}pK.className="Masking",VM(pK);class fK extends dV{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Nj(e.inputLength))}this.inputDim=e.inputDim,Oj(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Oj(this.outputDim,"outputDim"),this.embeddingsInitializer=JQ(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=gG(e.embeddingsRegularizer),this.activityRegularizer=gG(e.activityRegularizer),this.embeddingsConstraint=TV(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return vT(()=>this.maskZero?(e=eV(e),_U(e,PM(e))):null)}computeOutputShape(e){if(e=tV(e),null==this.inputLength)return[...e,this.outputDim];const t=Nj(this.inputLength);if(t.length!==e.length-1)throw new vj('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let r=0;r<t.length;++r){const a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new vj('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}}return[e[0],...t,this.outputDim]}call(e,t){return vT(()=>{this.invokeCallHook(e,t);let n=eV(e);"int32"!==n.dtype&&(n=pQ(n,"int32"));const r=SQ(this.embeddings.read(),SR(n,[n.size]));return SR(r,tV(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:YQ(this.embeddingsInitializer),embeddingsRegularizer:fG(this.embeddingsRegularizer),activityRegularizer:fG(this.activityRegularizer),embeddingsConstraint:kV(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}fK.className="Embedding",VM(fK);class mK extends dV{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new bj}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new vj("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[tV(e)]),e.length<2)throw new vj("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const a of e)null!=a&&null!==a[0]&&t.push(a[0]);if(t=Lj(t),t.length>1)throw new vj("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let a=1;a<e.length;++a){const t=null==e[a]?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map(e=>e.length);-1===e.indexOf(null)&&1===Lj(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return vT(()=>{if(this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const r=uQ(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=fQ(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const i of e){const e=i.rank;if(null==e){const e=i.shape,r=e[0],a=e.slice(1).concat([r]);let s=SR(i,[r].concat(lQ(e.slice(1))));s=qP(s,[1,0]),s=SR(s,a),t.push(s),n=!0}else if(e>1){const r=hQ(1,e).concat([0]);t.push(qP(i,r)),n=!0}else t.push(i)}let r=this.mergeFunction(t);const a=r.rank;if(n)if(null==a){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=SR(qP(SR(r,[-1,t]),[1,0]),n)}else if(a>1){const e=[a-1].concat(hQ(0,a-1));r=qP(r,e)}return r}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=Lj(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return vT(()=>{if(null==t)return null;if(!Array.isArray(t))throw new vj("`mask` should be an Array");if(!Array.isArray(e))throw new vj("`inputs` should be an Array");if(t.length!==e.length)throw new vj("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every(e=>null==e))return null;t=t.map(e=>null==e?e:FL(e,0));let n=t[0];for(let e=1;e<t.length-1;++e)n=rU(n,t[e]);return n})}}class gK extends mK{constructor(e){super(e)}mergeFunction(e){return vT(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=TM(t,e[n]);return t})}}gK.className="Add",VM(gK);class yK extends mK{constructor(e){super(e)}mergeFunction(e){return vT(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=RM(t,e[n]);return t})}}yK.className="Multiply",VM(yK);class vK extends mK{constructor(e){super(e)}mergeFunction(e){return vT(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=TM(t,e[n]);return RM(1/e.length,t)})}}vK.className="Average",VM(vK);class bK extends mK{constructor(e){super(e)}mergeFunction(e){return vT(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=nF(t,e[n]);return t})}}bK.className="Maximum",VM(bK);class xK extends mK{constructor(e){super(e)}mergeFunction(e){return vT(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=gU(t,e[n]);return t})}}xK.className="Minimum",VM(xK);class wK extends mK{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new vj("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let a=!1;for(const e of n)if(YC(e,t)){a=!0;break}a||n.push(t)}if(n.length>1)throw new vj("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return vT(()=>vQ(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new vj("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const a of t.slice(1)){if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new vj("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new vj("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new vj("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return vT(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const r=[];for(let i=0;i<e.length;++i)null==t[i]?r.push(BM(CU(e[i]),"bool")):t[i].rank<e[i].rank?r.push(FL(t[i],-1)):r.push(t[i]);const a=NR(r,this.axis);return eR(a,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function _K(e,t){for(;e<0;)e+=t;return e}wK.className="Concatenate",VM(wK);class SK extends mK{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){GC(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new bj("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new vj("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}mergeFunction(e){if(2!==e.length)throw new vj("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>_K(t,e[n].shape.length)):[_K(this.axes,n.shape.length),_K(this.axes,r.shape.length)],this.normalize&&(n=VV(n,t[0]),r=VV(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new bj("batchDot is not implemented for tensors of 4D or higher rank yet");if(GC(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)),GC(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new bj("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);const i=n;return vT(()=>{let n,s;if(r>a){n=r-a;const e=[];for(let t=0;t<n;++t)e.push(1);t=SR(t,t.shape.concat(e))}else if(a>r){n=a-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=SR(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=i[0]===i[1]?BL(RM(e,t),i[0]):BL(RM(qP(e,[1,0]),t),i[1]);else{const n=i[0]!==e.shape.length-1,r=i[1]===t.shape.length-1;s=BR(e,t,n,r)}if(n>0){let e;e=r>a?r+a-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);s=SP(s,t)}return 1===s.shape.length&&(s=FL(s,1)),s})}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[_K(this.axes,e.length),_K(this.axes,t.length)],n}computeOutputShape(e){GC(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new bj("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const a=t.concat(n);return 1===a.length&&a.push(1),a}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}SK.className="Dot",VM(SK);class CK extends dV{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e);return kQ(()=>TM(wQ(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}CK.className="GaussianNoise",VM(CK);class EK extends dV{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return vT(()=>{this.invokeCallHook(e,t);const n=eV(e);if(this.rate>0&&this.rate<1){return kQ(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return RM(n,wQ(n.shape,1,e))},()=>n,t.training||!1)}return n})}}EK.className="GaussianDropout",VM(EK);class NK extends dV{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||eV(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return vT(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),r=()=>{const t=eV(e),r=-1.7580993408473766;let a=zL(KU(n),this.rate);a=pQ(a,"float32");const i=((1-this.rate)*(1+this.rate*r**2))**-.5,s=-i*r*this.rate,o=TM(RM(t,a),RM(TM(a,-1),r));return TM(RM(o,i),s)};return kQ(r,()=>eV(e),t.training||!1)}return e})}}function BK(e,t,n,r,a){let i,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=LR(e,t,n,r,a,s);else if(3===e.rank)i=UR(e,t,n,r,a,s);else{if(4!==e.rank)throw new bj("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=PR(e,t,n,r,a,s)}return i}function kK(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return YC(r.slice().sort(),hQ(0,e.rank-1))?function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return vT(()=>{const i=bU(e,r),s=i.mean,o=i.variance;return[BK(e,s,o,n,t,a),s,o]})}(e,t,n,r,a):function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return vT(()=>{const i=bU(e,r),s=i.mean,o=i.variance,l=[];for(const t of hQ(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=SR(s,l),u=SR(o,l),h=null==t?null:SR(t,l),d=null==n?null:SR(n,l);return[BK(e,c,u,d,h,a),s,o]})}(e,t,n,r,a)}NK.className="AlphaDropout",VM(NK);class IK extends dV{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=JQ(e.betaInitializer||"zeros"),this.gammaInitializer=JQ(e.gammaInitializer||"ones"),this.movingMeanInitializer=JQ(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=JQ(e.movingVarianceInitializer||"ones"),this.betaConstraint=TV(e.betaConstraint),this.gammaConstraint=TV(e.gammaConstraint),this.betaRegularizer=gG(e.betaRegularizer),this.gammaRegularizer=gG(e.gammaRegularizer)}build(e){e=tV(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new vj("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new oV({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return vT(()=>{const n=null!=t.training&&t.training,r=eV(e),a=r.shape,i=a.length,s=hQ(0,i),o=this.axis>=0?this.axis:this.axis+i;s.splice(o,1);const l=_j(1,i);l[o]=a[o];const c=s.slice();c.sort();const u=!YC(c,hQ(0,i).slice(0,i-1));if(!n)return(()=>{if(u){const e=SR(this.movingMean.read(),l),t=SR(this.movingVariance.read(),l),n=this.center?SR(this.beta.read(),l):null,a=this.scale?SR(this.gamma.read(),l):null;return BK(r,e,t,n,a,this.epsilon)}return BK(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,A]=kK(r,this.gamma.read(),this.beta.read(),s,this.epsilon),p=(e,t,n)=>{vT(()=>{const r=1-n,a=e.read(),i=RM(YM(a,t),r);e.write(YM(a,i))})};return(()=>{p(this.movingMean,d,this.momentum),p(this.movingVariance,A,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:YQ(this.betaInitializer),gammaInitializer:YQ(this.gammaInitializer),movingMeanInitializer:YQ(this.movingMeanInitializer),movingVarianceInitializer:YQ(this.movingVarianceInitializer),betaRegularizer:fG(this.betaRegularizer),gammaRegularizer:fG(this.gammaRegularizer),betaConstraint:kV(this.betaConstraint),gammaConstraint:kV(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}IK.className="BatchNormalization",VM(IK);class TK extends dV{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=JQ(e.betaInitializer||"zeros"),this.gammaInitializer=JQ(e.gammaInitializer||"ones"),this.betaRegularizer=gG(e.betaRegularizer),this.gammaRegularizer=gG(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=tV(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(const a of this.axis)if(a<0||a>=t)throw new Error("Invalid axis: ".concat(a));if(this.axis.length!==Lj(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map(t=>e[t]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const n=eV(e),r=n.shape,a=r.length;return vT(()=>{let{mean:e,variance:t}=bU(n,this.axis,!0);const i=_j(1,a);for(const n of this.axis)i[n]=r[n];const s=e=>null!=e&&e.shape.length!==a?SR(e,i):e;let o=this.scale?s(this.gamma.read()):null,l=this.center?s(this.beta.read()):null;const c=[],u=[];for(let n=0;n<a;++n)-1!==this.axis.indexOf(n)?(c.push(r[n]),u.push(1)):(c.push(1),u.push(r[n]));return e=LL(e,c),t=LL(t,c),null!=o&&(o=LL(o,u)),null!=l&&(l=LL(l,u)),BK(n,e,t,l,o,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:YQ(this.betaInitializer),gammaInitializer:YQ(this.gammaInitializer),betaRegularizer:fG(this.betaRegularizer),gammaRegularizer:fG(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}TK.className="LayerNormalization",VM(TK);class MK extends dV{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new vj("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new vj("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new vj("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new oV({ndim:4})]}computeOutputShape(e){let t,n;return e=tV(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return vT(()=>function(e,t,n){return vT(()=>{if(4!==e.rank)throw new vj("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new vj("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new vj("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],NU(e,r)})}(eV(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function FK(e,t,n,r,a,i){return vT(()=>{let s;Zj(a),eQ(i),$j(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=NG(e,a);const o="same"===r?"same":"valid";return s="max"===i?uU(e,t,n,o):CR(e,t,n,o),"channelsFirst"===a&&(s=qP(s,[0,3,1,2])),s})}function RK(e,t,n,r,a,i){return vT(()=>{let s;Zj(a),eQ(i),$j(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=BG(e,a);const o="same"===r?"same":"valid";return s="max"===i?hU(e,t,n,o):ER(e,t,n,o),"channelsFirst"===a&&(s=qP(s,[0,4,1,2,3])),s})}MK.className="ZeroPadding2D",VM(MK);class LK extends dV{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new vj("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(Oj(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new vj("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}Oj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,$j(this.padding),this.inputSpec=[new oV({ndim:3})]}computeOutputShape(e){const t=CG((e=tV(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return vT(()=>{this.invokeCallHook(e,t),e=fQ(eV(e),2);const n=this.poolingFunction(eV(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return SP(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class UK extends LK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),FK(e,t,n,r,a,"max")}}UK.className="MaxPooling1D",VM(UK);class PK extends LK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),FK(e,t,n,r,a,"avg")}}PK.className="AveragePooling1D",VM(PK);class DK extends dV{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new vj("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];Oj(this.poolSize,"poolSize"),Oj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Zj(this.dataFormat),$j(this.padding),this.inputSpec=[new oV({ndim:4})]}computeOutputShape(e){e=tV(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=CG(t,this.poolSize[0],this.padding,this.strides[0]),n=CG(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return vT(()=>(this.invokeCallHook(e,t),this.poolingFunction(eV(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class OK extends DK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),FK(e,t,n,r,a,"max")}}OK.className="MaxPooling2D",VM(OK);class zK extends DK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),FK(e,t,n,r,a,"avg")}}zK.className="AveragePooling2D",VM(zK);class HK extends dV{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new vj("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Oj(this.poolSize,"poolSize"),Oj(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Zj(this.dataFormat),$j(this.padding),this.inputSpec=[new oV({ndim:5})]}computeOutputShape(e){e=tV(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=CG(t,this.poolSize[0],this.padding,this.strides[0]),n=CG(n,this.poolSize[1],this.padding,this.strides[1]),r=CG(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return vT(()=>(this.invokeCallHook(e,t),this.poolingFunction(eV(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class jK extends HK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),RK(e,t,n,r,a,"max")}}jK.className="MaxPooling3D",VM(jK);class QK extends HK{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Zj(a),$j(r),RK(e,t,n,r,a,"avg")}}QK.className="AveragePooling3D",VM(QK);class VK extends dV{constructor(e){super(e),this.inputSpec=[new oV({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new bj}}class WK extends VK{constructor(e){super(e||{})}call(e,t){return vT(()=>{const t=eV(e);return AU(t,1)})}}WK.className="GlobalAveragePooling1D",VM(WK);class GK extends VK{constructor(e){super(e||{})}call(e,t){return vT(()=>{const t=eV(e);return EL(t,1)})}}GK.className="GlobalMaxPooling1D",VM(GK);class KK extends dV{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Zj(this.dataFormat),this.inputSpec=[new oV({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new bj}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class qK extends KK{call(e,t){return vT(()=>{const t=eV(e);return"channelsLast"===this.dataFormat?AU(t,[1,2]):AU(t,[2,3])})}}qK.className="GlobalAveragePooling2D",VM(qK);class XK extends KK{call(e,t){return vT(()=>{const t=eV(e);return"channelsLast"===this.dataFormat?EL(t,[1,2]):EL(t,[2,3])})}}XK.className="GlobalMaxPooling2D",VM(XK);class YK extends dV{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=QV(t.layer,n);delete t.layer;const a={layer:r};return Object.assign(a,t),new e(a)}}class JK extends YK{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=tV(e)).length<3)throw new vj("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=tV(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return vT(()=>WG((e,n)=>[eV(this.layer.call(e,t)),[]],e=eV(e),[],!1,null,null,!1,!0)[1])}}JK.className="TimeDistributed",VM(JK);class ZK extends YK{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=QV(n),t.goBackwards=!0!==t.goBackwards;const r={};var a;if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=QV(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,a=this.mergeMode,Pj(Yj,"BidirectionalMergeMode",a),e.weights)throw new bj("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):Ej(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const a=VG(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const i=[],s=[];if(null!=n){const e=n.length;if(e%2>0)throw new vj("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,i.push(...n);const r=n.map(e=>new oV({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),s.push(...r)}if(null!=r)throw new bj("Support for constants in Bidirectional layers is not implemented yet.");const o=i[0]instanceof lV;for(const l of i)if(l instanceof lV!==o)throw new vj("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(i),r=this.inputSpec.concat(s),a=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=a,o}return super.apply(e,t)}call(e,t){return vT(()=>{const n=t.initialState;let r,a,i,s;if(null==n)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{const i=n.slice(0,n.length/2),s=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=eP(a,1)),"concat"===this.mergeMode?s=vQ([r,a]):"sum"===this.mergeMode?s=TM(r,a):"ave"===this.mergeMode?s=RM(.5,TM(r,a)):"mul"===this.mergeMode?s=RM(r,a):null==this.mergeMode&&(s=[r,a]),this.returnState?null==this.mergeMode?s.concat(i):[s].concat(i):s})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){nQ(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),nQ(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=QV(t.layer);if(delete t.layer,null!=t.numConstants)throw new bj("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}ZK.className="Bidirectional",VM(ZK);class $K extends dV{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return vT(()=>("float32"!==(e=eV(e)).dtype&&(e=pQ(e,"float32")),TM(RM(e,this.scale),this.offset)))}}$K.className="Rescaling",VM($K);const{resizeBilinear:eq,cropAndResize:tq}=dO;class nq extends dV{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,i,s,o){return vT(()=>{let l,c=!1;const u=[t/i,n/s,(r+t)/i,(a+n)/s],h=[];3===e.rank?(c=!0,l=CP([e])):l=e;for(let e=0;e<l.shape[0];e++)h.push(u);const d=pT(h,[h.length,4]),A=XU(0,h.length,1,"int32"),p=tq(l,d,A,[r,a],"nearest");return pQ(c?eV(jP(p)):p,o)})}upsize(e,t,n,r){return vT(()=>pQ(eq(e,[t,n]),r))}call(e,t){return vT(()=>{const t=eV(e),n=t.dtype,r=t.shape,a=r[r.length-3],i=r[r.length-2];let s=0;a!==this.height&&(s=Math.floor((a-this.height)/2));let o=0;return i!==this.width&&(o=Math.floor((i-this.width)/2),0===o&&(o=1)),s>=0&&o>=0?this.centerCrop(t,s,o,this.height,this.width,a,i,n):this.upsize(e,this.height,this.width,n)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=tV(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}nq.className="CenterCrop",VM(nq);class rq extends dV{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=tV(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return vT(()=>{let n;if("int32"!==(e=eV(e)).dtype&&(e=pQ(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==this.outputMode)throw new vj("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=eV(t.countWeights)}const r=EL(e),a=NL(e),i=OL(this.numTokens,r).bufferSync().get(0),s=zL(a,0).bufferSync().get(0);if(!i||!s)throw new vj("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,r){let a=eV(e);if("int32"!==a.dtype&&(a=pQ(a,"int32")),"int"===t)return a;const i=a.shape;if(0===a.rank&&(a=FL(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=FL(a,-1)),a.rank>2)throw new vj("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));const s=["multiHot","oneHot"].includes(t),o=a;let l;if(l=iL(o,"undefined"!==typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return l;if(r)return RM(l,r);throw new vj("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)})}}rq.className="CategoryEncoding",VM(rq);const aq=new Set(["bilinear","nearest"]);class iq extends dV{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!aq.has(e.interpolation))throw new vj("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=tV(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return vT(()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return dO.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return dO.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...aq]," are supported"))})}}iq.className="Resizing",VM(iq);class sq{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}sq.className="RandomSeed";class oq extends dV{constructor(e){super(e),this.randomGenerator=new sq(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}oq.className="BaseRandomLayer";const lq=new Set(["bilinear","nearest"]);class cq extends oq{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new vj("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new vj("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new vj("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!lq.has(n))throw new vj("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=tV(e))[2];return[this.imgHeight,-1,t]}call(e,t){return vT(()=>{const t=eV(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=KU([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const a=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return dO.resizeBilinear(e,a);case"nearest":return dO.resizeNearestNeighbor(e,a);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...lq]," are supported"))}})}}cq.className="RandomWidth",VM(cq);var uq,hq;EE().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(uq||(uq={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(hq||(hq={}));const dq={};function Aq(e){return dq[e]}function pq(e,t,n,r,a){const i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){const e=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?e+1:i.inputIndexEnd,o=e<0?t.inputNames.length+e:e;if("tensor"===i.type)return fq(t.inputNames[o],n,r,a);if("tensors"===i.type){const i=t.inputs.slice(e,s),o=t.inputNames.slice(e,s).filter((e,t)=>{var n;return"NoOp"!==(null===(n=i[t])||void 0===n?void 0:n.op)});return o.map(e=>fq(e,n,r,a))}const l=fq(t.inputNames[o],n,r,a),c=l.dataSync();return"number"===i.type?c[0]:fE(l.shape,c)}const s=t.attrParams[e];return s&&s.value}function fq(e,t,n,r){const[a,i]=vq(e,n);if(null!=r){const e=r.getHashTableHandleByName(a);if(null!=e)return e}const s=n.currentContextIds.find(e=>!!t[yq(a,e)]);return void 0!==s?t[yq(a,s)][i]:void 0}function mq(e,t,n){return t[yq(e,n.currentContextId)]}function gq(e,t){const[n,r,a]=vq(e,t);return[yq(n,t&&t.currentContextId),r,a]}function yq(e,t){return t?"".concat(e,"-").concat(t):e}function vq(e,t){if(""===e)return["",0,void 0];const n=null!=t&&null!=t.parseNodeNameCache;if(n){const n=t.parseNodeNameCache.get(e);if(null!=n)return n}const r=e.split(":");let a;if(1===r.length)a=[e,0,void 0];else{const e=r[0],t=3===r.length?r[1]:void 0;a=[e,Number(r[r.length-1]),t]}return n&&t.parseNodeNameCache.set(e,a),a}function bq(e,t,n){let r=pq("pad",e,t,n);if("explicit"===r){r=pq("explicitPaddings",e,t,n);const a=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)a[e][0]=r[2*e],a[e][1]=r[2*e+1];return a}return r}function xq(e){return e.kept?e:kM(e)}const wq=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],_q=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Sq=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Cq=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Eq=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Nq=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Bq=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],kq=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Iq=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Tq=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Mq=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Fq=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Rq=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Lq=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Uq=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Pq=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Dq=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Oq=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],zq=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];class Hq{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[o,l,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S,C].map(e=>e.json));this.opMappers=e.reduce((e,t)=>(e[t.tfOpName]=t,e),{})}transformGraph(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.node,r=[],a=[],i=[],s=n.reduce((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?a.push(e[t.name]):null!=t.input&&0!==t.input.length||i.push(e[t.name]),e),{});let o=[];const l=[];let c={},u={};null!=t&&(c=this.mapSignatureEntries(t.inputs),u=this.mapSignatureEntries(t.outputs));const h=Object.keys(s);h.forEach(e=>{const t=s[e];t.inputNames.forEach((e,n)=>{const[r,,a]=gq(e),i=s[r];if(null!=i.outputs){const e=i.outputs.indexOf(a);if(-1!==e){const a="".concat(r,":").concat(e);t.inputNames[n]=a}}t.inputs.push(i),i.children.push(t)})}),0===Object.keys(u).length?h.forEach(e=>{const t=s[e];0===t.children.length&&l.push(t)}):Object.keys(u).forEach(e=>{const[t]=gq(e),n=s[t];null!=n&&(n.signatureKey=u[e],l.push(n))}),Object.keys(c).length>0?Object.keys(c).forEach(e=>{const[t]=gq(e),n=s[t];n&&(n.signatureKey=c[e],o.push(n))}):o=r;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((e,t)=>(e[t.signature.name]=this.mapFunction(t),e),{}));const A={nodes:s,inputs:o,outputs:l,weights:a,placeholders:r,signature:t,functions:d};return i.length>0&&(A.initNodes=i),A}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){const t=Aq(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(e=>e.startsWith("^")?e.slice(1):e),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((t,n)=>{const r=n.type;let a;switch(n.type){case"string":a=Qq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Qq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":a=$q(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=$q(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":a=Wq(e.attr,n.tfName,n.defaultValue||0),void 0===a&&n.tfDeprecatedName&&(a=Wq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":a=Zq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Zq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":a=Vq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Vq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":a=tX(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=tX(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":a=Jq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Jq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":a=eX(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=eX(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":a=qq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=qq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":a=Xq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Xq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":a=Kq(e.attr,n.tfName,n.defaultValue),void 0===a&&n.tfDeprecatedName&&(a=Kq(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t},{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e),{}));const a=[],i=[];e.signature.inputArg.forEach(e=>{const[t]=gq(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Gq(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,a.push(n),r[t]=n});Object.keys(r).forEach(e=>{const t=r[e];t.inputNames.forEach((e,n)=>{const[a,,i]=gq(e),s=r[a];if(null!=s.outputs){const e=s.outputs.indexOf(i);if(-1!==e){const r="".concat(a,":").concat(e);t.inputNames[n]=r}}t.inputs.push(s),s.children.push(t)})});const s=e.ret;e.signature.outputArg.forEach(e=>{const[t,n]=gq(s[e.name]),a=r[t];null!=a&&(a.defaultOutput=n,i.push(a))});const o=this.mapArgsToSignature(e);return{nodes:r,inputs:a,outputs:i,weights:n,placeholders:[],signature:o}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function jq(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=EE().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function Qq(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=e[t];return null!=a?jq(a.s,r):n}function Vq(e,t,n){const r=e[t];return r?r.b:n}function Wq(e,t,n){const r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function Gq(e){switch("string"===typeof e&&(e=uq[e]),e){case uq.DT_FLOAT:case uq.DT_HALF:return"float32";case uq.DT_INT32:case uq.DT_INT64:case uq.DT_INT8:case uq.DT_UINT8:return"int32";case uq.DT_BOOL:return"bool";case uq.DT_DOUBLE:return"float32";case uq.DT_STRING:return"string";case uq.DT_COMPLEX64:case uq.DT_COMPLEX128:return"complex64";default:return null}}function Kq(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function qq(e,t,n){const r=e[t];return r&&r.type?Gq(r.type):n}function Xq(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map(e=>Gq(e)):n}function Yq(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(e=>"number"===typeof e.size?e.size:parseInt(e.size,10)):[]}function Jq(e,t,n){const r=e[t];return r&&r.shape?Yq(r.shape):n}function Zq(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(e=>"number"===typeof e?e:parseInt(e,10)):n}function $q(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=e[t];return a&&a.list&&a.list.s?a.list.s.map(e=>jq(e,r)):n}function eX(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(e=>Yq(e)):n}function tX(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class nX{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(e=>this.getInput(e)),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((e,t)=>(e[t]=this.getAttr(t),e),{}))}getInput(e){return fq(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return fq(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Wq(this.node.rawAttrs,e,t);if(null!=n.s)return Qq(this.node.rawAttrs,e,t);if(null!=n.b)return Vq(this.node.rawAttrs,e,t);if(null!=n.shape)return Jq(this.node.rawAttrs,e,t);if(null!=n.type)return qq(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Zq(this.node.rawAttrs,e,t);if(null!=n.list.s)return $q(this.node.rawAttrs,e,t);if(null!=n.list.shape)return eX(this.node.rawAttrs,e,t);if(null!=n.list.b)return tX(this.node.rawAttrs,e,t);if(null!=n.list.type)return Xq(this.node.rawAttrs,e,t)}return t}}function rX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){GC(e.length===t.length,()=>n+" Shapes ".concat(e," and ").concat(t," must match"));for(let r=0;r<e.length;r++){const a=e[r],i=t[r];GC(a<0||i<0||a===i,()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}}}function aX(e){return"number"!==typeof e&&!e.some(e=>e<0)}function iX(e,t,n){let r=sX(e,n);const a=!aX(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach(e=>{r=sX(e.shape,r)}),!aX(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function sX(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));const n=[];for(let r=0;r<e.length;++r){const a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}class oX{constructor(e,t,n,r,a,i,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=i,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=OM(0),xT(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));const t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(e=>this.read(e))}write(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),rX(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,xT(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((e,n)=>this.write(e,t[n]))}gather(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return pT([],[0].concat(this.elementShape));const n=this.readMany(e);return rX(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),CP(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return pT([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const n=this.readMany(t);return rX(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(n[0].shape,")")),NR(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,jP(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));let n=0;const r=e.map(e=>(n+=e,n));if(n!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(n,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");const a=0===n?0:t.size/n,i=[];vT(()=>{t=SR(t,[1,n,a]);for(let n=0;n<e.length;++n){const s=[0,0===n?0:r[n-1],0],o=[1,e[n],a];i[n]=SR(IR(t,s,o),this.elementShape)}return i});const s=[];for(let o=0;o<e.length;o++)s[o]=o;this.writeMany(s,i)}}class lX{get id(){return this.idTensor.id}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach(e=>{if(n!==e.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(e.dtype));rX(t,e.shape,"TensorList shape mismatch: "),xT(e)}),this.idTensor=OM(0),this.maxNumElements=r,xT(this.idTensor)}copy(){return new lX([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==n&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));rX(e,this.elementShape,"TensorList shape mismatch: ");const r=iX(this.elementShape,this.tensors,e);return vT(()=>{const e=this.tensors.map(e=>SR(e,r));return CP(e,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=iX(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,rX(r.shape,e,"TensorList shape mismatch: "),SR(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(rX(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");xT(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));const t=new lX([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));rX(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=iX(this.elementShape,this.tensors,t);return SR(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));rX(this.elementShape,t.shape,"TensorList shape mismatch: "),xT(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));rX(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=iX(this.elementShape,this.tensors,n);return 0===e.length?pT([],[0].concat(r)):vT(()=>{const t=e.map(e=>SR(this.tensors[e],r));return CP(t,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));rX(this.elementShape,t,"TensorList shape mismatch: ");const n=iX(this.elementShape,this.tensors,t);return 0===this.size()?pT([],[0].concat(n)):vT(()=>{const e=this.tensors.map(e=>SR(e,n));return NR(e,0)})}}const cX=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=pq("thenBranch",e,t,n),a=pq("elseBranch",e,t,n),i=pq("cond",e,t,n),s=pq("args",e,t,n);return(await i.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=pq("body",e,t,n),a=pq("cond",e,t,n),i=pq("args",e,t,n),s=await n.functionMap[a].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),o=i.map(e=>e.id);let l=await s[0].data();s.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||e.dispose()});let c=i;for(;l[0];){const e=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const t=c.map(e=>e.id);e.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()});const i=await n.functionMap[a].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await i[0].data(),i.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()})}return c}case"LoopCond":return[xq(pq("pred",e,t,n))];case"Switch":{const r=pq("pred",e,t,n);let a=pq("data",e,t,n);return a.kept||(a=xq(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{const r=e.inputNames.find(e=>void 0!==fq(e,t,n));if(r){return[xq(fq(r,t,n))]}return}case"Enter":{const r=pq("frameName",e,t,n),a=pq("tensor",e,t,n);return n.enterFrame(r),[xq(a)]}case"Exit":{const r=pq("tensor",e,t,n);return n.exitFrame(),[xq(r)]}case"NextIteration":{const r=pq("tensor",e,t,n);return n.nextIteration(),[xq(r)]}case"TensorArrayV3":{const r=pq("size",e,t,n),a=pq("dtype",e,t,n),i=pq("elementShape",e,t,n),s=pq("dynamicSize",e,t,n),o=pq("clearAfterRead",e,t,n),l=pq("identicalElementShapes",e,t,n),c=pq("name",e,t,n),u=new oX(c,a,r,i,l,s,o);return n.addTensorArray(u),[u.idTensor,OM(1)]}case"TensorArrayWriteV3":{const r=pq("tensorArrayId",e,t,n),a=pq("index",e,t,n),i=pq("tensor",e,t,n),s=n.getTensorArray(r.id);return s.write(a,i),[s.idTensor]}case"TensorArrayReadV3":{const r=pq("tensorArrayId",e,t,n),a=pq("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{const r=pq("tensorArrayId",e,t,n),a=pq("indices",e,t,n),i=pq("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,i)]}case"TensorArrayScatterV3":{const r=pq("tensorArrayId",e,t,n),a=pq("indices",e,t,n),i=pq("tensor",e,t,n),s=n.getTensorArray(r.id);return s.scatter(a,i),[s.idTensor]}case"TensorArrayConcatV3":{const r=pq("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),i=pq("dtype",e,t,n);return[a.concat(i)]}case"TensorArraySplitV3":{const r=pq("tensorArrayId",e,t,n),a=pq("tensor",e,t,n),i=pq("lengths",e,t,n),s=n.getTensorArray(r.id);return s.split(i,a),[s.idTensor]}case"TensorArraySizeV3":{const r=pq("tensorArrayId",e,t,n);return[OM(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=pq("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{const r=pq("tensorListId",e,t,n),a=pq("index",e,t,n),i=pq("tensor",e,t,n),s=n.getTensorList(r.id);return s.setItem(a,i),[s.idTensor]}case"TensorListGetItem":{const r=pq("tensorListId",e,t,n),a=pq("index",e,t,n),i=pq("elementShape",e,t,n),s=pq("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,i,s)]}case"TensorListScatterV2":case"TensorListScatter":{const r=pq("indices",e,t,n),a=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));const a=Math.max(...t);if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));const i=new lX([],n,e.dtype,r),s=jP(e,0);return t.forEach((e,t)=>{i.setItem(e,s[t])}),i}(pq("tensor",e,t,n),r,pq("elementShape",e,t,n),pq("numElements",e,t,n));return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=pq("elementShape",e,t,n),a=pq("elementDType",e,t,n);let i;i="TensorListReserve"===e.op?"numElements":"maxNumElements";const s=pq(i,e,t,n),o=function(e,t,n,r){return new lX([],e,t,r)}(r,a,0,"TensorListReserve"===e.op?-1:s);return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=pq("tensorListId",e,t,n),a=pq("indices",e,t,n),i=pq("elementShape",e,t,n),s=pq("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,s,i)]}case"TensorListStack":{const r=pq("tensorListId",e,t,n),a=pq("elementShape",e,t,n),i=pq("elementDType",e,t,n),s=pq("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,i,s)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));rX(e.shape.slice(1),t,"TensorList shape mismatch: ");const a=jP(e);return new lX(a,t,r)}(pq("tensor",e,t,n),pq("elementShape",e,t,n),pq("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=pq("tensorListId",e,t,n),a=n.getTensorList(r.id),i=pq("dtype",e,t,n),s=pq("elementShape",e,t,n);return[a.concat(i,s)]}case"TensorListPushBack":{const r=pq("tensorListId",e,t,n),a=pq("tensor",e,t,n),i=n.getTensorList(r.id);return i.pushBack(a),[i.idTensor]}case"TensorListPopBack":{const r=pq("tensorListId",e,t,n),a=pq("elementShape",e,t,n),i=pq("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,i)]}case"TensorListSplit":{const r=pq("tensor",e,t,n),a=pq("elementShape",e,t,n),i=function(e,t,n){let r=0;const a=t.map(e=>(r+=e,r));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));const i=sX(e.shape.slice(1),n),s=0===r?0:e.size/r,o=vT(()=>{const n=[];e=SR(e,[1,r,s]);for(let r=0;r<t.length;++r){const o=[0,0===r?0:a[r-1],0],l=[1,t[r],s];n[r]=SR(IR(e,o,l),i)}return e.dispose(),n}),l=new lX([],n,e.dtype,t.length);for(let c=0;c<o.length;c++)l.setItem(c,o[c]);return l}(r,pq("lengths",e,t,n),a);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{const r=pq("tensorListId",e,t,n);return[OM(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=pq("tensorListId",e,t,n),a=pq("size",e,t,n),i=n.getTensorList(r.id).resize(a);return n.addTensorList(i),[i.idTensor]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function uX(e,t,n){const[r,a]=pq("fusedOps",e,t,n),i="biasadd"===r,s=!i,o="prelu"===a,l="fusedbatchnorm"===r,c=pq("numArgs",e,t,n);if(i){if(o&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&i&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=pq("strides",e,t,n),h=bq(e,t,n),d=pq("dataFormat",e,t,n).toUpperCase(),A=pq("dilations",e,t,n);let[p,f]=pq("args",e,t,n);s&&(f=p,p=void 0);return{stride:u,pad:h,dataFormat:d,dilations:A,biasArg:p,preluArg:f,activationFunc:a,leakyreluAlpha:pq("leakyreluAlpha",e,t,n)}}function hX(e,t,n){return{boxes:pq("boxes",e,t,n),scores:pq("scores",e,t,n),maxOutputSize:pq("maxOutputSize",e,t,n),iouThreshold:pq("iouThreshold",e,t,n),scoreThreshold:pq("scoreThreshold",e,t,n),softNmsSigma:pq("softNmsSigma",e,t,n)}}class dX{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=OM(0),this.tensorMap=new Map,xT(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return OM(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),vT(()=>{const e=jP(t),r=n.length,a=e.length;GC(r===a,()=>"The number of elements doesn't match, keys has "+"".concat(r," elements, the values has ").concat(a," ")+"elements.");for(let t=0;t<r;t++){const r=n[t],a=e[t];xT(a),this.tensorMap.set(r,a)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return vT(()=>{const e=[];for(let r=0;r<n.length;r++){const a=n[r],i=this.findWithDefault(a,t);e.push(i)}return CP(e)})}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}function AX(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vT;const i=((e,t,n)=>{switch(e.category){case"arithmetic":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(pq("a",e,t,n),pq("b",e,t,n))];case"AddN":return[r.addN(pq("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(pq("a",e,t,n),pq("b",e,t,n))];case"Mul":return[r.mul(pq("a",e,t,n),pq("b",e,t,n))];case"RealDiv":case"Div":return[r.div(pq("a",e,t,n),pq("b",e,t,n))];case"DivNoNan":return[r.divNoNan(pq("a",e,t,n),pq("b",e,t,n))];case"FloorDiv":return[r.floorDiv(pq("a",e,t,n),pq("b",e,t,n))];case"Sub":return[r.sub(pq("a",e,t,n),pq("b",e,t,n))];case"Minimum":return[r.minimum(pq("a",e,t,n),pq("b",e,t,n))];case"Maximum":return[r.maximum(pq("a",e,t,n),pq("b",e,t,n))];case"Pow":return[r.pow(pq("a",e,t,n),pq("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(pq("a",e,t,n),pq("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"basic_math":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(pq("x",e,t,n))];case"Acos":return[r.acos(pq("x",e,t,n))];case"Acosh":return[r.acosh(pq("x",e,t,n))];case"Asin":return[r.asin(pq("x",e,t,n))];case"Asinh":return[r.asinh(pq("x",e,t,n))];case"Atan":return[r.atan(pq("x",e,t,n))];case"Atan2":return[r.atan2(pq("x",e,t,n),pq("y",e,t,n))];case"Atanh":return[r.atanh(pq("x",e,t,n))];case"Ceil":return[r.ceil(pq("x",e,t,n))];case"Complex":return[r.complex(pq("real",e,t,n),pq("imag",e,t,n))];case"Cos":return[r.cos(pq("x",e,t,n))];case"Cosh":return[r.cosh(pq("x",e,t,n))];case"Elu":return[r.elu(pq("x",e,t,n))];case"Erf":return[r.erf(pq("x",e,t,n))];case"Exp":return[r.exp(pq("x",e,t,n))];case"Expm1":return[r.expm1(pq("x",e,t,n))];case"Floor":return[r.floor(pq("x",e,t,n))];case"Log":return[r.log(pq("x",e,t,n))];case"Log1p":return[r.log1p(pq("x",e,t,n))];case"Imag":return[r.imag(pq("x",e,t,n))];case"Neg":return[r.neg(pq("x",e,t,n))];case"Reciprocal":return[r.reciprocal(pq("x",e,t,n))];case"Real":return[r.real(pq("x",e,t,n))];case"Relu":return[r.relu(pq("x",e,t,n))];case"Round":return[r.round(pq("x",e,t,n))];case"Selu":return[r.selu(pq("x",e,t,n))];case"Sigmoid":return[r.sigmoid(pq("x",e,t,n))];case"Sin":return[r.sin(pq("x",e,t,n))];case"Sign":return[r.sign(pq("x",e,t,n))];case"Sinh":return[r.sinh(pq("x",e,t,n))];case"Softplus":return[r.softplus(pq("x",e,t,n))];case"Sqrt":return[r.sqrt(pq("x",e,t,n))];case"Square":return[r.square(pq("x",e,t,n))];case"Tanh":return[r.tanh(pq("x",e,t,n))];case"Tan":return[r.tan(pq("x",e,t,n))];case"ClipByValue":return[r.clipByValue(pq("x",e,t,n),pq("clipValueMin",e,t,n),pq("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(pq("x",e,t,n))];case"Rsqrt":return[r.rsqrt(fq(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(pq("x",e,t,n),pq("alpha",e,t,n))];case"Prelu":return[r.prelu(pq("x",e,t,n),pq("alpha",e,t,n))];case"IsNan":return[r.isNaN(fq(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(fq(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(fq(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"control":return cX(e,t,n);case"convolution":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Conv1D":{const a=pq("stride",e,t,n),i=pq("pad",e,t,n),s=pq("dataFormat",e,t,n).toUpperCase(),o=pq("dilation",e,t,n);return[r.conv1d(pq("x",e,t,n),pq("filter",e,t,n),a,i,s,o)]}case"Conv2D":{const a=pq("strides",e,t,n),i=bq(e,t,n),s=pq("dataFormat",e,t,n).toUpperCase(),o=pq("dilations",e,t,n);return[r.conv2d(pq("x",e,t,n),pq("filter",e,t,n),[a[1],a[2]],i,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=uX(e,t,n);return[r.fused.conv2d({x:pq("x",e,t,n),filter:pq("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:a,pad:i,dataFormat:s,dilations:o,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=uX(e,t,n);return[r.fused.depthwiseConv2d({x:pq("x",e,t,n),filter:pq("filter",e,t,n),strides:[a[1],a[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const a=pq("outputShape",e,t,n),i=pq("strides",e,t,n),s=bq(e,t,n);return[r.conv2dTranspose(pq("x",e,t,n),pq("filter",e,t,n),a,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const a=pq("strides",e,t,n),i=bq(e,t,n),s=pq("dilations",e,t,n),o=pq("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(pq("input",e,t,n),pq("filter",e,t,n),[a[1],a[2]],i,o,[s[1],s[2]])]}case"Conv3D":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("dataFormat",e,t,n).toUpperCase(),o=pq("dilations",e,t,n);return[r.conv3d(pq("x",e,t,n),pq("filter",e,t,n),[a[1],a[2],a[3]],i,s,[o[1],o[2],o[3]])]}case"AvgPool":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("kernelSize",e,t,n);return[r.avgPool(pq("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPool":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("kernelSize",e,t,n);return[r.maxPool(pq("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("kernelSize",e,t,n),o=pq("includeBatchInIndex",e,t,n),{result:l,indexes:c}=r.maxPoolWithArgmax(pq("x",e,t,n),[s[1],s[2]],[a[1],a[2]],i,o);return[l,c]}case"AvgPool3D":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("kernelSize",e,t,n);return[r.avgPool3d(pq("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("kernelSize",e,t,n);return[r.maxPool3d(pq("x",e,t,n),[s[1],s[2],s[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{const a=pq("strides",e,t,n),i=pq("pad",e,t,n),s=pq("dilations",e,t,n),o=a[1],l=a[2],c=s[1],u=s[2];return[r.dilation2d(pq("x",e,t,n),pq("filter",e,t,n),[o,l],i,[c,u],"NHWC")]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"creation":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Fill":{const a=pq("shape",e,t,n),i=pq("dtype",e,t,n),s=pq("value",e,t,n);return[r.fill(a,s,i)]}case"LinSpace":{const a=pq("start",e,t,n),i=pq("stop",e,t,n),s=pq("num",e,t,n);return[r.linspace(a,i,s)]}case"Multinomial":{const a=pq("logits",e,t,n),i=pq("numSamples",e,t,n),s=pq("seed",e,t,n);return[r.multinomial(a,i,s)]}case"OneHot":{const a=pq("indices",e,t,n),i=pq("depth",e,t,n),s=pq("onValue",e,t,n),o=pq("offValue",e,t,n),l=pq("dtype",e,t,n);return[r.oneHot(a,i,s,o,l)]}case"Ones":return[r.ones(pq("shape",e,t,n),pq("dtype",e,t,n))];case"OnesLike":return[r.onesLike(pq("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(pq("shape",e,t,n),pq("dtype",e,t,n),pq("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(pq("shape",e,t,n),pq("minval",e,t,n),pq("maxval",e,t,n),pq("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(pq("shape",e,t,n),pq("minval",e,t,n),pq("maxval",e,t,n),pq("seed",e,t,n))];case"Range":{const a=pq("start",e,t,n),i=pq("stop",e,t,n),s=pq("step",e,t,n);return[r.range(a,i,s,pq("dtype",e,t,n))]}case"TruncatedNormal":{const a=pq("shape",e,t,n),i=pq("mean",e,t,n),s=pq("stdDev",e,t,n),o=pq("seed",e,t,n);return[r.truncatedNormal(a,i,s,pq("dtype",e,t,n),o)]}case"Zeros":return[r.zeros(pq("shape",e,t,n),pq("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(pq("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"dynamic":return async function(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E;switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=hX(e,t,n),u=await a.image.nonMaxSuppressionWithScoreAsync(r,i,s,o,l,c);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=hX(e,t,n),c=pq("padToMaxOutputSize",e,t,n),u=await a.image.nonMaxSuppressionPaddedAsync(r,i,s,o,l,c);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=hX(e,t,n);return[await a.image.nonMaxSuppressionAsync(r,i,s,o,l)]}case"Where":{const r=a.cast(pq("condition",e,t,n),"bool"),i=[await a.whereAsync(r)];return r.dispose(),i}case"ListDiff":return a.setdiff1dAsync(pq("x",e,t,n),pq("y",e,t,n));default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n);case"evaluation":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"LowerBound":{const a=pq("sortedSequence",e,t,n),i=pq("values",e,t,n);return[r.lowerBound(a,i)]}case"TopKV2":{const a=pq("x",e,t,n),i=pq("k",e,t,n),s=pq("sorted",e,t,n),o=r.topk(a,i,s);return[o.values,o.indices]}case"UpperBound":{const a=pq("sortedSequence",e,t,n),i=pq("values",e,t,n);return[r.upperBound(a,i)]}case"Unique":{const a=pq("x",e,t,n),i=r.unique(a);return[i.values,i.indices]}case"UniqueV2":{const a=pq("x",e,t,n),i=pq("axis",e,t,n),s=r.unique(a,i);return[s.values,s.indices]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"image":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"ResizeBilinear":{const a=pq("images",e,t,n),i=pq("size",e,t,n),s=pq("alignCorners",e,t,n),o=pq("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],s,o)]}case"ResizeNearestNeighbor":{const a=pq("images",e,t,n),i=pq("size",e,t,n),s=pq("alignCorners",e,t,n),o=pq("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],s,o)]}case"CropAndResize":{const a=pq("image",e,t,n),i=pq("boxes",e,t,n),s=pq("boxInd",e,t,n),o=pq("cropSize",e,t,n),l=pq("method",e,t,n),c=pq("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,i,s,o,l,c)]}case"ImageProjectiveTransformV3":{const a=pq("images",e,t,n),i=pq("transforms",e,t,n),s=pq("outputShape",e,t,n),o=pq("fillValue",e,t,n),l=pq("interpolation",e,t,n),c=pq("fillMode",e,t,n);return[r.image.transform(a,i,l.toLowerCase(),c.toLowerCase(),o,s)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"graph":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const a=pq("default",e,t,n);return[fq(e.name,t,n)||a];case"Placeholder":return[fq(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[xq(pq("x",e,t,n))];case"IdentityN":return pq("x",e,t,n).map(e=>xq(e));case"Shape":return[r.tensor1d(pq("x",e,t,n).shape,"int32")];case"ShapeN":return pq("x",e,t,n).map(e=>r.tensor1d(e.shape));case"Size":return[r.scalar(pq("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(pq("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const i=pq("x",e,t,n),s=pq("data",e,t,n),o=pq("message",e,t,n),l=pq("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<s.length;e++)console.log(Array.prototype.slice.call(s[e].dataSync()).slice(0,l));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"logical":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Equal":return[r.equal(pq("a",e,t,n),pq("b",e,t,n))];case"NotEqual":return[r.notEqual(pq("a",e,t,n),pq("b",e,t,n))];case"Greater":return[r.greater(pq("a",e,t,n),pq("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(pq("a",e,t,n),pq("b",e,t,n))];case"Less":return[r.less(pq("a",e,t,n),pq("b",e,t,n))];case"LessEqual":return[r.lessEqual(pq("a",e,t,n),pq("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(pq("a",e,t,n),pq("b",e,t,n))];case"LogicalNot":return[r.logicalNot(pq("a",e,t,n))];case"LogicalOr":return[r.logicalOr(pq("a",e,t,n),pq("b",e,t,n))];case"Select":case"SelectV2":return[r.where(pq("condition",e,t,n),pq("a",e,t,n),pq("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(pq("a",e,t,n),pq("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"matrices":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(pq("a",e,t,n),pq("b",e,t,n),pq("transposeA",e,t,n),pq("transposeB",e,t,n))];case"Einsum":return[r.einsum(pq("equation",e,t,n),...pq("tensors",e,t,n))];case"Transpose":return[r.transpose(pq("x",e,t,n),pq("perm",e,t,n))];case"_FusedMatMul":const[a,i]=pq("fusedOps",e,t,n),s="biasadd"===a,o="prelu"===i,l=pq("numArgs",e,t,n),c=pq("leakyreluAlpha",e,t,n);if(s){if(o&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,h]=pq("args",e,t,n);return[r.fused.matMul({a:pq("a",e,t,n),b:pq("b",e,t,n),transposeA:pq("transposeA",e,t,n),transposeB:pq("transposeB",e,t,n),bias:u,activation:i,preluActivationWeights:h,leakyreluAlpha:c})];case"MatrixBandPart":return[r.linalg.bandPart(pq("a",e,t,n),pq("numLower",e,t,n),pq("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"normalization":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(pq("x",e,t,n),pq("axis",e,t,n),pq("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(pq("x",e,t,n),pq("mean",e,t,n),pq("variance",e,t,n),pq("offset",e,t,n),pq("scale",e,t,n),pq("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(pq("x",e,t,n),pq("radius",e,t,n),pq("bias",e,t,n),pq("alpha",e,t,n),pq("beta",e,t,n))];case"Softmax":return[r.softmax(pq("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(pq("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"ragged":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"RaggedGather":{const{outputNestedSplits:a,outputDenseValues:i}=r.raggedGather(pq("paramsNestedSplits",e,t,n),pq("paramsDenseValues",e,t,n),pq("indices",e,t,n),pq("outputRaggedRank",e,t,n));return a.concat(i)}case"RaggedRange":{const{rtNestedSplits:a,rtDenseValues:i}=r.raggedRange(pq("starts",e,t,n),pq("limits",e,t,n),pq("splits",e,t,n));return[a,i]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(pq("shape",e,t,n),pq("values",e,t,n),pq("defaultValue",e,t,n),pq("rowPartitionTensors",e,t,n),pq("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"reduction":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Max":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.max(pq("x",e,t,n),a,i)]}case"Mean":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.mean(pq("x",e,t,n),a,i)]}case"Min":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.min(pq("x",e,t,n),a,i)]}case"Sum":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.sum(pq("x",e,t,n),a,i)]}case"All":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.all(pq("x",e,t,n),a,i)]}case"Any":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.any(pq("x",e,t,n),a,i)]}case"ArgMax":{const a=pq("axis",e,t,n);return[r.argMax(pq("x",e,t,n),a)]}case"ArgMin":{const a=pq("axis",e,t,n);return[r.argMin(pq("x",e,t,n),a)]}case"Prod":{const a=pq("axis",e,t,n),i=pq("keepDims",e,t,n);return[r.prod(pq("x",e,t,n),a,i)]}case"Cumprod":{const a=pq("axis",e,t,n),i=pq("exclusive",e,t,n),s=pq("reverse",e,t,n);return[r.cumprod(pq("x",e,t,n),a,i,s)]}case"Cumsum":{const a=pq("axis",e,t,n),i=pq("exclusive",e,t,n),s=pq("reverse",e,t,n);return[r.cumsum(pq("x",e,t,n),a,i,s)]}case"Bincount":const a=pq("x",e,t,n),i=pq("weights",e,t,n),s=pq("size",e,t,n);return[r.bincount(a,i,s)];case"DenseBincount":{const a=pq("x",e,t,n),i=pq("weights",e,t,n),s=pq("size",e,t,n),o=pq("binaryOutput",e,t,n);return[r.denseBincount(a,i,s,o)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"slice_join":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"ConcatV2":case"Concat":{const a=pq("n",e,t,n),i=pq("axis",e,t,n);let s=pq("tensors",e,t,n);return s=s.slice(0,a),[r.concat(s,i)]}case"Gather":{const a=pq("x",e,t,n),i=pq("indices",e,t,n);return[r.gather(a,r.cast(i,"int32"),0)]}case"GatherV2":{const a=pq("axis",e,t,n),i=pq("batchDims",e,t,n),s=pq("x",e,t,n),o=pq("indices",e,t,n);return[r.gather(s,r.cast(o,"int32"),a,i)]}case"Reverse":{const a=pq("dims",e,t,n),i=[];for(let e=0;e<a.length;e++)a[e]&&i.push(e);const s=pq("x",e,t,n);return[r.reverse(s,i)]}case"ReverseV2":{const a=pq("axis",e,t,n),i=pq("x",e,t,n);return[r.reverse(i,a)]}case"Slice":{const a=pq("begin",e,t,n),i=pq("size",e,t,n);return[r.slice(pq("x",e,t,n),a,i)]}case"StridedSlice":{const a=pq("begin",e,t,n),i=pq("end",e,t,n),s=pq("strides",e,t,n),o=pq("beginMask",e,t,n),l=pq("endMask",e,t,n),c=pq("ellipsisMask",e,t,n),u=pq("newAxisMask",e,t,n),h=pq("shrinkAxisMask",e,t,n),d=pq("x",e,t,n);return[r.stridedSlice(d,a,i,s,o,l,c,u,h)]}case"Pack":return vT(()=>{const a=pq("axis",e,t,n),i=pq("tensors",e,t,n),s=i[0].shape,o=r.squeeze(i[0]).shape,l=i.map(e=>{const t=YC(e.shape,s);if(!t&&!YC(r.squeeze(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,s)});return[r.stack(l,a)]});case"Unpack":{const a=pq("axis",e,t,n),i=pq("tensor",e,t,n);return r.unstack(i,a)}case"Tile":{const a=pq("reps",e,t,n);return[r.tile(pq("x",e,t,n),a)]}case"Split":case"SplitV":{const a=pq("axis",e,t,n),i=pq("numOrSizeSplits",e,t,n),s=pq("x",e,t,n);return r.split(s,i,a)}case"ScatterNd":{const a=pq("indices",e,t,n),i=pq("values",e,t,n),s=pq("shape",e,t,n);return[r.scatterND(a,i,s)]}case"GatherNd":{const a=pq("x",e,t,n),i=pq("indices",e,t,n);return[r.gatherND(a,i)]}case"SparseToDense":{const a=pq("sparseIndices",e,t,n),i=pq("outputShape",e,t,n),s=pq("sparseValues",e,t,n),o=pq("defaultValue",e,t,n);return[r.sparseToDense(a,s,i,s.dtype===o.dtype?o:r.cast(o,s.dtype))]}case"TensorScatterUpdate":{const a=pq("indices",e,t,n),i=pq("values",e,t,n),s=pq("tensor",e,t,n);return[r.tensorScatterUpdate(s,a,i)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"sparse":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:a,outputValues:i,emptyRowIndicator:s,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(pq("indices",e,t,n),pq("values",e,t,n),pq("denseShape",e,t,n),pq("defaultValue",e,t,n));return[a,i,s,o]}case"SparseReshape":{const{outputIndices:a,outputShape:i}=r.sparse.sparseReshape(pq("inputIndices",e,t,n),pq("inputShape",e,t,n),pq("newShape",e,t,n));return[a,i]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(pq("data",e,t,n),pq("indices",e,t,n),pq("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(pq("data",e,t,n),pq("indices",e,t,n),pq("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"spectral":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"FFT":return[r.fft(pq("x",e,t,n))];case"IFFT":return[r.ifft(pq("x",e,t,n))];case"RFFT":return[r.rfft(pq("x",e,t,n))];case"IRFFT":return[r.irfft(pq("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"string":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(pq("input",e,t,n),pq("pattern",e,t,n),pq("rewrite",e,t,n),pq("replaceGlobal",e,t,n))];case"StringNGrams":{const{nGrams:a,nGramsSplits:i}=r.string.stringNGrams(pq("data",e,t,n),pq("dataSplits",e,t,n),pq("separator",e,t,n),pq("nGramWidths",e,t,n),pq("leftPad",e,t,n),pq("rightPad",e,t,n),pq("padWidth",e,t,n),pq("preserveShortSequences",e,t,n));return[a,i]}case"StringSplit":{const{indices:a,values:i,shape:s}=r.string.stringSplit(pq("input",e,t,n),pq("delimiter",e,t,n),pq("skipEmpty",e,t,n));return[a,i,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(pq("input",e,t,n),pq("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"transformation":return a(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Cast":return[r.cast(pq("x",e,t,n),pq("dtype",e,t,n))];case"ExpandDims":{const a=pq("axis",e,t,n);return[r.expandDims(pq("x",e,t,n),a)]}case"Squeeze":{const a=pq("axis",e,t,n);return[r.squeeze(pq("x",e,t,n),a)]}case"Reshape":return[r.reshape(pq("x",e,t,n),pq("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(pq("x",e,t,n),pq("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(pq("x",e,t,n),pq("padding",e,t,n),pq("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(pq("x",e,t,n),pq("padding",e,t,n),pq("constantValue",e,t,n))];case"SpaceToBatchND":{const a=pq("blockShape",e,t,n),i=pq("paddings",e,t,n);return[r.spaceToBatchND(pq("x",e,t,n),a,i)]}case"BatchToSpaceND":{const a=pq("blockShape",e,t,n),i=pq("crops",e,t,n);return[r.batchToSpaceND(pq("x",e,t,n),a,i)]}case"DepthToSpace":{const a=pq("blockSize",e,t,n),i=pq("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(pq("x",e,t,n),a,i)]}case"BroadcastTo":return[r.broadcastTo(pq("x",e,t,n),pq("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(pq("s0",e,t,n),pq("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const a=r.getHashTableHandleByName(e.name);if(null!=a)return[a];{const a=pq("keyDType",e,t,n),i=pq("valueDType",e,t,n),s=new dX(a,i);return r.addHashTable(e.name,s),[s.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const a=pq("tableHandle",e,t,n,r),i=pq("keys",e,t,n),s=pq("values",e,t,n),o=r.getHashTableById(a.id);return[await o.import(i,s)]}case"LookupTableFind":case"LookupTableFindV2":{const a=pq("tableHandle",e,t,n,r),i=pq("keys",e,t,n),s=pq("defaultValue",e,t,n),o=r.getHashTableById(a.id);return[await o.find(i,s)]}case"LookupTableSize":case"LookupTableSizeV2":{const a=pq("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}})(e,t,n,r);case"custom":const i=Aq(e.op);if(i&&i.customExecutor)return i.customExecutor(new nX(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}})(e,t,n);return wE(i)?i.then(e=>[].concat(e)):[].concat(i)}class pX{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(e=>0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function fX(e,t,n,r){const a=new Set,i=[];let s=null,o=null;const l=new Set,c=new Set(Object.keys(e).map(e=>vq(e)[0]));r=r||[];const u=new Set(r.map(e=>vq(e.name)[0])),h=[...t];for(;h.length>0;){const e=h.pop();(xX(e)||wX(e)||_X(e))&&null==s&&(s=e,o=s.children.map(e=>e.name).filter(e=>a.has(e))),a.add(e.name),null==n[e.name]&&(c.has(e.name)||u.has(e.name)||(0!==e.inputs.length?e.inputs.forEach(e=>{l.has(e.name)||(l.add(e.name),h.push(e))}):i.push(e.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:s,syncInputs:o}}function mX(e,t){const{usedNodes:n,inputs:r}=t,a=Object.keys(r).map(e=>vq(e)[0]).map(t=>e.nodes[t]),i=e.initNodes||[],s=e=>n.has("string"===typeof e?e:e.name);function o(e){return[...new Map(e.map(e=>[e.name,e])).values()]}const l=o([...a,...e.weights,...i]).filter(s),c=o([...l,...Object.values(e.nodes)]).filter(s),u=new Map(c.map(e=>[e.name,e])),h={};for(const f of c){h[f.name]=h[f.name]||0;for(const e of f.children)s(e)||(h[e.name]=Number.POSITIVE_INFINITY),h[e.name]=(h[e.name]||0)+1}const d=Object.entries(h).filter(e=>{let[,t]=e;return 0===t}).map(e=>{let[t]=e;return t}),A=[...d];for(;d.length>0;){const e=d.pop(),t=u.get(e);for(const n of t.children.filter(s))0===--h[n.name]&&(A.push(n.name),d.push(n.name))}const p=function(e,t){const n=new Map(e.map(e=>[e.name,e])),r=t.map(e=>e.name),a=new Set(r);for(;r.length>0;){const e=r.pop(),t=n.get(e);for(const i of t.children)n.has(i.name)&&!a.has(i.name)&&(a.add(i.name),r.push(i.name))}const i=e.filter(e=>a.has(e.name));return i}(A.map(e=>u.get(e)),l);return function(e,t){const n=new Map(e.map((e,t)=>[e.name,t])),r=new Set(t.map(e=>e.name)),a=e=>r.has("string"===typeof e?e:e.name),i=new Set(e.map(e=>e.name)),s=e=>i.has("string"===typeof e?e:e.name);for(const o of e){for(const e of o.children.filter(s)){if(!n.has(e.name))throw new gX("Child ".concat(e.name," of node ").concat(o.name," is unreachable."));if(n.get(o.name)>n.get(e.name))throw new gX("Node ".concat(o.name," is scheduled to run after its child ").concat(e.name,"."))}if(!a(o))for(const e of o.inputs){if(!n.has(e.name))throw new gX("Input ".concat(e.name," of node ").concat(o.name," is unreachable."));if(n.get(e.name)>n.get(o.name))throw new gX("Node ".concat(o.name," is scheduled to run before its input ").concat(e.name,"."))}}}(p,l),p}class gX extends Error{constructor(e){super("NodesExecutionOrderError: ".concat(e))}}const yX=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),vX=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),bX=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function xX(e){return yX.has(e.op)}function wX(e){return vX.has(e.op)}function _X(e){return bX.has(e.op)}class SX{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(t=>e[t].map(e=>e.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach(t=>{this._functionExecutorMap[t]=new SX(e.functions[t],this)})}getCompilationKey(e,t){const n=e.map(e=>e.name).sort(),r=t.map(e=>e.name).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const n=fX(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:a,syncInputs:i}=n;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){const n=t.map(e=>e.name),a=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(n,"] from the provided inputs ")+"[".concat(a,"]. Missing the following inputs: [").concat(r,"]"))}const s=mX(this.graph,n),o=function(e){const t=new Map(e.map((e,t)=>[e.name,t])),n=Number.MAX_SAFE_INTEGER,r=e.map((e,t)=>xX(e)?n:t),a=e=>{const n=r[t.get(e.name)];return null==n?-1:n},i=e.map((e,t)=>e.children.map(a).reduce((e,t)=>Math.max(e,t),r[t])),s=new Map;for(let o=0;o<e.length;++o){const t=i[o];if(t===n)continue;const r=e[o],a=e[t];s.has(a.name)||s.set(a.name,[]),s.get(a.name).push(r)}return s}(s);return{orderedNodes:s,nodeLiveUntilMap:o}}cloneAndKeepTensor(e){if(null==e)return null;const t=e.clone();return xT(t),t}cloneTensorList(e){if(!e)return null;const t=e.map(e=>this.cloneAndKeepTensor(e));return t}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(e=>{let[t,n]=e;return[t,this.cloneTensorList(n)]}))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map(e=>this.graph.nodes[vq(e)[0]]),a=t.map(e=>vq(e)[0]),i=new Set(a);let s=a.map(e=>this.graph.nodes[e]);0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let l=this.compiledMap.get(o);null==l&&(l=this.compile(e,s),this.compiledMap.set(o,l));try{this.keepIntermediateTensors=EE().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const c={},u={};return vT(()=>{const n=new pX(this.weightMap,c,u,this.functionExecutorMap,this.parseNodeNameCache),r=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(t=>{const[a,i]=vq(t,n),s=[];s[i]=e[t],r[a]=s,this.keepIntermediateTensors&&(this.clonedTensorsMap[a]=this.cloneTensorList(s))});const a=this.getFrozenTensorIds(r),{orderedNodes:s,nodeLiveUntilMap:o}=l;for(const e of s){if(r[e.name])continue;const t=AX(e,r,n,this._resourceManager);if(wE(t))throw new Error("The execution of the op '".concat(e.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");r[e.name]=t,this.keepIntermediateTensors&&(this.clonedTensorsMap[e.name]=this.cloneTensorList(t)),this.checkTensorForDisposalWithNodeLiveUntilInfo(e,r,n,a,i,o.get(e.name))}return null==this.parent&&n.dispose(a),t.map(e=>fq(e,r,n))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(t=>e[t]).map(e=>e.map(e=>e.id)));return new Set(t)}checkTensorForDisposal(e,t,n,r,a,i,s){if(!xX(t)&&!i.has(e)){for(const r of n[e])null!=r&&(s[r.id]=(s[r.id]||0)+t.children.length);for(const e of t.inputs){if(xX(e))continue;const t=mq(e.name,n,r);if(null!=t)for(const e of t){if(!e||e.kept||a.has(e.id))continue;const t=s[e.id];1===t?(e.dispose(),delete s[e.id]):null!=t&&s[e.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,r,a,i){function s(e){return xX(e)||a.has(e.name)}if(!xX(e)&&null!=i)for(const o of i){if(s(o))continue;const e=mq(o.name,t,n);for(const t of e)!t||t.kept||r.has(t.id)||t.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=EE().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const i=new pX(this.weightMap,r,a,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const s=await this.executeWithControlFlow(e,i,t,n),o=t.map(e=>fq(e,s,i)),l=o.map(e=>e.id),c=Object.keys(e).map(t=>e[t].id),u=new Set([...l,...c,...this.weightIds]);return Object.values(s).forEach(e=>{e.forEach(e=>{!e||e.isDisposed||u.has(e.id)||e.dispose()})}),null==this.parent&&i.dispose(u),o}async executeFunctionAsync(e,t,n){const r=e.reduce((e,t,n)=>(e[this.inputs[n].name]=t,e),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const a=Object.keys(e),i=a.map(e=>this.graph.nodes[vq(e)[0]]),s=n.map(e=>vq(e)[0]),o=new Set(s);let l=s.map(e=>this.graph.nodes[e]);0===l.length&&(l=this._outputs);const{usedNodes:c,missingInputs:u,dynamicNode:h,syncInputs:d}=fX(e,l,this.weightMap,this._initNodes),A=[...i,...this.graph.weights,...this._initNodes||[]].map(e=>({node:e,contexts:t.currentContext})),p=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,r]=vq(t),a=[];a[r]=e[t],p[n]=a});const f={},m=this.getFrozenTensorIds(p),g={};for(;A.length>0;){const e=this.processStack(i,A,t,p,g,m,o,f,c);await Promise.all(e)}null!=h||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=l.filter(e=>!xX(e)&&!fq(e.name,p,t)).map(e=>e.name);if(y.length>0){let e="";throw null!=h&&(e="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(y,"] from the provided ")+"inputs [".concat(a,"]. Consider providing the following inputs: ")+"[".concat(u,"]. ").concat(e))}return p}processStack(e,t,n,r,a,i,s,o,l){const c=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let u="";if("Enter"===e.node.op&&pq("isConstant",e.node,r,n)&&([u]=gq(e.node.name,n)),null==r[e.node.name]){const h=AX(e.node,r,n,this._resourceManager);u||([u]=gq(e.node.name,n));const d=n.currentContext;wE(h)?c.push(h.then(c=>(r[u]=c,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(c)),n.currentContext=d,this.checkTensorForDisposal(u,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l),c))):(r[u]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(h)),this.checkTensorForDisposal(u,e.node,r,n,i,s,o),this.processChildNodes(e.node,t,n,r,a,l))}else this.processChildNodes(e.node,t,n,r,a,l)}return c}processChildNodes(e,t,n,r,a,i){e.children.forEach(e=>{const[s]=gq(e.name,n);!a[s]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some(e=>!!fq(e,r,n))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every(e=>!!fq(e,r,n))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(e=>e.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const n=e[t],[r]=vq(t),a=this.graph.nodes[r];if(a.attrParams.shape&&a.attrParams.shape.value){const e=a.attrParams.shape.value;GC(e.length===n.shape.length&&n.shape.every((t,n)=>-1===e[n]||e[n]===t),()=>"The shape of dict['".concat(a.name,"'] provided in ")+"model.execute(dict) must be [".concat(e,"], but was ")+"[".concat(n.shape,"]"))}a.attrParams.dtype&&a.attrParams.dtype.value&&GC(n.dtype===a.attrParams.dtype.value,()=>"The dtype of dict['".concat(a.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(a.attrParams.dtype.value,", but was ").concat(n.dtype))})}mapInputs(e){var t,n;const r={};for(const a in e){const i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}checkInputs(e){const t=Object.keys(e).filter(e=>{const[t]=vq(e);return null==this.graph.nodes[t]});if(t.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(t,"] that are not part of graph"))}mapOutputs(e){return e.map(e=>{var t,n;const r=null===(n=null===(t=this._signature)||void 0===t?void 0:t.outputs)||void 0===n?void 0:n[e];return null!=r?r.name:e},{})}checkOutputs(e){e.forEach(e=>{const[t]=vq(e);if(!this.graph.nodes[t])throw new Error("The output '".concat(e,"' is not found in the graph"))})}}class CX{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}const EX="?tfjs-format=file",NX="model.json";class BX{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new CX}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return wE(e)?e.then(e=>null==e.getWeightStream?this.loadSync(e):this.loadStreaming(e)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(null==e.getWeightStream)throw new Error("Model artifacts missing streamWeights function");const t=await MT(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const n=this.artifacts.modelTopology;let r=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const e=this.artifacts.userDefinedMetadata;null!=e.signature&&(r=e.signature),null!=e.structuredOutputKeys&&(this.structuredOutputKeys=e.structuredOutputKeys)}if(this.signature=r,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new SX(Hq.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=Hq.Instance.transformGraph(e.modelInitializer);this.initializer=new SX(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if("string"===typeof e){const t=this.io.getSaveHandlers(e);if(0===t.length)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new Error("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t={};return(e instanceof MI?[e]:e).forEach((e,n)=>t[this.structuredOutputKeys[n]]=e),t}return e}predict(e,t){const n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){const n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof MI)&&!Array.isArray(e)){const n=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=n)for(const t in n){const r=n[t];null!=r.resourceId&&(e[t]=this.resourceIdToCapturedInput[r.resourceId])}return e}e=Array.isArray(e)?e:[e];const n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-n," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));let r=0;return this.inputNodes.reduce((t,n)=>{var a,i,s;const o=null===(s=null===(i=null===(a=this.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[n])||void 0===s?void 0:s.resourceId;return t[n]=null!=o?this.resourceIdToCapturedInput[o]:e[r++],t},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){const a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}}execute(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&bT(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function kX(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==n&&(n={}),n.fromTFHub&&"string"===typeof e&&(e=function(e){e.endsWith("/")||(e+="/");return"".concat(e).concat(NX).concat(EX)}(e));const a=new BX(e,n,r);return await a.load(),a}function IX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(RX(e)){const a=Array.isArray(e)?[]:{};r.add(e);for(const i in e){const s=IX(e[i],t,n,r);a[i]=s}return r.delete(e),e.__proto__&&(a.__proto__=e.__proto__),a}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function TX(e){return MX(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:FX)}function MX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(RX(r)){const a=Array.isArray(r)?[]:{};n.add(r);for(const i in r){const r=e.map(e=>e[i]),s=MX(r,t,n);a[i]=s}return n.delete(r),a}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function FX(e){return null===e?null:RX(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function RX(e){let t=!1;if(EE().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:r}=n(551);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof MI)&&!(e instanceof Promise)&&!t)}function LX(e){return function(e,t){return IX(e,t)}(e,UX)}function UX(e){return e instanceof MI?{value:e.clone(),recurse:!1}:RX(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class PX{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class DX extends PX{constructor(){super(DX.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function OX(e){return new QX(e)}function zX(e,t){return new eY(e,t)}DX.INITIAL_CAPACITY=32;class HX{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new YX(this,e)}filter(e){return new qX(this,e)}map(e){return new XX(this,e)}mapAsync(e){return new JX(this,e)}serialMapAsync(e){return new JX(this,e).serial()}flatmap(e){return new $X(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e){return new KX(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FX;return this.rowMajorBatch(e,t).map(e=>TX(e,n))}concatenate(e,t){return new eY(new jX([this,e]),t)}take(e){return e<0||null==e?this:new GX(this,e)}skip(e){return e<0||null==e?this:new WX(this,e)}prefetch(e){return new nY(this,e)}shuffle(e,t){return new rY(this,e,t)}serial(){return new VX(this)}}class jX extends HX{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:LX(e),done:!1}}}class QX extends HX{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message="Error thrown while iterating through a dataset: ".concat(e.message),e}}}class VX extends HX{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class WX extends HX{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;bT(e.value)}return this.upstream.next()}}class GX extends HX{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class KX extends HX{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class qX extends HX{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;bT(e.value)}}}class XX extends HX{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=KI(e.value),n=this.transform(e.value),r=KI(n);for(const a of t)GI(a,r)||a.dispose();return{value:n,done:!1}}}class YX extends HX{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class JX extends HX{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=KI(e.value),n=await this.transform(e.value),r=KI(n);for(const a of t)GI(a,r)||a.dispose();return{value:n,done:!1}}}class ZX extends HX{constructor(){super(),this.outputQueue=new DX,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class $X extends ZX{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=KI(e.value),n=this.transform(e.value),r=KI(n);this.outputQueue.pushAll(n);for(const a of t)GI(a,r)||a.dispose();return!0}}class eY extends HX{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var tY;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(tY||(tY={}));class nY extends HX{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new PX(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class rY extends nY{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=zU.alea(n||fI().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class aY{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let r;return GC(e>0,()=>"batchSize needs to be positive, but it is\n      ".concat(e)),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),iY(async()=>(await n.iterator()).columnMajorBatch(e,t,sY),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,iY(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,iY(async()=>(await t.iterator()).filter(t=>vT(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return iY(async()=>(await t.iterator()).map(t=>vT(()=>e(t))),this.size)}mapAsync(e){const t=this;return iY(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return iY(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,iY(async()=>zX(OX(async()=>({value:await t.iterator(),done:!1})).take(e)),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,iY(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const r=this,a=zU.alea(t||fI().toString());return iY(async()=>{let t=a.int32();return n&&(t+=a.int32()),(await r.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,iY(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function iY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends aY{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function sY(e){if(null===e)return null;if(function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof MI||yI(e);var t}(e[0])){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof MI?CP(e):pT(e)}(e),recurse:!1}}return{value:null,recurse:!0}}aY.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function oY(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&GC("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors in the CPU backend."))})}const lY=WP;class cY extends zC{nextDataId(){return cY.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new OC(this,gT())}write(e,t,n){this.firstUse&&(this.firstUse=!1,EE().get("IS_NODE")&&jk("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&lE(n[0])){const a=n.map(e=>mI(e));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return VO(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>gI(e));return NM(e.shape,e.dtype,n)}catch(hS){throw new Error("Failed to decode encoded string bytes into utf-8")}return NM(e.shape,e.dtype,t)}makeOutput(e,t,n){return gT().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=fI();e();return{kernelMs:fI()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){oY([e],"where");const t=this.readSync(e.dataId);return lY(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}cY.nextDataId=0;function uY(e){return(t,n,r)=>{const a=iE(n,t.length);for(let i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function hY(e,t,n){return dY(e,uY(t),n)}function dY(e,t,n){return r=>{let{inputs:a,attrs:i,backend:s}=r;const{x:o}=a;oY(o,e);const l=s,c=l.data.get(o.dataId).values;let u;if("string"===o.dtype){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");u=Sz(c)}else u=c;const h=n||o.dtype,d=t(u,h,i);return l.makeTensorInfo(o.shape,h,d)}}_T("cpu",()=>new cY,1);const AY=hY(kN,e=>e>=0?e:Math.exp(e)-1),pY={kernelName:kN,backendName:"cpu",kernelFunc:AY};function fY(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const mY={kernelName:GN,backendName:"cpu",kernelFunc:fY};function gY(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r;oY([a],"leakyRelu");const s=XC(a.shape),o=n.data.get(a.dataId).values,l=aE("float32",s);for(let c=0;c<o.length;c++)l[c]=o[c]<0?i*o[c]:o[c];return n.makeTensorInfo(a.shape,"float32",l)}const yY={kernelName:ZN,backendName:"cpu",kernelFunc:gY};function vY(e){return(t,n,r,a,i)=>{const s=tF(t,n),o=s.length,l=AE(s),c=aE(i,XC(s)),u=t.length,h=n.length,d=AE(t),A=AE(n),p=$M(t,s),f=$M(n,s);if(p.length+f.length===0)for(let m=0;m<c.length;++m)c[m]=e(r[m%r.length],a[m%a.length]);else for(let m=0;m<c.length;++m){const t=xE(m,o,l),n=t.slice(-u);p.forEach(e=>n[e]=0);const i=bE(n,u,d),s=t.slice(-h);f.forEach(e=>s[e]=0);const g=bE(s,h,A);c[m]=e(r[i],a[g])}return[c,s]}}const bY=vY((e,t)=>e<0?t*e:e);function xY(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t;oY([r,a],"prelu");const i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,[o,l]=bY(r.shape,a.shape,i,s,"float32");return n.makeTensorInfo(l,"float32",o)}const wY={kernelName:FB,backendName:"cpu",kernelFunc:xY},_Y=hY(HB,e=>Math.max(0,e)),SY={kernelName:HB,backendName:"cpu",kernelFunc:_Y},CY=hY(KB,e=>Math.min(Math.max(0,e),6)),EY={kernelName:KB,backendName:"cpu",kernelFunc:CY},NY=uY(e=>1/(1+Math.exp(-e))),BY=hY(sk,e=>1/(1+Math.exp(-e))),kY={kernelName:sk,backendName:"cpu",kernelFunc:BY};function IY(e,t,n,r,a){if("linear"===n)return fY({inputs:{x:t},backend:e});if("relu"===n)return _Y({inputs:{x:t},backend:e});if("elu"===n)return AY({inputs:{x:t},backend:e});if("relu6"===n)return CY({inputs:{x:t},backend:e});if("prelu"===n)return xY({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return gY({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return BY({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function TY(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",s)},o}const MY={kernelName:rN,backendName:"cpu",kernelFunc:TY};function FY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return TY({inputs:{real:FY(e,t,"float32"),imag:FY(e,t,"float32")},backend:e})}const r=gE(XC(t),n);return e.makeTensorInfo(t,n,r)}function RY(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const LY={kernelName:OB,backendName:"cpu",kernelFunc:RY};function UY(e,t,n,r){if("int32"===r){return[t,"int32",Int32Array.from(e)]}if("bool"===r){const r=pI([0],n),[a,i]=vY((e,t)=>e!==t?1:0)(t,[],e,r,"bool");return[i,"bool",a]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function PY(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:i}=r;if("complex64"===i){if("complex64"===a.dtype)return fY({inputs:{x:a},backend:n});const e=FY(n,a.shape,a.dtype),t=PY({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),r=TY({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===a.dtype){const e=RY({inputs:{input:a},backend:n}),t=PY({inputs:{x:e},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(e),t}if(!sE(a.dtype,i)){const e=fY({inputs:{x:a},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:i}}const s=n.data.get(a.dataId).values,[o,l,c]=UY(s,a.shape,a.dtype,i);return n.makeTensorInfo(o,l,c)}const DY={kernelName:eN,backendName:"cpu",kernelFunc:PY};function OY(e,t,n,r){return null==n?n=>{let{inputs:a,backend:i}=n;const{a:s,b:o}=a,l=i;oY([s,o],e);const c=l.data.get(s.dataId).values,u=l.data.get(o.dataId).values,h="string"===s.dtype?Sz(c):c,d="string"===s.dtype?Sz(u):u,A=r||s.dtype,[p,f]=t(s.shape,o.shape,h,d,A);return l.makeTensorInfo(f,A,p)}:e=>{let{inputs:a,backend:i}=e;const{a:s,b:o}=a,l=i;if("complex64"===s.dtype||"complex64"===o.dtype){const e=PY({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),t=l.data.get(e.dataId),r=t.complexTensorInfos.real,a=t.complexTensorInfos.imag,i=l.data.get(r.dataId).values,c=l.data.get(a.dataId).values,u=PY({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),d=h.complexTensorInfos.real,A=h.complexTensorInfos.imag,p=l.data.get(d.dataId).values,f=l.data.get(A.dataId).values,[m,g,y]=n(s.shape,o.shape,i,c,p,f),v=l.makeTensorInfo(y,"float32",m),b=l.makeTensorInfo(y,"float32",g),x=TY({inputs:{real:v,imag:b},backend:l});return l.disposeIntermediateTensorInfo(e),l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(b),x}{const e=l.data.get(s.dataId).values,n=l.data.get(o.dataId).values,a=r||s.dtype,[i,c]=t(s.shape,o.shape,e,n,a);return l.makeTensorInfo(c,a,i)}}}function zY(e){return(t,n,r,a,i,s)=>{const o=tF(t,n),l=XC(o),c=o.length,u=AE(o),h=aE("float32",l),d=aE("float32",l),A=$M(t,o),p=$M(n,o),f=VO(r,a),m=VO(i,s),g=t.length,y=AE(t),v=n.length,b=AE(n);if(A.length+p.length===0)for(let x=0;x<h.length;x++){const t=x%f.length,n=x%m.length,r=e(f[2*t],f[2*t+1],m[2*n],m[2*n+1]);h[x]=r.real,d[x]=r.imag}else for(let x=0;x<h.length;x++){const t=xE(x,c,u),n=t.slice(-g);A.forEach(e=>n[e]=0);const r=bE(n,g,y),a=t.slice(-v);p.forEach(e=>a[e]=0);const i=bE(a,v,b),s=e(f[2*r],f[2*r+1],m[2*i],m[2*i+1]);h[x]=s.real,d[x]=s.imag}return[h,d,o]}}const HY=vY((e,t)=>e+t),jY=zY((e,t,n,r)=>({real:e+n,imag:t+r})),QY=OY(RE,HY,jY),VY={kernelName:RE,backendName:"cpu",kernelFunc:QY};function WY(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=XC(a.shape),o=tE(i,s),l=XC(o);GC(s===l,()=>"The new shape (".concat(o,") has ").concat(l," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."),n.incRef(a.dataId);const c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.real,t=c.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:a.dataId,shape:o,dtype:a.dtype}}const GY={kernelName:jB,backendName:"cpu",kernelFunc:WY};function KY(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:s,transposeB:o}=r;oY([a,i],"matMul");const l=a.shape.length,c=i.shape.length,u=s?a.shape[l-2]:a.shape[l-1],h=o?i.shape[c-1]:i.shape[c-2],d=s?a.shape[l-1]:a.shape[l-2],A=o?i.shape[c-2]:i.shape[c-1],p=a.shape.slice(0,-2),f=i.shape.slice(0,-2),m=XC(p),g=XC(f),y=tF(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,A]);GC(u===h,()=>"Error in matMul: inner shapes (".concat(u,") and (")+"".concat(h,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(s)+" and transposeB=".concat(o," must match."));const v=o?[g,A,h]:[g,h,A],b=WY({inputs:{x:a},backend:n,attrs:{shape:s?[m,u,d]:[m,d,u]}}),x=WY({inputs:{x:i},backend:n,attrs:{shape:v}}),w=s?b.shape[1]:b.shape[2],_=s?b.shape[2]:b.shape[1],S=o?x.shape[1]:x.shape[2],C=Math.max(m,g),E=n.data.get(b.dataId).values,N=n.data.get(x.dataId).values,B=AE(b.shape),k=AE(x.shape),[I,T,M]=s?[B[0],1,B[1]]:[B[0],B[1],1],[F,R,L]=o?[1,k[1],k[0]]:[k[1],1,k[0]],U=_*S,P=NM([C,_,S],b.dtype),D=P.values,O=n.blockSize;for(let z=0;z<C;z++){const e=z%m,t=z%g;for(let n=0;n<_;n+=O){const r=Math.min(n+O,_);for(let a=0;a<S;a+=O){const i=Math.min(a+O,S);for(let s=0;s<w;s+=O){const o=Math.min(s+O,w);for(let l=n;l<r;l++)for(let n=a;n<i;n++){let r=0;for(let a=s;a<o;a++){r+=E[e*I+l*T+a*M]*N[a*F+n*R+t*L]}D[z*U+(l*S+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(y,P.dtype,P.values)}const qY={kernelName:XE,backendName:"cpu",kernelFunc:KY};const XY={kernelName:Ok,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;let d,A,p;const f=[];d=KY({inputs:{a:a,b:i},attrs:{transposeA:l,transposeB:c},backend:n}),s&&(A=QY({inputs:{a:d,b:s},backend:n}),f.push(d),d=A),u&&(p=IY(n,d,u,o,h),f.push(d),d=p);for(const m of f)n.disposeIntermediateTensorInfo(m);return d}};function YY(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const JY={kernelName:TE,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;oY(t,"abs");let r=new Float32Array(XC(t.shape));return r=YY(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},ZY=hY(ME,e=>Math.acos(e)),$Y={kernelName:ME,backendName:"cpu",kernelFunc:ZY},eJ=hY(FE,e=>Math.acosh(e)),tJ={kernelName:FE,backendName:"cpu",kernelFunc:eJ};const nJ={kernelName:LE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;oY(t,"addN");const a=r.map(e=>n.data.get(e.dataId).values),i=NM(r[0].shape,r[0].dtype),s=i.values;for(let o=0;o<r.length;o++){const e=a[o];for(let t=0;t<s.length;t++)s[t]+=e[t]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function rJ(e,t,n,r,a){const i=t.length,s=XC(t),o=AE(t),l=AE(a),c=aE(n,XC(a));for(let u=0;u<s;++u){const t=xE(u,i,o),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];c[bE(n,i,l)]=e[u]}return c}function aJ(e){const{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:i}=n;oY(a,"transpose");const s=a.shape.length,o=new Array(s);for(let c=0;c<o.length;c++)o[c]=a.shape[i[c]];const l=rJ(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(l,o,a.dtype),shape:o,dtype:a.dtype}}const iJ={kernelName:Tk,backendName:"cpu",kernelFunc:aJ};const sJ={kernelName:UE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;oY(a,"all");const o=nE(i,a.shape);let l=o;const c=_L(l,a.shape.length);let u=a;null!=c&&(u=aJ({inputs:{x:a},backend:n,attrs:{perm:c}}),l=CL(l.length,a.shape.length)),wL("all",l,u.shape.length);const[h,d]=bL(u.shape,l),A=XC(d),p=gE(XC(h),u.dtype),f=n.data.get(u.dataId).values;for(let g=0;g<p.length;++g){const e=g*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];t=t&&r}p[g]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:m},backend:n,attrs:{shape:xL(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const oJ={kernelName:PE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;oY(a,"any");const o=nE(i,a.shape);let l=o;const c=_L(l,a.shape.length);let u=a;null!=c&&(u=aJ({inputs:{x:a},backend:n,attrs:{perm:c}}),l=CL(l.length,a.shape.length)),wL("any",l,u.shape.length);const[h,d]=bL(u.shape,l),A=XC(d),p=gE(XC(h),u.dtype),f=n.data.get(u.dataId).values;for(let g=0;g<p.length;++g){const e=g*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];t=t||r}p[g]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:m},backend:n,attrs:{shape:xL(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}};const lJ={kernelName:DE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;oY(a,"argMax");let s=nE(i,a.shape);const o=_L(s,a.shape.length);let l=a;const c=[];null!=o&&(l=aJ({inputs:{x:a},backend:n,attrs:{perm:o}}),c.push(l),s=CL(s.length,l.shape.length)),s=[s[0]],wL("argMax",s,l.shape.length);const[u,h]=bL(l.shape,s),d=gE(XC(u),"int32"),A=XC(h),p=n.data.get(l.dataId).values;for(let f=0;f<d.length;++f){const e=f*A;let t=p[e],n=0;for(let r=0;r<A;++r){const a=p[e+r];a>t&&(t=a,n=r)}d[f]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}};const cJ={kernelName:OE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;oY(a,"argMin");let s=nE(i,a.shape);const o=_L(s,a.shape.length);let l=a;const c=[];null!=o&&(l=aJ({inputs:{x:a},backend:n,attrs:{perm:o}}),c.push(l),s=CL(s.length,l.shape.length)),s=[s[0]],wL("argMin",s,l.shape.length);const[u,h]=bL(l.shape,s),d=gE(XC(u),"int32"),A=XC(h),p=n.data.get(l.dataId).values;for(let f=0;f<d.length;++f){const e=f*A;let t=p[e],n=0;for(let r=0;r<A;++r){const a=p[e+r];a<t&&(t=a,n=r)}d[f]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}},uJ=hY(zE,e=>Math.asin(e)),hJ={kernelName:zE,backendName:"cpu",kernelFunc:uJ},dJ=hY(HE,e=>Math.asinh(e)),AJ={kernelName:HE,backendName:"cpu",kernelFunc:dJ},pJ=hY(jE,e=>Math.atan(e)),fJ={kernelName:jE,backendName:"cpu",kernelFunc:pJ},mJ=vY((e,t)=>Math.atan2(e,t)),gJ=OY(VE,mJ),yJ={kernelName:VE,backendName:"cpu",kernelFunc:gJ},vJ=hY(QE,e=>Math.atanh(e)),bJ={kernelName:QE,backendName:"cpu",kernelFunc:vJ};function xJ(e,t,n,r,a,i){const s=a.strideHeight,o=a.strideWidth,l=a.dilationHeight,c=a.dilationWidth,u=a.effectiveFilterHeight,h=a.effectiveFilterWidth,d=a.padInfo.top,A=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=NM(a.outShape,n),m=f.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],v=a.outShape[3];for(let b=0;b<a.batchSize;++b){const t=b*g,n=b*r[0];for(let f=0;f<a.inChannels;++f)for(let g=0;g<a.outHeight;++g){const b=g*s-d,x=Math.max(0,b),w=Math.min(a.inHeight,u+b),_=t+g*y;for(let t=0;t<a.outWidth;++t){const s=t*o-A,u=Math.max(0,s),d=Math.min(a.inWidth,h+s);let g=p,y=0,b=0;for(let t=x;t<w;t+=l){const a=n+t*r[1];for(let t=u;t<d;t+=c){const n=e[a+t*r[2]+f];"max"===i&&n>g?g=n:"avg"===i&&(y+=n,b++)}if(isNaN(g))break}m[_+t*v+f]="avg"===i?y/b:g}}}return f}function wJ(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=NM(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,A=r.padInfo.top,p=r.padInfo.left,f=NM(t,n,e);for(let m=0;m<r.batchSize;++m)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*o-A;let g=n;for(;g<0;)g+=c;const y=Math.min(r.inHeight,h+n);for(let o=0;o<r.outWidth;++o){const h=o*l-p;let A=h;for(;A<0;)A+=u;const v=Math.min(r.inWidth,d+h);let b=Number.NEGATIVE_INFINITY,x=-1;for(let t=g;t<y;t+=c){const s=t-n;for(let n=A;n<v;n+=u){const o=n-h,l=f.get(m,t,n,e);l>b&&(b=l,x=a?i?((m*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:s*d+o)}}s.set(x,m,t,o,e)}}return s}function _J(e,t,n,r,a,i){const s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,c=a.dilationDepth,u=a.dilationHeight,h=a.dilationWidth,d=a.effectiveFilterDepth,A=a.effectiveFilterHeight,p=a.effectiveFilterWidth,f=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=NM(a.outShape,n),b=v.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],_=a.outShape[3]*a.outShape[4],S=a.outShape[4];for(let C=0;C<a.batchSize;++C){const t=C*x,n=C*r[0];for(let v=0;v<a.inChannels;++v)for(let x=0;x<a.outDepth;++x){const C=x*s-f;let E=C;for(;E<0;)E+=c;const N=Math.min(a.inDepth,d+C),B=t+x*w;for(let t=0;t<a.outHeight;++t){const s=t*o-m;let d=s;for(;d<0;)d+=u;const f=Math.min(a.inHeight,A+s),x=B+t*_;for(let t=0;t<a.outWidth;++t){const s=t*l-g;let o=s;for(;o<0;)o+=h;const A=Math.min(a.inWidth,p+s),m=x+t*S;let w=y,_=0,C=0;for(let t=E;t<N;t+=c){const a=n+t*r[1];for(let t=d;t<f;t+=u){const n=a+t*r[2];for(let t=o;t<A;t+=h){const a=e[n+t*r[3]+v];if("max"===i&&a>w?w=a:"avg"===i&&(_+=a,C++),isNaN(w))break}if(isNaN(w))break}if(isNaN(w))break}b[m+v]="avg"===i?_/Math.max(C,1):w}}}}return v}const SJ={kernelName:WE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;oY(a,"avgPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;GC(bR(s,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=uR(a.shape,i,s,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&YC(c.inShape,c.outShape))u=fY({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=AE(a.shape),r=xJ(e,a.shape,a.dtype,t,c,"avg");u=n.makeTensorInfo(c.outShape,a.dtype,r.values)}return u}};const CJ={kernelName:KE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r;oY(a,"avgPool3d");const u=hR(a.shape,i,s,1,o,l,c),h=_J(n.data.get(a.dataId).values,a.shape,a.dtype,AE(a.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};const EJ={kernelName:qE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r;oY([a,i],"avgPool3DGrad");const u=hR(i.shape,s,o,1,l,c),h=u.strideDepth,d=u.strideHeight,A=u.strideWidth,p=u.filterDepth,f=u.filterHeight,m=u.filterWidth,g=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,b=u.effectiveFilterDepth,x=u.effectiveFilterHeight,w=u.effectiveFilterWidth,_=b-1-u.padInfo.front,S=w-1-u.padInfo.left,C=x-1-u.padInfo.top,E=NM(i.shape,"float32"),N=1/(p*f*m),B=n.bufferSync(a);for(let k=0;k<u.batchSize;++k)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const a=t-_,i=n-C,s=r-S;let o=0;for(let t=0;t<b;t+=g){const n=(a+t)/h;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let t=0;t<x;t+=y){const r=(i+t)/d;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let t=0;t<w;t+=v){const a=(s+t)/A;if(a<0||a>=u.outWidth||Math.floor(a)!==a)continue;o+=B.get(k,n,r,a,e)}}}E.set(o*N,k,t,n,r,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};const NJ={kernelName:GE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;oY([a,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=r,u=uR(s.shape,o,l,1,c),h=u.strideHeight,d=u.strideWidth,A=u.filterHeight,p=u.filterWidth,f=u.dilationHeight,m=u.dilationWidth,g=u.effectiveFilterHeight,y=u.effectiveFilterWidth,v=y-1-u.padInfo.left,b=g-1-u.padInfo.top,x=NM(s.shape,"float32"),w=1/(A*p),_=n.data.get(a.dataId).values,S=NM(a.shape,"float32",_);for(let C=0;C<u.batchSize;++C)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const r=t-b,a=n-v;let i=0;for(let t=0;t<g;t+=f){const n=(r+t)/h;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<y;t+=m){const r=(a+t)/d;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;i+=S.get(C,n,r,e)}}x.set(i*w,C,t,n,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const BJ={kernelName:HN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,scale:i,offset:s,mean:o,variance:l}=t;GC(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),GC(null==s||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),GC(null==i||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),oY([a,o,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;null==c&&(c=.001);const u=n.data.get(a.dataId).values,h=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,A=i?n.data.get(i.dataId).values:new Float32Array([1]),p=s?n.data.get(s.dataId).values:new Float32Array([0]),f=new Float32Array(u.length),m=p.length,g=A.length,y=d.length,v=h.length;let b=0,x=0,w=0,_=0;for(let S=0;S<u.length;++S)f[S]=p[b++]+(u[S]-h[x++])*A[w++]/Math.sqrt(d[_++]+c),b>=m&&(b=0),x>=v&&(x=0),w>=g&&(w=0),_>=y&&(_=0);return n.makeTensorInfo(a.shape,a.dtype,f)}};function kJ(e,t,n,r,a){const i=GF(r,t,n),s=XC(n),o=AE(r);if(i){const n=KF(t,o);return"string"===a?e.slice(n,n+s):e.subarray(n,n+s)}const l=NM(r,a,"string"===a?Sz(e):e),c=NM(n,a);for(let u=0;u<c.size;++u){const e=c.indexToLoc(u),n=e.map((e,n)=>e+t[n]);c.set(l.get(...n),...e)}return"string"===a?Cz(c.values):c.values}function IJ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r;oY(a,"slice");const[o,l]=qF(a,i,s);RF(a,o,l);const c=kJ(n.data.get(a.dataId).values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,c)}const TJ={kernelName:nk,backendName:"cpu",kernelFunc:IJ};const MJ={kernelName:YE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;oY([a],"batchToSpaceND");const o=i.reduce((e,t)=>e*t),l=IO(a.shape,i,o),c=TO(l.length,i.length),u=MO(a.shape,i,o),h=FO(s,i.length),d=RO(u,s,i.length),A=WY({inputs:{x:a},backend:n,attrs:{shape:l}}),p=aJ({inputs:{x:A},backend:n,attrs:{perm:c}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:u}}),m=IJ({inputs:{x:f},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}};function FJ(e,t,n,r,a){const i=XC(r),s=gE(a,n);for(let o=0;o<e.length;o++){const n=e[o];if(n<0)throw new Error("Input x must be non-negative!");n>=a||(s[n]+=i>0?t[o]:1)}return s}function RJ(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=e.shape[0],i=e.shape[1],s=NM([a,n],t.dtype);for(let o=0;o<a;o++)for(let a=0;a<i;a++){const i=e.get(o,a);if(i<0)throw new Error("Input x must be non-negative!");i>=n||(r?s.set(1,o,i):t.size>0?s.set(s.get(o,i)+t.get(o,a),o,i):s.set(s.get(o,i)+1,o,i))}return s}const LJ={kernelName:JE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=FJ(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,o)}},UJ=vY((e,t)=>e&t),PJ=OY(ZE,UJ),DJ={kernelName:ZE,backendName:"cpu",kernelFunc:PJ};const OJ={kernelName:$E,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,o=tF(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},zJ=uY(e=>Math.ceil(e)),HJ=dY(tN,zJ),jJ={kernelName:tN,backendName:"cpu",kernelFunc:HJ},QJ=hY(nN,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),VJ={kernelName:nN,backendName:"cpu",kernelFunc:QJ},WJ={kernelName:aN,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(XC(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,s=a.complexTensorInfos.imag,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values;for(let c=0;c<o.length;c++){const e=o[c],t=l[c];r[c]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")}};function GJ(e,t,n,r){const a=iE(n,XC(t));if(r&&"string"!==n){let t=0;e.forEach(e=>{const n=XC(e.shape);a.set(e.vals,t),t+=n})}else{let r=0;e.forEach(e=>{const i="string"===n?Sz(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)a[o+t]=i[s++]}r+=e.shape[1]})}return a}function KJ(e){const{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}const qJ={kernelName:qN,backendName:"cpu",kernelFunc:KJ};function XJ(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=nE(a,t[0].shape)[0];bO(t.map(e=>e.shape),i);let s=xO(t.map(e=>e.shape),i);if(0===XC(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter(e=>XC(e.shape)>0);if(1===o.length)return fY({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){const e=o.map(e=>RY({inputs:{input:e},backend:n})),t=o.map(e=>KJ({inputs:{input:e},backend:n})),r=XJ({inputs:e,backend:n,attrs:{axis:i}}),a=XJ({inputs:t,backend:n,attrs:{axis:i}}),s=TY({inputs:{real:r,imag:a},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a),s}const l=o.map(e=>{const t=XC(e.shape.slice(i));return WY({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),c=l.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));s=xO(l.map(e=>e.shape),1);const u=1===l[0].shape[0],h=GJ(c,s,t[0].dtype,u),d=xO(o.map(e=>e.shape),i),A=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),A}const YJ={kernelName:iN,backendName:"cpu",kernelFunc:XJ};function JJ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=r;oY([a,i],"conv2d");const h=wR(l),d=dR(a.shape,i.shape,s,c,o,u,!1,h),A=d.filterHeight,p=d.filterWidth,f=d.dilationHeight,m=d.dilationWidth,g=d.padInfo.left,y=d.padInfo.top,v="channelsLast"===d.dataFormat,b=new BI(d.outShape,a.dtype),x=AE(a.shape),w=AE(i.shape),_=x[0],S=v?x[1]:x[2],C=v?x[2]:1,E=v?1:x[1],N=b.strides[0],B=v?b.strides[1]:b.strides[2],k=v?b.strides[2]:1,I=v?1:b.strides[1],T=n.data.get(a.dataId).values,M=n.data.get(i.dataId).values,F=b.values;for(let R=0;R<d.batchSize;++R){const e=R*_,t=R*N;for(let n=0;n<d.outHeight;++n){const r=t+n*B,a=n*d.strideHeight-y;for(let t=0;t<A;++t){const n=a+t*f;if(n<0||n>=d.inHeight)continue;const i=t*w[0],s=e+n*S;for(let e=0;e<d.outWidth;++e){const t=r+e*k,n=e*d.strideWidth-g;for(let e=0;e<p;++e){const r=n+e*m;if(r<0||r>=d.inWidth)continue;const a=s+r*C;let o=i+e*w[1];for(let e=0;e<d.inChannels;++e){const n=T[a+e*E];for(let e=0;e<d.outChannels;++e)F[t+e*I]+=n*M[o+e];o+=d.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,F)}const ZJ={kernelName:sN,backendName:"cpu",kernelFunc:JJ};const $J={kernelName:oN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;oY([a,i],"conv2dBackpropFilter");const h=wR(l),d=dR(a.shape,u,s,1,o,c,!1,h),{strideHeight:A,strideWidth:p,filterHeight:f,filterWidth:m}=d,g="channelsLast"===d.dataFormat,y=new BI(d.filterShape,"float32"),v=d.padInfo.left,b=d.padInfo.top,x=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,_=new BI(a.shape,a.dtype,x),S=new BI(i.shape,i.dtype,w);for(let C=0;C<f;++C){const e=Math.max(0,Math.ceil((b-C)/A)),t=Math.min(d.outHeight,(d.inHeight+b-C)/A);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((v-n)/p)),a=Math.min(d.outWidth,(d.inWidth+v-n)/p);for(let i=0;i<d.inChannels;++i)for(let s=0;s<d.outChannels;++s){let o=0;for(let l=0;l<d.batchSize;++l)for(let c=e;c<t;++c){const e=C+c*A-b;for(let t=r;t<a;++t){const r=n+t*p-v;o+=g?_.get(l,e,r,i)*S.get(l,c,t,s):_.get(l,i,e,r)*S.get(l,s,c,t)}}y.set(o,C,n,i,s)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const eZ={kernelName:lN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=r;oY([a,i],"conv2dBackpropInput");const h=AE(i.shape),d=AE(a.shape);let A=wR(c);const p=dR(s,i.shape,o,1,l,u,!1,A),f=new BI(p.inShape,"float32"),m=f.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,[v,b,x]=h,{batchSize:w,filterHeight:_,filterWidth:S,inChannels:C,inHeight:E,inWidth:N,outChannels:B,outHeight:k,outWidth:I,strideHeight:T,strideWidth:M}=p;A=p.dataFormat;const F=_-1-p.padInfo.top,R=S-1-p.padInfo.left,L="channelsLast"===A,U=f.strides[0],P=L?f.strides[1]:f.strides[2],D=L?f.strides[2]:1,O=L?1:f.strides[1],z=d[0],H=L?d[1]:d[2],j=L?d[2]:1,Q=L?1:d[1];for(let V=0;V<w;++V)for(let e=0;e<C;++e)for(let t=0;t<E;++t){const n=t-F,r=Math.max(0,Math.ceil(n/T)),a=Math.min(k,(_+n)/T);for(let i=0;i<N;++i){const s=i-R,o=Math.max(0,Math.ceil(s/M)),l=Math.min(I,(S+s)/M);let c=0;for(let t=r;t<a;++t){const r=t*T-n;for(let n=o;n<l;++n){const a=z*V+H*t+j*n,i=v*(_-1-r)+b*(S-1-(n*M-s))+x*e;for(let e=0;e<B;++e){c+=g[a+Q*e]*y[i+e]}}}m[U*V+P*t+D*i+O*e]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const tZ={kernelName:cN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r;oY([a,i],"conv3d");const c=AR(a.shape,i.shape,s,l,o),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:A,dilationHeight:p,dilationWidth:f,padInfo:m}=c,g=m.front,y=m.left,v=m.top,b=new BI(c.outShape,a.dtype),x=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,_=b.values,S=AE(a.shape),C=AE(i.shape);for(let E=0;E<c.batchSize;++E){const e=E*S[0],t=E*b.strides[0];for(let n=0;n<c.outDepth;++n){const r=t+n*b.strides[1],a=n*c.strideDepth-g;for(let t=0;t<u;++t){const n=a+t*A;if(n<0||n>=c.inDepth)continue;const i=t*C[0],s=e+n*S[1];for(let e=0;e<c.outHeight;++e){const t=r+e*b.strides[2],n=e*c.strideHeight-v;for(let e=0;e<h;++e){const r=n+e*p;if(r<0||r>=c.inHeight)continue;const a=i+e*C[1],o=s+r*S[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,r=e*c.strideWidth-y;for(let e=0;e<d;++e){const t=r+e*f;if(t<0||t>=c.inWidth)continue;const i=a+e*C[2],s=o+t*c.inChannels;let l=i;for(let e=0;e<c.inChannels;++e){const t=x[s+e];for(let e=0;e<c.outChannels;++e)_[n+e]+=t*w[l+e];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const nZ={kernelName:uN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r;oY([a,i],"conv3dBackpropFilterV2");const c=AE(a.shape),u=AE(i.shape),h=AR(a.shape,l,s,1,o),d=h.strideDepth,A=h.strideHeight,p=h.strideWidth,f=h.filterDepth,m=h.filterHeight,g=h.filterWidth,y=new BI(h.filterShape,"float32"),v=y.values,[b,x,w,_]=y.strides,S=n.data.get(i.dataId).values,[C,E,N,B]=u,k=n.data.get(a.dataId).values,[I,T,M,F]=c,R=h.padInfo.front,L=h.padInfo.left,U=h.padInfo.top;for(let P=0;P<f;++P){const e=Math.max(0,Math.ceil((R-P)/d)),t=Math.min(h.outDepth,(h.inDepth+R-P)/d),n=P*b;for(let r=0;r<m;++r){const a=Math.max(0,Math.ceil((U-r)/A)),i=Math.min(h.outHeight,(h.inHeight+U-r)/A),s=r*x+n;for(let n=0;n<g;++n){const o=Math.max(0,Math.ceil((L-n)/p)),l=Math.min(h.outWidth,(h.inWidth+L-n)/p),c=n*w+s;for(let s=0;s<h.inChannels;++s){const u=s*_+c;for(let c=0;c<h.outChannels;++c){let f=0;for(let u=0;u<h.batchSize;++u){const h=u*I,m=u*C;for(let u=e;u<t;++u){const e=(P+u*d-R)*T+h,t=u*E+m;for(let u=a;u<i;++u){const a=(r+u*A-U)*M+e,i=u*N+t;for(let e=o;e<l;++e){const t=e*B+i;f+=k[(n+e*p-L)*F+a+s]*S[t+c]}}}}v[u+c]=f}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const rZ={kernelName:hN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r;oY([a],"conv3dBackpropInputV2");const c=AE(a.shape),u=AE(i.shape),h=AR(l,i.shape,o,1,s),d=new BI(h.inShape,"float32"),A=d.values,[p,f,m,g]=d.strides,y=n.data.get(a.dataId).values,[v,b,x,w]=c,_=n.data.get(i.dataId).values,[S,C,E,N]=u,{batchSize:B,filterDepth:k,filterHeight:I,filterWidth:T,inChannels:M,inDepth:F,inHeight:R,inWidth:L,outChannels:U,outDepth:P,outHeight:D,outWidth:O,strideDepth:z,strideHeight:H,strideWidth:j}=h,Q=k-1-h.padInfo.front,V=I-1-h.padInfo.top,W=T-1-h.padInfo.left;for(let G=0;G<B;++G)for(let e=0;e<M;++e)for(let t=0;t<F;++t){const n=t-Q,r=Math.max(0,Math.ceil(n/z)),a=Math.min(P,(k+n)/z);for(let i=0;i<R;++i){const s=i-V,o=Math.max(0,Math.ceil(s/H)),l=Math.min(D,(I+s)/H);for(let c=0;c<L;++c){const u=c-W,h=Math.max(0,Math.ceil(u/j)),d=Math.min(O,(T+u)/j);let B=0;for(let t=r;t<a;++t){const r=t*z-n;for(let n=o;n<l;++n){const a=n*H-s;for(let i=h;i<d;++i){const s=v*G+b*t+x*n+w*i,o=S*(k-1-r)+C*(I-1-a)+E*(T-1-(i*j-u))+N*e;for(let e=0;e<U;++e){B+=y[s+e]*_[o+e]}}}}A[p*G+f*t+m*i+g*c+e]=B}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},aZ=hY(dN,e=>Math.cos(e)),iZ={kernelName:dN,backendName:"cpu",kernelFunc:aZ},sZ=hY(AN,e=>Math.cosh(e)),oZ={kernelName:AN,backendName:"cpu",kernelFunc:sZ};const lZ={kernelName:mN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:c}=r,[u,h,d,A]=a.shape,p=i.shape[0],[f,m]=o,g=NM([p,f,m,A],"float32"),y=n.data.get(i.dataId).values,v=n.data.get(s.dataId).values,b=n.data.get(a.dataId).values,x=AE(a.shape),w=AE(g.shape);for(let _=0;_<p;_++){const e=4*_,t=y[e],n=y[e+1],r=y[e+2],a=y[e+3],i=v[_];if(i>=u)continue;const s=f>1?(r-t)*(h-1)/(f-1):0,o=m>1?(a-n)*(d-1)/(m-1):0;for(let u=0;u<f;u++){const e=f>1?t*(h-1)+u*s:.5*(t+r)*(h-1);if(e<0||e>h-1)for(let t=0;t<m;t++)for(let e=0;e<A;e++){const n=e+t*w[2]+u*w[1]+_*w[0];g.values[n]=c}else if("bilinear"===l){const t=Math.floor(e),r=Math.ceil(e),s=e-t;for(let e=0;e<m;e++){const l=m>1?n*(d-1)+e*o:.5*(n+a)*(d-1);if(l<0||l>d-1){for(let t=0;t<A;t++){const n=t+e*w[2]+u*w[1]+_*w[0];g.values[n]=c}continue}const h=Math.floor(l),p=Math.ceil(l),f=l-h;for(let n=0;n<A;n++){let a=n+h*x[2]+t*x[1]+i*x[0];const o=b[a];a=n+p*x[2]+t*x[1]+i*x[0];const l=b[a];a=n+h*x[2]+r*x[1]+i*x[0];const c=b[a];a=n+p*x[2]+r*x[1]+i*x[0];const d=o+(l-o)*f,A=c+(b[a]-c)*f;a=n+e*w[2]+u*w[1]+_*w[0],g.values[a]=d+(A-d)*s}}}else for(let t=0;t<m;++t){const r=m>1?n*(d-1)+t*o:.5*(n+a)*(d-1);if(r<0||r>d-1){for(let e=0;e<A;e++){const n=e+t*w[2]+u*w[1]+_*w[0];g.values[n]=c}continue}const s=Math.round(r),l=Math.round(e);for(let e=0;e<A;e++){const n=e+s*x[2]+l*x[1]+i*x[0],r=e+t*w[2]+u*w[1]+_*w[0];g.values[r]=b[n]}}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const cZ={kernelName:pN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;oY(a,"cumprod");const l=_L([i],a.shape.length);let c=a;null!=l&&(c=aJ({inputs:{x:a},backend:n,attrs:{perm:l}}));const u=CL(1,a.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=HI(c.dtype,"int32"),d=mE(XC(c.shape),h),A=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],f=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let g=0;g<A.length;g+=p)for(let e=0;e<p;e++){const t=f(g,e);if(0===e)d[t]=s?1:A[t];else{const n=f(g,e-1);d[t]=s?A[n]*d[n]:A[t]*d[n]}}const m=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=aJ({inputs:{x:m},backend:n,attrs:{perm:SL(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(c),e}return m}};const uZ={kernelName:fN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;oY(a,"cumsum");const l=_L([i],a.shape.length);let c=a;null!=l&&(c=aJ({inputs:{x:a},backend:n,attrs:{perm:l}}));const u=CL(1,a.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=HI(c.dtype,"int32"),d=gE(XC(c.shape),h),A=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],f=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let g=0;g<A.length;g+=p)for(let e=0;e<p;e++){const t=f(g,e);if(0===e)d[t]=s?0:A[t];else{const n=f(g,e-1);d[t]=s?A[n]+d[n]:A[t]+d[n]}}const m=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=aJ({inputs:{x:m},backend:n,attrs:{perm:SL(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(c),e}return m}};const hZ={kernelName:gN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){const e=FJ(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,e)}if(2===a.shape.length){const e=RJ(n.bufferSync(a),n.bufferSync(i),s,o);return n.makeTensorInfo(e.shape,i.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};const dZ={kernelName:yN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r;GC("NHWC"===s,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s));const o=a.shape[0],l=a.shape[1],c=a.shape[2],u=a.shape[3],h=l*i,d=c*i,A=u/(i*i),p=n.data.get(a.dataId).values,f=new Float32Array(o*h*d*A);let m=0;for(let g=0;g<o;++g)for(let e=0;e<h;++e){const t=Math.floor(e/i),n=e%i;for(let e=0;e<d;++e){const r=Math.floor(e/i),a=(n*i+e%i)*A;for(let e=0;e<A;++e){const n=e+a+u*(r+c*(t+l*g));f[m++]=p[n]}}}return n.makeTensorInfo([o,h,d,A],a.dtype,f)}};function AZ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:c}=r;oY([a,i],"depthwiseConv2DNative");const u=AE(a.shape),h=AE(i.shape);let d=l;null==d&&(d=[1,1]),GC(bR(s,d),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(d,"'"));const A=dR(a.shape,i.shape,s,d,o,c,!0),{filterHeight:p,filterWidth:f,dilationHeight:m,dilationWidth:g,padInfo:y}=A,v=y.left,b=y.top,x=A.outChannels/A.inChannels,w=new BI(A.outShape,a.dtype),_=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,C=w.values;for(let E=0;E<A.batchSize;++E){const e=E*u[0],t=E*w.strides[0];for(let n=0;n<A.outHeight;++n){const r=t+n*w.strides[1],a=n*A.strideHeight-b;for(let t=0;t<p;++t){const n=a+t*m;if(n<0||n>=A.inHeight)continue;const i=t*h[0],s=e+n*u[1];for(let e=0;e<A.outWidth;++e){const t=r+e*w.strides[2],n=e*A.strideWidth-v;for(let e=0;e<f;++e){const r=n+e*g;if(r<0||r>=A.inWidth)continue;const a=i+e*h[1],o=s+r*A.inChannels;let l=t,c=a;for(let e=0;e<A.inChannels;++e){const t=_[o+e];for(let e=0;e<x;++e)C[l+e]+=t*S[c+e];l+=x,c+=x}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const pZ={kernelName:vN,backendName:"cpu",kernelFunc:AZ};const fZ={kernelName:bN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=r;oY([a,i],"depthwiseConv2dNativeBackpropFilter");const h=dR(a.shape,u,s,o,l,c,!0),{strideHeight:d,strideWidth:A,filterHeight:p,filterWidth:f}=h,m=new BI(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,v=h.outChannels/h.inChannels,b=n.data.get(a.dataId).values,x=new BI(a.shape,a.dtype,b),w=n.data.get(i.dataId).values,_=new BI(i.shape,i.dtype,w);for(let S=0;S<p;++S){const e=Math.max(0,Math.ceil((y-S)/d)),t=Math.min(h.outHeight,(h.inHeight+y-S)/d);for(let n=0;n<f;++n){const r=Math.max(0,Math.ceil((g-n)/A)),a=Math.min(h.outWidth,(h.inWidth+g-n)/A);for(let i=0;i<h.outChannels;++i){const s=Math.trunc(i/v),o=i%v;let l=0;for(let c=0;c<h.batchSize;++c)for(let o=e;o<t;++o){const e=S+o*d-y;for(let t=r;t<a;++t){const r=n+t*A-g;l+=x.get(c,e,r,s)*_.get(c,o,t,i)}}m.set(l,S,n,s,o)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const mZ={kernelName:xN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=r;oY([a,i],"depthwiseConv2DNativeBackpropInput");const h=AE(a.shape),d=AE(i.shape),A=dR(u,i.shape,s,o,l,c,!0),p=new BI(A.inShape,"float32"),f=p.values,[m,g,y]=p.strides,v=n.data.get(a.dataId).values,[b,x,w]=h,_=n.data.get(i.dataId).values,[S,C,E]=d,{batchSize:N,filterHeight:B,filterWidth:k,inChannels:I,inHeight:T,inWidth:M,outChannels:F,outHeight:R,outWidth:L,strideHeight:U,strideWidth:P}=A,D=B-1-A.padInfo.top,O=k-1-A.padInfo.left,z=F/I;for(let H=0;H<N;++H)for(let e=0;e<I;++e)for(let t=0;t<T;++t){const n=t-D,r=Math.max(0,Math.ceil(n/U)),a=Math.min(R,(B+n)/U);for(let i=0;i<M;++i){const s=i-O,o=Math.max(0,Math.ceil(s/P)),l=Math.min(L,(k+s)/P);let c=0;for(let t=r;t<a;++t){const r=t*U-n;for(let n=o;n<l;++n){const a=b*H+x*t+w*n,i=S*(B-1-r)+C*(k-1-(n*P-s))+E*e;for(let t=0;t<z;++t){c+=v[a+(e*z+t)]*_[i+t]}}}f[m*H+g*t+y*i+e]=c}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};const gZ={kernelName:wN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=XC(r.shape),i=n.data.get(r.dataId).values,s=NM([a,a],r.dtype),o=s.values;for(let c=0;c<i.length;c++)o[c*a+c]=i[c];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,s.dtype,s.values)}},yZ={kernelName:_N,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,c=n,u=c.data.get(a.dataId).values,h=a.shape.length,d=c.data.get(i.dataId).values,A=i.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:v,padInfo:b,strideHeight:x,strideWidth:w,filterHeight:_,filterWidth:S,dilationHeight:C,dilationWidth:E,outShape:N}=cR(a.shape,i.shape,s,o,"NHWC",l),B=XC(N),k=N.length,I=iE(a.dtype,B);for(let T=0;T<p;++T)for(let e=0;e<y;++e){const t=e*x-b.top;for(let n=0;n<v;++n){const r=n*w-b.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;++e){const n=t+e*C;if(n>=0&&n<f)for(let t=0;t<S;++t){const l=r+t*E;if(l>=0&&l<m){const r=bE([T,n,l,s],h,AE(a.shape)),c=bE([e,t,s],A,AE(i.shape)),p=u[r]+d[c];p>o&&(o=p)}}}I[bE([T,e,n,s],k,AE(N))]=o}}}return{dataId:c.write(pI(I,a.dtype),N,a.dtype),shape:N,dtype:a.dtype}}},vZ={kernelName:CN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:c}=r,u=n,h=fE(a.shape,u.data.get(a.dataId).values),d=fE(i.shape,u.data.get(i.dataId).values),{batchSize:A,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:_,dilationHeight:S,dilationWidth:C,outShape:E}=cR(a.shape,i.shape,o,l,"NHWC",c);GC(s.rank===E.length,()=>"Error in ".concat(CN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(s.rank));const N=fE(E,u.data.get(s.dataId).values),B=yE(i.shape,i.dtype);for(let k=0;k<A;++k)for(let e=0;e<g;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,s=0,o=0;for(let e=0;e<w;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*C;if(l>=0&&l<f){const r=h[k][n][l][a]+d[e][t][a];r>i&&(i=r,s=e,o=t)}}}B[s][o][a]+=N[k][e][n][a]}}}return{dataId:u.write(pI(B,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},bZ={kernelName:SN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,filter:i,dy:s}=t,{strides:o,pad:l,dilations:c}=r,u=n,h=fE(a.shape,u.data.get(a.dataId).values),d=fE(i.shape,u.data.get(i.dataId).values),{batchSize:A,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:_,dilationHeight:S,dilationWidth:C,outShape:E}=cR(a.shape,i.shape,o,l,"NHWC",c);GC(s.rank===E.length,()=>"Error in ".concat(SN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(s.rank));const N=fE(E,u.data.get(s.dataId).values),B=yE(a.shape,a.dtype);for(let k=0;k<A;++k)for(let e=0;e<g;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let a=0;a<m;++a){let i=Number.MIN_SAFE_INTEGER,s=t<0?0:t,o=r<0?0:r;for(let e=0;e<w;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*C;if(l>=0&&l<f){const r=h[k][n][l][a]+d[e][t][a];r>i&&(i=r,s=n,o=l)}}}B[k][s][o][a]+=N[k][e][n][a]}}}return{dataId:u.write(pI(B,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};const xZ={kernelName:EN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:i,options:s}=r,{contextOptions:o,imageOptions:l}=s||{},c=(null===l||void 0===l?void 0:l.alpha)||1,u=(null===o||void 0===o?void 0:o.contextType)||"2d";if("2d"!==u)throw new Error("Context type ".concat(o.contextType," is not supported by the CPU backend."));const h=i.getContext(u,(null===o||void 0===o?void 0:o.contextAttributes)||{});if(null==h)throw new Error("Could not get the context with ".concat(u," type."));const[d,A]=a.shape.slice(0,2),p=2===a.shape.length?1:a.shape[2],f=n.data.get(a.dataId).values,m="float32"===a.dtype?255:1,g=new Uint8ClampedArray(A*d*4);for(let v=0;v<d*A;++v){const e=[0,0,0,255*c];for(let n=0;n<p;n++){const t=f[v*p+n];if("float32"===a.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===a.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(t,"."));1===p?(e[0]=t*m,e[1]=t*m,e[2]=t*m):e[n]=t*m}const t=4*v;g[t+0]=Math.round(e[0]),g[t+1]=Math.round(e[1]),g[t+2]=Math.round(e[2]),g[t+3]=Math.round(e[3])}i.width=A,i.height=d;const y=new ImageData(g,A,d);return h.putImageData(y,0,0),a}},wZ=vY((e,t)=>e*t),_Z=zY((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),SZ=OY(wB,wZ,_Z),CZ={kernelName:wB,backendName:"cpu",kernelFunc:SZ};function EZ(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;let o;oY(a,"sum"),o="bool"===a.dtype?PY({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):fY({inputs:{x:a},backend:n});const l=o.shape.length,c=nE(i,o.shape),u=_L(c,l);let h=c,d=o;null!=u&&(d=aJ({inputs:{x:o},backend:n,attrs:{perm:u}}),h=CL(h.length,l)),wL("sum",h,d.shape.length);const[A,p]=bL(d.shape,h);let f=FY(n,A,HI(d.dtype,"int32"));const m=XC(p),g=n.data.get(f.dataId).values,y=n.data.get(d.dataId).values;for(let v=0;v<g.length;++v){const e=v*m;let t=0;for(let n=0;n<m;++n)t+=y[e+n];g[v]=t}if(s){const e=f;f=WY({inputs:{x:f},backend:n,attrs:{shape:xL(f.shape,c)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=u&&n.disposeIntermediateTensorInfo(d),f}const NZ={kernelName:ck,backendName:"cpu",kernelFunc:EZ};const BZ={kernelName:BN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=nz(a,i.length);az(s.length,l,i);const{path:c,steps:u}=iz(o,l),h=u.length;let d=null,A=s.length;const p=[];for(let f=0;f<h;++f){for(const e of u[f]){const{permutationIndices:t,expandDims:r}=rz(A,l[e]);let a;sz(t)?a=i[e]:(a=aJ({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const s=a.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);YC(a.shape,s)||(a=WY({inputs:{x:a},backend:n,attrs:{shape:s}}),p.push(a)),null===d?d=a:(d=SZ({inputs:{a:a,b:d},backend:n}),p.push(d))}f<h-1&&(c[f]>=0&&(d=EZ({inputs:{x:d},backend:n,attrs:{axis:c[f]-(s.length-A),keepDims:!1}}),p.push(d)),A--)}for(const f of p)f!==d&&n.disposeIntermediateTensorInfo(f);return d}};const kZ={kernelName:IN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:a}=t;oY([r,a],"eluGrad");const i=new Float32Array(XC(a.shape)),s=n.data.get(a.dataId).values,o=n.data.get(r.dataId).values;for(let l=0;l<s.length;++l){const e=s[l];i[l]=e>=0?o[l]:o[l]*(e+1)}return n.makeTensorInfo(a.shape,"float32",i)}},IZ=vY((e,t)=>e===t?1:0),TZ=OY(MN,IZ,null,"bool"),MZ={kernelName:MN,backendName:"cpu",kernelFunc:TZ},FZ=DO,RZ=OO,LZ=zO,UZ=HO,PZ=jO,DZ=QO,OZ=hY(TN,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+FZ*n);return t*(1-((((DZ*r+PZ)*r+UZ)*r+LZ)*r+RZ)*r*Math.exp(-n*n))}),zZ={kernelName:TN,backendName:"cpu",kernelFunc:OZ},HZ=uY(e=>Math.exp(e)),jZ=dY(FN,HZ,"float32"),QZ={kernelName:FN,backendName:"cpu",kernelFunc:jZ};function VZ(e){const{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:i}=r,s=a.shape.length,o=a.shape.slice();let l=i;return i<0&&(GC(-(s+1)<=i,()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")),l=s+i+1),o.splice(l,0,1),WY({inputs:{x:a},backend:n,attrs:{shape:o}})}const WZ={kernelName:RN,backendName:"cpu",kernelFunc:VZ},GZ=uY(e=>Math.expm1(e)),KZ=dY(LN,GZ),qZ={kernelName:LN,backendName:"cpu",kernelFunc:KZ},XZ=vY((e,t)=>e/t),YZ=OY(NN,XZ),JZ={kernelName:NN,backendName:"cpu",kernelFunc:YZ},ZZ=vY((e,t)=>e-t),$Z=zY((e,t,n,r)=>({real:e-n,imag:t-r})),e$=OY(Ck,ZZ,$Z),t$={kernelName:Ck,backendName:"cpu",kernelFunc:e$};function n$(e,t,n){const r=e.shape,a=r[0],i=r[1],s=n.data.get(e.dataId),o=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[a,i],u=XC(c),h=aE("float32",u),d=aE("float32",u);for(let m=0;m<a;m++){const e=IJ({inputs:{x:o},backend:n,attrs:{begin:[m,0],size:[1,i]}}),r=IJ({inputs:{x:l},backend:n,attrs:{begin:[m,0],size:[1,i]}}),a=TY({inputs:{real:e,imag:r},backend:n}),{real:s,imag:c}=r$(a,t,n),u=VO(s,c);for(let t=0;t<i;t++){const e=qO(u,t);h[m*i+t]=e.real,d[m*i+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(a)}const A=n.makeTensorInfo(c,"float32",h),p=n.makeTensorInfo(c,"float32",d),f=TY({inputs:{real:A,imag:p},backend:n});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),f}function r$(e,t,n){const r=XC(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,s=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((o=r)&o-1)){const a=a$(i,s,r,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",a.real),t=n.makeTensorInfo(o,"float32",a.imag),i=n.makeTensorInfo([],"float32",AI(r,"float32")),s=fY({inputs:{x:i},backend:n}),l=JZ.kernelFunc({inputs:{a:e,b:i},backend:n}),c=JZ.kernelFunc({inputs:{a:t,b:s},backend:n}),u=n.data.get(l.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:h}}return a}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let a=0;a<t;a++){let i=0,s=0;for(let r=0;r<t;r++){const o=JO(a*r,t,n),l=qO(e,r);i+=l.real*o.real-l.imag*o.imag,s+=l.real*o.imag+l.imag*o.real}n&&(i/=t,s/=t),XO(r,i,s,a)}return r}(VO(i,s),r,t);return WO(e)}var o}function a$(e,t,n,r,a){if(1===n)return{real:e,imag:t};const i=VO(e,t),s=n/2,o=GO(i),l=o.real,c=o.imag,u=[l.length],h=a.makeTensorInfo(u,"float32",l),d=a.makeTensorInfo(u,"float32",c),A=TY({inputs:{real:h,imag:d},backend:a}),p=KO(i),f=p.real,m=p.imag,g=[f.length],y=a.makeTensorInfo(g,"float32",f),v=a.makeTensorInfo(g,"float32",m),b=TY({inputs:{real:y,imag:v},backend:a}),x=a$(l,c,s,r,a),w=x.real,_=x.imag,S=[w.length],C=a.makeTensorInfo(S,"float32",w),E=a.makeTensorInfo(S,"float32",_),N=TY({inputs:{real:C,imag:E},backend:a}),B=a$(f,m,s,r,a),k=B.real,I=B.imag,T=[k.length],M=a.makeTensorInfo(T,"float32",k),F=a.makeTensorInfo(T,"float32",I),R=TY({inputs:{real:M,imag:F},backend:a}),L=YO(n,r),U=[L.real.length],P=a.makeTensorInfo(U,"float32",L.real),D=a.makeTensorInfo(U,"float32",L.imag),O=TY({inputs:{real:P,imag:D},backend:a}),z=SZ({inputs:{a:O,b:R},backend:a}),H=QY({inputs:{a:N,b:z},backend:a}),j=e$({inputs:{a:N,b:z},backend:a}),Q=RY({inputs:{input:H},backend:a}),V=RY({inputs:{input:j},backend:a}),W=KJ({inputs:{input:H},backend:a}),G=KJ({inputs:{input:j},backend:a}),K=XJ({inputs:[Q,V],backend:a,attrs:{axis:0}}),q=XJ({inputs:[W,G],backend:a,attrs:{axis:0}}),X=a.data.get(K.dataId).values,Y=a.data.get(q.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(Q),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(q),{real:X,imag:Y}}const i$={kernelName:UN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=XC(r.shape),i=r.shape[r.shape.length-1],s=WY({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=n$(s,!1,n),l=WY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}};function s$(e){const{backend:t,attrs:n}=e,{shape:r,value:a,dtype:i}=n,s=i||uE(a),o=iE(s,XC(r));return function(e,t){e.fill(t)}(o,a),t.makeTensorInfo(r,s,o)}const o$={kernelName:PN,backendName:"cpu",kernelFunc:s$};const l$={kernelName:DN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,i=r,s=aE(a.dtype,XC(a.shape)),[o,l,c,u]=a.shape,h=i.data.get(a.dataId).values;for(let d=0;d<o;d++){const e=d*c*l*u;for(let t=0;t<l;t++){const n=t*(c*u);for(let t=0;t<c;t++){const r=t*u;for(let a=0;a<u;a++){const i=Math.round(c-t-1),o=e+n+r+a;let l=h[o];if(i>=0&&i<c){l=h[e+n+i*u+a]}s[o]=l}}}}return{dataId:i.write(s,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},c$=uY(e=>Math.floor(e)),u$=dY(ON,c$),h$={kernelName:ON,backendName:"cpu",kernelFunc:u$},d$=vY((e,t)=>Math.floor(e/t)),A$=OY(zN,d$,null,"int32"),p$={kernelName:zN,backendName:"cpu",kernelFunc:A$};const f$={kernelName:zk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r;let f=JJ({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=f;if("NCHW"===u&&1===s.shape.length&&1!==s.shape[0]){const e=WY({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});f=QY({inputs:{a:f,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else f=QY({inputs:{a:f,b:s},backend:n});n.disposeIntermediateTensorInfo(e)}if(A){const e=f;if("NCHW"===u&&"prelu"===A&&1===o.shape.length&&1!==o.shape[0]){const e=WY({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});f=IY(n,f,A,e,p),n.disposeIntermediateTensorInfo(e)}else f=IY(n,f,A,o,p);n.disposeIntermediateTensorInfo(e)}return f}};const m$={kernelName:Hk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r;let f=AZ({inputs:{x:a,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=f;f=QY({inputs:{a:f,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(A){const e=f;f=IY(n,f,A,o,p),n.disposeIntermediateTensorInfo(e)}return f}};function g$(e,t,n,r,a,i,s,o,l){const c=NM([r,i],n);for(let u=0;u<r;u++){const n=[];let r=0;for(let t=0;t<a;t++){const i=e[u*a+t];r+=i*s[t],n.push(i)}if(r<0||r>=l/i)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(o));for(let e=0;e<i;e++)c.values[u*i+e]=t.get(...t.indexToLoc(r*i+e))}return c}const y$={kernelName:QN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=XC(r.shape),s=a.shape,o=s[s.length-1],[l,c,u,h]=LO(r,a);if(0===c)return n.makeTensorInfo(l,r.dtype,[]);const d=g$(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,c,o,u,h,r.shape,i);return n.makeTensorInfo(l,r.dtype,d.values)}};function v$(e,t,n){const r=NM(n,e.dtype);for(let a=0;a<r.size;++a){const n=r.indexToLoc(a).slice(),i=n[0],s=n[2],o=t.locToIndex([i,s]);n[2]=t.values[o];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(r.values[a]=e.values[l])}return r}const b$={kernelName:jN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r;oY([a,i],"gatherV2");const l=nE(s,a.shape)[0],c=n.data.get(i.dataId).values,u=a.shape[l];for(let v=0;v<c.length;++v){const e=c[v];GC(e<=u-1&&e>=0,()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(u-1,"]"))}let h=o;null==o&&(h=0);const d=XC(i.shape),A=_z(a,i,l,h),p=WY({inputs:{x:a},backend:n,attrs:{shape:[A.batchSize,A.outerSize,A.dimSize,A.sliceSize]}}),f=WY({inputs:{x:i},backend:n,attrs:{shape:[A.batchSize,d/A.batchSize]}}),m=[A.batchSize,A.outerSize,d/A.batchSize,A.sliceSize],g=n.bufferSync(f),y=v$(n.bufferSync(p),g,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(A.outputShape,y.dtype,y.values)}},x$=vY((e,t)=>e>t?1:0),w$=OY(VN,x$,null,"bool"),_$={kernelName:VN,backendName:"cpu",kernelFunc:w$},S$=vY((e,t)=>e>=t?1:0),C$=OY(WN,S$,null,"bool"),E$={kernelName:WN,backendName:"cpu",kernelFunc:C$};const N$={kernelName:KN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,a=XC(r.shape),i=r.shape[r.shape.length-1],s=WY({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),o=n$(s,!0,n),l=WY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}},B$=hY(XN,e=>Number.isFinite(e)?1:0,"bool"),k$={kernelName:XN,backendName:"cpu",kernelFunc:B$},I$=hY(YN,e=>Math.abs(e)===1/0?1:0,"bool"),T$={kernelName:YN,backendName:"cpu",kernelFunc:I$},M$=hY(JN,e=>Number.isNaN(e)?1:0,"bool"),F$={kernelName:JN,backendName:"cpu",kernelFunc:M$},R$=vY((e,t)=>e<t?1:0),L$=OY($N,R$,null,"bool"),U$={kernelName:$N,backendName:"cpu",kernelFunc:L$},P$=vY((e,t)=>e<=t?1:0),D$=OY(eB,P$,null,"bool"),O$={kernelName:eB,backendName:"cpu",kernelFunc:D$};function z$(e,t,n){const r=(t-e)/(n-1),a=gE(n,"float32");a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}const H$={kernelName:tB,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=z$(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}},j$=uY(e=>Math.log(e)),Q$=dY(nB,j$),V$={kernelName:nB,backendName:"cpu",kernelFunc:Q$},W$=hY(rB,e=>Math.log1p(e)),G$={kernelName:rB,backendName:"cpu",kernelFunc:W$},K$=vY((e,t)=>e&&t),q$=OY(aB,K$,null,"bool"),X$={kernelName:aB,backendName:"cpu",kernelFunc:q$},Y$=hY(iB,e=>e?0:1,"bool"),J$={kernelName:iB,backendName:"cpu",kernelFunc:Y$},Z$=vY((e,t)=>e||t),$$=OY(sB,Z$,null,"bool"),e0={kernelName:sB,backendName:"cpu",kernelFunc:$$};const t0={kernelName:oB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r;oY(a,"LRN");const c=a.shape[3],u=c-1,h=n.data.get(a.dataId).values,d=XC(a.shape),A=new Float32Array(d);function p(e){const t=e%c;let n=e-t+Math.max(0,t-i);const r=e-t+Math.min(t+i,u);let a=0;for(;n<=r;n++){const e=h[n];a+=e*e}return a}for(let f=0;f<d;f++){const e=p(f),t=h[f]*Math.pow(s+o*e,-l);A[f]=t}return n.makeTensorInfo(a.shape,a.dtype,A)}};const n0={kernelName:lB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=r;oY(s,"LRNGrad");const h=XC(s.shape),d=s.shape[3],A=n.data.get(s.dataId).values,p=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,m=new Float32Array(h),g=h;for(let y=0;y<g;y++){const e=y%d,t=y-e+Math.max(0,e-o),n=y-e+Math.min(d,e+o+1);let r=0;for(let a=t;a<n;a++)r+=Math.pow(p[a],2);r=c*r+l;for(let a=t;a<n;a++){let e=-2*c*u*p[a]*f[y]/r;y===a&&(e+=Math.pow(r,-u)),e*=A[y],m[a]+=e}}return n.makeTensorInfo(s.shape,a.dtype,m)}};function r0(e,t,n,r){const a=aE(r,XC(n));for(let i=0;i<a.length;++i){const n=i*t;let r=e[n];for(let a=0;a<t;++a){const t=e[n+a];(Number.isNaN(t)||t>r)&&(r=t)}a[i]=r}return a}function a0(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=n;let l=a.shape;const c=l.length,u=nE(i,l);let h=u;const d=_L(h,c);let A=o.data.get(a.dataId).values;if(null!=d){const e=new Array(c);for(let t=0;t<e.length;t++)e[t]=l[d[t]];A=rJ(A,l,a.dtype,d,e),h=CL(h.length,c),l=e}oY(a,"max"),wL("max",h,c);const[p,f]=bL(l,h),m=r0(A,XC(f),p,a.dtype),g=o.write(m,p,a.dtype);let y=p;if(s){y=xL(p,u)}return{dataId:g,shape:y,dtype:a.dtype}}const i0={kernelName:cB,backendName:"cpu",kernelFunc:a0},s0=vY((e,t)=>Math.max(e,t)),o0=OY(uB,s0),l0={kernelName:uB,backendName:"cpu",kernelFunc:o0};const c0={kernelName:hB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;oY(a,"maxPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;GC(bR(s,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=uR(a.shape,i,s,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&YC(c.inShape,c.outShape))u=fY({inputs:{x:a},backend:n});else{const e=n.data.get(a.dataId).values,t=AE(a.shape),r=xJ(e,a.shape,a.dtype,t,c,"max");u=n.makeTensorInfo(c.outShape,a.dtype,r.values)}return u}};const u0={kernelName:AB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r;oY(a,"maxPool3d");const u=hR(a.shape,i,s,1,o,l,c),h=_J(n.data.get(a.dataId).values,a.shape,a.dtype,AE(a.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};const h0={kernelName:pB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r;oY([a,i],"maxPool3DGrad");const u=hR(i.shape,s,o,1,l,c),h=function(e,t){const n=NM(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,A=t.padInfo.top,p=t.padInfo.left;for(let f=0;f<t.batchSize;++f)for(let m=0;m<t.inChannels;++m)for(let g=0;g<t.outDepth;++g){const y=g*r-d;let v=y;for(;v<0;)v+=s;const b=Math.min(t.inDepth,c+y);for(let r=0;r<t.outHeight;++r){const c=r*a-A;let d=c;for(;d<0;)d+=o;const x=Math.min(t.inHeight,u+c);for(let a=0;a<t.outWidth;++a){const A=a*i-p;let w=A;for(;w<0;)w+=l;const _=Math.min(t.inWidth,h+A);let S=Number.NEGATIVE_INFINITY,C=-1;for(let t=v;t<b;t+=s){const n=t-y;for(let r=d;r<x;r+=o){const a=r-c;for(let i=w;i<_;i+=l){const s=i-A,o=e.get(f,t,r,i,m);o>=S&&(S=o,C=n*u*h+a*u+s)}}}n.set(C,f,g,r,a,m)}}}return n}(n.bufferSync(i),u),d=u.strideDepth,A=u.strideHeight,p=u.strideWidth,f=u.dilationDepth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterDepth,v=u.effectiveFilterHeight,b=u.effectiveFilterWidth,x=y-1-u.padInfo.front,w=b-1-u.padInfo.left,_=v-1-u.padInfo.top,S=NM(i.shape,"float32"),C=n.bufferSync(a);for(let E=0;E<u.batchSize;++E)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const a=t-x,i=n-_,s=r-w;let o=0;for(let t=0;t<y;t+=f){const n=(a+t)/d;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let r=0;r<v;r+=m){const a=(i+r)/A;if(!(a<0||a>=u.outHeight||Math.floor(a)!==a))for(let i=0;i<b;i+=g){const l=(s+i)/p;if(l<0||l>=u.outWidth||Math.floor(l)!==l)continue;const c=y*v*b-1-h.get(E,n,a,l,e)===t*v*b+r*b+i?1:0;if(0===c)continue;o+=C.get(E,n,a,l,e)*c}}}S.set(o,E,t,n,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};const d0={kernelName:dB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;oY([i,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=uR(o.shape,l,c,1,u,h),A=n.data.get(o.dataId).values,p=NM(d.outShape,o.dtype,wJ(A,o.shape,o.dtype,d).values),f=d.strideHeight,m=d.strideWidth,g=d.dilationHeight,y=d.dilationWidth,v=d.effectiveFilterHeight,b=d.effectiveFilterWidth,x=b-1-d.padInfo.left,w=v-1-d.padInfo.top,_=NM(o.shape,"float32"),S=n.data.get(a.dataId).values,C=NM(a.shape,"float32",S);for(let E=0;E<d.batchSize;++E)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-w,a=n-x;let i=0;for(let t=0;t<v;t+=g){const n=(r+t)/f;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<b;r+=y){const s=(a+r)/m;if(s<0||s>=d.outWidth||Math.floor(s)!==s)continue;const o=v*b-1-p.get(E,n,s,e)===t*b+r?1:0;if(0===o)continue;i+=C.get(E,n,s,e)*o}}_.set(i,E,t,n,e)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}};const A0={kernelName:fB,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:l}=n,c=r;oY(a,"MaxPoolWithArgmax");const u=c.data.get(a.dataId).values,h=uR(a.shape,i,s,[1,1],o),[d,A]=function(e,t,n,r,a){const i=xJ(e,0,n,AE(t),a,"max"),s=wJ(e,t,n,a,!0,r);return[i.values,s.values]}(u,a.shape,a.dtype,l,h),p=c.write(d,h.outShape,a.dtype),f=c.write(A,h.outShape,a.dtype);return[{dataId:p,shape:h.outShape,dtype:a.dtype},{dataId:f,shape:h.outShape,dtype:"int32"}]}};const p0={kernelName:mB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=nE(i,a.shape),l=XC(bL(a.shape,o)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const h=PY({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(h);const d=YZ({inputs:{a:h,b:u},backend:n});c.push(d);const A=EZ({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:s}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),A}};const f0={kernelName:gB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;oY(a,"min");const o=nE(i,a.shape);let l=o;const c=_L(l,a.shape.length);let u=a;null!=c&&(u=aJ({inputs:{x:a},backend:n,attrs:{perm:c}}),l=CL(l.length,a.shape.length)),wL("min",l,u.shape.length);const[h,d]=bL(u.shape,l),A=XC(d),p=gE(XC(h),u.dtype),f=n.data.get(u.dataId).values;for(let g=0;g<p.length;++g){const e=g*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];(Number.isNaN(r)||r<t)&&(t=r)}p[g]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const m=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:m},backend:n,attrs:{shape:xL(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},m0=vY((e,t)=>Math.min(e,t)),g0=OY(yB,m0),y0={kernelName:yB,backendName:"cpu",kernelFunc:g0};const v0={kernelName:vB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,mode:s}=r;oY(a,"mirrorPad");const o=i.map((e,t)=>e[0]+a.shape[t]+e[1]),l=i.map(e=>e[0]),c=i.map((e,t)=>e[0]+a.shape[t]),u="reflect"===s?0:1,h=n.data.get(a.dataId).values,d=a.shape.length,A=AE(a.shape),p=XC(o),f=o.length,m=AE(o),g=aE(a.dtype,p);for(let y=0;y<p;y++){let e=xE(y,f,m);for(let n=0;n<f;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-u:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+u);e=e.map((e,t)=>e-l[t]);const t=bE(e,d,A);g[y]=h[t]}return{dataId:n.write(g,o,a.dtype),shape:o,dtype:a.dtype}}},b0=vY((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),x0=OY(bB,b0),w0={kernelName:bB,backendName:"cpu",kernelFunc:x0};function _0(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=a.shape.length;let o=i;if(-1===o&&(o=s-1),o!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(s," and dim was ").concat(o));const l=nE([o],a.shape),c=a0({inputs:{x:a},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=xL(c.shape,l),h=WY({inputs:{x:c},backend:n,attrs:{shape:u}}),d=e$({inputs:{a:a,b:h},backend:n}),A=jZ({inputs:{x:d},backend:n}),p=EZ({inputs:{x:A},backend:n,attrs:{axis:l,keepDims:!1}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:u}}),m=YZ({inputs:{a:A,b:f},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}const S0={kernelName:dk,backendName:"cpu",kernelFunc:_0};const C0={kernelName:xB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r;oY(a,"multinomial");const l=o?a:_0({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,d=[c,i],A=gE(XC(d),"int32");for(let p=0;p<c;++p){const e=p*u,t=new Float32Array(u-1);t[0]=h[e];for(let a=1;a<t.length;++a)t[a]=t[a-1]+h[e+a];const n=zU.alea(s.toString()),r=p*i;for(let a=0;a<i;++a){const e=n();A[r+a]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){A[r+a]=n;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",A)}};function E0(e,t,n){const r=AI(-1,n);return wZ([],t,r,e,n)}const N0={kernelName:_B,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;oY(r,"neg");const a=n.data.get(r.dataId).values,[i,s]=E0(a,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,i)}},B0=ED;const k0={kernelName:CB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r;oY(a,"NonMaxSuppression");const c=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,{selectedIndices:h}=B0(c,u,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},I0=ND;const T0={kernelName:EB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=r;oY(a,"NonMaxSuppressionPadded");const u=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,{selectedIndices:d,validOutputs:A}=I0(u,h,s,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([A]))]}},M0=BD;const F0={kernelName:NB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=r;oY(a,"NonMaxSuppressionWithScore");const u=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,d=s,A=o,p=l,f=c,{selectedIndices:m,selectedScores:g}=M0(u,h,d,A,p,f);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}},R0=vY((e,t)=>e!==t?1:0),L0=OY(SB,R0,null,"bool"),U0={kernelName:SB,backendName:"cpu",kernelFunc:L0};const P0={kernelName:kB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r;oY(a,"oneHot");const c=XC(a.shape),u=new Float32Array(c*s);u.fill(l);const h=n.data.get(a.dataId).values;for(let d=0;d<c;++d)h[d]>=0&&h[d]<s&&(u[d*s+h[d]]=o);return n.makeTensorInfo([...a.shape,s],i,u)}};function D0(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=RY({inputs:{input:r},backend:n}),t=D0({inputs:{x:e},backend:n}),a=KJ({inputs:{input:r},backend:n}),i=D0({inputs:{x:a},backend:n}),s=TY({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return s$({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const O0={kernelName:Lk,backendName:"cpu",kernelFunc:D0};const z0={kernelName:BB,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){const t=RY({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=KJ({inputs:{input:a},backend:r}),s=D0({inputs:{x:i},backend:r}),o=TY({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}return s$({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function H0(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return VZ({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,s=t[0].dtype;t.forEach(e=>{KC(i,e.shape,"All tensors passed to stack must have matching shapes"),GC(s===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=XJ({inputs:t.map(e=>{const t=VZ({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t}),backend:n,attrs:{axis:a}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}const j0={kernelName:IB,backendName:"cpu",kernelFunc:H0};const Q0={kernelName:TB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;oY(a,"pad");const o=i.map((e,t)=>e[0]+a.shape[t]+e[1]),l=i.map(e=>e[0]),c=n.data.get(a.dataId).values,u=XC(a.shape),h=a.shape.length,d=AE(a.shape),A=XC(o),p=o.length,f=AE(o),m=aE(a.dtype,A);0!==s&&m.fill(s);for(let g=0;g<u;g++){const e=xE(g,h,d).map((e,t)=>e+l[t]);m[bE(e,p,f)]=c[g]}return{dataId:n.write(m,o,a.dtype),shape:o,dtype:a.dtype}}},V0=vY((e,t)=>Math.pow(e,t)),W0=OY(MB,V0),G0={kernelName:MB,backendName:"cpu",kernelFunc:W0};function K0(e,t,n,r){const[a,i]=bL(e,r),s=HI(t,"int32"),o=gE(XC(a),s),l=XC(i);for(let c=0;c<o.length;++c){const e=c*l;let t=1;for(let r=0;r<l;++r)t*=n[e+r];o[c]=t}return{outVals:o,outShape:a,outDtype:s}}const q0={kernelName:RB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;oY(a,"prod");const o=a.shape.length,l=nE(i,a.shape),c=_L(l,o);let u=l,h=a;const d=[];null!=c&&(h=aJ({inputs:{x:a},backend:n,attrs:{perm:c}}),d.push(h),u=CL(u.length,o));const A=n.data.get(h.dataId).values,{outVals:p,outShape:f,outDtype:m}=K0(h.shape,h.dtype,A,u);let g=f;return s&&(g=xL(f,l)),d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(g,m,p)}};function X0(e,t,n,r){const a=[];let i=0;const s=t.length-1+n.length,o=new Array(s).fill(null).map(()=>[0]);!function(e,t){for(let n=0;n<e.length;++n){const r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];const e=t[c+1];for(let t=1;t<l+1;++t)o[c].push(t*e)}for(let c=0;c<e.length;++c){let r=e[c],s=e[c]+1;for(let e=0;e<n.length;++e){const a=n[e],i=e+t.length-1;if(i>=0){const e=o[i],t=e[e.length-1]-a[r];for(let n=r;n<s;++n)o[i].push(a[n+1]+t)}r=a[r],s=a[s]}s!==r&&(a.push([r,s]),i+=s-r)}return{outSplits:o,valueSlices:a,numValues:i}}function Y0(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function J0(e,t,n,r,a){const i=t.slice();i[0]=a;const s=iE(n,XC(i)),o=e.length;return function(e,t,n,r,a,i){const s=Y0(t,2)[1],o=Y0(i,2)[1];let l=0;for(const c of n)for(let t=c[0];t<c[1];++t){for(let n=0;n<r;++n)a[l*o+n]=e[t*s+n];++l}}(e,t,r,0===o?0:o/t[0],s,i),[s,i]}function Z0(e,t,n,r,a,i,s,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((e,r)=>{if(e<0||e>=n){const a=xE(r,t.length,AE(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}})}(i,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:u,numValues:h}=X0(i,s,e,l),d=function(e){const t=[];for(let n=0;n<e.length;++n){const r=iE("int32",e[n].length);t.push(r),e[n].forEach((e,t)=>r[t]=e)}return t}(c),A=J0(n,r,a,u,h);return[d,A[0],A[1]]}const $0={kernelName:LB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:o}=r,l=a.map(e=>n.data.get(e.dataId).values),c=a.map(e=>e.shape),u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,[d,A,p]=Z0(l,c,u,i.shape,i.dtype,h,s.shape),f=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(p,i.dtype,A);return f.concat([m])}},e1=2147483647;function t1(e,t,n,r,a,i,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const o=0===t.length,l=0===a.length,c=0===s.length,u=[];o||u.push(t[0]),l||u.push(a[0]),c||u.push(s[0]);for(let f=1;f<u.length;++f)if(u[f]!==u[f-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===u.length?1:u[0],d=iE("int32",h+1);d[0]=0;for(let f=0;f<h;++f){const t=o?e[0]:e[f],n=l?r[0]:r[f],a=c?i[0]:i[f];if(0===a)throw new Error("Requires delta != 0");let s;if(a>0&&n<t||a<0&&n>t)s=0;else if(s=Math.ceil(Math.abs((n-t)/a)),s>e1)throw new Error("Requires ((limit - start) / delta) <= ".concat(e1));d[f+1]=d[f]+s}const A=iE(n,d[h]);let p=0;for(let f=0;f<h;++f){const t=d[f+1]-d[f];let n=o?e[0]:e[f];const r=c?i[0]:i[f];for(let e=0;e<t;++e)A[p++]=n,n+=r}return[d,A]}const n1={kernelName:UB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[c,u]=t1(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],r.dtype,u)]}};var r1=wO;class a1{constructor(e,t,n,r,a,i,s,o,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=a,this.defaultValue=i,this.defaultValueShape=s,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=SO(c),this.raggedRank=CO(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===r1.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===r1.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case r1.VALUE_ROWIDS:return a1.getMaxWidthValueRowID(t);case r1.ROW_SPLITS:return a1.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(r1[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],a=0;for(let i=1;i<t;++i){const t=e[i];t!==r&&(r=t,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return s1(e,n)}calculateOutputSize(e){const t=this.valuesShape;EO(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=_O(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}calculateFirstParentOutputIndex(e,t,n){const r=Math.min(e,n),a=[];let i=0;for(let s=0;s<r;++s,i+=t)a.push(i);for(let s=r;s<e;++s)a.push(-1);return GC(a.length===e,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(e,t,n,r){const a=e.length,i=[];for(let s=0;s<a-1;++s){const a=e[s+1]-e[s];let o=Math.min(r,a),l=t[s];-1===l&&(o=0);for(let e=0;e<o;++e)i.push(l),l+=n;for(let e=0;e<a-o;++e)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,r){const a=e.length,i=[];if(0===a)return[];let s=0,o=e[0];if(o>=t.length)throw new Error("Got currentValueRowId=".concat(o,", which is not less than ").concat(t.length));let l=t[o];i.push(l);for(let c=1;c<a;++c){const a=e[c];if(a===o)l>=0&&(++s,s<r?l+=n:l=-1);else{if(s=0,o=a,a>=t.length)throw new Error("Got nextValueRowId=".concat(a," which is not less than ").concat(t.length));l=t[a]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,r){const a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case r1.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case r1.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(r1[i]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case r1.FIRST_DIM_SIZE:return e[0];case r1.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case r1.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(r1[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let i=n.length-2;i>=0;--i)n[i]=n[i+1]*t[i+1];const r=s1(t,!1),a=iE(this.valuesDType,XC(r));if(n[0]*t[0]>0){let i=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){i=this.calculateOutputIndex(e-1,i,n[e],t[e])}this.setOutput(this.raggedRank,i,a,r)}return[r,a]}setOutput(e,t,n,r){if(0===n.length)return;const a=this.values,i=n;let s=r.slice();s=s.slice(e+1);const o=XC(s),l=t.length;let c=this.defaultValue;if(c.length!==o&&1!==c.length){const e=this.defaultValueShape;vT(()=>{const t=SR(c,e),n=HR(t,s);c=n.dataSync()})}let u=0,h=0,d=0;for(let A=0;A<=l;++A){let e=A<l?t[A]:-1;if(e!==d){if(h<d){const e=a.subarray(u*o);i1(i.subarray(h*o),e,(d-h)*o)}if(A>=l){const t=n.length;e=Math.floor(t/o)}if(e>d)if(1===this.defaultValue.length)i.subarray(d*o,e*o).fill(this.defaultValue[0]),d=e;else for(;e>d;){i1(i.slice(d*o),c,o),++d}e<0?(u=A+1,h=d):(u=A,h=d,d=h+1)}else++d}}}function i1(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function s1(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error("Dimension ".concat(r," must be >= 0"));if(r<-1)throw new Error("Dimension ".concat(r," must be >= -1"));r=-1}n.push(r)}return n}function o1(e,t,n,r,a,i,s,o,l,c){return new a1(e,t,n,r,a,i,s,o,l,c).compute()}const l1={kernelName:PB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,c=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,d=o.map(e=>n.data.get(e.dataId).values),A=o.map(e=>e.shape),[p,f]=o1(c,a.shape,u,i.shape,i.dtype,h,s.shape,d,A,l);return n.makeTensorInfo(p,i.dtype,f)}};function c1(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return gE(0,r);const a=gE(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(let i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}const u1={kernelName:DB,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,dtype:i,step:s}=n,o=c1(r,a,s,i);return t.makeTensorInfo([o.length],i,o)}},h1=hY(zB,e=>1/e),d1={kernelName:zB,backendName:"cpu",kernelFunc:h1};const A1={kernelName:WB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;oY(a,"resizeBilinear");const l=AE(a.shape),[c,u]=o,[h,d,A,p]=a.shape,f=n.data.get(a.dataId).values,m=new Float32Array(XC([h,c,u,p])),g=[i&&c>1?d-1:d,i&&u>1?A-1:A],y=[i&&c>1?c-1:c,i&&u>1?u-1:u];let v=0;const b=g[0]/y[0],x=g[1]/y[1];for(let w=0;w<h;w++)for(let e=0;e<c;e++){let t;t=s?b*(e+.5)-.5:b*e;const n=Math.max(0,Math.floor(t)),r=t-n,a=Math.min(d-1,Math.ceil(t)),i=w*l[0]+n*l[1],o=w*l[0]+a*l[1];for(let e=0;e<u;e++){let t;t=s?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),a=t-n,c=Math.min(A-1,Math.ceil(t)),u=i+n*l[2],h=o+n*l[2],d=i+c*l[2],g=o+c*l[2];for(let e=0;e<p;e++){const t=f[u+e],n=f[h+e],i=t+(f[d+e]-t)*a,s=i+(n+(f[g+e]-n)*a-i)*r;m[v++]=s}}}return n.makeTensorInfo([h,c,u,p],"float32",m)}};const p1={kernelName:GB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;oY([i,a],"resizeBilinearGrad");const o=AE(a.shape),[l,c,u,h]=a.shape,[,d,A]=i.shape,p=new Float32Array(l*c*u*h),f=[s&&d>1?c-1:c,s&&A>1?u-1:u],m=[s&&d>1?d-1:d,s&&A>1?A-1:A],g=f[0]/m[0],y=f[1]/m[1],v=n.data.get(i.dataId).values;let b=0;for(let x=0;x<l;x++){const e=x*o[0];for(let t=0;t<d;t++){const n=t*g,r=Math.floor(n),a=Math.min(Math.ceil(n),c-1),i=e+r*o[1],s=e+a*o[1],l=n-r,d=1-l;for(let e=0;e<A;e++){const t=e*y,n=Math.floor(t),r=Math.min(Math.ceil(t),u-1),a=t-n,c=1-a,A=i+n*o[2],f=i+r*o[2],m=s+n*o[2],g=s+r*o[2],x=d*c,w=d*a,_=l*c,S=l*a;for(let e=0;e<h;e++){const t=v[b++];p[A+e]+=t*x,p[f+e]+=t*w,p[m+e]+=t*_,p[g+e]+=t*S}}}}return n.makeTensorInfo([l,u,c,h],"float32",p)}};const f1={kernelName:QB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r;oY(a,"resizeNearestNeighbor");const l=AE(a.shape),[c,u]=o,[h,d,A,p]=a.shape,f=n.data.get(a.dataId).values,m=new Float32Array(h*c*u*p),g=[i&&c>1?d-1:d,i&&u>1?A-1:A],y=[i&&c>1?c-1:c,i&&u>1?u-1:u],v=g[0]/y[0],b=g[1]/y[1];let x=0;for(let w=0;w<h;w++){const e=w*l[0];for(let t=0;t<c;t++){const n=s?v*(t+.5):v*t;let r=Math.min(d-1,i?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));const a=e+r*l[1];for(let e=0;e<u;e++){const t=s?b*(e+.5):b*e;let n=Math.min(A-1,i?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));const r=a+n*l[2];for(let e=0;e<p;e++){const t=f[r+e];m[x++]=t}}}}return n.makeTensorInfo([h,c,u,p],a.dtype,m)}};const m1={kernelName:VB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r;oY([i,a],"resizeNearestNeighborGrad");const o=AE(a.shape),l=AE(i.shape),[c,u,h,d]=a.shape,[,A,p]=i.shape,f=new Float32Array(c*u*h*d),m=n.data.get(i.dataId).values,g=[s&&A>1?u-1:u,s&&p>1?h-1:h],y=[s&&A>1?A-1:A,s&&p>1?p-1:p],v=g[0]/y[0],b=g[1]/y[1],x=1/v,w=1/b,_=2*Math.ceil(x)+2,S=2*Math.ceil(w)+2;for(let C=0;C<c;C++){const e=C*o[0];for(let t=0;t<u;t++){const n=e+t*o[1],r=Math.floor(t*x),a=Math.floor(r-_/2);for(let i=0;i<h;i++){const r=n+i*o[2],c=Math.floor(i*w),g=Math.floor(c-S/2);for(let n=0;n<d;n++){let o=0;for(let r=0;r<_;r++){const c=r+a;if(c<0||c>=A)continue;const d=e+c*l[1],f=c*v;if(t===Math.min(u-1,s?Math.round(f):Math.floor(f)))for(let e=0;e<S;e++){const t=e+g;if(t<0||t>=p)continue;const r=d+t*l[2],a=t*b;i===Math.min(h-1,s?Math.round(a):Math.floor(a))&&(o+=m[r+n])}}f[r+n]=o}}}}return n.makeTensorInfo(a.shape,a.dtype,f)}};const g1={kernelName:qB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r;oY(a,"reverse");const s=a.shape.length,o=nE(i,a.shape);if(0===s)return fY({inputs:{x:a},backend:n});const l=new BI(a.shape,a.dtype),c=n.bufferSync(a);for(let u=0;u<l.size;u++){const e=l.indexToLoc(u),t=e.slice();o.forEach(e=>t[e]=a.shape[e]-1-t[e]),l.set(c.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},y1={kernelName:Dk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:s,center:o}=n,l=r,c=aE(a.dtype,XC(a.shape)),[u,h,d,A]=a.shape,[p,f]=kO(o,h,d),m=Math.sin(i),g=Math.cos(i),y=l.data.get(a.dataId).values;for(let v=0;v<u;v++){const e=v*d*h*A;for(let t=0;t<h;t++){const n=t*(d*A);for(let r=0;r<d;r++){const a=r*A;for(let i=0;i<A;i++){const o=[u,t,r,i],l=o[2],v=o[1];let b=(l-p)*g-(v-f)*m,x=(l-p)*m+(v-f)*g;b=Math.round(b+p),x=Math.round(x+f);let w=s;if("number"!==typeof s&&(w=3===i?255:s[i]),b>=0&&b<d&&x>=0&&x<h){w=y[e+x*(d*A)+b*A+i]}c[e+n+a+i]=w}}}}return{dataId:l.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},v1=hY(XB,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),b1={kernelName:XB,backendName:"cpu",kernelFunc:v1},x1=uY(e=>1/Math.sqrt(e)),w1=dY(YB,x1),_1={kernelName:YB,backendName:"cpu",kernelFunc:w1};function S1(e,t,n,r,a,i,s,o,l,c){const u=[r/a,a],h=e.values,d=t.values;if(0===r)return NM(n,t.dtype);const A=l instanceof BI?l:NM(u,t.dtype);"string"===typeof l||"number"===typeof l?A.values.fill(l):"boolean"===typeof l&&A.values.fill(+l);for(let p=0;p<i;p++){const e=[];let i=0;for(let t=0;t<s;t++){const n=h[p*s+t];e.push(n),i+=n*o[t]}if(i<0||i>=r/a)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<a;n++)c?A.values[i*a+n]+=d[p*a+n]:A.values[i*a+n]=0===t.rank?d[0]:d[p*a+n]}return A}const C1={kernelName:JB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UP(0,a,s),d=S1(n.bufferSync(a),n.bufferSync(i),s,h,c,l,o,u,0,!0);return n.makeTensorInfo(s,d.dtype,d.values)}};function E1(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function N1(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}const B1={kernelName:$B,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=function(e,t,n,r,a,i){const s=iE("int32",n*a);for(let o=0;o<n;++o){const n=e.slice(o*r,(o+1)*r),l=o*a;for(let e=0;e<a;++e)s[l+e]="left"===i?E1(n,t[e+l]):N1(n,t[e+l])}return s}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],s);return n.makeTensorInfo(i.shape,"int32",o)}};const k1={kernelName:ek,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t;oY([r,a,i],"select");const s=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,u=HI(a.dtype,i.dtype),h=gE(XC(a.shape),u);let d=0;const A=0===s||s>1||1===a.shape.length?1:XC(a.shape.slice(1));for(let p=0;p<o.length;p++)for(let e=0;e<A;e++)1===o[p]?h[d++]=l[p]:h[d++]=c[p];return n.makeTensorInfo(a.shape,u,h)}},I1=UO,T1=PO,M1=hY(tk,e=>e>=0?T1*e:I1*(Math.exp(e)-1)),F1={kernelName:tk,backendName:"cpu",kernelFunc:M1},R1=hY(ik,e=>e<0?-1:e>0?1:0),L1={kernelName:ik,backendName:"cpu",kernelFunc:R1},U1=hY(rk,e=>Math.sin(e)),P1={kernelName:rk,backendName:"cpu",kernelFunc:U1},D1=hY(ak,e=>Math.sinh(e)),O1={kernelName:ak,backendName:"cpu",kernelFunc:D1},z1=Math.log(1.1920928955078125e-7)+2,H1=hY(ok,e=>{const t=e>-z1,n=e<z1,r=Math.exp(e);let a;return a=n?r:t?e:Math.log(1+r),a}),j1={kernelName:ok,backendName:"cpu",kernelFunc:H1};const Q1={kernelName:uk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;oY([a],"spaceToBatchND");const o=XC(i),l=[[0,0]];l.push(...s);for(let m=1+i.length;m<a.shape.length;++m)l.push([0,0]);const c=Q0.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),u=IO(c.shape,i,o,!1),h=TO(u.length,i.length,!1),d=MO(c.shape,i,o,!1),A=WY({inputs:{x:c},backend:n,attrs:{shape:u}}),p=aJ({inputs:{x:A},backend:n,attrs:{perm:h}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),f}};function V1(e,t,n,r,a,i,s){const o=t[0],l=i[0],c=new Array(l),u=new Array(o),h=t[1];if(0===l){if(0!==o)throw new Error(cz(o));return[iE(n,0),[0,h],iE(a,0),c,u]}let d=!0,A=0;const p=new Array(l).fill(0);for(let m=0;m<o;++m){const t=e[m*h];if(t<0)throw new Error(uz(m,t));if(t>=l)throw new Error(hz(m,t,l));++p[t],d=d&&t>=A,A=t}let f=!0;for(let m=0;m<l;++m){const e=0===p[m];c[m]=e,f=f&&!e,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(f&&d){const t=e,n=r;for(let e=0;e<o;++e)u[e]=e;return[t,[o,h],n,c,u]}{const t=p[l-1],i=iE(n,t*h),d=iE(a,t),A=new Array(l).fill(0);for(let n=0;n<o;++n){const t=e[n*h],a=A[t],s=(0===t?0:p[t-1])+a;A[t]++;for(let r=0;r<h;++r)i[s*h+r]=e[n*h+r];d[s]=r[n],u[n]=s}for(let e=0;e<l;++e){if(0===A[e]){const t=0===e?0:p[e-1];i[t*h+0]=e;for(let e=1;e<h;++e)i[t*h+e]=0;d[t]=s}}return[i,[t,h],d,c,u]}}const W1={kernelName:Ak,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));const o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values[0],[h,d,A,p,f]=V1(o,r.shape,r.dtype,l,a.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,A),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}};function G1(e,t,n,r,a){const i=XC(r),s=t[0],o=a.length,l=[];let c=1,u=-1;for(let f=0;f<o;++f){const e=a[f];if(-1===e){if(-1!==u)throw new Error(dz(u,f));u=f,l.push(1)}else{if(e<0)throw new Error(Az(f,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(i/c);if(c*e!==i)throw new Error(fz(r,l));l[u]=e}if(XC(l)!==i)throw new Error(mz(r,l));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}const A=[];if(o>0){A[o-1]=1;for(let e=o-2;e>=0;--e)A[e]=A[e+1]*l[e+1]}const p=iE(n,s*o);for(let f=0;f<s;++f){let t=0;for(let n=0;n<h;++n)t+=e[f*h+n]*d[n];for(let e=0;e<o;++e)p[f*o+e]=Math.trunc(t/A[e]),t%=A[e]}return[p,[s,o],l]}const K1={kernelName:pk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const s=Array.from(n.data.get(a.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(i.dataId).values),[c,u,h]=G1(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};function q1(e,t,n,r,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o=r.length,l=[t[0],e.length/t[0]],c=l[1],u=o>0?a[o-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=u;const d=iE(n,h.reduce((e,t)=>e*t,1));if(0===o)return u>0&&d.fill(s),[d,h];if(u<=0)throw new Error("segment ids must be >= 0");let A=0,p=1,f=0,m=a[A];for(;;){let t=0;if(p<o){if(t=a[p],m===t){++p;continue}if(m>=t)throw new Error(yz())}if(m<0||m>=u)throw new Error(vz(m,u));m>f&&d.fill(s,f*c,m*c);for(let n=A;n<p;++n){const t=r[n];if(t<0||t>=l[0])throw new Error(bz(n,r[n],l[0]));for(let n=0;n<c;n++)d[m*c+n]+=e[t*c+n]}if(i)for(let e=0;e<c;e++)d[m*c+e]/=p-A;if(A=p,++p,f=m+1,m=t,p>o)break}return f<u&&d.fill(s,f*c,u*c),[d,h]}const X1={kernelName:fk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[c,u]=q1(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};const Y1={kernelName:mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,[c,u]=q1(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,c)}};const J1={kernelName:gk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=UP(0,a,o),A=!1,p=n.bufferSync(a);let f;switch(i.dtype){case"bool":f=S1(p,n.bufferSync(i),o,d,u,c,l,h,Boolean(n.data.get(s.dataId).values[0]),A);break;case"float32":f=S1(p,n.bufferSync(i),o,d,u,c,l,h,n.data.get(s.dataId).values[0],A);break;case"int32":f=S1(p,n.bufferSync(i),o,d,u,c,l,h,n.data.get(s.dataId).values[0],A);break;case"string":f=S1(p,n.bufferSync(i),o,d,u,c,l,h,gI(n.data.get(s.dataId).values[0]),A);break;default:throw new Error("Unsupported type ".concat(i.dtype))}return n.makeTensorInfo(o,f.dtype,f.values)}};const Z1={kernelName:hk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=nE(s,a.shape)[0],l=lz(a,i,o),c=new Array(a.shape.length).fill(0),u=a.shape.slice();return l.map(e=>{const t=[...u];t[o]=e;const r=IJ({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r})}},$1=uY(e=>Math.sqrt(e)),e2=hY(lk,e=>Math.sqrt(e)),t2={kernelName:lk,backendName:"cpu",kernelFunc:e2},n2={kernelName:vk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:r}=t,a=n;oY(r,"square");const i=a.data.get(r.dataId).values,s=new Float32Array(i.length);for(let o=0;o<i.length;++o){const e=i[o];s[o]=e*e}return{dataId:a.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},r2=vY((e,t)=>{const n=e-t;return n*n}),a2=OY(yk,r2),i2={kernelName:yk,backendName:"cpu",kernelFunc:a2},s2=uY((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)}),o2=dY(bk,s2),l2={kernelName:bk,backendName:"cpu",kernelFunc:o2},c2=hY(Uk,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),u2={kernelName:Uk,backendName:"cpu",kernelFunc:c2};function h2(e,t,n,r){const a=NM(e,t.dtype);for(let i=0;i<a.size;i++){const e=a.indexToLoc(i),s=new Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t]*n[t]+r[t];a.set(t.get(...s),...e)}return a}const d2={kernelName:xk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:s,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r;oY(a,"stridedSlice");const{finalShapeSparse:A,finalShape:p,isIdentity:f,sliceDim0:m,isSimpleSlice:g,begin:y,end:v,strides:b}=XF(a.shape,i,s,o,l,c,u,h,d);let x;if(f)x=WY({inputs:{x:a},backend:n,attrs:{shape:p}});else if(m||g){GC(a.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(a.shape.length));const e=UF(y,v,b),t=IJ({inputs:{x:a},backend:n,attrs:{begin:y,size:e}});x=WY({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=h2(A,n.bufferSync(a),b,y);x=n.makeTensorInfo(p,e.dtype,e.values)}return x}};class A2{constructor(e,t,n,r,a,i){this.separator=mI(e),this.nGramWidths=t,this.leftPad=mI(n),this.rightPad=mI(r),this.padWidth=a,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,i){for(let s=0;s<a;++s){const o=this.getPadWidth(i),l=Math.max(0,o-s),c=Math.max(0,o-(a-(s+1))),u=i-(l+c),h=t+(l>0?0:s-o);let d=0;d+=l*this.leftPad.length;for(let t=0;t<u;++t)d+=e[h+t].length;d+=c*this.rightPad.length;d+=(l+c+u-1)*this.separator.length,n[r+s]=new Uint8Array(d);const A=n[r+s];let p=0;const f=e=>e.forEach(e=>A[p++]=e);for(let e=0;e<l;++e)f(this.leftPad),f(this.separator);for(let t=0;t<u-1;++t)f(e[h+t]),f(this.separator);if(u>0){f(e[h+u-1]);for(let e=0;e<c;++e)f(this.separator),f(this.rightPad)}else{for(let e=0;e<c-1;++e)f(this.rightPad),f(this.separator);f(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let a=1;a<r;++a){let r=t[a]>=e;if(r=r&&t[a]<=n,!r)throw new Error("Invalid split value ".concat(t[a],", must be in [").concat(e,", ").concat(n,"]"));e=t[a]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const a=r-1,i=iE("int32",r);if(0===n||0===r){const e=new Array(n);for(let t=0;t<=a;++t)i[t]=0;return[e,i]}i[0]=0;for(let o=1;o<=a;++o){const e=t[o]-t[o-1];let n=0;this.nGramWidths.forEach(t=>{n+=this.getNumNGrams(e,t)}),this.preserveShort&&e>0&&0===n&&(n=1),i[o]=i[o-1]+n}const s=new Array(i[a]);for(let o=0;o<a;++o){const n=t[o];let r=i[o];if(this.nGramWidths.forEach(a=>{const i=t[o+1]-t[o],l=this.getNumNGrams(i,a);this.createNGrams(e,n,s,r,l,a),r+=l}),this.preserveShort&&r===i[o]){const a=t[o+1]-t[o];if(0===a)continue;const i=a+2*this.padWidth,l=1;this.createNGrams(e,n,s,r,l,i)}}return[s,i]}}function p2(e,t,n,r,a,i,s,o){return new A2(n,r,a,i,s,o).compute(e,t)}const f2={kernelName:wk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=t,d=n.data.get(u.dataId).values,A=n.data.get(h.dataId).values,[p,f]=p2(d,A,a,i,s,o,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",f)]}};function m2(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const a=t[0];let i=e.indexOf(a);for(;-1!==i;){const t=e.subarray(0,i);n&&0===t.length||r.push(t),i=(e=e.subarray(i+1)).indexOf(a)}return void(n&&0===e.length||r.push(e))}let a=0;for(let i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){const t=e.subarray(a,i);n&&0===t.length||r.push(t),a=i+1}}function g2(e,t,n){const r=e.length,a=[];let i=0,s=0;const o=new Array(r);for(let d=0;d<r;++d){const r=a.length;m2(e[d],t,n,a);const l=a.length-r;o[d]=l,i+=l,s=Math.max(s,l)}const l=iE("int32",2*i),c=new Array(i),u=[r,s];let h=0;for(let d=0;d<r;++d)for(let e=0;e<o[d];++e)l[2*h]=d,l[2*h+1]=e,c[h]=a[h],++h;return[l,c,u]}const y2={kernelName:_k,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==s.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(s.shape));const o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values[0],[c,u,h]=g2(o,l,a),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};function v2(e,t){const n=iE("int32",e.length);for(let r=0;r<e.length;++r)n[r]=dI(e[r]).modulo(t).getLowBitsUnsigned();return n}const b2={kernelName:Sk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const s=v2(n.data.get(i.dataId).values,a);return n.makeTensorInfo(i.shape,"int32",s)}},x2=hY(Ek,e=>Math.tan(e)),w2={kernelName:Ek,backendName:"cpu",kernelFunc:x2},_2=hY(Nk,e=>Math.tanh(e));const S2={kernelName:ZB,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:i}=t,{sliceRank:s,numUpdates:o,sliceSize:l,strides:c,outputSize:u}=UP(0,a,r.shape),h=n.bufferSync(a),d=n.bufferSync(i),A=n.bufferSync(r),p=S1(h,d,r.shape,u,l,o,s,c,A,!1);return n.makeTensorInfo(r.shape,p.dtype,p.values)}};function C2(e,t){const n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];const r=NM(n,e.dtype);for(let a=0;a<r.values.length;++a){const t=r.indexToLoc(a),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const i=e.locToIndex(n);r.values[a]=e.values[i]}return r}const E2={kernelName:Bk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;oY(a,"tile");const s=C2(n.bufferSync(a),i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},N2=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function B2(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;r>n;){if(r-n>600){const a=r-n+1,i=t-n+1,s=Math.log(a),o=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*o*(a-o)/a)*Math.sign(i-a/2);B2(e,t,Math.max(n,Math.floor(t-i*o/a+l)),Math.min(r,Math.floor(t+(a-i)*o/a+l)))}const a=e[t];let i=n,s=r;for(WC(e,n,t),N2(e[r],a)>0&&WC(e,n,r);i<s;){for(WC(e,i,s),i++,s--;N2(e[i],a)<0;)i+=1;for(;N2(e[s],a)>0;)s-=1}0===N2(e[n],a)?WC(e,n,s):(s+=1,WC(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function k2(e,t,n,r,a){const i=t[t.length-1],[s,o]=[e.length/i,i],l=aE(n,s*r),c=aE("int32",s*r);for(let h=0;h<s;h++){const t=h*o,n=e.subarray(t,t+o);let i=new Array(n.length);n.forEach((e,t)=>i[t]={value:e,index:t}),r<i.length&&(B2(i,r),i=i.slice(0,r)),a&&i.sort(N2);const s=h*r,u=l.subarray(s,s+r),d=c.subarray(s,s+r);for(let e=0;e<r;e++)u[e]=i[e].value,d[e]=i[e].index}const u=t.slice();return u[u.length-1]=r,[NM(u,n,l),NM(u,"int32",c)]}const I2={kernelName:kk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r;oY(a,"topk");const o=n.data.get(a.dataId).values,[l,c]=k2(o,a.shape,a.dtype,i,s);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};const T2={kernelName:Ik,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:c}=n,[u,h,d,A]=a.shape,[p,f]=null!=c?c:[h,d],m=[u,p,f,A],g=AE(a.shape),y=g[0],v=g[1],b=g[2],x=AE(m),w=x[0],_=x[1],S=x[2],C=aE(a.dtype,XC(m));C.fill(l);const E=r.data.get(a.dataId).values,N=r.data.get(i.dataId).values;for(let B=0;B<u;++B){const e=1===i.shape[0]?N:N.subarray(8*B,8*B+8);for(let t=0;t<p;++t)for(let n=0;n<f;++n)for(let r=0;r<A;++r){let a;const i=e[6]*n+e[7]*t+1;if(0===i)continue;const c=(e[0]*n+e[1]*t+e[2])/i,u=(e[3]*n+e[4]*t+e[5])/i,A=M2(c,d,o),p=M2(u,h,o);switch(s){case"nearest":a=R2(E,h,d,y,v,b,B,p,A,r,l);break;case"bilinear":a=L2(E,h,d,y,v,b,B,p,A,r,l);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(s))}C[B*w+t*_+n*S+r]=a}return r.makeTensorInfo(m,a.dtype,C)}return{dataId:r.write(C,m,a.dtype),shape:a.shape,dtype:a.dtype}}};function M2(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return QC(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return QC(0,n,t-1)}(e,t);case"nearest":return function(e,t){return QC(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function F2(e,t,n,r,a,i,s,o,l,c,u){return 0<=o&&o<t&&0<=l&&l<n?e[s*r+o*a+l*i+c]:u}function R2(e,t,n,r,a,i,s,o,l,c,u){return F2(e,t,n,r,a,i,s,Math.round(o),Math.round(l),c,u)}function L2(e,t,n,r,a,i,s,o,l,c,u){const h=Math.floor(o),d=Math.floor(l),A=h+1,p=d+1;return(A-o)*((p-l)*F2(e,t,n,r,a,i,s,h,d,c,u)+(l-d)*F2(e,t,n,r,a,i,s,h,p,c,u))+(o-h)*((p-l)*F2(e,t,n,r,a,i,s,A,d,c,u)+(l-d)*F2(e,t,n,r,a,i,s,A,p,c,u))}function U2(e,t,n,r){const a=nE(t,n)[0],i=[1,n[0],1];for(let p=0;p<a;p++)i[0]*=n[p];i[1]=n[a];for(let p=a+1;p<n.length;p++)i[2]*=n[p];const s=new Map,o=new Int32Array(n[a]),l=new BI(i,r,e),c=[],u=1===i[0]&&1===i[2];for(let p=0;p<n[a];p++){let t;if(u)t=e[p].toString();else{const e=[];for(let t=0;t<i[0];t++)for(let n=0;n<i[2];n++)e.push(l.get(t,p,n));t=e.join(",")}const n=s.get(t);if(null!=n)o[p]=n;else{const e=s.size;s.set(t,e),o[p]=e,c.push(p)}}const h=i.slice();h[1]=s.size;const d=new BI(h,r);c.forEach((e,t)=>{for(let n=0;n<i[0];n++)for(let r=0;r<i[2];r++)d.set(l.get(n,e,r),n,t,r)});const A=n.slice();return A[a]=h[1],{outputValues:d.values,outputShape:A,indices:o}}const P2={kernelName:Mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;oY(i,"unique");const s=r.data.get(i.dataId).values,{outputValues:o,outputShape:l,indices:c}=U2(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([c.length],"int32",c)]}};const D2={kernelName:Fk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const s=a.shape.length,o=a.shape[i],l=new Array(s-1);let c=0;for(let A=0;A<s;A++)A!==i&&(l[c++]=a.shape[A]);const u=new Array(s).fill(0),h=a.shape.slice();h[i]=1;const d=new Array(o);for(let A=0;A<d.length;A++){u[i]=A;const e=IJ({inputs:{x:a},backend:n,attrs:{begin:u,size:h}});d[A]=WY({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};const O2={kernelName:Rk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r;oY(a,"unsortedSegmentSum");const o=[],l=[],c=a.shape.length-i.shape.length;let u=i;for(let d=0;d<c;++d){const e=VZ({inputs:{input:u},backend:n,attrs:{dim:d+1}});u=e,l.push(e)}for(let d=0;d<s;++d){const e=AI(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=TZ({inputs:{a:t,b:u},backend:n}),i=PY({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),s=SZ({inputs:{a:i,b:a},backend:n}),c=EZ({inputs:{x:s},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(t),l.push(r),l.push(i),l.push(s),l.push(c)}const h=H0({inputs:o,backend:n,attrs:{axis:0}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}},z2=[XY,JY,$Y,tJ,VY,nJ,sJ,oJ,lJ,cJ,hJ,AJ,fJ,yJ,bJ,SJ,CJ,EJ,NJ,qY,BJ,MJ,LJ,DJ,OJ,DY,jJ,VJ,MY,WJ,YJ,ZJ,$J,eZ,tZ,nZ,rZ,iZ,oZ,lZ,cZ,uZ,hZ,dZ,pZ,fZ,mZ,gZ,yZ,vZ,bZ,xZ,BZ,pY,kZ,MZ,zZ,QZ,WZ,qZ,i$,o$,l$,h$,p$,f$,m$,y$,b$,_$,E$,mY,N$,qJ,k$,T$,F$,yY,U$,O$,H$,V$,G$,X$,J$,e0,t0,n0,i0,l0,c0,u0,h0,d0,A0,p0,f0,y0,v0,w0,C0,CZ,N0,k0,T0,F0,U0,P0,z0,j0,Q0,G0,wY,q0,$0,n1,l1,u1,LY,JZ,d1,SY,EY,GY,A1,p1,f1,m1,g1,y1,b1,_1,C1,B1,k1,F1,kY,L1,P1,O1,TJ,S0,j1,Q1,W1,K1,X1,Y1,J1,Z1,t2,n2,i2,l2,u2,d2,f2,y2,b2,t$,NZ,w2,{kernelName:Nk,backendName:"cpu",kernelFunc:_2},S2,E2,I2,T2,iJ,P2,D2,O2,O0];for(const n of z2)Xk(n);const H2={},j2={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Q2(e,t){if(!(e in H2)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if(EE().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete H2[e]},!1),EE().getBool("SOFTWARE_WEBGL_ENABLED")&&(j2.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",j2)||n.getContext("experimental-webgl",j2);return n.getContext("webgl2",j2)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;H2[e]=n}const n=H2[e];return null==n||n.isContextLost()?(delete H2[e],Q2(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),H2[e])}var V2,W2,G2;function K2(e,t){return[t,e]}function q2(e){const t=XC(e);return ZC(Math.ceil(t/4))}function X2(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Y2(e,t){const n=e;let r,a,i,s,o,l,c,u,h,d;return 2===EE().getNumber("WEBGL_VERSION")?(r=n.R32F,a=n.R16F,i=n.RGBA16F,s=n.RGBA32F,o=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=e.RGBA,a=e.RGBA,i=e.RGBA,s=n.RGBA,o=e.RGBA,c=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,l=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}function J2(e,t){const n=t();return EE().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(V2||(V2={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(W2||(W2={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(G2||(G2={}));function Z2(e){return!!(EE().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function $2(e,t){return l3(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}const e3=/ERROR: [0-9]+:([0-9]+):/g;function t3(e,t){const n=e3.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,s=a.map((e,t)=>$C((t+1).toString(),i)+e);let o=0;for(let h=0;h<s.length;h++)o=Math.max(s[h].length,o);const l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat($C(c[0],o)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function n3(e,t){if(J2(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function r3(e,t,n,r,a,i,s){const o=e.getAttribLocation(t,n);return-1!==o&&(J2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),J2(e,()=>e.vertexAttribPointer(o,a,e.FLOAT,!1,i,s)),J2(e,()=>e.enableVertexAttribArray(o)),!0)}function a3(e,t,n,r){J2(e,()=>function(e,t,n){c3(e,n),J2(e,()=>e.activeTexture(e.TEXTURE0+n)),J2(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,r)),J2(e,()=>e.uniform1i(n,r))}function i3(e,t,n){J2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),J2(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function s3(e,t){J2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),J2(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function o3(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function l3(e,t,n){const r=J2(e,()=>t());if(null==r)throw new Error(n);return r}function c3(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function u3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return XC(e.slice(0,e.length-t))}function h3(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function d3(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[u3(e),...h3(e)]),t}function A3(e){return e%2===0}function p3(e,t){if(YC(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(A3(n)&&A3(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&A3(e[0])&&A3(t[0])}let f3,m3;function g3(e,t){return null!=e.getExtension(t)}function y3(e){try{if(null!=Q2(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function v3(e){if(0===e)return!1;const t=Q2(e);if(1!==e){if(g3(t,"EXT_color_buffer_float"))return b3(t);const e="EXT_color_buffer_half_float";if(g3(t,e)){const n=t.getExtension(e);return function(e,t){const n=Y2(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),o}(t,n)}return!1}if(!g3(t,"OES_texture_float"))return!1;if(!g3(t,"WEBGL_color_buffer_float"))return!1;return b3(t)}function b3(e){const t=Y2(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function x3(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&GC("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend.")})}const w3=EE();function _3(){let e,t,n,r,a,i,s,o,l,c;return 2===EE().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",s="out vec4 outputColor;",o=EE().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",s="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:s,defineSpecialNaN:o,defineSpecialInf:l,defineRound:c}}function S3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=AE(t);return r.map((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / ").concat(t),s=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(s,";")}).join("")}function C3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=AE(t);return r.map((t,a)=>{const i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),s=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(s,";")}).join("")}function E3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=e.map((e,t)=>t),a=function(e,t){const n=e.length,r=e.map(e=>"".concat(t,"[").concat(e,"]")),a=new Array(n-1);a[n-2]=r[n-1];for(let i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map((t,r)=>{const i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),s=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(s,";")}).join("")}function N3(e){const t=AE(e).map(e=>e.toString());return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}w3.registerFlag("HAS_WEBGL",()=>w3.getNumber("WEBGL_VERSION")>0),w3.registerFlag("WEBGL_VERSION",()=>y3(2)?2:y3(1)?1:0),w3.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),w3.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===w3.get("WEBGL_VERSION")),w3.registerFlag("WEBGL_CPU_FORWARD",()=>!0),w3.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),w3.registerFlag("WEBGL_PACK",()=>w3.getBool("HAS_WEBGL")),w3.registerFlag("WEBGL_PACK_NORMALIZATION",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_CLIP",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_REDUCE",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_LAZILY_UNPACK",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_CONV_IM2COL",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>w3.getBool("WEBGL_PACK")),w3.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==f3){const t=Q2(e);f3=t.getParameter(t.MAX_TEXTURE_SIZE)}return f3}(w3.getNumber("WEBGL_VERSION"))),w3.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==m3){const t=Q2(e);m3=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,m3)}(w3.getNumber("WEBGL_VERSION"))),w3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=w3.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=Q2(e);return t=g3(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:g3(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),w3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>w3.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!nT()),w3.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=Q2(e);if(1===e){if(!g3(t,"OES_texture_float"))return!1}else if(!g3(t,"EXT_color_buffer_float"))return!1;return b3(t)}(w3.getNumber("WEBGL_VERSION"))),w3.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!w3.getBool("WEBGL_FORCE_F16_TEXTURES")&&w3.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),w3.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>v3(w3.getNumber("WEBGL_VERSION"))),w3.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=w3.getNumber("WEBGL_VERSION"))&&null!=Q2(e).fenceSync;var e}),w3.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>w3.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),w3.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}),w3.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>nT()?1:-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))}),w3.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),w3.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),w3.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),w3.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),w3.registerFlag("WEBGL_EXP_CONV",()=>!1),w3.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>w3.getBool("IS_TEST")),w3.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),w3.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),w3.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),w3.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);const B3="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:k3}=s;function I3(e,t,n){const r=[];if(e.forEach(e=>{const t=XC(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=z3(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))});const a=r.join("\n"),i=e.map(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?M3(e,r):T3(e,r);const i=e.shapeInfo.logicalShape,s=t.logicalShape;i.length<=s.length&&(a+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,o=k3(e.shapeInfo.logicalShape,t.logicalShape),l=O3(s),c=s-i;let u;const h=["x","y","z","w","u","v"];u=0===i?"":s<2&&o.length>=1?"coords = 0;":o.map(e=>"coords.".concat(h[e+c]," = 0;")).join("\n");let d="";d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(h[t+c])).join(", ");let A="return outputValue;";const p=1===XC(e.shapeInfo.logicalShape),f=XC(t.logicalShape),m=1===f;if(1!==i||p||m){if(p&&!m)A=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=i-2,t=i-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?A="return vec4(outputValue.x);":o.indexOf(e)>-1?A="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(A="return vec4(outputValue.xx, outputValue.zz);")}}else A="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(u,"\n      vec4 outputValue = get").concat(r,"(").concat(d,");\n      ").concat(A,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&YC(s,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const c=O3(l),u=k3(e.shapeInfo.logicalShape,t.logicalShape),h=l-o;let d;const A=["x","y","z","w","u","v"];d=0===o?"":l<2&&u.length>=1?"coords = 0;":u.map(e=>"coords.".concat(A[e+h]," = 0;")).join("\n");let p="";p=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(A[t+h])).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),s=t.texShape,o=_3(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(o);let c,u,h=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(F3,"\n    ").concat(R3,"\n    ").concat(L3,"\n  ");return t}(o);t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(YC(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");const a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2);let s=i,o="",l="b, r, c";for(let c=2;c<e.length-1;c++)s*=e[e.length-c-1],o="\n      int b".concat(c," = index / ").concat(s,";\n      index -= b").concat(c," * ").concat(s,";\n    ")+o,l="b".concat(c,", ")+l;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(l,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,s,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(o)):(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(YC(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){const t=C3(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(t,"\n    return ivec3(r, c, d);\n  }\n")}const r=S3(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){const t=C3(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(t,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}const r=S3(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=S3(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=S3(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,s,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(o)),n.packedInputs&&(h+=U3);return[h,l,u,a,c,i,n.userCode].join("\n")}function T3(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");const[a,i]=e.shapeInfo.texShape;if(1===a&&1===i)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const s=P3(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[o,l]=e.shapeInfo.texShape;return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(D3(e),"\n      }\n    ");const a=e.shapeInfo.texShape,i=a[0],s=a[1];if(1===s&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const o=P3(n);if(1===s)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(s,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(s,", index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&YC(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const e=i[0],n=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}const{newShape:s,keptDims:o}=rE(n),l=s;if(l.length<n.length){const n=H3(e,l),r=["row","col"];return"\n      ".concat(T3(n,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(j3(r,o),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(D3(e),"\n      }\n    ");const c=i[0],u=i[1],h=P3(r);if(1===u)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(c,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===c)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(u,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(c,", ").concat(u,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],s=n[2],{newShape:o,keptDims:l}=rE(n),c=o;if(c.length<n.length){const n=H3(e,c),r=["row","col","depth"];return"\n        ".concat(T3(n,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(j3(r,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(s,", 1)));\n        ").concat(D3(e),"\n      }\n    ");const u=e.shapeInfo.texShape,h=u[0],d=u[1],A=e.shapeInfo.flatOffset;if(d===i&&null==A)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(d===s&&null==A)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");const p=P3(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(s," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],s=n[2]*i,o=n[1]*s,{newShape:l,keptDims:c}=rE(n);if(l.length<n.length){const n=H3(e,l),r=["row","col","depth","depth2"];return"\n      ".concat(T3(n,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(j3(r,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(s,", ").concat(i,", 1)));\n        ").concat(D3(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],A=h[1],p="int stride2 = ".concat(r,"Shape[3];"),f="int stride1 = ".concat(r,"Shape[2] * stride2;"),m="int stride0 = ".concat(r,"Shape[1] * stride1;");if(A===o&&null==u)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(p,"\n        ").concat(f,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(A===i&&null==u)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const g=P3(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(p,"\n      ").concat(f,"\n      ").concat(m,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(g,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(s," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(A,", index + ").concat(g,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,s=t[2]*i,o=t[1]*s,{newShape:l,keptDims:c}=rE(t);if(l.length<t.length){const t=H3(e,l),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(T3(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(j3(n,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(o,", ").concat(s,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(D3(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],A=h[1];if(A===o&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(A===a&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=P3(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(s," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(A,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:i}=rE(t);if(a.length<t.length){const t=H3(e,a),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(T3(t),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(j3(n,i),");\n      }\n    ")}const s=t[5],o=t[4]*s,l=t[3]*o,c=t[2]*l,u=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(c,", ").concat(l,", ").concat(o,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(D3(e),"\n      }\n    ");const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,A=d[0],p=d[1];if(p===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(c,", ").concat(l,", ").concat(o,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(A,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===s&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(A,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const f=P3(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(c," + depth * ").concat(l," +\n          depth2 * ").concat(o," + depth3 * ").concat(s," + depth4 + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(A,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function M3(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=_3();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=_3();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");const s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(s[0],", ").concat(s[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=i[0],o=i[1],l=_3();if(null!=i&&YC(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(l.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(s,".0);\n\n        return ").concat(l.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(u,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){const r=[1,2],i=H3(e,n.slice(1)),s=["b","row","col"];return"\n        ".concat(M3(i,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(j3(s,r),");\n        }\n      ")}const o=_3();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(o.texture2D,"(").concat(r,", uv);\n    }\n  ");const l=s[0],c=s[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(c,", ").concat(h,", ").concat(u,", b, row, col);\n      return ").concat(o.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=_3();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");const i=e.shapeInfo.logicalShape,s=i.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=l[0],u=l[1],h=Math.ceil(i[s-1]/2);let d=h*Math.ceil(i[s-2]/2),A="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(h," + (col / 2)");for(let f=2;f<s-1;f++)A="int b".concat(f,", ")+A,d*=i[s-f-1],p="b".concat(f," * ").concat(d," + ")+p;return"\n    vec4 ".concat(r,"(").concat(A,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const F3="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",R3="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",L3="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",U3="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function P3(e){return"offset".concat(e)}function D3(e){const t=e.name,n=XC(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function O3(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function z3(e,t,n){const{newShape:r,keptDims:a}=rE(t),i=t.length,s=e&&3===i&&1===t[0],o=s?t.slice(1):r,l=!e&&i>1&&!YC(t,n)&&r.length<i||s;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:a}}function H3(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function j3(e,t){return t.map(t=>e[t]).join(", ")}function Q3(e,t,n,r){const a=n.map((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(e=>e.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=I3(a,s,t),l=function(e,t){const n=l3(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(J2(e,()=>e.shaderSource(n,t)),J2(e,()=>e.compileShader(n)),EE().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw t3(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,o),c=e.createProgram(l);return EE().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:i,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:i,outShapeInfo:s},V3(e,t,c)))}function V3(e,t,n){const r=[],a=[];let i,s,o,l=null,c=null;c=e.getUniformLocation(n,"NAN",!1),1===EE().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const a={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,"offset".concat(h),u)};t.enableShapeUniforms&&(a.shape=e.getUniformLocation(n,"".concat(h,"Shape"),u),a.texShape=e.getUniformLocation(n,"".concat(h,"TexShape"),u)),r.push(a)}if(t.enableShapeUniforms&&(i=e.getUniformLocation(n,"outShape",u),o=e.getUniformLocation(n,"outShapeStrides",u),s=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)a.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:r,customUniformLocations:a,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:o,outTexShapeLocation:s}}function W3(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((e,n)=>{const r=e.logicalShape,a=t[n],i=a.shape;if(!YC(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(e.isUniform&&a.isUniform)return;const s=e.texShape,o=a.isUniform?null:a.texData.texShape;if(!YC(s,o))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(o," must match"))})}function G3(e){return EE().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class K3{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=V2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=_3();this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?C3(["r","c","d"],e):S3(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class q3{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=V2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=_3();this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?C3(["r","c","d"],e):S3(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class X3{constructor(e){this.variableNames=["A"],this.outTexUsage=W2.DOWNLOAD;const t=_3();this.outputShape=e,this.userCode="\n      ".concat(B3,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class Y3{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=W2.DOWNLOAD;const t=_3();this.outputShape=e,this.userCode="\n      ".concat(B3,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const J3={R:0,G:1,B:2,A:3};class Z3{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=_3();this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let i="";for(let s=0;s<n.length;s++){const e=n[s];i+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(J3[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":N3(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(r.texture2D,"(A, uv);\n          ").concat(i,"\n        }\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")}}class $3{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=_3();this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let t=0;t<=1;t++){const a=2*i+t;r+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(i," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(i,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(a,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(a,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(a,"] = values[2];\n            } else {\n              result[").concat(a,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":N3(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(r,"\n\n          ").concat(n.output," = ").concat(a,";\n        }\n    ")}}function e5(e){const t=_3();return function(e,t){const n=l3(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(J2(e,()=>e.shaderSource(n,t)),J2(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function t5(e){return function(e,t){const n=l3(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return J2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),J2(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function n5(e){return function(e,t){const n=l3(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return J2(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),J2(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}function r5(e,t,n,r,a,i){!function(e,t){const n=EE().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const r="[".concat(e,"x").concat(t,"]"),a="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}(t,n);const s=function(e){return l3(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),o=e.TEXTURE_2D;return J2(e,()=>e.bindTexture(o,s)),J2(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),J2(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),J2(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),J2(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===EE().getNumber("WEBGL_VERSION")?J2(e,()=>e.texImage2D(o,0,r,t,n,0,a,i,null)):J2(e,()=>e.texStorage2D(o,1,r,t,n)),J2(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:s,texShape:[n,t]}}function a5(e){return e.internalFormatFloat}function i5(e){return e.internalFormatHalfFloat}function s5(e){return e.downloadTextureFormat}function o5(e){return e.internalFormatPackedFloat}function l5(e){return e.internalFormatPackedHalfFloat}function c5(e,t,n,r,a,i,s,o){const l=e,c=new Float32Array(function(e,t){const[n,r]=X2(e,t);return n*r*4}(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}class u5{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=EE().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,function(e,t){H2[e]=t}(t,e)):this.gl=Q2(t),e=this.gl,2===EE().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>J2(t,()=>t.createVertexArray()),this.bindVertexArray=e=>J2(t,()=>t.bindVertexArray(e)),this.deleteVertexArray=e=>J2(t,()=>t.deleteVertexArray(e)),this.getVertexArray=()=>J2(t,()=>t.getParameter(t.VERTEX_ARRAY_BINDING))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>J2(e,()=>t.createVertexArrayOES()),this.bindVertexArray=n=>J2(e,()=>t.bindVertexArrayOES(n)),this.deleteVertexArray=n=>J2(e,()=>t.deleteVertexArrayOES(n)),this.getVertexArray=()=>J2(e,()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===EE().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=$2(this.gl,e),g3(this.gl,t))this.textureHalfFloatExtension=$2(this.gl,t);else if(EE().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),g3(this.gl,r))this.colorBufferHalfFloatExtension=$2(this.gl,r);else if(EE().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",g3(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!g3(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=t5(this.gl),this.indexBuffer=n5(this.gl),this.framebuffer=function(e){return l3(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Y2(this.gl,this.textureHalfFloatExtension)}get debug(){return EE().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;J2(e,()=>e.finish()),J2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),J2(e,()=>e.deleteFramebuffer(this.framebuffer)),J2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),J2(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),J2(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=K2(t,n);return r5(e,a,i,a5(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=K2(t,n);return r5(e,a,i,i5(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=K2(t,n);return r5(e,a,i,s5(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){J2(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===EE().getNumber("WEBGL_VERSION")?J2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):J2(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===EE().getNumber("WEBGL_VERSION")?J2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):J2(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),J2(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){let s,o,l;J2(e,()=>e.bindTexture(e.TEXTURE_2D,t)),a instanceof Uint8Array?(s=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(n*r*4),o=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),2===EE().getNumber("WEBGL_VERSION")?J2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,s)):J2(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,s)),J2(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=X2(t,n);return r5(e,a,i,l5(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[a,i]=X2(t,n);return r5(e,a,i,o5(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(s3(this.gl,this.framebuffer),this.outputTexture=null),J2(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,r){const[a,i]=K2(t,n),s=new Uint8Array(t*n*4);return J2(e,()=>e.readPixels(0,0,a,i,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)),new Float32Array(s.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,a,i){return c5(this.gl,e,0,0,0,a,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n){const r=e.createBuffer();J2(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r));const a=16*t*n;return J2(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),J2(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),J2(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(EE().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(a,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=a}else EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const r=new Float32Array(t*n*4);return J2(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=e5(t));const n=function(e){return l3(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);J2(t,()=>t.attachShader(n,this.vertexShader)),J2(t,()=>t.attachShader(n,e)),function(e,t){if(J2(e,()=>e.linkProgram(t)),!EE().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&n3(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;J2(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),function(e,t,n){J2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),r3(e,t,"clipSpacePos",n,3,20,0)&&r3(e,t,"uv",n,2,20,12)}(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(J2(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&n3(this.gl,this.program),J2(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return l3(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),J2(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),a3(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,a]=X2(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&n3(this.gl,this.program),o3(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}J2(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),J2(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=$2(this.gl,2===EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await eE(()=>this.disposed||this.isQueryAvailable(e,EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in EE().platform&&(n=EE().platform.setTimeoutCustom.bind(EE().platform)),eE(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),i3(this.gl,e,this.framebuffer),this.debug&&o3(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(i3(this.gl,this.outputTexture,this.framebuffer),this.debug&&o3(this.gl)):s3(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;i3(r,e,this.framebuffer),this.debug&&o3(r),this.outputTexture=e,J2(r,()=>r.viewport(0,0,t,n)),J2(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),J2(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{mx:h5,XI:d5,Nk:A5,f6:p5,ct:f5,YG:m5,hH:g5,z3:y5,sG:v5,uM:b5,vS:x5,qB:w5,GG:_5,rq:S5,lg:C5,WR:E5,cu:N5,GE:B5,px:k5,jC:I5,He:T5,hE:M5,BF:F5,Dk:R5,cl:L5,_B:U5,ub:P5,_f:D5,Ku:O5,qy:z5,Zy:H5,bu:j5,zv:Q5,dH:V5,HS:W5,yH:G5,l3:K5,z9:q5,x6:X5,_m:Y5,eW:J5,GK:Z5,SP:$5,yr:e4,dl:t4,Dw:n4,xT:r4,_X:a4,wz:i4}=N;function s4(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>"".concat(e,".").concat(t))}function o4(e,t){return 1===t?[e]:s4(e,t)}class l4{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=G3(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=o4("rc",this.rank),t=O3(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),a=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(r,"\n\n            setOutput(vec4(").concat(a,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1");for(let t=2;t<this.rank;t++)a="".concat(e[e.length-1-t],",")+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){const e=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(e," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class c4{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length);let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2===1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(r,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(r>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){const n=t?E3(["r","c","d"],"inputShape"):S3(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":N3(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class u4{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const r=d4(t,n),a=A4(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const i=h4(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const e=this.freeTextures[a].pop();return this.usedTextures[a].push(e),e}let s;return r===G2.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===G2.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===G2.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===G2.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===G2.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(s),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const a=d4(n,r),i=A4(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);const s=h4(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=EE().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const l=this.usedTextures[i],c=l&&l.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function h4(e,t,n,r,a){const i=function(e,t){switch(e){case G2.PACKED_2X2_FLOAT32:return o5(t);case G2.PACKED_2X2_FLOAT16:return l5(t);case G2.UNPACKED_FLOAT32:return a5(t);case G2.UNPACKED_FLOAT16:return i5(t);case G2.PACKED_4X1_UNSIGNED_BYTE:return s5(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);let s;if(a){const[t,n]=X2(e[0],e[1]);s=t*n}else{const[t,n]=K2(e[0],e[1]);s=t*n}const o=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,i);return s*o}function d4(e,t){if(e===W2.UPLOAD)return G2.PACKED_2X2_FLOAT32;if(e===W2.RENDER||null==e)return function(e){return EE().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?G2.PACKED_2X2_FLOAT32:G2.UNPACKED_FLOAT32:e?G2.PACKED_2X2_FLOAT16:G2.UNPACKED_FLOAT16}(t);if(e===W2.DOWNLOAD||e===W2.PIXELS)return G2.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function A4(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class p4{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const f4="if (isnan(x)) return x;",m4="return abs(x);";const g4=f4+"\n  return (x < 0.0) ? 0.0 : x;\n",y4=f4+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",v4="return x;";class b4{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class x4{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length);const t=e.length,n=o4("rc",t),r=O3(t),a=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),s=t<=1?"rc":"vec2(".concat(i.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(a,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")}}const w4=WP,_4={};const S4=EE().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class C4 extends zC{nextDataId(){return C4.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!EE().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof u5)t=e;else{const n=Q2(EE().getNumber("WEBGL_VERSION"),e);t=new u5(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=Q2(EE().getNumber("WEBGL_VERSION"));t=new u5(e),this.binaryCache=((n=EE().getNumber("WEBGL_VERSION"))in _4||(_4[n]={}),_4[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new u4(this.gpgpu),this.numMBBeforeWarning=null==EE().global.screen?1024:EE().global.screen.height*EE().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new OC(this,gT())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,a,i){const s=this.makeTensorInfo(t,n),o=this.texData.get(s.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[r,a]},o.texShape=[r,a];const l=d3(t),c=new Z3(l,!1,i),u=this.runWebGLProgram(c,[s],n,[[r,a]]);return u.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(s),u.dataId}write(e,t,n){if((EE().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||EE().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:W2.UPLOAD,refCount:1}),r}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,r,a){if(EE().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:W2.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:a,slice:i,shape:s,isPacked:o}=t;if(null!=i){let t;t=o?new b4(s,v4):new p4(s,v4);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),a=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=fI()),"complex64"===r){u=VO(this.readSync(a.real.dataId),this.readSync(a.imag.dataId))}else u=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=fI()-c),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:r,slice:a,dtype:i,complexTensorInfos:s,isPacked:o}=t;if(null!=a){let t;t=o?new b4(r,v4):new p4(r,v4);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:i}],i),a=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),a}if(null!=n)return this.convertAndCacheOnCPU(e);if(EE().getBool("DEBUG")&&!EE().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===EE().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==i&&EE().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(t.texture.texture,...q2(r))}if(this.pendingRead.set(e,[]),"complex64"!==i&&await this.gpgpu.createAndWaitForFence(),"complex64"===i){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);c=VO(e[0],e[1])}else if(null==u)c=this.getValuesFromTexture(e);else{const e=XC(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const e=this.gpgpu.gl;J2(e,()=>e.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,c),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(e=>e(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&gT().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:r,shape:a,slice:i,dtype:s,isPacked:o,texture:l}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=o?new b4(a,v4):new p4(a,v4);const r=this.runWebGLProgram(n,[{dataId:e,shape:a,dtype:s}],s),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),u=gT().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>gI(e));return NM(e.shape,e.dtype,n)}catch(hS){throw new Error("Failed to decode encoded string bytes into utf-8")}return NM(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!Z2(n)){if(EE().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),a=XC(t);if(EE().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...q2(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const i=EE().getBool("WEBGL_PACK")&&!0===r,s=i?d3(t):t,o=i?new Y3(s):new X3(s),l=this.runWebGLProgram(o,[{shape:s,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const a=vI(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),i=vI(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(a);s.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),s.getExtraProfileInfo=()=>e.map((e,t)=>({name:i[t],ms:e})).map(e=>"".concat(e.name,": ").concat(e.ms)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:fI(),endMs:null}}endTimer(e){return EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=fI(),e)}async getQueryTime(e){if(EE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:a,isPacked:i,slice:s}=this.texData.get(e),o=s&&s.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,a,i)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S4;return EE().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&XC(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){jk("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return w4(e.shape,t)}packedUnaryOp(e,t,n){const r=new b4(e.shape,t),a=this.compileAndRun(r,[e],n);return gT().makeTensorFromTensorInfo(a)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=V5(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(EE().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,m4,e.dtype);const t=new p4(e.shape,m4),n=this.compileAndRun(t,[e]);return gT().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&lE(n[0])){const a=n.map(e=>mI(e));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return gT().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new x4(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new l4(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[u3(e.shape),...h3(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[u3(t),...h3(t)],i=new c4(a,n),s=[n],o=this.runWebGLProgram(i,[r],e.dtype,s,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:a,dtype:i}=n;if(null!=t){GC(XC(a)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const s=d3(a);let o;o=r?new q3(s):new K3(s);const l=[null!=t?t:q2(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,l,!0,t).dataId}}runWebGLProgram(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;const s=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(s.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===V2.DENSE){const t=null!=i?i:q2(e.outputShape);o.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===XC(s.shape))return o.values=aE(s.dtype,0),s;const l=[],c=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&XC(t.shape)<=EE().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!p3(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),l.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(s.dataId);const u={shape:s.shape,texData:o,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach(t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const i=t.texData.texShape,{useSqueezeShape:s,uniformShape:o,keptDims:l}=z3(e.packedInputs,t.shape,i);let c="",u="",h="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];c="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=AE(o);h="".concat(e[0]===i[1],"_").concat(e[e.length-1]===i[1])}}else u="".concat(o[0]>1,"_").concat(o[1]>1);const d=t.shape.length,A=2===o.length&&YC(t.shape,i),p=1===XC(t.shape),f=$M(t.shape,n.shape),m=!e.packedInputs&&d===n.shape.length&&YC(i,n.texData.texShape),g=e.packedInputs||o.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(d,"_").concat(m,"_").concat(s?l:"","_").concat(o.length,"_").concat(p,"_").concat(f,"_").concat(A,"_").concat(c,"_").concat(u,"_").concat(h,"_").concat(g,"_").concat(a)}else{const e=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(e,"_").concat(a)}});const a=e.userCode;let i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(EE().getNumber("WEBGL_VERSION")),i}(e,c,u),d=this.getAndSaveBinary(h,()=>Q3(this.gpgpu,e,c,u)),A=null!=this.activeTimers;let p;A&&(p=this.startTimer()),EE().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(W3(t.inShapeInfos,n),W3([t.outShapeInfo],[r]));const i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,s[0],s[1]):e.setOutputMatrixTexture(i.texture,s[0],s[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===EE().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){const r=n[l],{uniform:a,offset:i,shape:s,texShape:o}=t.variablesLocations[l];if(s){const{uniformShape:n}=z3(t.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(s,new Int32Array(n));break;case 2:e.gl.uniform2iv(s,new Int32Array(n));break;case 3:e.gl.uniform3iv(s,new Int32Array(n));break;case 4:e.gl.uniform4iv(s,new Int32Array(n))}}if(o&&e.gl.uniform2i(o,r.texData.texShape[0],r.texData.texShape[1]),null!=a)if(r.isUniform)if(XC(r.shape)<2)e.gl.uniform1f(a,r.uniformValues[0]);else{let t=r.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=r.texData.slice&&null!=i&&e.gl.uniform1i(i,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,a,l)}const o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=AE(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let l=0;l<t.program.customUniforms.length;++l){const n=t.program.customUniforms[l],r=t.customUniformLocations[l],i=a[l];if("float"===n.type)e.gl.uniform1fv(r,i);else if("vec2"===n.type)e.gl.uniform2fv(r,i);else if("vec3"===n.type)e.gl.uniform3fv(r,i);else if("vec4"===n.type)e.gl.uniform4fv(r,i);else if("int"===n.type)e.gl.uniform1iv(r,i);else if("ivec2"===n.type)e.gl.uniform2iv(r,i);else if("ivec3"===n.type)e.gl.uniform3iv(r,i);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(r,i)}}e.executeProgram()}(this.gpgpu,d,c,u,r),l.forEach(e=>this.disposeIntermediateTensorInfo(e)),A&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const f=EE().getNumber("WEBGL_FLUSH_THRESHOLD");if(f>0){const e=fI();e-this.lastGlFlushTime>f&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!EE().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===a){const e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,r,a)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!EE().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=vT(()=>{if(!EE().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=EE().getBool("DEBUG");EE().set("DEBUG",!1);const t=this.abs(OM(1e-8)).dataSync()[0];if(EE().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:a,texture:i,usage:s,isPacked:o}=t;if(null!=i)return;const l=null!=this.activeTimers;let c;l&&(c=fI());let u=t.texShape;if(null==u&&(u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=EE().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=EE().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&EE().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((t,n)=>n>=e.length-2?VC(e[n]):e[n]),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=rE(e);e=t.newShape}let a=XC(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);const s=null!=i&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(null==i||s)if(t){const t=u3(e);let n=2,r=2;e.length&&([n,r]=h3(e)),a=t*(n/2)*(r/2),i=ZC(a).map(e=>2*e)}else i=ZC(a);return i}(n,o),t.texShape=u),null!=a){const e=d3(n);let i,s=u[1],h=u[0];const d=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!o&&d||([s,h]=X2(u[0],u[1])),i=o?new $3(e,d):new Z3(e,d);const A=d?[h,s]:u,p=this.makeTensorInfo(A,r),f=this.texData.get(p.dataId);f.usage=d?W2.PIXELS:W2.UPLOAD,f.texShape=A,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),s,h,a);const m=[[h,s]],g=!0,y=this.runWebGLProgram(i,[p],r,m,g),v=this.texData.get(y.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,EE().get("ENGINE_COMPILE_ONLY")?this.disposeData(y.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(y.dataId)),this.disposeIntermediateTensorInfo(p),l&&(this.uploadWaitMs+=fI()-c)}else{const e=this.acquireTexture(u,s,r,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*oE(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(_S){throw _S}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await vO(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw t3(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:a,outShapeLocation:i,outShapeStridesLocation:s,outTexShapeLocation:o}=V3(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=a,e.outShapeLocation=i,e.outShapeStridesLocation=s,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:r,height:a,width:i,channels:s}=e,o=gT().backend;if(!o.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=o.writeTexture(r,t,n,a,i,s);return gT().makeTensorFromDataId(l,t,n,o)}}C4.nextDataId=0;rT()&&_T("webgl",()=>new C4,2);const E4="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class N4{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=tF(t,n),this.enableShapeUniforms=G3(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const B4="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class k4{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=tF(t,n);const a=this.outputShape.length;this.enableShapeUniforms=G3(a);let i="";if(r)if(0===a||1===XC(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=O3(a);if(i="\n          ".concat(e," coords = getOutputCoords();\n        "),1===a)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=o4("coords",a);this.enableShapeUniforms?i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= outShape[").concat(a," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= outShape[").concat(a," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):i+="\n            bool nextRowOutOfBounds =\n              (".concat(e[a-2]," + 1) >= ").concat(this.outputShape[a-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[a-1]," + 1) >= ").concat(this.outputShape[a-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(i,"\n\n        setOutput(result);\n      }\n    ")}}function I4(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const T4={kernelName:GN,backendName:"webgl",kernelFunc:I4};function M4(e){const{inputs:t,backend:n}=e,{real:r,imag:a}=t,i=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(i.dataId),o=I4({inputs:{x:r},backend:n}),l=I4({inputs:{x:a},backend:n});return s.complexTensorInfos={real:o,imag:l},i}const F4={kernelName:rN,backendName:"webgl",kernelFunc:M4},R4="return (a < 0.) ? b * a : a;",L4="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const U4={kernelName:ZN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:i}=r,s=n.makeTensorInfo([],"float32",AI(i,"float32")),o=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new k4(L4,a.shape,s.shape):new N4(R4,a.shape,s.shape),l=n.runWebGLProgram(o,[a,s],"float32");return n.disposeIntermediateTensorInfo(s),l}},P4="return (a < 0.) ? b * a : a;",D4="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const O4={kernelName:FB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:a}=t,i=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new k4(D4,r.shape,a.shape):new N4(P4,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},z4="if (isnan(x)) return x;";function H4(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:r,dtype:a}=e;return e=>{let{inputs:i,backend:s}=e;const{x:o}=i,l=s,c=a||o.dtype;if(l.shouldExecuteOnCPU([o])&&null!=r){const e=l.texData.get(o.dataId),t=r(e.values,c);return l.makeTensorInfo(o.shape,c,t)}let u;return u=EE().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new b4(o.shape,n):new p4(o.shape,t),l.runWebGLProgram(u,[o],c)}}function j4(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:r=!1,supportsComplex:a=!1,cpuKernelImpl:i,dtype:s}=e;return e=>{let{inputs:o,backend:l}=e;const{a:c,b:u}=o,h=l;if(a&&"complex64"===c.dtype){const e=h.texData.get(c.dataId),n=h.texData.get(u.dataId),[r,a]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(e=>{const[n,r]=e,a={dataId:n.dataId,dtype:n.dtype,shape:c.shape},i={dataId:r.dataId,dtype:r.dtype,shape:u.shape},s=new N4(t,c.shape,u.shape);return h.runWebGLProgram(s,[a,i],HI(n.dtype,r.dtype))}),i=M4({inputs:{real:r,imag:a},backend:h});return h.disposeIntermediateTensorInfo(r),h.disposeIntermediateTensorInfo(a),i}const d=s||HI(c.dtype,u.dtype);if(("string"===c.dtype||"string"===u.dtype||h.shouldExecuteOnCPU([c,u]))&&null!=i){const e=h.texData.get(c.dataId).values,t=h.texData.get(u.dataId).values,n="string"===c.dtype?Sz(e):e,r="string"===c.dtype?Sz(t):t,[a,s]=i(c.shape,u.shape,n,r,d),o=h.makeTensorInfo(s,d);return h.texData.get(o.dataId).values=a,o}let A;return A=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new k4(n,c.shape,u.shape,r):new N4(t,c.shape,u.shape),h.runWebGLProgram(A,[c,u],d)}}function Q4(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":g4;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":y4;if("prelu"===e)return t?D4:P4;if("leakyrelu"===e)return t?L4:R4;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class V4{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=G3(this.outputShape.length);const c=r?e[1]:e[2],u=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=a?"rc.z, i * 2":"i * 2, rc.z",A=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let f="",m="";s&&(f=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):l?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),m="result = activation(result);");const g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let y="rc.x",v="rc.x";e[0]<t[0]?y="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(v="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(f,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(y,";\n        int batchB = ").concat(v,";\n        for (int i = 0; i < ").concat(u,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(A[0]," * ").concat(p[0],");\n          result += (").concat(A[1]," * ").concat(p[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(g,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")}}const W4="return areal * breal - aimag * bimag;",G4="return areal * bimag + aimag * breal;";class K4{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=tF(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const q4="return a * b;";function X4(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=HI(r.dtype,a.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),i=new K4(W4,r.shape,a.shape),s=new K4(G4,r.shape,a.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:a.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:a.shape}],l=n.runWebGLProgram(i,o,"float32"),c=n.runWebGLProgram(s,o,"float32"),u=M4({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([r,a])){const e=n.texData.get(r.dataId),t=n.texData.get(a.dataId),[s,o]=F5(r.shape,a.shape,e.values,t.values,i),l=n.makeTensorInfo(o,i);return n.texData.get(l.dataId).values=s,l}let s;return s=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new k4(q4,r.shape,a.shape):new N4(q4,r.shape,a.shape),n.runWebGLProgram(s,[r,a],i)}const Y4={kernelName:wB,backendName:"webgl",kernelFunc:X4};function J4(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:i}=r,s=n,o=XC(a.shape),l=tE(i,o),c=XC(l);GC(o===c,()=>"The new shape (".concat(l,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements.");const u=s.texData.get(a.dataId);return!u.isPacked||p3(a.shape,l)||null!==u.texture&&p3(u.shape,l)?(s.incRef(a.dataId),{dataId:a.dataId,shape:l,dtype:a.dtype}):function(e,t,n){const r=[u3(e.shape),...h3(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[u3(t),...h3(t)],s=new c4(i,r),o=[r],l=n.runWebGLProgram(s,[a],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(a,l,s)}const Z4={kernelName:jB,backendName:"webgl",kernelFunc:J4};class $4{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];const s=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l="sumValue += dot(values * ".concat(JC(e)?e.toPrecision(2):e,", ones);")}let c="";a%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===o,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class e6{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:a,outSize:i}=e;this.outputShape=[r,i];let s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");let l="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let h="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(o,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(o,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let A="";a%n>0&&(A="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(A,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(c,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(c,";\n        if (").concat(1===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(l,");\n      }\n    ")}}function t6(e,t,n,r){const a=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=BO(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let i=e;for(let s=0;s<a.length;s++){const{inSize:o,windowSize:l,outSize:c}=a[s];let u,h;u="mean"===n?0===s?new $4({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},o):new $4({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c}):new e6({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},n),h=i,i=r.runWebGLProgram(u,[i],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return i}class n6{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;const r=O3(this.rank),a=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(a,"));\n    }\n    ")}}class r6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[t[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const r=O3(this.rank),a=s4("rc",this.rank),i=new Array(this.rank);for(let c=0;c<t.length;c++)i[t[c]]=a[c];const s="vec2(".concat(i.slice(-2).join(),")"),o="++".concat(a[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(i.join(),"), ").concat(s,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(l,";\n      if(").concat(o,") {\n        result[1] = ").concat(l,";\n      }\n      --").concat(a[this.rank-1],";\n      if(++").concat(a[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(l,";\n        if(").concat(o,") {\n          result[3] = ").concat(l,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function a6(e,t,n){const r=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new r6(e.shape,t):new n6(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function i6(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r;return function(e,t,n,r){const a=t,i=e.shape.length,s=nE(a,e.shape);let o=s;const l=_L(o,i),c=null!=l;let u=e;c&&(u=a6(e,l,r),o=CL(o.length,i)),wL("sum",o,i);const[h,d]=bL(u.shape,o);let A=h;n&&(A=xL(h,s));const p=XC(d),f=J4({inputs:{x:u},attrs:{shape:[XC(e.shape)/p,p]},backend:r}),m=t6(f,jI(e.dtype),"sum",r),g=J4({inputs:{x:m},attrs:{shape:A},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),c&&r.disposeIntermediateTensorInfo(u),g}(a,i,s,n)}const s6={kernelName:ck,backendName:"webgl",kernelFunc:i6};function o6(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:i}=r,s=n,o=a.shape.length,l=new Array(o);for(let u=0;u<l.length;u++)l[u]=a.shape[i[u]];let c;if(s.shouldExecuteOnCPU([a])){const e=s.texData.get(a.dataId).values,t=a4(e,a.shape,a.dtype,i,l);c=s.makeTensorInfo(l,a.dtype);s.texData.get(c.dataId).values=t}else c=a6(a,i,s);return c}const l6={kernelName:Tk,backendName:"webgl",kernelFunc:o6};function c6(e){let{a:t,b:n,transposeA:r,transposeB:a,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}=e;const u=t.shape.length,h=n.shape.length,d=r?t.shape[u-2]:t.shape[u-1],A=a?n.shape[h-1]:n.shape[h-2],p=r?t.shape[u-1]:t.shape[u-2],f=a?n.shape[h-2]:n.shape[h-1],m=t.shape.slice(0,-2),g=n.shape.slice(0,-2),y=XC(m),v=XC(g),b=tF(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([p,f]);GC(d===A,()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(A,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match."));const x=r?[y,d,p]:[y,p,d],w=a?[v,f,A]:[v,A,f],_=J4({inputs:{x:t},backend:i,attrs:{shape:x}}),S=J4({inputs:{x:n},backend:i,attrs:{shape:w}}),C=[_,S],E=Math.max(y,v),N=r?_.shape[1]:_.shape[2],B=null!=s,k=null!=o,I="leakyrelu"===c,T=null!=c?Q4(c,!0):null;let M;if((1===p||1===f)&&N>1e3&&!1===(B||k||I||null!=T)){let e=_,t=S;r&&(e=o6({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),C.push(e)),a&&(t=o6({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),C.push(t));const n=1===f;let s=e;1!==f&&(s=J4({inputs:{x:e},backend:i,attrs:{shape:[E,N,1]}}),C.push(s));const o=1===f?2:1;let l=t;n&&(l=J4({inputs:{x:t},backend:i,attrs:{shape:[E,1,N]}}),C.push(l));const c=X4({inputs:{a:s,b:l},backend:i});M=i6({inputs:{x:c},backend:i,attrs:{axis:o,keepDims:!0}}),C.push(c)}else{const e=HI(t.dtype,n.dtype),c=new V4(x,w,[E,p,f],r,a,B,T,k,I),u=[_,S];if(null!=s&&u.push(s),k&&u.push(o),I){const e=i.makeTensorInfo([],"float32",AI(l,"float32"));u.push(e),C.push(e)}M=i.runWebGLProgram(c,u,e)}const F=J4({inputs:{x:M},backend:i,attrs:{shape:b}});C.push(M);for(const R of C)i.disposeIntermediateTensorInfo(R);return F}const u6={kernelName:Ok,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;return c6({a:a,b:i,transposeA:l,transposeB:c,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:h,activation:u})}},h6="return abs(x);";const d6={kernelName:TE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=V5(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let a;return a=EE().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new b4(r.shape,h6):new p4(r.shape,h6),n.runWebGLProgram(a,[r],r.dtype)}},A6=H4({opSnippet:f4+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),p6={kernelName:ME,backendName:"webgl",kernelFunc:A6},f6=H4({opSnippet:f4+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),m6={kernelName:FE,backendName:"webgl",kernelFunc:f6},g6="return a + b;",y6=j4({opSnippet:g6,packedOpSnippet:g6,supportsComplex:!0,cpuKernelImpl:h5}),v6={kernelName:RE,backendName:"webgl",kernelFunc:y6};class b6{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}class x6{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}const w6={kernelName:LE,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,a=n;if(1===a.length)return I4({inputs:{x:a[0]},backend:r});if(a.length>EE().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(a.length/2),n=e({inputs:a.slice(0,t),backend:r}),i=e({inputs:a.slice(t),backend:r});return e({inputs:[n,i],backend:r})}const i=a.map(e=>e.dtype).reduce((e,t)=>HI(e,t)),s=a.map(e=>e.shape),o=EE().getBool("WEBGL_PACK")?new x6(a[0].shape,s):new b6(a[0].shape,s);return r.runWebGLProgram(o,a,i)}};const _6={kernelName:UE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=nE(i,a.shape);let c=l;const u=_L(c,o);let h=a;null!=u&&(h=o6({inputs:{x:a},backend:n,attrs:{perm:u}}),c=CL(c.length,o)),wL("all",c,o);const[d,A]=bL(h.shape,c),p=J4({inputs:{x:h},backend:n,attrs:{shape:[-1,XC(A)]}}),f=t6(p,p.dtype,"all",n);let m;if(s){m=J4({inputs:{x:f},backend:n,attrs:{shape:xL(d,l)}})}else m=J4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),m}};const S6={kernelName:PE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=nE(i,a.shape);let c=l;const u=_L(c,o);let h=a;null!=u&&(h=o6({inputs:{x:a},backend:n,attrs:{perm:u}}),c=CL(c.length,o)),wL("any",c,o);const[d,A]=bL(h.shape,c),p=J4({inputs:{x:h},backend:n,attrs:{shape:[-1,XC(A)]}}),f=t6(p,p.dtype,"any",n);let m;if(s){m=J4({inputs:{x:f},backend:n,attrs:{shape:xL(d,l)}})}else m=J4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),m}};class C6{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:a,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];const s="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(o,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class E6{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,GC(e.length>2,()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2."));const a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,o=s.length,l=O3(o),c=o4("coords",o);let u,h;if(1===i){h=o+1;const e=O3(h);u="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-2],";")}else h=o,u="\n        ".concat(l," sourceLocR = coords;\n        ++").concat(c[o-1],";\n        ").concat(l," sourceLocG = coords;\n        ++").concat(c[o-2],";\n        ").concat(l," sourceLocA = coords;\n        --").concat(c[o-1],";\n        ").concat(l," sourceLocB = coords;\n        --").concat(c[o-2],";");const d=["x","y","z","w","u","v"].slice(0,h),A="."+d[h-1],p=d.map(e=>"int "+e),f=o4("sourceLocR",h-1).concat("inIdx.r"),m=o4("sourceLocG",h-1).concat("inIdx.g"),g=o4("sourceLocB",h-1).concat("inIdx.b"),y=o4("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",b=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(f.join(),"),\n                             getBestIndicesAChannel(").concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),")));"),x="vec4(\n            getAChannel(".concat(f.join(),"),\n            hasNextCol ? getAChannel(").concat(m.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(y.join(),") : 0.)"),w=r?"":"\n      float getBestIndicesAChannel(".concat(p.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(p.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(w,"\n      void main() {\n        ").concat(l," coords = getOutputCoords();\n        bool hasNextCol = ").concat(c[o-1]," < ").concat(s[o-1]-1,";\n        bool hasNextRow = ").concat(c[o-2]," < ").concat(s[o-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(A,", sourceLocG").concat(A,",\n          sourceLocB").concat(A,", sourceLocA").concat(A,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(b,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(v,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function N6(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);const s=BO(i),o={windowSize:s,inSize:i,batchSize:a,outSize:Math.ceil(i/s)},l=new C6(o,n,null==r),c=[t];null!=r&&c.push(r);const u=e.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const h=N6(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function B6(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=null!=r?r.shape:t.shape,i=BO(a[a.length-1]),s=new E6(a,i,n,null==r),o=null==r?[t]:[t,r],l=e.runWebGLProgram(s,o,"int32");if(l.shape.length===t.shape.length){const r=B6(e,t,n,l);return e.disposeIntermediateTensorInfo(l),r}return l}function k6(e,t,n,r){const a=[n];if(wL("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!EE().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],i=e.texData.get(t.dataId);let s=t;null!==i&&i.isPacked&&(s=e.unpackTensor(t),n.push(s));const[o,l]=bL(s.shape,a),c=XC(l),u=J4({inputs:{x:s},backend:e,attrs:{shape:[-1,c]}});n.push(u);const h=N6(e,u,r);n.push(h);const d=J4({inputs:{x:h},backend:e,attrs:{shape:o}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),d}return B6(e,t,r)}const I6={kernelName:DE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let s=nE(i,a.shape);const o=_L(s,a.shape.length);let l=a;const c=[];null!=o&&(l=o6({inputs:{x:a},backend:n,attrs:{perm:o}}),c.push(l),s=CL(s.length,l.shape.length)),wL("argMax",[s[0]],l.shape.length);const u=k6(n,l,s[0],"max");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}};const T6={kernelName:OE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i}=r;let s=nE(i,a.shape);const o=_L(s,a.shape.length);let l=a;const c=[];null!=o&&(l=o6({inputs:{x:a},backend:n,attrs:{perm:o}}),c.push(l),s=CL(s.length,l.shape.length)),wL("argMin",[s[0]],l.shape.length);const u=k6(n,l,s[0],"min");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}},M6=H4({opSnippet:f4+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),F6={kernelName:zE,backendName:"webgl",kernelFunc:M6},R6=H4({opSnippet:f4+"return log(x + sqrt(x * x + 1.0));"}),L6={kernelName:HE,backendName:"webgl",kernelFunc:R6},U6=H4({opSnippet:f4+"\n  return atan(x);\n"}),P6={kernelName:jE,backendName:"webgl",kernelFunc:U6},D6=j4({opSnippet:E4+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+B4+"\n  return result;\n"}),O6={kernelName:VE,backendName:"webgl",kernelFunc:D6},z6=H4({opSnippet:f4+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),H6={kernelName:QE,backendName:"webgl",kernelFunc:z6};class j6{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,A=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,f="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),m="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let g="0.0";if(p||(g="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(o,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(A,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(c,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?a?f:m:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let y="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / max(count, 1.0)");const v=4*Math.floor(i/4),b=i%4,x="\n      if (".concat(p,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(A,");\n      const float initializationValue = ").concat(g,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(g,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(l,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              getValue(batch, xR, xC + 3 * ").concat(c,", d)\n            );\n\n            ").concat(x,"\n          }\n\n          int xC = xCCorner + ").concat(v,";\n          if (").concat(1===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(2===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(3===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              initializationValue\n            );\n\n            ").concat(x,"\n          }\n        }\n        setOutput(").concat(y,");\n      }\n    ")}}class Q6{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,s=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,A=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;const y="avg"===t;let v="0.0";if(y||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(o,", ").concat(l,");\n        const ivec3 pads = ivec3(").concat(f,", ").concat(m,", ").concat(g,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(c,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(A,";\n                wR += ").concat(u,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(p,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?a?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(A," * ").concat(p," +\n                      wR * ").concat(p," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / max(count, 1.0)");const x=4*Math.floor(i/4),w=i%4,_="\n      if (".concat(y,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(o,", ").concat(l,");\n      const ivec3 pads = ivec3(").concat(f,", ").concat(m,", ").concat(g,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(c,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(A,";\n            wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(x,";\n            if (").concat(1===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}const V6={kernelName:WE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;x3(a,"avgPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;GC(bR(s,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=uR(a.shape,i,s,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&YC(c.inShape,c.outShape))return I4({inputs:{x:a},backend:n});const u=new j6(c,"avg",!1);return n.runWebGLProgram(u,[a],"float32")}};const W6={kernelName:KE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r,u=hR(a.shape,i,s,[1,1,1],o,l,c),h=new Q6(u,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}};class G6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.top,u=l-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(c,", ").concat(u,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n            wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(l,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class K6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,A=u-1-e.padInfo.front,p=h-1-e.padInfo.top,f=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(A,", ").concat(p,", ").concat(f,");\n      const float avgMultiplier = float(").concat(m,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n            wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(a,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(l,") {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(c,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const q6={kernelName:qE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=r,h=hR(s.shape,o,l,[1,1,1],c,u),d=new K6(h);return n.runWebGLProgram(d,[a],s.dtype)}};const X6={kernelName:GE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i;x3([a,i],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=r,u=uR(s.shape,o,l,1,c),h=new G6(u);return n.runWebGLProgram(h,[a],s.dtype)}};const Y6={kernelName:XE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:a,b:i}=t,{transposeA:s,transposeB:o}=r;return c6({a:a,b:i,transposeA:s,transposeB:o,backend:n})}};class J6{constructor(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],tF(e,t),tF(e,n);let s="0.0";null!=r&&(tF(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="1.0";null!=a&&(tF(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(o,";\n        float inv = scale * inversesqrt(variance + float(").concat(i,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class Z6{constructor(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],tF(e,t),tF(e,n);let s="vec4(0.0)";null!=r&&(tF(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=a&&(tF(e,a),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(o,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(i,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const $6={kernelName:HN,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a,mean:i,variance:s,offset:o,scale:l}=t;GC(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),GC(null==o||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),GC(null==l||i.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=r;null==c&&(c=.001);const u=[a,i,s];let h=null;null!=o&&(h=o.shape,u.push(o));let d=null;null!=l&&(d=l.shape,u.push(l));const A=EE().getBool("WEBGL_PACK_NORMALIZATION")?new Z6(a.shape,i.shape,s.shape,h,d,c):new J6(a.shape,i.shape,s.shape,h,d,c);return n.runWebGLProgram(A,u,u[0].dtype)}};class e8{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=O3(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return t8.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let r;const a=e.map((e,t)=>"sourceLoc.".concat(t8[t]," = start[").concat(t,"] + coords.").concat(t8[t],";"));r="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(a.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const t8=["x","y","z","w","u","v"];class n8{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=O3(this.rank),n=o4("coords",this.rank),r=o4("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),i="getChannel(getSource(".concat(r.join(),"), ").concat(a,")"),s="\n      result.x = ".concat(i,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(i,";\n        --").concat(r[this.rank-1],";\n      }\n    "),o=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(i,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(i,";\n        }\n      }\n    "),l=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((e,t)=>"start[".concat(t,"]")).join(),");"):e.map((e,t)=>"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];")).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(l,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(o,"\n        setOutput(result);\n      }\n    ")}}function r8(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,size:s}=r,[o,l]=qF(a,i,s);if(RF(a,o,l),0===XC(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){const e=n.texData.get(a.dataId),t=W5(e.values,o,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,t)}const{isPacked:c}=n.texData.get(a.dataId),u=GF(a.shape,o,l);if(c||!u){const e=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new n8(l):new e8(l),t=[o];return n.runWebGLProgram(e,[a],a.dtype,t)}return n.uploadToGPU(a.dataId),function(e,t,n,r){const a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),s=r.texData.get(i.dataId);Object.assign(s,a),s.refCount=1,s.shape=n,s.dtype=e.dtype;let o=KF(t,AE(e.shape));a.slice&&(o+=a.slice.flatOffset),s.slice={flatOffset:o,origDataId:a.slice&&a.slice.origDataId||e.dataId};const l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}(a,o,l,n)}const a8={kernelName:nk,backendName:"webgl",kernelFunc:r8},i8={kernelName:YE,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,crops:s}=r;GC(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=i.reduce((e,t)=>e*t),l=IO(a.shape,i,o),c=TO(l.length,i.length),u=MO(a.shape,i,o),h=FO(s,i.length),d=RO(u,s,i.length),A=[],p=J4({inputs:{x:a},backend:n,attrs:{shape:l}}),f=o6({inputs:{x:p},backend:n,attrs:{perm:c}}),m=J4({inputs:{x:f},backend:n,attrs:{shape:u}}),g=r8({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return A.push(p),A.push(f),A.push(m),A.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}};const s8={kernelName:JE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s}=r,o=n.readSync(a.dataId),l=n.readSync(i.dataId),c=d5(o,l,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,c)}};const o8={kernelName:ZE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:r,b:a}=t,i=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=EE().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||1===s){const e=n.texData.get(r.dataId).values,t=n.texData.get(a.dataId).values,[i,s]=p5(r.shape,a.shape,e,t,r.dtype),o=n.makeTensorInfo(s,r.dtype);return n.texData.get(o.dataId).values=i,o}let o;return o=i?new k4("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",r.shape,a.shape,!1):new N4("\n  return float(int(a.r) & int(b.r));\n",r.shape,a.shape),n.runWebGLProgram(o,[r,a],r.dtype)}};const l8={kernelName:$E,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:a}=t,i=n.readSync(r.dataId),s=n.readSync(a.dataId),o=tF(Array.from(i),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},c8=j4({opSnippet:"return float(a != b);",cpuKernelImpl:L5,dtype:"bool"}),u8={kernelName:SB,backendName:"webgl",kernelFunc:c8};function h8(e){const{inputs:t,backend:n}=e,{input:r}=t;return I4({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const d8={kernelName:OB,backendName:"webgl",kernelFunc:h8};const A8={kernelName:eN,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:a}=t,{x:i}=n,{dtype:s}=a;if("complex64"===s){if("complex64"===i.dtype)return I4({inputs:{x:i},backend:r});const t=pU(i.shape),n=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),a=M4({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),a}if("complex64"===i.dtype){const t=h8({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!sE(i.dtype,s)){const e=I4({inputs:{x:i},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if(r.shouldExecuteOnCPU([i])){const e=r.texData.get(i.dataId).values,[t,n,a]=f5(e,i.shape,i.dtype,s);return r.makeTensorInfo(t,n,a)}if("int32"===s)return function(e,t){const n=new p4(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===s){const e=r.makeTensorInfo([],"bool",aE("bool",1)),t=c8({inputs:{a:i,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(s))}},p8="return ceil(x);",f8=H4({opSnippet:p8,packedOpSnippet:p8,cpuKernelImpl:m5}),m8={kernelName:tN,backendName:"webgl",kernelFunc:f8};class g8{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class y8{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const v8={kernelName:nN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:i,clipValueMax:s}=r;let o;o=EE().getBool("WEBGL_PACK_CLIP")?new y8(a.shape):new g8(a.shape);const l=[[i],[s]];return n.runWebGLProgram(o,[a],a.dtype,l)}};class b8{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function x8(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const w8={kernelName:aN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),i=new b8(r.shape),s=[x8(r,a.complexTensorInfos.real),x8(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,s,s[0].dtype)}};class _8{constructor(e){this.outputShape=[],this.outputShape=xO(e,1),this.variableNames=e.map((e,t)=>"T".concat(t));const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let i=1;i<t.length;i++){const e=t[i-1];n.push("else if (yC < ".concat(t[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(e,"));"))}const r=t.length,a=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(a,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class S8{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=xO(e,t);const n=this.outputShape,r=n.length,a=O3(r),i=o4("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>"T".concat(t));const o=new Array(e.length-1);o[0]=e[0][t];for(let p=1;p<o.length;p++)o[p]=o[p-1]+e[p][t];const l=s[t],c=s.slice(-2),u=s.join();let h="if (".concat(l," < ").concat(o[0],") {\n        return getChannel(\n            getT0(").concat(u,"), vec2(").concat(c.join(),"));\n        }");for(let p=1;p<o.length;p++){const e=o[p-1];h+="\n        if (".concat(l," < ").concat(o[p],"  && ").concat(l," >= ").concat(o[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(C8(s,l,e),"),\n            vec2(").concat(C8(c,l,e),"));\n        }")}const d=o.length,A=o[o.length-1];h+="\n        return getChannel(\n          getT".concat(d,"(").concat(C8(s,l,A),"),\n          vec2(").concat(C8(c,l,A),"));"),this.userCode="\n      float getValue(".concat(s.map(e=>"int "+e),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(i,"), 0., 0., 0.);\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," + 1;\n        if (").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-2]," = ").concat(i[r-2]," + 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(i,");\n        }\n\n        ").concat(i[r-1]," = ").concat(i[r-1]," - 1;\n        if (").concat(i[r-2]," < ").concat(n[r-2]," &&\n            ").concat(i[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(i,");\n        }\n        setOutput(result);\n      }\n    ")}}function C8(e,t,n){const r=e.indexOf(t),a=e.map((e,t)=>t===r?"".concat(e," - ").concat(n):e);return a.join()}function E8(e){const{inputs:t,backend:n}=e,{input:r}=t;return I4({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const N8={kernelName:qN,backendName:"webgl",kernelFunc:E8};function B8(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map(e=>h8({inputs:{input:e},backend:n})),a=e.map(e=>E8({inputs:{input:e},backend:n})),i=B8(r,t,n),s=B8(a,t,n),o=M4({inputs:{real:i,imag:s},backend:n});return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),a.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),o}let a=n.shouldExecuteOnCPU(e);if("string"===r&&(a=!0),a){const a=e.map(e=>{const r=XC(e.shape.slice(t));return J4({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})}),i=a.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),s=xO(a.map(e=>e.shape),1),o=1===a[0].shape[0],l=g5(i,s,r,o),c=xO(e.map(e=>e.shape),t),u=n.makeTensorInfo(c,r,l);return a.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}const i=e.filter(e=>XC(e.shape)>0),s=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(1===i.length){const t=s?new p4(e[0].shape,v4):new b4(e[0].shape,v4);return n.runWebGLProgram(t,e,r)}const o=EE().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>o){const e=[];for(let a=0;a<i.length;a+=o){const r=i.slice(a,a+o);e.push(B8(r,t,n))}const r=B8(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return r}if(s){const e=new S8(i.map(e=>e.shape),t);return n.runWebGLProgram(e,i,r)}const{tensors2D:l,outShape:c}=function(e,t,n){const r=xO(e.map(e=>e.shape),t),a=e.map(e=>J4({inputs:{x:e},attrs:{shape:[-1,XC(e.shape.slice(t))]},backend:n}));return{tensors2D:a,outShape:r}}(i,t,n),u=new _8(l.map(e=>e.shape)),h=n.runWebGLProgram(u,l,r);l.forEach(e=>n.disposeIntermediateTensorInfo(e));const d=J4({inputs:{x:h},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(h),d}function k8(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,i=nE(a,t[0].shape)[0];bO(t.map(e=>e.shape),i);const s=xO(t.map(e=>e.shape),i);if(0===XC(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter(e=>XC(e.shape)>0);return 1===o.length?I4({inputs:{x:o[0]},backend:n}):B8(o,i,n)}const I8={kernelName:iN,backendName:"webgl",kernelFunc:k8};class T8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,A=4*Math.floor(e.inChannels/4),p=e.inChannels%4,f="channelsLast"===e.dataFormat,m=f?1:2,g=f?2:3,y=f?3:1;let v="",b="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),b="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(o,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(m,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(A,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(f,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(f,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(A,") *\n                    getW(wR, wC, ").concat(A,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(A,", xR, xC) *\n                    getW(wR, wC, ").concat(A,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(A,", d2),\n                getW(wR, wC, ").concat(A," + 1, d2)\n              );\n\n              if (").concat(f,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(A,"),\n                  getX(batch, xR, xC, ").concat(A," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(A,", xR, xC),\n                  getX(batch, ").concat(A," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(A,", d2),\n                getW(wR, wC, ").concat(A," + 1, d2),\n                getW(wR, wC, ").concat(A," + 2, d2)\n              );\n\n              if (").concat(f,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(A,"),\n                  getX(batch, xR, xC, ").concat(A," + 1),\n                  getX(batch, xR, xC, ").concat(A," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(A,", xR, xC),\n                  getX(batch, ").concat(A," + 1, xR, xC),\n                  getX(batch, ").concat(A," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(x,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")}}class M8{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,A=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(a,", ").concat(i,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(u,"; wF++) {\n          int xF = xFCorner + wF * ").concat(o,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(l,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(c,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(A,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===p,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(A,") *\n                  getW(wF, wR, wC, ").concat(A,", d2);\n              } else if (").concat(2===p,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(A,"),\n                  getX(batch, xF, xR, xC, ").concat(A," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(A,", d2),\n                  getW(wF, wR, wC, ").concat(A," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===p,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(A,"),\n                  getX(batch, xF, xR, xC, ").concat(A," + 1),\n                  getX(batch, xF, xR, xC, ").concat(A," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(A,", d2),\n                  getW(wF, wR, wC, ").concat(A," + 1, d2),\n                  getW(wF, wR, wC, ").concat(A," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class F8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=G3(this.outputShape.length);const i=e.padInfo.left,s=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,u=c;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let f=0;f<c;f++)h+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");h+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let f=0;f<c;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let f=0;f<(u+1)/2;f++){const t=2*f;if(h+="\n           xC = xCCorner + ".concat(t*o,";\n           "),1===s){if(t<c&&(i%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),h+=1===o&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<c)){const e=i%2===0?VC(o):o;o%2===0&&i%2===1||o%2!==0&&i%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),h+=o>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):h+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<c&&(i%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<c&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<c&&(h+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<c&&(h+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<c&&(h+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",A="";n&&(d=r?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):a?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),A="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(p,"\n         ").concat(A,"\n         setOutput(result);\n       }\n     ")}}class R8{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=G3(this.outputShape.length);const{dataFormat:n}=t,r=_3(),a="channelsLast"===n,i=a?1:2,s=a?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let l="";for(let c=0;c<=1;c++)for(let e=0;e<=1;e++)l+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(c,";\n\n          ").concat(o,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(i,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(a,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(l,"\n\n        ").concat(r.output," = result;\n      }\n    ")}}function L8(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function U8(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}=e;const c=t.shape,u=a.texData.get(t.dataId),h=r.inChannels,d=c[0]*c[1]*c[2],A=r.outChannels,p="channelsLast"===r.dataFormat,f=!1;let m;const g=[];if(null!=s){const e=L8(s.shape,p);null!=e&&(s=J4({inputs:{x:s},backend:a,attrs:{shape:e}}),g.push(s))}if(null!=i){const e=L8(i.shape,p);null!=e&&(i=J4({inputs:{x:i},backend:a,attrs:{shape:e}}),g.push(i))}if(!((1===d||1===A)&&h>1e3)&&u.isPacked&&p&&null!=u.texture&&c[2]%2!==0&&YC(u.shape.slice(-3),c.slice(-3))){const e=c[0]*c[1]*(c[2]+1),h={dataId:t.dataId,shape:[1,e,r.inChannels],dtype:t.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,GC(p3(u.shape,h.shape),()=>"packed reshape ".concat(u.shape," to ").concat(h.shape," isn't free"));const A=J4({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}});g.push(A);const p=c6({a:h,b:A,backend:a,transposeA:false,transposeB:f,bias:i,activation:l,preluActivationWeights:s,leakyreluAlpha:o}),y=a.texData.get(p.dataId);GC(y.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=d,y.shape=r.outShape,m=I4({inputs:{x:p},backend:a}),m.shape=r.outShape,g.push(p)}else{const e=r.outHeight*r.outWidth,c=J4({inputs:{x:t},backend:a,attrs:{shape:p?[r.batchSize,e,r.inChannels]:[r.batchSize,r.inChannels,e]}}),u=J4({inputs:{x:n},backend:a,attrs:{shape:[1,r.inChannels,r.outChannels]}}),h=c6({a:p?c:u,b:p?u:c,transposeA:!p,transposeB:f,backend:a,bias:i,activation:l,preluActivationWeights:s,leakyreluAlpha:o});m=J4({inputs:{x:h},backend:a,attrs:{shape:r.outShape}}),g.push(c),g.push(u),g.push(h)}for(const y of g)a.disposeIntermediateTensorInfo(y);return m}function P8(e){let{x:t,filter:n,convInfo:r,backend:a,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}=e;const{filterWidth:c,filterHeight:u,inChannels:h,outWidth:d,outHeight:A,dataFormat:p}=r,f="channelsLast"===p,m=c*u*h,g=A*d,y=[r.batchSize,m,g],v=[];if(null!=s){const e=L8(s.shape,f);null!=e&&(s=J4({inputs:{x:s},backend:a,attrs:{shape:e}}),v.push(s))}if(null!=i){const e=L8(i.shape,f);null!=e&&(i=J4({inputs:{x:i},backend:a,attrs:{shape:e}}),v.push(i))}const b=J4({inputs:{x:n},backend:a,attrs:{shape:[1,m,XC(n.shape)/m]}});v.push(b);const x=new R8(y,r),w=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],_=a.runWebGLProgram(x,[t],"float32",w),S=J4({inputs:{x:_},backend:a,attrs:{shape:y}});v.push(_),v.push(S);const C=null!=i,E=null!=s,N="leakyrelu"===l,B=l?Q4(l,!0):null,k=new V4(f?S.shape:b.shape,f?b.shape:S.shape,f?[r.batchSize,g,r.outChannels]:[r.batchSize,r.outChannels,g],!0,!1,C,B,E,N),I=f?[S,b]:[b,S];if(i&&I.push(i),E&&I.push(s),N){const e=a.makeTensorInfo([],"float32",AI(o,"float32"));I.push(e),v.push(e)}const T=a.runWebGLProgram(k,I,"float32"),M=J4({inputs:{x:T},backend:a,attrs:{shape:r.outShape}});v.push(T);for(const F of v)a.disposeIntermediateTensorInfo(F);return M}const D8={kernelName:sN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=r,h=wR(l),d=dR(a.shape,i.shape,s,c,o,u,!1,h);let A;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&EE().getBool("WEBGL_EXP_CONV")){const e=new F8(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];A=n.runWebGLProgram(e,[a,i],"float32",t)}else if(EE().getBool("WEBGL_CONV_IM2COL"))A=P8({x:a,filter:i,convInfo:d,backend:n});else{const e=new T8(d);A=n.runWebGLProgram(e,[a,i],"float32")}else A=U8({x:a,filter:i,convInfo:d,backend:n});const p=J4({inputs:{x:A},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(A),p}};class O8{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(i?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class z8{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=i?1:2,c=i?2:3,u=i?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(u,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(l,"], coords[").concat(c,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(i,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class H8{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(a,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(i,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class j8{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(o,", ").concat(l,", ").concat(c,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(a,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Q8={kernelName:oN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,h=wR(l),d=dR(a.shape,u,s,1,o,c,!1,h),A=new O8(d);return n.runWebGLProgram(A,[a,i],"float32")}};class V8{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=G3(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(a,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const W8={kernelName:lN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{inputShape:s,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=r,h=wR(c),d=dR(s,i.shape,o,1,l,u,!1,h);if(EE().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===h){const e=[[d.strideHeight,d.strideWidth]],t=new V8(d);return n.runWebGLProgram(t,[a,i],"float32",e)}{const e=new z8(d);return n.runWebGLProgram(e,[a,i],"float32")}}};const G8={kernelName:cN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,c=AR(a.shape,i.shape,s,l,o),u=new M8(c);return n.runWebGLProgram(u,[a,i],"float32")}};const K8={kernelName:uN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,pad:o,filterShape:l}=r,c=AR(a.shape,l,s,1,o),u=new H8(c);return n.runWebGLProgram(u,[a,i],"float32")}};const q8={kernelName:hN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{pad:s,strides:o,inputShape:l}=r,c=AR(l,i.shape,o,1,s),u=new j8(c);return n.runWebGLProgram(u,[a,i],"float32")}},X8=H4({opSnippet:z4+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(B4,"\n  return result;\n")}),Y8={kernelName:dN,backendName:"webgl",kernelFunc:X8},J8=H4({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),Z8={kernelName:AN,backendName:"webgl",kernelFunc:J8};class $8{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,s,o,l]=e,[c]=t,[u,h]=n;this.outputShape=[c,u,h,l];const d="bilinear"===r?1:0,[A,p]=["".concat(s-1,".0"),"".concat(o-1,".0")],[f,m,g]=u>1?["".concat((s-1)/(u-1)),"(y2-y1) * height_ratio","y1*".concat(A," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(A)],[y,v,b]=h>1?["".concat((o-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(p," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(p)];this.userCode="\n      const float height_ratio = float(".concat(f,");\n      const float width_ratio = float(").concat(y,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(i,") {\n          return;\n        }\n\n        float height_scale = ").concat(m,";\n        float width_scale = ").concat(v,";\n\n        float in_y = ").concat(g,";\n        if( in_y < 0.0 || in_y > ").concat(A," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n        float in_x = ").concat(b,";\n        if( in_x < 0.0 || in_x > ").concat(p," ) {\n          setOutput(float(").concat(a,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const e7={kernelName:mN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:i,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:c}=r,u=new $8(a.shape,i.shape,o,l,c);return n.runWebGLProgram(u,[a,i,s],"float32")}};var t7;!function(e){e.Prod="*",e.Sum="+"}(t7||(t7={}));class n7{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,i=this.op===t7.Prod?"1.0":"0.0",s=n?i:"getX(".concat(r7(a,"coords",this.op),")"),o=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=r?"end != ".concat(o-1):"end != 0",c=r?"end + 1":"end - 1"):(l=r?"end + pow2 < ".concat(o):"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(O3(a)," coords = getOutputCoords();\n        int end = ").concat(a7(a,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(l,") {\n          int idx = ").concat(c,";\n          ").concat(a7(a,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(r7(a,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function r7(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function a7(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function i7(e,t,n,r,a,i){const s=t.shape.length,o=_L([r],s);let l=t;null!=o&&(l=o6({inputs:{x:t},backend:n,attrs:{perm:o}}));const c=CL(1,s)[0];if(c!==s-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));const u=l.shape[c];let h=I4({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const t=new n7(e,l.shape,!1,i),r=[[d]],a=h;h=n.runWebGLProgram(t,[h],h.dtype,r),n.disposeIntermediateTensorInfo(a)}if(a){const t=new n7(e,l.shape,a,i),r=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){const e=o6({inputs:{x:h},backend:n,attrs:{perm:SL(o)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),e}return h}const s7={kernelName:pN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return i7(t7.Prod,a,n,i,s,o)}};const o7={kernelName:fN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,exclusive:s,reverse:o}=r;return i7(t7.Sum,a,n,i,s,o)}};const l7={kernelName:gN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,weights:i}=t,{size:s,binaryOutput:o}=r;if(1===a.shape.length){const e=n.readSync(a.dataId),t=n.readSync(i.dataId),r=d5(e,t,i.dtype,i.shape,s);return n.makeTensorInfo([s],i.dtype,r)}if(2===a.shape.length){const e=n.bufferSync(a),t=n.bufferSync(i),r=A5(e,t,s,o);return n.makeTensorInfo(r.shape,i.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};class c7{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const u7={kernelName:yN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:i,dataFormat:s}=r,o=a.shape[0],l=("NHWC"===s?a.shape[1]:a.shape[2])*i,c=("NHWC"===s?a.shape[2]:a.shape[3])*i,u=("NHWC"===s?a.shape[3]:a.shape[1])/(i*i),h=new c7("NHWC"===s?[o,l,c,u]:[o,u,l,c],i,s);return n.runWebGLProgram(h,[a],a.dtype)}};class h7{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=G3(this.outputShape.length);const i=e.filterHeight,s=e.filterWidth,o=e.outChannels/e.inChannels;let l="",c="";n&&(l=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),c="result = activation(result);");const u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(l,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(i,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(u,"\n        ").concat(c,"\n        setOutput(result);\n      }\n    ")}}class d7{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=G3(this.outputShape.length);const i=e.outChannels/e.inChannels,s=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,h=u;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let m=0;m<u;m++)d+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");d+="\n    for (int r = 0; r < ".concat(c,"; r++) {\n      ");for(let m=0;m<u;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let m=0;m<(h+1)/2;m++){const e=2*m;if(d+="\n          xC = xCCorner + ".concat(e*l,";\n          "),1===o){if(e<u&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===l&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<u)){const t=s%2===0?VC(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<u&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<u&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<u&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<u&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<u&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let A="",p="";n&&(A=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):a?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),p="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(A,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(i,";\n        int q = d2 - d1 * ").concat(i,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(f,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const A7={kernelName:vN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:c}=r;let u=l;null==u&&(u=[1,1]),GC(bR(s,u),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(u,"'"));const h=dR(a.shape,i.shape,s,u,o,c,!0);let d;d=EE().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new d7(h):new h7(h);const A=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",A)}};class p7{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(i," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(a,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class f7{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(o,"; dm++) {\n              int d2 = d1 * ").concat(o," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const m7={kernelName:bN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,dy:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=r,h=dR(a.shape,u,s,o,l,c,!0),d=new p7(h);return n.runWebGLProgram(d,[a,i],"float32")}};const g7={kernelName:xN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:i}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=r,h=dR(u,i.shape,s,o,l,c,!0),d=new f7(h);return n.runWebGLProgram(d,[a,i],"float32")}};class y7{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const v7={kernelName:wN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],i=XC(r.shape),s=J4({inputs:{x:r},backend:n,attrs:{shape:[i]}}),o=new y7(i),l=n.runWebGLProgram(o,[s],s.dtype),c=J4({inputs:{x:l},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),c}};class b7{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:i,filterHeight:s,filterWidth:o,dilationHeight:l,dilationWidth:c}=e,{top:u,left:h}=r;this.userCode="\n      const ivec2 strides = ivec2(".concat(a,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(l,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(o,"; w++) {\n              int wIn = wBeg + w * ").concat(c,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const x7={kernelName:_N,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i}=t,{strides:s,pad:o,dilations:l}=r,c=cR(a.shape,i.shape,s,o,"NHWC",l);let u;const h=new b7(c);u=n.runWebGLProgram(h,[a,i],"float32");const d=J4({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}};const w7={kernelName:BN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,i=t,{allDims:s,summedDims:o,idDims:l}=nz(a,i.length);az(s.length,l,i);const{path:c,steps:u}=iz(o,l),h=u.length;let d=null,A=s.length;const p=[];for(let f=0;f<h;++f){for(const e of u[f]){const{permutationIndices:t,expandDims:r}=rz(A,l[e]);let a;sz(t)?a=i[e]:(a=o6({inputs:{x:i[e]},backend:n,attrs:{perm:t}}),p.push(a));const s=a.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);YC(a.shape,s)||(a=J4({inputs:{x:a},backend:n,attrs:{shape:s}}),p.push(a)),null===d?d=a:(d=X4({inputs:{a:a,b:d},backend:n}),p.push(d))}f<h-1&&(c[f]>=0&&(d=i6({inputs:{x:d},backend:n,attrs:{axis:c[f]-(s.length-A),keepDims:!1}}),p.push(d)),A--)}for(const f of p)f!==d&&n.disposeIntermediateTensorInfo(f);return d}},_7=H4({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),S7={kernelName:kN,backendName:"webgl",kernelFunc:_7},C7={kernelName:IN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:a}=t,i=EE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new k4("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new N4("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},E7=j4({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:y5}),N7={kernelName:MN,backendName:"webgl",kernelFunc:E7},B7=H4({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(DO,";\n  float a1 = ").concat(OO,";\n  float a2 = ").concat(zO,";\n  float a3 = ").concat(HO,";\n  float a4 = ").concat(jO,";\n  float a5 = ").concat(QO,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),k7={kernelName:TN,backendName:"webgl",kernelFunc:B7},I7=H4({opSnippet:z4+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:v5,dtype:"float32"}),T7={kernelName:FN,backendName:"webgl",kernelFunc:I7};function M7(e){const{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:i}=t,s=i.shape.length,o=i.shape.slice();let l=a;return a<0&&(GC(-(s+1)<=a,()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")),l=s+a+1),o.splice(l,0,1),J4({inputs:{x:i},backend:r,attrs:{shape:o}})}const F7={kernelName:RN,backendName:"webgl",kernelFunc:M7},R7="return exp(x) - 1.0;",L7=H4({opSnippet:R7,packedOpSnippet:R7,cpuKernelImpl:b5}),U7={kernelName:LN,backendName:"webgl",kernelFunc:L7};class P7{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const a=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),i=n?"".concat(r,".0"):"1.0";let s;if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));s="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(a,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(s,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(i,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function D7(e,t,n){const r=n.texData.get(e.dataId),a=XC(e.shape),i=e.shape[e.shape.length-1],s=J4({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),o=s.shape,l=new P7("real",o,t),c=new P7("imag",o,t),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(c,u,"float32"),A=M4({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const p=J4({inputs:{x:A},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(A),p}const O7={kernelName:UN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return D7(r,!1,n)}};class z7{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function H7(e){const{backend:t,attrs:n}=e,{shape:r,value:a}=n;let{dtype:i}=n;if(i=i||uE(a),"string"===i){const e=iE(i,XC(r));return e.fill(a),t.makeTensorInfo(r,i,e)}{const e=new z7(r,a),n=[[a]];return t.runWebGLProgram(e,[],i,n)}}const j7={kernelName:PN,backendName:"webgl",kernelFunc:H7};class Q7{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const V7={kernelName:DN,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:r}=t,a=n,i=new Q7(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},W7="return floor(x);",G7=H4({opSnippet:W7,packedOpSnippet:W7,cpuKernelImpl:x5}),K7={kernelName:ON,backendName:"webgl",kernelFunc:G7},q7=j4({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),X7={kernelName:zN,backendName:"webgl",kernelFunc:q7};class Y7{constructor(e){this.variableNames=["A"];const t=_3(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class J7{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=_3(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const Z7={kernelName:Pk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:a}=t;const{numChannels:i}=r,s="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,o="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,[l,c]=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=[c,l],h=[c,l,i];if(o||s){const e=EE().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=$7&&e===e9||(e9=e,$7=document.createElement("canvas").getContext("2d",{willReadFrequently:e9})),$7.canvas.width=l,$7.canvas.height=c,$7.drawImage(a,0,0,l,c),a=$7.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=W2.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);const A=EE().getBool("WEBGL_PACK")?new J7(h):new Y7(h),p=n.runWebGLProgram(A,[d],"int32");return n.disposeData(d.dataId),p}};let $7,e9=EE().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const t9={kernelName:zk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r,f=wR(u),m=dR(a.shape,i.shape,l,h,c,d,!1,f);let g;const y=[],v=null!=s,b=null!=o,x="leakyrelu"===A,w=()=>{const e=[a,i],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=J4({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return y.push(t),t}return e};if(v&&e.push(t(s,u)),b&&e.push(t(o,u)),x){const t=n.makeTensorInfo([],"float32",AI(p,"float32"));e.push(t),y.push(t)}return e};if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if(m.strideWidth<=2&&"channelsLast"===f&&EE().getBool("WEBGL_EXP_CONV")){const e=A?Q4(A,!0):null,t=new F8(m,v,e,b,x),r=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],a=w();g=n.runWebGLProgram(t,a,"float32",r)}else if(EE().getBool("WEBGL_CONV_IM2COL"))g=P8({x:a,filter:i,convInfo:m,backend:n,bias:s,activation:A,preluActivationWeights:o,leakyreluAlpha:p});else{const e=A?Q4(A,!1):null,t=new T8(m,v,e,b,x),r=w();g=n.runWebGLProgram(t,r,"float32")}else g=U8({x:a,filter:i,convInfo:m,backend:n,bias:s,activation:A,preluActivationWeights:o,leakyreluAlpha:p});const _=J4({inputs:{x:g},backend:n,attrs:{shape:m.outShape}});return y.push(g),y.forEach(e=>n.disposeIntermediateTensorInfo(e)),_}};const n9={kernelName:Hk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,filter:i,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:A}=r,p=[];let f=u;null==f&&(f=[1,1]),GC(bR(l,f),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(l," and dilations '").concat(f,"'"));const m=dR(a.shape,i.shape,l,f,c,h,!0),g=EE().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,y=d?Q4(d,g):null,v=[a,i],b=null!=s,x=null!=o,w="leakyrelu"===d;if(b&&v.push(s),x&&v.push(o),w){const e=n.makeTensorInfo([],"float32",AI(A,"float32"));v.push(e),p.push(e)}let _;_=g?new d7(m,b,y,x,w):new h7(m,b,y,x,w);const S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],C=n.runWebGLProgram(_,v,"float32",S);return p.forEach(e=>n.disposeIntermediateTensorInfo(e)),C}};class r9{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const a=O3(n.length);let i="\n    int index;";for(let s=0;s<this.sliceDim;s++)i+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(a," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(i,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const a9={kernelName:QN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:a}=t,i=a.shape,s=i[i.length-1],o=XC(r.shape),[l,c,u,h]=LO(r,a),d=J4({inputs:{x:a},backend:n,attrs:{shape:[c,s]}}),A=J4({inputs:{x:r},backend:n,attrs:{shape:[XC(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){const e=n.readSync(a.dataId),t=n.bufferSync(r),i=w5(e,t,r.dtype,c,s,u,h,r.shape,o);return n.makeTensorInfo(l,r.dtype,i.values)}const p=new r9(s,h,[c,u],r.shape),f=n.runWebGLProgram(p,[A,d],A.dtype),m=J4({inputs:{x:f},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(f),m}};class i9{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=O3(this.rank),r=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("index"):n.push("".concat(t[r]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(r,"));\n      }\n    ")}}function s9(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,indices:i}=t,{axis:s,batchDims:o}=r,l=nE(s,a.shape)[0];if(EE().get("DEBUG")){const e=n.readSync(i.dataId),t=a.shape[l];for(let n=0;n<e.length;++n){const r=e[n];GC(r<=t-1&&r>=0,()=>"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]"))}}const c=_z(a,i,l,o),u=XC(i.shape),h=[],d=J4({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),A=J4({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});h.push(d),h.push(A);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){const e=n.bufferSync(A),t=n.bufferSync(d),r=_5(t,e,p);return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const f=new i9(d.shape,p),m=n.runWebGLProgram(f,[d,A],d.dtype);h.push(m);const g=J4({inputs:{x:m},backend:n,attrs:{shape:c.outputShape}});return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}const o9={kernelName:jN,backendName:"webgl",kernelFunc:s9},l9=j4({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:S5,dtype:"bool"}),c9={kernelName:VN,backendName:"webgl",kernelFunc:l9},u9=j4({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:C5}),h9={kernelName:WN,backendName:"webgl",kernelFunc:u9};const d9={kernelName:KN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return D7(r,!0,n)}},A9=H4({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),p9={kernelName:XN,backendName:"webgl",kernelFunc:A9},f9=H4({opSnippet:"return float(isinf(x));",dtype:"bool"}),m9={kernelName:YN,backendName:"webgl",kernelFunc:f9},g9=H4({opSnippet:"return float(isnan(x));",dtype:"bool"}),y9={kernelName:JN,backendName:"webgl",kernelFunc:g9},v9=j4({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:E5,dtype:"bool"}),b9={kernelName:$N,backendName:"webgl",kernelFunc:v9},x9=j4({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:N5,dtype:"bool"}),w9={kernelName:eB,backendName:"webgl",kernelFunc:x9};const _9={kernelName:tB,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:a,num:i}=n,s=B5(r,a,i);return t.makeTensorInfo([s.length],"float32",s)}},S9=H4({opSnippet:z4+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:k5}),C9={kernelName:nB,backendName:"webgl",kernelFunc:S9},E9=H4({opSnippet:z4+"\n  return log(1.0 + x);\n"}),N9={kernelName:rB,backendName:"webgl",kernelFunc:E9},B9=j4({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),k9={kernelName:aB,backendName:"webgl",kernelFunc:B9},I9=H4({opSnippet:"return float(!(x >= 1.0));"}),T9={kernelName:iB,backendName:"webgl",kernelFunc:I9},M9=j4({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),F9={kernelName:sB,backendName:"webgl",kernelFunc:M9};class R9{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];const i=t,s=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(r,") * sum");o=.5===a?"inversesqrt(".concat(l,")"):1===a?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(i,"; j <= ").concat(i,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")}}class L9{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,s=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(r,") * sum");o=.5===a?"inversesqrt(".concat(l,")"):1===a?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(a,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(i,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(i,"; j <= ").concat(i,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")}}const U9={kernelName:oB,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:i,bias:s,alpha:o,beta:l}=r,c=EE().getBool("WEBGL_PACK_NORMALIZATION")?new L9(a.shape,i,s,o,l):new R9(a.shape,i,s,o,l);return n.runWebGLProgram(c,[a],a.dtype)}};class P9{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(a,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(a,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const D9={kernelName:lB,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a,y:i,dy:s}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=r,h=new P9(a.shape,o,l,c,u);return n.runWebGLProgram(h,[a,i,s],a.dtype)}};function O9(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:i,keepDims:s}=r,o=a.shape.length,l=nE(i,a.shape);let c=l;const u=_L(c,o),h=null!=u,d=n.shouldExecuteOnCPU([a]);let A=a;if(h){if(d){const e=n.texData.get(A.dataId).values,t=new Array(o);for(let n=0;n<t.length;n++)t[n]=a.shape[u[n]];const r=a4(e,a.shape,a.dtype,u,t);A=n.makeTensorInfo(t,a.dtype);n.texData.get(A.dataId).values=r}else A=a6(a,u,n);c=CL(c.length,o)}wL("max",c,o);const[p,f]=bL(A.shape,c);let m,g=p;if(s&&(g=xL(p,l)),d){const e=n.texData.get(A.dataId).values,t=I5(e,XC(f),g,a.dtype);m=n.makeTensorInfo(g,a.dtype);n.texData.get(m.dataId).values=t}else m=function(e,t,n,r){const a=XC(t),i=J4({inputs:{x:e},attrs:{shape:[XC(e.shape)/a,a]},backend:r}),s=t6(i,e.dtype,"max",r),o=J4({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}(A,f,g,n);return h&&n.disposeIntermediateTensorInfo(A),m}const z9={kernelName:cB,backendName:"webgl",kernelFunc:O9},H9=j4({opSnippet:E4+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+B4+"\n  return result;\n",cpuKernelImpl:T5}),j9={kernelName:uB,backendName:"webgl",kernelFunc:H9};const Q9={kernelName:hB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;x3(a,"maxPool");const{filterSize:i,strides:s,pad:o,dimRoundingMode:l}=r;GC(bR(s,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=uR(a.shape,i,s,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&YC(c.inShape,c.outShape))return I4({inputs:{x:a},backend:n});const u=new j6(c,"max",!1);return n.runWebGLProgram(u,[a],a.dtype)}};const V9={kernelName:AB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:i,strides:s,pad:o,dataFormat:l,dimRoundingMode:c}=r,u=hR(a.shape,i,s,[1,1,1],o,c,l),h=new Q6(u,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}};class W9{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,s=a-1-e.padInfo.top,o=i-1-e.padInfo.left,l=a*i-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(a,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(i,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(l," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(i," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class G9{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=c-1-e.padInfo.left,A=o*l*c-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(o,";\n           wD += ").concat(a,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(i,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(c,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(A," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(l," * ").concat(c," +\n                  wR * ").concat(c," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const K9={kernelName:pB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i}=t,s=i,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=r,h=hR(s.shape,o,l,[1,1,1],c,u),d=new Q6(h,"max",!0),A=n.runWebGLProgram(d,[s],s.dtype),p=new G9(h),f=n.runWebGLProgram(p,[a,A],s.dtype);return n.disposeIntermediateTensorInfo(A),f}};const q9={kernelName:dB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:a,input:i,output:s}=t,o=i;x3([i,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=uR(o.shape,l,c,1,u,h),A=new j6(d,"max",!0),p=n.runWebGLProgram(A,[o],o.dtype),f=new W9(d),m=n.runWebGLProgram(f,[a,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}};const X9={kernelName:fB,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{filterSize:i,strides:s,pad:o,includeBatchInIndex:l}=n,c=r;GC(4===a.shape.length,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,"."));const u=[1,1];GC(bR(s,u),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(u,"'"));const h=uR(a.shape,i,s,u,o),[d,A]=function(e,t,n,r){let a=new j6(n,"max",!1);const i=r.runWebGLProgram(a,[e],"float32");return a=new j6(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,l,h,c);return[d,A]}};const Y9={kernelName:mB,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,{keepDims:i,axis:s}=n,o=r,l=a.shape.length,c=nE(s,a.shape);let u=c;const h=_L(u,l),d=null!=h,A=o.shouldExecuteOnCPU([a]),p=[];let f=a;if(d){if(A){const e=o.texData.get(f.dataId).values,t=new Array(l);for(let r=0;r<t.length;r++)t[r]=a.shape[h[r]];const n=a4(e,a.shape,a.dtype,h,t);f=o.makeTensorInfo(t,a.dtype);o.texData.get(f.dataId).values=n}else f=a6(a,h,o);p.push(f),u=CL(u.length,l)}wL("sum",u,l);const[m,g]=bL(f.shape,u);let y=m;i&&(y=xL(m,c));const v=function(e,t,n,r){const a=XC(t),i=J4({inputs:{x:e},attrs:{shape:[XC(e.shape)/a,a]},backend:r}),s=t6(i,"float32","mean",r),o=J4({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}(f,g,y,o);for(const b of p)o.disposeIntermediateTensorInfo(b);return v}};const J9={kernelName:gB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=nE(i,a.shape);let c=l;const u=_L(c,o);let h=a;null!=u&&(h=o6({inputs:{x:a},backend:n,attrs:{perm:u}}),c=CL(c.length,a.shape.length)),wL("min",c,o);const[d,A]=bL(h.shape,c),p=J4({inputs:{x:h},backend:n,attrs:{shape:[-1,XC(A)]}}),f=t6(p,p.dtype,"min",n);let m;if(s){m=J4({inputs:{x:f},backend:n,attrs:{shape:xL(d,l)}})}else m=J4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),m}},Z9=j4({opSnippet:E4+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+B4+"\n  return result;\n",cpuKernelImpl:M5}),$9={kernelName:yB,backendName:"webgl",kernelFunc:Z9};class eee{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=O3(r),i=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(l,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(l,";\n          }\n        }\n        ").concat(a," coords = outC - start;\n        setOutput(getX(").concat(o,"));\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(l,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(l,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class tee{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=O3(r),i=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=o4("rc",r),l=o4("source",r),c="".concat(o[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(l.slice(-2).join(),")"),h="reflect"===n?0:1;let d="";if(1===r){const e="\n        ".concat(a," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[r-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ")}else{const e="\n        ".concat(a," source = rc;\n        ").concat(a," lt = ").concat(a,"(lessThan(source, start));\n        ").concat(a," gte = ").concat(a,"(greaterThanEqual(source, end));\n        ").concat(a," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(a," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[r-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n        rc = outputLoc;\n        ").concat(o[r-2]," += 1;\n        if(").concat(o[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          ").concat(o[r-1]," += 1;\n          if(").concat(c,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const nee={kernelName:vB,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:a}=t,{paddings:i,mode:s}=r,o=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tee(a.shape,i,s):new eee(a.shape,i,s);return n.runWebGLProgram(o,[a],a.dtype)}},ree=j4({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+B4+"\n  return result;\n"}),aee={kernelName:bB,backendName:"webgl",kernelFunc:ree};class iee{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const see=j4({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),oee={kernelName:NN,backendName:"webgl",kernelFunc:see},lee="return a - b;",cee=j4({opSnippet:lee,packedOpSnippet:lee,supportsComplex:!0,cpuKernelImpl:t4}),uee={kernelName:Ck,backendName:"webgl",kernelFunc:cee};function hee(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:i}=r,s=nE([i],a.shape),o=O9({inputs:{x:a},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),l=xL(o.shape,s),c=J4({inputs:{x:o},backend:n,attrs:{shape:l}}),u=cee({inputs:{a:a,b:c},backend:n}),h=I7({inputs:{x:u},backend:n}),d=i6({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:!1}}),A=J4({inputs:{x:d},backend:n,attrs:{shape:l}}),p=see({inputs:{a:h,b:A},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),p}const dee={kernelName:dk,backendName:"webgl",kernelFunc:hee};const Aee={kernelName:xB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:i,seed:s,normalized:o}=r,l=o?a:hee({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new iee(c,u,i),d=[[s]],A=n.runWebGLProgram(h,[l],"int32",d);return o||n.disposeIntermediateTensorInfo(l),A}},pee=f4+"\n  return -x;\n";const fee={kernelName:_B,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,a]=R5(e.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,t)}let a;return a=EE().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new b4(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new p4(r.shape,pee),n.runWebGLProgram(a,[r],r.dtype)}},mee=ED;const gee={kernelName:CB,backendName:"webgl",kernelFunc:function(e){jk("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r,c=n.readSync(a.dataId),u=n.readSync(i.dataId),{selectedIndices:h}=mee(c,u,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},yee=ND;const vee={kernelName:EB,backendName:"webgl",kernelFunc:function(e){jk("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=r,u=n.readSync(a.dataId),h=n.readSync(i.dataId),{selectedIndices:d,validOutputs:A}=yee(u,h,s,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([A]))]}},bee=BD;const xee={kernelName:NB,backendName:"webgl",kernelFunc:function(e){jk("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=r,u=n.readSync(a.dataId),h=n.readSync(i.dataId),d=s,A=o,p=l,f=c,{selectedIndices:m,selectedScores:g}=bee(u,h,d,A,p,f);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([g.length],"float32",new Float32Array(g))]}};class wee{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const _ee={kernelName:kB,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:i,depth:s,onValue:o,offValue:l}=r,c=XC(a.shape),u=new wee(c,s,o,l),h=J4({inputs:{x:a},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],i);n.disposeIntermediateTensorInfo(h);const A=J4({inputs:{x:d},backend:n,attrs:{shape:[...a.shape,s]}});return n.disposeIntermediateTensorInfo(d),A}};function See(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=h8({inputs:{input:r},backend:n}),t=See({inputs:{x:e},backend:n}),a=E8({inputs:{input:r},backend:n}),i=See({inputs:{x:a},backend:n}),s=M4({inputs:{real:t,imag:i},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),s}return H7({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const Cee={kernelName:Lk,backendName:"webgl",kernelFunc:See};const Eee={kernelName:BB,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:a}=n;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){const t=h8({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r}),i=E8({inputs:{input:a},backend:r}),s=See({inputs:{x:i},backend:r}),o=M4({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),o}return H7({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};const Nee={kernelName:IB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(1===t.length)return M7({inputs:{input:t[0]},backend:n,attrs:{dim:a}});const i=t[0].shape,s=t[0].dtype;t.forEach(e=>{KC(i,e.shape,"All tensors passed to stack must have matching shapes"),GC(s===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=k8({inputs:t.map(e=>{const t=M7({inputs:{input:e},backend:n,attrs:{dim:a}});return o.push(t),t}),backend:n,attrs:{axis:a}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};class Bee{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=O3(r),i=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(a," start = ").concat(a,"(").concat(i,");\n      ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(a," coords = outC - start;\n          setOutput(getX(").concat(o,"));\n        }\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class kee{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,a=O3(r),i=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=o4("rc",r),l=o4("source",r),c="".concat(o[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(l.slice(-2).join(),")"),h=["".concat(a," rc = outputLoc;"),"".concat(o[r-1]," += 1;\n       if(").concat(c,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(o[r-2]," += 1;\n       if(").concat(o[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(o[r-1]," += 1;\n         if(").concat(c,") {")],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let A="";for(let p=0,f=1===r?2:4;p<f;p++)A+="\n        ".concat(h[p],"\n        if (").concat(d,") {\n          result[").concat(p,"] = float(value);\n        } else {\n          ").concat(a," source = rc - start;\n          result[").concat(p,"] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ");A+=1===r?"} ":"}}",this.userCode="\n      const ".concat(a," start = ").concat(a,"(").concat(i,");\n      const ").concat(a," end = ").concat(a,"(").concat(s,");\n\n      void main() {\n        ").concat(a," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(A,"\n        setOutput(result);\n      }\n    ")}}const Iee=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:i,constantValue:s}=r;if(0===XC(a.shape)){const e=i.map((e,t)=>e[0]+a.shape[t]+e[1]);return H7({backend:n,attrs:{shape:e,value:s,dtype:a.dtype}})}const o=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kee(a.shape,i,s):new Bee(a.shape,i,s),l=[[s]];return n.runWebGLProgram(o,[a],a.dtype,l)},Tee={kernelName:TB,backendName:"webgl",kernelFunc:Iee},Mee=j4({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+B4+"\n  return result;\n"}),Fee={kernelName:MB,backendName:"webgl",kernelFunc:Mee};const Ree={kernelName:RB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:i,keepDims:s}=r,o=a.shape.length,l=[],c=nE(i,a.shape);let u=c;const h=_L(u,o);let d,A=a;if(null!=h&&(A=o6({inputs:{x:a},backend:n,attrs:{perm:h}}),u=CL(u.length,o),l.push(A)),wL("prod",u,o),n.shouldExecuteOnCPU([A])){const e=n.texData.get(A.dataId).values,{outVals:t,outShape:r,outDtype:a}=U5(A.shape,A.dtype,e,u);d=n.makeTensorInfo(r,a,t)}else{const[e,t]=bL(A.shape,u),r=XC(t),i=J4({inputs:{x:A},backend:n,attrs:{shape:[-1,r]}}),s=t6(i,jI(a.dtype),"prod",n);d=J4({inputs:{x:s},backend:n,attrs:{shape:e}}),l.push(i),l.push(s)}if(s){l.push(d);const e=xL(d.shape,c);d=J4({inputs:{x:d},backend:n,attrs:{shape:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}};const Lee={kernelName:LB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:o}=r,l=a.map(e=>n.readSync(e.dataId)),c=a.map(e=>e.shape),u=n.readSync(i.dataId),h=n.readSync(s.dataId),[d,A,p]=P5(l,c,u,i.shape,i.dtype,h,s.shape,o),f=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(p,i.dtype,A);return f.concat([m])}};const Uee={kernelName:UB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:i}=t,s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[c,u]=D5(s,r.shape,r.dtype,o,a.shape,l,i.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],r.dtype,u)]}};const Pee={kernelName:PB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:a,values:i,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,c=n.readSync(a.dataId),u=n.readSync(i.dataId),h=n.readSync(s.dataId),d=o.map(e=>n.readSync(e.dataId)),A=o.map(e=>e.shape),[p,f]=O5(c,a.shape,u,i.shape,i.dtype,h,s.shape,d,A,l);return n.makeTensorInfo(p,i.dtype,f)}},Dee=e=>{const{backend:t,attrs:n}=e,{start:r,stop:a,step:i,dtype:s}=n,o=z5(r,a,i,s);return t.makeTensorInfo([o.length],s,o)},Oee={kernelName:DB,backendName:"webgl",kernelFunc:Dee},zee=H4({opSnippet:"return 1.0 / x;"}),Hee={kernelName:zB,backendName:"webgl",kernelFunc:zee},jee=H4({opSnippet:f4+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Qee={kernelName:HB,backendName:"webgl",kernelFunc:jee},Vee=H4({opSnippet:f4+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Wee={kernelName:KB,backendName:"webgl",kernelFunc:Vee};class Gee{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class Kee{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=a?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const qee={kernelName:WB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,c]=o,u=EE().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kee(a.shape,l,c,i,s):new Gee(a.shape,l,c,i,s);return n.runWebGLProgram(u,[a],"float32")}};class Xee{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,A=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(A,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(a-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const Yee={kernelName:GB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new Xee(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}};class Jee{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class Zee{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,o,l]=e;this.outputShape=[i,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=a?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const $ee={kernelName:QB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:i,halfPixelCenters:s,size:o}=r,[l,c]=o,u=EE().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Zee(a.shape,l,c,i,s):new Jee(a.shape,l,c,i,s);return n.runWebGLProgram(u,[a],a.dtype)}};class ete{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,a]=t,[,i,s]=e,o=[n&&i>1?r-1:r,n&&s>1?a-1:a],l=[n&&i>1?i-1:i,n&&s>1?s-1:s],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,A=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(A,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(o[0],") *\n                (float(dyR) / float(").concat(l[0],"));\n\n            float sourceFracCol =\n                float(").concat(o[1],") *\n                  (float(dyC) / float(").concat(l[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(a,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const tte={kernelName:VB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:a,dy:i}=t,{alignCorners:s}=r,o=new ete(i.shape,a.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}};class nte{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const r=e.map((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(r)).join(","),a=O3(n);this.userCode="\n      void main() {\n        ".concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}class rte{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const r=o4("rc",n),a="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),i="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=O3(n);function o(n){const r=e.map((r,a)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(a,n)),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(a,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return o(e)}(r.slice()),";\n          if(").concat(a,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(r.slice()),";\n          }\n          if(").concat(i,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice()),";\n            if(").concat(a,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const ate={kernelName:qB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:i}=r,s=a.shape.length,o=nE(i,a.shape);if(0===s)return I4({inputs:{x:a},backend:n});const l=EE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rte(a.shape,o):new nte(a.shape,o);return n.runWebGLProgram(l,[a],a.dtype)}};class ite{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let a="";a="number"===typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(a,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const ste={kernelName:Dk,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:a}=t,{radians:i,fillValue:s,center:o}=n,l=r,c=new ite(a.shape,s),[u,h]=kO(o,a.shape[1],a.shape[2]),d=[[u,h,Math.sin(i),Math.cos(i)]];return l.runWebGLProgram(c,[a],a.dtype,d)}},ote=H4({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),lte={kernelName:XB,backendName:"webgl",kernelFunc:ote},cte=H4({opSnippet:"return inversesqrt(x);",cpuKernelImpl:H5}),ute={kernelName:YB,backendName:"webgl",kernelFunc:cte};class hte{constructor(e,t,n,r,a,i){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const o=O3(a.length),l=O3(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let A="";s&&(A="coords[0], coords[1]");const p="getDefaultValue(".concat(A,")"),f=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(a,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(u,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(p,", sum, float(found)));\n        }\n      ")}}class dte{constructor(e,t,n,r,a,i){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const o=O3(a.length),l=O3(i.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let A="";s&&(A="coords[0], coords[1]");const p="getDefaultValue(".concat(A,")"),f=t>1?"strides[j]":"strides",m=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(a,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(u,");\n              flattenedIndex += index.xz * ").concat(f,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(m,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(p,", sum, found));\n        }\n      ")}}const Ate={kernelName:JB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:i}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UP(0,a,s),d=[h/c,c];if(0===h)return n.makeTensorInfo(s,a.dtype);const A=J4({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),p=J4({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),f=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;m=EE().getBool("WEBGL_PACK")?new dte(l,o,A.shape.length,p.shape.length,u,d):new hte(l,o,A.shape.length,p.shape.length,u,d);const g=n.runWebGLProgram(m,[p,A,f],p.dtype),y=J4({inputs:{x:g},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(f),y}};class pte{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const a="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),i=2===EE().getNumber("WEBGL_VERSION")?"while (left < right) {":a,s="left"===r?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(i,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const fte={kernelName:$B,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:i}=t,{side:s}=r,o=new pte(a.shape[0],a.shape[1],i.shape[1],s),l=[[a.shape[1]]];return n.runWebGLProgram(o,[a,i],"int32",l)}};class mte{constructor(e,t,n){let r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)a="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[];for(let r=0;r<t.length;r++)s.push("".concat(n[r])),r<e&&i.push("".concat(n[r]));r=i.join(),a=s.join()}const i=O3(n);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(a,"));\n        } else {\n          setOutput(getB(").concat(a,"));\n        }\n      }\n    ")}}const gte={kernelName:ek,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:a,e:i}=t,s=new mte(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(s,[r,a,i],HI(a.dtype,i.dtype))}},yte=H4({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(UO,";\n  float scale = ").concat(PO,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),vte={kernelName:tk,backendName:"webgl",kernelFunc:yte},bte=H4({opSnippet:z4+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Q5}),xte={kernelName:sk,backendName:"webgl",kernelFunc:bte},wte=H4({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),_te={kernelName:ik,backendName:"webgl",kernelFunc:wte},Ste=H4({opSnippet:z4+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(B4,"\n  return result;\n")}),Cte={kernelName:rk,backendName:"webgl",kernelFunc:Ste},Ete=H4({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),Nte={kernelName:ak,backendName:"webgl",kernelFunc:Ete},Bte=H4({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),kte={kernelName:ok,backendName:"webgl",kernelFunc:Bte},Ite={kernelName:uk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:i,paddings:s}=r;GC(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=i.reduce((e,t)=>e*t),l=[[0,0]];l.push(...s);for(let g=1+i.length;g<a.shape.length;++g)l.push([0,0]);const c=[],u=Iee({inputs:{x:a},backend:n,attrs:{paddings:l,constantValue:0}}),h=IO(u.shape,i,o,!1),d=TO(h.length,i.length,!1),A=MO(u.shape,i,o,!1),p=J4({inputs:{x:u},backend:n,attrs:{shape:h}}),f=o6({inputs:{x:p},backend:n,attrs:{perm:d}}),m=J4({inputs:{x:f},backend:n,attrs:{shape:A}});return c.push(u),c.push(p),c.push(f),c.forEach(e=>n.disposeIntermediateTensorInfo(e)),m}};const Tte={kernelName:Ak,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:i,defaultValue:s}=t;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));const o=n.readSync(r.dataId),l=n.readSync(a.dataId),c=n.readSync(i.dataId),u=n.readSync(s.dataId)[0],[h,d,A,p,f]=G5(o,r.shape,r.dtype,l,a.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,A),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}};const Mte={kernelName:pk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:i}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));const s=Array.from(n.readSync(a.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(i.dataId)),[c,u,h]=K5(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};const Fte={kernelName:fk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));const s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[c,u]=q5(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};const Rte={kernelName:mk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));const s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=n.readSync(i.dataId),[c,u]=q5(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,c)}};const Lte={kernelName:gk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:i,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=UP(0,a,o),A=!1;if("string"===i.dtype){const e=n.bufferSync(a),t=n.bufferSync(i),r=gI(n.readSync(s.dataId)[0]),p=j5(e,t,o,d,u,c,l,h,r,A);return n.makeTensorInfo(o,p.dtype,p.values)}const p=new hte(c,l,a.shape.length,i.shape.length,h,[d,1],A),f=n.runWebGLProgram(p,[i,a,s],i.dtype),m=J4({inputs:{x:f},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),m}};const Ute={kernelName:hk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:i,axis:s}=r,o=nE(s,a.shape)[0],l=lz(a,i,o),c=a.shape.length,u=new Array(c).fill(0),h=a.shape.slice();return l.map(e=>{const t=[...h];t[o]=e;const r=r8({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r})}},Pte="return sqrt(x);",Dte=H4({opSnippet:Pte,packedOpSnippet:Pte,cpuKernelImpl:X5}),Ote={kernelName:lk,backendName:"webgl",kernelFunc:Dte},zte={kernelName:vk,backendName:"webgl",kernelFunc:H4({opSnippet:"return x * x;"})},Hte="return (a - b) * (a - b);",jte=j4({opSnippet:Hte,packedOpSnippet:Hte}),Qte={kernelName:yk,backendName:"webgl",kernelFunc:jte};const Vte={kernelName:bk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");const i=Sz(n.readSync(a.dataId)),s=Y5(i,"string",r);return n.makeTensorInfo(a.shape,"string",s)}};const Wte={kernelName:Uk,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e;const{x:a}=t,i=f4+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),s=new p4(a.shape,i);return r.runWebGLProgram(s,[a],a.dtype)}};class Gte{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,a=O3(n.length),i=O3(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map((t,r)=>(e++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(e-1,"] * strides[").concat(r,"] + begin[").concat(r,"]"))).join(",")}this.userCode="\n      ".concat(a," begin = ").concat(a,"(").concat(e,");\n      ").concat(a," strides = ").concat(a,"(").concat(t,");\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}}const Kte={kernelName:xk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:i,end:s,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:A,finalShape:p,isIdentity:f,sliceDim0:m,isSimpleSlice:g,begin:y,end:v,strides:b}=XF(a.shape,i,s,o,l,c,u,h,d);let x;if(f)x=J4({inputs:{x:a},backend:n,attrs:{shape:p}});else if(m||g){GC(a.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(a.shape.length));const e=UF(y,v,b),t=r8({inputs:{x:a},backend:n,attrs:{begin:y,size:e}});x=J4({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([a])){const e=n.readSync(a.dataId),t=NM(a.shape,a.dtype,e),r=J5(A,t,b,y);x=n.makeTensorInfo(p,a.dtype,r.values)}else{const e=new Gte(y,b,A);x=n.runWebGLProgram(e,[a],a.dtype)}}const w=J4({inputs:{x:x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(x),w}};const qte={kernelName:wk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:i,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=t,d=n.readSync(u.dataId),A=n.readSync(h.dataId),[p,f]=Z5(d,A,a,i,s,o,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",f)]}};const Xte={kernelName:_k,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:i,delimiter:s}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(1!==i.shape.length)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(0!==s.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(s.shape));const o=n.readSync(i.dataId),l=n.readSync(s.dataId)[0],[c,u,h]=$5(o,l,a),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};const Yte={kernelName:Sk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");const s=n.readSync(i.dataId),o=e4(s,a);return n.makeTensorInfo(i.shape,"int32",o)}},Jte=H4({opSnippet:"return tan(x);"}),Zte={kernelName:Ek,backendName:"webgl",kernelFunc:Jte},$te=H4({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),ene={kernelName:Nk,backendName:"webgl",kernelFunc:$te};const tne={kernelName:ZB,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:i,updates:s}=t,{}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UP(0,i,a.shape),d=[h/c,c];if(0===h)return n.makeTensorInfo(a.shape,i.dtype);const A=J4({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),p=J4({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),f=J4({inputs:{x:a},backend:n,attrs:{shape:d}}),m=new hte(l,o,A.shape.length,p.shape.length,u,d,!1,!0),g=n.runWebGLProgram(m,[p,A,f],f.dtype),y=J4({inputs:{x:g},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),y}};class nne{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;const r=O3(this.rank),a=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")}}function rne(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:i}=r;if("string"===a.dtype||a.shape.length>5){const e=n.readSync(a.dataId),t="string"===a.dtype?e.map(e=>gI(e)):e,r=NM(a.shape,a.dtype,t),s=n4(r,i);return n.makeTensorInfo(s.shape,s.dtype,s.values)}const s=new nne(a.shape,i);return n.runWebGLProgram(s,[a],a.dtype)}const ane={kernelName:Bk,backendName:"webgl",kernelFunc:rne};class ine{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class sne{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function one(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function lne(e){let t=1;for(;t<e;)t*=2;return t}const cne={kernelName:kk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:i,sorted:s}=r,o=EE().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=EE().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([a])||u<o||i>l){const e=n.readSync(a.dataId),[t,r]=r4(e,c,a.dtype,i,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[a,H7({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(a.dataId),d=null!==h&&h.isPacked,A=d?n.unpackTensor(a):a,p=XC(c)/u,f=J4({inputs:{x:A},attrs:{shape:[p,u]},backend:n});d&&one(n,A);const m=lne(i),g=lne(u);let y=null;const v=()=>null===y?[f,f]:[f,y],b=(e,t,r)=>{const a=v(),i=new ine(r),s=[[u],[null===y?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=y;y=n.runWebGLProgram(i,a,"int32",s),one(n,o)};for(let C=1;C<m;C*=2){const e=2*C;for(let t=C;t>=1;t/=2)b(e,t,[p,g])}for(let C=g;C>m;C/=2){const e=v(),t=new sne([p,C/2]),r=[[u],[null===y?1:0],[m]],a=y;y=n.runWebGLProgram(t,e,"int32",r),one(n,a);const i=m/2,s=2*i;for(let n=i;n>=1;n/=2)b(s,n,y.shape)}let x=y;y=r8({inputs:{x:y},backend:n,attrs:{begin:0,size:[p,i]}}),one(n,x);let w=s9({inputs:{x:f,indices:y},backend:n,attrs:{axis:1,batchDims:1}});one(n,f);const _=c.slice(0,-1);_.push(i),x=y,y=J4({inputs:{x:y},attrs:{shape:_},backend:n}),one(n,x);const S=w;return w=J4({inputs:{x:w},attrs:{shape:_},backend:n}),one(n,S),[w,y]}};class une{constructor(e,t,n,r,a,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const s="nearest"===n?1:2;let o;switch(r){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(o," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(a,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(a,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(s," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const hne={kernelName:Ik,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:i}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:c}=r,[u,h,d,A]=a.shape,[p,f]=null!=c?c:[h,d],m=new une(h,d,s,o,l,[u,p,f,A]);return n.runWebGLProgram(m,[a,i],"float32")}};const dne={kernelName:Mk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:i}=t;x3(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(i.dataId),{outputValues:o,outputShape:l,indices:c}=i4(s,a,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,o),r.makeTensorInfo([c.length],"int32",c)]}};const Ane={kernelName:Fk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:a}=t;let{axis:i}=r;i<0&&(i+=a.shape.length);const s=a,o=s.shape.length,l=a.shape[i],c=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==i&&(c[u++]=s.shape[f]);const h=[],d=new Array(o).fill(0),A=s.shape.slice();A[i]=1;const p=new Array(l);for(let f=0;f<p.length;f++){d[i]=f;const e=r8({inputs:{x:s},backend:n,attrs:{begin:d,size:A}}),t=J4({inputs:{x:e},backend:n,attrs:{shape:c}});p[f]=t,h.push(e)}return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};class pne{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,s=i*Math.ceil(a/n);this.outputShape=[r,s];const o=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";a%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return initializationValue;\n        }\n      "));let h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(a,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(i,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(i,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(o,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(o,";\n        if (").concat(1===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(c,"\n        } else if (").concat(2===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(c,"\n        } else if (").concat(3===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(c,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const fne={kernelName:Rk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:i}=t,{numSegments:s}=r,o=a.shape.length,l=[];let c=0;const u=_L([c],o);let h=a;null!=u&&(h=o6({inputs:{x:a},backend:n,attrs:{perm:u}}),l.push(h),c=CL(1,o)[0]);const d=wz(h.shape,c,s),A=XC([h.shape[c]]),p=J4({inputs:{x:h},backend:n,attrs:{shape:[-1,A]}});l.push(p);const f=jI(a.dtype),m=(e,t,r,a,i)=>{const s=e.shape[0],o=e.shape[1],c=xz(o,i),u=new pne({windowSize:c,inSize:o,batchSize:s,numSegments:i},t),h=n.compileAndRun(u,[e,r],a);if(l.push(h),h.shape[1]===i)return h;const d=Dee({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),A=rne({inputs:{x:d},backend:n,attrs:{reps:[o/c]}});l.push(d),l.push(A);return m(h,t,A,a,i)},g=J4({inputs:{x:m(p,"unsortedSegmentSum",i,f,s)},backend:n,attrs:{shape:d}});let y=g;if(null!=u){l.push(g);const e=SL(u);y=o6({inputs:{x:y},backend:n,attrs:{perm:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}},mne=[u6,d6,p6,m6,v6,w6,_6,S6,I6,T6,F6,L6,P6,O6,H6,V6,W6,q6,X6,Y6,$6,i8,s8,o8,l8,A8,m8,v8,F4,w8,I8,D8,Q8,W8,G8,K8,q8,Y8,Z8,e7,s7,o7,l7,u7,A7,m7,g7,v7,x7,w7,S7,C7,N7,k7,T7,F7,U7,O7,j7,V7,K7,X7,Z7,t9,n9,a9,o9,c9,h9,T4,d9,N8,p9,m9,y9,U4,b9,w9,_9,C9,N9,k9,T9,F9,U9,D9,z9,j9,Q9,V9,K9,q9,X9,Y9,J9,$9,nee,aee,Aee,Y4,fee,gee,vee,xee,u8,_ee,Eee,Nee,Tee,Fee,O4,Ree,Lee,Uee,Pee,Oee,d8,oee,Hee,Qee,Wee,Z4,qee,Yee,$ee,tte,ate,ste,lte,ute,Ate,fte,gte,vte,xte,_te,Cte,Nte,a8,dee,kte,Ite,Tte,Mte,Fte,Rte,Lte,Ute,Ote,zte,Qte,Vte,Wte,Kte,qte,Xte,Yte,uee,s6,Zte,ene,tne,ane,cne,hne,l6,dne,Ane,fne,Cee];for(const n of mne)Xk(n);const gne=new class{constructor(){this.model=null,this.isLoaded=!1}async initialize(){try{return this.model=await kX("/models/surface-detection/model.json"),this.isLoaded=!0,console.log("AI Surface Detection model loaded successfully"),!0}catch(_S){return console.error("Failed to load AI model:",_S),this.isLoaded=!1,!1}}async detectSurfaces(e){const t=await this.loadImage(e);return this.isLoaded&&this.model?await this.aiDetection(t):await this.heuristicDetection(t)}async aiDetection(e){const t=TF(e).resizeBilinear([513,513]).expandDims(0).toFloat().div(127.5).sub(1),n=await this.model.predict(t),r=await n.squeeze().array(),a=this.processSegmentationMap(r,e.width,e.height);return t.dispose(),n.dispose(),a}async heuristicDetection(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.drawImage(e,0,0);const r=n.getImageData(0,0,t.width,t.height).data;return{surfaces:[...this.detectRoofRegions(r,t.width,t.height),...this.detectWallRegions(r,t.width,t.height),...this.detectEdgeRegions(r,t.width,t.height)],confidence:.75,method:"heuristic"}}detectRoofRegions(e,t,n){const r=[],a=.4*n,i=[];for(let s=0;s<a;s+=10)for(let n=0;n<t;n+=10){const r=4*(s*t+n),a=e[r],o=e[r+1],l=e[r+2];this.isRoofColor(a,o,l)&&i.push({x:n,y:s})}return this.clusterPoints(i,50).forEach((e,t)=>{if(e.length>10){const n=this.getBounds(e);r.push({id:"roof-".concat(t),type:"roof",bounds:n,points:e,confidence:this.calculateConfidence(e,"roof"),area:this.calculateArea(n),suitable:["shingles","ridge-vent","flashing"]})}}),r}detectWallRegions(e,t,n){const r=[],a=[];for(let i=.4*n;i<n;i+=10)for(let n=0;n<t;n+=10){const r=4*(i*t+n),s=e[r],o=e[r+1],l=e[r+2];this.isWallColor(s,o,l)&&a.push({x:n,y:i})}return this.clusterPoints(a,60).forEach((e,t)=>{if(e.length>15){const n=this.getBounds(e);r.push({id:"wall-".concat(t),type:"wall",bounds:n,points:e,confidence:this.calculateConfidence(e,"wall"),area:this.calculateArea(n),suitable:["siding","trim","gutters"]})}}),r}detectEdgeRegions(e,t,n){const r=[],a=(this.detectEdges(e,t,n),{id:"eave-primary",type:"eave",bounds:{x:.1*t,y:.45*n,width:.8*t,height:20},confidence:.7,suitable:["lighting","gutters"]});return r.push(a),r}detectEdges(e,t,n){const r=new Uint8ClampedArray(t*n);for(let a=1;a<n-1;a++)for(let n=1;n<t-1;n++){const i=this.getPixelBrightness(e,4*(a*t+n+1))-this.getPixelBrightness(e,4*(a*t+n-1)),s=this.getPixelBrightness(e,4*((a+1)*t+n))-this.getPixelBrightness(e,4*((a-1)*t+n)),o=Math.sqrt(i*i+s*s);r[a*t+n]=o>30?255:0}return r}getPixelBrightness(e,t){return(e[t]+e[t+1]+e[t+2])/3}isRoofColor(e,t,n){const r=(e+t+n)/3,a=Math.abs(e-t)<30&&Math.abs(t-n)<30;return r<150&&(a||e>t&&t>n&&e-n>20)}isWallColor(e,t,n){const r=(e+t+n)/3;return r>80&&r<240}clusterPoints(e,t){const n=[],r=new Set;return e.forEach((a,i)=>{if(r.has(i))return;const s=[a];r.add(i),e.forEach((e,n)=>{if(r.has(n))return;Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2))<t&&(s.push(e),r.add(n))}),n.push(s)}),n}getBounds(e){const t=e.map(e=>e.x),n=e.map(e=>e.y),r=Math.min(...t),a=Math.max(...t),i=Math.min(...n);return{x:r,y:i,width:a-r,height:Math.max(...n)-i}}calculateConfidence(e,t){const n=Math.min(e.length/100,1),r="roof"===t?.1:.05;return Math.min(n+r,.95)}calculateArea(e){return e.width*e.height}processSegmentationMap(e,t,n){const r=[];return Object.entries({0:"background",1:"roof",2:"wall",3:"window",4:"door",5:"vegetation"}).forEach(a=>{let[i,s]=a;if("background"===s||"vegetation"===s)return;const o=this.extractMask(e,parseInt(i));this.maskToRegions(o,t,n).forEach((e,t)=>{r.push({id:"".concat(s,"-").concat(t),type:s,bounds:e.bounds,mask:e.mask,confidence:e.confidence,area:this.calculateArea(e.bounds),suitable:this.getSuitableProducts(s)})})}),{surfaces:r,confidence:.92,method:"ai"}}extractMask(e,t){return e.map(e=>e.map(e=>e===t?1:0))}maskToRegions(e,t,n){return[{bounds:{x:0,y:0,width:t,height:n},mask:e,confidence:.9}]}getSuitableProducts(e){return{roof:["shingles","ridge-vent","flashing","underlayment"],wall:["siding","trim","paint"],eave:["lighting","gutters","soffit"],edge:["lighting","gutters"]}[e]||[]}loadImage(e){return new Promise((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=n,r.src=e})}async analyzePanorama(e){const t=await this.detectSurfaces(e);return M(M({},t),{},{placements:this.generatePlacements(t.surfaces)})}generatePlacements(e){const t=[];return e.forEach(e=>{switch(e.type){case"roof":t.push({surfaceId:e.id,product:"shingles",coverage:100,position:this.boundsToPosition(e.bounds),autoPlaced:!0});break;case"eave":t.push({surfaceId:e.id,product:"lighting",spacing:12,position:this.boundsToPosition(e.bounds),autoPlaced:!0})}}),t}boundsToPosition(e){const t=e.x+e.width/2,n=e.y+e.height/2;return{x:t,y:n,spherical:this.pixelToSpherical(t,n)}}pixelToSpherical(e,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024;return{theta:e/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048)*Math.PI*2,phi:t/n*Math.PI}}};const yne=new class{constructor(){this.placementRules={shingles:{minCoverage:.95,overlapFactor:1.1,alignment:"horizontal"},lighting:{spacing:12,offset:6,pattern:"uniform"},ridgeVent:{placement:"peak",coverage:.9},gutters:{placement:"eave",coverage:1}}}async autoPlaceAll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await gne.analyzePanorama(e),r={shingles:[],lighting:[],ridgeVent:[],gutters:[],flashings:[]};return n.surfaces.filter(e=>"roof"===e.type).forEach(e=>{r.shingles.push(...this.placeShingles(e,t.shingleColor||"weathered-wood"));const n=this.placeRidgeVent(e);n&&r.ridgeVent.push(n)}),n.surfaces.filter(e=>"eave"===e.type).forEach(e=>{r.lighting.push(...this.placeLighting(e,t.lightingPattern||"uniform"))}),n.surfaces.filter(e=>"eave"===e.type).forEach(e=>{r.gutters.push(this.placeGutters(e))}),{placements:r,surfaces:n.surfaces,confidence:n.confidence,summary:this.generateSummary(r)}}placeShingles(e,t){const n=[],r=e.bounds,a=e.area,i={id:"shingle-auto-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical(r),bounds:r,coverage:a,autoPlaced:!0,confidence:e.confidence,type:"shingle-region",uvMapping:this.calculateUVMapping(r),material:{roughness:.85,metalness:.1,normalScale:1.5}};n.push(i);const s=this.generateEdgeShingles(e,t);return n.push(...s),n}generateEdgeShingles(e,t){const n=[],r=e.bounds;return n.push({id:"edge-top-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x,y:r.y,width:r.width,height:10}),type:"ridge-shingle",autoPlaced:!0}),n.push({id:"edge-left-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x,y:r.y,width:10,height:r.height}),type:"rake-shingle",autoPlaced:!0}),n.push({id:"edge-right-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x+r.width-10,y:r.y,width:10,height:r.height}),type:"rake-shingle",autoPlaced:!0}),n}placeLighting(e,t){const n=[],r=e.bounds,a=this.placementRules.lighting.spacing,i=.5*r.width,s=Math.floor(i/a);for(let o=0;o<s;o++){const a=r.x+r.width/s*o,i=r.y+this.placementRules.lighting.offset,l=this.pixelToSpherical(a,i);n.push({id:"light-auto-".concat(e.id,"-").concat(o),surfaceId:e.id,position:this.sphericalToCartesian(l.theta,l.phi,480),spherical:l,type:"rime-light",autoPlaced:!0,index:o,color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12,pattern:t})}return n}placeRidgeVent(e){const t=e.bounds,n={x:t.x+.1*t.width,y:t.y,width:.8*t.width,height:15};return{id:"ridge-vent-auto-".concat(e.id),surfaceId:e.id,position:this.boundsToSpherical(n),bounds:n,type:"ridge-vent",autoPlaced:!0,coverage:n.width,product:"malarkey-ridge-vent"}}placeGutters(e){const t=e.bounds;return{id:"gutter-auto-".concat(e.id),surfaceId:e.id,position:this.boundsToSpherical(t),bounds:t,type:"gutter",autoPlaced:!0,coverage:t.width,color:"white",style:"k-style"}}boundsToSpherical(e){const t=e.x+e.width/2,n=e.y+e.height/2;return this.pixelToSpherical(t,n)}pixelToSpherical(e,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024;return{theta:e/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048)*Math.PI*2-Math.PI,phi:t/n*Math.PI}}sphericalToCartesian(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;return[n*Math.sin(t)*Math.cos(e),n*Math.cos(t),n*Math.sin(t)*Math.sin(e)]}calculateUVMapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024;return{u:e.x/t,v:e.y/n,uWidth:e.width/t,vHeight:e.height/n}}generateSummary(e){return{shingles:{count:e.shingles.length,totalArea:e.shingles.reduce((e,t)=>e+(t.coverage||0),0)},lighting:{count:e.lighting.length,totalLength:12*e.lighting.length},ridgeVent:{count:e.ridgeVent.length,totalLength:e.ridgeVent.reduce((e,t)=>e+(t.coverage||0),0)},gutters:{count:e.gutters.length,totalLength:e.gutters.reduce((e,t)=>e+(t.coverage||0),0)}}}optimizePlacements(e){const t=M({},e);return t.shingles=this.mergeOverlappingRegions(e.shingles),t.lighting=this.optimizeLightingSpacing(e.lighting),t}mergeOverlappingRegions(e){const t=[],n=new Set;return e.forEach((r,a)=>{if(n.has(a))return;let i=r;e.forEach((e,t)=>{a===t||n.has(t)||this.regionsOverlap(i,e)&&(i=this.mergeRegions(i,e),n.add(t))}),t.push(i)}),t}regionsOverlap(e,t){return!(!e.bounds||!t.bounds)&&!(e.bounds.x+e.bounds.width<t.bounds.x||t.bounds.x+t.bounds.width<e.bounds.x||e.bounds.y+e.bounds.height<t.bounds.y||t.bounds.y+t.bounds.height<e.bounds.y)}mergeRegions(e,t){const n=Math.min(e.bounds.x,t.bounds.x),r=Math.min(e.bounds.y,t.bounds.y),a=Math.max(e.bounds.x+e.bounds.width,t.bounds.x+t.bounds.width),i=Math.max(e.bounds.y+e.bounds.height,t.bounds.y+t.bounds.height);return M(M({},e),{},{bounds:{x:n,y:r,width:a-n,height:i-r},coverage:(a-n)*(i-r)})}optimizeLightingSpacing(e){return e.filter((t,n)=>{if(0===n)return!0;const r=e[n-1],a=this.calculateDistance(t.position,r.position);return a>=8&&a<=18})}calculateDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}adjustPlacement(e,t){return M(M({},t),{},{autoPlaced:!1,originalAutoPlacement:e})}};const vne=new class{constructor(){this.apiEndpoint={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AUTH_CODE:"IAMBRANDON",REACT_APP_FIREBASE_API_KEY:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",REACT_APP_FIREBASE_APP_ID:"1:874590395925:web:41fff249ed9a7b349af81c",REACT_APP_FIREBASE_AUTH_DOMAIN:"crmbackend-470221.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-4BG7SZMK6K",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"874590395925",REACT_APP_FIREBASE_PROJECT_ID:"crmbackend-470221",REACT_APP_FIREBASE_STORAGE_BUCKET:"crmbackend-470221.firebasestorage.app",REACT_APP_GAS_WEB_APP_URL:"https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4",REACT_APP_SHEET_NAME:"Bhotchleads",REACT_APP_SPREADSHEET_ID:"1E9VX7XI7GNGJa8Hq9__XAWv95WNgfJto1gUEXMbGqi0",REACT_APP_TWILIO_ACCOUNT_SID:"AC20e24f43ac063d43511d06c688b5ec06",REACT_APP_TWILIO_AUTH_TOKEN:"65cc837132a39a100d4b03a8a234f2ed",REACT_APP_TWILIO_PHONE_NUMBER:"+13852357204"}.REACT_APP_PHOTOGRAMMETRY_API||"/api/photogrammetry",this.requiredPhotos=8,this.processingStatus=null}async processPhotos(e){if(e.length<this.requiredPhotos)throw new Error("Minimum ".concat(this.requiredPhotos," photos required. Got ").concat(e.length,"."));const t=await this.validatePhotos(e);if(!t.valid)throw new Error("Photo validation failed: ".concat(t.errors.join(", ")));const n=new FormData;e.forEach((e,t)=>{n.append("photo_".concat(t),e.file),n.append("metadata_".concat(t),JSON.stringify({angle:e.angle,timestamp:e.timestamp,gps:e.gps,orientation:e.orientation}))});try{const e=await fetch("".concat(this.apiEndpoint,"/process"),{method:"POST",body:n});if(!e.ok)throw new Error("Upload failed: ".concat(e.statusText));const t=await e.json();return this.processingStatus=t.jobId,{jobId:t.jobId,estimatedTime:t.estimatedTime||300,status:"processing"}}catch(_S){throw console.error("Photogrammetry processing failed:",_S),_S}}async validatePhotos(e){const t=[];e.length!==this.requiredPhotos&&t.push("Expected ".concat(this.requiredPhotos," photos, got ").concat(e.length));const n=e.map(e=>e.angle),r=["front-left","front-right","left-side","right-side","back-left","back-right","overhead","detail"].filter(e=>!n.includes(e));r.length>0&&t.push("Missing required angles: ".concat(r.join(", ")));for(const a of e){const e=await this.checkImageQuality(a);e.passed||t.push("Photo ".concat(a.angle,": ").concat(e.issue))}return{valid:0===t.length,errors:t}}async checkImageQuality(e){return new Promise(t=>{const n=new Image;n.onload=()=>{const e={passed:!0,issue:null};(n.width<1920||n.height<1080)&&(e.passed=!1,e.issue="Resolution too low (minimum 1920x1080)");const r=n.width/n.height;(r<1.3||r>1.8)&&(e.passed=!1,e.issue="Unusual aspect ratio"),t(e)},n.onerror=()=>{t({passed:!1,issue:"Invalid image file"})},n.src=e.preview||URL.createObjectURL(e.file)})}async getStatus(e){try{const t=await fetch("".concat(this.apiEndpoint,"/status/").concat(e)),n=await t.json();return{jobId:e,status:n.status,progress:n.progress||0,result:n.result||null,error:n.error||null}}catch(_S){return console.error("Failed to get status:",_S),{jobId:e,status:"unknown",error:_S.message}}}async downloadModel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"glb";try{const n=await fetch("".concat(this.apiEndpoint,"/download/").concat(e,"?format=").concat(t));if(!n.ok)throw new Error("Download failed");const r=await n.blob();return{format:t,blob:r,url:URL.createObjectURL(r)}}catch(_S){throw console.error("Model download failed:",_S),_S}}async cancelJob(e){try{return await fetch("".concat(this.apiEndpoint,"/cancel/").concat(e),{method:"POST"}),!0}catch(_S){return console.error("Failed to cancel job:",_S),!1}}async generatePointCloudPreview(e){if(e.length<2)throw new Error("Minimum 2 photos required for preview");const t=[],n=await this.extractFeatures(e[0]),r=await this.extractFeatures(e[1]);return this.matchFeatures(n,r).forEach(n=>{const r=this.triangulatePoint(n,e[0],e[1]);r&&t.push(r)}),{points:t,count:t.length,bounds:this.calculateBounds(t),preview:!0}}async extractFeatures(e){return new Promise(t=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas"),r=e.getContext("2d");e.width=n.width,e.height=n.height,r.drawImage(n,0,0);const a=r.getImageData(0,0,e.width,e.height),i=this.detectKeypoints(a);t(i)},n.src=e.preview||URL.createObjectURL(e.file)})}detectKeypoints(e){const t=[],{data:n,width:r,height:a}=e,i=20;for(let s=i;s<a-i;s+=i)for(let e=i;e<r-i;e+=i){const a=this.getGradientX(n,e,s,r),i=this.getGradientY(n,e,s,r),o=Math.sqrt(a*a+i*i);o>30&&t.push({x:e,y:s,magnitude:o,descriptor:this.createDescriptor(n,e,s,r)})}return t}getGradientX(e,t,n,r){const a=4*(n*r+t),i=(e[a-4]+e[a-3]+e[a-2])/3;return(e[a+4]+e[a+5]+e[a+6])/3-i}getGradientY(e,t,n,r){const a=4*(n*r+t),i=(e[a-4*r]+e[a-4*r+1]+e[a-4*r+2])/3;return(e[a+4*r]+e[a+4*r+1]+e[a+4*r+2])/3-i}createDescriptor(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;const i=[];for(let s=-a;s<=a;s+=2)for(let o=-a;o<=a;o+=2){const a=4*((n+s)*r+(t+o));i.push((e[a]+e[a+1]+e[a+2])/3)}return i}matchFeatures(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r=[];return e.forEach(e=>{let a=null,i=1/0;t.forEach(t=>{const n=this.descriptorDistance(e.descriptor,t.descriptor);n<i&&(i=n,a=t)}),i<n&&r.push({point1:{x:e.x,y:e.y},point2:{x:a.x,y:a.y},distance:i})}),r}descriptorDistance(e,t){return Math.sqrt(e.reduce((e,n,r)=>e+Math.pow(n-t[r],2),0))}triangulatePoint(e,t,n){return{x:(e.point1.x+e.point2.x)/2,y:(e.point1.y+e.point2.y)/2,z:.1*Math.abs(e.point1.x-e.point2.x),confidence:1/(1+e.distance)}}calculateBounds(e){if(0===e.length)return{min:[0,0,0],max:[0,0,0]};const t=e.map(e=>e.x),n=e.map(e=>e.y),r=e.map(e=>e.z);return{min:[Math.min(...t),Math.min(...n),Math.min(...r)],max:[Math.max(...t),Math.max(...n),Math.max(...r)]}}pointCloudToMesh(e){const t={vertices:e.points.map(e=>[e.x,e.y,e.z]),colors:e.points.map(()=>[1,1,1]),bounds:e.bounds};return t}async estimateMeasurements(e){return{roofArea:0,pitch:0,perimeter:0,valleys:[],ridges:[],hips:[]}}};var bne=n(2284),xne=Uint8Array,wne=Uint16Array,_ne=Int32Array,Sne=new xne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cne=new xne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ene=new xne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nne=function(e,t){for(var n=new wne(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new _ne(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},Bne=Nne(Sne,2),kne=Bne.b,Ine=Bne.r;kne[28]=258,Ine[258]=28;for(var Tne=Nne(Cne,0),Mne=(Tne.b,Tne.r),Fne=new wne(32768),Rne=0;Rne<32768;++Rne){var Lne=(43690&Rne)>>1|(21845&Rne)<<1;Lne=(61680&(Lne=(52428&Lne)>>2|(13107&Lne)<<2))>>4|(3855&Lne)<<4,Fne[Rne]=((65280&Lne)>>8|(255&Lne)<<8)>>1}var Une=function(e,t,n){for(var r=e.length,a=0,i=new wne(t);a<r;++a)e[a]&&++i[e[a]-1];var s,o=new wne(t);for(a=1;a<t;++a)o[a]=o[a-1]+i[a-1]<<1;if(n){s=new wne(1<<t);var l=15-t;for(a=0;a<r;++a)if(e[a])for(var c=a<<4|e[a],u=t-e[a],h=o[e[a]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Fne[h]>>l]=c}else for(s=new wne(r),a=0;a<r;++a)e[a]&&(s[a]=Fne[o[e[a]-1]++]>>15-e[a]);return s},Pne=new xne(288);for(Rne=0;Rne<144;++Rne)Pne[Rne]=8;for(Rne=144;Rne<256;++Rne)Pne[Rne]=9;for(Rne=256;Rne<280;++Rne)Pne[Rne]=7;for(Rne=280;Rne<288;++Rne)Pne[Rne]=8;var Dne=new xne(32);for(Rne=0;Rne<32;++Rne)Dne[Rne]=5;var One=Une(Pne,9,0),zne=Une(Dne,5,0),Hne=function(e){return(e+7)/8|0},jne=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new xne(e.subarray(t,n))},Qne=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},Vne=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},Wne=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var a=n.length,i=n.slice();if(!a)return{t:Zne,l:0};if(1==a){var s=new xne(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var o=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=a-1;)o=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:o.f+l.f,l:o,r:l};var d=i[0].s;for(r=1;r<a;++r)i[r].s>d&&(d=i[r].s);var A=new wne(d+1),p=Gne(n[u-1],A,0);if(p>t){r=0;var f=0,m=p-t,g=1<<m;for(i.sort(function(e,t){return A[t.s]-A[e.s]||e.f-t.f});r<a;++r){var y=i[r].s;if(!(A[y]>t))break;f+=g-(1<<p-A[y]),A[y]=t}for(f>>=m;f>0;){var v=i[r].s;A[v]<t?f-=1<<t-A[v]++-1:++r}for(;r>=0&&f;--r){var b=i[r].s;A[b]==t&&(--A[b],++f)}p=t}return{t:new xne(A),l:p}},Gne=function(e,t,n){return-1==e.s?Math.max(Gne(e.l,t,n+1),Gne(e.r,t,n+1)):t[e.s]=n},Kne=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new wne(++t),r=0,a=e[0],i=1,s=function(e){n[r++]=e},o=1;o<=t;++o)if(e[o]==a&&o!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(a),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(a);i=1,a=e[o]}return{c:n.subarray(0,r),n:t}},qne=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Xne=function(e,t,n){var r=n.length,a=Hne(t+2);e[a]=255&r,e[a+1]=r>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<r;++i)e[a+i+4]=n[i];return 8*(a+4+r)},Yne=function(e,t,n,r,a,i,s,o,l,c,u){Qne(t,u++,n),++a[256];for(var h=Wne(a,15),d=h.t,A=h.l,p=Wne(i,15),f=p.t,m=p.l,g=Kne(d),y=g.c,v=g.n,b=Kne(f),x=b.c,w=b.n,_=new wne(19),S=0;S<y.length;++S)++_[31&y[S]];for(S=0;S<x.length;++S)++_[31&x[S]];for(var C=Wne(_,7),E=C.t,N=C.l,B=19;B>4&&!E[Ene[B-1]];--B);var k,I,T,M,F=c+5<<3,R=qne(a,Pne)+qne(i,Dne)+s,L=qne(a,d)+qne(i,f)+s+14+3*B+qne(_,E)+2*_[16]+3*_[17]+7*_[18];if(l>=0&&F<=R&&F<=L)return Xne(t,u,e.subarray(l,l+c));if(Qne(t,u,1+(L<R)),u+=2,L<R){k=Une(d,A,0),I=d,T=Une(f,m,0),M=f;var U=Une(E,N,0);Qne(t,u,v-257),Qne(t,u+5,w-1),Qne(t,u+10,B-4),u+=14;for(S=0;S<B;++S)Qne(t,u+3*S,E[Ene[S]]);u+=3*B;for(var P=[y,x],D=0;D<2;++D){var O=P[D];for(S=0;S<O.length;++S){var z=31&O[S];Qne(t,u,U[z]),u+=E[z],z>15&&(Qne(t,u,O[S]>>5&127),u+=O[S]>>12)}}}else k=One,I=Pne,T=zne,M=Dne;for(S=0;S<o;++S){var H=r[S];if(H>255){Vne(t,u,k[(z=H>>18&31)+257]),u+=I[z+257],z>7&&(Qne(t,u,H>>23&31),u+=Sne[z]);var j=31&H;Vne(t,u,T[j]),u+=M[j],j>3&&(Vne(t,u,H>>5&8191),u+=Cne[j])}else Vne(t,u,k[H]),u+=I[H]}return Vne(t,u,k[256]),u+I[256]},Jne=new _ne([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Zne=new xne(0),$ne=function(e,t,n,r,a,i){var s=i.z||e.length,o=new xne(r+s+5*(1+Math.ceil(s/7e3))+a),l=o.subarray(r,o.length-a),c=i.l,u=7&(i.r||0);if(t){u&&(l[0]=i.r>>3);for(var h=Jne[t-1],d=h>>13,A=8191&h,p=(1<<n)-1,f=i.p||new wne(32768),m=i.h||new wne(p+1),g=Math.ceil(n/3),y=2*g,v=function(t){return(e[t]^e[t+1]<<g^e[t+2]<<y)&p},b=new _ne(25e3),x=new wne(288),w=new wne(32),_=0,S=0,C=i.i||0,E=0,N=i.w||0,B=0;C+2<s;++C){var k=v(C),I=32767&C,T=m[k];if(f[I]=T,m[k]=I,N<=C){var M=s-C;if((_>7e3||E>24576)&&(M>423||!c)){u=Yne(e,l,0,b,x,w,S,E,B,C-B,u),E=_=S=0,B=C;for(var F=0;F<286;++F)x[F]=0;for(F=0;F<30;++F)w[F]=0}var R=2,L=0,U=A,P=I-T&32767;if(M>2&&k==v(C-P))for(var D=Math.min(d,M)-1,O=Math.min(32767,C),z=Math.min(258,M);P<=O&&--U&&I!=T;){if(e[C+R]==e[C+R-P]){for(var H=0;H<z&&e[C+H]==e[C+H-P];++H);if(H>R){if(R=H,L=P,H>D)break;var j=Math.min(P,H-2),Q=0;for(F=0;F<j;++F){var V=C-P+F&32767,W=V-f[V]&32767;W>Q&&(Q=W,T=V)}}}P+=(I=T)-(T=f[I])&32767}if(L){b[E++]=268435456|Ine[R]<<18|Mne[L];var G=31&Ine[R],K=31&Mne[L];S+=Sne[G]+Cne[K],++x[257+G],++w[K],N=C+R,++_}else b[E++]=e[C],++x[e[C]]}}for(C=Math.max(C,N);C<s;++C)b[E++]=e[C],++x[e[C]];u=Yne(e,l,c,b,x,w,S,E,B,C-B,u),c||(i.r=7&u|l[u/8|0]<<3,u-=7,i.h=m,i.p=f,i.i=C,i.w=N)}else{for(C=i.w||0;C<s+c;C+=65535){var q=C+65535;q>=s&&(l[u/8|0]=c,q=s),u=Xne(l,u+1,e.subarray(C,q))}i.i=s}return jne(o,0,r+Hne(u)+a)},ere=function(){var e=1,t=0;return{p:function(n){for(var r=e,a=t,i=0|n.length,s=0;s!=i;){for(var o=Math.min(s+2655,i);s<o;++s)a+=r+=n[s];r=(65535&r)+15*(r>>16),a=(65535&a)+15*(a>>16)}e=r,t=a},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},tre=function(e,t,n,r,a){if(!a&&(a={l:1},t.dictionary)){var i=t.dictionary.subarray(-32768),s=new xne(i.length+e.length);s.set(i),s.set(e,i.length),e=s,a.w=i.length}return $ne(e,null==t.level?6:t.level,null==t.mem?a.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,r,a)},nre=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},rre=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var a=ere();a.p(t.dictionary),nre(e,2,a.d())}};function are(e,t){t||(t={});var n=ere();n.p(e);var r=tre(e,t,t.dictionary?6:2,4);return rre(r,t),nre(r,r.length-4,n.d()),r}var ire="undefined"!=typeof TextDecoder&&new TextDecoder;try{ire.decode(Zne,{stream:!0})}catch(che){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function sre(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ore(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,s,o=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return sre(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?sre(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lre(e){return new TextDecoder(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").decode(e)}const cre=new TextEncoder;const ure=(()=>{const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])})(),hre={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class dre{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,I.A)(this,"buffer",void 0),(0,I.A)(this,"byteLength",void 0),(0,I.A)(this,"byteOffset",void 0),(0,I.A)(this,"length",void 0),(0,I.A)(this,"offset",void 0),(0,I.A)(this,"lastWrittenByte",void 0),(0,I.A)(this,"littleEndian",void 0),(0,I.A)(this,"_data",void 0),(0,I.A)(this,"_mark",void 0),(0,I.A)(this,"_marks",void 0);let n=!1;"number"===typeof e?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,a=e.byteLength-r;let i=r;(ArrayBuffer.isView(e)||e instanceof dre)&&(e.byteLength!==e.buffer.byteLength&&(i=e.byteOffset+r),e=e.buffer),this.lastWrittenByte=n?a:0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,a),this._mark=0,this._marks=[]}available(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=e,this}back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readArray(e,"uint8")}readArray(e,t){const n=hre[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,a=this.buffer.slice(r,r+n);if(this.littleEndian===ure&&"uint8"!==t&&"int8"!==t){const e=new Uint8Array(this.buffer.slice(r,r+n));e.reverse();const a=new hre[t](e.buffer);return this.offset+=n,a.reverse(),a}const i=new hre[t](a);return this.offset+=n,i}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return lre(this.readBytes(e))}decodeText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";return lre(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return cre.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Are(e){let t=e.length;for(;--t>=0;)e[t]=0}const pre=256,fre=286,mre=30,gre=15,yre=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vre=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),bre=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xre=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wre=new Array(576);Are(wre);const _re=new Array(60);Are(_re);const Sre=new Array(512);Are(Sre);const Cre=new Array(256);Are(Cre);const Ere=new Array(29);Are(Ere);const Nre=new Array(mre);function Bre(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}let kre,Ire,Tre;function Mre(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Are(Nre);const Fre=e=>e<256?Sre[e]:Sre[256+(e>>>7)],Rre=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Lre=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Rre(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Ure=(e,t,n)=>{Lre(e,n[2*t],n[2*t+1])},Pre=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Dre=(e,t,n)=>{const r=new Array(16);let a,i,s=0;for(a=1;a<=gre;a++)s=s+n[a-1]<<1,r[a]=s;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=Pre(r[t]++,t))}},Ore=e=>{let t;for(t=0;t<fre;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mre;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},zre=e=>{e.bi_valid>8?Rre(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Hre=(e,t,n,r)=>{const a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]},jre=(e,t,n)=>{const r=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&Hre(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Hre(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r},Qre=(e,t,n)=>{let r,a,i,s,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,a=e.pending_buf[e.sym_buf+o++],0===r?Ure(e,a,t):(i=Cre[a],Ure(e,i+pre+1,t),s=yre[i],0!==s&&(a-=Ere[i],Lre(e,a,s)),r--,i=Fre(r),Ure(e,i,n),s=vre[i],0!==s&&(r-=Nre[i],Lre(e,r,s)))}while(o<e.sym_next);Ure(e,256,t)},Vre=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,i=t.stat_desc.elems;let s,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<i;s++)0!==n[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=r[2*l+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)jre(e,n,s);l=i;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],jre(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,n[2*l]=n[2*s]+n[2*o],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,n[2*s+1]=n[2*o+1]=l,e.heap[1]=l++,jre(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,h,d,A,p,f=0;for(d=0;d<=gre;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],d=n[2*n[2*u+1]+1]+1,d>l&&(d=l,f++),n[2*u+1]=d,u>r||(e.bl_count[d]++,A=0,u>=o&&(A=s[u-o]),p=n[2*u],e.opt_len+=p*(d+A),i&&(e.static_len+=p*(a[2*u+1]+A)));if(0!==f){do{for(d=l-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(d=l;0!==d;d--)for(u=e.bl_count[d];0!==u;)h=e.heap[--c],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}})(e,t),Dre(n,c,e.bl_count)},Wre=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=s,s=t[2*(r+1)+1],++o<l&&a===s||(o<c?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(l=138,c=3):a===s?(l=6,c=3):(l=7,c=4))},Gre=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=n;r++)if(a=s,s=t[2*(r+1)+1],!(++o<l&&a===s)){if(o<c)do{Ure(e,a,e.bl_tree)}while(0!==--o);else 0!==a?(a!==i&&(Ure(e,a,e.bl_tree),o--),Ure(e,16,e.bl_tree),Lre(e,o-3,2)):o<=10?(Ure(e,17,e.bl_tree),Lre(e,o-3,3)):(Ure(e,18,e.bl_tree),Lre(e,o-11,7));o=0,i=a,0===s?(l=138,c=3):a===s?(l=6,c=3):(l=7,c=4)}};let Kre=!1;const qre=(e,t,n,r)=>{Lre(e,0+(r?1:0),3),zre(e),Rre(e,n),Rre(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Xre=e=>{Kre||((()=>{let e,t,n,r,a;const i=new Array(16);for(n=0,r=0;r<28;r++)for(Ere[r]=n,e=0;e<1<<yre[r];e++)Cre[n++]=r;for(Cre[n-1]=r,a=0,r=0;r<16;r++)for(Nre[r]=a,e=0;e<1<<vre[r];e++)Sre[a++]=r;for(a>>=7;r<mre;r++)for(Nre[r]=a<<7,e=0;e<1<<vre[r]-7;e++)Sre[256+a++]=r;for(t=0;t<=gre;t++)i[t]=0;for(e=0;e<=143;)wre[2*e+1]=8,e++,i[8]++;for(;e<=255;)wre[2*e+1]=9,e++,i[9]++;for(;e<=279;)wre[2*e+1]=7,e++,i[7]++;for(;e<=287;)wre[2*e+1]=8,e++,i[8]++;for(Dre(wre,287,i),e=0;e<mre;e++)_re[2*e+1]=5,_re[2*e]=Pre(e,5);kre=new Bre(wre,yre,257,fre,gre),Ire=new Bre(_re,vre,0,mre,gre),Tre=new Bre(new Array(0),bre,0,19,7)})(),Kre=!0),e.l_desc=new Mre(e.dyn_ltree,kre),e.d_desc=new Mre(e.dyn_dtree,Ire),e.bl_desc=new Mre(e.bl_tree,Tre),e.bi_buf=0,e.bi_valid=0,Ore(e)},Yre=(e,t,n,r)=>{let a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<pre;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Vre(e,e.l_desc),Vre(e,e.d_desc),s=(e=>{let t;for(Wre(e,e.dyn_ltree,e.l_desc.max_code),Wre(e,e.dyn_dtree,e.d_desc.max_code),Vre(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*xre[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=a&&(a=i)):a=i=n+5,n+4<=a&&-1!==t?qre(e,t,n,r):4===e.strategy||i===a?(Lre(e,2+(r?1:0),3),Qre(e,wre,_re)):(Lre(e,4+(r?1:0),3),((e,t,n,r)=>{let a;for(Lre(e,t-257,5),Lre(e,n-1,5),Lre(e,r-4,4),a=0;a<r;a++)Lre(e,e.bl_tree[2*xre[a]+1],3);Gre(e,e.dyn_ltree,t-1),Gre(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Qre(e,e.dyn_ltree,e.dyn_dtree)),Ore(e),r&&zre(e)},Jre=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Cre[n]+pre+1)]++,e.dyn_dtree[2*Fre(t)]++),e.sym_next===e.sym_end),Zre=e=>{Lre(e,2,3),Ure(e,256,wre),(e=>{16===e.bi_valid?(Rre(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},$re={_tr_init:Xre,_tr_stored_block:qre,_tr_flush_block:Yre,_tr_tally:Jre,_tr_align:Zre};var eae=(e,t,n,r)=>{let a=65535&e,i=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{a=a+t[r++]|0,i=i+a|0}while(--s);a%=65521,i%=65521}return a|i<<16};const tae=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var nae=(e,t,n,r)=>{const a=tae,i=r+n;e^=-1;for(let s=r;s<i;s++)e=e>>>8^a[255&(e^t[s])];return-1^e},rae={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},aae={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:iae,_tr_stored_block:sae,_tr_flush_block:oae,_tr_tally:lae,_tr_align:cae}=$re,{Z_NO_FLUSH:uae,Z_PARTIAL_FLUSH:hae,Z_FULL_FLUSH:dae,Z_FINISH:Aae,Z_BLOCK:pae,Z_OK:fae,Z_STREAM_END:mae,Z_STREAM_ERROR:gae,Z_DATA_ERROR:yae,Z_BUF_ERROR:vae,Z_DEFAULT_COMPRESSION:bae,Z_FILTERED:xae,Z_HUFFMAN_ONLY:wae,Z_RLE:_ae,Z_FIXED:Sae,Z_DEFAULT_STRATEGY:Cae,Z_UNKNOWN:Eae,Z_DEFLATED:Nae}=aae,Bae=258,kae=262,Iae=42,Tae=113,Mae=666,Fae=(e,t)=>(e.msg=rae[t],t),Rae=e=>2*e-(e>4?9:0),Lae=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Uae=e=>{let t,n,r,a=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=a?n-a:0}while(--t);t=a,r=t;do{n=e.prev[--r],e.prev[r]=n>=a?n-a:0}while(--t)};let Pae=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Dae=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Oae=(e,t)=>{oae(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Dae(e.strm)},zae=(e,t)=>{e.pending_buf[e.pending++]=t},Hae=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},jae=(e,t,n,r)=>{let a=e.avail_in;return a>r&&(a=r),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),1===e.state.wrap?e.adler=eae(e.adler,t,a,n):2===e.state.wrap&&(e.adler=nae(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},Qae=(e,t)=>{let n,r,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-kae?e.strstart-(e.w_size-kae):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+Bae;let A=c[i+s-1],p=c[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+s]===p&&c[n+s-1]===A&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<d);if(r=Bae-(d-i),i=d-Bae,r>s){if(e.match_start=t,s=r,r>=o)break;A=c[i+s-1],p=c[i+s]}}}while((t=h[t&u])>l&&0!==--a);return s<=e.lookahead?s:e.lookahead},Vae=e=>{const t=e.w_size;let n,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-kae)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Uae(e),r+=t),0===e.strm.avail_in)break;if(n=jae(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Pae(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Pae(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<kae&&0!==e.strm.avail_in)},Wae=(e,t)=>{let n,r,a,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>a&&(n=a),n<i&&(0===n&&t!==Aae||t===uae||n!==r+e.strm.avail_in))break;s=t===Aae&&n===r+e.strm.avail_in?1:0,sae(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Dae(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(jae(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==uae&&t!==Aae&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(jae(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,i=a>e.w_size?e.w_size:a,r=e.strstart-e.block_start,(r>=i||(r||t===Aae)&&t!==uae&&0===e.strm.avail_in&&r<=a)&&(n=r>a?a:r,s=t===Aae&&0===e.strm.avail_in&&n===r?1:0,sae(e,e.block_start,n,s),e.block_start+=n,Dae(e.strm)),s?3:1)},Gae=(e,t)=>{let n,r;for(;;){if(e.lookahead<kae){if(Vae(e),e.lookahead<kae&&t===uae)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Pae(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-kae&&(e.match_length=Qae(e,n)),e.match_length>=3)if(r=lae(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Pae(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Pae(e,e.ins_h,e.window[e.strstart+1]);else r=lae(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Oae(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Aae?(Oae(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Oae(e,!1),0===e.strm.avail_out)?1:2},Kae=(e,t)=>{let n,r,a;for(;;){if(e.lookahead<kae){if(Vae(e),e.lookahead<kae&&t===uae)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Pae(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-kae&&(e.match_length=Qae(e,n),e.match_length<=5&&(e.strategy===xae||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,r=lae(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=Pae(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Oae(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=lae(e,0,e.window[e.strstart-1]),r&&Oae(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=lae(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Aae?(Oae(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Oae(e,!1),0===e.strm.avail_out)?1:2};function qae(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}const Xae=[new qae(0,0,0,0,Wae),new qae(4,4,8,4,Gae),new qae(4,5,16,8,Gae),new qae(4,6,32,32,Gae),new qae(4,4,16,16,Kae),new qae(8,16,32,32,Kae),new qae(8,16,128,128,Kae),new qae(8,32,128,256,Kae),new qae(32,128,258,1024,Kae),new qae(32,258,258,4096,Kae)];function Yae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Nae,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Lae(this.dyn_ltree),Lae(this.dyn_dtree),Lae(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Lae(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Lae(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Jae=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Iae&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Tae&&t.status!==Mae?1:0},Zae=e=>{if(Jae(e))return Fae(e,gae);e.total_in=e.total_out=0,e.data_type=Eae;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Iae:Tae,e.adler=2===t.wrap?0:1,t.last_flush=-2,iae(t),fae},$ae=e=>{const t=Zae(e);return t===fae&&(e=>{e.window_size=2*e.w_size,Lae(e.head),e.max_lazy_match=Xae[e.level].max_lazy,e.good_match=Xae[e.level].good_length,e.nice_match=Xae[e.level].nice_length,e.max_chain_length=Xae[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},eie=(e,t,n,r,a,i)=>{if(!e)return gae;let s=1;if(t===bae&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||n!==Nae||r<8||r>15||t<0||t>9||i<0||i>Sae||8===r&&1!==s)return Fae(e,gae);8===r&&(r=9);const o=new Yae;return e.state=o,o.strm=e,o.status=Iae,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=n,$ae(e)};var tie=(e,t)=>{if(Jae(e)||t>pae||t<0)return e?Fae(e,gae):gae;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Mae&&t!==Aae)return Fae(e,0===e.avail_out?vae:gae);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Dae(e),0===e.avail_out)return n.last_flush=-1,fae}else if(0===e.avail_in&&Rae(t)<=Rae(r)&&t!==Aae)return Fae(e,vae);if(n.status===Mae&&0!==e.avail_in)return Fae(e,vae);if(n.status===Iae&&0===n.wrap&&(n.status=Tae),n.status===Iae){let t=Nae+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=wae||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Hae(n,t),0!==n.strstart&&(Hae(n,e.adler>>>16),Hae(n,65535&e.adler)),e.adler=1,n.status=Tae,Dae(e),0!==n.pending)return n.last_flush=-1,fae}if(57===n.status)if(e.adler=0,zae(n,31),zae(n,139),zae(n,8),n.gzhead)zae(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),zae(n,255&n.gzhead.time),zae(n,n.gzhead.time>>8&255),zae(n,n.gzhead.time>>16&255),zae(n,n.gzhead.time>>24&255),zae(n,9===n.level?2:n.strategy>=wae||n.level<2?4:0),zae(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(zae(n,255&n.gzhead.extra.length),zae(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=nae(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(zae(n,0),zae(n,0),zae(n,0),zae(n,0),zae(n,0),zae(n,9===n.level?2:n.strategy>=wae||n.level<2?4:0),zae(n,3),n.status=Tae,Dae(e),0!==n.pending)return n.last_flush=-1,fae;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=nae(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=a,Dae(e),0!==n.pending)return n.last_flush=-1,fae;t=0,r-=a}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=nae(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=nae(e.adler,n.pending_buf,n.pending-r,r)),Dae(e),0!==n.pending)return n.last_flush=-1,fae;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,zae(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=nae(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=nae(e.adler,n.pending_buf,n.pending-r,r)),Dae(e),0!==n.pending)return n.last_flush=-1,fae;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,zae(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=nae(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Dae(e),0!==n.pending))return n.last_flush=-1,fae;zae(n,255&e.adler),zae(n,e.adler>>8&255),e.adler=0}if(n.status=Tae,Dae(e),0!==n.pending)return n.last_flush=-1,fae}if(0!==e.avail_in||0!==n.lookahead||t!==uae&&n.status!==Mae){let r=0===n.level?Wae(n,t):n.strategy===wae?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Vae(e),0===e.lookahead)){if(t===uae)return 1;break}if(e.match_length=0,n=lae(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Oae(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Aae?(Oae(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Oae(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===_ae?((e,t)=>{let n,r,a,i;const s=e.window;for(;;){if(e.lookahead<=Bae){if(Vae(e),e.lookahead<=Bae&&t===uae)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,r=s[a],r===s[++a]&&r===s[++a]&&r===s[++a])){i=e.strstart+Bae;do{}while(r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&a<i);e.match_length=Bae-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=lae(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=lae(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Oae(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Aae?(Oae(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Oae(e,!1),0===e.strm.avail_out)?1:2})(n,t):Xae[n.level].func(n,t);if(3!==r&&4!==r||(n.status=Mae),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),fae;if(2===r&&(t===hae?cae(n):t!==pae&&(sae(n,0,0,!1),t===dae&&(Lae(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Dae(e),0===e.avail_out))return n.last_flush=-1,fae}return t!==Aae?fae:n.wrap<=0?mae:(2===n.wrap?(zae(n,255&e.adler),zae(n,e.adler>>8&255),zae(n,e.adler>>16&255),zae(n,e.adler>>24&255),zae(n,255&e.total_in),zae(n,e.total_in>>8&255),zae(n,e.total_in>>16&255),zae(n,e.total_in>>24&255)):(Hae(n,e.adler>>>16),Hae(n,65535&e.adler)),Dae(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?fae:mae)},nie=(e,t)=>{let n=t.length;if(Jae(e))return gae;const r=e.state,a=r.wrap;if(2===a||1===a&&r.status!==Iae||r.lookahead)return gae;if(1===a&&(e.adler=eae(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===a&&(Lae(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const i=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Vae(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=Pae(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Vae(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=i,r.wrap=a,fae},rie={deflateInit:(e,t)=>eie(e,t,Nae,15,8,Cae),deflateInit2:eie,deflateReset:$ae,deflateResetKeep:Zae,deflateSetHeader:(e,t)=>Jae(e)||2!==e.state.wrap?gae:(e.state.gzhead=t,fae),deflate:tie,deflateEnd:e=>{if(Jae(e))return gae;const t=e.state.status;return e.state=null,t===Tae?Fae(e,yae):fae},deflateSetDictionary:nie,deflateInfo:"pako deflate (from Nodeca project)"};const aie=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var iie=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const t in n)aie(n,t)&&(e[t]=n[t])}}return e},sie=e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,a=0,i=e.length;r<i;r++){let t=e[r];n.set(t,a),a+=t.length}return n};let oie=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(uhe){oie=!1}const lie=new Uint8Array(256);for(let n=0;n<256;n++)lie[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;lie[254]=lie[254]=1;var cie=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,a,i,s=e.length,o=0;for(a=0;a<s;a++)n=e.charCodeAt(a),55296===(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)n=e.charCodeAt(a),55296===(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},uie=(e,t)=>{const n=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,a;const i=new Array(2*n);for(a=0,r=0;r<n;){let t=e[r++];if(t<128){i[a++]=t;continue}let s=lie[t];if(s>4)i[a++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?i[a++]=65533:t<65536?i[a++]=t:(t-=65536,i[a++]=55296|t>>10&1023,i[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&oie)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(i,a)},hie=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+lie[e[n]]>t?n:t};var die=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Aie=Object.prototype.toString,{Z_NO_FLUSH:pie,Z_SYNC_FLUSH:fie,Z_FULL_FLUSH:mie,Z_FINISH:gie,Z_OK:yie,Z_STREAM_END:vie,Z_DEFAULT_COMPRESSION:bie,Z_DEFAULT_STRATEGY:xie,Z_DEFLATED:wie}=aae;function _ie(e){this.options=iie({level:bie,method:wie,chunkSize:16384,windowBits:15,memLevel:8,strategy:xie},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new die,this.strm.avail_out=0;let n=rie.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==yie)throw new Error(rae[n]);if(t.header&&rie.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?cie(t.dictionary):"[object ArrayBuffer]"===Aie.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=rie.deflateSetDictionary(this.strm,e),n!==yie)throw new Error(rae[n]);this._dict_set=!0}}function Sie(e,t){const n=new _ie(t);if(n.push(e,!0),n.err)throw n.msg||rae[n.err];return n.result}_ie.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let a,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?gie:pie,"string"===typeof e?n.input=cie(e):"[object ArrayBuffer]"===Aie.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(i===fie||i===mie)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=rie.deflate(n,i),a===vie)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=rie.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===yie;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},_ie.prototype.onData=function(e){this.chunks.push(e)},_ie.prototype.onEnd=function(e){e===yie&&(this.result=sie(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Cie=function(e,t){return(t=t||{}).raw=!0,Sie(e,t)},Eie=function(e,t){return(t=t||{}).gzip=!0,Sie(e,t)},Nie={Deflate:_ie,deflate:Sie,deflateRaw:Cie,gzip:Eie,constants:aae};const Bie=16209;var kie=function(e,t){let n,r,a,i,s,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S,C;const E=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),a=e.next_out,C=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=E.dmax,l=E.wsize,c=E.whave,u=E.wnext,h=E.window,d=E.hold,A=E.bits,p=E.lencode,f=E.distcode,m=(1<<E.lenbits)-1,g=(1<<E.distbits)-1;e:do{A<15&&(d+=S[n++]<<A,A+=8,d+=S[n++]<<A,A+=8),y=p[d&m];t:for(;;){if(v=y>>>24,d>>>=v,A-=v,v=y>>>16&255,0===v)C[a++]=65535&y;else{if(!(16&v)){if(0===(64&v)){y=p[(65535&y)+(d&(1<<v)-1)];continue t}if(32&v){E.mode=16191;break e}e.msg="invalid literal/length code",E.mode=Bie;break e}b=65535&y,v&=15,v&&(A<v&&(d+=S[n++]<<A,A+=8),b+=d&(1<<v)-1,d>>>=v,A-=v),A<15&&(d+=S[n++]<<A,A+=8,d+=S[n++]<<A,A+=8),y=f[d&g];n:for(;;){if(v=y>>>24,d>>>=v,A-=v,v=y>>>16&255,!(16&v)){if(0===(64&v)){y=f[(65535&y)+(d&(1<<v)-1)];continue n}e.msg="invalid distance code",E.mode=Bie;break e}if(x=65535&y,v&=15,A<v&&(d+=S[n++]<<A,A+=8,A<v&&(d+=S[n++]<<A,A+=8)),x+=d&(1<<v)-1,x>o){e.msg="invalid distance too far back",E.mode=Bie;break e}if(d>>>=v,A-=v,v=a-i,x>v){if(v=x-v,v>c&&E.sane){e.msg="invalid distance too far back",E.mode=Bie;break e}if(w=0,_=h,0===u){if(w+=l-v,v<b){b-=v;do{C[a++]=h[w++]}while(--v);w=a-x,_=C}}else if(u<v){if(w+=l+u-v,v-=u,v<b){b-=v;do{C[a++]=h[w++]}while(--v);if(w=0,u<b){v=u,b-=v;do{C[a++]=h[w++]}while(--v);w=a-x,_=C}}}else if(w+=u-v,v<b){b-=v;do{C[a++]=h[w++]}while(--v);w=a-x,_=C}for(;b>2;)C[a++]=_[w++],C[a++]=_[w++],C[a++]=_[w++],b-=3;b&&(C[a++]=_[w++],b>1&&(C[a++]=_[w++]))}else{w=a-x;do{C[a++]=C[w++],C[a++]=C[w++],C[a++]=C[w++],b-=3}while(b>2);b&&(C[a++]=C[w++],b>1&&(C[a++]=C[w++]))}break}}break}}while(n<r&&a<s);b=A>>3,n-=b,A-=b<<3,d&=(1<<A)-1,e.next_in=n,e.next_out=a,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=a<s?s-a+257:257-(a-s),E.hold=d,E.bits=A};const Iie=15,Tie=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mie=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fie=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Rie=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Lie=(e,t,n,r,a,i,s,o)=>{const l=o.bits;let c,u,h,d,A,p,f=0,m=0,g=0,y=0,v=0,b=0,x=0,w=0,_=0,S=0,C=null;const E=new Uint16Array(16),N=new Uint16Array(16);let B,k,I,T=null;for(f=0;f<=Iie;f++)E[f]=0;for(m=0;m<r;m++)E[t[n+m]]++;for(v=l,y=Iie;y>=1&&0===E[y];y--);if(v>y&&(v=y),0===y)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(g=1;g<y&&0===E[g];g++);for(v<g&&(v=g),w=1,f=1;f<=Iie;f++)if(w<<=1,w-=E[f],w<0)return-1;if(w>0&&(0===e||1!==y))return-1;for(N[1]=0,f=1;f<Iie;f++)N[f+1]=N[f]+E[f];for(m=0;m<r;m++)0!==t[n+m]&&(s[N[t[n+m]]++]=m);if(0===e?(C=T=s,p=20):1===e?(C=Tie,T=Mie,p=257):(C=Fie,T=Rie,p=0),S=0,m=0,f=g,A=i,b=v,x=0,h=-1,_=1<<v,d=_-1,1===e&&_>852||2===e&&_>592)return 1;for(;;){B=f-x,s[m]+1<p?(k=0,I=s[m]):s[m]>=p?(k=T[s[m]-p],I=C[s[m]-p]):(k=96,I=0),c=1<<f-x,u=1<<b,g=u;do{u-=c,a[A+(S>>x)+u]=B<<24|k<<16|I}while(0!==u);for(c=1<<f-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,m++,0===--E[f]){if(f===y)break;f=t[n+s[m]]}if(f>v&&(S&d)!==h){for(0===x&&(x=v),A+=g,b=f-x,w=1<<b;b+x<y&&(w-=E[b+x],!(w<=0));)b++,w<<=1;if(_+=1<<b,1===e&&_>852||2===e&&_>592)return 1;h=S&d,a[h]=v<<24|b<<16|A-i}}return 0!==S&&(a[A+S]=f-x<<24|64<<16),o.bits=v,0};const{Z_FINISH:Uie,Z_BLOCK:Pie,Z_TREES:Die,Z_OK:Oie,Z_STREAM_END:zie,Z_NEED_DICT:Hie,Z_STREAM_ERROR:jie,Z_DATA_ERROR:Qie,Z_MEM_ERROR:Vie,Z_BUF_ERROR:Wie,Z_DEFLATED:Gie}=aae,Kie=16180,qie=16190,Xie=16191,Yie=16192,Jie=16194,Zie=16199,$ie=16200,ese=16206,tse=16209,nse=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function rse(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ase=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Kie||t.mode>16211?1:0},ise=e=>{if(ase(e))return jie;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Kie,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Oie},sse=e=>{if(ase(e))return jie;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ise(e)},ose=(e,t)=>{let n;if(ase(e))return jie;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?jie:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,sse(e))},lse=(e,t)=>{if(!e)return jie;const n=new rse;e.state=n,n.strm=e,n.window=null,n.mode=Kie;const r=ose(e,t);return r!==Oie&&(e.state=null),r};let cse,use,hse=!0;const dse=e=>{if(hse){cse=new Int32Array(512),use=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Lie(1,e.lens,0,288,cse,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Lie(2,e.lens,0,32,use,0,e.work,{bits:5}),hse=!1}e.lencode=cse,e.lenbits=9,e.distcode=use,e.distbits=5},Ase=(e,t,n,r)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>r&&(a=r),i.window.set(t.subarray(n-r,n-r+a),i.wnext),(r-=a)?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};var pse=(e,t)=>{let n,r,a,i,s,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S=0;const C=new Uint8Array(4);let E,N;const B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ase(e)||!e.output||!e.input&&0!==e.avail_in)return jie;n=e.state,n.mode===Xie&&(n.mode=Yie),s=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,h=o,d=l,_=Oie;e:for(;;)switch(n.mode){case Kie:if(0===n.wrap){n.mode=Yie;break}for(;u<16;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&c,C[1]=c>>>8&255,n.check=nae(n.check,C,2,0),c=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=tse;break}if((15&c)!==Gie){e.msg="unknown compression method",n.mode=tse;break}if(c>>>=4,u-=4,w=8+(15&c),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=tse;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Xie,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==Gie){e.msg="unknown compression method",n.mode=tse;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=tse;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=nae(n.check,C,2,0)),c=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,n.check=nae(n.check,C,4,0)),c=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=nae(n.check,C,2,0)),c=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=nae(n.check,C,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(A=n.length,A>o&&(A=o),A&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+A),w)),512&n.flags&&4&n.wrap&&(n.check=nae(n.check,r,A,i)),o-=A,i+=A,n.length-=A),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;A=0;do{w=r[i+A++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&A<o);if(512&n.flags&&4&n.wrap&&(n.check=nae(n.check,r,A,i)),o-=A,i+=A,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;A=0;do{w=r[i+A++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&A<o);if(512&n.flags&&4&n.wrap&&(n.check=nae(n.check,r,A,i)),o-=A,i+=A,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=tse;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Xie;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}e.adler=n.check=nse(c),c=0,u=0,n.mode=qie;case qie:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=u,Hie;e.adler=n.check=1,n.mode=Xie;case Xie:if(t===Pie||t===Die)break e;case Yie:if(n.last){c>>>=7&u,u-=7&u,n.mode=ese;break}for(;u<3;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}switch(n.last=1&c,c>>>=1,u-=1,3&c){case 0:n.mode=16193;break;case 1:if(dse(n),n.mode=Zie,t===Die){c>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=tse}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=tse;break}if(n.length=65535&c,c=0,u=0,n.mode=Jie,t===Die)break e;case Jie:n.mode=16195;case 16195:if(A=n.length,A){if(A>o&&(A=o),A>l&&(A=l),0===A)break e;a.set(r.subarray(i,i+A),s),o-=A,i+=A,l-=A,s+=A,n.length-=A;break}n.mode=Xie;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=tse;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.lens[B[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},_=Lie(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,_){e.msg="invalid code lengths set",n.mode=tse;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[c&(1<<n.lenbits)-1],m=S>>>24,g=S>>>16&255,y=65535&S,!(m<=u);){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(y<16)c>>>=m,u-=m,n.lens[n.have++]=y;else{if(16===y){for(N=m+2;u<N;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(c>>>=m,u-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=tse;break}w=n.lens[n.have-1],A=3+(3&c),c>>>=2,u-=2}else if(17===y){for(N=m+3;u<N;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}c>>>=m,u-=m,w=0,A=3+(7&c),c>>>=3,u-=3}else{for(N=m+7;u<N;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}c>>>=m,u-=m,w=0,A=11+(127&c),c>>>=7,u-=7}if(n.have+A>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=tse;break}for(;A--;)n.lens[n.have++]=w}}if(n.mode===tse)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=tse;break}if(n.lenbits=9,E={bits:n.lenbits},_=Lie(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,_){e.msg="invalid literal/lengths set",n.mode=tse;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},_=Lie(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,_){e.msg="invalid distances set",n.mode=tse;break}if(n.mode=Zie,t===Die)break e;case Zie:n.mode=$ie;case $ie:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=u,kie(e,d),s=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,n.mode===Xie&&(n.back=-1);break}for(n.back=0;S=n.lencode[c&(1<<n.lenbits)-1],m=S>>>24,g=S>>>16&255,y=65535&S,!(m<=u);){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(g&&0===(240&g)){for(v=m,b=g,x=y;S=n.lencode[x+((c&(1<<v+b)-1)>>v)],m=S>>>24,g=S>>>16&255,y=65535&S,!(v+m<=u);){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=m,u-=m,n.back+=m,n.length=y,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=Xie;break}if(64&g){e.msg="invalid literal/length code",n.mode=tse;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(N=n.extra;u<N;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[c&(1<<n.distbits)-1],m=S>>>24,g=S>>>16&255,y=65535&S,!(m<=u);){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(0===(240&g)){for(v=m,b=g,x=y;S=n.distcode[x+((c&(1<<v+b)-1)>>v)],m=S>>>24,g=S>>>16&255,y=65535&S,!(v+m<=u);){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=m,u-=m,n.back+=m,64&g){e.msg="invalid distance code",n.mode=tse;break}n.offset=y,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(N=n.extra;u<N;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=tse;break}n.mode=16204;case 16204:if(0===l)break e;if(A=d-l,n.offset>A){if(A=n.offset-A,A>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=tse;break}A>n.wnext?(A-=n.wnext,p=n.wsize-A):p=n.wnext-A,A>n.length&&(A=n.length),f=n.window}else f=a,p=s-n.offset,A=n.length;A>l&&(A=l),l-=A,n.length-=A;do{a[s++]=f[p++]}while(--A);0===n.length&&(n.mode=$ie);break;case 16205:if(0===l)break e;a[s++]=n.length,l--,n.mode=$ie;break;case ese:if(n.wrap){for(;u<32;){if(0===o)break e;o--,c|=r[i++]<<u,u+=8}if(d-=l,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?nae(n.check,a,d,s-d):eae(n.check,a,d,s-d)),d=l,4&n.wrap&&(n.flags?c:nse(c))!==n.check){e.msg="incorrect data check",n.mode=tse;break}c=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===o)break e;o--,c+=r[i++]<<u,u+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=tse;break}c=0,u=0}n.mode=16208;case 16208:_=zie;break e;case tse:_=Qie;break e;case 16210:return Vie;default:return jie}return e.next_out=s,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<tse&&(n.mode<ese||t!==Uie))&&Ase(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?nae(n.check,a,d,e.next_out-d):eae(n.check,a,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Xie?128:0)+(n.mode===Zie||n.mode===Jie?256:0),(0===h&&0===d||t===Uie)&&_===Oie&&(_=Wie),_},fse={inflateReset:sse,inflateReset2:ose,inflateResetKeep:ise,inflateInit:e=>lse(e,15),inflateInit2:lse,inflate:pse,inflateEnd:e=>{if(ase(e))return jie;let t=e.state;return t.window&&(t.window=null),e.state=null,Oie},inflateGetHeader:(e,t)=>{if(ase(e))return jie;const n=e.state;return 0===(2&n.wrap)?jie:(n.head=t,t.done=!1,Oie)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,a,i;return ase(e)?jie:(r=e.state,0!==r.wrap&&r.mode!==qie?jie:r.mode===qie&&(a=1,a=eae(a,t,n,0),a!==r.check)?Qie:(i=Ase(e,t,n,n),i?(r.mode=16210,Vie):(r.havedict=1,Oie)))},inflateInfo:"pako inflate (from Nodeca project)"};var mse=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const gse=Object.prototype.toString,{Z_NO_FLUSH:yse,Z_FINISH:vse,Z_OK:bse,Z_STREAM_END:xse,Z_NEED_DICT:wse,Z_STREAM_ERROR:_se,Z_DATA_ERROR:Sse,Z_MEM_ERROR:Cse}=aae;function Ese(e){this.options=iie({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new die,this.strm.avail_out=0;let n=fse.inflateInit2(this.strm,t.windowBits);if(n!==bse)throw new Error(rae[n]);if(this.header=new mse,fse.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=cie(t.dictionary):"[object ArrayBuffer]"===gse.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=fse.inflateSetDictionary(this.strm,t.dictionary),n!==bse)))throw new Error(rae[n])}function Nse(e,t){const n=new Ese(t);if(n.push(e),n.err)throw n.msg||rae[n.err];return n.result}Ese.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let i,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?vse:yse,"[object ArrayBuffer]"===gse.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=fse.inflate(n,s),i===wse&&a&&(i=fse.inflateSetDictionary(n,a),i===bse?i=fse.inflate(n,s):i===Sse&&(i=wse));n.avail_in>0&&i===xse&&n.state.wrap>0&&0!==e[n.next_in];)fse.inflateReset(n),i=fse.inflate(n,s);switch(i){case _se:case Sse:case wse:case Cse:return this.onEnd(i),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||i===xse))if("string"===this.options.to){let e=hie(n.output,n.next_out),t=n.next_out-e,a=uie(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(a)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==bse||0!==o){if(i===xse)return i=fse.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Ese.prototype.onData=function(e){this.chunks.push(e)},Ese.prototype.onEnd=function(e){e===bse&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=sie(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bse=function(e,t){return(t=t||{}).raw=!0,Nse(e,t)},kse={Inflate:Ese,inflate:Nse,inflateRaw:Bse,ungzip:Nse,constants:aae};const{Deflate:Ise,deflate:Tse,deflateRaw:Mse,gzip:Fse}=Nie,{Inflate:Rse,inflate:Lse,inflateRaw:Use,ungzip:Pse}=kse;var Dse=Rse,Ose=Lse;const zse=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;zse[n]=e}const Hse=4294967295;function jse(e,t){return(function(e,t,n){let r=e;for(let a=0;a<n;a++)r=zse[255&(r^t[a])]^r>>>8;return r}(Hse,e,t)^Hse)>>>0}function Qse(e,t,n){const r=e.readUint32(),a=jse(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(a!==r)throw new Error("CRC mismatch for chunk ".concat(n,". Expected ").concat(r,", found ").concat(a))}function Vse(e,t,n){for(let r=0;r<n;r++)t[r]=e[r]}function Wse(e,t,n,r){let a=0;for(;a<r;a++)t[a]=e[a];for(;a<n;a++)t[a]=e[a]+t[a-r]&255}function Gse(e,t,n,r){let a=0;if(0===n.length)for(;a<r;a++)t[a]=e[a];else for(;a<r;a++)t[a]=e[a]+n[a]&255}function Kse(e,t,n,r,a){let i=0;if(0===n.length){for(;i<a;i++)t[i]=e[i];for(;i<r;i++)t[i]=e[i]+(t[i-a]>>1)&255}else{for(;i<a;i++)t[i]=e[i]+(n[i]>>1)&255;for(;i<r;i++)t[i]=e[i]+(t[i-a]+n[i]>>1)&255}}function qse(e,t,n,r,a){let i=0;if(0===n.length){for(;i<a;i++)t[i]=e[i];for(;i<r;i++)t[i]=e[i]+t[i-a]&255}else{for(;i<a;i++)t[i]=e[i]+n[i]&255;for(;i<r;i++)t[i]=e[i]+Xse(t[i-a],n[i],n[i-a])&255}}function Xse(e,t,n){const r=e+t-n,a=Math.abs(r-e),i=Math.abs(r-t),s=Math.abs(r-n);return a<=i&&a<=s?e:i<=s?t:n}function Yse(e,t,n,r,a,i){switch(e){case 0:Vse(t,n,a);break;case 1:Wse(t,n,a,i);break;case 2:Gse(t,n,r,a);break;case 3:Kse(t,n,r,a,i);break;case 4:qse(t,n,r,a,i);break;default:throw new Error("Unsupported filter: ".concat(e))}}const Jse=new Uint16Array([255]),Zse=255===new Uint8Array(Jse.buffer)[0];function $se(e){return(255&e)<<8|e>>8&255}const eoe=new Uint16Array([255]),toe=255===new Uint8Array(eoe.buffer)[0],noe=new Uint8Array(0);function roe(e){const{data:t,width:n,height:r,channels:a,depth:i}=e,s=Math.ceil(i/8)*a,o=Math.ceil(i/8*a*n),l=new Uint8Array(r*o);let c,u,h=noe,d=0;for(let A=0;A<r;A++){switch(c=t.subarray(d+1,d+1+o),u=l.subarray(A*o,(A+1)*o),t[d]){case 0:Vse(c,u,o);break;case 1:Wse(c,u,o,s);break;case 2:Gse(c,u,h,o);break;case 3:Kse(c,u,h,o,s);break;case 4:qse(c,u,h,o,s);break;default:throw new Error("Unsupported filter: ".concat(t[d]))}h=u,d+=o+1}if(16===i){const e=new Uint16Array(l.buffer);if(toe)for(let t=0;t<e.length;t++)e[t]=aoe(e[t]);return e}return l}function aoe(e){return(255&e)<<8|e>>8&255}const ioe=Uint8Array.of(137,80,78,71,13,10,26,10);function soe(e){if(!function(e){if(e.length<ioe.length)return!1;for(let t=0;t<ioe.length;t++)if(e[t]!==ioe[t])return!1;return!0}(e.readBytes(ioe.length)))throw new Error("wrong PNG signature")}const ooe="tEXt",loe=new TextDecoder("latin1");function coe(e){if(hoe(e),0===e.length||e.length>79)throw new Error("keyword length must be between 1 and 79")}const uoe=/^[\u0000-\u00FF]*$/;function hoe(e){if(!uoe.test(e))throw new Error("invalid latin1 text")}function doe(e,t,n){const r=Aoe(t);e[r]=function(e,t){return loe.decode(e.readBytes(t))}(t,n-r.length-1)}function Aoe(e){for(e.mark();0!==e.readByte(););const t=e.offset;e.reset();const n=loe.decode(e.readBytes(t-e.offset-1));return e.skip(1),coe(n),n}const poe=-1,foe=0,moe=2,goe=3,yoe=4,voe=6,boe=-1,xoe=0,woe=-1,_oe=0,Soe=-1,Coe=0,Eoe=1,Noe=0,Boe=1,koe=2,Ioe=0,Toe=1;class Moe extends dre{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),(0,I.A)(this,"_checkCrc",void 0),(0,I.A)(this,"_inflator",void 0),(0,I.A)(this,"_png",void 0),(0,I.A)(this,"_apng",void 0),(0,I.A)(this,"_end",void 0),(0,I.A)(this,"_hasPalette",void 0),(0,I.A)(this,"_palette",void 0),(0,I.A)(this,"_hasTransparency",void 0),(0,I.A)(this,"_transparency",void 0),(0,I.A)(this,"_compressionMethod",void 0),(0,I.A)(this,"_filterMethod",void 0),(0,I.A)(this,"_interlaceMethod",void 0),(0,I.A)(this,"_colorType",void 0),(0,I.A)(this,"_isAnimated",void 0),(0,I.A)(this,"_numberOfFrames",void 0),(0,I.A)(this,"_numberOfPlays",void 0),(0,I.A)(this,"_frames",void 0),(0,I.A)(this,"_writingDataChunks",void 0);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new Dse,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=boe,this._filterMethod=woe,this._interlaceMethod=Soe,this._colorType=poe,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(soe(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(soe(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case ooe:doe(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Qse(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Qse(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error("invalid bit depth: ".concat(e));return e}(this.readUint8());const t=this.readUint8();let n;switch(this._colorType=t,t){case foe:n=1;break;case moe:n=3;break;case goe:n=1;break;case yoe:n=2;break;case voe:n=4;break;default:throw new Error("Unknown color type: ".concat(t))}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==xoe)throw new Error("Unsupported compression method: ".concat(this._compressionMethod));this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError("PLTE field length must be a multiple of 3. Got ".concat(e));const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodetRNS(e){switch(this._colorType){case foe:case moe:if(e%2!==0)throw new RangeError("tRNS chunk length must be a multiple of 2. Got ".concat(e));if(e/2>this._png.width*this._png.height)throw new Error("tRNS chunk contains more alpha values than there are pixels (".concat(e/2," vs ").concat(this._png.width*this._png.height,")"));this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case goe:{if(e>this._palette.length)throw new Error("tRNS chunk contains more alpha values than there are palette colors (".concat(e," vs ").concat(this._palette.length,")"));let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error("tRNS chunk is not supported for color type ".concat(this._colorType))}}decodeiCCP(e){const t=Aoe(this),n=this.readUint8();if(n!==xoe)throw new Error("Unsupported iCCP compression method: ".concat(n));const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:Ose(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=roe({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case Noe:break;case Boe:for(let t=0;t<this._png.height;t++)for(let r=0;r<this._png.width;r++){const a=(t*e.width+r)*this._png.channels;for(let e=0;e<this._png.channels;e++)n.data[a+e]=0}break;case koe:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(e,n)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+n)*this._png.channels,frameIndex:(e*t.width+n)*this._png.channels});switch(t.blendOp){case Ioe:for(let n=0;n<t.height;n++)for(let a=0;a<t.width;a++){const{index:i,frameIndex:s}=r(n,a);for(let n=0;n<this._png.channels;n++)e.data[i+n]=t.data[s+n]}break;case Toe:for(let a=0;a<t.height;a++)for(let i=0;i<t.width;i++){const{index:s,frameIndex:o}=r(a,i);for(let r=0;r<this._png.channels;r++){const a=t.data[o+this._png.channels-1]/n,i=r%(this._png.channels-1)===0?1:t.data[o+r],l=Math.floor(a*i+(1-a)*e.data[s+r]);e.data[s+r]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var e;if(this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));const t=this._isAnimated?(null===(e=this._frames)||void 0===e?void 0:e.at(0)).data:this._inflator.result;if(this._filterMethod!==_oe)throw new Error("Filter method ".concat(this._filterMethod," not supported"));if(this._interlaceMethod===Coe)this._png.data=roe({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==Eoe)throw new Error("Interlace method ".concat(this._interlaceMethod," not supported"));this._png.data=function(e){const{data:t,width:n,height:r,channels:a,depth:i}=e,s=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(i/8)*a,l=new Uint8Array(r*n*o);let c=0;for(let u=0;u<7;u++){const e=s[u],a=Math.ceil((n-e.x)/e.xStep),i=Math.ceil((r-e.y)/e.yStep);if(a<=0||i<=0)continue;const h=a*o,d=new Uint8Array(h);for(let s=0;s<i;s++){const i=t[c++],u=t.subarray(c,c+h);c+=h;const A=new Uint8Array(h);Yse(i,u,A,d,h,o),d.set(A);for(let t=0;t<a;t++){const a=e.x+t*e.xStep,i=e.y+s*e.yStep;if(!(a>=n||i>=r))for(let e=0;e<o;e++)l[(i*n+a)*o+e]=A[t*o+e]}}}if(16===i){const e=new Uint16Array(l.buffer);if(Zse)for(let t=0;t<e.length;t++)e[t]=$se(e[t]);return e}return l}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Noe,blendOp:Ioe,data:e}),this._inflator=new Dse,this._writingDataChunks=!1}}var Foe;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(Foe||(Foe={}));var Roe=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function Loe(){Roe.console&&"function"==typeof Roe.console.log&&Roe.console.log.apply(Roe.console,arguments)}var Uoe={log:Loe,warn:function(e){Roe.console&&("function"==typeof Roe.console.warn?Roe.console.warn.apply(Roe.console,arguments):Loe.call(null,arguments))},error:function(e){Roe.console&&("function"==typeof Roe.console.error?Roe.console.error.apply(Roe.console,arguments):Loe(e))}};function Poe(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){zoe(r.response,t,n)},r.onerror=function(){Uoe.error("could not download file")},r.send()}function Doe(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(n){}return t.status>=200&&t.status<=299}function Ooe(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var zoe=Roe.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,bne.A)(window))||window!==Roe?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=Roe.URL||Roe.webkitURL,a=document.createElement("a");t=t||e.name||"download",a.download=t,a.rel="noopener","string"==typeof e?(a.href=e,a.origin!==location.origin?Doe(a.href)?Poe(e,t,n):Ooe(a,a.target="_blank"):Ooe(a)):(a.href=r.createObjectURL(e),setTimeout(function(){r.revokeObjectURL(a.href)},4e4),setTimeout(function(){Ooe(a)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(Doe(e))Poe(e,t,n);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout(function(){Ooe(r)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,bne.A)(t)&&(Uoe.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return Poe(e,t,n);var a="application/octet-stream"===e.type,i=/constructor/i.test(Roe.HTMLElement)||Roe.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||a&&i)&&"object"===("undefined"==typeof FileReader?"undefined":(0,bne.A)(FileReader))){var o=new FileReader;o.onloadend=function(){var e=o.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},o.readAsDataURL(e)}else{var l=Roe.URL||Roe.webkitURL,c=l.createObjectURL(e);r?r.location=c:location.href=c,r=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function Hoe(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<n.length;r++){var a=n[r].re,i=n[r].process,s=a.exec(e);s&&(t=i(s),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}}var joe=Roe.atob.bind(Roe),Qoe=Roe.btoa.bind(Roe);function Voe(e,t){var n=e[0],r=e[1],a=e[2],i=e[3];n=Goe(n,r,a,i,t[0],7,-680876936),i=Goe(i,n,r,a,t[1],12,-389564586),a=Goe(a,i,n,r,t[2],17,606105819),r=Goe(r,a,i,n,t[3],22,-1044525330),n=Goe(n,r,a,i,t[4],7,-176418897),i=Goe(i,n,r,a,t[5],12,1200080426),a=Goe(a,i,n,r,t[6],17,-1473231341),r=Goe(r,a,i,n,t[7],22,-45705983),n=Goe(n,r,a,i,t[8],7,1770035416),i=Goe(i,n,r,a,t[9],12,-1958414417),a=Goe(a,i,n,r,t[10],17,-42063),r=Goe(r,a,i,n,t[11],22,-1990404162),n=Goe(n,r,a,i,t[12],7,1804603682),i=Goe(i,n,r,a,t[13],12,-40341101),a=Goe(a,i,n,r,t[14],17,-1502002290),n=Koe(n,r=Goe(r,a,i,n,t[15],22,1236535329),a,i,t[1],5,-165796510),i=Koe(i,n,r,a,t[6],9,-1069501632),a=Koe(a,i,n,r,t[11],14,643717713),r=Koe(r,a,i,n,t[0],20,-373897302),n=Koe(n,r,a,i,t[5],5,-701558691),i=Koe(i,n,r,a,t[10],9,38016083),a=Koe(a,i,n,r,t[15],14,-660478335),r=Koe(r,a,i,n,t[4],20,-405537848),n=Koe(n,r,a,i,t[9],5,568446438),i=Koe(i,n,r,a,t[14],9,-1019803690),a=Koe(a,i,n,r,t[3],14,-187363961),r=Koe(r,a,i,n,t[8],20,1163531501),n=Koe(n,r,a,i,t[13],5,-1444681467),i=Koe(i,n,r,a,t[2],9,-51403784),a=Koe(a,i,n,r,t[7],14,1735328473),n=qoe(n,r=Koe(r,a,i,n,t[12],20,-1926607734),a,i,t[5],4,-378558),i=qoe(i,n,r,a,t[8],11,-2022574463),a=qoe(a,i,n,r,t[11],16,1839030562),r=qoe(r,a,i,n,t[14],23,-35309556),n=qoe(n,r,a,i,t[1],4,-1530992060),i=qoe(i,n,r,a,t[4],11,1272893353),a=qoe(a,i,n,r,t[7],16,-155497632),r=qoe(r,a,i,n,t[10],23,-1094730640),n=qoe(n,r,a,i,t[13],4,681279174),i=qoe(i,n,r,a,t[0],11,-358537222),a=qoe(a,i,n,r,t[3],16,-722521979),r=qoe(r,a,i,n,t[6],23,76029189),n=qoe(n,r,a,i,t[9],4,-640364487),i=qoe(i,n,r,a,t[12],11,-421815835),a=qoe(a,i,n,r,t[15],16,530742520),n=Xoe(n,r=qoe(r,a,i,n,t[2],23,-995338651),a,i,t[0],6,-198630844),i=Xoe(i,n,r,a,t[7],10,1126891415),a=Xoe(a,i,n,r,t[14],15,-1416354905),r=Xoe(r,a,i,n,t[5],21,-57434055),n=Xoe(n,r,a,i,t[12],6,1700485571),i=Xoe(i,n,r,a,t[3],10,-1894986606),a=Xoe(a,i,n,r,t[10],15,-1051523),r=Xoe(r,a,i,n,t[1],21,-2054922799),n=Xoe(n,r,a,i,t[8],6,1873313359),i=Xoe(i,n,r,a,t[15],10,-30611744),a=Xoe(a,i,n,r,t[6],15,-1560198380),r=Xoe(r,a,i,n,t[13],21,1309151649),n=Xoe(n,r,a,i,t[4],6,-145523070),i=Xoe(i,n,r,a,t[11],10,-1120210379),a=Xoe(a,i,n,r,t[2],15,718787259),r=Xoe(r,a,i,n,t[9],21,-343485551),e[0]=rle(n,e[0]),e[1]=rle(r,e[1]),e[2]=rle(a,e[2]),e[3]=rle(i,e[3])}function Woe(e,t,n,r,a,i){return t=rle(rle(t,e),rle(r,i)),rle(t<<a|t>>>32-a,n)}function Goe(e,t,n,r,a,i,s){return Woe(t&n|~t&r,e,t,a,i,s)}function Koe(e,t,n,r,a,i,s){return Woe(t&r|n&~r,e,t,a,i,s)}function qoe(e,t,n,r,a,i,s){return Woe(t^n^r,e,t,a,i,s)}function Xoe(e,t,n,r,a,i,s){return Woe(n^(t|~r),e,t,a,i,s)}function Yoe(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Voe(r,Joe(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(Voe(r,a),t=0;t<16;t++)a[t]=0;return a[14]=8*n,Voe(r,a),r}function Joe(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var Zoe="0123456789abcdef".split("");function $oe(e){for(var t="",n=0;n<4;n++)t+=Zoe[e>>8*n+4&15]+Zoe[e>>8*n&15];return t}function ele(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function tle(e){return Yoe(e).map(ele).join("")}var nle="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=$oe(e[t]);return e.join("")}(Yoe("hello"));function rle(e,t){if(nle){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}return e+t&4294967295}function ale(e,t){var n,r,a,i;if(e!==n){for(var s=(a=e,i=1+(256/e.length|0),new Array(i+1).join(a)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var u=o[l];c=(c+u+s.charCodeAt(l))%256,o[l]=o[c],o[c]=u}n=e,r=o}else o=r;var h=t.length,d=0,A=0,p="";for(l=0;l<h;l++)A=(A+(u=o[d=(d+1)%256]))%256,o[d]=o[A],o[A]=u,s=o[(o[d]+o[A])%256],p+=String.fromCharCode(t.charCodeAt(l)^s);return p}var ile={print:4,modify:8,copy:16,"annot-forms":32};function sle(e,t,n,r){this.v=1,this.r=2;var a=192;e.forEach(function(e){if(void 0!==ile.perm)throw new Error("Invalid permission: "+e);a+=ile[e]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var i=(t+this.padding).substr(0,32),s=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,s),this.P=-(1+(255^a)),this.encryptionKey=tle(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=ale(this.encryptionKey,this.padding)}function ole(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",n=e.length,r=0;r<n;r++){var a=e.charCodeAt(r);t+=a<33||35===a||37===a||40===a||41===a||47===a||60===a||62===a||91===a||93===a||123===a||125===a||a>126?"#"+("0"+a.toString(16)).slice(-2):e[r]}return t}function lle(e){if("object"!==(0,bne.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,r){if(r=r||!1,"string"!=typeof e||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var a=Math.random().toString(35);return t[e][a]=[n,!!r],a},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],0===Object.keys(t[n]).length&&delete t[n],!0;return!1},this.publish=function(n){if(t.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),a=[];for(var i in t[n]){var s=t[n][i];try{s[0].apply(e,r)}catch(Ooe){Roe.console&&Uoe.error("jsPDF PubSub Error",Ooe.message,Ooe)}s[1]&&a.push(i)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function cle(e){if(!(this instanceof cle))return new cle(e);var t="opacity,stroke-opacity".split(",");for(var n in e)e.hasOwnProperty(n)&&t.indexOf(n)>=0&&(this[n]=e[n]);this.id="",this.objectNumber=-1}function ule(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function hle(e,t,n,r,a){if(!(this instanceof hle))return new hle(e,t,n,r,a);this.type="axial"===e?2:3,this.coords=t,this.colors=n,ule.call(this,r,a)}function dle(e,t,n,r,a){if(!(this instanceof dle))return new dle(e,t,n,r,a);this.boundingBox=e,this.xStep=t,this.yStep=n,this.stream="",this.cloneIndex=0,ule.call(this,r,a)}function Ale(e){var t,n="string"==typeof arguments[0]?arguments[0]:"p",r=arguments[1],a=arguments[2],i=arguments[3],s=[],o=1,l=16,c="S",u=null;"object"===(0,bne.A)(e=e||{})&&(n=e.orientation,r=e.unit||r,a=e.format||a,i=e.compress||e.compressPdf||i,null!==(u=e.encryption||null)&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),o="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),c=e.defaultPathOperation||"S"),s=e.filters||(!0===i?["FlateEncode"]:s),r=r||"mm",n=(""+(n||"P")).toLowerCase();var h=e.putOnlyUsedFonts||!1,d={},A={internal:{},__private__:{}};A.__private__.PubSub=lle;var p="1.3",f=A.__private__.getPdfVersion=function(){return p};A.__private__.setPdfVersion=function(e){p=e};var m={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};A.__private__.getPageFormats=function(){return m};var g=A.__private__.getPageFormat=function(e){return m[e]};a=a||"a4";var y="compat",v="advanced",b=y;function x(){this.saveGraphicsState(),J(new Te(de,0,0,-de,0,An()*de).toString()+" cm"),this.setFontSize(this.getFontSize()/de),c="n",b=v}function w(){this.restoreGraphicsState(),c="S",b=y}var _=A.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};A.advancedAPI=function(e){var t=b===y;return t&&x.call(this),"function"!=typeof e||(e(this),t&&w.call(this)),this},A.compatAPI=function(e){var t=b===v;return t&&w.call(this),"function"!=typeof e||(e(this),t&&x.call(this)),this},A.isAdvancedAPI=function(){return b===v};var S,C=function(e){if(b!==v)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},E=A.roundToPrecision=A.__private__.roundToPrecision=function(e,n){var r=t||n;if(isNaN(e)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(r).replace(/0+$/,"")};S=A.hpf=A.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,16)};var N=A.f2=A.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return E(e,2)},B=A.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return E(e,3)},k=A.scale=A.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return b===y?e*de:b===v?e:void 0},I=function(e){return k(function(e){return b===y?An()-e:b===v?e:void 0}(e))};A.__private__.setPrecision=A.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var T,M="00000000000000000000000000000000",F=A.__private__.getFileId=function(){return M},R=A.__private__.setFileId=function(e){return M=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():M.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==u&&(yt=new sle(u.userPermissions,u.userPassword,u.ownerPassword,M)),M};A.setFileId=function(e){return R(e),this},A.getFileId=function(){return F()};var L=A.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),n=t<0?"+":"-",r=Math.floor(Math.abs(t/60)),a=Math.abs(t%60),i=[n,z(r),"'",z(a),"'"].join("");return["D:",e.getFullYear(),z(e.getMonth()+1),z(e.getDate()),z(e.getHours()),z(e.getMinutes()),z(e.getSeconds()),i].join("")},U=A.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),n=parseInt(e.substr(6,2),10)-1,r=parseInt(e.substr(8,2),10),a=parseInt(e.substr(10,2),10),i=parseInt(e.substr(12,2),10),s=parseInt(e.substr(14,2),10);return new Date(t,n,r,a,i,s,0)},P=A.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=L(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return T=t},D=A.__private__.getCreationDate=function(e){var t=T;return"jsDate"===e&&(t=U(T)),t};A.setCreationDate=function(e){return P(e),this},A.getCreationDate=function(e){return D(e)};var O,z=A.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},H=A.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},j=0,Q=[],V=[],W=0,G=[],K=[],q=!1,X=V;A.__private__.setCustomOutputDestination=function(e){q=!0,X=e};var Y=function(e){q||(X=e)};A.__private__.resetCustomOutputDestination=function(){q=!1,X=V};var J=A.__private__.out=function(e){return e=e.toString(),W+=e.length+1,X.push(e),X},Z=A.__private__.write=function(e){return J(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},$=A.__private__.getArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);t--;)r[t]=e.charCodeAt(t);return n},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];A.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;A.__private__.setFontSize=A.setFontSize=function(e){return te=b===v?e/de:e,this};var ne,re=A.__private__.getFontSize=A.getFontSize=function(){return b===y?te:te*de},ae=e.R2L||!1;A.__private__.setR2L=A.setR2L=function(e){return ae=e,this},A.__private__.getR2L=A.getR2L=function(){return ae};var ie,se=A.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ne=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ne=e}else ne=parseInt(e,10)};A.__private__.getZoomMode=function(){return ne};var oe,le=A.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');ie=e};A.__private__.getPageMode=function(){return ie};var ce=A.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');oe=e};A.__private__.getLayoutMode=function(){return oe},A.__private__.setDisplayMode=A.setDisplayMode=function(e,t,n){return se(e),ce(t),le(n),this};var ue={title:"",subject:"",author:"",keywords:"",creator:""};A.__private__.getDocumentProperty=function(e){if(-1===Object.keys(ue).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ue[e]},A.__private__.getDocumentProperties=function(){return ue},A.__private__.setDocumentProperties=A.setProperties=A.setDocumentProperties=function(e){for(var t in ue)ue.hasOwnProperty(t)&&e[t]&&(ue[t]=e[t]);return this},A.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(ue).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ue[e]=t};var he,de,Ae,pe,fe,me={},ge={},ye=[],ve={},be={},xe={},we={},_e=null,Se=0,Ce=[],Ee=new lle(A),Ne=e.hotfixes||[],Be={},ke={},Ie=[],Te=function e(t,n,r,a,i,s){if(!(this instanceof e))return new e(t,n,r,a,i,s);isNaN(t)&&(t=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(a)&&(a=1),isNaN(i)&&(i=0),isNaN(s)&&(s=0),this._matrix=[t,n,r,a,i,s]};Object.defineProperty(Te.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Te.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Te.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Te.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Te.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Te.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Te.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Te.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Te.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Te.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Te.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Te.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Te.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Te.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Te.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Te.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Te.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(e)},Te.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,n=e.sx*this.shy+e.shy*this.sy,r=e.shx*this.sx+e.sy*this.shx,a=e.shx*this.shy+e.sy*this.sy,i=e.tx*this.sx+e.ty*this.shx+this.tx,s=e.tx*this.shy+e.ty*this.sy+this.ty;return new Te(t,n,r,a,i,s)},Te.prototype.decompose=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty,s=Math.sqrt(e*e+t*t),o=(e/=s)*n+(t/=s)*r;n-=e*o,r-=t*o;var l=Math.sqrt(n*n+r*r);return o/=l,e*(r/=l)<t*(n/=l)&&(e=-e,t=-t,o=-o,s=-s),{scale:new Te(s,0,0,l,0,0),translate:new Te(1,0,0,1,a,i),rotate:new Te(e,t,-t,e,0,0),skew:new Te(1,0,o,1,0,0)}},Te.prototype.toString=function(e){return this.join(" ")},Te.prototype.inversed=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty,s=1/(e*r-t*n),o=r*s,l=-t*s,c=-n*s,u=e*s;return new Te(o,l,c,u,-o*a-c*i,-l*a-u*i)},Te.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,n=e.x*this.shy+e.y*this.sy+this.ty;return new tn(t,n)},Te.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),n=this.applyToPoint(new tn(e.x+e.w,e.y+e.h));return new nn(t.x,t.y,n.x-t.x,n.y-t.y)},Te.prototype.clone=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,a=this.tx,i=this.ty;return new Te(e,t,n,r,a,i)},A.Matrix=Te;var Me=A.matrixMult=function(e,t){return t.multiply(e)},Fe=new Te(1,0,0,1,0,0);A.unitMatrix=A.identityMatrix=Fe;var Re=function(e,t){if(!be[e]){var n=(t instanceof hle?"Sh":"P")+(Object.keys(ve).length+1).toString(10);t.id=n,be[e]=n,ve[n]=t,Ee.publish("addPattern",t)}};A.ShadingPattern=hle,A.TilingPattern=dle,A.addShadingPattern=function(e,t){return C("addShadingPattern()"),Re(e,t),this},A.beginTilingPattern=function(e){C("beginTilingPattern()"),an(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},A.endTilingPattern=function(e,t){C("endTilingPattern()"),t.stream=K[O].join("\n"),Re(e,t),Ee.publish("endTilingPattern",t),Ie.pop().restore()};var Le,Ue=A.__private__.newObject=function(){var e=Pe();return De(e,!0),e},Pe=A.__private__.newObjectDeferred=function(){return j++,Q[j]=function(){return W},j},De=function(e,t){return t="boolean"==typeof t&&t,Q[e]=W,t&&J(e+" 0 obj"),e},Oe=A.__private__.newAdditionalObject=function(){var e={objId:Pe(),content:""};return G.push(e),e},ze=Pe(),He=Pe(),je=A.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var n=parseFloat(t[0]);t=[n,n,n,"r"]}for(var r="#",a=0;a<3;a++)r+=("0"+Math.floor(255*parseFloat(t[a])).toString(16)).slice(-2);return r},Qe=A.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var n=e.ch1,r=e.ch2,a=e.ch3,i=e.ch4,s="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var o=new Hoe(n);if(o.ok)n=o.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,r=l>>8&255,a=255&l}if(void 0===r||void 0===i&&n===r&&r===a)t="string"==typeof n?n+" "+s[0]:2===e.precision?N(n/255)+" "+s[0]:B(n/255)+" "+s[0];else if(void 0===i||"object"===(0,bne.A)(i)){if(i&&!isNaN(i.a)&&0===i.a)return["1.","1.","1.",s[1]].join(" ");t="string"==typeof n?[n,r,a,s[1]].join(" "):2===e.precision?[N(n/255),N(r/255),N(a/255),s[1]].join(" "):[B(n/255),B(r/255),B(a/255),s[1]].join(" ")}else t="string"==typeof n?[n,r,a,i,s[2]].join(" "):2===e.precision?[N(n),N(r),N(a),N(i),s[2]].join(" "):[B(n),B(r),B(a),B(i),s[2]].join(" ");return t},Ve=A.__private__.getFilters=function(){return s},We=A.__private__.putStream=function(e){var t=(e=e||{}).data||"",n=e.filters||Ve(),r=e.alreadyAppliedFilters||[],a=e.addLength1||!1,i=t.length,s=e.objectId,o=function(e){return e};if(null!==u&&void 0===s)throw new Error("ObjectId must be passed to putStream for file encryption");null!==u&&(o=yt.encryptor(s,0));var l={};!0===n&&(n=["FlateEncode"]);var c=e.additionalKeyValues||[],h=(l=void 0!==Ale.API.processDataByFilters?Ale.API.processDataByFilters(t,n):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===a&&c.push({key:"Length1",value:i})),0!=h.length)if(h.split("/").length-1==1)c.push({key:"Filter",value:h});else{c.push({key:"Filter",value:"["+h+"]"});for(var d=0;d<c.length;d+=1)if("DecodeParms"===c[d].key){for(var A=[],p=0;p<l.reverseChain.split("/").length-1;p+=1)A.push("null");A.push(c[d].value),c[d].value="["+A.join(" ")+"]"}}J("<<");for(var f=0;f<c.length;f++)J("/"+c[f].key+" "+c[f].value);J(">>"),0!==l.data.length&&(J("stream"),J(o(l.data)),J("endstream"))},Ge=A.__private__.putPage=function(e){var t=e.number,n=e.data,r=e.objId,a=e.contentsObjId;De(r,!0),J("<</Type /Page"),J("/Parent "+e.rootDictionaryObjId+" 0 R"),J("/Resources "+e.resourceDictionaryObjId+" 0 R"),J("/MediaBox ["+parseFloat(S(e.mediaBox.bottomLeftX))+" "+parseFloat(S(e.mediaBox.bottomLeftY))+" "+S(e.mediaBox.topRightX)+" "+S(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&J("/CropBox ["+S(e.cropBox.bottomLeftX)+" "+S(e.cropBox.bottomLeftY)+" "+S(e.cropBox.topRightX)+" "+S(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&J("/BleedBox ["+S(e.bleedBox.bottomLeftX)+" "+S(e.bleedBox.bottomLeftY)+" "+S(e.bleedBox.topRightX)+" "+S(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&J("/TrimBox ["+S(e.trimBox.bottomLeftX)+" "+S(e.trimBox.bottomLeftY)+" "+S(e.trimBox.topRightX)+" "+S(e.trimBox.topRightY)+"]"),null!==e.artBox&&J("/ArtBox ["+S(e.artBox.bottomLeftX)+" "+S(e.artBox.bottomLeftY)+" "+S(e.artBox.topRightX)+" "+S(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&J("/UserUnit "+e.userUnit),Ee.publish("putPage",{objId:r,pageContext:Ce[t],pageNumber:t,page:n}),J("/Contents "+a+" 0 R"),J(">>"),J("endobj");var i=n.join("\n");return b===v&&(i+="\nQ"),De(a,!0),We({data:i,filters:Ve(),objectId:a}),J("endobj"),r},Ke=A.__private__.putPages=function(){var e,t,n=[];for(e=1;e<=Se;e++)Ce[e].objId=Pe(),Ce[e].contentsObjId=Pe();for(e=1;e<=Se;e++)n.push(Ge({number:e,data:K[e],objId:Ce[e].objId,contentsObjId:Ce[e].contentsObjId,mediaBox:Ce[e].mediaBox,cropBox:Ce[e].cropBox,bleedBox:Ce[e].bleedBox,trimBox:Ce[e].trimBox,artBox:Ce[e].artBox,userUnit:Ce[e].userUnit,rootDictionaryObjId:ze,resourceDictionaryObjId:He}));De(ze,!0),J("<</Type /Pages");var r="/Kids [";for(t=0;t<Se;t++)r+=n[t]+" 0 R ";J(r+"]"),J("/Count "+Se),J(">>"),J("endobj"),Ee.publish("postPutPages")},qe=function(e){Ee.publish("putFont",{font:e,out:J,newObject:Ue,putStream:We}),!0!==e.isAlreadyPutted&&(e.objectNumber=Ue(),J("<<"),J("/Type /Font"),J("/BaseFont /"+ole(e.postScriptName)),J("/Subtype /Type1"),"string"==typeof e.encoding&&J("/Encoding /"+e.encoding),J("/FirstChar 32"),J("/LastChar 255"),J(">>"),J("endobj"))},Xe=function(e){e.objectNumber=Ue();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[S(e.x),S(e.y),S(e.x+e.width),S(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var n=e.pages[1].join("\n");We({data:n,additionalKeyValues:t,objectId:e.objectNumber}),J("endobj")},Ye=function(e,t){t||(t=21);var n=Ue(),r=function(e,t){var n,r=[],a=1/(t-1);for(n=0;n<1;n+=a)r.push(n);if(r.push(1),0!=e[0].offset){var i={offset:0,color:e[0].color};e.unshift(i)}if(1!=e[e.length-1].offset){var s={offset:1,color:e[e.length-1].color};e.push(s)}for(var o="",l=0,c=0;c<r.length;c++){for(n=r[c];n>e[l+1].offset;)l++;var u=e[l].offset,h=(n-u)/(e[l+1].offset-u),d=e[l].color,A=e[l+1].color;o+=H(Math.round((1-h)*d[0]+h*A[0]).toString(16))+H(Math.round((1-h)*d[1]+h*A[1]).toString(16))+H(Math.round((1-h)*d[2]+h*A[2]).toString(16))}return o.trim()}(e.colors,t),a=[];a.push({key:"FunctionType",value:"0"}),a.push({key:"Domain",value:"[0.0 1.0]"}),a.push({key:"Size",value:"["+t+"]"}),a.push({key:"BitsPerSample",value:"8"}),a.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),a.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),We({data:r,additionalKeyValues:a,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),J("endobj"),e.objectNumber=Ue(),J("<< /ShadingType "+e.type),J("/ColorSpace /DeviceRGB");var i="/Coords ["+S(parseFloat(e.coords[0]))+" "+S(parseFloat(e.coords[1]))+" ";2===e.type?i+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3])):i+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3]))+" "+S(parseFloat(e.coords[4]))+" "+S(parseFloat(e.coords[5])),J(i+="]"),e.matrix&&J("/Matrix ["+e.matrix.toString()+"]"),J("/Function "+n+" 0 R"),J("/Extend [true true]"),J(">>"),J("endobj")},Je=function(e,t){var n=Pe(),r=Ue();t.push({resourcesOid:n,objectOid:r}),e.objectNumber=r;var a=[];a.push({key:"Type",value:"/Pattern"}),a.push({key:"PatternType",value:"1"}),a.push({key:"PaintType",value:"1"}),a.push({key:"TilingType",value:"1"}),a.push({key:"BBox",value:"["+e.boundingBox.map(S).join(" ")+"]"}),a.push({key:"XStep",value:S(e.xStep)}),a.push({key:"YStep",value:S(e.yStep)}),a.push({key:"Resources",value:n+" 0 R"}),e.matrix&&a.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),We({data:e.stream,additionalKeyValues:a,objectId:e.objectNumber}),J("endobj")},Ze=function(e){for(var t in e.objectNumber=Ue(),J("<<"),e)switch(t){case"opacity":J("/ca "+N(e[t]));break;case"stroke-opacity":J("/CA "+N(e[t]))}J(">>"),J("endobj")},$e=function(e){De(e.resourcesOid,!0),J("<<"),J("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in J("/Font <<"),me)me.hasOwnProperty(e)&&(!1===h||!0===h&&d.hasOwnProperty(e))&&J("/"+e+" "+me[e].objectNumber+" 0 R");J(">>")}(),function(){if(Object.keys(ve).length>0){for(var e in J("/Shading <<"),ve)ve.hasOwnProperty(e)&&ve[e]instanceof hle&&ve[e].objectNumber>=0&&J("/"+e+" "+ve[e].objectNumber+" 0 R");Ee.publish("putShadingPatternDict"),J(">>")}}(),function(e){if(Object.keys(ve).length>0){for(var t in J("/Pattern <<"),ve)ve.hasOwnProperty(t)&&ve[t]instanceof A.TilingPattern&&ve[t].objectNumber>=0&&ve[t].objectNumber<e&&J("/"+t+" "+ve[t].objectNumber+" 0 R");Ee.publish("putTilingPatternDict"),J(">>")}}(e.objectOid),function(){if(Object.keys(xe).length>0){var e;for(e in J("/ExtGState <<"),xe)xe.hasOwnProperty(e)&&xe[e].objectNumber>=0&&J("/"+e+" "+xe[e].objectNumber+" 0 R");Ee.publish("putGStateDict"),J(">>")}}(),function(){for(var e in J("/XObject <<"),Be)Be.hasOwnProperty(e)&&Be[e].objectNumber>=0&&J("/"+e+" "+Be[e].objectNumber+" 0 R");Ee.publish("putXobjectDict"),J(">>")}(),J(">>"),J("endobj")},et=function(e){ge[e.fontName]=ge[e.fontName]||{},ge[e.fontName][e.fontStyle]=e.id},tt=function(e,t,n,r,a){var i={id:"F"+(Object.keys(me).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:n,encoding:r,isStandardFont:a||!1,metadata:{}};return Ee.publish("addFont",{font:i,instance:this}),me[i.id]=i,et(i),i.id},nt=A.__private__.pdfEscape=A.pdfEscape=function(e,t){return function(e,t){var n,r,a,i,s,o,l,c,u;if(a=(t=t||{}).sourceEncoding||"Unicode",s=t.outputEncoding,(t.autoencode||s)&&me[he].metadata&&me[he].metadata[a]&&me[he].metadata[a].encoding&&(i=me[he].metadata[a].encoding,!s&&me[he].encoding&&(s=me[he].encoding),!s&&i.codePages&&(s=i.codePages[0]),"string"==typeof s&&(s=i[s]),s)){for(l=!1,o=[],n=0,r=e.length;n<r;n++)(c=s[e.charCodeAt(n)])?o.push(String.fromCharCode(c)):o.push(e[n]),o[n].charCodeAt(0)>>8&&(l=!0);e=o.join("")}for(n=e.length;void 0===l&&0!==n;)e.charCodeAt(n-1)>>8&&(l=!0),n--;if(!l)return e;for(o=t.noBOM?[]:[254,255],n=0,r=e.length;n<r;n++){if((u=(c=e.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(u),o.push(c-(u<<8))}return String.fromCharCode.apply(void 0,o)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rt=A.__private__.beginPage=function(e){K[++Se]=[],Ce[Se]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},st(Se),Y(K[O])},at=function(e,t){var r,i,s;switch(n=t||n,"string"==typeof e&&(r=g(e.toLowerCase()),Array.isArray(r)&&(i=r[0],s=r[1])),Array.isArray(e)&&(i=e[0]*de,s=e[1]*de),isNaN(i)&&(i=a[0],s=a[1]),(i>14400||s>14400)&&(Uoe.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),i=Math.min(14400,i),s=Math.min(14400,s)),a=[i,s],n.substr(0,1)){case"l":s>i&&(a=[s,i]);break;case"p":i>s&&(a=[s,i])}rt(a),Dt(Ut),J(Gt),0!==Zt&&J(Zt+" J"),0!==$t&&J($t+" j"),Ee.publish("addPage",{pageNumber:Se})},it=function(e){e>0&&e<=Se&&(K.splice(e,1),Ce.splice(e,1),Se--,O>Se&&(O=Se),this.setPage(O))},st=function(e){e>0&&e<=Se&&(O=e)},ot=A.__private__.getNumberOfPages=A.getNumberOfPages=function(){return K.length-1},lt=function(e,t,n){var r,a=void 0;return n=n||{},e=void 0!==e?e:me[he].fontName,t=void 0!==t?t:me[he].fontStyle,r=e.toLowerCase(),void 0!==ge[r]&&void 0!==ge[r][t]?a=ge[r][t]:void 0!==ge[e]&&void 0!==ge[e][t]?a=ge[e][t]:!1===n.disableWarning&&Uoe.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),a||n.noFallback||null==(a=ge.times[t])&&(a=ge.times.normal),a},ct=A.__private__.putInfo=function(){var e=Ue(),t=function(e){return e};for(var n in null!==u&&(t=yt.encryptor(e,0)),J("<<"),J("/Producer ("+nt(t("jsPDF "+Ale.version))+")"),ue)ue.hasOwnProperty(n)&&ue[n]&&J("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+nt(t(ue[n]))+")");J("/CreationDate ("+nt(t(T))+")"),J(">>"),J("endobj")},ut=A.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||ze;switch(Ue(),J("<<"),J("/Type /Catalog"),J("/Pages "+t+" 0 R"),ne||(ne="fullwidth"),ne){case"fullwidth":J("/OpenAction [3 0 R /FitH null]");break;case"fullheight":J("/OpenAction [3 0 R /FitV null]");break;case"fullpage":J("/OpenAction [3 0 R /Fit]");break;case"original":J("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+ne;"%"===n.substr(n.length-1)&&(ne=parseInt(ne)/100),"number"==typeof ne&&J("/OpenAction [3 0 R /XYZ null null "+N(ne)+"]")}switch(oe||(oe="continuous"),oe){case"continuous":J("/PageLayout /OneColumn");break;case"single":J("/PageLayout /SinglePage");break;case"two":case"twoleft":J("/PageLayout /TwoColumnLeft");break;case"tworight":J("/PageLayout /TwoColumnRight")}ie&&J("/PageMode /"+ie),Ee.publish("putCatalog"),J(">>"),J("endobj")},ht=A.__private__.putTrailer=function(){J("trailer"),J("<<"),J("/Size "+(j+1)),J("/Root "+j+" 0 R"),J("/Info "+(j-1)+" 0 R"),null!==u&&J("/Encrypt "+yt.oid+" 0 R"),J("/ID [ <"+M+"> <"+M+"> ]"),J(">>")},dt=A.__private__.putHeader=function(){J("%PDF-"+p),J("%\xba\xdf\xac\xe0")},At=A.__private__.putXRef=function(){var e="0000000000";J("xref"),J("0 "+(j+1)),J("0000000000 65535 f ");for(var t=1;t<=j;t++)"function"==typeof Q[t]?J((e+Q[t]()).slice(-10)+" 00000 n "):void 0!==Q[t]?J((e+Q[t]).slice(-10)+" 00000 n "):J("0000000000 00000 n ")},pt=A.__private__.buildDocument=function(){var e;j=0,W=0,V=[],Q=[],G=[],ze=Pe(),He=Pe(),Y(V),Ee.publish("buildDocument"),dt(),Ke(),function(){Ee.publish("putAdditionalObjects");for(var e=0;e<G.length;e++){var t=G[e];De(t.objId,!0),J(t.content),J("endobj")}Ee.publish("postPutAdditionalObjects")}(),e=[],function(){for(var e in me)me.hasOwnProperty(e)&&(!1===h||!0===h&&d.hasOwnProperty(e))&&qe(me[e])}(),function(){var e;for(e in xe)xe.hasOwnProperty(e)&&Ze(xe[e])}(),function(){for(var e in Be)Be.hasOwnProperty(e)&&Xe(Be[e])}(),function(e){var t;for(t in ve)ve.hasOwnProperty(t)&&(ve[t]instanceof hle?Ye(ve[t]):ve[t]instanceof dle&&Je(ve[t],e))}(e),Ee.publish("putResources"),e.forEach($e),$e({resourcesOid:He,objectOid:Number.MAX_SAFE_INTEGER}),Ee.publish("postPutResources"),null!==u&&(yt.oid=Ue(),J("<<"),J("/Filter /Standard"),J("/V "+yt.v),J("/R "+yt.r),J("/U <"+yt.toHexString(yt.U)+">"),J("/O <"+yt.toHexString(yt.O)+">"),J("/P "+yt.P),J(">>"),J("endobj")),ct(),ut();var t=W;return At(),ht(),J("startxref"),J(""+t),J("%%EOF"),Y(K[O]),V.join("\n")},ft=A.__private__.getBlob=function(e){return new Blob([$(e)],{type:"application/pdf"})},mt=A.output=A.__private__.output=(Le=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return pt();case"save":A.save(t.filename);break;case"arraybuffer":return $(pt());case"blob":return ft(pt());case"bloburi":case"bloburl":if(void 0!==Roe.URL&&"function"==typeof Roe.URL.createObjectURL)return Roe.URL&&Roe.URL.createObjectURL(ft(pt()))||void 0;Uoe.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=pt();try{n=Qoe(r)}catch(u){n=Qoe(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+t.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(Roe)){var a="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",i=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(a=t.pdfObjectUrl,i="");var s='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+a+'"'+i+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",o=Roe.open();return null!==o&&o.document.write(s),o}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(Roe)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',c=Roe.open();if(null!==c){c.document.write(l);var h=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=t.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(h.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(Roe))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var d='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',p=Roe.open();if(null!==p&&(p.document.write(d),p.document.title=t.filename),p||"undefined"==typeof safari)return p;break;case"datauri":case"dataurl":return Roe.document.location.href=this.output("datauristring",t);default:return null}},Le.foo=function(){try{return Le.apply(this,arguments)}catch(t){var e=t.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var n="Error in function "+e.split("\n")[0].split("<")[0]+": "+t.message;if(!Roe.console)throw new Error(n);Roe.console.error(n,t),Roe.alert&&alert(n)}},Le.foo.bar=Le,Le.foo),gt=function(e){return!0===Array.isArray(Ne)&&Ne.indexOf(e)>-1};switch(r){case"pt":de=1;break;case"mm":de=72/25.4;break;case"cm":de=72/2.54;break;case"in":de=72;break;case"px":de=1==gt("px_scaling")?.75:96/72;break;case"pc":case"em":de=12;break;case"ex":de=6;break;default:if("number"!=typeof r)throw new Error("Invalid unit: "+r);de=r}var yt=null;P(),R();var vt=A.__private__.getPageInfo=A.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ce[e].objId,pageNumber:e,pageContext:Ce[e]}},bt=A.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in Ce)if(Ce[t].objId===e)break;return vt(t)},xt=A.__private__.getCurrentPageInfo=A.getCurrentPageInfo=function(){return{objId:Ce[O].objId,pageNumber:O,pageContext:Ce[O]}};A.addPage=function(){return at.apply(this,arguments),this},A.setPage=function(){return st.apply(this,arguments),Y.call(this,K[O]),this},A.insertPage=function(e){return this.addPage(),this.movePage(O,e),this},A.movePage=function(e,t){var n,r;if(e>t){n=K[e],r=Ce[e];for(var a=e;a>t;a--)K[a]=K[a-1],Ce[a]=Ce[a-1];K[t]=n,Ce[t]=r,this.setPage(t)}else if(e<t){n=K[e],r=Ce[e];for(var i=e;i<t;i++)K[i]=K[i+1],Ce[i]=Ce[i+1];K[t]=n,Ce[t]=r,this.setPage(t)}return this},A.deletePage=function(){return it.apply(this,arguments),this},A.__private__.text=A.text=function(e,t,n,r,a){var i,s,o,l,c,u,h,A,p,f=(r=r||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof n||Array.isArray(n))){var m=n;n=t,t=e,e=m}if(arguments[3]instanceof Te==0?(o=arguments[4],l=arguments[5],"object"===(0,bne.A)(h=arguments[3])&&null!==h||("string"==typeof o&&(l=o,o=null),"string"==typeof h&&(l=h,h=null),"number"==typeof h&&(o=h,h=null),r={flags:h,angle:o,align:l})):(C("The transform parameter of text() with a Matrix value"),p=a),isNaN(t)||isNaN(n)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return f;var g,y="",x="number"==typeof r.lineHeightFactor?r.lineHeightFactor:Lt,w=f.internal.scaleFactor;function _(e){return e=e.split("\t").join(Array(r.TabLen||9).join(" ")),nt(e,h)}function E(e){for(var t,n=e.concat(),r=[],a=n.length;a--;)"string"==typeof(t=n.shift())?r.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?r.push(t[0]):r.push([t[0],t[1],t[2]]);return r}function N(e,t){var n;if("string"==typeof e)n=t(e)[0];else if(Array.isArray(e)){for(var r,a,i=e.concat(),s=[],o=i.length;o--;)"string"==typeof(r=i.shift())?s.push(t(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(a=t(r[0],r[1],r[2]),s.push([a[0],a[1],a[2]]));n=s}return n}var B=!1,I=!0;if("string"==typeof e)B=!0;else if(Array.isArray(e)){var T=e.concat();s=[];for(var M,F=T.length;F--;)("string"!=typeof(M=T.shift())||Array.isArray(M)&&"string"!=typeof M[0])&&(I=!1);B=I}if(!1===B)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var R=te/f.internal.scaleFactor,L=R*(x-1);switch(r.baseline){case"bottom":n-=L;break;case"top":n+=R-L;break;case"hanging":n+=R-2*L;break;case"middle":n+=R/2-L}if((u=r.maxWidth||0)>0&&("string"==typeof e?e=f.splitTextToSize(e,u):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(f.splitTextToSize(t,u))},[]))),i={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:he,fonts:me,activeFontSize:te}},Ee.publish("preProcessText",i),e=i.text,o=(r=i.options).angle,p instanceof Te==0&&o&&"number"==typeof o){o*=Math.PI/180,0===r.rotationDirection&&(o=-o),b===v&&(o=-o);var U=Math.cos(o),P=Math.sin(o);p=new Te(U,P,-P,U,0,0)}else o&&o instanceof Te&&(p=o);b!==v||p||(p=Fe),void 0!==(c=r.charSpace||Yt)&&(y+=S(k(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(A=r.horizontalScale)&&(y+=S(100*A)+" Tz\n"),r.lang;var D=-1,O=void 0!==r.renderingMode?r.renderingMode:r.stroke,z=f.internal.getCurrentPageInfo().pageContext;switch(O){case 0:case!1:case"fill":D=0;break;case 1:case!0:case"stroke":D=1;break;case 2:case"fillThenStroke":D=2;break;case 3:case"invisible":D=3;break;case 4:case"fillAndAddForClipping":D=4;break;case 5:case"strokeAndAddPathForClipping":D=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":D=6;break;case 7:case"addToPathForClipping":D=7}var H=void 0!==z.usedRenderingMode?z.usedRenderingMode:-1;-1!==D?y+=D+" Tr\n":-1!==H&&(y+="0 Tr\n"),-1!==D&&(z.usedRenderingMode=D),l=r.align||"left";var j,Q=te*x,V=f.internal.pageSize.getWidth(),W=me[he];c=r.charSpace||Yt,u=r.maxWidth||0,h=Object.assign({autoencode:!0,noBOM:!0},r.flags);var G=[],K=function(e){return f.getStringUnitWidth(e,{font:W,charSpace:c,fontSize:te,doKerning:!1})*te/w};if("[object Array]"===Object.prototype.toString.call(e)){var q;s=E(e),"left"!==l&&(j=s.map(K));var X,Y=0;if("right"===l){t-=j[0],e=[],F=s.length;for(var Z=0;Z<F;Z++)0===Z?(X=jt(t),q=Qt(n)):(X=k(Y-j[Z]),q=-Q),e.push([s[Z],X,q]),Y=j[Z]}else if("center"===l){t-=j[0]/2,e=[],F=s.length;for(var $=0;$<F;$++)0===$?(X=jt(t),q=Qt(n)):(X=k((Y-j[$])/2),q=-Q),e.push([s[$],X,q]),Y=j[$]}else if("left"===l){e=[],F=s.length;for(var ee=0;ee<F;ee++)e.push(s[ee])}else if("justify"===l&&"Identity-H"===W.encoding){e=[],F=s.length,u=0!==u?u:V;for(var ne=0,re=0;re<F;re++)if(q=0===re?Qt(n):-Q,X=0===re?jt(t):ne,re<F-1){var ie=k((u-j[re])/(s[re].split(" ").length-1)),se=s[re].split(" ");e.push([se[0]+" ",X,q]),ne=0;for(var oe=1;oe<se.length;oe++){var le=(K(se[oe-1]+" "+se[oe])-K(se[oe]))*w+ie;oe==se.length-1?e.push([se[oe],le,0]):e.push([se[oe]+" ",le,0]),ne-=le}}else e.push([s[re],X,q]);e.push(["",ne,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],F=s.length,u=0!==u?u:V,re=0;re<F;re++){q=0===re?Qt(n):-Q,X=0===re?jt(t):0;var ce=s[re].split(" ").length-1,ue=ce>0?(u-j[re])/ce:0;re<F-1?G.push(S(k(ue))):G.push(0),e.push([s[re],X,q])}}}!0===("boolean"==typeof r.R2L?r.R2L:ae)&&(e=N(e,function(e,t,n){return[e.split("").reverse().join(""),t,n]})),i={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:he,fonts:me,activeFontSize:te}},Ee.publish("postProcessText",i),e=i.text,g=i.mutex.isHex||!1;var de=me[he].encoding;"WinAnsiEncoding"!==de&&"StandardEncoding"!==de||(e=N(e,function(e,t,n){return[_(e),t,n]})),s=E(e),e=[];for(var Ae,pe,fe,ge=Array.isArray(s[0])?1:0,ye="",ve=function(e,t,n){var a="";return n instanceof Te?(n="number"==typeof r.angle?Me(n,new Te(1,0,0,1,e,t)):Me(new Te(1,0,0,1,e,t),n),b===v&&(n=Me(new Te(1,0,0,-1,0,0),n)),a=n.join(" ")+" Tm\n"):a=S(e)+" "+S(t)+" Td\n",a},be=0;be<s.length;be++){switch(ye="",ge){case 1:fe=(g?"<":"(")+s[be][0]+(g?">":")"),Ae=parseFloat(s[be][1]),pe=parseFloat(s[be][2]);break;case 0:fe=(g?"<":"(")+s[be]+(g?">":")"),Ae=jt(t),pe=Qt(n)}void 0!==G&&void 0!==G[be]&&(ye=G[be]+" Tw\n"),0===be?e.push(ye+ve(Ae,pe,p)+fe):0===ge?e.push(ye+fe):1===ge&&e.push(ye+ve(Ae,pe,p)+fe)}e=0===ge?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var xe="BT\n/";return xe+=he+" "+te+" Tf\n",xe+=S(te*x)+" TL\n",xe+=qt+"\n",xe+=y,xe+=e,J(xe+="ET"),d[he]=!0,f};var wt=A.__private__.clip=A.clip=function(e){return J("evenodd"===e?"W*":"W"),this};A.clipEvenOdd=function(){return wt("evenodd")},A.__private__.discardPath=A.discardPath=function(){return J("n"),this};var _t=A.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};A.__private__.setDefaultPathOperation=A.setDefaultPathOperation=function(e){return _t(e)&&(c=e),this};var St=A.__private__.getStyle=A.getStyle=function(e){var t=c;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},Ct=A.close=function(){return J("h"),this};A.stroke=function(){return J("S"),this},A.fill=function(e){return Et("f",e),this},A.fillEvenOdd=function(e){return Et("f*",e),this},A.fillStroke=function(e){return Et("B",e),this},A.fillStrokeEvenOdd=function(e){return Et("B*",e),this};var Et=function(e,t){"object"===(0,bne.A)(t)?kt(t,e):J(e)},Nt=function(e){null===e||b===v&&void 0===e||(e=St(e),J(e))};function Bt(e,t,n,r,a){var i=new dle(t||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,a||this.matrix);i.stream=this.stream;var s=e+"$$"+this.cloneIndex+++"$$";return Re(s,i),i}var kt=function(e,t){var n=be[e.key],r=ve[n];if(r instanceof hle)J("q"),J(It(t)),r.gState&&A.setGState(r.gState),J(e.matrix.toString()+" cm"),J("/"+n+" sh"),J("Q");else if(r instanceof dle){var a=new Te(1,0,0,-1,0,An());e.matrix&&(a=a.multiply(e.matrix||Fe),n=Bt.call(r,e.key,e.boundingBox,e.xStep,e.yStep,a).id),J("q"),J("/Pattern cs"),J("/"+n+" scn"),r.gState&&A.setGState(r.gState),J(t),J("Q")}},It=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Tt=A.moveTo=function(e,t){return J(S(k(e))+" "+S(I(t))+" m"),this},Mt=A.lineTo=function(e,t){return J(S(k(e))+" "+S(I(t))+" l"),this},Ft=A.curveTo=function(e,t,n,r,a,i){return J([S(k(e)),S(I(t)),S(k(n)),S(I(r)),S(k(a)),S(I(i)),"c"].join(" ")),this};A.__private__.line=A.line=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(a))throw new Error("Invalid arguments passed to jsPDF.line");return b===y?this.lines([[n-e,r-t]],e,t,[1,1],a||"S"):this.lines([[n-e,r-t]],e,t,[1,1]).stroke()},A.__private__.lines=A.lines=function(e,t,n,r,a,i){var s,o,l,c,u,h,d,A,p,f,m,g;if("number"==typeof e&&(g=n,n=t,t=e,e=g),r=r||[1,1],i=i||!1,isNaN(t)||isNaN(n)||!Array.isArray(e)||!Array.isArray(r)||!_t(a)||"boolean"!=typeof i)throw new Error("Invalid arguments passed to jsPDF.lines");for(Tt(t,n),s=r[0],o=r[1],c=e.length,f=t,m=n,l=0;l<c;l++)2===(u=e[l]).length?(f=u[0]*s+f,m=u[1]*o+m,Mt(f,m)):(h=u[0]*s+f,d=u[1]*o+m,A=u[2]*s+f,p=u[3]*o+m,f=u[4]*s+f,m=u[5]*o+m,Ft(h,d,A,p,f,m));return i&&Ct(),Nt(a),this},A.path=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.c;switch(n.op){case"m":Tt(r[0],r[1]);break;case"l":Mt(r[0],r[1]);break;case"c":Ft.apply(this,r);break;case"h":Ct()}}return this},A.__private__.rect=A.rect=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(a))throw new Error("Invalid arguments passed to jsPDF.rect");return b===y&&(r=-r),J([S(k(e)),S(I(t)),S(k(n)),S(k(r)),"re"].join(" ")),Nt(a),this},A.__private__.triangle=A.triangle=function(e,t,n,r,a,i,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i)||!_t(s))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-e,r-t],[a-n,i-r],[e-a,t-i]],e,t,[1,1],s,!0),this},A.__private__.roundedRect=A.roundedRect=function(e,t,n,r,a,i,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i)||!_t(s))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return a=Math.min(a,.5*n),i=Math.min(i,.5*r),this.lines([[n-2*a,0],[a*o,0,a,i-i*o,a,i],[0,r-2*i],[0,i*o,-a*o,i,-a,i],[2*a-n,0],[-a*o,0,-a,-i*o,-a,-i],[0,2*i-r],[0,-i*o,a*o,-i,a,-i]],e+a,t,[1,1],s,!0),this},A.__private__.ellipse=A.ellipse=function(e,t,n,r,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(a))throw new Error("Invalid arguments passed to jsPDF.ellipse");var i=4/3*(Math.SQRT2-1)*n,s=4/3*(Math.SQRT2-1)*r;return Tt(e+n,t),Ft(e+n,t-s,e+i,t-r,e,t-r),Ft(e-i,t-r,e-n,t-s,e-n,t),Ft(e-n,t+s,e-i,t+r,e,t+r),Ft(e+i,t+r,e+n,t+s,e+n,t),Nt(a),this},A.__private__.circle=A.circle=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||!_t(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,n,n,r)},A.setFont=function(e,t,n){return n&&(t=_(t,n)),he=lt(e,t,{disableWarning:!1}),this};var Rt=A.__private__.getFont=A.getFont=function(){return me[lt.apply(A,arguments)]};A.__private__.getFontList=A.getFontList=function(){var e,t,n={};for(e in ge)if(ge.hasOwnProperty(e))for(t in n[e]=[],ge[e])ge[e].hasOwnProperty(t)&&n[e].push(t);return n},A.addFont=function(e,t,n,r,a){var i=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==i.indexOf(arguments[3])?a=arguments[3]:arguments[3]&&-1==i.indexOf(arguments[3])&&(n=_(n,r)),tt.call(this,e,t,n,a=a||"Identity-H")};var Lt,Ut=e.lineWidth||.200025,Pt=A.__private__.getLineWidth=A.getLineWidth=function(){return Ut},Dt=A.__private__.setLineWidth=A.setLineWidth=function(e){return Ut=e,J(S(k(e))+" w"),this};A.__private__.setLineDash=Ale.API.setLineDash=Ale.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return S(k(e))}).join(" "),t=S(k(t)),J("["+e+"] "+t+" d"),this};var Ot=A.__private__.getLineHeight=A.getLineHeight=function(){return te*Lt};A.__private__.getLineHeight=A.getLineHeight=function(){return te*Lt};var zt=A.__private__.setLineHeightFactor=A.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Lt=e),this},Ht=A.__private__.getLineHeightFactor=A.getLineHeightFactor=function(){return Lt};zt(e.lineHeight);var jt=A.__private__.getHorizontalCoordinate=function(e){return k(e)},Qt=A.__private__.getVerticalCoordinate=function(e){return b===v?e:Ce[O].mediaBox.topRightY-Ce[O].mediaBox.bottomLeftY-k(e)},Vt=A.__private__.getHorizontalCoordinateString=A.getHorizontalCoordinateString=function(e){return S(jt(e))},Wt=A.__private__.getVerticalCoordinateString=A.getVerticalCoordinateString=function(e){return S(Qt(e))},Gt=e.strokeColor||"0 G";A.__private__.getStrokeColor=A.getDrawColor=function(){return je(Gt)},A.__private__.setStrokeColor=A.setDrawColor=function(e,t,n,r){return Gt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),J(Gt),this};var Kt=e.fillColor||"0 g";A.__private__.getFillColor=A.getFillColor=function(){return je(Kt)},A.__private__.setFillColor=A.setFillColor=function(e,t,n,r){return Kt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),J(Kt),this};var qt=e.textColor||"0 g",Xt=A.__private__.getTextColor=A.getTextColor=function(){return je(qt)};A.__private__.setTextColor=A.setTextColor=function(e,t,n,r){return qt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var Yt=e.charSpace,Jt=A.__private__.getCharSpace=A.getCharSpace=function(){return parseFloat(Yt||0)};A.__private__.setCharSpace=A.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Yt=e,this};var Zt=0;A.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},A.__private__.setLineCap=A.setLineCap=function(e){var t=A.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Zt=t,J(t+" J"),this};var $t=0;A.__private__.setLineJoin=A.setLineJoin=function(e){var t=A.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $t=t,J(t+" j"),this},A.__private__.setLineMiterLimit=A.__private__.setMiterLimit=A.setLineMiterLimit=A.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return J(S(k(e))+" M"),this},A.GState=cle,A.setGState=function(e){(e="string"==typeof e?xe[we[e]]:en(null,e)).equals(_e)||(J("/"+e.id+" gs"),_e=e)};var en=function(e,t){if(!e||!we[e]){var n=!1;for(var r in xe)if(xe.hasOwnProperty(r)&&xe[r].equals(t)){n=!0;break}if(n)t=xe[r];else{var a="GS"+(Object.keys(xe).length+1).toString(10);xe[a]=t,t.id=a}return e&&(we[e]=t.id),Ee.publish("addGState",t),t}};A.addGState=function(e,t){return en(e,t),this},A.saveGraphicsState=function(){return J("q"),ye.push({key:he,size:te,color:qt}),this},A.restoreGraphicsState=function(){J("Q");var e=ye.pop();return he=e.key,te=e.size,qt=e.color,_e=null,this},A.setCurrentTransformationMatrix=function(e){return J(e.toString()+" cm"),this},A.comment=function(e){return J("#"+e),this};var tn=function(e,t){var n=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var r=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var a="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return a},set:function(e){a=e.toString()}}),this},nn=function(e,t,n,r){tn.call(this,e,t),this.type="rect";var a=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}});var i=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}}),this},rn=function(){this.page=Se,this.currentPage=O,this.pages=K.slice(0),this.pagesContext=Ce.slice(0),this.x=Ae,this.y=pe,this.matrix=fe,this.width=on(O),this.height=cn(O),this.outputDestination=X,this.id="",this.objectNumber=-1};rn.prototype.restore=function(){Se=this.page,O=this.currentPage,Ce=this.pagesContext,K=this.pages,Ae=this.x,pe=this.y,fe=this.matrix,ln(O,this.width),un(O,this.height),X=this.outputDestination};var an=function(e,t,n,r,a){Ie.push(new rn),Se=O=0,K=[],Ae=e,pe=t,fe=a,rt([n,r])};for(var sn in A.beginFormObject=function(e,t,n,r,a){return an(e,t,n,r,a),this},A.endFormObject=function(e){return function(e){if(ke[e])Ie.pop().restore();else{var t=new rn,n="Xo"+(Object.keys(Be).length+1).toString(10);t.id=n,ke[e]=n,Be[n]=t,Ee.publish("addFormObject",t),Ie.pop().restore()}}(e),this},A.doFormObject=function(e,t){var n=Be[ke[e]];return J("q"),J(t.toString()+" cm"),J("/"+n.id+" Do"),J("Q"),this},A.getFormObject=function(e){var t=Be[ke[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},A.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(zoe(ft(pt()),e),"function"==typeof zoe.unload&&Roe.setTimeout&&setTimeout(zoe.unload,911),this):new Promise(function(t,n){try{var a=zoe(ft(pt()),e);"function"==typeof zoe.unload&&Roe.setTimeout&&setTimeout(zoe.unload,911),t(a)}catch(r){n(r.message)}})},Ale.API)Ale.API.hasOwnProperty(sn)&&("events"===sn&&Ale.API.events.length?function(e,t){var n,r,a;for(a=t.length-1;-1!==a;a--)n=t[a][0],r=t[a][1],e.subscribe.apply(e,[n].concat("function"==typeof r?[r]:r))}(Ee,Ale.API.events):A[sn]=Ale.API[sn]);function on(e){return Ce[e].mediaBox.topRightX-Ce[e].mediaBox.bottomLeftX}function ln(e,t){Ce[e].mediaBox.topRightX=t+Ce[e].mediaBox.bottomLeftX}function cn(e){return Ce[e].mediaBox.topRightY-Ce[e].mediaBox.bottomLeftY}function un(e,t){Ce[e].mediaBox.topRightY=t+Ce[e].mediaBox.bottomLeftY}var hn=A.getPageWidth=function(e){return on(e=e||O)/de},dn=A.setPageWidth=function(e,t){ln(e,t*de)},An=A.getPageHeight=function(e){return cn(e=e||O)/de},pn=A.setPageHeight=function(e,t){un(e,t*de)};return A.internal={pdfEscape:nt,getStyle:St,getFont:Rt,getFontSize:re,getCharSpace:Jt,getTextColor:Xt,getLineHeight:Ot,getLineHeightFactor:Ht,getLineWidth:Pt,write:Z,getHorizontalCoordinate:jt,getVerticalCoordinate:Qt,getCoordinateString:Vt,getVerticalCoordinateString:Wt,collections:{},newObject:Ue,newAdditionalObject:Oe,newObjectDeferred:Pe,newObjectDeferredBegin:De,getFilters:Ve,putStream:We,events:Ee,scaleFactor:de,pageSize:{getWidth:function(){return hn(O)},setWidth:function(e){dn(O,e)},getHeight:function(){return An(O)},setHeight:function(e){pn(O,e)}},encryptionOptions:u,encryption:yt,getEncryptor:function(e){return null!==u?yt.encryptor(e,0):function(e){return e}},output:mt,getNumberOfPages:ot,pages:K,out:J,f2:N,f3:B,getPageInfo:vt,getPageInfoByObjId:bt,getCurrentPageInfo:xt,getPDFVersion:f,Point:tn,Rectangle:nn,Matrix:Te,hasHotfix:gt},Object.defineProperty(A.internal.pageSize,"width",{get:function(){return hn(O)},set:function(e){dn(O,e)},enumerable:!0,configurable:!0}),Object.defineProperty(A.internal.pageSize,"height",{get:function(){return An(O)},set:function(e){pn(O,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,n=ee.length;t<n;t++){var r=tt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===h&&(d[r]=!0);var a=e[t][0].split("-");et({id:r,fontName:a[0],fontStyle:a[1]||""})}Ee.publish("addFonts",{fonts:me,dictionary:ge})}.call(A,ee),he="F1",at(a,n),Ee.publish("initialized"),A}sle.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},sle.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},sle.prototype.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(String.fromCharCode(parseInt(e.substr(n,2),16)));return t.join("")},sle.prototype.processOwnerPassword=function(e,t){return ale(tle(t).substr(0,5),e)},sle.prototype.encryptor=function(e,t){var n=tle(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return ale(n,e)}},cle.prototype.equals=function(e){var t,n="id,objectNumber,equals";if(!e||(0,bne.A)(e)!==(0,bne.A)(this))return!1;var r=0;for(t in this)if(!(n.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;r++}for(t in e)e.hasOwnProperty(t)&&n.indexOf(t)<0&&r--;return 0===r},Ale.API={events:[]},Ale.version="3.0.3";var ple=Ale.API,fle=1,mle=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},gle=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},yle=function(e){return e.toFixed(2)},vle=function(e){return e.toFixed(5)};ple.__acroform__={};var ble=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},xle=function(e){return e*fle},wle=function(e){var t=new Dle,n=Zle.internal.getHeight(e)||0,r=Zle.internal.getWidth(e)||0;return t.BBox=[0,0,Number(yle(r)),Number(yle(n))],t},_le=ple.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},Sle=ple.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},Cle=ple.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},Ele=ple.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Cle(e,t-1)},Nle=ple.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return _le(e,t-1)},Ble=ple.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Sle(e,t-1)},kle=ple.__acroform__.calculateCoordinates=function(e,t){var n=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,a=e[0],i=e[1],s=e[2],o=e[3],l={};return l.lowerLeft_X=n(a)||0,l.lowerLeft_Y=r(i+o)||0,l.upperRight_X=n(a+s)||0,l.upperRight_Y=r(i)||0,[Number(yle(l.lowerLeft_X)),Number(yle(l.lowerLeft_Y)),Number(yle(l.upperRight_X)),Number(yle(l.upperRight_Y))]},Ile=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],n=e._V||e.DV,r=Tle(e,n),a=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+a+" "+yle(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var i=wle(e);return i.scope=e.scope,i.stream=t.join("\n"),i}},Tle=function(e,t){var n=0===e.fontSize?e.maxFontSize:e.fontSize,r={text:"",fontSize:""},a=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");a=e.multiline?a.map(function(e){return e.split("\n")}):a.map(function(e){return[e]});var i=n,s=Zle.internal.getHeight(e)||0;s=s<0?-s:s;var o=Zle.internal.getWidth(e)||0;o=o<0?-o:o;var l=function(t,n,r){if(t+1<a.length){var i=n+" "+a[t+1][0];return Mle(i,e,r).width<=o-4}return!1};i++;e:for(;i>0;){t="",i--;var c,u,h=Mle("3",e,i).height,d=e.multiline?s-i:(s-h)/2,A=d+=2,p=0,f=0,m=0;if(i<=0){t="(...) Tj\n",t+="% Width of Text: "+Mle(t,e,i=12).width+", FieldWidth:"+o+"\n";break}for(var g="",y=0,v=0;v<a.length;v++)if(a.hasOwnProperty(v)){var b=!1;if(1!==a[v].length&&m!==a[v].length-1){if((h+2)*(y+2)+2>s)continue e;g+=a[v][m],b=!0,f=v,v--}else{g=" "==(g+=a[v][m]+" ").substr(g.length-1)?g.substr(0,g.length-1):g;var x=parseInt(v),w=l(x,g,i),_=v>=a.length-1;if(w&&!_){g+=" ",m=0;continue}if(w||_){if(_)f=x;else if(e.multiline&&(h+2)*(y+2)+2>s)continue e}else{if(!e.multiline)continue e;if((h+2)*(y+2)+2>s)continue e;f=x}}for(var S="",C=p;C<=f;C++){var E=a[C];if(e.multiline){if(C===f){S+=E[m]+" ",m=(m+1)%E.length;continue}if(C===p){S+=E[E.length-1]+" ";continue}}S+=E[0]+" "}switch(S=" "==S.substr(S.length-1)?S.substr(0,S.length-1):S,u=Mle(S,e,i).width,e.textAlign){case"right":c=o-u-2;break;case"center":c=(o-u)/2;break;default:c=2}t+=yle(c)+" "+yle(A)+" Td\n",t+="("+mle(S)+") Tj\n",t+=-yle(c)+" 0 Td\n",A=-(i+2),u=0,p=b?f:f+1,y++,g=""}break}return r.text=t,r.fontSize=i,r},Mle=function(e,t,n){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),a=t.scope.getStringUnitWidth(e,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:a}},Fle={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Rle=function(e,t){var n={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===n.type&&e.object===n.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(n)},Lle=ple.__acroform__.arrayToPdfArray=function(e,t,n){var r=function(e){return e};if(Array.isArray(e)){for(var a="[",i=0;i<e.length;i++)switch(0!==i&&(a+=" "),(0,bne.A)(e[i])){case"boolean":case"number":case"object":a+=e[i].toString();break;case"string":"/"!==e[i].substr(0,1)?(void 0!==t&&n&&(r=n.internal.getEncryptor(t)),a+="("+mle(r(e[i].toString()))+")"):a+=e[i].toString()}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Ule=function(e,t,n){var r=function(e){return e};return void 0!==t&&n&&(r=n.internal.getEncryptor(t)),(e=e||"").toString(),"("+mle(r(e))+")"},Ple=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Ple.prototype.toString=function(){return this.objId+" 0 R"},Ple.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Ple.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var n in t)if(!1===Object.getOwnPropertyDescriptor(this,t[n]).configurable){var r=t[n],a=this[r];a&&(Array.isArray(a)?e.push({key:r,value:Lle(a,this.objId,this.scope)}):a instanceof Ple?(a.scope=this.scope,e.push({key:r,value:a.objId+" 0 R"})):"function"!=typeof a&&e.push({key:r,value:a}))}return e};var Dle=function(){Ple.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};ble(Dle,Ple);var Ole=function(){Ple.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+mle(t(e))+")"}},set:function(t){e=t}})};ble(Ole,Ple);var zle=function e(){Ple.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(t,3))},set:function(e){!0===Boolean(e)?this.F=Nle(t,3):this.F=Ble(t,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');n=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof qle)return;i="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+mle(t(i))+")"},set:function(e){i=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){s=e}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(e){l=e}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/fle:c},set:function(e){c=e}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){u=e}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof qle||this instanceof Yle))return Ule(h,this.objId,this.scope)},set:function(e){e=e.toString(),h=e}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof Wle==0?Ule(d,this.objId,this.scope):d},set:function(e){e=e.toString(),d=this instanceof Wle==0?"("===e.substr(0,1)?gle(e.substr(1,e.length-2)):gle(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Wle==1?gle(d.substr(1,d.length-1)):d},set:function(e){e=e.toString(),d=this instanceof Wle==1?"/"+e:e}});var A=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(A)return A},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(A)return this instanceof Wle==0?Ule(A,this.objId,this.scope):A},set:function(e){e=e.toString(),A=this instanceof Wle==0?"("===e.substr(0,1)?gle(e.substr(1,e.length-2)):gle(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Wle==1?gle(A.substr(1,A.length-1)):A},set:function(e){e=e.toString(),A=this instanceof Wle==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,f=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){e=Boolean(e),f=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(e){p=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,1):this.Ff=Ble(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,2):this.Ff=Ble(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,3):this.Ff=Ble(this.Ff,3)}});var m=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==m)return m},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');m=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(m){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:m=2;break;case"center":case 1:m=1;break;default:m=0}}})};ble(zle,Ple);var Hle=function(){zle.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Lle(t,this.objId,this.scope)},set:function(e){var n,r;r=[],"string"==typeof(n=e)&&(r=function(e,t,n){n||(n=1);for(var r,a=[];r=t.exec(e);)a.push(r[n]);return a}(n,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,18):this.Ff=Ble(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=Nle(this.Ff,19):this.Ff=Ble(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=Nle(this.Ff,20),t.sort()):this.Ff=Ble(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,22):this.Ff=Ble(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,23):this.Ff=Ble(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,27):this.Ff=Ble(this.Ff,27)}}),this.hasAppearanceStream=!1};ble(Hle,zle);var jle=function(){Hle.call(this),this.fontName="helvetica",this.combo=!1};ble(jle,Hle);var Qle=function(){jle.call(this),this.combo=!0};ble(Qle,jle);var Vle=function(){Qle.call(this),this.edit=!0};ble(Vle,Qle);var Wle=function(){zle.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,15):this.Ff=Ble(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,16):this.Ff=Ble(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,17):this.Ff=Ble(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,26):this.Ff=Ble(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var n,r=[];for(n in r.push("<<"),t)r.push("/"+n+" ("+mle(e(t[n]))+")");return r.push(">>"),r.join("\n")}},set:function(e){"object"===(0,bne.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};ble(Wle,zle);var Gle=function(){Wle.call(this),this.pushButton=!0};ble(Gle,Wle);var Kle=function(){Wle.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};ble(Kle,Wle);var qle=function(){var e,t;zle.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,n=[];for(t in n.push("<<"),r)n.push("/"+t+" ("+mle(e(r[t]))+")");return n.push(">>"),n.join("\n")},set:function(e){"object"===(0,bne.A)(e)&&(r=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(e){"string"==typeof e&&(r.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Zle.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ble(qle,zle),Kle.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var n=this.Kids[t];n.appearanceStreamContent=e.createAppearanceStream(n.optionName),n.caption=e.getCA()}},Kle.prototype.createOption=function(e){var t=new qle;return t.Parent=this,t.optionName=e,this.Kids.push(t),$le.call(this.scope,t),t};var Xle=function(){Wle.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Zle.CheckBox.createAppearanceStream()};ble(Xle,Wle);var Yle=function(){zle.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,13):this.Ff=Ble(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,21):this.Ff=Ble(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,23):this.Ff=Ble(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,24):this.Ff=Ble(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,25):this.Ff=Ble(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,26):this.Ff=Ble(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ble(Yle,zle);var Jle=function(){Yle.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ele(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=Nle(this.Ff,14):this.Ff=Ble(this.Ff,14)}}),this.password=!0};ble(Jle,Yle);var Zle={CheckBox:{createAppearanceStream:function(){return{N:{On:Zle.CheckBox.YesNormal},D:{On:Zle.CheckBox.YesPushDown,Off:Zle.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=[],r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,a=e.scope.__private__.encodeColorString(e.color),i=Tle(e,e.caption);return n.push("0.749023 g"),n.push("0 0 "+yle(Zle.internal.getWidth(e))+" "+yle(Zle.internal.getHeight(e))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+yle(i.fontSize)+" Tf "+a),n.push("BT"),n.push(i.text),n.push("ET"),n.push("Q"),n.push("EMC"),t.stream=n.join("\n"),t},YesNormal:function(e){var t=wle(e);t.scope=e.scope;var n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color),a=[],i=Zle.internal.getHeight(e),s=Zle.internal.getWidth(e),o=Tle(e,e.caption);return a.push("1 g"),a.push("0 0 "+yle(s)+" "+yle(i)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+yle(s-1)+" "+yle(i-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+n+" "+yle(o.fontSize)+" Tf "+r),a.push(o.text),a.push("ET"),a.push("Q"),t.stream=a.join("\n"),t},OffPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yle(Zle.internal.getWidth(e))+" "+yle(Zle.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:Zle.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=Zle.RadioButton.Circle.YesNormal,t.D[e]=Zle.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=wle(e);t.scope=e.scope;var n=[],r=Zle.internal.getWidth(e)<=Zle.internal.getHeight(e)?Zle.internal.getWidth(e)/4:Zle.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=Zle.internal.Bezier_C,i=Number((r*a).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+vle(Zle.internal.getWidth(e)/2)+" "+vle(Zle.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),n.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),n.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),n.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=[],r=Zle.internal.getWidth(e)<=Zle.internal.getHeight(e)?Zle.internal.getWidth(e)/4:Zle.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Zle.internal.Bezier_C).toFixed(5)),s=Number((r*Zle.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+vle(Zle.internal.getWidth(e)/2)+" "+vle(Zle.internal.getHeight(e)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+vle(Zle.internal.getWidth(e)/2)+" "+vle(Zle.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),n.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),n.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),n.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=[],r=Zle.internal.getWidth(e)<=Zle.internal.getHeight(e)?Zle.internal.getWidth(e)/4:Zle.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Zle.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+vle(Zle.internal.getWidth(e)/2)+" "+vle(Zle.internal.getHeight(e)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:Zle.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=Zle.RadioButton.Cross.YesNormal,t.D[e]=Zle.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=wle(e);t.scope=e.scope;var n=[],r=Zle.internal.calculateCross(e);return n.push("q"),n.push("1 1 "+yle(Zle.internal.getWidth(e)-2)+" "+yle(Zle.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(yle(r.x1.x)+" "+yle(r.x1.y)+" m"),n.push(yle(r.x2.x)+" "+yle(r.x2.y)+" l"),n.push(yle(r.x4.x)+" "+yle(r.x4.y)+" m"),n.push(yle(r.x3.x)+" "+yle(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=Zle.internal.calculateCross(e),r=[];return r.push("0.749023 g"),r.push("0 0 "+yle(Zle.internal.getWidth(e))+" "+yle(Zle.internal.getHeight(e))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+yle(Zle.internal.getWidth(e)-2)+" "+yle(Zle.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(yle(n.x1.x)+" "+yle(n.x1.y)+" m"),r.push(yle(n.x2.x)+" "+yle(n.x2.y)+" l"),r.push(yle(n.x4.x)+" "+yle(n.x4.y)+" m"),r.push(yle(n.x3.x)+" "+yle(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=wle(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yle(Zle.internal.getWidth(e))+" "+yle(Zle.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+n}};Zle.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=Zle.internal.getWidth(e),n=Zle.internal.getHeight(e),r=Math.min(t,n);return{x1:{x:(t-r)/2,y:(n-r)/2+r},x2:{x:(t-r)/2+r,y:(n-r)/2},x3:{x:(t-r)/2,y:(n-r)/2},x4:{x:(t-r)/2+r,y:(n-r)/2+r}}}},Zle.internal.getWidth=function(e){var t=0;return"object"===(0,bne.A)(e)&&(t=xle(e.Rect[2])),t},Zle.internal.getHeight=function(e){var t=0;return"object"===(0,bne.A)(e)&&(t=xle(e.Rect[3])),t};var $le=ple.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(zle.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Fle)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");fle=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new Ole,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.objId=void 0,r.hasAnnotation&&Rle(r,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var n=!e;for(var r in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(r)){var a=e[r],i=[],s=a.Rect;if(a.Rect&&(a.Rect=kle(a.Rect,t)),t.internal.newObjectDeferredBegin(a.objId,!0),a.DA=Zle.createDefaultAppearanceStream(a),"object"===(0,bne.A)(a)&&"function"==typeof a.getKeyValueListForStream&&(i=a.getKeyValueListForStream()),a.Rect=s,a.hasAppearanceStream&&!a.appearanceStreamContent){var o=Ile(a);i.push({key:"AP",value:"<</N "+o+">>"}),t.internal.acroformPlugin.xForms.push(o)}if(a.appearanceStreamContent){var l="";for(var c in a.appearanceStreamContent)if(a.appearanceStreamContent.hasOwnProperty(c)){var u=a.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var r in u)if(u.hasOwnProperty(r)){var h=u[r];"function"==typeof h&&(h=h.call(t,a)),l+="/"+r+" "+h+" ",t.internal.acroformPlugin.xForms.indexOf(h)>=0||t.internal.acroformPlugin.xForms.push(h)}}else"function"==typeof(h=u)&&(h=h.call(t,a)),l+="/"+r+" "+h,t.internal.acroformPlugin.xForms.indexOf(h)>=0||t.internal.acroformPlugin.xForms.push(h);l+=">>"}i.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:i,objectId:a.objId}),t.internal.out("endobj")}n&&function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=n,a=e[n];t.internal.newObjectDeferredBegin(a.objId,!0),"object"===(0,bne.A)(a)&&"function"==typeof a.putStream&&a.putStream(),delete e[r]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof zle))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};ple.AcroFormChoiceField=Hle,ple.AcroFormListBox=jle,ple.AcroFormComboBox=Qle,ple.AcroFormEditBox=Vle,ple.AcroFormButton=Wle,ple.AcroFormPushButton=Gle,ple.AcroFormRadioButton=Kle,ple.AcroFormCheckBox=Xle,ple.AcroFormTextField=Yle,ple.AcroFormPasswordField=Jle,ple.AcroFormAppearance=Zle,ple.AcroForm={ChoiceField:Hle,ListBox:jle,ComboBox:Qle,EditBox:Vle,Button:Wle,PushButton:Gle,RadioButton:Kle,CheckBox:Xle,TextField:Yle,PasswordField:Jle,Appearance:Zle},Ale.AcroForm={ChoiceField:Hle,ListBox:jle,ComboBox:Qle,EditBox:Vle,Button:Wle,PushButton:Gle,RadioButton:Kle,CheckBox:Xle,TextField:Yle,PasswordField:Jle,Appearance:Zle};Ale.AcroForm;function ece(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})}!function(e){var t="addImage_";e.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=e.__addimage__.getImageFileTypeByImageData=function(e,t){var a,i,s,o,l,c=n;if("RGBA"===(t=t||n)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(w(e))for(l in r)for(s=r[l],a=0;a<s.length;a+=1){for(o=!0,i=0;i<s[a].length;i+=1)if(void 0!==s[a][i]&&s[a][i]!==e[i]){o=!1;break}if(!0===o){c=l;break}}else for(l in r)for(s=r[l],a=0;a<s.length;a+=1){for(o=!0,i=0;i<s[a].length;i+=1)if(void 0!==s[a][i]&&s[a][i]!==e.charCodeAt(i)){o=!1;break}if(!0===o){c=l;break}}return c===n&&t!==n&&(c=t),c},i=function e(t){for(var n=this.internal.write,r=this.internal.putStream,a=(0,this.internal.getFilters)();-1!==a.indexOf("FlateEncode");)a.splice(a.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var i=[];if(i.push({key:"Type",value:"/XObject"}),i.push({key:"Subtype",value:"/Image"}),i.push({key:"Width",value:t.width}),i.push({key:"Height",value:t.height}),t.colorSpace===g.INDEXED?i.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(i.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===g.DEVICE_CMYK&&i.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),i.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&i.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)&&t.transparency.length>0){for(var s="",o=0,l=t.transparency.length;o<l;o++)s+=t.transparency[o]+" "+t.transparency[o]+" ";i.push({key:"Mask",value:"["+s+"]"})}void 0!==t.sMask&&i.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:i,alreadyAppliedFilters:c,objectId:t.objectId}),n("endobj"),"sMask"in t&&void 0!==t.sMask){var u,h=null!==(u=t.sMaskBitsPerComponent)&&void 0!==u?u:t.bitsPerComponent,d={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:h,data:t.sMask};"filter"in t&&(d.decodeParameters="/Predictor ".concat(t.predictor," /Colors 1 /BitsPerComponent ").concat(h," /Columns ").concat(t.width),d.filter=t.filter),e.call(this,d)}if(t.colorSpace===g.INDEXED){var A=this.internal.newObject();r({data:S(new Uint8Array(t.palette)),objectId:A}),n("endobj")}},s=function(){var e=this.internal.collections[t+"images"];for(var n in e)i.call(this,e[n])},o=function(){var e,n=this.internal.collections[t+"images"],r=this.internal.write;for(var a in n)r("/I"+(e=n[a]).index,e.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var e=this.internal.collections[t+"images"];return l.call(this),e},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},h=function(t){return"function"==typeof e["process"+t.toUpperCase()]},d=function(e){return"object"===(0,bne.A)(e)&&1===e.nodeType},A=function(t,n){if("IMG"===t.nodeName&&t.hasAttribute("src")){var r=""+t.getAttribute("src");if(0===r.indexOf("data:image/"))return joe(unescape(r).split("base64,").pop());var a=e.loadFile(r,!0);if(void 0!==a)return a}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var i;switch(n){case"PNG":i="image/png";break;case"WEBP":i="image/webp";break;default:i="image/jpeg"}return joe(t.toDataURL(i,1).split("base64,").pop())}},p=function(e){var n=this.internal.collections[t+"images"];if(n)for(var r in n)if(e===n[r].alias)return n[r]},f=function(e,t,n){return e||t||(e=-96,t=-96),e<0&&(e=-1*n.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*n.height*72/t/this.internal.scaleFactor),0===e&&(e=t*n.width/n.height),0===t&&(t=e*n.height/n.width),[e,t]},m=function(e,t,n,r,a,i){var s=f.call(this,n,r,a),o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,u=c.call(this);if(n=s[0],r=s[1],u[a.index]=a,i){i*=Math.PI/180;var h=Math.cos(i),d=Math.sin(i),A=function(e){return e.toFixed(4)},p=[A(h),A(d),A(-1*d),A(h),0,0,"cm"]}this.internal.write("q"),i?(this.internal.write([1,"0","0",1,o(e),l(t+r),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([o(n),"0","0",o(r),"0","0","cm"].join(" "))):this.internal.write([o(n),"0","0",o(r),o(e),l(t+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+a.index+" Do"),this.internal.write("Q")},g=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},v=e.__addimage__.sHashCode=function(e){var t,n,r=0;if("string"==typeof e)for(n=e.length,t=0;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;else if(w(e))for(n=e.byteLength/2,t=0;t<n;t++)r=(r<<5)-r+e[t],r|=0;return r},b=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},x=e.__addimage__.extractImageFromDataUrl=function(e){if(null==e)return null;if(!(e=e.trim()).startsWith("data:"))return null;var t=e.indexOf(",");return t<0?null:e.substring(0,t).trim().endsWith("base64")?e.substring(t+1):null};e.__addimage__.isArrayBuffer=function(e){return e instanceof ArrayBuffer};var w=e.__addimage__.isArrayBufferView=function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array},_=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n},S=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",n=w(e)?e:new Uint8Array(e),r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return t};e.addImage=function(){var e,t,r,a,i,s,o,c,u;if("number"==typeof arguments[1]?(t=n,r=arguments[1],a=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5],c=arguments[6],u=arguments[7]):(t=arguments[1],r=arguments[2],a=arguments[3],i=arguments[4],s=arguments[5],o=arguments[6],c=arguments[7],u=arguments[8]),"object"===(0,bne.A)(e=arguments[0])&&!d(e)&&"imageData"in e){var h=e;e=h.imageData,t=h.format||t||n,r=h.x||r||0,a=h.y||a||0,i=h.w||h.width||i,s=h.h||h.height||s,o=h.alias||o,c=h.compression||c,u=h.rotation||h.angle||u}var A=this.internal.getFilters();if(void 0===c&&-1!==A.indexOf("FlateEncode")&&(c="SLOW"),isNaN(r)||isNaN(a))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var p=C.call(this,e,t,o,c);return m.call(this,r,a,i,s,p,u),this};var C=function(t,r,i,s){var o,l,c;if("string"==typeof t&&a(t)===n){t=unescape(t);var f=E(t,!1);(""!==f||void 0!==(f=e.loadFile(t,!0)))&&(t=f)}if(d(t)&&(t=A(t,r)),r=a(t,r),!h(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(c=i)||0===c.length)&&(i=function(e){return"string"==typeof e||w(e)?v(e):w(e.data)?v(e.data):null}(t)),(o=p.call(this,i))||(t instanceof Uint8Array||"RGBA"===r||(l=t,t=_(t)),o=this["process"+r.toUpperCase()](t,u.call(this),i,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:y.NONE}(s),l)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},E=e.__addimage__.convertBase64ToBinaryString=function(e,t){t="boolean"!=typeof t||t;var n,r="";if("string"==typeof e){var i;n=null!==(i=x(e))&&void 0!==i?i:e;try{r=joe(n)}catch(a){if(t)throw b(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+a.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return r};e.getImageProperties=function(t){var r,i,s="";if(d(t)&&(t=A(t)),"string"==typeof t&&a(t)===n&&(""===(s=E(t,!1))&&(s=e.loadFile(t)||""),t=s),i=a(t),!h(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if(t instanceof Uint8Array||(t=_(t)),!(r=this["process"+i.toUpperCase()](t)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=i,r}}(Ale.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};Ale.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var n,r,a,i=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(e.objId),l=e.pageContext.annotations,c=!1,u=0;u<l.length&&!c;u++)switch((n=l[u]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var h=0;h<l.length;h++){n=l[h];var d=this.internal.pdfEscape,A=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),f=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(p.objId),g=n.title||"Note";a="<</Type /Annot /Subtype /Text "+(r="/Rect ["+i(n.bounds.x)+" "+s(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y)+"] ")+"/Contents ("+d(m(n.contents))+")",a+=" /Popup "+f.objId+" 0 R",a+=" /P "+o.objId+" 0 R",a+=" /T ("+d(m(g))+") >>",p.content=a;var y=p.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+i(n.bounds.x+30)+" "+s(n.bounds.y+n.bounds.h)+" "+i(n.bounds.x+n.bounds.w+30)+" "+s(n.bounds.y)+"] ")+" /Parent "+y,n.open&&(a+=" /Open true"),a+=" >>",f.content=a,this.internal.write(p.objId,"0 R",f.objId,"0 R");break;case"freetext":r="/Rect ["+i(n.bounds.x)+" "+s(n.bounds.y)+" "+i(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y+n.bounds.h)+"] ";var v=n.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+d(A(n.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+v+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(n.options.name){var b=this.annotations._nameMap[n.options.name];n.options.pageNumber=b.page,n.options.top=b.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",a="",n.options.url)a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+d(A(n.options.url))+") >>";else if(n.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,a+=" /FitV "+n.options.left+"]";break;default:var x=s(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),a+=" /XYZ "+n.options.left+" "+x+" "+n.options.zoom+"]"}""!=a&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,n,r,a){var i=this.internal.getCurrentPageInfo(),s=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:s(e),y:o(t),w:s(e+n),h:o(t+r)},options:a,type:"link"})},e.textWithLink=function(e,t,n,r){var a,i,s=this.getTextWidth(e),o=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){i=r.maxWidth;var l=this.splitTextToSize(e,i).length;a=Math.ceil(o*l)}else i=s,a=o;return this.text(e,t,n,r),n+=.2*o,"center"===r.align&&(t-=s/2),"right"===r.align&&(t-=s),this.link(t,n-o,i,a,r),s},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(Ale.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];e.__arabicParser__={};var i=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},s=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},o=e.__arabicParser__.isArabicEndLetter=function(e){return s(e)&&i(e)&&t[e.charCodeAt(0)].length<=2},l=e.__arabicParser__.isArabicAlfLetter=function(e){return s(e)&&a.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return s(e)&&i(e)&&t[e.charCodeAt(0)].length>=1};var c=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return s(e)&&i(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return s(e)&&i(e)&&t[e.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return s(e)&&i(e)&&4==t[e.charCodeAt(0)].length},h=e.__arabicParser__.resolveLigatures=function(e){var t=0,r=n,a="",i=0;for(t=0;t<e.length;t+=1)void 0!==r[e.charCodeAt(t)]?(i++,"number"==typeof(r=r[e.charCodeAt(t)])&&(a+=String.fromCharCode(r),r=n,i=0),t===e.length-1&&(r=n,a+=e.charAt(t-(i-1)),t-=i-1,i=0)):(r=n,a+=e.charAt(t-i),t-=i,i=0);return a};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==r[e.charCodeAt(0)]};var d=e.__arabicParser__.getCorrectForm=function(e,t,n){return s(e)?!1===i(e)?-1:!c(e)||!s(t)&&!s(n)||!s(n)&&o(t)||o(e)&&!s(t)||o(e)&&l(t)||o(e)&&o(t)?0:u(e)&&s(t)&&!o(t)&&s(n)&&c(n)?3:o(e)||!s(n)?1:2:-1},A=function(e){var n=0,r=0,a=0,i="",o="",l="",c=(e=e||"").split("\\s+"),u=[];for(n=0;n<c.length;n+=1){for(u.push(""),r=0;r<c[n].length;r+=1)i=c[n][r],o=c[n][r-1],l=c[n][r+1],s(i)?(a=d(i,o,l),u[n]+=-1!==a?String.fromCharCode(t[i.charCodeAt(0)][a]):i):u[n]+=i;u[n]=h(u[n])}return u.join(" ")},p=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(t)){var r=0;for(n=[],r=0;r<t.length;r+=1)Array.isArray(t[r])?n.push([A(t[r][0]),t[r][1],t[r][2]]):n.push([A(t[r])]);e=n}else e=A(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",p])}(Ale.API),Ale.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform","javascript"===e.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(e){n=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(e){r=e}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var n;if("2d"!==(e=e||"2d"))return null;for(n in t)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=t[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Ale.API),function(e){var t={left:0,top:0,bottom:0,right:0},n=!1,r=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var a=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var i=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var s=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return s},set:function(e){s=e}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return r.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){r.call(this);var n=(t=t||{}).fontSize||this.getFontSize(),a=t.font||this.getFont(),i=t.scaleFactor||this.internal.scaleFactor,s=0,o=0,l=0,c=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var u=t.maxWidth;u>0?"string"==typeof e?e=this.splitTextToSize(e,u):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(c.splitTextToSize(t,u))},[])):e=Array.isArray(e)?e:[e];for(var h=0;h<e.length;h++)s<(l=this.getStringUnitWidth(e[h],{font:a})*n)&&(s=l);return 0!==s&&(o=e.length),{w:s/=i,h:Math.max((o*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/i,0)}},e.cellAddPage=function(){r.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new i(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var e;e=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var a=this.internal.__cell__.lastCell,s=this.internal.__cell__.padding,o=this.internal.__cell__.margins||t,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==a.lineNumber&&(a.lineNumber===e.lineNumber?(e.x=(a.x||0)+(a.width||0),e.y=a.y||0):a.y+a.height+e.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=o.top,c&&l&&(this.printHeaderRow(e.lineNumber,!0),e.y+=l[0].height)):e.y=a.y+a.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===n?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-s,e.y+s,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+s,{align:"center",baseline:"top",maxWidth:e.width-s-s}):this.text(e.text,e.x+s,e.y+s,{align:"left",baseline:"top",maxWidth:e.width-s-s})),this.internal.__cell__.lastCell=e,this};e.table=function(e,n,l,c,u){if(r.call(this),!l)throw new Error("No data for PDF table.");var h,d,A,p,f=[],m=[],g=[],y={},v={},b=[],x=[],w=(u=u||{}).autoSize||!1,_=!1!==u.printHeaders,S=u.css&&void 0!==u.css["font-size"]?16*u.css["font-size"]:u.fontSize||12,C=u.margins||Object.assign({width:this.getPageWidth()},t),E="number"==typeof u.padding?u.padding:3,N=u.headerBackgroundColor||"#c8c8c8",B=u.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=_,this.internal.__cell__.margins=C,this.internal.__cell__.table_font_size=S,this.internal.__cell__.padding=E,this.internal.__cell__.headerBackgroundColor=N,this.internal.__cell__.headerTextColor=B,this.setFontSize(S),null==c)m=f=Object.keys(l[0]),g=f.map(function(){return"left"});else if(Array.isArray(c)&&"object"===(0,bne.A)(c[0]))for(f=c.map(function(e){return e.name}),m=c.map(function(e){return e.prompt||e.name||""}),g=c.map(function(e){return e.align||"left"}),h=0;h<c.length;h+=1)v[c[h].name]=.7499990551181103*c[h].width;else Array.isArray(c)&&"string"==typeof c[0]&&(m=f=c,g=f.map(function(){return"left"}));if(w||Array.isArray(c)&&"string"==typeof c[0])for(h=0;h<f.length;h+=1){for(y[p=f[h]]=l.map(function(e){return e[p]}),this.setFont(void 0,"bold"),b.push(this.getTextDimensions(m[h],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=y[p],this.setFont(void 0,"normal"),A=0;A<d.length;A+=1)b.push(this.getTextDimensions(d[A],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);v[p]=Math.max.apply(null,b)+E+E,b=[]}if(_){var k={};for(h=0;h<f.length;h+=1)k[f[h]]={},k[f[h]].text=m[h],k[f[h]].align=g[h];var I=o.call(this,k,v);x=f.map(function(t){return new i(e,n,v[t],I,k[t].text,void 0,k[t].align)}),this.setTableHeaderRow(x),this.printHeaderRow(1,!1)}var T=c.reduce(function(e,t){return e[t.name]=t.align,e},{});for(h=0;h<l.length;h+=1){"rowStart"in u&&u.rowStart instanceof Function&&u.rowStart({row:h,data:l[h]},this);var M=o.call(this,l[h],v);for(A=0;A<f.length;A+=1){var F=l[h][f[A]];"cellStart"in u&&u.cellStart instanceof Function&&u.cellStart({row:h,col:A,data:F},this),s.call(this,new i(e,n,v[f[A]],M,F,h+2,T[f[A]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=n,this};var o=function(e,t){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,a=this.internal.scaleFactor;return Object.keys(e).map(function(r){var a=e[r];return this.splitTextToSize(a.hasOwnProperty("text")?a.text:a,t[r]-n-n)},this).map(function(e){return this.getLineHeightFactor()*e.length*r/a+n+n},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){r.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var a;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var o=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(o[0],o[1],o[2],o[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){a=this.internal.__cell__.tableHeaderRow[c].clone(),t&&(a.y=this.internal.__cell__.margins.top||0,l.push(a)),a.lineNumber=e;var u=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,a),this.setTextColor(u)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),n=!1}}(Ale.API);var tce={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},nce=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],rce=ece(nce),ace=[100,200,300,400,500,600,700,800,900],ice=ece(ace);function sce(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),n=function(e){return tce[e=e||"normal"]?e:"normal"}(e.style),r=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),a=function(e){return"number"==typeof rce[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:n,weight:r,stretch:a,src:e.src||[],ref:e.ref||{name:t,style:[a,n,r].join(" ")}}}function oce(e,t,n,r){var a;for(a=n;a>=0&&a<t.length;a+=r)if(e[t[a]])return e[t[a]];for(a=n;a>=0&&a<t.length;a-=r)if(e[t[a]])return e[t[a]]}var lce={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},cce={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function uce(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function hce(e){return e.trimLeft()}function dce(e,t){for(var n=0;n<e.length;){if(e.charAt(n)===t)return[e.substring(0,n),e.substring(n+1)];n+=1}return null}function Ace(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var pce,fce,mce,gce,yce,vce,bce,xce,wce,_ce=["times"];function Sce(e,t,n,r,a){var i=4,s=Nce;switch(a){case Ale.API.image_compression.FAST:i=1,s=Ece;break;case Ale.API.image_compression.MEDIUM:i=6,s=Bce;break;case Ale.API.image_compression.SLOW:i=9,s=kce}e=function(e,t,n,r){for(var a,i=e.length/t,s=new Uint8Array(e.length+i),o=[Cce,Ece,Nce,Bce,kce],l=0;l<i;l+=1){var c=l*t,u=e.subarray(c,c+t);if(r)s.set(r(u,n,a),c+l);else{for(var h=o.length,d=[],A=0;A<h;A+=1)d[A]=o[A](u,n,a);var p=Tce(d.concat());s.set(d[p],c+l)}a=u}return s}(e,t,Math.ceil(n*r/8),s);var o=are(e,{level:i});return Ale.API.__addimage__.arrayBufferToBinaryString(o)}function Cce(e){var t=Array.apply([],e);return t.unshift(0),t}function Ece(e,t){var n=e.length,r=[];r[0]=1;for(var a=0;a<n;a+=1){var i=e[a-t]||0;r[a+1]=e[a]-i+256&255}return r}function Nce(e,t,n){var r=e.length,a=[];a[0]=2;for(var i=0;i<r;i+=1){var s=n&&n[i]||0;a[i+1]=e[i]-s+256&255}return a}function Bce(e,t,n){var r=e.length,a=[];a[0]=3;for(var i=0;i<r;i+=1){var s=e[i-t]||0,o=n&&n[i]||0;a[i+1]=e[i]+256-(s+o>>>1)&255}return a}function kce(e,t,n){var r=e.length,a=[];a[0]=4;for(var i=0;i<r;i+=1){var s=Ice(e[i-t]||0,n&&n[i]||0,n&&n[i-t]||0);a[i+1]=e[i]-s+256&255}return a}function Ice(e,t,n){if(e===t&&t===n)return e;var r=Math.abs(t-n),a=Math.abs(e-n),i=Math.abs(e+t-n-n);return r<=a&&r<=i?e:a<=i?t:n}function Tce(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))}function Mce(e,t,n){var r=t*n,a=Math.floor(r/8),i=16-(r-8*a+n),s=(1<<n)-1;return Rce(e,a)>>i&s}function Fce(e,t,n,r){var a=n*r,i=Math.floor(a/8),s=16-(a-8*i+r),o=(1<<r)-1,l=(t&o)<<s;!function(e,t,n){if(t+1<e.byteLength)e.setUint16(t,n,!1);else{var r=n>>8&255;e.setUint8(t,r)}}(e,i,Rce(e,i)&~(o<<s)&65535|l)}function Rce(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function Lce(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,a=e[t++],i=a>>7,s=1<<1+(7&a);e[t++],e[t++];var o=null,l=null;i&&(o=t,l=s,t+=3*s);var c=!0,u=[],h=0,d=null,A=0,p=null;for(this.width=n,this.height=r;c&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,p=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var f=e[t++];h=e[t++]|e[t++]<<8,d=e[t++],1&f||(d=null),A=f>>2&7,t++;break;case 254:for(;;){if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var m=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,b=e[t++],x=b>>6&1,w=1<<1+(7&b),_=o,S=l,C=!1;b>>7&&(C=!0,_=t,S=w,t+=3*w);var E=t;for(t++;;){var N;if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}u.push({x:m,y:g,width:y,height:v,has_local_palette:C,palette_offset:_,palette_size:S,data_offset:E,data_length:t-E,transparent_index:d,interlaced:!!x,delay:h,disposal:A});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=u.length)throw new Error("Frame index out of range.");return u[e]},this.decodeAndBlitFrameBGRA=function(t,r){var a=this.frameInfo(t),i=a.width*a.height,s=new Uint8Array(i);Uce(e,a.data_offset,s,i);var o=a.palette_offset,l=a.transparent_index;null===l&&(l=256);var c=a.width,u=n-c,h=c,d=4*(a.y*n+a.x),A=4*((a.y+a.height)*n+a.x),p=d,f=4*u;!0===a.interlaced&&(f+=4*n*7);for(var m=8,g=0,y=s.length;g<y;++g){var v=s[g];if(0===h&&(h=c,(p+=f)>=A&&(f=4*u+4*n*(m-1),p=d+(c+u)*(m<<1),m>>=1)),v===l)p+=4;else{var b=e[o+3*v],x=e[o+3*v+1],w=e[o+3*v+2];r[p++]=w,r[p++]=x,r[p++]=b,r[p++]=255}--h}},this.decodeAndBlitFrameRGBA=function(t,r){var a=this.frameInfo(t),i=a.width*a.height,s=new Uint8Array(i);Uce(e,a.data_offset,s,i);var o=a.palette_offset,l=a.transparent_index;null===l&&(l=256);var c=a.width,u=n-c,h=c,d=4*(a.y*n+a.x),A=4*((a.y+a.height)*n+a.x),p=d,f=4*u;!0===a.interlaced&&(f+=4*n*7);for(var m=8,g=0,y=s.length;g<y;++g){var v=s[g];if(0===h&&(h=c,(p+=f)>=A&&(f=4*u+4*n*(m-1),p=d+(c+u)*(m<<1),m>>=1)),v===l)p+=4;else{var b=e[o+3*v],x=e[o+3*v+1],w=e[o+3*v+2];r[p++]=b,r[p++]=x,r[p++]=w,r[p++]=255}--h}}}function Uce(e,t,n,r){for(var a=e[t++],i=1<<a,s=i+1,o=s+1,l=a+1,c=(1<<l)-1,u=0,h=0,d=0,A=e[t++],p=new Int32Array(4096),f=null;;){for(;u<16&&0!==A;)h|=e[t++]<<u,u+=8,1===A?A=e[t++]:--A;if(u<l)break;var m=h&c;if(h>>=l,u-=l,m!==i){if(m===s)break;for(var g=m<o?m:f,y=0,v=g;v>i;)v=p[v]>>8,++y;var b=v;if(d+y+(g!==m?1:0)>r)return void Uoe.log("Warning, gif stream longer than expected.");n[d++]=b;var x=d+=y;for(g!==m&&(n[d++]=b),v=g;y--;)v=p[v],n[--x]=255&v,v>>=8;null!==f&&o<4096&&(p[o++]=f<<8|b,o>=c+1&&l<12&&(++l,c=c<<1|1)),f=m}else o=s+1,c=(1<<(l=a+1))-1,f=null}return d!==r&&Uoe.log("Warning, gif stream shorter than expected."),n}function Pce(e){var t,n,r,a,i,s=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),u=new Array(64),h=new Array(65535),d=new Array(65535),A=new Array(64),p=new Array(64),f=[],m=0,g=7,y=new Array(64),v=new Array(64),b=new Array(64),x=new Array(256),w=new Array(2048),_=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],N=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],B=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],T=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function M(e,t){for(var n=0,r=0,a=new Array,i=1;i<=16;i++){for(var s=1;s<=e[i];s++)a[t[r]]=[],a[t[r]][0]=n,a[t[r]][1]=i,r++,n++;n*=2}return a}function F(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(m|=1<<g),n--,--g<0&&(255==m?(R(255),R(0)):R(m),g=7,m=0)}function R(e){f.push(e)}function L(e){R(e>>8&255),R(255&e)}function U(e,t,n,r,a){for(var i,s=a[0],o=a[240],l=function(e,t){var n,r,a,i,s,o,l,c,u,h,d=0;for(u=0;u<8;++u){n=e[d],r=e[d+1],a=e[d+2],i=e[d+3],s=e[d+4],o=e[d+5],l=e[d+6];var p=n+(c=e[d+7]),f=n-c,m=r+l,g=r-l,y=a+o,v=a-o,b=i+s,x=i-s,w=p+b,_=p-b,S=m+y,C=m-y;e[d]=w+S,e[d+4]=w-S;var E=.707106781*(C+_);e[d+2]=_+E,e[d+6]=_-E;var N=.382683433*((w=x+v)-(C=g+f)),B=.5411961*w+N,k=1.306562965*C+N,I=.707106781*(S=v+g),T=f+I,M=f-I;e[d+5]=M+B,e[d+3]=M-B,e[d+1]=T+k,e[d+7]=T-k,d+=8}for(d=0,u=0;u<8;++u){n=e[d],r=e[d+8],a=e[d+16],i=e[d+24],s=e[d+32],o=e[d+40],l=e[d+48];var F=n+(c=e[d+56]),R=n-c,L=r+l,U=r-l,P=a+o,D=a-o,O=i+s,z=i-s,H=F+O,j=F-O,Q=L+P,V=L-P;e[d]=H+Q,e[d+32]=H-Q;var W=.707106781*(V+j);e[d+16]=j+W,e[d+48]=j-W;var G=.382683433*((H=z+D)-(V=U+R)),K=.5411961*H+G,q=1.306562965*V+G,X=.707106781*(Q=D+U),Y=R+X,J=R-X;e[d+40]=J+K,e[d+24]=J-K,e[d+8]=Y+q,e[d+56]=Y-q,d++}for(u=0;u<64;++u)h=e[u]*t[u],A[u]=h>0?h+.5|0:h-.5|0;return A}(e,t),c=0;c<64;++c)p[_[c]]=l[c];var u=p[0]-n;n=p[0],0==u?F(r[0]):(F(r[d[i=32767+u]]),F(h[i]));for(var f=63;f>0&&0==p[f];)f--;if(0==f)return F(s),n;for(var m,g=1;g<=f;){for(var y=g;0==p[g]&&g<=f;)++g;var v=g-y;if(v>=16){m=v>>4;for(var b=1;b<=m;++b)F(o);v&=15}i=32767+p[g],F(a[(v<<4)+d[i]]),F(h[i]),g++}return 63!=f&&F(s),n}function P(e){e=Math.min(Math.max(e,1),100),i!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=s((t[n]*e+50)/100);r=Math.min(Math.max(r,1),255),o[_[n]]=r}for(var a=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],i=0;i<64;i++){var h=s((a[i]*e+50)/100);h=Math.min(Math.max(h,1),255),l[_[i]]=h}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],A=0,p=0;p<8;p++)for(var f=0;f<8;f++)c[A]=1/(o[_[A]]*d[p]*d[f]*8),u[A]=1/(l[_[A]]*d[p]*d[f]*8),A++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),i=e)}this.encode=function(e,i){i&&P(i),f=new Array,m=0,g=7,L(65496),L(65504),L(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),L(1),L(1),R(0),R(0),function(){L(65499),L(132),R(0);for(var e=0;e<64;e++)R(o[e]);R(1);for(var t=0;t<64;t++)R(l[t])}(),function(e,t){L(65472),L(17),R(8),L(t),L(e),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(e.width,e.height),function(){L(65476),L(418),R(0);for(var e=0;e<16;e++)R(S[e+1]);for(var t=0;t<=11;t++)R(C[t]);R(16);for(var n=0;n<16;n++)R(E[n+1]);for(var r=0;r<=161;r++)R(N[r]);R(1);for(var a=0;a<16;a++)R(B[a+1]);for(var i=0;i<=11;i++)R(k[i]);R(17);for(var s=0;s<16;s++)R(I[s+1]);for(var o=0;o<=161;o++)R(T[o])}(),L(65498),L(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var s=0,h=0,d=0;m=0,g=7,this.encode.displayName="_encode_";for(var A,p,x,_,M,D,O,z,H,j=e.data,Q=e.width,V=e.height,W=4*Q,G=0;G<V;){for(A=0;A<W;){for(M=W*G+A,O=-1,z=0,H=0;H<64;H++)D=M+(z=H>>3)*W+(O=4*(7&H)),G+z>=V&&(D-=W*(G+1+z-V)),A+O>=W&&(D-=A+O-W+4),p=j[D++],x=j[D++],_=j[D++],y[H]=(w[p]+w[x+256|0]+w[_+512|0]>>16)-128,v[H]=(w[p+768|0]+w[x+1024|0]+w[_+1280|0]>>16)-128,b[H]=(w[p+1280|0]+w[x+1536|0]+w[_+1792|0]>>16)-128;s=U(y,c,s,t,r),h=U(v,u,h,n,a),d=U(b,u,d,n,a),A+=32}G+=8}if(g>=0){var K=[];K[1]=g+1,K[0]=(1<<g+1)-1,F(K)}return L(65497),new Uint8Array(f)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)x[t]=e(t)}(),t=M(S,C),n=M(B,k),r=M(E,N),a=M(I,T),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var r=e;r<t;r++)d[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=r;for(var a=-(t-1);a<=-e;a++)d[32767+a]=n,h[32767+a]=[],h[32767+a][1]=n,h[32767+a][0]=t-1+a;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)w[e]=19595*e,w[e+256|0]=38470*e,w[e+512|0]=7471*e+32768,w[e+768|0]=-11059*e,w[e+1024|0]=-21709*e,w[e+1280|0]=32768*e+8421375,w[e+1536|0]=-27439*e,w[e+1792|0]=-5329*e}(),P(e)}function Dce(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Oce(e){function t(e){if(!e)throw Error("assert :P")}function n(e,t,n){for(var r=0;4>r;r++)if(e[t+r]!=n.charCodeAt(r))return!0;return!1}function r(e,t,n,r,a){for(var i=0;i<a;i++)e[t+i]=n[r+i]}function a(e,t,n,r){for(var a=0;a<r;a++)e[t+a]=n}function i(e){return new Int32Array(e)}function s(e,t){for(var n=[],r=0;r<e;r++)n.push(new t);return n}function o(e,t){var n=[];return function e(n,r,a){for(var i=a[r],s=0;s<i&&(n.push(a.length>r+1?[]:new t),!(a.length<r+1));s++)e(n[s],r+1,a)}(n,0,e),n}var l=function(){var e=this;function l(e,t){for(var n=1<<t-1>>>0;e&n;)n>>>=1;return n?(e&n-1)+n:e}function c(e,n,r,a,i){t(!(a%r));do{e[n+(a-=r)]=i}while(0<a)}function u(e,n,r,a,s){if(t(2328>=s),512>=s)var o=i(512);else if(null==(o=i(s)))return 0;return function(e,n,r,a,s,o){var u,d,A=n,p=1<<r,f=i(16),m=i(16);for(t(0!=s),t(null!=a),t(null!=e),t(0<r),d=0;d<s;++d){if(15<a[d])return 0;++f[a[d]]}if(f[0]==s)return 0;for(m[1]=0,u=1;15>u;++u){if(f[u]>1<<u)return 0;m[u+1]=m[u]+f[u]}for(d=0;d<s;++d)u=a[d],0<a[d]&&(o[m[u]++]=d);if(1==m[15])return(a=new h).g=0,a.value=o[0],c(e,A,1,p,a),p;var g,y=-1,v=p-1,b=0,x=1,w=1,_=1<<r;for(d=0,u=1,s=2;u<=r;++u,s<<=1){if(x+=w<<=1,0>(w-=f[u]))return 0;for(;0<f[u];--f[u])(a=new h).g=u,a.value=o[d++],c(e,A+b,s,_,a),b=l(b,u)}for(u=r+1,s=2;15>=u;++u,s<<=1){if(x+=w<<=1,0>(w-=f[u]))return 0;for(;0<f[u];--f[u]){if(a=new h,(b&v)!=y){for(A+=_,g=1<<(y=u)-r;15>y&&!(0>=(g-=f[y]));)++y,g<<=1;p+=_=1<<(g=y-r),e[n+(y=b&v)].g=g+r,e[n+y].value=A-n-y}a.g=u-r,a.value=o[d++],c(e,A+(b>>r),s,_,a),b=l(b,u)}}return x!=2*m[15]-1?0:p}(e,n,r,a,s,o)}function h(){this.value=this.g=0}function d(){this.value=this.g=0}function A(){this.G=s(5,h),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(Dn,d)}function p(e,n,r,a){t(null!=e),t(null!=n),t(2147483648>a),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=n,e.pa=r,e.Jd=n,e.Yc=r+a,e.Zc=4<=a?r+a-4+1:r,E(e)}function f(e,t){for(var n=0;0<t--;)n|=B(e,128)<<t;return n}function m(e,t){var n=f(e,t);return N(e)?-n:n}function g(e,n,r,a){var i,s=0;for(t(null!=e),t(null!=n),t(4294967288>a),e.Sb=a,e.Ra=0,e.u=0,e.h=0,4<a&&(a=4),i=0;i<a;++i)s+=n[r+i]<<8*i;e.Ra=s,e.bb=a,e.oa=n,e.pa=r}function y(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Hn-8>>>0,++e.bb,e.u-=8;_(e)&&(e.h=1,e.u=0)}function v(e,n){if(t(0<=n),!e.h&&n<=zn){var r=w(e)&On[n];return e.u+=n,y(e),r}return e.h=1,e.u=0}function b(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function x(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function w(e){return e.Ra>>>(e.u&Hn-1)>>>0}function _(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Hn}function S(e,t){e.u=t,e.h=_(e)}function C(e){e.u>=jn&&(t(e.u>=jn),y(e))}function E(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function N(e){return f(e,1)}function B(e,t){var n=e.Ca;0>e.b&&E(e);var r=e.b,a=n*t>>>8,i=(e.I>>>r>a)+0;for(i?(n-=a,e.I-=a+1<<r>>>0):n=a+1,r=n,a=0;256<=r;)a+=8,r>>=8;return r=7^a+Qn[r],e.b-=r,e.Ca=(n<<r)-1,i}function k(e,t,n){e[t+0]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function I(e,t){return e[t+0]|e[t+1]<<8}function T(e,t){return I(e,t)|e[t+2]<<16}function M(e,t){return I(e,t)|I(e,t+2)<<16}function F(e,n){var r=1<<n;return t(null!=e),t(0<n),e.X=i(r),null==e.X?0:(e.Mb=32-n,e.Xa=n,1)}function R(e,n){t(null!=e),t(null!=n),t(e.Xa==n.Xa),r(n.X,0,e.X,0,1<<n.Xa)}function L(){this.X=[],this.Xa=this.Mb=0}function U(e,n,r,a){t(null!=r),t(null!=a);var i=r[0],s=a[0];return 0==i&&(i=(e*s+n/2)/n),0==s&&(s=(n*i+e/2)/e),0>=i||0>=s?0:(r[0]=i,a[0]=s,1)}function P(e,t){return e+(1<<t)-1>>>t}function D(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function O(t,n){e[n]=function(n,r,a,i,s,o,l){var c;for(c=0;c<s;++c){var u=e[t](o[l+c-1],a,i+c);o[l+c]=D(n[r+c],u)}}}function z(){this.ud=this.hd=this.jd=0}function H(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function j(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function Q(e,t){return j(e+(e-t+.5>>1))}function V(e,t,n){return Math.abs(t-n)-Math.abs(e-n)}function W(e,t,n,r,a,i,s){for(r=i[s-1],n=0;n<a;++n)i[s+n]=r=D(e[t+n],r)}function G(e,t,n,r,a){var i;for(i=0;i<n;++i){var s=e[t+i],o=s>>8&255,l=16711935&(l=(l=16711935&s)+((o<<16)+o));r[a+i]=(4278255360&s)+l>>>0}}function K(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function q(e,t,n,r,a,i){var s;for(s=0;s<r;++s){var o=t[n+s],l=o>>>8,c=o,u=255&(u=(u=o>>>16)+((e.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(e.hd<<24>>24)*(l<<24>>24)>>>5)+((e.ud<<24>>24)*(u<<24>>24)>>>5)),a[i+s]=(4278255360&o)+(u<<16)+c}}function X(t,n,r,a,i){e[n]=function(e,t,n,r,s,o,l,c,u){for(r=l;r<c;++r)for(l=0;l<u;++l)s[o++]=i(n[a(e[t++])])},e[t]=function(t,n,s,o,l,c,u){var h=8>>t.b,d=t.Ea,A=t.K[0],p=t.w;if(8>h)for(t=(1<<t.b)-1,p=(1<<h)-1;n<s;++n){var f,m=0;for(f=0;f<d;++f)f&t||(m=a(o[l++])),c[u++]=i(A[m&p]),m>>=h}else e["VP8LMapColor"+r](o,l,A,p,c,u,n,s,d)}}function Y(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=i>>16&255,r[a++]=i>>8&255,r[a++]=255&i}}function J(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=i>>16&255,r[a++]=i>>8&255,r[a++]=255&i,r[a++]=i>>24&255}}function Z(e,t,n,r,a){for(n=t+n;t<n;){var i=(s=e[t++])>>16&240|s>>12&15,s=240&s|s>>28&15;r[a++]=i,r[a++]=s}}function $(e,t,n,r,a){for(n=t+n;t<n;){var i=(s=e[t++])>>16&248|s>>13&7,s=s>>5&224|s>>3&31;r[a++]=i,r[a++]=s}}function ee(e,t,n,r,a){for(n=t+n;t<n;){var i=e[t++];r[a++]=255&i,r[a++]=i>>8&255,r[a++]=i>>16&255}}function te(e,t,n,a,i,s){if(0==s)for(n=t+n;t<n;)k(a,((s=e[t++])[0]>>24|s[1]>>8&65280|s[2]<<8&16711680|s[3]<<24)>>>0),i+=32;else r(a,i,e,t,n)}function ne(t,n){e[n][0]=e[t+"0"],e[n][1]=e[t+"1"],e[n][2]=e[t+"2"],e[n][3]=e[t+"3"],e[n][4]=e[t+"4"],e[n][5]=e[t+"5"],e[n][6]=e[t+"6"],e[n][7]=e[t+"7"],e[n][8]=e[t+"8"],e[n][9]=e[t+"9"],e[n][10]=e[t+"10"],e[n][11]=e[t+"11"],e[n][12]=e[t+"12"],e[n][13]=e[t+"13"],e[n][14]=e[t+"0"],e[n][15]=e[t+"0"]}function re(e){return e==jr||e==Qr||e==Vr||e==Wr}function ae(){this.eb=[],this.size=this.A=this.fb=0}function ie(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function se(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ae,this.f.kb=new ie,this.sd=null}function oe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function le(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function ue(e,t){var n=e.T,a=t.ba.f.RGBA,i=a.eb,s=a.fb+e.ka*a.A,o=ma[t.ba.S],l=e.y,c=e.O,u=e.f,h=e.N,d=e.ea,A=e.W,p=t.cc,f=t.dc,m=t.Mc,g=t.Nc,y=e.ka,v=e.ka+e.T,b=e.U,x=b+1>>1;for(0==y?o(l,c,null,null,u,h,d,A,u,h,d,A,i,s,null,null,b):(o(t.ec,t.fc,l,c,p,f,m,g,u,h,d,A,i,s-a.A,i,s,b),++n);y+2<v;y+=2)p=u,f=h,m=d,g=A,h+=e.Rc,A+=e.Rc,s+=2*a.A,o(l,(c+=2*e.fa)-e.fa,l,c,p,f,m,g,u,h,d,A,i,s-a.A,i,s,b);return c+=e.fa,e.j+v<e.o?(r(t.ec,t.fc,l,c,b),r(t.cc,t.dc,u,h,x),r(t.Mc,t.Nc,d,A,x),n--):1&v||o(l,c,null,null,u,h,d,A,u,h,d,A,i,s+a.A,null,null,b),n}function he(e,n,r){var a=e.F,i=[e.J];if(null!=a){var s=e.U,o=n.ba.S,l=o==Or||o==Vr;n=n.ba.f.RGBA;var c=[0],u=e.ka;c[0]=e.T,e.Kb&&(0==u?--c[0]:(--u,i[0]-=e.width),e.j+e.ka+e.T==e.o&&(c[0]=e.o-e.j-u));var h=n.eb;u=n.fb+u*n.A,e=Sr(a,i[0],e.width,s,c,h,u+(l?0:3),n.A),t(r==c),e&&re(o)&&wr(h,u,l,s,c,n.A)}return 0}function de(e){var t=e.ma,n=t.ba.S,r=11>n,a=n==Ur||n==Dr||n==Or||n==zr||12==n||re(n);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Ln(t.Oa,e,a?11:12))return 0;if(a&&re(n)&&yn(),e.da)alert("todo:use_scaling");else{if(r){if(t.Ib=ce,e.Kb){if(n=e.U+1>>1,t.memory=i(e.U+2*n),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+n,t.Ib=ue,yn()}}else alert("todo:EmitYUV");a&&(t.Jb=he,r&&mn())}if(r&&!Ia){for(e=0;256>e;++e)Ta[e]=89858*(e-128)+Ca>>Sa,Ra[e]=-22014*(e-128)+Ca,Fa[e]=-45773*(e-128),Ma[e]=113618*(e-128)+Ca>>Sa;for(e=Ea;e<Na;++e)t=76283*(e-16)+Ca>>Sa,La[e-Ea]=We(t,255),Ua[e-Ea]=We(t+8>>4,15);Ia=1}return 1}function Ae(e){var n=e.ma,r=e.U,a=e.T;return t(!(1&e.ka)),0>=r||0>=a?0:(r=n.Ib(e,n),null!=n.Jb&&n.Jb(e,n,r),n.Dc+=r,1)}function pe(e){e.ma.memory=null}function fe(e,t,n,r){return 47!=v(e,8)?0:(t[0]=v(e,14)+1,n[0]=v(e,14)+1,r[0]=v(e,1),0!=v(e,3)?0:!e.h)}function me(e,t){if(4>e)return e+1;var n=e-2>>1;return(2+(1&e)<<n)+v(t,n)+1}function ge(e,t){return 120<t?t-120:1<=(n=((n=Jr[t-1])>>4)*e+(8-(15&n)))?n:1;var n}function ye(e,t,n){var r=w(n),a=e[t+=255&r].g-8;return 0<a&&(S(n,n.u+8),r=w(n),t+=e[t].value,t+=r&(1<<a)-1),S(n,n.u+e[t].g),e[t].value}function ve(e,n,r){return r.g+=e.g,r.value+=e.value<<n>>>0,t(8>=r.g),e.g}function be(e,n,r){var a=e.xc;return t((n=0==a?0:e.vc[e.md*(r>>a)+(n>>a)])<e.Wb),e.Ya[n]}function xe(e,n,a,i){var s=e.ab,o=e.c*n,l=e.C;n=l+n;var c=a,u=i;for(i=e.Ta,a=e.Ua;0<s--;){var h=e.gc[s],d=l,A=n,p=c,f=u,m=(u=i,c=a,h.Ea);switch(t(d<A),t(A<=h.nc),h.hc){case 2:Gn(p,f,(A-d)*m,u,c);break;case 0:var g=d,y=A,v=u,b=c,x=(E=h).Ea;0==g&&(Vn(p,f,null,null,1,v,b),W(p,f+1,0,0,x-1,v,b+1),f+=x,b+=x,++g);for(var w=1<<E.b,_=w-1,S=P(x,E.b),C=E.K,E=E.w+(g>>E.b)*S;g<y;){var N=C,B=E,k=1;for(Wn(p,f,v,b-x,1,v,b);k<x;){var I=(k&~_)+w;I>x&&(I=x),(0,Jn[N[B++]>>8&15])(p,f+ +k,v,b+k-x,I-k,v,b+k),k=I}f+=x,b+=x,++g&_||(E+=S)}A!=h.nc&&r(u,c-m,u,c+(A-d-1)*m,m);break;case 1:for(m=p,y=f,x=(p=h.Ea)-(b=p&~(v=(f=1<<h.b)-1)),g=P(p,h.b),w=h.K,h=h.w+(d>>h.b)*g;d<A;){for(_=w,S=h,C=new z,E=y+b,N=y+p;y<E;)K(_[S++],C),Zn(C,m,y,f,u,c),y+=f,c+=f;y<N&&(K(_[S++],C),Zn(C,m,y,x,u,c),y+=x,c+=x),++d&v||(h+=g)}break;case 3:if(p==u&&f==c&&0<h.b){for(y=u,p=m=c+(A-d)*m-(b=(A-d)*P(h.Ea,h.b)),f=u,v=c,g=[],b=(x=b)-1;0<=b;--b)g[b]=f[v+b];for(b=x-1;0<=b;--b)y[p+b]=g[b];Kn(h,d,A,u,m,u,c)}else Kn(h,d,A,p,f,u,c)}c=i,u=a}u!=a&&r(i,a,c,u,o)}function we(e,n){var r=e.V,a=e.Ba+e.c*e.C,i=n-e.C;if(t(n<=e.l.o),t(16>=i),0<i){var s=e.l,o=e.Ta,l=e.Ua,c=s.width;if(xe(e,i,r,a),i=l=[l],t((r=e.C)<(a=n)),t(s.v<s.va),a>s.o&&(a=s.o),r<s.j){var u=s.j-r;r=s.j,i[0]+=u*c}if(r>=a?r=0:(i[0]+=4*s.v,s.ka=r-s.j,s.U=s.va-s.v,s.T=a-r,r=1),r){if(l=l[0],11>(r=e.ca).S){var h=r.f.RGBA,d=(a=r.S,i=s.U,s=s.T,u=h.eb,h.A),A=s;for(h=h.fb+e.Ma*h.A;0<A--;){var p=o,f=l,m=i,g=u,y=h;switch(a){case Lr:$n(p,f,m,g,y);break;case Ur:er(p,f,m,g,y);break;case jr:er(p,f,m,g,y),wr(g,y,0,m,1,0);break;case Pr:rr(p,f,m,g,y);break;case Dr:te(p,f,m,g,y,1);break;case Qr:te(p,f,m,g,y,1),wr(g,y,0,m,1,0);break;case Or:te(p,f,m,g,y,0);break;case Vr:te(p,f,m,g,y,0),wr(g,y,1,m,1,0);break;case zr:tr(p,f,m,g,y);break;case Wr:tr(p,f,m,g,y),_r(g,y,m,1,0);break;case Hr:nr(p,f,m,g,y);break;default:t(0)}l+=c,h+=d}e.Ma+=s}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=r.height)}}e.C=n,t(e.C<=e.i)}function _e(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var n=e.Ya[t].G,r=e.Ya[t].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Se(e,n,r,a,i,s){if(0!=e.Z){var o=e.qd,l=e.rd;for(t(null!=fa[e.Z]);n<r;++n)fa[e.Z](o,l,a,i,a,i,s),o=a,l=i,i+=s;e.qd=o,e.rd=l}}function Ce(e,n){var r=e.l.ma,a=0==r.Z||1==r.Z?e.l.j:e.C;if(a=e.C<a?a:e.C,t(n<=e.l.o),n>a){var i=e.l.width,s=r.ca,o=r.tb+i*a,l=e.V,c=e.Ba+e.c*a,u=e.gc;t(1==e.ab),t(3==u[0].hc),Xn(u[0],a,n,l,c,s,o),Se(r,a,n,s,o,i)}e.C=e.Ma=n}function Ee(e,n,r,a,i,s,o){var l=e.$/a,c=e.$%a,u=e.m,h=e.s,d=r+e.$,A=d;i=r+a*i;var p=r+a*s,f=280+h.ua,m=e.Pb?l:16777216,g=0<h.ua?h.Wa:null,y=h.wc,v=d<p?be(h,c,l):null;t(e.C<s),t(p<=i);var b=!1;e:for(;;){for(;b||d<p;){var x=0;if(l>=m){var E=d-r;t((m=e).Pb),m.wd=m.m,m.xd=E,0<m.s.ua&&R(m.s.Wa,m.s.vb),m=l+$r}if(c&y||(v=be(h,c,l)),t(null!=v),v.Qb&&(n[d]=v.qb,b=!0),!b)if(C(u),v.jc){x=u,E=n;var N=d,B=v.pd[w(x)&Dn-1];t(v.jc),256>B.g?(S(x,x.u+B.g),E[N]=B.value,x=0):(S(x,x.u+B.g-256),t(256<=B.value),x=B.value),0==x&&(b=!0)}else x=ye(v.G[0],v.H[0],u);if(u.h)break;if(b||256>x){if(!b)if(v.nd)n[d]=(v.qb|x<<8)>>>0;else{if(C(u),b=ye(v.G[1],v.H[1],u),C(u),E=ye(v.G[2],v.H[2],u),N=ye(v.G[3],v.H[3],u),u.h)break;n[d]=(N<<24|b<<16|x<<8|E)>>>0}if(b=!1,++d,++c>=a&&(c=0,++l,null!=o&&l<=s&&!(l%16)&&o(e,l),null!=g))for(;A<d;)x=n[A++],g.X[(506832829*x&4294967295)>>>g.Mb]=x}else if(280>x){if(x=me(x-256,u),E=ye(v.G[4],v.H[4],u),C(u),E=ge(a,E=me(E,u)),u.h)break;if(d-r<E||i-d<x)break e;for(N=0;N<x;++N)n[d+N]=n[d+N-E];for(d+=x,c+=x;c>=a;)c-=a,++l,null!=o&&l<=s&&!(l%16)&&o(e,l);if(t(d<=i),c&y&&(v=be(h,c,l)),null!=g)for(;A<d;)x=n[A++],g.X[(506832829*x&4294967295)>>>g.Mb]=x}else{if(!(x<f))break e;for(b=x-280,t(null!=g);A<d;)x=n[A++],g.X[(506832829*x&4294967295)>>>g.Mb]=x;x=d,t(!(b>>>(E=g).Xa)),n[x]=E.X[b],b=!0}b||t(u.h==_(u))}if(e.Pb&&u.h&&d<i)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&R(e.s.vb,e.s.Wa);else{if(u.h)break e;null!=o&&o(e,l>s?s:l),e.a=0,e.$=d-r}return 1}return e.a=3,0}function Ne(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var n=e.Wa;null!=n&&(n.X=null),e.vb=null,t(null!=e)}function Be(){var t=new sn;return null==t?null:(t.a=0,t.xb=pa,ne("Predictor","VP8LPredictors"),ne("Predictor","VP8LPredictors_C"),ne("PredictorAdd","VP8LPredictorsAdd"),ne("PredictorAdd","VP8LPredictorsAdd_C"),Gn=G,Zn=q,$n=Y,er=J,tr=Z,nr=$,rr=ee,e.VP8LMapColor32b=qn,e.VP8LMapColor8b=Yn,t)}function ke(e,n,r,o,l){var c=1,d=[e],p=[n],f=o.m,m=o.s,g=null,y=0;e:for(;;){if(r)for(;c&&v(f,1);){var b=d,x=p,_=o,E=1,N=_.m,B=_.gc[_.ab],k=v(N,2);if(_.Oc&1<<k)c=0;else{switch(_.Oc|=1<<k,B.hc=k,B.Ea=b[0],B.nc=x[0],B.K=[null],++_.ab,t(4>=_.ab),k){case 0:case 1:B.b=v(N,3)+2,E=ke(P(B.Ea,B.b),P(B.nc,B.b),0,_,B.K),B.K=B.K[0];break;case 3:var I,T=v(N,8)+1,M=16<T?0:4<T?1:2<T?2:3;if(b[0]=P(B.Ea,M),B.b=M,I=E=ke(T,1,0,_,B.K)){var R,L=T,U=B,O=1<<(8>>U.b),z=i(O);if(null==z)I=0;else{var H=U.K[0],j=U.w;for(z[0]=U.K[0][0],R=1;R<1*L;++R)z[R]=D(H[j+R],z[R-1]);for(;R<4*O;++R)z[R]=0;U.K[0]=null,U.K[0]=z,I=1}}E=I;break;case 2:break;default:t(0)}c=E}}if(d=d[0],p=p[0],c&&v(f,1)&&!(c=1<=(y=v(f,4))&&11>=y)){o.a=3;break e}var Q;if(Q=c)t:{var V,W,G,K=o,q=d,X=p,Y=y,J=r,Z=K.m,$=K.s,ee=[null],te=1,ne=0,re=Zr[Y];n:for(;;){if(J&&v(Z,1)){var ae=v(Z,3)+2,ie=P(q,ae),se=P(X,ae),oe=ie*se;if(!ke(ie,se,0,K,ee))break n;for(ee=ee[0],$.xc=ae,V=0;V<oe;++V){var le=ee[V]>>8&65535;ee[V]=le,le>=te&&(te=le+1)}}if(Z.h)break n;for(W=0;5>W;++W){var ce=qr[W];!W&&0<Y&&(ce+=1<<Y),ne<ce&&(ne=ce)}var ue=s(te*re,h),he=te,de=s(he,A);if(null==de)var Ae=null;else t(65536>=he),Ae=de;var pe=i(ne);if(null==Ae||null==pe||null==ue){K.a=1;break n}var fe=ue;for(V=G=0;V<te;++V){var me=Ae[V],ge=me.G,ye=me.H,be=0,xe=1,we=0;for(W=0;5>W;++W){ce=qr[W],ge[W]=fe,ye[W]=G,!W&&0<Y&&(ce+=1<<Y);r:{var _e,Se=ce,Ce=K,Be=pe,Ie=fe,Te=G,Me=0,Fe=Ce.m,Re=v(Fe,1);if(a(Be,0,0,Se),Re){var Le=v(Fe,1)+1,Ue=v(Fe,1),Pe=v(Fe,0==Ue?1:8);Be[Pe]=1,2==Le&&(Be[Pe=v(Fe,8)]=1);var De=1}else{var Oe=i(19),ze=v(Fe,4)+4;if(19<ze){Ce.a=3;var He=0;break r}for(_e=0;_e<ze;++_e)Oe[Yr[_e]]=v(Fe,3);var je=void 0,Qe=void 0,Ve=Ce,We=Oe,Ge=Se,Ke=Be,qe=0,Xe=Ve.m,Ye=8,Je=s(128,h);a:for(;u(Je,0,7,We,19);){if(v(Xe,1)){var Ze=2+2*v(Xe,3);if((je=2+v(Xe,Ze))>Ge)break a}else je=Ge;for(Qe=0;Qe<Ge&&je--;){C(Xe);var $e=Je[0+(127&w(Xe))];S(Xe,Xe.u+$e.g);var et=$e.value;if(16>et)Ke[Qe++]=et,0!=et&&(Ye=et);else{var tt=16==et,nt=et-16,rt=Kr[nt],at=v(Xe,Gr[nt])+rt;if(Qe+at>Ge)break a;for(var it=tt?Ye:0;0<at--;)Ke[Qe++]=it}}qe=1;break a}qe||(Ve.a=3),De=qe}(De=De&&!Fe.h)&&(Me=u(Ie,Te,8,Be,Se)),De&&0!=Me?He=Me:(Ce.a=3,He=0)}if(0==He)break n;if(xe&&1==Xr[W]&&(xe=0==fe[G].g),be+=fe[G].g,G+=He,3>=W){var st,ot=pe[0];for(st=1;st<ce;++st)pe[st]>ot&&(ot=pe[st]);we+=ot}}if(me.nd=xe,me.Qb=0,xe&&(me.qb=(ge[3][ye[3]+0].value<<24|ge[1][ye[1]+0].value<<16|ge[2][ye[2]+0].value)>>>0,0==be&&256>ge[0][ye[0]+0].value&&(me.Qb=1,me.qb+=ge[0][ye[0]+0].value<<8)),me.jc=!me.Qb&&6>we,me.jc){var lt,ct=me;for(lt=0;lt<Dn;++lt){var ut=lt,ht=ct.pd[ut],dt=ct.G[0][ct.H[0]+ut];256<=dt.value?(ht.g=dt.g+256,ht.value=dt.value):(ht.g=0,ht.value=0,ut>>=ve(dt,8,ht),ut>>=ve(ct.G[1][ct.H[1]+ut],16,ht),ut>>=ve(ct.G[2][ct.H[2]+ut],0,ht),ve(ct.G[3][ct.H[3]+ut],24,ht))}}}$.vc=ee,$.Wb=te,$.Ya=Ae,$.yc=ue,Q=1;break t}Q=0}if(!(c=Q)){o.a=3;break e}if(0<y){if(m.ua=1<<y,!F(m.Wa,y)){o.a=1,c=0;break e}}else m.ua=0;var At=o,pt=d,ft=p,mt=At.s,gt=mt.xc;if(At.c=pt,At.i=ft,mt.md=P(pt,gt),mt.wc=0==gt?-1:(1<<gt)-1,r){o.xb=Aa;break e}if(null==(g=i(d*p))){o.a=1,c=0;break e}c=(c=Ee(o,g,0,d,p,p,null))&&!f.h;break e}return c?(null!=l?l[0]=g:(t(null==g),t(r)),o.$=0,r||Ne(m)):Ne(m),c}function Ie(e,n){var r=e.c*e.i,a=r+n+16*n;return t(e.c<=n),e.V=i(a),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+r+n,1)}function Te(e,n){var r=e.C,a=n-r,i=e.V,s=e.Ba+e.c*r;for(t(n<=e.l.o);0<a;){var o=16<a?16:a,l=e.l.ma,c=e.l.width,u=c*o,h=l.ca,d=l.tb+c*r,A=e.Ta,p=e.Ua;xe(e,o,i,s),Cr(A,p,h,d,u),Se(l,r,r+o,h,d,c),a-=o,i+=o*e.c,r+=o}t(r==n),e.C=e.Ma=n}function Me(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Re(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function Le(){this.Yb=function(){var e=[];return function e(t,n,r){for(var a=r[n],i=0;i<a&&(t.push(r.length>n+1?[]:0),!(r.length<n+1));i++)e(t[i],n+1,r)}(e,0,[3,11]),e}()}function Ue(){this.jb=i(3),this.Wc=o([4,8],Le),this.Xc=o([4,17],Le)}function Pe(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function De(){this.ld=this.La=this.dd=this.tc=0}function Oe(){this.Na=this.la=0}function ze(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function He(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function je(){this.uc=this.M=this.Nb=0,this.wa=Array(new De),this.Y=0,this.ya=Array(new He),this.aa=0,this.l=new Ge}function Qe(){this.y=i(16),this.f=i(8),this.ea=i(8)}function Ve(){this.cb=this.a=0,this.sc="",this.m=new b,this.Od=new Me,this.Kc=new Fe,this.ed=new Pe,this.Qa=new Re,this.Ic=this.$c=this.Aa=0,this.D=new je,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,b),this.ia=0,this.pb=s(4,ze),this.Pa=new Ue,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Qe),this.Hd=0,this.rb=Array(new Oe),this.sb=0,this.wa=Array(new De),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new He),this.L=this.aa=0,this.gd=o([4,2],De),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function We(e,t){return 0>e?0:e>t?t:e}function Ge(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ke(){var e=new Ve;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,na||(na=Je)),e}function qe(e,t,n){return 0==e.a&&(e.a=t,e.sc=n,e.cb=0),0}function Xe(e,t,n){return 3<=n&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Ye(e,n){if(null==e)return 0;if(e.a=0,e.sc="OK",null==n)return qe(e,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,i=n.w,s=n.ha;if(4>s)return qe(e,7,"Truncated header.");var o=r[i+0]|r[i+1]<<8|r[i+2]<<16,l=e.Od;if(l.Rb=!(1&o),l.td=o>>1&7,l.yd=o>>4&1,l.ub=o>>5,3<l.td)return qe(e,3,"Incorrect keyframe parameters.");if(!l.yd)return qe(e,4,"Frame not displayable.");i+=3,s-=3;var c=e.Kc;if(l.Rb){if(7>s)return qe(e,7,"cannot parse picture header");if(!Xe(r,i,s))return qe(e,3,"Bad code word");c.c=16383&(r[i+4]<<8|r[i+3]),c.Td=r[i+4]>>6,c.i=16383&(r[i+6]<<8|r[i+5]),c.Ud=r[i+6]>>6,i+=7,s-=7,e.za=c.c+15>>4,e.Ub=c.i+15>>4,n.width=c.c,n.height=c.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,a((o=e.Pa).jb,0,255,o.jb.length),t(null!=(o=e.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,a(o.Zb,0,0,o.Zb.length),a(o.Lb,0,0,o.Lb)}if(l.ub>s)return qe(e,7,"bad partition length");p(o=e.m,r,i,l.ub),i+=l.ub,s-=l.ub,l.Rb&&(c.Ld=N(o),c.Kd=N(o)),c=e.Qa;var u,h=e.Pa;if(t(null!=o),t(null!=c),c.Cb=N(o),c.Cb){if(c.Bb=N(o),N(o)){for(c.Fb=N(o),u=0;4>u;++u)c.Zb[u]=N(o)?m(o,7):0;for(u=0;4>u;++u)c.Lb[u]=N(o)?m(o,6):0}if(c.Bb)for(u=0;3>u;++u)h.jb[u]=N(o)?f(o,8):255}else c.Bb=0;if(o.Ka)return qe(e,3,"cannot parse segment header");if((c=e.ed).zd=N(o),c.Tb=f(o,6),c.wb=f(o,3),c.Pc=N(o),c.Pc&&N(o)){for(h=0;4>h;++h)N(o)&&(c.vd[h]=m(o,6));for(h=0;4>h;++h)N(o)&&(c.od[h]=m(o,6))}if(e.L=0==c.Tb?0:c.zd?1:2,o.Ka)return qe(e,3,"cannot parse filter header");var d=s;if(s=u=i,i=u+d,c=d,e.Xb=(1<<f(e.m,2))-1,d<3*(h=e.Xb))r=7;else{for(u+=3*h,c-=3*h,d=0;d<h;++d){var A=r[s+0]|r[s+1]<<8|r[s+2]<<16;A>c&&(A=c),p(e.Jc[+d],r,u,A),u+=A,c-=A,s+=3}p(e.Jc[+h],r,u,c),r=u<i?0:5}if(0!=r)return qe(e,r,"cannot parse partitions");for(r=f(u=e.m,7),s=N(u)?m(u,4):0,i=N(u)?m(u,4):0,c=N(u)?m(u,4):0,h=N(u)?m(u,4):0,u=N(u)?m(u,4):0,d=e.Qa,A=0;4>A;++A){if(d.Cb){var g=d.Zb[A];d.Fb||(g+=r)}else{if(0<A){e.pb[A]=e.pb[0];continue}g=r}var y=e.pb[A];y.Sc[0]=ea[We(g+s,127)],y.Sc[1]=ta[We(g+0,127)],y.Eb[0]=2*ea[We(g+i,127)],y.Eb[1]=101581*ta[We(g+c,127)]>>16,8>y.Eb[1]&&(y.Eb[1]=8),y.Qc[0]=ea[We(g+h,117)],y.Qc[1]=ta[We(g+u,127)],y.lc=g+u}if(!l.Rb)return qe(e,4,"Not a key frame.");for(N(o),l=e.Pa,r=0;4>r;++r){for(s=0;8>s;++s)for(i=0;3>i;++i)for(c=0;11>c;++c)h=B(o,la[r][s][i][c])?f(o,8):sa[r][s][i][c],l.Wc[r][s].Yb[i][c]=h;for(s=0;17>s;++s)l.Xc[r][s]=l.Wc[r][ca[s]]}return e.kc=N(o),e.kc&&(e.Bd=f(o,8)),e.cb=1}function Je(e,t,n,r,a,i,s){var o=t[a].Yb[n];for(n=0;16>a;++a){if(!B(e,o[n+0]))return a;for(;!B(e,o[n+1]);)if(o=t[++a].Yb[0],n=0,16==a)return 16;var l=t[a+1].Yb;if(B(e,o[n+2])){var c=e,u=0;if(B(c,(d=o)[(h=n)+3]))if(B(c,d[h+6])){for(o=0,h=2*(u=B(c,d[h+8]))+(d=B(c,d[h+9+u])),u=0,d=ra[h];d[o];++o)u+=u+B(c,d[o]);u+=3+(8<<h)}else B(c,d[h+7])?(u=7+2*B(c,165),u+=B(c,145)):u=5+B(c,159);else u=B(c,d[h+4])?3+B(c,d[h+5]):2;o=l[2]}else u=1,o=l[1];l=s+aa[a],0>(c=e).b&&E(c);var h,d=c.b,A=(h=c.Ca>>1)-(c.I>>d)>>31;--c.b,c.Ca+=A,c.Ca|=1,c.I-=(h+1&A)<<d,i[l]=((u^A)-A)*r[(0<a)+0]}return 16}function Ze(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,a(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,t,n,r,a){a=e[t+n+32*r]+(a>>3),e[t+n+32*r]=-256&a?0>a?0:255:a}function et(e,t,n,r,a,i){$e(e,t,0,n,r+a),$e(e,t,1,n,r+i),$e(e,t,2,n,r-i),$e(e,t,3,n,r-a)}function tt(e){return(20091*e>>16)+e}function nt(e,t,n,r){var a,s=0,o=i(16);for(a=0;4>a;++a){var l=e[t+0]+e[t+8],c=e[t+0]-e[t+8],u=(35468*e[t+4]>>16)-tt(e[t+12]),h=tt(e[t+4])+(35468*e[t+12]>>16);o[s+0]=l+h,o[s+1]=c+u,o[s+2]=c-u,o[s+3]=l-h,s+=4,t++}for(a=s=0;4>a;++a)l=(e=o[s+0]+4)+o[s+8],c=e-o[s+8],u=(35468*o[s+4]>>16)-tt(o[s+12]),$e(n,r,0,0,l+(h=tt(o[s+4])+(35468*o[s+12]>>16))),$e(n,r,1,0,c+u),$e(n,r,2,0,c-u),$e(n,r,3,0,l-h),s++,r+=32}function rt(e,t,n,r){var a=e[t+0]+4,i=35468*e[t+4]>>16,s=tt(e[t+4]),o=35468*e[t+1]>>16;et(n,r,0,a+s,e=tt(e[t+1]),o),et(n,r,1,a+i,e,o),et(n,r,2,a-i,e,o),et(n,r,3,a-s,e,o)}function at(e,t,n,r,a){nt(e,t,n,r),a&&nt(e,t+16,n,r+4)}function it(e,t,n,r){ir(e,t+0,n,r,1),ir(e,t+32,n,r+128,1)}function st(e,t,n,r){var a;for(e=e[t+0]+4,a=0;4>a;++a)for(t=0;4>t;++t)$e(n,r,t,a,e)}function ot(e,t,n,r){e[t+0]&&lr(e,t+0,n,r),e[t+16]&&lr(e,t+16,n,r+4),e[t+32]&&lr(e,t+32,n,r+128),e[t+48]&&lr(e,t+48,n,r+128+4)}function lt(e,t,n,r){var a,s=i(16);for(a=0;4>a;++a){var o=e[t+0+a]+e[t+12+a],l=e[t+4+a]+e[t+8+a],c=e[t+4+a]-e[t+8+a],u=e[t+0+a]-e[t+12+a];s[0+a]=o+l,s[8+a]=o-l,s[4+a]=u+c,s[12+a]=u-c}for(a=0;4>a;++a)o=(e=s[0+4*a]+3)+s[3+4*a],l=s[1+4*a]+s[2+4*a],c=s[1+4*a]-s[2+4*a],u=e-s[3+4*a],n[r+0]=o+l>>3,n[r+16]=u+c>>3,n[r+32]=o-l>>3,n[r+48]=u-c>>3,r+=64}function ct(e,t,n){var r,a=t-32,i=Fr,s=255-e[a-1];for(r=0;r<n;++r){var o,l=i,c=s+e[t-1];for(o=0;o<n;++o)e[t+o]=l[c+e[a+o]];t+=32}}function ut(e,t){ct(e,t,4)}function ht(e,t){ct(e,t,8)}function dt(e,t){ct(e,t,16)}function At(e,t){var n;for(n=0;16>n;++n)r(e,t+32*n,e,t-32,16)}function pt(e,t){var n;for(n=16;0<n;--n)a(e,t,e[t-1],16),t+=32}function ft(e,t,n){var r;for(r=0;16>r;++r)a(t,n+32*r,e,16)}function mt(e,t){var n,r=16;for(n=0;16>n;++n)r+=e[t-1+32*n]+e[t+n-32];ft(r>>5,e,t)}function gt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t-1+32*n];ft(r>>4,e,t)}function yt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t+n-32];ft(r>>4,e,t)}function vt(e,t){ft(128,e,t)}function bt(e,t,n){return e+2*t+n+2>>2}function xt(e,t){var n,a=t-32;for(a=new Uint8Array([bt(e[a-1],e[a+0],e[a+1]),bt(e[a+0],e[a+1],e[a+2]),bt(e[a+1],e[a+2],e[a+3]),bt(e[a+2],e[a+3],e[a+4])]),n=0;4>n;++n)r(e,t+32*n,a,0,a.length)}function wt(e,t){var n=e[t-1],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96];k(e,t+0,16843009*bt(e[t-1-32],n,r)),k(e,t+32,16843009*bt(n,r,a)),k(e,t+64,16843009*bt(r,a,i)),k(e,t+96,16843009*bt(a,i,i))}function _t(e,t){var n,r=4;for(n=0;4>n;++n)r+=e[t+n-32]+e[t-1+32*n];for(r>>=3,n=0;4>n;++n)a(e,t+32*n,r,4)}function St(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1-32],s=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+96]=bt(r,a,e[t-1+96]),e[t+1+96]=e[t+0+64]=bt(n,r,a),e[t+2+96]=e[t+1+64]=e[t+0+32]=bt(i,n,r),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=bt(s,i,n),e[t+3+64]=e[t+2+32]=e[t+1+0]=bt(o,s,i),e[t+3+32]=e[t+2+0]=bt(l,o,s),e[t+3+0]=bt(c,l,o)}function Ct(e,t){var n=e[t+1-32],r=e[t+2-32],a=e[t+3-32],i=e[t+4-32],s=e[t+5-32],o=e[t+6-32],l=e[t+7-32];e[t+0+0]=bt(e[t+0-32],n,r),e[t+1+0]=e[t+0+32]=bt(n,r,a),e[t+2+0]=e[t+1+32]=e[t+0+64]=bt(r,a,i),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=bt(a,i,s),e[t+3+32]=e[t+2+64]=e[t+1+96]=bt(i,s,o),e[t+3+64]=e[t+2+96]=bt(s,o,l),e[t+3+96]=bt(o,l,l)}function Et(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1-32],s=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+0]=e[t+1+64]=i+s+1>>1,e[t+1+0]=e[t+2+64]=s+o+1>>1,e[t+2+0]=e[t+3+64]=o+l+1>>1,e[t+3+0]=l+c+1>>1,e[t+0+96]=bt(a,r,n),e[t+0+64]=bt(r,n,i),e[t+0+32]=e[t+1+96]=bt(n,i,s),e[t+1+32]=e[t+2+96]=bt(i,s,o),e[t+2+32]=e[t+3+96]=bt(s,o,l),e[t+3+32]=bt(o,l,c)}function Nt(e,t){var n=e[t+0-32],r=e[t+1-32],a=e[t+2-32],i=e[t+3-32],s=e[t+4-32],o=e[t+5-32],l=e[t+6-32],c=e[t+7-32];e[t+0+0]=n+r+1>>1,e[t+1+0]=e[t+0+64]=r+a+1>>1,e[t+2+0]=e[t+1+64]=a+i+1>>1,e[t+3+0]=e[t+2+64]=i+s+1>>1,e[t+0+32]=bt(n,r,a),e[t+1+32]=e[t+0+96]=bt(r,a,i),e[t+2+32]=e[t+1+96]=bt(a,i,s),e[t+3+32]=e[t+2+96]=bt(i,s,o),e[t+3+64]=bt(s,o,l),e[t+3+96]=bt(o,l,c)}function Bt(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96];e[t+0+0]=n+r+1>>1,e[t+2+0]=e[t+0+32]=r+a+1>>1,e[t+2+32]=e[t+0+64]=a+i+1>>1,e[t+1+0]=bt(n,r,a),e[t+3+0]=e[t+1+32]=bt(r,a,i),e[t+3+32]=e[t+1+64]=bt(a,i,i),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=i}function kt(e,t){var n=e[t-1+0],r=e[t-1+32],a=e[t-1+64],i=e[t-1+96],s=e[t-1-32],o=e[t+0-32],l=e[t+1-32],c=e[t+2-32];e[t+0+0]=e[t+2+32]=n+s+1>>1,e[t+0+32]=e[t+2+64]=r+n+1>>1,e[t+0+64]=e[t+2+96]=a+r+1>>1,e[t+0+96]=i+a+1>>1,e[t+3+0]=bt(o,l,c),e[t+2+0]=bt(s,o,l),e[t+1+0]=e[t+3+32]=bt(n,s,o),e[t+1+32]=e[t+3+64]=bt(r,n,s),e[t+1+64]=e[t+3+96]=bt(a,r,n),e[t+1+96]=bt(i,a,r)}function It(e,t){var n;for(n=0;8>n;++n)r(e,t+32*n,e,t-32,8)}function Tt(e,t){var n;for(n=0;8>n;++n)a(e,t,e[t-1],8),t+=32}function Mt(e,t,n){var r;for(r=0;8>r;++r)a(t,n+32*r,e,8)}function Ft(e,t){var n,r=8;for(n=0;8>n;++n)r+=e[t+n-32]+e[t-1+32*n];Mt(r>>4,e,t)}function Rt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t+n-32];Mt(r>>3,e,t)}function Lt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t-1+32*n];Mt(r>>3,e,t)}function Ut(e,t){Mt(128,e,t)}function Pt(e,t,n){var r=e[t-n],a=e[t+0],i=3*(a-r)+Tr[1020+e[t-2*n]-e[t+n]],s=Mr[112+(i+4>>3)];e[t-n]=Fr[255+r+Mr[112+(i+3>>3)]],e[t+0]=Fr[255+a-s]}function Dt(e,t,n,r){var a=e[t+0],i=e[t+n];return Rr[255+e[t-2*n]-e[t-n]]>r||Rr[255+i-a]>r}function Ot(e,t,n,r){return 4*Rr[255+e[t-n]-e[t+0]]+Rr[255+e[t-2*n]-e[t+n]]<=r}function zt(e,t,n,r,a){var i=e[t-3*n],s=e[t-2*n],o=e[t-n],l=e[t+0],c=e[t+n],u=e[t+2*n],h=e[t+3*n];return 4*Rr[255+o-l]+Rr[255+s-c]>r?0:Rr[255+e[t-4*n]-i]<=a&&Rr[255+i-s]<=a&&Rr[255+s-o]<=a&&Rr[255+h-u]<=a&&Rr[255+u-c]<=a&&Rr[255+c-l]<=a}function Ht(e,t,n,r){var a=2*r+1;for(r=0;16>r;++r)Ot(e,t+r,n,a)&&Pt(e,t+r,n)}function jt(e,t,n,r){var a=2*r+1;for(r=0;16>r;++r)Ot(e,t+r*n,1,a)&&Pt(e,t+r*n,1)}function Qt(e,t,n,r){var a;for(a=3;0<a;--a)Ht(e,t+=4*n,n,r)}function Vt(e,t,n,r){var a;for(a=3;0<a;--a)jt(e,t+=4,n,r)}function Wt(e,t,n,r,a,i,s,o){for(i=2*i+1;0<a--;){if(zt(e,t,n,i,s))if(Dt(e,t,n,o))Pt(e,t,n);else{var l=e,c=t,u=n,h=l[c-2*u],d=l[c-u],A=l[c+0],p=l[c+u],f=l[c+2*u],m=27*(y=Tr[1020+3*(A-d)+Tr[1020+h-p]])+63>>7,g=18*y+63>>7,y=9*y+63>>7;l[c-3*u]=Fr[255+l[c-3*u]+y],l[c-2*u]=Fr[255+h+g],l[c-u]=Fr[255+d+m],l[c+0]=Fr[255+A-m],l[c+u]=Fr[255+p-g],l[c+2*u]=Fr[255+f-y]}t+=r}}function Gt(e,t,n,r,a,i,s,o){for(i=2*i+1;0<a--;){if(zt(e,t,n,i,s))if(Dt(e,t,n,o))Pt(e,t,n);else{var l=e,c=t,u=n,h=l[c-u],d=l[c+0],A=l[c+u],p=Mr[112+(4+(f=3*(d-h))>>3)],f=Mr[112+(f+3>>3)],m=p+1>>1;l[c-2*u]=Fr[255+l[c-2*u]+m],l[c-u]=Fr[255+h+f],l[c+0]=Fr[255+d-p],l[c+u]=Fr[255+A-m]}t+=r}}function Kt(e,t,n,r,a,i){Wt(e,t,n,1,16,r,a,i)}function qt(e,t,n,r,a,i){Wt(e,t,1,n,16,r,a,i)}function Xt(e,t,n,r,a,i){var s;for(s=3;0<s;--s)Gt(e,t+=4*n,n,1,16,r,a,i)}function Yt(e,t,n,r,a,i){var s;for(s=3;0<s;--s)Gt(e,t+=4,1,n,16,r,a,i)}function Jt(e,t,n,r,a,i,s,o){Wt(e,t,a,1,8,i,s,o),Wt(n,r,a,1,8,i,s,o)}function Zt(e,t,n,r,a,i,s,o){Wt(e,t,1,a,8,i,s,o),Wt(n,r,1,a,8,i,s,o)}function $t(e,t,n,r,a,i,s,o){Gt(e,t+4*a,a,1,8,i,s,o),Gt(n,r+4*a,a,1,8,i,s,o)}function en(e,t,n,r,a,i,s,o){Gt(e,t+4,1,a,8,i,s,o),Gt(n,r+4,1,a,8,i,s,o)}function tn(){this.ba=new se,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new le,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function rn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function an(){this.ua=0,this.Wa=new L,this.vb=new L,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new A,this.yc=new h}function sn(){this.xb=this.a=0,this.l=new Ge,this.ca=new se,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new x,this.Pb=0,this.wd=new x,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new an,this.ab=0,this.gc=s(4,rn),this.Oc=0}function on(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ge,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(e,t,n,r,a,i,s){for(e=null==e?0:e[t+0],t=0;t<s;++t)a[i+t]=e+n[r+t]&255,e=a[i+t]}function cn(e,t,n,r,a,i,s){var o;if(null==e)ln(null,null,n,r,a,i,s);else for(o=0;o<s;++o)a[i+o]=e[t+o]+n[r+o]&255}function un(e,t,n,r,a,i,s){if(null==e)ln(null,null,n,r,a,i,s);else{var o,l=e[t+0],c=l,u=l;for(o=0;o<s;++o)c=u+(l=e[t+o])-c,u=n[r+o]+(-256&c?0>c?0:255:c)&255,c=l,a[i+o]=u}}function hn(e,n,a,s){var o=n.width,l=n.o;if(t(null!=e&&null!=n),0>a||0>=s||a+s>l)return null;if(!e.Cc){if(null==e.ga){var c;if(e.ga=new on,(c=null==e.ga)||(c=n.width*n.o,t(0==e.Gb.length),e.Gb=i(c),e.Uc=0,null==e.Gb?c=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,c=1),c=!c),!c){c=e.ga;var u=e.Fa,h=e.P,d=e.qc,A=e.mb,p=e.nb,f=h+1,m=d-1,y=c.l;if(t(null!=u&&null!=A&&null!=n),fa[0]=null,fa[1]=ln,fa[2]=cn,fa[3]=un,c.ca=A,c.tb=p,c.c=n.width,c.i=n.height,t(0<c.c&&0<c.i),1>=d)n=0;else if(c.$a=3&u[h+0],c.Z=u[h+0]>>2&3,c.Lc=u[h+0]>>4&3,h=u[h+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||h)n=0;else if(y.put=Ae,y.ac=de,y.bc=pe,y.ma=c,y.width=n.width,y.height=n.height,y.Da=n.Da,y.v=n.v,y.va=n.va,y.j=n.j,y.o=n.o,c.$a)e:{t(1==c.$a),n=Be();t:for(;;){if(null==n){n=0;break e}if(t(null!=c),c.mc=n,n.c=c.c,n.i=c.i,n.l=c.l,n.l.ma=c,n.l.width=c.c,n.l.height=c.i,n.a=0,g(n.m,u,f,m),!ke(c.c,c.i,1,n,null))break t;if(1==n.ab&&3==n.gc[0].hc&&_e(n.s)?(c.ic=1,u=n.c*n.i,n.Ta=null,n.Ua=0,n.V=i(u),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(c.ic=0,n=Ie(n,c.c)),!n)break t;n=1;break e}c.mc=null,n=0}else n=m>=c.c*c.i;c=!n}if(c)return null;1!=e.ga.Lc?e.Ga=0:s=l-a}t(null!=e.ga),t(a+s<=l);e:{if(n=(u=e.ga).c,l=u.l.o,0==u.$a){if(f=e.rc,m=e.Vc,y=e.Fa,h=e.P+1+a*n,d=e.mb,A=e.nb+a*n,t(h<=e.P+e.qc),0!=u.Z)for(t(null!=fa[u.Z]),c=0;c<s;++c)fa[u.Z](f,m,y,h,d,A,n),f=d,m=A,A+=n,h+=n;else for(c=0;c<s;++c)r(d,A,y,h,n),f=d,m=A,A+=n,h+=n;e.rc=f,e.Vc=m}else{if(t(null!=u.mc),n=a+s,t(null!=(c=u.mc)),t(n<=c.i),c.C>=n)n=1;else if(u.ic||mn(),u.ic){u=c.V,f=c.Ba,m=c.c;var v=c.i,b=(y=1,h=c.$/m,d=c.$%m,A=c.m,p=c.s,c.$),x=m*v,w=m*n,S=p.wc,E=b<w?be(p,d,h):null;t(b<=x),t(n<=v),t(_e(p));t:for(;;){for(;!A.h&&b<w;){if(d&S||(E=be(p,d,h)),t(null!=E),C(A),256>(v=ye(E.G[0],E.H[0],A)))u[f+b]=v,++b,++d>=m&&(d=0,++h<=n&&!(h%16)&&Ce(c,h));else{if(!(280>v)){y=0;break t}v=me(v-256,A);var N,B=ye(E.G[4],E.H[4],A);if(C(A),!(b>=(B=ge(m,B=me(B,A)))&&x-b>=v)){y=0;break t}for(N=0;N<v;++N)u[f+b+N]=u[f+b+N-B];for(b+=v,d+=v;d>=m;)d-=m,++h<=n&&!(h%16)&&Ce(c,h);b<w&&d&S&&(E=be(p,d,h))}t(A.h==_(A))}Ce(c,h>n?n:h);break t}!y||A.h&&b<x?(y=0,c.a=A.h?5:3):c.$=b,n=y}else n=Ee(c,c.V,c.Ba,c.c,c.i,n,Te);if(!n){s=0;break e}}a+s>=l&&(e.Cc=1),s=1}if(!s)return null;if(e.Cc&&(null!=(s=e.ga)&&(s.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+a*o}function dn(e,t,n,r,a,i){for(;0<a--;){var s,o=e,l=t+(n?1:0),c=e,u=t+(n?0:3);for(s=0;s<r;++s){var h=c[u+4*s];255!=h&&(h*=32897,o[l+4*s+0]=o[l+4*s+0]*h>>23,o[l+4*s+1]=o[l+4*s+1]*h>>23,o[l+4*s+2]=o[l+4*s+2]*h>>23)}t+=i}}function An(e,t,n,r,a){for(;0<r--;){var i;for(i=0;i<n;++i){var s=e[t+2*i+0],o=15&(c=e[t+2*i+1]),l=4369*o,c=(240&c|c>>4)*l>>16;e[t+2*i+0]=(240&s|s>>4)*l>>16&240|(15&s|s<<4)*l>>16>>4&15,e[t+2*i+1]=240&c|o}t+=a}}function pn(e,t,n,r,a,i,s,o){var l,c,u=255;for(c=0;c<a;++c){for(l=0;l<r;++l){var h=e[t+l];i[s+4*l]=h,u&=h}t+=n,s+=o}return 255!=u}function fn(e,t,n,r,a){var i;for(i=0;i<a;++i)n[r+i]=e[t+i]>>8}function mn(){wr=dn,_r=An,Sr=pn,Cr=fn}function gn(n,r,a){e[n]=function(e,n,i,s,o,l,c,u,h,d,A,p,f,m,g,y,v){var b,x=v-1>>1,w=o[l+0]|c[u+0]<<16,_=h[d+0]|A[p+0]<<16;t(null!=e);var S=3*w+_+131074>>2;for(r(e[n+0],255&S,S>>16,f,m),null!=i&&(S=3*_+w+131074>>2,r(i[s+0],255&S,S>>16,g,y)),b=1;b<=x;++b){var C=o[l+b]|c[u+b]<<16,E=h[d+b]|A[p+b]<<16,N=w+C+_+E+524296,B=N+2*(C+_)>>3;S=B+w>>1,w=(N=N+2*(w+E)>>3)+C>>1,r(e[n+2*b-1],255&S,S>>16,f,m+(2*b-1)*a),r(e[n+2*b-0],255&w,w>>16,f,m+(2*b-0)*a),null!=i&&(S=N+_>>1,w=B+E>>1,r(i[s+2*b-1],255&S,S>>16,g,y+(2*b-1)*a),r(i[s+2*b+0],255&w,w>>16,g,y+(2*b+0)*a)),w=C,_=E}1&v||(S=3*w+_+131074>>2,r(e[n+v-1],255&S,S>>16,f,m+(v-1)*a),null!=i&&(S=3*_+w+131074>>2,r(i[s+v-1],255&S,S>>16,g,y+(v-1)*a)))}}function yn(){ma[Lr]=ga,ma[Ur]=va,ma[Pr]=ya,ma[Dr]=ba,ma[Or]=xa,ma[zr]=wa,ma[Hr]=_a,ma[jr]=va,ma[Qr]=ba,ma[Vr]=xa,ma[Wr]=wa}function vn(e){return e&~ka?0>e?0:255:e>>Ba}function bn(e,t){return vn((19077*e>>8)+(26149*t>>8)-14234)}function xn(e,t,n){return vn((19077*e>>8)-(6419*t>>8)-(13320*n>>8)+8708)}function wn(e,t){return vn((19077*e>>8)+(33050*t>>8)-17685)}function _n(e,t,n,r,a){r[a+0]=bn(e,n),r[a+1]=xn(e,t,n),r[a+2]=wn(e,t)}function Sn(e,t,n,r,a){r[a+0]=wn(e,t),r[a+1]=xn(e,t,n),r[a+2]=bn(e,n)}function Cn(e,t,n,r,a){var i=xn(e,t,n);t=i<<3&224|wn(e,t)>>3,r[a+0]=248&bn(e,n)|i>>5,r[a+1]=t}function En(e,t,n,r,a){var i=240&wn(e,t)|15;r[a+0]=240&bn(e,n)|xn(e,t,n)>>4,r[a+1]=i}function Nn(e,t,n,r,a){r[a+0]=255,_n(e,t,n,r,a+1)}function Bn(e,t,n,r,a){Sn(e,t,n,r,a),r[a+3]=255}function kn(e,t,n,r,a){_n(e,t,n,r,a),r[a+3]=255}function We(e,t){return 0>e?0:e>t?t:e}function In(t,n,r){e[t]=function(e,t,a,i,s,o,l,c,u){for(var h=c+(-2&u)*r;c!=h;)n(e[t+0],a[i+0],s[o+0],l,c),n(e[t+1],a[i+0],s[o+0],l,c+r),t+=2,++i,++o,c+=2*r;1&u&&n(e[t+0],a[i+0],s[o+0],l,c)}}function Tn(e,t,n){return 0==n?0==e?0==t?6:5:0==t?4:0:n}function Mn(e,t,n,r,a){switch(e>>>30){case 3:ir(t,n,r,a,0);break;case 2:sr(t,n,r,a);break;case 1:lr(t,n,r,a)}}function Fn(e,t){var n,i,s=t.M,o=t.Nb,l=e.oc,c=e.pc+40,u=e.oc,h=e.pc+584,d=e.oc,A=e.pc+600;for(n=0;16>n;++n)l[c+32*n-1]=129;for(n=0;8>n;++n)u[h+32*n-1]=129,d[A+32*n-1]=129;for(0<s?l[c-1-32]=u[h-1-32]=d[A-1-32]=129:(a(l,c-32-1,127,21),a(u,h-32-1,127,9),a(d,A-32-1,127,9)),i=0;i<e.za;++i){var p=t.ya[t.aa+i];if(0<i){for(n=-1;16>n;++n)r(l,c+32*n-4,l,c+32*n+12,4);for(n=-1;8>n;++n)r(u,h+32*n-4,u,h+32*n+4,4),r(d,A+32*n-4,d,A+32*n+4,4)}var f=e.Gd,m=e.Hd+i,g=p.ad,y=p.Hc;if(0<s&&(r(l,c-32,f[m].y,0,16),r(u,h-32,f[m].f,0,8),r(d,A-32,f[m].ea,0,8)),p.Za){var v=l,b=c-32+16;for(0<s&&(i>=e.za-1?a(v,b,f[m].y[15],4):r(v,b,f[m+1].y,0,4)),n=0;4>n;n++)v[b+128+n]=v[b+256+n]=v[b+384+n]=v[b+0+n];for(n=0;16>n;++n,y<<=2)v=l,b=c+Pa[n],ha[p.Ob[n]](v,b),Mn(y,g,16*+n,v,b)}else if(v=Tn(i,s,p.Ob[0]),ua[v](l,c),0!=y)for(n=0;16>n;++n,y<<=2)Mn(y,g,16*+n,l,c+Pa[n]);for(n=p.Gc,v=Tn(i,s,p.Dd),da[v](u,h),da[v](d,A),y=g,v=u,b=h,255&(p=0|n)&&(170&p?or(y,256,v,b):cr(y,256,v,b)),p=d,y=A,255&(n>>=8)&&(170&n?or(g,320,p,y):cr(g,320,p,y)),s<e.Ub-1&&(r(f[m].y,0,l,c+480,16),r(f[m].f,0,u,h+224,8),r(f[m].ea,0,d,A+224,8)),n=8*o*e.B,f=e.sa,m=e.ta+16*i+16*o*e.R,g=e.qa,p=e.ra+8*i+n,y=e.Ha,v=e.Ia+8*i+n,n=0;16>n;++n)r(f,m+n*e.R,l,c+32*n,16);for(n=0;8>n;++n)r(g,p+n*e.B,u,h+32*n,8),r(y,v+n*e.B,d,A+32*n,8)}}function Rn(e,r,a,i,s,o,l,c,u){var h=[0],d=[0],A=0,p=null!=u?u.kd:0,f=null!=u?u:new nn;if(null==e||12>a)return 7;f.data=e,f.w=r,f.ha=a,r=[r],a=[a],f.gb=[f.gb];e:{var m=r,y=a,v=f.gb;if(t(null!=e),t(null!=y),t(null!=v),v[0]=0,12<=y[0]&&!n(e,m[0],"RIFF")){if(n(e,m[0]+8,"WEBP")){v=3;break e}var b=M(e,m[0]+4);if(12>b||4294967286<b){v=3;break e}if(p&&b>y[0]-8){v=7;break e}v[0]=b,m[0]+=12,y[0]-=12}v=0}if(0!=v)return v;for(b=0<f.gb[0],a=a[0];;){e:{var w=e;y=r,v=a;var _=h,S=d,C=m=[0];if((B=A=[A])[0]=0,8>v[0])v=7;else{if(!n(w,y[0],"VP8X")){if(10!=M(w,y[0]+4)){v=3;break e}if(18>v[0]){v=7;break e}var E=M(w,y[0]+8),N=1+T(w,y[0]+12);if(2147483648<=N*(w=1+T(w,y[0]+15))){v=3;break e}null!=C&&(C[0]=E),null!=_&&(_[0]=N),null!=S&&(S[0]=w),y[0]+=18,v[0]-=18,B[0]=1}v=0}}if(A=A[0],m=m[0],0!=v)return v;if(y=!!(2&m),!b&&A)return 3;if(null!=o&&(o[0]=!!(16&m)),null!=l&&(l[0]=y),null!=c&&(c[0]=0),l=h[0],m=d[0],A&&y&&null==u){v=0;break}if(4>a){v=7;break}if(b&&A||!b&&!A&&!n(e,r[0],"ALPH")){a=[a],f.na=[f.na],f.P=[f.P],f.Sa=[f.Sa];e:{E=e,v=r,b=a;var B=f.gb;_=f.na,S=f.P,C=f.Sa,N=22,t(null!=E),t(null!=b),w=v[0];var k=b[0];for(t(null!=_),t(null!=C),_[0]=null,S[0]=null,C[0]=0;;){if(v[0]=w,b[0]=k,8>k){v=7;break e}var I=M(E,w+4);if(4294967286<I){v=3;break e}var F=8+I+1&-2;if(N+=F,0<B&&N>B){v=3;break e}if(!n(E,w,"VP8 ")||!n(E,w,"VP8L")){v=0;break e}if(k[0]<F){v=7;break e}n(E,w,"ALPH")||(_[0]=E,S[0]=w+8,C[0]=I),w+=F,k-=F}}if(a=a[0],f.na=f.na[0],f.P=f.P[0],f.Sa=f.Sa[0],0!=v)break}a=[a],f.Ja=[f.Ja],f.xa=[f.xa];e:if(B=e,v=r,b=a,_=f.gb[0],S=f.Ja,C=f.xa,E=v[0],w=!n(B,E,"VP8 "),N=!n(B,E,"VP8L"),t(null!=B),t(null!=b),t(null!=S),t(null!=C),8>b[0])v=7;else{if(w||N){if(B=M(B,E+4),12<=_&&B>_-12){v=3;break e}if(p&&B>b[0]-8){v=7;break e}S[0]=B,v[0]+=8,b[0]-=8,C[0]=N}else C[0]=5<=b[0]&&47==B[E+0]&&!(B[E+4]>>5),S[0]=b[0];v=0}if(a=a[0],f.Ja=f.Ja[0],f.xa=f.xa[0],r=r[0],0!=v)break;if(4294967286<f.Ja)return 3;if(null==c||y||(c[0]=f.xa?2:1),l=[l],m=[m],f.xa){if(5>a){v=7;break}c=l,p=m,y=o,null==e||5>a?e=0:5<=a&&47==e[r+0]&&!(e[r+4]>>5)?(b=[0],B=[0],_=[0],g(S=new x,e,r,a),fe(S,b,B,_)?(null!=c&&(c[0]=b[0]),null!=p&&(p[0]=B[0]),null!=y&&(y[0]=_[0]),e=1):e=0):e=0}else{if(10>a){v=7;break}c=m,null==e||10>a||!Xe(e,r+3,a-3)?e=0:(p=e[r+0]|e[r+1]<<8|e[r+2]<<16,y=16383&(e[r+7]<<8|e[r+6]),e=16383&(e[r+9]<<8|e[r+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=f.Ja||!y||!e?e=0:(l&&(l[0]=y),c&&(c[0]=e),e=1))}if(!e)return 3;if(l=l[0],m=m[0],A&&(h[0]!=l||d[0]!=m))return 3;null!=u&&(u[0]=f,u.offset=r-u.w,t(4294967286>r-u.w),t(u.offset==u.ha-a));break}return 0==v||7==v&&A&&null==u?(null!=o&&(o[0]|=null!=f.na&&0<f.na.length),null!=i&&(i[0]=l),null!=s&&(s[0]=m),0):v}function Ln(e,t,n){var r=t.width,a=t.height,i=0,s=0,o=r,l=a;if(t.Da=null!=e&&0<e.Da,t.Da&&(o=e.cd,l=e.bd,i=e.v,s=e.j,11>n||(i&=-2,s&=-2),0>i||0>s||0>=o||0>=l||i+o>r||s+l>a))return 0;if(t.v=i,t.j=s,t.va=i+o,t.o=s+l,t.U=o,t.T=l,t.da=null!=e&&0<e.da,t.da){if(!U(o,l,n=[e.ib],i=[e.hb]))return 0;t.ib=n[0],t.hb=i[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*r/4&&t.hb<3*a/4,t.Kb=0),1}function Un(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Pn(e,t,n,r){if(null==r||0>=e||0>=t)return 2;if(null!=n){if(n.Da){var a=n.cd,s=n.bd,o=-2&n.v,l=-2&n.j;if(0>o||0>l||0>=a||0>=s||o+a>e||l+s>t)return 2;e=a,t=s}if(n.da){if(!U(e,t,a=[n.ib],s=[n.hb]))return 2;e=a[0],t=s[0]}}r.width=e,r.height=t;e:{var c=r.width,u=r.height;if(e=r.S,0>=c||0>=u||!(e>=Lr&&13>e))e=2;else{if(0>=r.Rd&&null==r.sd){o=s=a=t=0;var h=(l=c*za[e])*u;if(11>e||(s=(u+1)/2*(t=(c+1)/2),12==e&&(o=(a=c)*u)),null==(u=i(h+2*s+o))){e=1;break e}r.sd=u,11>e?((c=r.f.RGBA).eb=u,c.fb=0,c.A=l,c.size=h):((c=r.f.kb).y=u,c.O=0,c.fa=l,c.Fd=h,c.f=u,c.N=0+h,c.Ab=t,c.Cd=s,c.ea=u,c.W=0+h+s,c.Db=t,c.Ed=s,12==e&&(c.F=u,c.J=0+h+2*s),c.Tc=o,c.lb=a)}if(t=1,a=r.S,s=r.width,o=r.height,a>=Lr&&13>a)if(11>a)e=r.f.RGBA,t&=(l=Math.abs(e.A))*(o-1)+s<=e.size,t&=l>=s*za[a],t&=null!=e.eb;else{e=r.f.kb,l=(s+1)/2,h=(o+1)/2,c=Math.abs(e.fa),u=Math.abs(e.Ab);var d=Math.abs(e.Db),A=Math.abs(e.lb),p=A*(o-1)+s;t&=c*(o-1)+s<=e.Fd,t&=u*(h-1)+l<=e.Cd,t=(t&=d*(h-1)+l<=e.Ed)&c>=s&u>=l&d>=l,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==a&&(t&=A>=s,t&=p<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=n&&n.fd&&(e=Un(r)),e}var Dn=64,On=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],zn=24,Hn=32,jn=8,Qn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];O("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,n){return t[n+0]},e.Predictor3=function(e,t,n){return t[n+1]},e.Predictor4=function(e,t,n){return t[n-1]},e.Predictor5=function(e,t,n){return H(H(e,t[n+1]),t[n+0])},e.Predictor6=function(e,t,n){return H(e,t[n-1])},e.Predictor7=function(e,t,n){return H(e,t[n+0])},e.Predictor8=function(e,t,n){return H(t[n-1],t[n+0])},e.Predictor9=function(e,t,n){return H(t[n+0],t[n+1])},e.Predictor10=function(e,t,n){return H(H(e,t[n-1]),H(t[n+0],t[n+1]))},e.Predictor11=function(e,t,n){var r=t[n+0];return 0>=V(r>>24&255,e>>24&255,(t=t[n-1])>>24&255)+V(r>>16&255,e>>16&255,t>>16&255)+V(r>>8&255,e>>8&255,t>>8&255)+V(255&r,255&e,255&t)?r:e},e.Predictor12=function(e,t,n){var r=t[n+0];return(j((e>>24&255)+(r>>24&255)-((t=t[n-1])>>24&255))<<24|j((e>>16&255)+(r>>16&255)-(t>>16&255))<<16|j((e>>8&255)+(r>>8&255)-(t>>8&255))<<8|j((255&e)+(255&r)-(255&t)))>>>0},e.Predictor13=function(e,t,n){var r=t[n-1];return(Q((e=H(e,t[n+0]))>>24&255,r>>24&255)<<24|Q(e>>16&255,r>>16&255)<<16|Q(e>>8&255,r>>8&255)<<8|Q(255&e,255&r))>>>0};var Vn=e.PredictorAdd0;e.PredictorAdd1=W,O("Predictor2","PredictorAdd2"),O("Predictor3","PredictorAdd3"),O("Predictor4","PredictorAdd4"),O("Predictor5","PredictorAdd5"),O("Predictor6","PredictorAdd6"),O("Predictor7","PredictorAdd7"),O("Predictor8","PredictorAdd8"),O("Predictor9","PredictorAdd9"),O("Predictor10","PredictorAdd10"),O("Predictor11","PredictorAdd11"),O("Predictor12","PredictorAdd12"),O("Predictor13","PredictorAdd13");var Wn=e.PredictorAdd2;X("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),X("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Gn,Kn=e.ColorIndexInverseTransform,qn=e.MapARGB,Xn=e.VP8LColorIndexInverseTransformAlpha,Yn=e.MapAlpha,Jn=e.VP8LPredictorsAdd=[];Jn.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Zn,$n,er,tr,nr,rr,ar,ir,sr,or,lr,cr,ur,hr,dr,Ar,pr,fr,mr,gr,yr,vr,br,xr,wr,_r,Sr,Cr,Er=i(511),Nr=i(2041),Br=i(225),kr=i(767),Ir=0,Tr=Nr,Mr=Br,Fr=kr,Rr=Er,Lr=0,Ur=1,Pr=2,Dr=3,Or=4,zr=5,Hr=6,jr=7,Qr=8,Vr=9,Wr=10,Gr=[2,3,7],Kr=[3,3,11],qr=[280,256,256,256,40],Xr=[0,1,1,1,0],Yr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Jr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Zr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$r=8,ea=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ta=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],na=null,ra=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],aa=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ia=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],sa=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],oa=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],la=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ca=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ua=[],ha=[],da=[],Aa=1,pa=2,fa=[],ma=[];gn("UpsampleRgbLinePair",_n,3),gn("UpsampleBgrLinePair",Sn,3),gn("UpsampleRgbaLinePair",kn,4),gn("UpsampleBgraLinePair",Bn,4),gn("UpsampleArgbLinePair",Nn,4),gn("UpsampleRgba4444LinePair",En,2),gn("UpsampleRgb565LinePair",Cn,2);var ga=e.UpsampleRgbLinePair,ya=e.UpsampleBgrLinePair,va=e.UpsampleRgbaLinePair,ba=e.UpsampleBgraLinePair,xa=e.UpsampleArgbLinePair,wa=e.UpsampleRgba4444LinePair,_a=e.UpsampleRgb565LinePair,Sa=16,Ca=1<<Sa-1,Ea=-227,Na=482,Ba=6,ka=(256<<Ba)-1,Ia=0,Ta=i(256),Ma=i(256),Fa=i(256),Ra=i(256),La=i(Na-Ea),Ua=i(Na-Ea);In("YuvToRgbRow",_n,3),In("YuvToBgrRow",Sn,3),In("YuvToRgbaRow",kn,4),In("YuvToBgraRow",Bn,4),In("YuvToArgbRow",Nn,4),In("YuvToRgba4444Row",En,2),In("YuvToRgb565Row",Cn,2);var Pa=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Da=[0,2,8],Oa=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(e,n,o,l,c){var u=Ur,h=new tn,d=new se;h.ba=d,d.S=u,d.width=[d.width],d.height=[d.height];var A=d.width,p=d.height,f=new oe;if(null==f||null==e)var m=2;else t(null!=f),m=Rn(e,n,o,f.width,f.height,f.Pd,f.Qd,f.format,null);if(0!=m?A=0:(null!=A&&(A[0]=f.width[0]),null!=p&&(p[0]=f.height[0]),A=1),A){d.width=d.width[0],d.height=d.height[0],null!=l&&(l[0]=d.width),null!=c&&(c[0]=d.height);e:{if(l=new Ge,(c=new nn).data=e,c.w=n,c.ha=o,c.kd=1,n=[0],t(null!=c),(0==(e=Rn(c.data,c.w,c.ha,null,null,null,n,null,c))||7==e)&&n[0]&&(e=4),0==(n=e)){if(t(null!=h),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=Ae,l.ac=de,l.bc=pe,l.ma=h,c.xa){if(null==(e=Be())){h=1;break e}if(function(e,n){var r=[0],a=[0],i=[0];t:for(;;){if(null==e)return 0;if(null==n)return e.a=2,0;if(e.l=n,e.a=0,g(e.m,n.data,n.w,n.ha),!fe(e.m,r,a,i)){e.a=3;break t}if(e.xb=pa,n.width=r[0],n.height=a[0],!ke(r[0],a[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,l)){if(l=0==(n=Pn(l.width,l.height,h.Oa,h.ba))){t:{l=e;n:for(;;){if(null==l){l=0;break t}if(t(null!=l.s.yc),t(null!=l.s.Ya),t(0<l.s.Wb),t(null!=(o=l.l)),t(null!=(c=o.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,t(null!=l.ca),!Ln(c.Oa,o,Dr)){l.a=2;break n}if(!Ie(l,o.width))break n;if(o.da)break n;if((o.da||re(l.ca.S))&&mn(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&mn()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!F(l.s.vb,l.s.Wa.Xa)){l.a=1;break n}l.xb=0}if(!Ee(l,l.V,l.Ba,l.c,l.i,o.o,we))break n;c.Dc=l.Ma,l=1;break t}t(0!=l.a),l=0}l=!l}l&&(n=e.a)}else n=e.a}else{if(null==(e=new Ke)){h=1;break e}if(e.Fa=c.na,e.P=c.P,e.qc=c.Sa,Ye(e,l)){if(0==(n=Pn(l.width,l.height,h.Oa,h.ba))){if(e.Aa=0,o=h.Oa,t(null!=(c=e)),null!=o){if(0<(A=0>(A=o.Md)?0:100<A?255:255*A/100)){for(p=f=0;4>p;++p)12>(m=c.pb[p]).lc&&(m.ia=A*Oa[0>m.lc?0:m.lc]>>3),f|=m.ia;f&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=o.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(e,n){if(null==e)return 0;if(null==n)return qe(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Ye(e,n))return 0;if(t(e.cb),null==n.ac||n.ac(n)){n.ob&&(e.L=0);var o=Da[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=n.v-o>>4,e.zb=n.j-o>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=n.o+15+o>>4,e.Hb=n.va+15+o>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var l=e.ed;for(o=0;4>o;++o){var c;if(e.Qa.Cb){var u=e.Qa.Lb[o];e.Qa.Fb||(u+=l.Tb)}else u=l.Tb;for(c=0;1>=c;++c){var h=e.gd[o][c],d=u;if(l.Pc&&(d+=l.vd[0],c&&(d+=l.od[0])),0<(d=0>d?0:63<d?63:d)){var A=d;0<l.wb&&(A=4<l.wb?A>>2:A>>1)>9-l.wb&&(A=9-l.wb),1>A&&(A=1),h.dd=A,h.tc=2*d+A,h.ld=40<=d?2:15<=d?1:0}else h.tc=0;h.La=c}}}o=0}else qe(e,6,"Frame setup failed"),o=e.a;if(o=0==o){if(o){e.$c=0,0<e.Aa||(e.Ic=1);t:{o=e.Ic,l=4*(A=e.za);var p=32*A,f=A+1,m=0<e.L?A*(0<e.Aa?2:1):0,g=(2==e.Aa?2:1)*A;if((h=l+832+(c=3*(16*o+Da[e.L])/2*p)+(u=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=h)o=0;else{if(h>e.Vb){if(e.Vb=0,e.Ec=i(h),e.Fc=0,null==e.Ec){o=qe(e,1,"no memory during frame initialization.");break t}e.Vb=h}h=e.Ec,d=e.Fc,e.Ac=h,e.Bc=d,d+=l,e.Gd=s(p,Qe),e.Hd=0,e.rb=s(f+1,Oe),e.sb=1,e.wa=m?s(m,De):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=A),t(!0),e.oc=h,e.pc=d,d+=832,e.ya=s(g,He),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=A),e.R=16*A,e.B=8*A,A=(p=Da[e.L])*e.R,p=p/2*e.B,e.sa=h,e.ta=d+A,e.qa=e.sa,e.ra=e.ta+16*o*e.R+p,e.Ha=e.qa,e.Ia=e.ra+8*o*e.B+p,e.$c=0,d+=c,e.mb=u?h:null,e.nb=u?d:null,t(d+u<=e.Fc+e.Vb),Ze(e),a(e.Ac,e.Bc,0,l),o=1}}if(o){if(n.ka=0,n.y=e.sa,n.O=e.ta,n.f=e.qa,n.N=e.ra,n.ea=e.Ha,n.Vd=e.Ia,n.fa=e.R,n.Rc=e.B,n.F=null,n.J=0,!Ir){for(o=-255;255>=o;++o)Er[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)Nr[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)Br[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)kr[255+o]=0>o?0:255<o?255:o;Ir=1}ar=lt,ir=at,or=it,lr=st,cr=ot,sr=rt,ur=Kt,hr=qt,dr=Jt,Ar=Zt,pr=Xt,fr=Yt,mr=$t,gr=en,yr=Ht,vr=jt,br=Qt,xr=Vt,ha[0]=_t,ha[1]=ut,ha[2]=xt,ha[3]=wt,ha[4]=St,ha[5]=Et,ha[6]=Ct,ha[7]=Nt,ha[8]=kt,ha[9]=Bt,ua[0]=mt,ua[1]=dt,ua[2]=At,ua[3]=pt,ua[4]=gt,ua[5]=yt,ua[6]=vt,da[0]=Ft,da[1]=ht,da[2]=It,da[3]=Tt,da[4]=Lt,da[5]=Rt,da[6]=Ut,o=1}else o=0}o&&(o=function(e,n){for(e.M=0;e.M<e.Va;++e.M){var s,o=e.Jc[e.M&e.Xb],l=e.m,c=e;for(s=0;s<c.za;++s){var u=l,h=c,d=h.Ac,A=h.Bc+4*s,p=h.zc,f=h.ya[h.aa+s];if(h.Qa.Bb?f.$b=B(u,h.Pa.jb[0])?2+B(u,h.Pa.jb[2]):B(u,h.Pa.jb[1]):f.$b=0,h.kc&&(f.Ad=B(u,h.Bd)),f.Za=!B(u,145)+0,f.Za){var m=f.Ob,g=0;for(h=0;4>h;++h){var y,v=p[0+h];for(y=0;4>y;++y){v=oa[d[A+y]][v];for(var b=ia[B(u,v[0])];0<b;)b=ia[2*b+B(u,v[b])];v=-b,d[A+y]=v}r(m,g,d,A,4),g+=4,p[0+h]=v}}else v=B(u,156)?B(u,128)?1:3:B(u,163)?2:0,f.Ob[0]=v,a(d,A,v,4),a(p,0,v,4);f.Dd=B(u,142)?B(u,114)?B(u,183)?1:3:2:0}if(c.m.Ka)return qe(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(c=o,u=(l=e).rb[l.sb-1],d=l.rb[l.sb+l.ja],s=l.ya[l.aa+l.ja],A=l.kc?s.Ad:0)u.la=d.la=0,s.Za||(u.Na=d.Na=0),s.Hc=0,s.Gc=0,s.ia=0;else{var x,w;if(u=d,d=c,A=l.Pa.Xc,p=l.ya[l.aa+l.ja],f=l.pb[p.$b],h=p.ad,m=0,g=l.rb[l.sb-1],v=y=0,a(h,m,0,384),p.Za)var _=0,S=A[3];else{b=i(16);var C=u.Na+g.Na;if(C=na(d,A[1],C,f.Eb,0,b,0),u.Na=g.Na=(0<C)+0,1<C)ar(b,0,h,m);else{var E=b[0]+3>>3;for(b=0;256>b;b+=16)h[m+b]=E}_=1,S=A[0]}var N=15&u.la,k=15&g.la;for(b=0;4>b;++b){var I=1&k;for(E=w=0;4>E;++E)N=N>>1|(I=(C=na(d,S,C=I+(1&N),f.Sc,_,h,m))>_)<<7,w=w<<2|(3<C?3:1<C?2:0!=h[m+0]),m+=16;N>>=4,k=k>>1|I<<7,y=(y<<8|w)>>>0}for(S=N,_=k>>4,x=0;4>x;x+=2){for(w=0,N=u.la>>4+x,k=g.la>>4+x,b=0;2>b;++b){for(I=1&k,E=0;2>E;++E)C=I+(1&N),N=N>>1|(I=0<(C=na(d,A[2],C,f.Qc,0,h,m)))<<3,w=w<<2|(3<C?3:1<C?2:0!=h[m+0]),m+=16;N>>=2,k=k>>1|I<<5}v|=w<<4*x,S|=N<<4<<x,_|=(240&k)<<x}u.la=S,g.la=_,p.Hc=y,p.Gc=v,p.ia=43690&v?0:f.ia,A=!(y|v)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[s.$b][s.Za],l.wa[l.Y+l.ja].La|=!A),c.Ka)return qe(e,7,"Premature end-of-file encountered.")}if(Ze(e),l=n,c=1,s=(o=e).D,u=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)t:{if(s.M=o.M,s.uc=u,Fn(o,s),c=1,s=(w=o.D).Nb,u=(v=Da[o.L])*o.R,d=v/2*o.B,b=16*s*o.R,E=8*s*o.B,A=o.sa,p=o.ta-u+b,f=o.qa,h=o.ra-d+E,m=o.Ha,g=o.Ia-d+E,k=0==(N=w.M),y=N>=o.Va-1,2==o.Aa&&Fn(o,w),w.uc)for(I=(C=o).D.M,t(C.D.uc),w=C.yb;w<C.Hb;++w){_=w,S=I;var T=(M=(H=C).D).Nb;x=H.R;var M=M.wa[M.Y+_],F=H.sa,R=H.ta+16*T*x+16*_,L=M.dd,U=M.tc;if(0!=U)if(t(3<=U),1==H.L)0<_&&vr(F,R,x,U+4),M.La&&xr(F,R,x,U),0<S&&yr(F,R,x,U+4),M.La&&br(F,R,x,U);else{var P=H.B,D=H.qa,O=H.ra+8*T*P+8*_,z=H.Ha,H=H.Ia+8*T*P+8*_;T=M.ld,0<_&&(hr(F,R,x,U+4,L,T),Ar(D,O,z,H,P,U+4,L,T)),M.La&&(fr(F,R,x,U,L,T),gr(D,O,z,H,P,U,L,T)),0<S&&(ur(F,R,x,U+4,L,T),dr(D,O,z,H,P,U+4,L,T)),M.La&&(pr(F,R,x,U,L,T),mr(D,O,z,H,P,U,L,T))}}if(o.ia&&alert("todo:DitherRow"),null!=l.put){if(w=16*N,N=16*(N+1),k?(l.y=o.sa,l.O=o.ta+b,l.f=o.qa,l.N=o.ra+E,l.ea=o.Ha,l.W=o.Ia+E):(w-=v,l.y=A,l.O=p,l.f=f,l.N=h,l.ea=m,l.W=g),y||(N-=v),N>l.o&&(N=l.o),l.F=null,l.J=null,null!=o.Fa&&0<o.Fa.length&&w<N&&(l.J=hn(o,l,w,N-w),l.F=o.mb,null==l.F&&0==l.F.length)){c=qe(o,3,"Could not decode alpha data.");break t}w<l.j&&(v=l.j-w,w=l.j,t(!(1&v)),l.O+=o.R*v,l.N+=o.B*(v>>1),l.W+=o.B*(v>>1),null!=l.F&&(l.J+=l.width*v)),w<N&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=w-l.j,l.U=l.va-l.v,l.T=N-w,c=l.put(l))}s+1!=o.Ic||y||(r(o.sa,o.ta-u,A,p+16*o.R,u),r(o.qa,o.ra-d,f,h+8*o.B,d),r(o.Ha,o.Ia-d,m,g+8*o.B,d))}if(!c)return qe(e,6,"Output aborted.")}return 1}(e,n)),null!=n.bc&&n.bc(n),o&=1}return o?(e.cb=0,o):0})(e,l)||(n=e.a)}}else n=e.a}0==n&&null!=h.Oa&&h.Oa.fd&&(n=Un(h.ba))}h=n}u=0!=h?null:11>u?d.f.RGBA.eb:d.f.kb.y}else u=null;return u};var za=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(e,t){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(e[t++]);return n}function u(e,t){return e[t+0]|e[t+1]<<8}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function d(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new l;var A=[0],p=[0],f=[],m=new l,g=e,y=function(e,t){var n={},r=0,a=!1,i=0,s=0;if(n.frames=[],!function(e,t){for(var n=0;n<4;n++)if(e[t+n]!="RIFF".charCodeAt(n))return!0;return!1}(e,t)){for(d(e,t+=4),t+=8;t<e.length;){var o=c(e,t),l=d(e,t+=4);t+=4;var A=l+(1&l);switch(o){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(m=n.frames[r]).src_off=a?s:t-8,m.src_size=i+l+8,r++,a&&(a=!1,i=0,s=0);break;case"VP8X":(m=n.header={}).feature_flags=e[t];var p=t+4;m.canvas_width=1+h(e,p),p+=3,m.canvas_height=1+h(e,p),p+=3;break;case"ALPH":a=!0,i=A+8,s=t-8;break;case"ANIM":(m=n.header).bgcolor=d(e,t),p=t+4,m.loop_count=u(e,p),p+=2;break;case"ANMF":var f,m;(m=n.frames[r]={}).offset_x=2*h(e,t),t+=3,m.offset_y=2*h(e,t),t+=3,m.width=1+h(e,t),t+=3,m.height=1+h(e,t),t+=3,m.duration=h(e,t),t+=3,f=e[t++],m.dispose=1&f,m.blend=f>>1&1}"ANMF"!=o&&(t+=A)}return n}}(g,0);y.response=g,y.rgbaoutput=!0,y.dataurl=!1;var v=y.header?y.header:null,b=y.frames?y.frames:null;if(v){v.loop_counter=v.loop_count,A=[v.canvas_height],p=[v.canvas_width];for(var x=0;x<b.length&&0!=b[x].blend;x++);}var w=b[0],_=m.WebPDecodeRGBA(g,w.src_off,w.src_size,p,A);w.rgba=_,w.imgwidth=p[0],w.imgheight=A[0];for(var S=0;S<p[0]*A[0]*4;S++)f[S]=_[S];return this.width=p,this.height=A,this.data=f,this}!function(e){var t,n,r,a,i,s,o,l,c,u=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new s,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new s,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new h(this),t=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,s=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new u}]);var h=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var a=0;Object.defineProperty(this,"posX",{get:function(){return a},set:function(e){isNaN(e)||(a=e)}});var i=0;Object.defineProperty(this,"posY",{get:function(){return i},set:function(e){isNaN(e)||(i=e)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),c.margin=t}});var s=!1;Object.defineProperty(this,"autoPaging",{get:function(){return s},set:function(e){s=e}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(e){o=e}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof u&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var h=[];Object.defineProperty(this,"ctxStack",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=d(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=d(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var A=null,p=null;Object.defineProperty(this,"fontFaces",{get:function(){return p},set:function(e){A=null,p=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var n=t[1];t[2];var r=t[3],a=t[4];t[5];var i=t[6],s=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(a)[2];a="px"===s?Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor):"em"===s?Math.floor(parseFloat(a)*this.pdf.getFontSize()):Math.floor(parseFloat(a)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(a);var o=function(e){var t,n,r=[],a=e.trim();if(""===a)return _ce;if(a in cce)return[cce[a]];for(;""!==a;){switch(n=null,t=(a=hce(a)).charAt(0)){case'"':case"'":n=dce(a.substring(1),t);break;default:n=Ace(a)}if(null===n)return _ce;if(r.push(n[0]),""!==(a=hce(n[1]))&&","!==a.charAt(0))return _ce;a=a.replace(/^,/,"")}return r}(i);if(this.fontFaces){var l=function(e,t){if(null===A){var n=function(e){var t=[];return Object.keys(e).forEach(function(n){e[n].forEach(function(e){var r=null;switch(e){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:e},t.push(r))})}),t}(e.getFontList());A=function(e){for(var t={},n=0;n<e.length;++n){var r=sce(e[n]),a=r.family,i=r.stretch,s=r.style,o=r.weight;t[a]=t[a]||{},t[a][i]=t[a][i]||{},t[a][i][s]=t[a][i][s]||{},t[a][i][s][o]=r}return t}(n.concat(t))}return A}(this.pdf,this.fontFaces),c=o.map(function(e){return{family:e,stretch:"normal",weight:r,style:n}}),u=function(e,t,n){for(var r=(n=n||{}).defaultFontFamily||"times",a=Object.assign({},lce,n.genericFontFamilies||{}),i=null,s=null,o=0;o<t.length;++o)if(a[(i=sce(t[o])).family]&&(i.family=a[i.family]),e.hasOwnProperty(i.family)){s=e[i.family];break}if(!(s=s||e[r]))throw new Error("Could not find a font-family for the rule '"+uce(i)+"' and default family '"+r+"'.");if(s=function(e,t){if(t[e])return t[e];var n=rce[e],r=n<=rce.normal?-1:1,a=oce(t,nce,n,r);if(!a)throw new Error("Could not find a matching font-stretch value for "+e);return a}(i.stretch,s),s=function(e,t){if(t[e])return t[e];for(var n=tce[e],r=0;r<n.length;++r)if(t[n[r]])return t[n[r]];throw new Error("Could not find a matching font-style for "+e)}(i.style,s),!(s=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var n=ice[e],r=oce(t,ace,n,e<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+e);return r}(i.weight,s)))throw new Error("Failed to resolve a font for the rule '"+uce(i)+"'.");return s}(l,c);this.pdf.setFont(u.ref.name,u.ref.style)}else{var h="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(h="bold"),"italic"===n&&(h+="italic"),0===h.length&&(h="normal");for(var d="",p={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},f=0;f<o.length;f++){if(void 0!==this.pdf.internal.getFont(o[f],h,{noFallback:!0,disableWarning:!0})){d=o[f];break}if("bolditalic"===h&&void 0!==this.pdf.internal.getFont(o[f],"bold",{noFallback:!0,disableWarning:!0}))d=o[f],h="bold";else if(void 0!==this.pdf.internal.getFont(o[f],"normal",{noFallback:!0,disableWarning:!0})){d=o[f],h="normal";break}}if(""===d)for(var m=0;m<o.length;m++)if(p[o[m]]){d=p[o[m]];break}d=""===d?"Times":d,this.pdf.setFont(d,h)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,P.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,P.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};h.prototype.setLineDash=function(e){this.lineDash=e},h.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},h.prototype.fill=function(){b.call(this,"fill",!1)},h.prototype.stroke=function(){b.call(this,"stroke",!1)},h.prototype.beginPath=function(){this.path=[{type:"begin"}]},h.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(e,t)},h.prototype.closePath=function(){var e=new s(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,bne.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new s(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(e.x,e.y)},h.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(n.x,n.y)},h.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),b.call(this,null,!0)},h.prototype.quadraticCurveTo=function(e,t,n,r){if(isNaN(n)||isNaN(r)||isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var a=this.ctx.transform.applyToPoint(new s(n,r)),i=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"qct",x1:i.x,y1:i.y,x:a.x,y:a.y}),this.ctx.lastPoint=new s(a.x,a.y)},h.prototype.bezierCurveTo=function(e,t,n,r,a,i){if(isNaN(a)||isNaN(i)||isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new s(a,i)),l=this.ctx.transform.applyToPoint(new s(e,t)),c=this.ctx.transform.applyToPoint(new s(n,r));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new s(o.x,o.y)},h.prototype.arc=function(e,t,n,r,a,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a))throw Uoe.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(i=Boolean(i),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new s(e,t));e=o.x,t=o.y;var l=this.ctx.transform.applyToPoint(new s(0,n)),c=this.ctx.transform.applyToPoint(new s(0,0));n=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(a-r)>=2*Math.PI&&(r=0,a=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:n,startAngle:r,endAngle:a,counterclockwise:i})},h.prototype.arcTo=function(e,t,n,r,a){throw new Error("arcTo not implemented.")},h.prototype.rect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.lineTo(e+n,t),this.lineTo(e,t)},h.prototype.fillRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!A.call(this)){var a={};"butt"!==this.lineCap&&(a.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(a.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,n,r),this.fill(),a.hasOwnProperty("lineCap")&&(this.lineCap=a.lineCap),a.hasOwnProperty("lineJoin")&&(this.lineJoin=a.lineJoin)}},h.prototype.strokeRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");p.call(this)||(this.beginPath(),this.rect(e,t,n,r),this.stroke())},h.prototype.clearRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,n,r))},h.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},h.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},h.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(e){var t,n,r,a;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,n=0,r=0,a=0;else{var i=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==i)t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),a=1;else if(null!==(i=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(i[1]),n=parseInt(i[2]),r=parseInt(i[3]),a=parseFloat(i[4]);else{if(a=1,"string"==typeof e&&"#"!==e.charAt(0)){var s=new Hoe(e);e=s.ok?s.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,n=e.substring(2,3),n+=n,r=e.substring(3,4),r+=r):(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7)),t=parseInt(t,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:t,g:n,b:r,a:a,style:e}},A=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},p=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};h.prototype.fillText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Uoe.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!A.call(this)){var a=R(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;B.call(this,{text:e,x:t,y:n,scale:i,angle:a,align:this.textAlign,maxWidth:r})}},h.prototype.strokeText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Uoe.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!p.call(this)){r=isNaN(r)?void 0:r;var a=R(this.ctx.transform.rotation),i=this.ctx.transform.scaleX;B.call(this,{text:e,x:t,y:n,scale:i,renderingMode:"stroke",angle:a,align:this.textAlign,maxWidth:r})}},h.prototype.measureText=function(e){if("string"!=typeof e)throw Uoe.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,n=this.pdf.internal.scaleFactor,r=t.internal.getFontSize(),a=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:a*=Math.round(96*n/72*1e4)/1e4})},h.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.rotate=function(e){if(isNaN(e))throw Uoe.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},h.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.transform=function(e,t,n,r,a,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(a)||isNaN(i))throw Uoe.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var s=new l(e,t,n,r,a,i);this.ctx.transform=this.ctx.transform.multiply(s)},h.prototype.setTransform=function(e,t,n,r,a,i){e=isNaN(e)?1:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,r=isNaN(r)?1:r,a=isNaN(a)?0:a,i=isNaN(i)?0:i,this.ctx.transform=new l(e,t,n,r,a,i)};var f=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};h.prototype.drawImage=function(e,t,n,r,a,i,s,c,u){var h=this.pdf.getImageProperties(e),d=1,A=1,p=1,g=1;void 0!==r&&void 0!==c&&(p=c/r,g=u/a,d=h.width/r*c/r,A=h.height/a*u/a),void 0===i&&(i=t,s=n,t=0,n=0),void 0!==r&&void 0===c&&(c=r,u=a),void 0===r&&void 0===c&&(c=h.width,u=h.height);for(var b,w=this.ctx.transform.decompose(),_=R(w.rotate.shx),S=new l,C=(S=(S=(S=S.multiply(w.translate)).multiply(w.skew)).multiply(w.scale)).applyToRectangle(new o(i-t*p,s-n*g,r*d,a*A)),E=m.call(this,C),N=[],B=0;B<E.length;B+=1)-1===N.indexOf(E[B])&&N.push(E[B]);if(v(N),this.autoPaging)for(var k=N[0],I=N[N.length-1],T=k;T<I+1;T++){this.pdf.setPage(T);var M=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],F=1===T?this.posY+this.margin[0]:this.margin[0],L=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],U=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],P=1===T?0:L+(T-2)*U;if(0!==this.ctx.clip_path.length){var D=this.path;b=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(b,this.posX+this.margin[3],-P+F+this.ctx.prevPageLastElemOffset),x.call(this,"fill",!0),this.path=D}var O=JSON.parse(JSON.stringify(C));O=y([O],this.posX+this.margin[3],-P+F+this.ctx.prevPageLastElemOffset)[0];var z=(T>k||T<I)&&f.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],M,U,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",O.x,O.y,O.w,O.h,null,null,_),z&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",C.x,C.y,C.w,C.h,null,null,_)};var m=function(e,t,n){var r=[];t=t||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var a=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":r.push(Math.floor((e.y+a)/n)+1);break;case"arc":r.push(Math.floor((e.y+a-e.radius)/n)+1),r.push(Math.floor((e.y+a+e.radius)/n)+1);break;case"qct":var i=L(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);r.push(Math.floor((i.y+a)/n)+1),r.push(Math.floor((i.y+i.h+a)/n)+1);break;case"bct":var s=U(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);r.push(Math.floor((s.y+a)/n)+1),r.push(Math.floor((s.y+s.h+a)/n)+1);break;case"rect":r.push(Math.floor((e.y+a)/n)+1),r.push(Math.floor((e.y+e.h+a)/n)+1)}for(var o=0;o<r.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<r[o];)g.call(this);return r},g=function(){var e=this.fillStyle,t=this.strokeStyle,n=this.font,r=this.lineCap,a=this.lineWidth,i=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=n,this.lineCap=r,this.lineWidth=a,this.lineJoin=i},y=function(e,t,n){for(var r=0;r<e.length;r++)switch(e[r].type){case"bct":e[r].x2+=t,e[r].y2+=n;case"qct":e[r].x1+=t,e[r].y1+=n;default:e[r].x+=t,e[r].y+=n}return e},v=function(e){return e.sort(function(e,t){return e-t})},b=function(e,t){for(var n,r,a=this.fillStyle,i=this.strokeStyle,s=this.lineCap,o=this.lineWidth,l=Math.abs(o*this.ctx.transform.scaleX),c=this.lineJoin,u=JSON.parse(JSON.stringify(this.path)),h=JSON.parse(JSON.stringify(this.path)),d=[],A=0;A<h.length;A++)if(void 0!==h[A].x)for(var p=m.call(this,h[A]),b=0;b<p.length;b+=1)-1===d.indexOf(p[b])&&d.push(p[b]);for(var w=0;w<d.length;w++)for(;this.pdf.internal.getNumberOfPages()<d[w];)g.call(this);if(v(d),this.autoPaging)for(var _=d[0],S=d[d.length-1],C=_;C<S+1;C++){this.pdf.setPage(C),this.fillStyle=a,this.strokeStyle=i,this.lineCap=s,this.lineWidth=l,this.lineJoin=c;var E=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],N=1===C?this.posY+this.margin[0]:this.margin[0],B=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],k=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],I=1===C?0:B+(C-2)*k;if(0!==this.ctx.clip_path.length){var T=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(n,this.posX+this.margin[3],-I+N+this.ctx.prevPageLastElemOffset),x.call(this,e,!0),this.path=T}if(r=JSON.parse(JSON.stringify(u)),this.path=y(r,this.posX+this.margin[3],-I+N+this.ctx.prevPageLastElemOffset),!1===t||0===C){var M=(C>_||C<S)&&f.call(this);M&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],E,k,null).clip().discardPath()),x.call(this,e,t),M&&this.pdf.restoreGraphicsState()}this.lineWidth=o}else this.lineWidth=l,x.call(this,e,t),this.lineWidth=o;this.path=u},x=function(e,t){if(("stroke"!==e||t||!p.call(this))&&("stroke"===e||t||!A.call(this))){for(var n,r,a=[],i=this.path,s=0;s<i.length;s++){var o=i[s];switch(o.type){case"begin":a.push({begin:!0});break;case"close":a.push({close:!0});break;case"mt":a.push({start:o,deltas:[],abs:[]});break;case"lt":var l=a.length;if(i[s-1]&&!isNaN(i[s-1].x)&&(n=[o.x-i[s-1].x,o.y-i[s-1].y],l>0))for(;l>=0;l--)if(!0!==a[l-1].close&&!0!==a[l-1].begin){a[l-1].deltas.push(n),a[l-1].abs.push(o);break}break;case"bct":n=[o.x1-i[s-1].x,o.y1-i[s-1].y,o.x2-i[s-1].x,o.y2-i[s-1].y,o.x-i[s-1].x,o.y-i[s-1].y],a[a.length-1].deltas.push(n);break;case"qct":var c=i[s-1].x+2/3*(o.x1-i[s-1].x),u=i[s-1].y+2/3*(o.y1-i[s-1].y),h=o.x+2/3*(o.x1-o.x),d=o.y+2/3*(o.y1-o.y),f=o.x,m=o.y;n=[c-i[s-1].x,u-i[s-1].y,h-i[s-1].x,d-i[s-1].y,f-i[s-1].x,m-i[s-1].y],a[a.length-1].deltas.push(n);break;case"arc":a.push({deltas:[],abs:[],arc:!0}),Array.isArray(a[a.length-1].abs)&&a[a.length-1].abs.push(o)}}r=t?null:"stroke"===e?"stroke":"fill";for(var g=!1,y=0;y<a.length;y++)if(a[y].arc)for(var v=a[y].abs,b=0;b<v.length;b++){var x=v[b];"arc"===x.type?S.call(this,x.x,x.y,x.radius,x.startAngle,x.endAngle,x.counterclockwise,void 0,t,!g):k.call(this,x.x,x.y),g=!0}else if(!0===a[y].close)this.pdf.internal.out("h"),g=!1;else if(!0!==a[y].begin){var w=a[y].start.x,_=a[y].start.y;I.call(this,a[y].deltas,w,_),g=!0}r&&C.call(this,r),t&&E.call(this)}},w=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-n;case"top":return e+t-n;case"hanging":return e+t-2*n;case"middle":return e+t/2-n;default:return e}},_=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};h.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},h.prototype.createPattern=function(){return this.createLinearGradient()},h.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(e,t,n,r,a,i,s,o,l){for(var c=M.call(this,n,r,a,i),u=0;u<c.length;u++){var h=c[u];0===u&&(l?N.call(this,h.x1+e,h.y1+t):k.call(this,h.x1+e,h.y1+t)),T.call(this,e,t,h.x2,h.y2,h.x3,h.y3,h.x4,h.y4)}o?E.call(this):C.call(this,s)},C=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},E=function(){this.pdf.clip(),this.pdf.discardPath()},N=function(e,t){this.pdf.internal.out(n(e)+" "+r(t)+" m")},B=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var n=this.pdf.getTextDimensions(e.text),r=w.call(this,e.y),a=_.call(this,r)-n.h,i=this.ctx.transform.applyToPoint(new s(e.x,r)),c=this.ctx.transform.decompose(),u=new l;u=(u=(u=u.multiply(c.translate)).multiply(c.skew)).multiply(c.scale);for(var h,d,A,p=this.ctx.transform.applyToRectangle(new o(e.x,r,n.w,n.h)),g=u.applyToRectangle(new o(e.x,a,n.w,n.h)),b=m.call(this,g),S=[],C=0;C<b.length;C+=1)-1===S.indexOf(b[C])&&S.push(b[C]);if(v(S),this.autoPaging)for(var E=S[0],N=S[S.length-1],B=E;B<N+1;B++){this.pdf.setPage(B);var k=1===B?this.posY+this.margin[0]:this.margin[0],I=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],T=this.pdf.internal.pageSize.height-this.margin[2],M=T-this.margin[0],F=this.pdf.internal.pageSize.width-this.margin[1],R=F-this.margin[3],L=1===B?0:I+(B-2)*M;if(0!==this.ctx.clip_path.length){var U=this.path;h=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(h,this.posX+this.margin[3],-1*L+k),x.call(this,"fill",!0),this.path=U}var P=y([JSON.parse(JSON.stringify(g))],this.posX+this.margin[3],-L+k+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),A=this.lineWidth,this.lineWidth=A*e.scale);var D="text"!==this.autoPaging;if(D||P.y+P.h<=T){if(D||P.y>=k&&P.x<=F){var O=D?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||F-P.x)[0],z=y([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-L+k+this.ctx.prevPageLastElemOffset)[0],H=D&&(B>E||B<N)&&f.call(this);H&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],R,M,null).clip().discardPath()),this.pdf.text(O,z.x,z.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),H&&this.pdf.restoreGraphicsState()}}else P.y<T&&(this.ctx.prevPageLastElemOffset+=T-P.y);e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=A)}else e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),A=this.lineWidth,this.lineWidth=A*e.scale),this.pdf.text(e.text,i.x+this.posX,i.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=A)},k=function(e,t,a,i){a=a||0,i=i||0,this.pdf.internal.out(n(e+a)+" "+r(t+i)+" l")},I=function(e,t,n){return this.pdf.lines(e,t,n,null,null)},T=function(e,n,r,s,o,l,c,u){this.pdf.internal.out([t(a(r+e)),t(i(s+n)),t(a(o+e)),t(i(l+n)),t(a(c+e)),t(i(u+n)),"c"].join(" "))},M=function(e,t,n,r){for(var a=2*Math.PI,i=Math.PI/2;t>n;)t-=a;var s=Math.abs(n-t);s<a&&r&&(s=a-s);for(var o=[],l=r?-1:1,c=t;s>1e-5;){var u=c+l*Math.min(s,i);o.push(F.call(this,e,c,u)),s-=Math.abs(u-c),c=u}return o},F=function(e,t,n){var r=(n-t)/2,a=e*Math.cos(r),i=e*Math.sin(r),s=a,o=-i,l=s*s+o*o,c=l+s*a+o*i,u=4/3*(Math.sqrt(2*l*c)-c)/(s*i-o*a),h=s-u*o,d=o+u*s,A=h,p=-d,f=r+t,m=Math.cos(f),g=Math.sin(f);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:h*m-d*g,y2:h*g+d*m,x3:A*m-p*g,y3:A*g+p*m,x4:e*Math.cos(n),y4:e*Math.sin(n)}},R=function(e){return 180*e/Math.PI},L=function(e,t,n,r,a,i){var s=e+.5*(n-e),l=t+.5*(r-t),c=a+.5*(n-a),u=i+.5*(r-i),h=Math.min(e,a,s,c),d=Math.max(e,a,s,c),A=Math.min(t,i,l,u),p=Math.max(t,i,l,u);return new o(h,A,d-h,p-A)},U=function(e,t,n,r,a,i,s,l){var c,u,h,d,A,p,f,m,g,y,v,b,x,w,_=n-e,S=r-t,C=a-n,E=i-r,N=s-a,B=l-i;for(u=0;u<41;u++)g=(f=(h=e+(c=u/40)*_)+c*((A=n+c*C)-h))+c*(A+c*(a+c*N-A)-f),y=(m=(d=t+c*S)+c*((p=r+c*E)-d))+c*(p+c*(i+c*B-p)-m),0==u?(v=g,b=y,x=g,w=y):(v=Math.min(v,g),b=Math.min(b,y),x=Math.max(x,g),w=Math.max(w,y));return new o(Math.round(v),Math.round(b),Math.round(x-v),Math.round(w-b))},P=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,n=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(Ale.API),function(e){var t=function(e){var t,n,r,a,i,s,o,l,c,u;for(/[^\x00-\xFF]/.test(e),n=[],r=0,a=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;a>r;r+=4)0!==(i=(e.charCodeAt(r)<<24)+(e.charCodeAt(r+1)<<16)+(e.charCodeAt(r+2)<<8)+e.charCodeAt(r+3))?(s=(i=((i=((i=((i=(i-(u=i%85))/85)-(c=i%85))/85)-(l=i%85))/85)-(o=i%85))/85)%85,n.push(s+33,o+33,l+33,c+33,u+33)):n.push(122);return function(e,t){for(var n=t;n>0;n--)e.pop()}(n,t.length),String.fromCharCode.apply(String,n)+"~>"},n=function(e){var t,n,r,a,i,s=String,o="length",l=255,c="charCodeAt",u="slice",h="replace";for(e[u](-2),e=e[u](0,-2)[h](/\s/g,"")[h]("z","!!!!!"),r=[],a=0,i=(e+=t="uuuuu"[u](e[o]%5||5))[o];i>a;a+=5)n=52200625*(e[c](a)-33)+614125*(e[c](a+1)-33)+7225*(e[c](a+2)-33)+85*(e[c](a+3)-33)+(e[c](a+4)-33),r.push(l&n>>24,l&n>>16,l&n>>8,l&n);return function(e,t){for(var n=t;n>0;n--)e.pop()}(r,t[o]),s.fromCharCode.apply(s,r)},r=function(e){return e.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var n="",r=0;r<e.length;r+=2)n+=String.fromCharCode("0x"+(e[r]+e[r+1]));return n},i=function(e){for(var t=new Uint8Array(e.length),n=e.length;n--;)t[n]=e.charCodeAt(n);return(t=are(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,s){var o=0,l=e||"",c=[];for("string"==typeof(s=s||[])&&(s=[s]),o=0;o<s.length;o+=1)switch(s[o]){case"ASCII85Decode":case"/ASCII85Decode":l=n(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=a(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=r(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=i(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[o]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(Ale.API),(wce=Ale.API).loadFile=function(e,t,n){return function(e,t,n){t=!1!==t,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(e,t,n){var r=new XMLHttpRequest,a=0,i=function(e){var t=e.length,n=[],r=String.fromCharCode;for(a=0;a<t;a+=1)n.push(r(255&e.charCodeAt(a)));return n.join("")};if(r.open("GET",e,!t),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(r.onload=function(){200===r.status?n(i(this.responseText)):n(void 0)}),r.send(null),t&&200===r.status)return i(r.responseText)}(e,t,n)}catch(F_){}return r}(e,t,n)},wce.loadImageFile=wce.loadFile,function(e){function t(){return(Roe.html2canvas?Promise.resolve(Roe.html2canvas):Promise.resolve().then(n.t.bind(n,5239,23))).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function r(){return(Roe.DOMPurify?Promise.resolve(Roe.DOMPurify):n.e(977).then(n.bind(n,7977))).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var a=function(e){var t=(0,bne.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},i=function(e,t){var n=document.createElement(e);for(var r in t.className&&(n.className=t.className),t.innerHTML&&t.dompurify&&(n.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)n.style[r]=t.style[r];return n},s=function e(t,n){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),a=t.firstChild;a;a=a.nextSibling)!0!==n&&1===a.nodeType&&"SCRIPT"===a.nodeName||r.appendChild(e(a,n));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft},!0)),r},o=function e(t){var n=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),r=e.convert(Promise.resolve(),n);return(r=r.setProgress(1,e,1,[e])).set(t)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(e,t){return e.__proto__=t||o.prototype,e},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(a(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e),t){case"string":return this.then(r).then(function(t){return this.set({src:i("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},o.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,a=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete a.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=n,n)for(var i=0;i<n.length;++i){var s=n[i],o=s.src.find(function(e){return"truetype"===e.format});o&&t.addFont(o.url,s.ref.name,s.ref.style)}return a.windowHeight=a.windowHeight||0,a.windowHeight=0==a.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):a.windowHeight,t.context2d.save(!0),e(this.prop.container,a)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(e,t,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},o.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},o.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},o.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(e){if("object"!==a(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in o.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},o.prototype.get=function(e,t){return this.then(function(){var n=e in o.template.prop?this.prop[e]:this.opt[e];return t?t(n):n})},o.prototype.setMargin=function(e){return this.then(function(){switch(a(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},o.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||Ale.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},o.prototype.setProgress=function(e,t,n,r){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(e,t,n,r){return this.setProgress(e?this.progress.val+e:null,t||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},o.prototype.then=function(e,t){var n=this;return this.thenCore(e,t,function(e,t){return n.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return n.updateProgress(null,e),t}).then(e,t).then(function(e){return n.updateProgress(1),e})})},o.prototype.thenCore=function(e,t,n){n=n||Promise.prototype.then;var r=this;e&&(e=e.bind(r)),t&&(t=t.bind(r));var a=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?r:o.convert(Object.assign({},r),Promise.prototype),i=n.call(a,e,t);return o.convert(i,r.__proto__)},o.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},o.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},o.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return o.convert(t,this)},o.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},o.prototype.error=function(e){return this.then(function(){throw new Error(e)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Ale.getPageSize=function(e,t,n){if("object"===(0,bne.A)(e)){var r=e;e=r.orientation,t=r.unit||t,n=r.format||n}t=t||"mm",n=n||"a4",e=(""+(e||"P")).toLowerCase();var a,i=(""+n).toLowerCase(),s={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":a=1;break;case"mm":a=72/25.4;break;case"cm":a=72/2.54;break;case"in":a=72;break;case"px":a=.75;break;case"pc":case"em":a=12;break;case"ex":a=6;break;default:throw"Invalid unit: "+t}var o,l=0,c=0;if(s.hasOwnProperty(i))l=s[i][1]/a,c=s[i][0]/a;else try{l=n[1],c=n[0]}catch(Hoe){throw new Error("Invalid format: "+n)}if("p"===e||"portrait"===e)e="p",c>l&&(o=c,c=l,l=o);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>c&&(o=c,c=l,l=o)}return{width:c,height:l,unit:t,k:a,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(sce):null;var n=new o(t);return t.worker?n:n.from(e).doCallback()}}(Ale.API),Ale.API.addJS=function(e){return mce=e,this.internal.events.subscribe("postPutResources",function(){pce=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(pce+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),fce=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+mce+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==pce&&void 0!==fce&&this.internal.out("/Names <</JavaScript "+pce+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),a=0;a<r.length;a++){var i=r[a],s=n.exec(i);if(null!=s){var o=s[1];e.internal.newObjectDeferredBegin(o,!1)}e.internal.write(i)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(a=0;a<l;a++){var u=e.internal.newObject();c.push(u);var h=e.internal.getPageInfo(a+1);e.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var d=e.internal.newObject();for(e.internal.write("<< /Names [ "),a=0;a<c.length;a++)e.internal.write("(page_"+(a+1)+")"+c[a]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+d+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,n){var r={title:t,options:n,children:[]};return null==e&&(e=this.root),e.children.push(r),r},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var n=0;n<t.children.length;n++)this.genIds_r(t.children[n])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<t.children.length;r++){var a=t.children[r];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(t)),r>0&&this.line("/Prev "+this.makeRef(t.children[r-1])),r<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[r+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var i=this.count=this.count_r({count:0},a);if(i>0&&this.line("/Count "+i),a.options&&a.options.pageNumber){var s=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+s.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var o=0;o<t.children.length;o++)this.renderItems(t.children[o])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var n=0;n<t.children.length;n++)e.count++,this.count_r(e,t.children[n]);return e.count}}])}(Ale.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,n,r,a,i,s){var o,l=this.decode.DCT_DECODE,c=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=i||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,o=function(e){for(var n,r=256*e.charCodeAt(4)+e.charCodeAt(5),a=e.length,i={width:0,height:0,numcomponents:1},s=4;s<a;s+=2){if(s+=r,-1!==t.indexOf(e.charCodeAt(s+1))){n=256*e.charCodeAt(s+5)+e.charCodeAt(s+6),i={width:256*e.charCodeAt(s+7)+e.charCodeAt(s+8),height:n,numcomponents:e.charCodeAt(s+9)};break}r=256*e.charCodeAt(s+2)+e.charCodeAt(s+3)}return i}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),o.numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}c={data:e,width:o.width,height:o.height,colorSpace:s,bitsPerComponent:8,filter:l,index:n,alias:r}}return c}}(Ale.API),Ale.API.processPNG=function(e,t,n,r){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var a,i=new Moe(e,{checkCrc:!0}).decode(),s=i.width,o=i.height,l=i.channels,c=i.palette,u=i.depth;a=c&&1===l?function(e){for(var t=e.width,n=e.height,r=e.data,a=e.palette,i=e.depth,s=!1,o=[],l=[],c=void 0,u=!1,h=0,d=0;d<a.length;d++){var A=ore(a[d],4),p=A[0],f=A[1],m=A[2],g=A[3];o.push(p,f,m),null!=g&&(0===g?(h++,l.length<1&&l.push(d)):g<255&&(u=!0))}if(u||h>1){s=!0,l=void 0;var y=t*n;c=new Uint8Array(y);for(var v=new DataView(r.buffer),b=0;b<y;b++){var x=ore(a[Mce(v,b,i)],4)[3];c[b]=x}}else 0===h&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:s?8:void 0,colorBytes:r,alphaBytes:c,needSMask:s,palette:o,mask:l}}(i):2===l||4===l?function(e){for(var t=e.data,n=e.width,r=e.height,a=e.channels,i=e.depth,s=2===a?"DeviceGray":"DeviceRGB",o=a-1,l=n*r,c=o,u=l*c,h=1*l,d=Math.ceil(u*i/8),A=Math.ceil(h*i/8),p=new Uint8Array(d),f=new Uint8Array(A),m=new DataView(t.buffer),g=new DataView(p.buffer),y=new DataView(f.buffer),v=!1,b=0;b<l;b++){for(var x=b*a,w=0;w<c;w++)Fce(g,Mce(m,x+w,i),b*c+w,i);var _=Mce(m,x+c,i);_<(1<<i)-1&&(v=!0),Fce(y,_,1*b,i)}return{colorSpace:s,colorsPerPixel:o,sMaskBitsPerComponent:v?i:void 0,colorBytes:p,alphaBytes:f,needSMask:v}}(i):function(e){var t=e.data,n=1===e.channels?"DeviceGray":"DeviceRGB";return{colorSpace:n,colorsPerPixel:"DeviceGray"===n?1:3,colorBytes:t instanceof Uint16Array?function(e){for(var t=e.length,n=new Uint8Array(2*t),r=new DataView(n.buffer,n.byteOffset,n.byteLength),a=0;a<t;a++)r.setUint16(2*a,e[a],!1);return n}(t):t,needSMask:!1}}(i);var h,d,A,p=a,f=p.colorSpace,m=p.colorsPerPixel,g=p.sMaskBitsPerComponent,y=p.colorBytes,v=p.alphaBytes,b=p.needSMask,x=p.palette,w=p.mask,_=null;return r!==Ale.API.image_compression.NONE?(_=function(e){var t;switch(e){case Ale.API.image_compression.FAST:t=11;break;case Ale.API.image_compression.MEDIUM:t=13;break;case Ale.API.image_compression.SLOW:t=14;break;default:t=12}return t}(r),h=this.decode.FLATE_DECODE,d="/Predictor ".concat(_," /Colors ").concat(m," /BitsPerComponent ").concat(u," /Columns ").concat(s),e=Sce(y,Math.ceil(s*m*u/8),m,u,r),b&&(A=Sce(v,Math.ceil(s*g/8),1,g,r))):(h=void 0,d=void 0,e=y,b&&(A=v)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(A&&this.__addimage__.isArrayBuffer(A)||this.__addimage__.isArrayBufferView(A))&&(A=this.__addimage__.arrayBufferToBinaryString(A)),{alias:n,data:e,index:t,filter:h,decodeParameters:d,transparency:w,palette:x,sMask:A,predictor:_,width:s,height:o,bitsPerComponent:u,sMaskBitsPerComponent:g,colorSpace:f}}},function(e){e.processGIF89A=function(t,n,r,a){var i=new Lce(t),s=i.width,o=i.height,l=[];i.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:s,height:o},u=new Pce(100).encode(c,100);return e.processJPEG.call(this,u,n,r,a)},e.processGIF87A=e.processGIF89A}(Ale.API),Dce.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:a,green:r,blue:n,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Dce.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(n){Uoe.log("bit decode error:"+n)}},Dce.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),n=t%4;for(e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,a=0;a<t;a++)for(var i=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+8*a*4,o=0;o<8&&8*a+o<this.width;o++){var l=this.palette[i>>7-o&1];this.data[s+4*o]=l.blue,this.data[s+4*o+1]=l.green,this.data[s+4*o+2]=l.red,this.data[s+4*o+3]=255}0!==n&&(this.pos+=4-n)}},Dce.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<e;a++){var i=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+2*a*4,o=i>>4,l=15&i,c=this.palette[o];if(this.data[s]=c.blue,this.data[s+1]=c.green,this.data[s+2]=c.red,this.data[s+3]=255,2*a+1>=this.width)break;c=this.palette[l],this.data[s+4]=c.blue,this.data[s+4+1]=c.green,this.data[s+4+2]=c.red,this.data[s+4+3]=255}0!==t&&(this.pos+=4-t)}},Dce.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+4*r;if(a<this.palette.length){var s=this.palette[a];this.data[i]=s.red,this.data[i+1]=s.green,this.data[i+2]=s.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}0!==e&&(this.pos+=4-e)}},Dce.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<this.width;a++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(i&t)/t*255|0,o=(i>>5&t)/t*255|0,l=(i>>10&t)/t*255|0,c=i>>15?255:0,u=r*this.width*4+4*a;this.data[u]=l,this.data[u+1]=o,this.data[u+2]=s,this.data[u+3]=c}this.pos+=e}},Dce.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(s&t)/t*255|0,l=(s>>5&n)/n*255|0,c=(s>>11)/t*255|0,u=a*this.width*4+4*i;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=o,this.data[u+3]=255}this.pos+=e}},Dce.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;this.data[s]=i,this.data[s+1]=a,this.data[s+2]=r,this.data[s+3]=255}this.pos+=this.width%4}},Dce.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;this.data[o]=i,this.data[o+1]=a,this.data[o+2]=r,this.data[o+3]=s}},Dce.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,n,r,a){var i=new Dce(t,!1),s=i.width,o=i.height,l={data:i.getData(),width:s,height:o},c=new Pce(100).encode(l,100);return e.processJPEG.call(this,c,n,r,a)}}(Ale.API),Oce.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,n,r,a){var i=new Oce(t),s=i.width,o=i.height,l={data:i.getData(),width:s,height:o},c=new Pce(100).encode(l,100);return e.processJPEG.call(this,c,n,r,a)}}(Ale.API),Ale.API.processRGBA=function(e,t,n){for(var r=e.data,a=r.length,i=new Uint8Array(a/4*3),s=new Uint8Array(a/4),o=0,l=0,c=0;c<a;c+=4){var u=r[c],h=r[c+1],d=r[c+2],A=r[c+3];i[o++]=u,i[o++]=h,i[o++]=d,s[l++]=A}var p=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:p,index:t,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Ale.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},gce=Ale.API,yce=gce.getCharWidthsArray=function(e,t){var n,r,a=(t=t||{}).font||this.internal.getFont(),i=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:a.metadata.Unicode.widths,l=o.fof?o.fof:1,c=t.kerning?t.kerning:a.metadata.Unicode.kerning,u=c.fof?c.fof:1,h=!1!==t.doKerning,d=0,A=e.length,p=0,f=o[0]||l,m=[];for(n=0;n<A;n++)r=e.charCodeAt(n),"function"==typeof a.metadata.widthOfString?m.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(r))+s*(1e3/i)||0)/1e3):(d=h&&"object"===(0,bne.A)(c[r])&&!isNaN(parseInt(c[r][p],10))?c[r][p]/u:0,m.push((o[r]||f)/l+d)),p=r;return m},vce=gce.getStringUnitWidth=function(e,t){var n=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),a=t.charSpace||this.internal.getCharSpace();return gce.processArabic&&(e=gce.processArabic(e)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(e,n,a)/n:yce.apply(this,arguments).reduce(function(e,t){return e+t},0)},bce=function(e,t,n,r){for(var a=[],i=0,s=e.length,o=0;i!==s&&o+t[i]<n;)o+=t[i],i++;a.push(e.slice(0,i));var l=i;for(o=0;i!==s;)o+t[i]>r&&(a.push(e.slice(l,i)),o=0,l=i),o+=t[i],i++;return l!==i&&a.push(e.slice(l,i)),a},xce=function(e,t,n){n||(n={});var r,a,i,s,o,l,c,u=[],h=[u],d=n.textIndent||0,A=0,p=0,f=e.split(" "),m=yce.apply(this,[" ",n])[0];if(l=-1===n.lineIndent?f[0].length+2:n.lineIndent||0){var g=Array(l).join(" "),y=[];f.map(function(e){(e=e.split(/\s*\n/)).length>1?y=y.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):y.push(e[0])}),f=y,l=vce.apply(this,[g,n])}for(i=0,s=f.length;i<s;i++){var v=0;if(r=f[i],l&&"\n"==r[0]&&(r=r.substr(1),v=1),d+A+(p=(a=yce.apply(this,[r,n])).reduce(function(e,t){return e+t},0))>t||v){if(p>t){for(o=bce.apply(this,[r,a,t-(d+A),t]),u.push(o.shift()),u=[o.pop()];o.length;)h.push([o.shift()]);p=a.slice(r.length-(u[0]?u[0].length:0)).reduce(function(e,t){return e+t},0)}else u=[r];h.push(u),d=p+l,A=m}else u.push(r),d+=A+p,A=m}return c=l?function(e,t){return(t?g:"")+e.join(" ")}:function(e){return e.join(" ")},h.map(c)},gce.splitTextToSize=function(e,t,n){var r,a=(n=n||{}).fontSize||this.internal.getFontSize(),i=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle),n="Unicode";return t.metadata[n]?{widths:t.metadata[n].widths||{0:1},kerning:t.metadata[n].kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(e)?e:String(e).split(/\r?\n/);var s=1*this.internal.scaleFactor*t/a;i.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/a:0,i.lineIndent=n.lineIndent;var o,l,c=[];for(o=0,l=r.length;o<l;o++)c=c.concat(xce.apply(this,[r[o],s,i]));return c},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",n="klmnopqrstuvwxyz",r={},a={},i=0;i<16;i++)r[n[i]]=t[i],a[t[i]]=n[i];var s=function(e){return"0x"+parseInt(e,10).toString(16)},o=e.__fontmetrics__.compress=function(e){var t,n,r,i,l=["{"];for(var c in e){if(t=e[c],isNaN(parseInt(c,10))?n="'"+c+"'":(c=parseInt(c,10),n=(n=s(c).slice(2)).slice(0,-1)+a[n.slice(-1)]),"number"==typeof t)t<0?(r=s(t).slice(3),i="-"):(r=s(t).slice(2),i=""),r=i+r.slice(0,-1)+a[r.slice(-1)];else{if("object"!==(0,bne.A)(t))throw new Error("Don't know what to do with value type "+(0,bne.A)(t)+".");r=o(t)}l.push(n+r)}return l.push("}"),l.join("")},l=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,n,a,i,s={},o=1,l=s,c=[],u="",h="",d=e.length-1,A=1;A<d;A+=1)"'"==(i=e[A])?t?(a=t.join(""),t=void 0):t=[]:t?t.push(i):"{"==i?(c.push([l,a]),l={},a=void 0):"}"==i?((n=c.pop())[0][n[1]]=l,a=void 0,l=n[0]):"-"==i?o=-1:void 0===a?r.hasOwnProperty(i)?(u+=r[i],a=parseInt(u,16)*o,o=1,u=""):u+=i:r.hasOwnProperty(i)?(h+=r[i],l[a]=parseInt(h,16)*o,o=1,a=void 0,h=""):h+=i;return s},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},h={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,n=h.Unicode[t.postScriptName];n&&(t.metadata.Unicode={},t.metadata.Unicode.widths=n.widths,t.metadata.Unicode.kerning=n.kerning);var r=u.Unicode[t.postScriptName];r&&(t.metadata.Unicode.encoding=r,t.encoding=r.codePages[0])}])}(Ale.API),function(e){var t=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n};e.API.events.push(["addFont",function(n){var r=void 0,a=n.font,i=n.instance;if(!a.isStandardFont){if(void 0===i)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if("string"!=typeof(r=!1===i.existsFileInVFS(a.postScriptName)?i.loadFile(a.postScriptName):i.getFileFromVFS(a.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?t(r):t(joe(r)),n.metadata=e.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(a,r)}}])}(Ale),Ale.API.addSvgAsImage=function(e,t,r,a,i,s,o,l){if(isNaN(t)||isNaN(r))throw Uoe.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(a)||isNaN(i))throw Uoe.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=a,c.height=i;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return(Roe.canvg?Promise.resolve(Roe.canvg):n.e(455).then(n.bind(n,8455))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e}).then(function(t){return t.fromString(u,e,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(h)}).then(function(){d.addImage(c.toDataURL("image/jpeg",1),t,r,a,i,o,l)})},Ale.API.putTotalPages=function(e){var t,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),n=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var a=0;a<this.internal.pages[r].length;a++)this.internal.pages[r][a]=this.internal.pages[r][a].replace(t,n);return this},Ale.API.viewerPreferences=function(e,t){var n;e=e||{},t=t||!1;var r,a,i,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(s),l=[],c=0,u=0,h=0;function d(e,t){var n,r=!1;for(n=0;n<e.length;n+=1)e[n]===t&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var A=o.length;for(h=0;h<A;h+=1)n[o[h]].value=n[o[h]].defaultValue,n[o[h]].explicitSet=!1}if("object"===(0,bne.A)(e))for(a in e)if(i=e[a],d(o,a)&&void 0!==i){if("boolean"===n[a].type&&"boolean"==typeof i)n[a].value=i;else if("name"===n[a].type&&d(n[a].valueSet,i))n[a].value=i;else if("integer"===n[a].type&&Number.isInteger(i))n[a].value=i;else if("array"===n[a].type){for(c=0;c<i.length;c+=1)if(r=!0,1===i[c].length&&"number"==typeof i[c][0])l.push(String(i[c]-1));else if(i[c].length>1){for(u=0;u<i[c].length;u+=1)"number"!=typeof i[c][u]&&(r=!1);!0===r&&l.push([i[c][0]-1,i[c][1]-1].join(" "))}n[a].value="["+l.join(" ")+"]"}else n[a].value=n[a].defaultValue;n[a].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in n)!0===n[e].explicitSet&&("name"===n[e].type?t.push("/"+e+" /"+n[e].value):t.push("/"+e+" "+n[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(e)),r=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),a=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),i=unescape(encodeURIComponent("</x:xmpmeta>")),s=n.length+r.length+a.length+t.length+i.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+s+" >>"),this.internal.write("stream"),this.internal.write(t+n+r+a+i),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,r){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",t)),this}}(Ale.API),function(e){var t=e.API,n=t.pdfEscape16=function(e,t){for(var n,r=t.metadata.Unicode.widths,a=["","0","00","000","0000"],i=[""],s=0,o=e.length;s<o;++s){if(n=t.metadata.characterToGlyph(e.charCodeAt(s)),t.metadata.glyIdsUsed.push(n),t.metadata.toUnicode[n]=e.charCodeAt(s),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(t.metadata.widthOfGlyph(n),10)])),"0"==n)return i.join("");n=n.toString(16),i.push(a[4-n.length],n)}return i.join("")},r=function(e){var t,n,r,a,i,s,o;for(i="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],s=0,o=(n=Object.keys(e).sort(function(e,t){return e-t})).length;s<o;s++)t=n[s],r.length>=100&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(a=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),r.push("<"+t+"><"+a+">"));return r.length&&(i+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),i+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var n=t.font,a=t.out,i=t.newObject,s=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"Identity-H"===n.encoding){for(var o=n.metadata.Unicode.widths,l=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),c="",u=0;u<l.length;u++)c+=String.fromCharCode(l[u]);var h=i();s({data:c,addLength1:!0,objectId:h}),a("endobj");var d=i();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:d}),a("endobj");var A=i();a("<<"),a("/Type /FontDescriptor"),a("/FontName /"+ole(n.fontName)),a("/FontFile2 "+h+" 0 R"),a("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),a("/Flags "+n.metadata.flags),a("/StemV "+n.metadata.stemV),a("/ItalicAngle "+n.metadata.italicAngle),a("/Ascent "+n.metadata.ascender),a("/Descent "+n.metadata.decender),a("/CapHeight "+n.metadata.capHeight),a(">>"),a("endobj");var p=i();a("<<"),a("/Type /Font"),a("/BaseFont /"+ole(n.fontName)),a("/FontDescriptor "+A+" 0 R"),a("/W "+e.API.PDFObject.convert(o)),a("/CIDToGIDMap /Identity"),a("/DW 1000"),a("/Subtype /CIDFontType2"),a("/CIDSystemInfo"),a("<<"),a("/Supplement 0"),a("/Registry (Adobe)"),a("/Ordering ("+n.encoding+")"),a(">>"),a(">>"),a("endobj"),n.objectNumber=i(),a("<<"),a("/Type /Font"),a("/Subtype /Type0"),a("/ToUnicode "+d+" 0 R"),a("/BaseFont /"+ole(n.fontName)),a("/Encoding /"+n.encoding),a("/DescendantFonts ["+p+" 0 R]"),a(">>"),a("endobj"),n.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var n=t.font,a=t.out,i=t.newObject,s=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var o=n.metadata.rawData,l="",c=0;c<o.length;c++)l+=String.fromCharCode(o[c]);var u=i();s({data:l,addLength1:!0,objectId:u}),a("endobj");var h=i();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:h}),a("endobj");var d=i();a("<<"),a("/Descent "+n.metadata.decender),a("/CapHeight "+n.metadata.capHeight),a("/StemV "+n.metadata.stemV),a("/Type /FontDescriptor"),a("/FontFile2 "+u+" 0 R"),a("/Flags 96"),a("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),a("/FontName /"+ole(n.fontName)),a("/ItalicAngle "+n.metadata.italicAngle),a("/Ascent "+n.metadata.ascender),a(">>"),a("endobj"),n.objectNumber=i();for(var A=0;A<n.metadata.hmtx.widths.length;A++)n.metadata.hmtx.widths[A]=parseInt(n.metadata.hmtx.widths[A]*(1e3/n.metadata.head.unitsPerEm));a("<</Subtype/TrueType/Type/Font/ToUnicode "+h+" 0 R/BaseFont/"+ole(n.fontName)+"/FontDescriptor "+d+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),a("endobj"),n.isAlreadyPutted=!0}}(t)}]);var a=function(e){var t,r=e.text||"",a=e.x,i=e.y,s=e.options||{},o=e.mutex||{},l=o.pdfEscape,c=o.activeFontKey,u=o.fonts,h=c,d="",A=0,p="",f=u[h].encoding;if("Identity-H"!==u[h].encoding)return{text:r,x:a,y:i,options:s,mutex:o};for(p=r,h=c,Array.isArray(r)&&(p=r[0]),A=0;A<p.length;A+=1)u[h].metadata.hasOwnProperty("cmap")&&(t=u[h].metadata.cmap.unicode.codeMap[p[A].charCodeAt(0)]),t||p[A].charCodeAt(0)<256&&u[h].metadata.hasOwnProperty("Unicode")?d+=p[A]:d+="";var m="";return parseInt(h.slice(1))<14||"WinAnsiEncoding"===f?m=l(d,h).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===f&&(m=n(d,u[h])),o.isHex=!0,{text:m,x:a,y:i,options:s,mutex:o}};t.events.push(["postProcessText",function(e){var t=e.text||"",n=[],r={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var i=0;for(i=0;i<t.length;i+=1)Array.isArray(t[i])&&3===t[i].length?n.push([a(Object.assign({},r,{text:t[i][0]})).text,t[i][1],t[i][2]]):n.push(a(Object.assign({},r,{text:t[i]})).text);e.text=n}else e.text=a(Object.assign({},r,{text:t})).text}])}(Ale),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(Ale.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var n,r,a,i,s,o,l,c=t,u=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},A={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],f=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),m=!1,g=0;this.__bidiEngine__={};var y=function(e){var t=e.charCodeAt(),n=t>>8,r=A[n];return void 0!==r?c[256*r+(255&t)]:252===n||253===n?"AL":f.test(n)?"L":8===n?"R":"N"},v=function(e){for(var t,n=0;n<e.length;n++){if("L"===(t=y(e.charAt(n))))return!1;if("R"===t)return!0}return!1},b=function(e,t,s,o){var l,c,u,h,d=t[o];switch(d){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":m=!1;break;case"N":case"AN":break;case"EN":m&&(d="AN");break;case"AL":m=!0,d="R";break;case"WS":case"BN":d="N";break;case"CS":o<1||o+1>=t.length||"EN"!==(l=s[o-1])&&"AN"!==l||"EN"!==(c=t[o+1])&&"AN"!==c?d="N":m&&(c="AN"),d=c===l?c:"N";break;case"ES":d="EN"===(l=o>0?s[o-1]:"B")&&o+1<t.length&&"EN"===t[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===s[o-1]){d="EN";break}if(m){d="N";break}for(u=o+1,h=t.length;u<h&&"ET"===t[u];)u++;d=u<h&&"EN"===t[u]?"EN":"N";break;case"NSM":if(a&&!i){for(h=t.length,u=o+1;u<h&&"NSM"===t[u];)u++;if(u<h){var A=e[o],p=A>=1425&&A<=2303||64286===A;if(l=t[u],p&&("R"===l||"AL"===l)){d="R";break}}}d=o<1||"B"===(l=t[o-1])?"N":s[o-1];break;case"B":m=!1,n=!0,d=g;break;case"S":r=!0,d="N"}return d},x=function(e,t,n){var r=e.split("");return n&&w(r,n,{hiLevel:g}),r.reverse(),t&&t.reverse(),r.join("")},w=function(e,t,a){var i,s,o,l,c,A=-1,p=e.length,f=0,v=[],x=g?h:u,w=[];for(m=!1,n=!1,r=!1,s=0;s<p;s++)w[s]=y(e[s]);for(o=0;o<p;o++){if(c=f,v[o]=b(e,w,v,o),i=240&(f=x[c][d[v[o]]]),f&=15,t[o]=l=x[f][5],i>0)if(16===i){for(s=A;s<o;s++)t[s]=1;A=-1}else A=-1;if(x[f][6])-1===A&&(A=o);else if(A>-1){for(s=A;s<o;s++)t[s]=l;A=-1}"B"===w[o]&&(t[o]=0),a.hiLevel|=l}r&&function(e,t,n){for(var r=0;r<n;r++)if("S"===e[r]){t[r]=g;for(var a=r-1;a>=0&&"WS"===e[a];a--)t[a]=g}}(w,t,p)},_=function(e,t,r,a,i){if(!(i.hiLevel<e)){if(1===e&&1===g&&!n)return t.reverse(),void(r&&r.reverse());for(var s,o,l,c,u=t.length,h=0;h<u;){if(a[h]>=e){for(l=h+1;l<u&&a[l]>=e;)l++;for(c=h,o=l-1;c<o;c++,o--)s=t[c],t[c]=t[o],t[o]=s,r&&(s=r[c],r[c]=r[o],r[o]=s);h=l}h++}}},S=function(e,t,n){var r=e.split(""),a={hiLevel:g};return n||(n=[]),w(r,n,a),function(e,t,n){if(0!==n.hiLevel&&l)for(var r,a=0;a<e.length;a++)1===t[a]&&(r=p.indexOf(e[a]))>=0&&(e[a]=p[r+1])}(r,n,a),_(2,r,t,n,a),_(1,r,t,n,a),r.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,n){if(function(e,t){if(t)for(var n=0;n<e.length;n++)t[n]=n;void 0===i&&(i=v(e)),void 0===o&&(o=v(e))}(e,t),a||!s||o)if(a&&s&&i^o)g=i?1:0,e=x(e,t,n);else if(!a&&s&&o)g=i?1:0,e=S(e,t,n),e=x(e,t);else if(!a||i||s||o){if(a&&!s&&i^o)e=x(e,t),i?(g=0,e=S(e,t,n)):(g=1,e=S(e,t,n),e=x(e,t));else if(a&&i&&!s&&o)g=1,e=S(e,t,n),e=x(e,t);else if(!a&&!s&&i^o){var r=l;i?(g=1,e=S(e,t,n),g=0,l=!1,e=S(e,t,n),l=r):(g=0,e=S(e,t,n),e=x(e,t),g=1,l=!1,e=S(e,t,n),l=r,e=x(e,t))}}else g=0,e=S(e,t,n);else g=i?1:0,e=S(e,t,n);return e},this.__bidiEngine__.setOptions=function(e){e&&(a=e.isInputVisual,s=e.isOutputVisual,i=e.isInputRtl,o=e.isOutputRtl,l=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text;e.x,e.y;var r=e.options||{};e.mutex,r.lang;var a=[];if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(t)){var i=0;for(a=[],i=0;i<t.length;i+=1)"[object Array]"===Object.prototype.toString.call(t[i])?a.push([n.doBidiReorder(t[i][0]),t[i][1],t[i][2]]):a.push([n.doBidiReorder(t[i])]);e.text=a}else e.text=n.doBidiReorder(t);n.setOptions({isInputVisual:!0})}])}(Ale),Ale.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new Hce(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new sue(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new jce(this.contents),this.head=new Wce(this),this.name=new Zce(this),this.cmap=new Kce(this),this.toUnicode={},this.hhea=new qce(this),this.maxp=new $ce(this),this.hmtx=new eue(this),this.post=new Yce(this),this.os2=new Xce(this),this.loca=new iue(this),this.glyf=new nue(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,n,r,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,n,r,a;for(a=[],t=0,n=(r=this.bbox).length;t<n;t++)e=r[t],a.push(Math.round(e*this.scaleFactor));return a}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(a=this.familyClass)||2===a||3===a||4===a||5===a||7===a,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,n){var r,a,i,s;for(i=0,a=0,s=(e=""+e).length;0<=s?a<s:a>s;a=0<=s?++a:--a)r=e.charCodeAt(a),i+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return i*(t/1e3)},e.prototype.lineHeight=function(e,t){var n;return null==t&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},e}();var zce,Hce=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,n,r,a,i,s,o;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),a=this.readByte(),i=this.readByte(),s=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^a)+65536*(255^i)+256*(255^s)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*a+65536*i+256*s+o},e.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},e.prototype.write=function(e){var t,n,r,a;for(a=[],n=0,r=e.length;n<r;n++)t=e[n],a.push(this.writeByte(t));return a},e}(),jce=function(){var e;function t(e){var t,n,r;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var n,r,a,i,s,o,l,c,u,h,d,A,p;for(p in d=Object.keys(t).length,o=Math.log(2),u=16*Math.floor(Math.log(d)/o),i=Math.floor(u/o),c=16*d-u,(r=new Hce).writeInt(this.scalarType),r.writeShort(d),r.writeShort(u),r.writeShort(i),r.writeShort(c),a=16*d,l=r.pos+a,s=null,A=[],t)for(h=t[p],r.writeString(p),r.writeInt(e(h)),r.writeInt(l),r.writeInt(h.length),A=A.concat(h),"head"===p&&(s=l),l+=h.length;l%4;)A.push(0),l++;return r.write(A),n=2981146554-e(r.data),r.pos=s+8,r.writeUInt32(n),r.data},e=function(e){var t,n,r,a;for(e=tue.call(e);e.length%4;)e.push(0);for(r=new Hce(e),n=0,t=0,a=e.length;t<a;t=t+=4)n+=r.readUInt32();return 4294967295&n},t}(),Qce={}.hasOwnProperty,Vce=function(e,t){for(var n in t)Qce.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};zce=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var Wce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new Hce).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),Gce=function(){function e(e,t){var n,r,a,i,s,o,l,c,u,h,d,A,p,f,m,g,y;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),u=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(d=e.readUInt16(),h=d/2,e.pos+=6,a=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),e.pos+=2,p=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),l=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),c=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),r=(this.length-e.pos+this.offset)/2,s=function(){var t,n;for(n=[],o=t=0;0<=r?t<r:t>r;o=0<=r?++t:--t)n.push(e.readUInt16());return n}(),o=m=0,y=a.length;m<y;o=++m)for(f=a[o],n=g=A=p[o];A<=f?g<=f:g>=f;n=A<=f?++g:--g)0===c[o]?i=n+l[o]:0!==(i=s[c[o]/2+(n-A)-(h-o)]||0)&&(i+=l[o]),this.codeMap[n]=65535&i}e.pos=u}return e.encode=function(e,t){var n,r,a,i,s,o,l,c,u,h,d,A,p,f,m,g,y,v,b,x,w,_,S,C,E,N,B,k,I,T,M,F,R,L,U,P,D,O,z,H,j,Q,V,W,G,K;switch(k=new Hce,i=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(p=0,f=function(){var e=[];for(A=0;A<256;++A)e.push(0);return e}(),g={0:0},a={},I=0,R=i.length;I<R;I++)null==g[V=e[r=i[I]]]&&(g[V]=++p),a[r]={old:e[r],new:g[e[r]]},f[r]=g[e[r]];return k.writeUInt16(1),k.writeUInt16(0),k.writeUInt32(12),k.writeUInt16(0),k.writeUInt16(262),k.writeUInt16(0),k.write(f),{charMap:a,subtable:k.data,maxGlyphID:p+1};case"unicode":for(N=[],u=[],y=0,g={},n={},m=l=null,T=0,L=i.length;T<L;T++)null==g[b=e[r=i[T]]]&&(g[b]=++y),n[r]={old:b,new:g[b]},s=g[b]-r,null!=m&&s===l||(m&&u.push(m),N.push(r),l=s),m=r;for(m&&u.push(m),u.push(65535),N.push(65535),C=2*(S=N.length),_=2*Math.pow(Math.log(S)/Math.LN2,2),h=Math.log(_/2)/Math.LN2,w=2*S-_,o=[],x=[],d=[],A=M=0,U=N.length;M<U;A=++M){if(E=N[A],c=u[A],65535===E){o.push(0),x.push(0);break}if(E-(B=n[E].new)>=32768)for(o.push(0),x.push(2*(d.length+S-A)),r=F=E;E<=c?F<=c:F>=c;r=E<=c?++F:--F)d.push(n[r].new);else o.push(B-E),x.push(0)}for(k.writeUInt16(3),k.writeUInt16(1),k.writeUInt32(12),k.writeUInt16(4),k.writeUInt16(16+8*S+2*d.length),k.writeUInt16(0),k.writeUInt16(C),k.writeUInt16(_),k.writeUInt16(h),k.writeUInt16(w),j=0,P=u.length;j<P;j++)r=u[j],k.writeUInt16(r);for(k.writeUInt16(0),Q=0,D=N.length;Q<D;Q++)r=N[Q],k.writeUInt16(r);for(W=0,O=o.length;W<O;W++)s=o[W],k.writeUInt16(s);for(G=0,z=x.length;G<z;G++)v=x[G],k.writeUInt16(v);for(K=0,H=d.length;K<H;K++)p=d[K],k.writeUInt16(p);return{charMap:n,subtable:k.data,maxGlyphID:y+1}}},e}(),Kce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new Gce(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var n,r;return null==t&&(t="macroman"),n=Gce.encode(e,t),(r=new Hce).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(),qce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),Xce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),Yce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="post",e.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(n=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=function(){var t,n,r;for(r=[],a=t=0,n=this.file.maxp.numGlyphs;0<=n?t<n:t>n;a=0<=n?++t:--t)r.push(e.readUInt32());return r}.call(this)}},e}(),Jce=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},Zce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="name",e.prototype.parse=function(e){var t,n,r,a,i,s,o,l,c,u,h;for(e.pos=this.offset,e.readShort(),t=e.readShort(),s=e.readShort(),n=[],a=0;0<=t?a<t:a>t;a=0<=t?++a:--a)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+s+e.readShort()});for(o={},a=c=0,u=n.length;c<u;a=++c)r=n[a],e.pos=r.offset,l=e.readString(r.length),i=new Jce(l,r),null==o[h=r.nameID]&&(o[h]=[]),o[r.nameID].push(i);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(joe){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(),$ce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),eue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,n,r,a,i,s,o;for(e.pos=this.offset,this.metrics=[],t=0,s=this.file.hhea.numberOfMetrics;0<=s?t<s:t>s;t=0<=s?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,a;for(a=[],t=n=0;0<=r?n<r:n>r;t=0<=r?++n:--n)a.push(e.readInt16());return a}(),this.widths=function(){var e,t,n,r;for(r=[],e=0,t=(n=this.metrics).length;e<t;e++)a=n[e],r.push(a.advance);return r}.call(this),n=this.widths[this.widths.length-1],o=[],t=i=0;0<=r?i<r:i>r;t=0<=r?++i:--i)o.push(this.widths.push(n));return o},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),tue=[].slice,nue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,n,r,a,i,s,o,l,c,u;return e in this.cache?this.cache[e]:(a=this.file.loca,t=this.file.contents,n=a.indexOf(e),0===(r=a.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+n,i=(s=new Hce(t.read(r))).readShort(),l=s.readShort(),u=s.readShort(),o=s.readShort(),c=s.readShort(),this.cache[e]=-1===i?new aue(s,l,u,o,c):new rue(s,i,l,u,o,c),this.cache[e]))},e.prototype.encode=function(e,t,n){var r,a,i,s,o;for(i=[],a=[],s=0,o=t.length;s<o;s++)r=e[t[s]],a.push(i.length),r&&(i=i.concat(r.encode(n)));return a.push(i.length),{table:i,offsets:a}},e}(),rue=function(){function e(e,t,n,r,a,i){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=a,this.yMax=i,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),aue=function(){function e(e,t,n,r,a){var i,s;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],i=this.raw;s=i.readShort(),this.glyphOffsets.push(i.pos),this.glyphIDs.push(i.readUInt16()),32&s;)i.pos+=1&s?4:2,128&s?i.pos+=8:64&s?i.pos+=4:8&s&&(i.pos+=2)}return e.prototype.encode=function(){var e,t,n;for(t=new Hce(tue.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),iue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Vce(e,zce),e.prototype.tag="loca",e.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=2)r.push(2*e.readUInt16());return r}.call(this):function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=4)r.push(e.readUInt32());return r}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,a=0,i=0;i<n.length;++i)if(n[i]=r,a<t.length&&t[a]==i){++a,n[i]=r;var s=this.offsets[i],o=this.offsets[i+1]-s;o>0&&(r+=o)}for(var l=new Array(4*n.length),c=0;c<n.length;++c)l[4*c+3]=255&n[c],l[4*c+2]=(65280&n[c])>>8,l[4*c+1]=(16711680&n[c])>>16,l[4*c]=(4278190080&n[c])>>24;return l},e}(),sue=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,n,r,a;for(t in r=this.font.cmap.tables[0].codeMap,e={},a=this.subset)n=a[t],e[t]=r[n];return e},e.prototype.glyphsFor=function(e){var t,n,r,a,i,s,o;for(r={},i=0,s=e.length;i<s;i++)r[a=e[i]]=this.font.glyf.glyphFor(a);for(a in t=[],r)(null!=(n=r[a])?n.compound:void 0)&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(a in o=this.glyphsFor(t))n=o[a],r[a]=n;return r},e.prototype.encode=function(e,t){var n,r,a,i,s,o,l,c,u,h,d,A,p,f,m;for(r in n=Kce.encode(this.generateCmap(),"unicode"),i=this.glyphsFor(e),d={0:0},m=n.charMap)d[(o=m[r]).old]=o.new;for(A in h=n.maxGlyphID,i)A in d||(d[A]=h++);return c=function(e){var t,n;for(t in n={},e)n[e[t]]=t;return n}(d),u=Object.keys(c).sort(function(e,t){return e-t}),p=function(){var e,t,n;for(n=[],e=0,t=u.length;e<t;e++)s=u[e],n.push(c[s]);return n}(),a=this.font.glyf.encode(i,p,d),l=this.font.loca.encode(a.offsets,p),f={cmap:this.font.cmap.raw(),glyf:a.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(f["OS/2"]=this.font.os2.raw()),this.font.directory.encode(f)},e}();Ale.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(n){var r,a,i,s;if(Array.isArray(n))return"["+function(){var e,a,i;for(i=[],e=0,a=n.length;e<a;e++)r=n[e],i.push(t.convert(r));return i}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+e(n.getUTCFullYear(),4)+e(n.getUTCMonth(),2)+e(n.getUTCDate(),2)+e(n.getUTCHours(),2)+e(n.getUTCMinutes(),2)+e(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(a in i=["<<"],n)s=n[a],i.push("/"+a+" "+t.convert(s));return i.push(">>"),i.join("\n")}return""+n},t}();n(5239);const oue=new class{constructor(){this.pageWidth=210,this.pageHeight=297,this.margin=20,this.lineHeight=7,this.currentY=this.margin}async generateReport(e){const t=new Ale("p","mm","a4");this.currentY=this.margin,await this.addCoverPage(t,e),t.addPage(),this.currentY=this.margin,await this.addProjectOverview(t,e),t.addPage(),this.currentY=this.margin,await this.addVisualizations(t,e),t.addPage(),this.currentY=this.margin,this.addMeasurements(t,e),t.addPage(),this.currentY=this.margin,this.addProductDetails(t,e),t.addPage(),this.currentY=this.margin,this.addCostEstimate(t,e);const n=t.internal.getNumberOfPages();for(let r=1;r<=n;r++)t.setPage(r),this.addFooter(t,r,n,e);return t}addCoverPage(e,t){e.setFontSize(28),e.setFont("helvetica","bold"),e.setTextColor(30,64,175),e.text("Project Visualization Report",this.pageWidth/2,60,{align:"center"}),e.setFontSize(18),e.setTextColor(50,50,50),e.text(t.projectName||"Roof & Exterior Project",this.pageWidth/2,80,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Customer: ".concat(t.customerName||"N/A"),this.pageWidth/2,100,{align:"center"}),e.text("Address: ".concat(t.address||"N/A"),this.pageWidth/2,110,{align:"center"}),e.setFontSize(10),e.setTextColor(100,100,100),e.text("Generated: ".concat((new Date).toLocaleDateString()),this.pageWidth/2,130,{align:"center"}),e.setDrawColor(30,64,175),e.setLineWidth(.5),e.line(this.margin,150,this.pageWidth-this.margin,150),e.setFontSize(10),e.setTextColor(80,80,80);let n=170;["Powered by Rime + Malarkey","AI-Driven Visualization Technology","Contact: sales@rimehq.net","www.rimehq.net"].forEach(t=>{e.text(t,this.pageWidth/2,n,{align:"center"}),n+=7})}async addProjectOverview(e,t){this.addSectionTitle(e,"Project Overview"),e.setFontSize(11),e.setFont("helvetica","normal"),e.setTextColor(60,60,60);[{label:"Project Type",value:t.projectType||"Roof Replacement & Lighting"},{label:"Property Address",value:t.address||"N/A"},{label:"Customer",value:t.customerName||"N/A"},{label:"Project Date",value:(new Date).toLocaleDateString()},{label:"Estimated Duration",value:t.duration||"3-5 days"},{label:"Warranty",value:t.warranty||"25 years (Malarkey)"}].forEach(t=>{e.setFont("helvetica","bold"),e.text("".concat(t.label,":"),this.margin,this.currentY),e.setFont("helvetica","normal"),e.text(t.value,this.margin+50,this.currentY),this.currentY+=this.lineHeight}),this.currentY+=10,this.addSectionTitle(e,"Description",14),e.setFontSize(10),e.setFont("helvetica","normal");const n=t.description||"This project includes complete roof replacement with Malarkey Legacy shingles, Rime permanent lighting installation, and enhanced curb appeal visualization.";e.splitTextToSize(n,this.pageWidth-2*this.margin).forEach(t=>{e.text(t,this.margin,this.currentY),this.currentY+=6})}async addVisualizations(e,t){var n,r,a;this.addSectionTitle(e,"Visual Comparison");const i=(this.pageWidth-3*this.margin)/2;if(null!==(n=t.images)&&void 0!==n&&n.before){e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Before",this.margin,this.currentY),this.currentY+=7;try{const n=(await this.captureVisualization(t.images.before)).toDataURL("image/jpeg",.9);e.addImage(n,"JPEG",this.margin,this.currentY,i,80)}catch(_S){console.error("Failed to add before image:",_S)}}if(null!==(r=t.images)&&void 0!==r&&r.after||null!==(a=t.images)&&void 0!==a&&a.before){e.setFontSize(12),e.setFont("helvetica","bold"),e.text("After",this.margin+i+10,this.currentY-7);try{const n=(await this.captureVisualization(t.images.after||t.images.before,t)).toDataURL("image/jpeg",.9);e.addImage(n,"JPEG",this.margin+i+10,this.currentY,i,80)}catch(_S){console.error("Failed to add after image:",_S)}}this.currentY+=95,this.addSectionTitle(e,"Key Improvements",14);const s=["\u2713 ".concat(t.shingleColor||"Premium"," Malarkey Legacy Shingles"),"\u2713 Rime Permanent LED Lighting System","\u2713 Enhanced Curb Appeal","\u2713 Energy-Efficient Materials","\u2713 25-Year Warranty Coverage"];e.setFontSize(10),e.setFont("helvetica","normal"),s.forEach(t=>{e.text(t,this.margin+5,this.currentY),this.currentY+=6})}addMeasurements(e,t){this.addSectionTitle(e,"Measurements & Specifications");const n=t.measurements||{},r=[["Measurement","Value","Notes"],["Roof Area","".concat(n.roofArea||"TBD"," sq ft"),"Total coverage area"],["Roof Pitch","".concat(n.pitch||"TBD","\xb0"),"Average slope"],["Perimeter","".concat(n.perimeter||"TBD"," ft"),"Total edge length"],["Lighting Length","".concat(n.lightingLength||"TBD"," ft"),"Rime track length"],["Ridge Length","".concat(n.ridgeLength||"TBD"," ft"),"Peak ventilation"],["Gutter Length","".concat(n.gutterLength||"TBD"," ft"),"Drainage system"]];this.addTable(e,r),this.currentY+=10,this.addSectionTitle(e,"Technical Specifications",14),e.setFontSize(10);["Roofing System: Malarkey Legacy Series","Underlayment: Synthetic, ice & water barrier","Ventilation: Ridge vent + soffit vents","Lighting: Rime permanent LED (RGBW)","Control: WiFi-enabled smart control","Installation: Professional certified crew"].forEach(t=>{e.text("\u2022 ".concat(t),this.margin+5,this.currentY),this.currentY+=6})}addProductDetails(e,t){this.addSectionTitle(e,"Product Details"),this.addProductSection(e,"Malarkey Legacy Shingles",{color:t.shingleColor||"Weathered Wood",warranty:"25 Years Limited",class:"Class 4 Impact Resistance",windRating:"130 MPH",features:["Algae resistant","Energy Star rated","Recycled content"]}),this.currentY+=5,this.addProductSection(e,"Rime Permanent Lighting",{type:"RGBW LED System",control:"WiFi + Mobile App",colors:"16 million+ colors",warranty:"5 Years",features:["Weather resistant","Energy efficient","Programmable patterns"]}),this.currentY+=5,t.additionalProducts&&t.additionalProducts.length>0&&(this.addSectionTitle(e,"Additional Products",14),t.additionalProducts.forEach(t=>{e.setFontSize(10),e.text("\u2022 ".concat(t.name,": ").concat(t.description),this.margin+5,this.currentY),this.currentY+=6}))}addCostEstimate(e,t){this.addSectionTitle(e,"Cost Estimate");const n=t.estimate||{},r=[["Item","Quantity","Unit Price","Total"],["Malarkey Shingles","".concat(n.shingleSquares||"TBD"," sq"),"$".concat(n.shinglePrice||"0"),"$".concat(n.shingleTotal||"0")],["Underlayment","".concat(n.underlaymentSq||"TBD"," sq"),"$".concat(n.underlaymentPrice||"0"),"$".concat(n.underlaymentTotal||"0")],["Rime Lighting","".concat(n.lightingFt||"TBD"," ft"),"$".concat(n.lightingPrice||"0"),"$".concat(n.lightingTotal||"0")],["Labor - Roofing","Flat rate","-","$".concat(n.laborRoof||"0")],["Labor - Lighting","Flat rate","-","$".concat(n.laborLighting||"0")],["Permit & Disposal","Flat rate","-","$".concat(n.permits||"0")]];this.addTable(e,r,!0),this.currentY+=5,e.setFontSize(11),e.setFont("helvetica","bold");const a=n.subtotal||0,i=n.tax||0,s=n.total||0;e.text("Subtotal:",this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(a.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=7,e.text("Tax (".concat(n.taxRate||7,"%):"),this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(i.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=7,e.setFontSize(13),e.setTextColor(30,64,175),e.text("Total Estimate:",this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(s.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=15,e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(80,80,80);["Payment Terms: 50% deposit, 50% upon completion","Estimate valid for 30 days","Final cost may vary based on site conditions","All warranties as stated by manufacturers"].forEach(t=>{e.text(t,this.margin,this.currentY),this.currentY+=5})}addSectionTitle(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;e.setFontSize(n),e.setFont("helvetica","bold"),e.setTextColor(30,64,175),e.text(t,this.margin,this.currentY),this.currentY+=16===n?10:8,e.setDrawColor(30,64,175),e.setLineWidth(.3),e.line(this.margin,this.currentY-2,this.margin+e.getTextWidth(t),this.currentY-2),this.currentY+=5}addProductSection(e,t,n){e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(40,40,40),e.text(t,this.margin,this.currentY),this.currentY+=7,e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(60,60,60),Object.entries(n).forEach(t=>{let[n,r]=t;"features"===n&&Array.isArray(r)?(e.text("".concat(n,":"),this.margin+5,this.currentY),this.currentY+=5,r.forEach(t=>{e.text("  \u2022 ".concat(t),this.margin+10,this.currentY),this.currentY+=5})):(e.text("".concat(n,": ").concat(r),this.margin+5,this.currentY),this.currentY+=5)})}addTable(e,t){const n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?[80,30,30,30]:[60,50,50],r=this.margin;let a=this.currentY;t.forEach((t,i)=>{let s=r;t.forEach((t,r)=>{0===i?(e.setFontSize(9),e.setFont("helvetica","bold"),e.setFillColor(230,230,230),e.rect(s,a-5,n[r],7,"F")):(e.setFontSize(9),e.setFont("helvetica","normal")),e.text(t,s+2,a,{maxWidth:n[r]-4}),s+=n[r]}),a+=7}),this.currentY=a+5}addFooter(e,t,n,r){e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const a=this.pageHeight-10;e.text("Page ".concat(t," of ").concat(n),this.pageWidth/2,a,{align:"center"}),e.text("Powered by Rime + Malarkey \u2022 www.rimehq.net",this.margin,a)}async captureVisualization(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=800,t.height=600;const r=new Image;return r.crossOrigin="anonymous",new Promise(a=>{r.onload=()=>{n.drawImage(r,0,0,t.width,t.height),a(t)},r.src=e})}async save(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project-report.pdf";(await this.generateReport(e)).save(t)}async getBlob(e){return(await this.generateReport(e)).output("blob")}};const lue=new class{constructor(){this.pricing={shingles:{"weathered-wood":{perSquare:145,name:"Weathered Wood"},"midnight-black":{perSquare:155,name:"Midnight Black"},"storm-grey":{perSquare:150,name:"Storm Grey"},"antique-brown":{perSquare:148,name:"Antique Brown"},"terra-cotta":{perSquare:160,name:"Terra Cotta"},"forest-green":{perSquare:158,name:"Forest Green"},"autumn-red":{perSquare:165,name:"Autumn Red"}},underlayment:{perSquare:25},iceWaterBarrier:{perLinearFoot:3.5},ridgeVent:{perLinearFoot:8.75},dripEdge:{perLinearFoot:2.25},flashing:{perLinearFoot:5.5},lighting:{rime:{trackPerFoot:12.5,controllerBase:299,powerSupply:199,installationPerFoot:8}},gutters:{kStyle:{perLinearFoot:6.5,installationPerFoot:3},halfRound:{perLinearFoot:9.5,installationPerFoot:4}},labor:{roofing:{perSquare:85,minimumCharge:500},lighting:{perFoot:8,minimumCharge:400},gutters:{perFoot:3,minimumCharge:200}},disposal:{perSquare:15},permits:{flatFee:250}},this.wasteFactor={shingles:1.1,underlayment:1.1,lighting:1.05,gutters:1.05},this.taxRate=.07}calculateEstimate(e){const{measurements:t={},shingleColor:n="weathered-wood",lightingLength:r=0,gutterLength:a=0,gutterStyle:i="kStyle",includeRidgeVent:s=!0,includeGutters:o=!1}=e,l={materials:{},labor:{},subtotal:0,tax:0,total:0,breakdown:[]},c=t.roofArea||2e3,u=Math.ceil(c/100),h=u*this.wasteFactor.shingles,d=this.calculateShingleCost(n,h);l.materials.shingles=d,l.breakdown.push({category:"Materials",item:"Malarkey ".concat(this.pricing.shingles[n].name," Shingles"),quantity:"".concat(u," sq"),unitPrice:this.pricing.shingles[n].perSquare,total:d.total});const A=this.calculateUnderlaymentCost(h);if(l.materials.underlayment=A,l.breakdown.push({category:"Materials",item:"Synthetic Underlayment",quantity:"".concat(u," sq"),unitPrice:this.pricing.underlayment.perSquare,total:A.total}),s){const e=t.ridgeLength||.02*c,n=this.calculateRidgeVentCost(e);l.materials.ridgeVent=n,l.breakdown.push({category:"Materials",item:"Ridge Vent",quantity:"".concat(e.toFixed(0)," ft"),unitPrice:this.pricing.ridgeVent.perLinearFoot,total:n.total})}const p=t.perimeter||4*Math.sqrt(c),f=this.calculateDripEdgeCost(p);if(l.materials.dripEdge=f,l.breakdown.push({category:"Materials",item:"Drip Edge",quantity:"".concat(p.toFixed(0)," ft"),unitPrice:this.pricing.dripEdge.perLinearFoot,total:f.total}),r>0){const e=this.calculateLightingCost(r);l.materials.lighting=e,l.breakdown.push({category:"Materials",item:"Rime Permanent Lighting System",quantity:"".concat(r.toFixed(0)," ft"),unitPrice:this.pricing.lighting.rime.trackPerFoot,total:e.materials}),l.breakdown.push({category:"Materials",item:"Rime Controller & Power Supply",quantity:"1 set",unitPrice:this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply,total:this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply})}if(o&&a>0){const e=this.calculateGutterCost(a,i);l.materials.gutters=e,l.breakdown.push({category:"Materials",item:"".concat("kStyle"===i?"K-Style":"Half-Round"," Gutters"),quantity:"".concat(a.toFixed(0)," ft"),unitPrice:this.pricing.gutters[i].perLinearFoot,total:e.materials})}const m=this.calculateRoofingLabor(u);if(l.labor.roofing=m,l.breakdown.push({category:"Labor",item:"Roof Tear-off & Installation",quantity:"".concat(u," sq"),unitPrice:this.pricing.labor.roofing.perSquare,total:m.total}),r>0){const e=this.calculateLightingLabor(r);l.labor.lighting=e,l.breakdown.push({category:"Labor",item:"Lighting Installation",quantity:"".concat(r.toFixed(0)," ft"),unitPrice:this.pricing.labor.lighting.perFoot,total:e.total})}if(o&&a>0){const e=this.calculateGutterLabor(a);l.labor.gutters=e,l.breakdown.push({category:"Labor",item:"Gutter Installation",quantity:"".concat(a.toFixed(0)," ft"),unitPrice:this.pricing.labor.gutters.perFoot,total:e.total})}const g=this.calculateDisposalCost(u);return l.materials.disposal=g,l.breakdown.push({category:"Other",item:"Debris Removal & Disposal",quantity:"".concat(u," sq"),unitPrice:this.pricing.disposal.perSquare,total:g.total}),l.materials.permits={total:this.pricing.permits.flatFee},l.breakdown.push({category:"Other",item:"Permits & Inspection",quantity:"1",unitPrice:this.pricing.permits.flatFee,total:this.pricing.permits.flatFee}),l.subtotal=l.breakdown.reduce((e,t)=>e+t.total,0),l.tax=l.subtotal*this.taxRate,l.total=l.subtotal+l.tax,l.summary={materialsCost:l.breakdown.filter(e=>"Materials"===e.category||"Other"===e.category).reduce((e,t)=>e+t.total,0),laborCost:l.breakdown.filter(e=>"Labor"===e.category).reduce((e,t)=>e+t.total,0),roofArea:c,squares:u,costPerSquareFoot:l.total/c,taxRate:100*this.taxRate},l}calculateShingleCost(e,t){var n;const r=(null===(n=this.pricing.shingles[e])||void 0===n?void 0:n.perSquare)||150;return{quantity:t,pricePerSquare:r,total:t*r,color:e}}calculateUnderlaymentCost(e){const t=e*this.pricing.underlayment.perSquare;return{quantity:e,pricePerSquare:this.pricing.underlayment.perSquare,total:t}}calculateRidgeVentCost(e){const t=e*this.pricing.ridgeVent.perLinearFoot;return{quantity:e,pricePerFoot:this.pricing.ridgeVent.perLinearFoot,total:t}}calculateDripEdgeCost(e){const t=e*this.pricing.dripEdge.perLinearFoot;return{quantity:e,pricePerFoot:this.pricing.dripEdge.perLinearFoot,total:t}}calculateLightingCost(e){const t=e*this.wasteFactor.lighting*this.pricing.lighting.rime.trackPerFoot+this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply,n=e*this.pricing.lighting.rime.installationPerFoot;return{quantity:e,materials:t,installation:n,total:t+n}}calculateGutterCost(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kStyle";const n=e*this.wasteFactor.gutters*this.pricing.gutters[t].perLinearFoot,r=e*this.pricing.gutters[t].installationPerFoot;return{quantity:e,style:t,materials:n,installation:r,total:n+r}}calculateRoofingLabor(e){const t=e*this.pricing.labor.roofing.perSquare,n=Math.max(t,this.pricing.labor.roofing.minimumCharge);return{quantity:e,pricePerSquare:this.pricing.labor.roofing.perSquare,total:n}}calculateLightingLabor(e){const t=e*this.pricing.labor.lighting.perFoot,n=Math.max(t,this.pricing.labor.lighting.minimumCharge);return{quantity:e,pricePerFoot:this.pricing.labor.lighting.perFoot,total:n}}calculateGutterLabor(e){const t=e*this.pricing.labor.gutters.perFoot,n=Math.max(t,this.pricing.labor.gutters.minimumCharge);return{quantity:e,pricePerFoot:this.pricing.labor.gutters.perFoot,total:n}}calculateDisposalCost(e){const t=e*this.pricing.disposal.perSquare;return{quantity:e,pricePerSquare:this.pricing.disposal.perSquare,total:t}}applyDiscount(e,t){const n=e.subtotal*(t/100);return M(M({},e),{},{discount:{percent:t,amount:n},subtotal:e.subtotal-n,tax:(e.subtotal-n)*this.taxRate,total:(e.subtotal-n)*(1+this.taxRate)})}generateFinancingOptions(e){const t=[12,24,36,48,60],n=[];return[0,.0499,.0699,.0899].forEach(r=>{t.forEach(t=>{const a=this.calculateMonthlyPayment(e,r,t);n.push({term:t,rate:100*r,monthlyPayment:a.toFixed(2),totalPaid:(a*t).toFixed(2),totalInterest:(a*t-e).toFixed(2)})})}),n}calculateMonthlyPayment(e,t,n){if(0===t)return e/n;const r=t/12;return e*(r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1)}updatePricing(e,t,n){return!(!this.pricing[e]||!this.pricing[e][t])&&(this.pricing[e][t]=n,!0)}getPrice(e,t,n){return this.pricing[e]?t?(null===(r=this.pricing[e][t])||void 0===r?void 0:r[n])||this.pricing[e][t]:this.pricing[e][n]:null;var r}};function cue(){const e=(0,B.useRef)(),[t,n]=(0,B.useState)(null),[r,a]=(0,B.useState)(!1),[i,s]=(0,B.useState)(!1),[o,l]=(0,B.useState)(!1),[c,u]=(0,B.useState)(!1),[h,d]=(0,B.useState)("main"),{images:A,viewMode:p,setBeforeImage:f,setViewMode:m,ui:g,setLoading:y,resetAll:v,shingles:b,lighting:x,measurements:w,addShingleRegion:_,addLight:S}=pC(),C=[{id:"before",label:"Before",icon:Y},{id:"after",label:"After",icon:Y},{id:"compare",label:"Compare",icon:_C}],E=async()=>{y(!0);try{const e=lue.calculateEstimate({measurements:w,shingleColor:b.selectedColor,lightingLength:12*x.lights.length,includeRidgeVent:!0,includeGutters:!1}),t={projectName:"Roof Visualization Project",customerName:"Customer Name",address:"123 Main St",images:A,measurements:w,shingleColor:b.selectedColor,estimate:e};await oue.save(t,"project-report-".concat(Date.now(),".pdf")),alert("PDF report generated successfully!")}catch(_S){console.error("PDF generation failed:",_S),alert("Failed to generate PDF report.")}finally{y(!1)}};return(0,yi.jsxs)("div",{className:"control-panel bg-white rounded-lg shadow-lg p-4 space-y-4",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Controls"}),(0,yi.jsx)("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 p-1",title:"Reset All",children:(0,yi.jsx)(Ti,{className:"w-4 h-4"})})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"House Image"}),(0,yi.jsx)("input",{ref:e,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];t&&(n(t),a(!0))},className:"hidden"}),(0,yi.jsxs)("button",{onClick:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.click()},disabled:g.isLoading,className:"w-full py-2.5 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,yi.jsx)(SC,{className:"w-4 h-4"}),A.before?"Change Image":"Upload House Photo"]}),A.before&&(0,yi.jsx)("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:"\u2713 Image loaded successfully"})]}),r&&t&&(0,yi.jsx)(kC,{file:t,onValidationComplete:async e=>{if(e.valid){y(!0);try{const e=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;return new Promise((r,a)=>{const i=new Image,s=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(s);const o=document.createElement("canvas");let{width:l,height:c}=i;l>t&&(c=c*t/l,l=t),o.width=l,o.height=c,o.getContext("2d").drawImage(i,0,0,l,c),o.toBlob(t=>{if(t){const n=new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()});r({file:n,url:URL.createObjectURL(t),width:l,height:c})}else a(new Error("Failed to compress image"))},"image/jpeg",n)},i.onerror=()=>{URL.revokeObjectURL(s),a(new Error("Failed to load image"))},i.src=s})}(t,2048,.9);f(e.url),a(!1),n(null)}catch(_S){console.error("Image upload error:",_S),alert("Failed to process image")}finally{y(!1)}}}}),A.before&&(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"View Mode"}),(0,yi.jsx)("div",{className:"grid grid-cols-3 gap-2",children:C.map(e=>{const t=e.icon;return(0,yi.jsxs)("button",{onClick:()=>m(e.id),className:"py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ".concat(p===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(t,{className:"w-3 h-3"}),e.label]},e.id)})})]}),A.before&&"main"===h&&(0,yi.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,yi.jsxs)("h4",{className:"text-sm font-semibold mb-2 text-gray-700 flex items-center gap-2",children:["Phase 2 Features",(0,yi.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"NEW"})]}),(0,yi.jsxs)("div",{className:"space-y-2",children:[(0,yi.jsxs)("button",{onClick:async()=>{if(A.before){y(!0);try{const e=await yne.autoPlaceAll(A.before,{shingleColor:b.selectedColor,lightingPattern:"uniform"});e.placements.shingles.forEach(e=>{_(e)}),e.placements.lighting.forEach(e=>{S(e)}),alert("Auto-placement complete! Added ".concat(e.placements.shingles.length," shingle regions and ").concat(e.placements.lighting.length," lights."))}catch(_S){console.error("Auto-placement failed:",_S),alert("Auto-placement failed. Please try manual placement.")}finally{y(!1)}}},disabled:g.isLoading,className:"w-full py-2 px-3 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[(0,yi.jsx)(CC,{className:"w-4 h-4"}),"AI Auto-Placement"]}),(0,yi.jsxs)("button",{onClick:()=>d("measurement"),className:"w-full py-2 px-3 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(EC,{className:"w-4 h-4"}),"Measurement Tools"]}),(0,yi.jsxs)("button",{onClick:()=>d("camera"),className:"w-full py-2 px-3 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(NC,{className:"w-4 h-4"}),"8-Photo Capture (3D)"]}),(0,yi.jsxs)("button",{onClick:()=>d("estimate"),className:"w-full py-2 px-3 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(G,{className:"w-4 h-4"}),"Cost Estimate"]}),(0,yi.jsxs)("button",{onClick:E,disabled:g.isLoading,className:"w-full py-2 px-3 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[(0,yi.jsx)(os,{className:"w-4 h-4"}),"Generate PDF Report"]}),(0,yi.jsxs)("button",{onClick:()=>{const e=document.querySelector("canvas");e&&e.toBlob(e=>{const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="visualization-".concat(Date.now(),".png"),n.click()})},className:"w-full py-2 px-3 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(BC,{className:"w-4 h-4"}),"Export Image"]})]})]}),"camera"===h&&(0,yi.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,yi.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,yi.jsx)(FC,{onComplete:async e=>{y(!0);try{const t=await vne.processPhotos(e);alert("Photos uploaded successfully! Processing job ID: ".concat(t.jobId,". Estimated time: ").concat(Math.floor(t.estimatedTime/60)," minutes.")),s(!1),d("main")}catch(_S){console.error("Photo processing failed:",_S),alert("Photo processing failed: ".concat(_S.message))}finally{y(!1)}}})]}),"measurement"===h&&(0,yi.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,yi.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,yi.jsx)(DC,{})]}),"estimate"===h&&(0,yi.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,yi.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,yi.jsxs)("div",{className:"bg-gray-50 rounded p-3",children:[(0,yi.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"Quick Estimate"}),(0,yi.jsxs)("div",{className:"text-sm space-y-1",children:[(0,yi.jsxs)("div",{className:"flex justify-between",children:[(0,yi.jsx)("span",{className:"text-gray-600",children:"Roof Area:"}),(0,yi.jsxs)("span",{className:"font-medium",children:[w.roofArea||0," sq ft"]})]}),(0,yi.jsxs)("div",{className:"flex justify-between",children:[(0,yi.jsx)("span",{className:"text-gray-600",children:"Shingles:"}),(0,yi.jsx)("span",{className:"font-medium",children:b.selectedColor})]}),(0,yi.jsxs)("div",{className:"flex justify-between",children:[(0,yi.jsx)("span",{className:"text-gray-600",children:"Lighting:"}),(0,yi.jsxs)("span",{className:"font-medium",children:[x.lights.length," fixtures"]})]})]}),(0,yi.jsx)("button",{onClick:E,className:"w-full mt-3 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700",children:"Generate Full Report"})]})]}),"main"===h&&(0,yi.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,yi.jsx)("p",{className:"text-xs text-gray-600",children:(0,yi.jsx)("strong",{children:"How to use:"})}),(0,yi.jsxs)("ul",{className:"text-xs text-gray-600 mt-2 space-y-1 pl-4",children:[(0,yi.jsx)("li",{children:"\u2022 Upload a house photo to begin"}),(0,yi.jsx)("li",{children:"\u2022 Use AI Auto-Placement for instant results"}),(0,yi.jsx)("li",{children:"\u2022 Measure roof surfaces with tools"}),(0,yi.jsx)("li",{children:"\u2022 Capture 8 photos for 3D reconstruction"}),(0,yi.jsx)("li",{children:"\u2022 Generate cost estimates & PDF reports"}),(0,yi.jsx)("li",{children:"\u2022 Export final visualization"})]})]})]})}const uue=H("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),hue=H("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),due=H("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function Aue(e){var t;let{colors:n,selectedColor:r,onSelectColor:a,title:i="Colors"}=e;return(0,yi.jsxs)("div",{className:"color-palette",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold mb-3 text-gray-700",children:i}),(0,yi.jsx)("div",{className:"grid grid-cols-4 gap-2",children:n.map(e=>(0,yi.jsx)("button",{onClick:()=>a(e.id),className:"relative aspect-square rounded-lg border-2 transition-all hover:scale-105 ".concat(r===e.id?"border-blue-600 ring-2 ring-blue-200":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:e.hex},title:e.name,children:r===e.id&&(0,yi.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,yi.jsx)("div",{className:"bg-white rounded-full p-0.5",children:(0,yi.jsx)(due,{className:"w-4 h-4 text-blue-600"})})})},e.id))}),(0,yi.jsx)("div",{className:"mt-2 text-xs text-gray-600 font-medium",children:(null===(t=n.find(e=>e.id===r))||void 0===t?void 0:t.name)||"Select a color"})]})}function pue(){const{shingles:e,setShingleColor:t,setShingleOpacity:n,addShingleRegion:r,removeShingleRegion:a}=pC(),i=Object.entries(mC).map(e=>{let[t,n]=e;return{id:t,name:n.name,hex:n.hex,color:n.baseColor}});return(0,yi.jsxs)("div",{className:"shingle-selector bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,yi.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Malarkey Shingles"}),(0,yi.jsxs)("div",{className:"group relative",children:[(0,yi.jsx)(IC,{className:"w-4 h-4 text-gray-400 cursor-help"}),(0,yi.jsx)("div",{className:"absolute right-0 top-6 hidden group-hover:block bg-gray-900 text-white text-xs rounded p-2 w-48 z-10",children:"Select a shingle color and click Apply to add to your roof"})]})]}),(0,yi.jsx)(Aue,{colors:i,selectedColor:e.selectedColor,onSelectColor:t,title:"Select Shingle Color"}),(0,yi.jsxs)("div",{className:"mt-4",children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Opacity: ",Math.round(100*e.opacity),"%"]}),(0,yi.jsx)("input",{type:"range",min:"0",max:"100",value:100*e.opacity,onChange:e=>n(e.target.value/100),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),(0,yi.jsxs)("button",{onClick:()=>{const t={id:Date.now(),color:e.selectedColor,opacity:e.opacity,position:[0,0,0],scale:[1,1,1]};r(t)},className:"w-full mt-4 py-2.5 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(Ci,{className:"w-4 h-4"}),"Apply to Roof"]}),e.appliedRegions.length>0&&(0,yi.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Applied Shingles"}),(0,yi.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:e.appliedRegions.map(e=>{const t=i.find(t=>t.id===e.color);return(0,yi.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,yi.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:null===t||void 0===t?void 0:t.hex}}),(0,yi.jsx)("span",{className:"text-sm text-gray-700",children:null===t||void 0===t?void 0:t.name})]}),(0,yi.jsx)("button",{onClick:()=>a(e.id),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Remove"})]},e.id)})})]}),(0,yi.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:(0,yi.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,yi.jsx)("strong",{children:"Premium Malarkey Shingles"}),(0,yi.jsx)("br",{}),"Class 4 Impact Resistant \u2022 50-Year Warranty"]})})]})}const fue=H("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),mue=H("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),gue=H("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);function yue(){const{lighting:e,setLightingEnabled:t,setTrackColor:n,setLightingPattern:r,setLightingColor:a,setLightingBrightness:i,addLight:s,removeLight:o,generateDefaultLighting:l}=pC(),c=Object.entries(gC).map(e=>{let[t,n]=e;return{id:t,name:n.name,hex:n.hex,color:n.color}}),[u,h]=(0,B.useState)("auto");return(0,yi.jsxs)("div",{className:"lighting-designer bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,yi.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[(0,yi.jsx)(hue,{className:"w-5 h-5 text-purple-600"}),"Rime Lighting System"]}),(0,yi.jsx)("button",{onClick:()=>t(!e.enabled),className:"p-2 rounded-lg transition-colors ".concat(e.enabled?"bg-purple-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"),title:e.enabled?"Lighting On":"Lighting Off",children:(0,yi.jsx)(fue,{className:"w-4 h-4"})})]}),(0,yi.jsx)("div",{className:"mb-4",children:(0,yi.jsxs)("div",{className:"flex gap-2",children:[(0,yi.jsxs)("button",{onClick:()=>h("auto"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("auto"===u?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(mue,{className:"w-4 h-4 inline mr-1"}),"Auto Design"]}),(0,yi.jsxs)("button",{onClick:()=>h("manual"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("manual"===u?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(gue,{className:"w-4 h-4 inline mr-1"}),"Manual"]})]})}),"auto"===u?(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("button",{onClick:l,className:"w-full py-2.5 px-4 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(gue,{className:"w-4 h-4"}),"Generate Complete Lighting Design"]}),(0,yi.jsx)("p",{className:"mt-2 text-xs text-gray-600 text-center",children:"Automatically places professional lighting around the house"})]}):(0,yi.jsx)("div",{children:(0,yi.jsxs)("button",{onClick:()=>{const t={position:[0,5,-20],color:e.color,intensity:e.brightness/100*3,range:15,beamWidth:2,beamLength:10};s(t)},className:"w-full py-2.5 px-4 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2",children:[(0,yi.jsx)(Ci,{className:"w-4 h-4"}),"Add Light Fixture"]})}),(0,yi.jsx)("div",{className:"mt-4",children:(0,yi.jsx)(Aue,{colors:c,selectedColor:e.trackColor,onSelectColor:n,title:"Aluminum Track Color"})}),(0,yi.jsxs)("div",{className:"mt-4",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"LED Color"}),(0,yi.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{name:"Warm White",value:"#fff8dc"},{name:"Cool White",value:"#ffffff"},{name:"Amber",value:"#ffbf00"},{name:"Red",value:"#ff0000"},{name:"Green",value:"#00ff00"},{name:"Blue",value:"#0000ff"},{name:"Purple",value:"#800080"},{name:"Cyan",value:"#00ffff"}].map(t=>(0,yi.jsx)("button",{onClick:()=>a(t.value),className:"aspect-square rounded-lg border-2 transition-all hover:scale-105 ".concat(e.color===t.value?"border-purple-600 ring-2 ring-purple-200":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:t.value},title:t.name},t.value))})]}),(0,yi.jsxs)("div",{className:"mt-4",children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Lighting Pattern"}),(0,yi.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{id:"solid",name:"Solid",icon:"\u2b24"},{id:"chase",name:"Chase",icon:"\u2192"},{id:"fade",name:"Fade",icon:"\u25d0"},{id:"holiday",name:"Holiday",icon:"\ud83c\udf84"}].map(t=>(0,yi.jsxs)("button",{onClick:()=>r(t.id),className:"py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat(e.pattern===t.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)("span",{className:"mr-1",children:t.icon}),t.name]},t.id))})]}),(0,yi.jsxs)("div",{className:"mt-4",children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Brightness: ",e.brightness,"%"]}),(0,yi.jsx)("input",{type:"range",min:"0",max:"100",value:e.brightness,onChange:e=>i(Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})]}),e.lights.length>0&&(0,yi.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,yi.jsxs)("h4",{className:"text-sm font-semibold text-gray-700",children:["Installed Lights (",e.lights.length,")"]}),e.lights.length>0&&(0,yi.jsx)("button",{onClick:()=>e.lights.forEach(e=>o(e.id)),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"})]}),(0,yi.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:e.lights.map(e=>(0,yi.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,yi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,yi.jsx)(hue,{className:"w-3 h-3 text-purple-600"}),(0,yi.jsxs)("span",{className:"text-xs text-gray-700",children:["Position: ",e.position.map(e=>e.toFixed(0)).join(", ")]})]}),(0,yi.jsx)("button",{onClick:()=>o(e.id),className:"text-red-600 hover:text-red-800",children:(0,yi.jsx)(PC,{className:"w-3 h-3"})})]},e.id))})]}),(0,yi.jsx)("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-100",children:(0,yi.jsxs)("p",{className:"text-xs text-purple-800",children:[(0,yi.jsx)("strong",{children:"Rime Lighting - Jellyfish Style"}),(0,yi.jsx)("br",{}),"RGB+W LED \u2022 App Controlled \u2022 Weather Resistant"]})})]})}function vue(){const{ui:e,setActivePanel:t}=pC(),n=[{id:"products",label:"Shingles",icon:uue},{id:"lighting",label:"Lighting",icon:hue}];return(0,yi.jsxs)("div",{className:"product-panel bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,yi.jsx)("div",{className:"flex border-b border-gray-200",children:n.map(n=>{const r=n.icon;return(0,yi.jsxs)("button",{onClick:()=>t(n.id),className:"flex-1 py-3 px-4 font-medium text-sm transition-colors flex items-center justify-center gap-2 ".concat(e.activePanel===n.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50"),children:[(0,yi.jsx)(r,{className:"w-4 h-4"}),n.label]},n.id)})}),(0,yi.jsxs)("div",{className:"p-4",children:["products"===e.activePanel&&(0,yi.jsx)(pue,{}),"lighting"===e.activePanel&&(0,yi.jsx)(yue,{})]})]})}function bue(){const{ui:e,toggleControls:t}=pC();return(0,yi.jsxs)("div",{className:"visualization-360 h-full w-full relative bg-gray-900",children:[(0,yi.jsx)("div",{className:"absolute inset-0",children:(0,yi.jsx)(wC,{})}),e.showControls&&(0,yi.jsx)("div",{className:"absolute top-4 left-4 w-80 max-h-[calc(100vh-120px)] overflow-y-auto z-10",children:(0,yi.jsx)(cue,{})}),e.showControls&&(0,yi.jsx)("div",{className:"absolute top-4 right-4 w-96 max-h-[calc(100vh-120px)] overflow-y-auto z-10",children:(0,yi.jsx)(vue,{})}),(0,yi.jsxs)("button",{onClick:t,className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-20 bg-white hover:bg-gray-100 text-gray-800 px-4 py-2 rounded-full shadow-lg font-medium text-sm transition-colors flex items-center gap-2",title:e.showControls?"Hide Controls":"Show Controls",children:[(0,yi.jsx)(Y,{className:"w-4 h-4"}),e.showControls?"Hide Controls":"Show Controls"]}),e.isLoading&&(0,yi.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,yi.jsxs)("div",{className:"bg-white rounded-lg p-6 flex items-center gap-3",children:[(0,yi.jsx)(j,{className:"w-6 h-6 text-blue-600 animate-spin"}),(0,yi.jsx)("span",{className:"text-gray-800 font-medium",children:"Processing..."})]})}),(0,yi.jsx)("div",{className:"absolute bottom-4 right-4 z-10 bg-black bg-opacity-60 text-white px-3 py-1.5 rounded text-xs",children:"Powered by Rime + Malarkey \u2022 AI Visualization Technology"})]})}const xue=["children"],wue=e=>{let{title:t,children:n}=e;return(0,yi.jsxs)("div",{className:"mb-6",children:[(0,yi.jsx)("h4",{className:"text-md font-semibold text-gray-800 border-b pb-2 mb-4",children:t}),(0,yi.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n})]})},_ue=e=>{let{label:t,children:n,fullWidth:r=!1}=e;return(0,yi.jsxs)("div",{className:r?"lg:col-span-3 md:col-span-2":"",children:[(0,yi.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),n]})},Sue=e=>(0,yi.jsx)("input",M(M({},e),{},{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})),Cue=e=>{let{children:t}=e,n=F(e,xue);return(0,yi.jsx)("select",M(M({},n),{},{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:t}))},Eue=e=>(0,yi.jsx)("textarea",M(M({},e),{},{rows:4,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})),Nue={customerName:"",address:"",phoneNumber:"",email:"",dabellaQuote:"",quality:"Cold",notes:"",disposition:"New",leadSource:"Door Knock",roofAge:"",roofType:"Asphalt Shingle"};const Bue=function(e){let{initialData:t,onSubmit:n,onCancel:r,isEdit:a=!1}=e;const[i,s]=(0,B.useState)(()=>t||Nue),[o,l]=(0,B.useState)(!1),c=(0,B.useCallback)(e=>s(t=>M(M({},t),{},{[e.target.name]:e.target.value})),[]),u=(0,B.useCallback)(async e=>{e.preventDefault(),l(!0);const t=M({},i);if(t.address&&(!t.latitude||!t.longitude))try{const e=await ne.geocodeAddress(t.address);e.success&&(t.latitude=e.latitude,t.longitude=e.longitude)}catch(_S){console.warn("Geocoding failed during submission:",_S)}await n(t),l(!1)},[i,n]),h=(0,B.useMemo)(()=>["New","Scheduled","Insurance","Quoted","Follow Up","Closed Sold","Closed Lost"],[]);return(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40",children:(0,yi.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col",children:[(0,yi.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,yi.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:a?"Edit Lead":"Add New Lead"}),(0,yi.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{size:24})})]}),(0,yi.jsx)("div",{className:"p-6 overflow-y-auto",children:(0,yi.jsxs)("form",{onSubmit:u,children:[(0,yi.jsxs)(wue,{title:"Customer Information",children:[(0,yi.jsx)(_ue,{label:"Full Name *",children:(0,yi.jsx)(Sue,{name:"customerName",value:i.customerName,onChange:c,required:!0})}),(0,yi.jsx)(_ue,{label:"Phone Number *",children:(0,yi.jsx)(Sue,{name:"phoneNumber",value:i.phoneNumber,onChange:c,required:!0})}),(0,yi.jsx)(_ue,{label:"Email",children:(0,yi.jsx)(Sue,{name:"email",type:"email",value:i.email,onChange:c})}),(0,yi.jsx)(_ue,{label:"Address",fullWidth:!0,children:(0,yi.jsx)(Sue,{name:"address",value:i.address,onChange:c,placeholder:"Full address for map location"})})]}),(0,yi.jsxs)(wue,{title:"Lead Details",children:[(0,yi.jsx)(_ue,{label:"Lead Source",children:(0,yi.jsxs)(Cue,{name:"leadSource",value:i.leadSource,onChange:c,children:[(0,yi.jsx)("option",{children:"Door Knock"}),(0,yi.jsx)("option",{children:"Rime"}),(0,yi.jsx)("option",{children:"Adverta"}),(0,yi.jsx)("option",{children:"Referral"}),(0,yi.jsx)("option",{children:"DaBella"})]})}),(0,yi.jsx)(_ue,{label:"Quality",children:(0,yi.jsxs)(Cue,{name:"quality",value:i.quality,onChange:c,children:[(0,yi.jsx)("option",{children:"Hot"}),(0,yi.jsx)("option",{children:"Warm"}),(0,yi.jsx)("option",{children:"Cold"})]})}),(0,yi.jsx)(_ue,{label:"Disposition",children:(0,yi.jsx)(Cue,{name:"disposition",value:i.disposition,onChange:c,children:h.map(e=>(0,yi.jsx)("option",{value:e,children:e},e))})})]}),(0,yi.jsxs)(wue,{title:"Job & Quote Details",children:[(0,yi.jsx)(_ue,{label:"Roof Age",children:(0,yi.jsx)(Sue,{name:"roofAge",value:i.roofAge,onChange:c})}),(0,yi.jsx)(_ue,{label:"Roof Type",children:(0,yi.jsxs)(Cue,{name:"roofType",value:i.roofType,onChange:c,children:[(0,yi.jsx)("option",{children:"Asphalt Shingle"}),(0,yi.jsx)("option",{children:"Metal"}),(0,yi.jsx)("option",{children:"Tile"}),(0,yi.jsx)("option",{children:"TPO"}),(0,yi.jsx)("option",{children:"Wood"})]})}),(0,yi.jsx)(_ue,{label:"Quote Amount",children:(0,yi.jsx)(Sue,{name:"dabellaQuote",value:i.dabellaQuote,onChange:c,placeholder:"$15,000"})})]}),(0,yi.jsx)(wue,{title:"Notes",children:(0,yi.jsx)(_ue,{label:"Notes",fullWidth:!0,children:(0,yi.jsx)(Eue,{name:"notes",value:i.notes,onChange:c})})}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t mt-6",children:[(0,yi.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,yi.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:o?(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)(j,{className:"animate-spin h-4 w-4 mr-2"}),"Saving..."]}):a?"Update Lead":"Add Lead"})]})]})})]})})},kue=H("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Iue=H("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),Tue=[{id:"no-answer",label:"No Answer",color:"#EF4444",bgColor:"bg-red-50 hover:bg-red-100 border-red-200",icon:"\ud83d\udcf5",autoNote:"No answer - will try again later",status:"No Answer",keepOpen:!0,suggestRetry:!0},{id:"voicemail",label:"No Answer Left Voicemail",color:"#F59E0B",bgColor:"bg-orange-50 hover:bg-orange-100 border-orange-200",icon:"\ud83d\udced",autoNote:"Left voicemail with callback request",status:"Left Voicemail",keepOpen:!0,createReminder:!0,reminderHours:24},{id:"confirmed",label:"Called and Confirmed Appointment",color:"#10B981",bgColor:"bg-green-50 hover:bg-green-100 border-green-200",icon:"\u2705",autoNote:"Appointment confirmed - customer ready",status:"Completed",updateLeadStatus:"scheduled",promptCalendar:!0},{id:"not-interested",label:"Not Interested",color:"#6B7280",bgColor:"bg-gray-50 hover:bg-gray-100 border-gray-200",icon:"\u274c",autoNote:"Customer declined - not interested at this time",status:"Completed",updateLeadStatus:"lost",requiresConfirmation:!0},{id:"follow-up",label:"Follow-up Needed",color:"#3B82F6",bgColor:"bg-blue-50 hover:bg-blue-100 border-blue-200",icon:"\ud83d\udd14",autoNote:"Needs follow-up - set reminder",status:"Completed",createReminder:!0,updateLeadStatus:"follow-up"}],Mue=[{value:1,label:"1 minute"},{value:2,label:"2 minutes"},{value:5,label:"5 minutes"},{value:10,label:"10 minutes"},{value:15,label:"15 minutes"},{value:30,label:"30 minutes"}],Fue=[{value:"tomorrow",label:"Tomorrow morning (9 AM)",hours:24},{value:"3days",label:"In 3 days",hours:72},{value:"week",label:"Next week",hours:168},{value:"custom",label:"Custom date/time"}];const Rue=function(e){let{lead:t,onClose:n,onLogCommunication:r,onUpdateLead:a}=e;const[i,s]=(0,B.useState)("Call"),[o,l]=(0,B.useState)(null),[c,u]=(0,B.useState)(5),[h,d]=(0,B.useState)(""),[A,p]=(0,B.useState)(!1),[f,m]=(0,B.useState)("tomorrow"),[g,y]=(0,B.useState)(""),[v,b]=(0,B.useState)(!1),x=async e=>{if(l(e),e.requiresConfirmation){if(!window.confirm('Are you sure you want to mark this lead as "'.concat(e.updateLeadStatus,'"?')))return void l(null)}e.createReminder?p(!0):await w(e)},w=async e=>{b(!0);try{const s={leadId:t.id,customerName:t.customerName,phoneNumber:t.phoneNumber,communicationType:i,dateTime:(new Date).toISOString(),status:e.status,duration:c,notes:h||e.autoNote,createdBy:"user@example.com",createdAt:(new Date).toISOString()};await r(s),e.updateLeadStatus&&await a(M(M({},t),{},{disposition:e.updateLeadStatus}));let o="Communication logged successfully!";if(e.updateLeadStatus&&(o+=" Lead status updated to ".concat(e.updateLeadStatus,".")),e.promptCalendar&&(o+=" Check Google Calendar for appointment details."),alert(o),e.suggestRetry){const e=new Date(Date.now()+72e5);alert("Suggested retry time: ".concat(e.toLocaleTimeString()))}if(e.promptCalendar){window.confirm("Would you like to open Google Calendar to verify the appointment?")&&window.open("https://calendar.google.com","_blank")}e.keepOpen?(l(null),d("")):n()}catch(_S){console.error("Error logging communication:",_S),alert("Failed to log communication. Please try again.")}finally{b(!1)}},_=async()=>{alert("Reminder set for ".concat(f)),p(!1),await w(o)};return A?(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,yi.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full shadow-2xl",children:[(0,yi.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,yi.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Set Reminder"}),(0,yi.jsx)("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{size:24})})]}),(0,yi.jsxs)("div",{className:"p-6 space-y-4",children:[(0,yi.jsxs)("p",{className:"text-sm text-gray-600",children:["When should we remind you to follow up with ",t.customerName,"?"]}),(0,yi.jsx)("div",{className:"space-y-2",children:Fue.map(e=>(0,yi.jsxs)("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,yi.jsx)("input",{type:"radio",name:"reminder",value:e.value,checked:f===e.value,onChange:e=>m(e.target.value),className:"mr-3"}),(0,yi.jsx)("span",{className:"text-sm",children:e.label})]},e.value))}),"custom"===f&&(0,yi.jsx)("input",{type:"datetime-local",value:g,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,yi.jsx)("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,yi.jsx)("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Set Reminder & Log"})]})]})}):(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,yi.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full shadow-2xl",children:[(0,yi.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Log ",i," - ",t.customerName]}),(0,yi.jsx)("p",{className:"text-sm text-gray-500",children:t.phoneNumber})]}),(0,yi.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{size:24})})]}),(0,yi.jsxs)("div",{className:"p-6 space-y-6",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Communication Type"}),(0,yi.jsxs)("div",{className:"flex space-x-2",children:[(0,yi.jsxs)("button",{onClick:()=>s("Call"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("Call"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(rs,{size:16,className:"mr-2"}),"Call"]}),(0,yi.jsxs)("button",{onClick:()=>s("SMS"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("SMS"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(is,{size:16,className:"mr-2"}),"SMS"]}),(0,yi.jsxs)("button",{onClick:()=>s("Email"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("Email"===i?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,yi.jsx)(ss,{size:16,className:"mr-2"}),"Email"]})]})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Outcomes:"}),(0,yi.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Tue.map(e=>(0,yi.jsxs)("button",{onClick:()=>x(e),disabled:v,className:"p-4 border-2 rounded-lg text-center transition-all ".concat(e.bgColor," ").concat((null===o||void 0===o?void 0:o.id)===e.id?"ring-2 ring-offset-2 ring-blue-500":""," ").concat(v?"opacity-50 cursor-not-allowed":""),style:{borderColor:e.color+"40"},children:[(0,yi.jsx)("div",{className:"text-2xl mb-1",children:e.icon}),(0,yi.jsx)("div",{className:"text-xs font-medium text-gray-800 leading-tight",children:e.label})]},e.id))})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration"}),(0,yi.jsx)("select",{value:c,onChange:e=>u(Number(e.target.value)),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500",children:Mue.map(e=>(0,yi.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,yi.jsx)("textarea",{value:h,onChange:e=>d(e.target.value),placeholder:o?o.autoNote:"Enter any additional notes...",className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500",rows:3})]})]}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,yi.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",disabled:v,children:"Cancel"}),(0,yi.jsx)("button",{onClick:()=>{o?x(o):alert("Please select a quick outcome tag")},disabled:!o||v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Logging...":"Quick Log & Close"})]})]})})},Lue=B.memo(e=>{let{icon:t,label:n,value:r}=e;return(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[t,n]}),(0,yi.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:r||(0,yi.jsx)("span",{className:"text-gray-400",children:"Not provided"})})]})});const Uue=function(e){let{lead:t,onEdit:n,onDelete:r,onClose:a,onNavigateToTab:i,onLogCommunication:s,onUpdateLead:o}=e;const[l,c]=(0,B.useState)(!1);return(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40 animate-fade-in",children:(0,yi.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[(0,yi.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[(0,yi.jsx)(ns,{className:"mr-3 text-blue-600"}),t.customerName]}),(0,yi.jsx)("p",{className:"text-sm text-gray-500",children:t.address})]}),(0,yi.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:(0,yi.jsx)(Ii,{size:24})})]}),(0,yi.jsxs)("div",{className:"p-6 overflow-y-auto",children:[(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(rs,{size:14,className:"mr-2"}),label:"Phone",value:(0,yi.jsx)("a",{href:"tel:".concat(t.phoneNumber),className:"text-blue-600 hover:underline",children:t.phoneNumber})}),(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(ss,{size:14,className:"mr-2"}),label:"Email",value:(0,yi.jsx)("a",{href:"mailto:".concat(t.email),className:"text-blue-600 hover:underline",children:t.email})}),(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(Q,{size:14,className:"mr-2"}),label:"Quote",value:(0,yi.jsx)("span",{className:"font-bold text-green-700",children:t.dabellaQuote})})]}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(kue,{size:14,className:"mr-2"}),label:"Quality",value:(0,yi.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("Hot"===t.quality?"bg-red-100 text-red-800":"Warm"===t.quality?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:t.quality})}),(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(W,{size:14,className:"mr-2"}),label:"Disposition",value:t.disposition}),(0,yi.jsx)(Lue,{icon:(0,yi.jsx)(Iue,{size:14,className:"mr-2"}),label:"Lead Source",value:t.leadSource})]}),(0,yi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,yi.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>i("calendar"),children:[(0,yi.jsx)(q,{size:24,className:"mx-auto text-blue-600 mb-2"}),(0,yi.jsx)("h4",{className:"font-semibold text-sm",children:"Appointments"}),(0,yi.jsx)("p",{className:"text-xs text-gray-500",children:"Click to view calendar"})]}),(0,yi.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,yi.jsx)("h4",{className:"font-semibold text-sm mb-3 text-center",children:"Communications"}),(0,yi.jsxs)("div",{className:"space-y-2",children:[(0,yi.jsxs)("button",{onClick:()=>{window.open("mailto:".concat(t.email,"?from=brandon@rimehq.net&subject=Follow up - ").concat(t.customerName)),c(!0)},className:"w-full px-3 py-2 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 flex items-center justify-center",children:[(0,yi.jsx)(ss,{size:12,className:"mr-1"}),"Email"]}),(0,yi.jsxs)("button",{onClick:()=>{var e;window.open("https://voice.google.com/u/0/calls?a=nc,%2B1".concat(null===(e=t.phoneNumber)||void 0===e?void 0:e.replace(/\D/g,""))),c(!0)},className:"w-full px-3 py-2 bg-green-600 text-white rounded text-xs hover:bg-green-700 flex items-center justify-center",children:[(0,yi.jsx)(rs,{size:12,className:"mr-1"}),"Call"]}),(0,yi.jsxs)("button",{onClick:()=>{var e;window.open("https://voice.google.com/u/0/messages?contact=%2B1".concat(null===(e=t.phoneNumber)||void 0===e?void 0:e.replace(/\D/g,""))),c(!0)},className:"w-full px-3 py-2 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center justify-center",children:[(0,yi.jsx)(ss,{size:12,className:"mr-1"}),"SMS"]}),(0,yi.jsx)("button",{onClick:()=>c(!0),className:"w-full px-3 py-2 bg-indigo-600 text-white rounded text-xs hover:bg-indigo-700 flex items-center justify-center font-semibold",children:"\ud83d\udccb Log Communication"})]})]}),(0,yi.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-green-50 transition-colors",onClick:()=>i("map",t.address),children:[(0,yi.jsx)(zi,{size:24,className:"mx-auto text-green-600 mb-2"}),(0,yi.jsx)("h4",{className:"font-semibold text-sm",children:"Location"}),(0,yi.jsx)("p",{className:"text-xs text-gray-500",children:"View on map"})]})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Notes"}),(0,yi.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-4 rounded-md whitespace-pre-wrap",children:t.notes||"No notes for this lead."})]})]}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,yi.jsxs)("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",children:[(0,yi.jsx)(PC,{size:16,className:"mr-2"}),"Delete"]}),(0,yi.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[(0,yi.jsx)(Li,{size:16,className:"mr-2"}),"Edit Lead"]})]})]})}),l&&(0,yi.jsx)(Rue,{lead:t,onClose:()=>c(!1),onLogCommunication:async e=>{s?await s(e):console.log("Communication logged:",e)},onUpdateLead:async e=>{o&&await o(e)}})]})},Pue=["children"],Due=e=>{let{title:t,children:n}=e;return(0,yi.jsxs)("div",{className:"mb-8",children:[(0,yi.jsx)("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-3 mb-6",children:t}),(0,yi.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n})]})},Oue=e=>{let{label:t,children:n,fullWidth:r=!1,required:a=!1}=e;return(0,yi.jsxs)("div",{className:r?"lg:col-span-3 md:col-span-2":"",children:[(0,yi.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",a&&(0,yi.jsx)("span",{className:"text-red-500",children:"*"})]}),n]})},zue=e=>(0,yi.jsx)("input",M(M({},e),{},{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),Hue=e=>(0,yi.jsx)("input",M(M({},e),{},{type:"number",step:"0.01",min:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),jue=e=>(0,yi.jsx)("input",M(M({},e),{},{type:"date",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),Que=e=>{let{children:t}=e,n=F(e,Pue);return(0,yi.jsx)("select",M(M({},n),{},{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",children:t}))},Vue=e=>(0,yi.jsx)("textarea",M(M({},e),{},{rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-vertical"})),Wue={firstName:"",lastName:"",customerName:"",phoneNumber:"",email:"",address:"",date:(new Date).toISOString().split("T")[0],leadSource:"Door Knock",quality:"Cold",disposition:"New",roofAge:"",roofType:"Asphalt Shingle",dabellaQuote:"",notes:"",sqFt:"",ridgeLf:"",valleyLf:"",eavesLf:"",ridgeVents:"",turbine:"",rimeFlow:"",highProfileRidgeCap:"",valleyMetal:"",pipes1Half:"",pipes2:"",pipes3:"",pipes4:"",gables:"",turtleBacks:"",satellite:"",chimney:"",solar:"",swampCooler:"",guttersLf:"",downspouts:"",gutterGuardLf:"",permanentLighting:""};const Gue=function(e){let{initialData:t,onSubmit:n,onCancel:r,isEdit:a=!1}=e;const[i,s]=(0,B.useState)(()=>t||Wue),[o,l]=(0,B.useState)(!1),c=(0,B.useCallback)(e=>{const{name:t,value:n}=e.target;s(e=>M(M({},e),{},{[t]:n}))},[]),u=(0,B.useCallback)(async e=>{e.preventDefault(),l(!0);try{const e=M({},i);e.customerName||!e.firstName&&!e.lastName||(e.customerName="".concat(e.firstName||""," ").concat(e.lastName||"").trim()),await n(e)}catch(_S){console.error("Form submission error:",_S)}finally{l(!1)}},[i,n]);return(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,yi.jsxs)("div",{className:"bg-white rounded-xl max-w-7xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[(0,yi.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:a?"Edit Job Count":"Add New Job Count"}),(0,yi.jsx)("p",{className:"text-gray-600 mt-1",children:a?"Update job count information":"Enter customer and job measurement details"})]}),(0,yi.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:(0,yi.jsx)(Ii,{size:24})})]}),(0,yi.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:(0,yi.jsxs)("form",{onSubmit:u,className:"space-y-8",children:[(0,yi.jsxs)(Due,{title:"Customer Information",children:[(0,yi.jsx)(Oue,{label:"First Name",required:!0,children:(0,yi.jsx)(zue,{name:"firstName",value:i.firstName,onChange:c,required:!0,placeholder:"John"})}),(0,yi.jsx)(Oue,{label:"Last Name",children:(0,yi.jsx)(zue,{name:"lastName",value:i.lastName,onChange:c,placeholder:"Doe"})}),(0,yi.jsx)(Oue,{label:"Full Name",children:(0,yi.jsx)(zue,{name:"customerName",value:i.customerName,onChange:c,placeholder:"John Doe (auto-filled from above)"})}),(0,yi.jsx)(Oue,{label:"Phone Number",children:(0,yi.jsx)(zue,{name:"phoneNumber",value:i.phoneNumber,onChange:c,placeholder:"(555) 123-4567"})}),(0,yi.jsx)(Oue,{label:"Email",children:(0,yi.jsx)(zue,{name:"email",type:"email",value:i.email,onChange:c,placeholder:"john@example.com"})}),(0,yi.jsx)(Oue,{label:"Address",fullWidth:!0,children:(0,yi.jsx)(zue,{name:"address",value:i.address,onChange:c,placeholder:"123 Main St, City, State 12345"})})]}),(0,yi.jsxs)(Due,{title:"Job Information",children:[(0,yi.jsx)(Oue,{label:"Date",required:!0,children:(0,yi.jsx)(jue,{name:"date",value:i.date,onChange:c,required:!0})}),(0,yi.jsx)(Oue,{label:"Lead Source",children:(0,yi.jsxs)(Que,{name:"leadSource",value:i.leadSource,onChange:c,children:[(0,yi.jsx)("option",{value:"Door Knock",children:"Door Knock"}),(0,yi.jsx)("option",{value:"Rime",children:"Rime"}),(0,yi.jsx)("option",{value:"Adverta",children:"Adverta"}),(0,yi.jsx)("option",{value:"Referral",children:"Referral"}),(0,yi.jsx)("option",{value:"DaBella",children:"DaBella"})]})}),(0,yi.jsx)(Oue,{label:"Quality",children:(0,yi.jsxs)(Que,{name:"quality",value:i.quality,onChange:c,children:[(0,yi.jsx)("option",{value:"Hot",children:"Hot"}),(0,yi.jsx)("option",{value:"Warm",children:"Warm"}),(0,yi.jsx)("option",{value:"Cold",children:"Cold"})]})}),(0,yi.jsx)(Oue,{label:"Disposition",children:(0,yi.jsxs)(Que,{name:"disposition",value:i.disposition,onChange:c,children:[(0,yi.jsx)("option",{value:"New",children:"New"}),(0,yi.jsx)("option",{value:"Scheduled",children:"Scheduled"}),(0,yi.jsx)("option",{value:"Insurance",children:"Insurance"}),(0,yi.jsx)("option",{value:"Quoted",children:"Quoted"}),(0,yi.jsx)("option",{value:"Follow Up",children:"Follow Up"}),(0,yi.jsx)("option",{value:"Closed Sold",children:"Closed Sold"}),(0,yi.jsx)("option",{value:"Closed Lost",children:"Closed Lost"})]})}),(0,yi.jsx)(Oue,{label:"Roof Age",children:(0,yi.jsx)(zue,{name:"roofAge",value:i.roofAge,onChange:c,placeholder:"10 years"})}),(0,yi.jsx)(Oue,{label:"Roof Type",children:(0,yi.jsxs)(Que,{name:"roofType",value:i.roofType,onChange:c,children:[(0,yi.jsx)("option",{value:"Asphalt Shingle",children:"Asphalt Shingle"}),(0,yi.jsx)("option",{value:"Metal",children:"Metal"}),(0,yi.jsx)("option",{value:"Tile",children:"Tile"}),(0,yi.jsx)("option",{value:"TPO",children:"TPO"}),(0,yi.jsx)("option",{value:"Wood",children:"Wood"})]})}),(0,yi.jsx)(Oue,{label:"Quote Amount",children:(0,yi.jsx)(zue,{name:"dabellaQuote",value:i.dabellaQuote,onChange:c,placeholder:"15000"})})]}),(0,yi.jsxs)(Due,{title:"Primary Measurements",children:[(0,yi.jsx)(Oue,{label:"SQ FT",required:!0,children:(0,yi.jsx)(Hue,{name:"sqFt",value:i.sqFt,onChange:c,required:!0,placeholder:"2500"})}),(0,yi.jsx)(Oue,{label:"Ridge LF",required:!0,children:(0,yi.jsx)(Hue,{name:"ridgeLf",value:i.ridgeLf,onChange:c,required:!0,placeholder:"150"})}),(0,yi.jsx)(Oue,{label:"Valley LF",required:!0,children:(0,yi.jsx)(Hue,{name:"valleyLf",value:i.valleyLf,onChange:c,required:!0,placeholder:"75"})}),(0,yi.jsx)(Oue,{label:"Eaves LF",required:!0,children:(0,yi.jsx)(Hue,{name:"eavesLf",value:i.eavesLf,onChange:c,required:!0,placeholder:"200"})})]}),(0,yi.jsxs)(Due,{title:"Ventilation & Flow",children:[(0,yi.jsx)(Oue,{label:"Ridge Vents",children:(0,yi.jsx)(Hue,{name:"ridgeVents",value:i.ridgeVents,onChange:c,placeholder:"10"})}),(0,yi.jsx)(Oue,{label:"Turbine",children:(0,yi.jsx)(Hue,{name:"turbine",value:i.turbine,onChange:c,placeholder:"2"})}),(0,yi.jsx)(Oue,{label:"Rime Flow",children:(0,yi.jsx)(Hue,{name:"rimeFlow",value:i.rimeFlow,onChange:c,placeholder:"100"})})]}),(0,yi.jsxs)(Due,{title:"Ridge & Valley Components",children:[(0,yi.jsx)(Oue,{label:"High Profile Ridge Cap",children:(0,yi.jsx)(Hue,{name:"highProfileRidgeCap",value:i.highProfileRidgeCap,onChange:c,placeholder:"20"})}),(0,yi.jsx)(Oue,{label:"Valley Metal",children:(0,yi.jsx)(Hue,{name:"valleyMetal",value:i.valleyMetal,onChange:c,placeholder:"15"})})]}),(0,yi.jsxs)(Due,{title:"Pipes",children:[(0,yi.jsx)(Oue,{label:'Pipes [1 1/2"]',children:(0,yi.jsx)(Hue,{name:"pipes1Half",value:i.pipes1Half,onChange:c,placeholder:"3"})}),(0,yi.jsx)(Oue,{label:'Pipes [2"]',children:(0,yi.jsx)(Hue,{name:"pipes2",value:i.pipes2,onChange:c,placeholder:"2"})}),(0,yi.jsx)(Oue,{label:'Pipes [3"]',children:(0,yi.jsx)(Hue,{name:"pipes3",value:i.pipes3,onChange:c,placeholder:"1"})}),(0,yi.jsx)(Oue,{label:'Pipes [4"]',children:(0,yi.jsx)(Hue,{name:"pipes4",value:i.pipes4,onChange:c,placeholder:"1"})})]}),(0,yi.jsxs)(Due,{title:"Roof Features",children:[(0,yi.jsx)(Oue,{label:"Gables",children:(0,yi.jsx)(Hue,{name:"gables",value:i.gables,onChange:c,placeholder:"4"})}),(0,yi.jsx)(Oue,{label:"Turtle Backs",children:(0,yi.jsx)(Hue,{name:"turtleBacks",value:i.turtleBacks,onChange:c,placeholder:"2"})}),(0,yi.jsx)(Oue,{label:"Satellite",children:(0,yi.jsx)(Hue,{name:"satellite",value:i.satellite,onChange:c,placeholder:"1"})}),(0,yi.jsx)(Oue,{label:"Chimney",children:(0,yi.jsx)(Hue,{name:"chimney",value:i.chimney,onChange:c,placeholder:"1"})}),(0,yi.jsx)(Oue,{label:"Solar",children:(0,yi.jsx)(Hue,{name:"solar",value:i.solar,onChange:c,placeholder:"20"})}),(0,yi.jsx)(Oue,{label:"Swamp Cooler",children:(0,yi.jsx)(Hue,{name:"swampCooler",value:i.swampCooler,onChange:c,placeholder:"1"})})]}),(0,yi.jsxs)(Due,{title:"Gutters & Additional",children:[(0,yi.jsx)(Oue,{label:"Gutters LF",children:(0,yi.jsx)(Hue,{name:"guttersLf",value:i.guttersLf,onChange:c,placeholder:"180"})}),(0,yi.jsx)(Oue,{label:"Downspouts",children:(0,yi.jsx)(Hue,{name:"downspouts",value:i.downspouts,onChange:c,placeholder:"6"})}),(0,yi.jsx)(Oue,{label:"Gutter Guard LF",children:(0,yi.jsx)(Hue,{name:"gutterGuardLf",value:i.gutterGuardLf,onChange:c,placeholder:"180"})}),(0,yi.jsx)(Oue,{label:"Permanent Lighting",children:(0,yi.jsx)(Hue,{name:"permanentLighting",value:i.permanentLighting,onChange:c,placeholder:"200"})})]}),(0,yi.jsx)(Due,{title:"Notes",children:(0,yi.jsx)(Oue,{label:"Additional Notes",fullWidth:!0,children:(0,yi.jsx)(Vue,{name:"notes",value:i.notes,onChange:c,placeholder:"Any additional notes about this job count..."})})}),(0,yi.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,yi.jsx)("button",{type:"button",onClick:r,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,yi.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors",children:o?(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)(j,{className:"animate-spin h-5 w-5 mr-2"}),"Saving..."]}):a?"Update Job Count":"Add Job Count"})]})]})})]})})};const Kue=function(e){let{jobCount:t,onClose:n,onEdit:r,onDelete:a}=e;const i=e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",s=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(t){return e}},o=e=>e&&"0"!==e&&"-"!==e?"$".concat(i(e)):"-",l=e=>{let{title:t,children:n,icon:r}=e;return(0,yi.jsxs)("div",{className:"mb-8",children:[(0,yi.jsxs)("div",{className:"flex items-center mb-6",children:[(0,yi.jsx)(r,{className:"w-6 h-6 text-blue-600 mr-3"}),(0,yi.jsx)("h4",{className:"text-xl font-semibold text-gray-800",children:t})]}),(0,yi.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n})]})},c=e=>{let{label:t,value:n,fullWidth:r=!1}=e;return(0,yi.jsxs)("div",{className:"".concat(r?"lg:col-span-3 md:col-span-2":""," bg-gray-50 p-4 rounded-lg border"),children:[(0,yi.jsx)("dt",{className:"text-sm font-medium text-gray-600 mb-1",children:t}),(0,yi.jsx)("dd",{className:"text-base text-gray-900 font-semibold",children:n||"-"})]})},u=t.customerName||"".concat(t.firstName||""," ").concat(t.lastName||"").trim()||"Unknown Customer";return(0,yi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,yi.jsxs)("div",{className:"bg-white rounded-xl max-w-7xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[(0,yi.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:"Job Count Details"}),(0,yi.jsx)("p",{className:"text-gray-600 mt-1",children:u}),(0,yi.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Date: ",s(t.date)]})]}),(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsx)("button",{onClick:()=>r(t),className:"p-3 text-orange-600 hover:text-orange-800 hover:bg-orange-50 rounded-lg transition-colors",title:"Edit Job Count",children:(0,yi.jsx)(Li,{className:"w-6 h-6"})}),(0,yi.jsx)("button",{onClick:()=>a(t.id),className:"p-3 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Job Count",children:(0,yi.jsx)(PC,{className:"w-6 h-6"})}),(0,yi.jsx)("button",{onClick:n,className:"p-3 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,yi.jsx)(Ii,{className:"w-6 h-6"})})]})]}),(0,yi.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:[(0,yi.jsxs)(l,{title:"Customer Information",icon:ns,children:[(0,yi.jsx)(c,{label:"First Name",value:t.firstName}),(0,yi.jsx)(c,{label:"Last Name",value:t.lastName}),(0,yi.jsx)(c,{label:"Full Name",value:t.customerName}),(0,yi.jsx)(c,{label:"Phone Number",value:(e=>{if(!e)return"-";const t=e.toString().replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e})(t.phoneNumber)}),(0,yi.jsx)(c,{label:"Email",value:t.email}),(0,yi.jsx)(c,{label:"Address",value:t.address,fullWidth:!0})]}),(0,yi.jsxs)(l,{title:"Job Information",icon:os,children:[(0,yi.jsx)(c,{label:"Date",value:s(t.date)}),(0,yi.jsx)(c,{label:"Lead Source",value:t.leadSource}),(0,yi.jsx)(c,{label:"Quality",value:t.quality}),(0,yi.jsx)(c,{label:"Disposition",value:t.disposition}),(0,yi.jsx)(c,{label:"Roof Age",value:t.roofAge}),(0,yi.jsx)(c,{label:"Roof Type",value:t.roofType}),(0,yi.jsx)(c,{label:"Quote Amount",value:o(t.dabellaQuote)})]}),(0,yi.jsxs)(l,{title:"Primary Measurements",icon:G,children:[(0,yi.jsx)(c,{label:"SQ FT",value:i(t.sqFt)}),(0,yi.jsx)(c,{label:"Ridge LF",value:i(t.ridgeLf)}),(0,yi.jsx)(c,{label:"Valley LF",value:i(t.valleyLf)}),(0,yi.jsx)(c,{label:"Eaves LF",value:i(t.eavesLf)})]}),(0,yi.jsxs)(l,{title:"Ventilation & Flow",icon:G,children:[(0,yi.jsx)(c,{label:"Ridge Vents",value:i(t.ridgeVents)}),(0,yi.jsx)(c,{label:"Turbine",value:i(t.turbine)}),(0,yi.jsx)(c,{label:"Rime Flow",value:i(t.rimeFlow)})]}),(0,yi.jsxs)(l,{title:"Ridge & Valley Components",icon:G,children:[(0,yi.jsx)(c,{label:"High Profile Ridge Cap",value:i(t.highProfileRidgeCap)}),(0,yi.jsx)(c,{label:"Valley Metal",value:i(t.valleyMetal)})]}),(0,yi.jsxs)(l,{title:"Pipes",icon:G,children:[(0,yi.jsx)(c,{label:'Pipes [1 1/2"]',value:i(t.pipes1Half)}),(0,yi.jsx)(c,{label:'Pipes [2"]',value:i(t.pipes2)}),(0,yi.jsx)(c,{label:'Pipes [3"]',value:i(t.pipes3)}),(0,yi.jsx)(c,{label:'Pipes [4"]',value:i(t.pipes4)})]}),(0,yi.jsxs)(l,{title:"Roof Features",icon:G,children:[(0,yi.jsx)(c,{label:"Gables",value:i(t.gables)}),(0,yi.jsx)(c,{label:"Turtle Backs",value:i(t.turtleBacks)}),(0,yi.jsx)(c,{label:"Satellite",value:i(t.satellite)}),(0,yi.jsx)(c,{label:"Chimney",value:i(t.chimney)}),(0,yi.jsx)(c,{label:"Solar",value:i(t.solar)}),(0,yi.jsx)(c,{label:"Swamp Cooler",value:i(t.swampCooler)})]}),(0,yi.jsxs)(l,{title:"Gutters & Additional",icon:G,children:[(0,yi.jsx)(c,{label:"Gutters LF",value:i(t.guttersLf)}),(0,yi.jsx)(c,{label:"Downspouts",value:i(t.downspouts)}),(0,yi.jsx)(c,{label:"Gutter Guard LF",value:i(t.gutterGuardLf)}),(0,yi.jsx)(c,{label:"Permanent Lighting",value:i(t.permanentLighting)})]}),t.notes&&(0,yi.jsx)(l,{title:"Notes",icon:os,children:(0,yi.jsx)(c,{label:"Additional Notes",value:t.notes,fullWidth:!0})}),(0,yi.jsxs)("div",{className:"mt-8 p-6 bg-blue-50 rounded-xl border border-blue-200",children:[(0,yi.jsxs)("h4",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center",children:[(0,yi.jsx)(G,{className:"w-5 h-5 mr-2"}),"Summary Totals"]}),(0,yi.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,yi.jsxs)("div",{className:"text-center",children:[(0,yi.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:i(t.sqFt)}),(0,yi.jsx)("div",{className:"text-sm text-blue-700",children:"Total SQ FT"})]}),(0,yi.jsxs)("div",{className:"text-center",children:[(0,yi.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:i(t.ridgeLf)}),(0,yi.jsx)("div",{className:"text-sm text-blue-700",children:"Ridge LF"})]}),(0,yi.jsxs)("div",{className:"text-center",children:[(0,yi.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:i(t.valleyLf)}),(0,yi.jsx)("div",{className:"text-sm text-blue-700",children:"Valley LF"})]}),(0,yi.jsxs)("div",{className:"text-center",children:[(0,yi.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:o(t.dabellaQuote)}),(0,yi.jsx)("div",{className:"text-sm text-blue-700",children:"Quote Value"})]})]})]})]})]})})};const que=function(){const[e,t]=(0,B.useState)(null),[n,r]=(0,B.useState)(!1);return(0,yi.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[(0,yi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Google Sheets Connection"}),e&&(0,yi.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[e.success?(0,yi.jsx)(Z,{className:"w-3 h-3 mr-1"}):(0,yi.jsx)($,{className:"w-3 h-3 mr-1"}),e.success?"Connected":"Error"]})]}),(0,yi.jsxs)("button",{onClick:async()=>{r(!0),t(null);const e=await ne.testConnection();t(e),r(!1)},disabled:n,className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[n?(0,yi.jsx)(j,{className:"animate-spin w-4 h-4 mr-2"}):(0,yi.jsx)(Ti,{className:"w-4 h-4 mr-2"}),"Test"]})]}),e&&(0,yi.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[e.message,e.success&&e.rowCount&&" (".concat(e.rowCount," rows)")]})]})};const Xue=function(e){let{error:t}=e;return(0,yi.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-50 p-4",children:(0,yi.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-lg",children:[(0,yi.jsx)($,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,yi.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Application Configuration Error"}),(0,yi.jsx)("p",{className:"text-gray-600 mb-4",children:"The application could not start because a required configuration variable is missing or invalid."}),(0,yi.jsxs)("div",{className:"bg-red-100 text-red-700 text-left p-3 rounded-md text-sm",children:[(0,yi.jsx)("strong",{children:"Details:"})," ",t]}),(0,yi.jsx)("p",{className:"text-gray-500 mt-4 text-sm",children:"Please ensure all `REACT_APP_*` variables are set correctly in your Vercel project settings and redeploy."})]})})},Yue=(0,B.createContext)(null),Jue={didCatch:!1,error:null};class Zue extends B.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Jue}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];null===(t=(n=this.props).onReset)||void 0===t||t.call(n,{args:a,reason:"imperative-api"}),this.setState(Jue)}}componentDidCatch(e,t){var n,r;null===(n=(r=this.props).onError)||void 0===n||n.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:n}=this.state,{resetKeys:r}=this.props;var a,i;n&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,n)=>!Object.is(e,t[n]))}(e.resetKeys,r)&&(null===(a=(i=this.props).onReset)||void 0===a||a.call(i,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(Jue))}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:r}=this.props,{didCatch:a,error:i}=this.state;let s=e;if(a){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof t)s=t(e);else if(n)s=(0,B.createElement)(n,e);else{if(void 0===r)throw i;s=r}}return(0,B.createElement)(Yue.Provider,{value:{didCatch:a,error:i,resetErrorBoundary:this.resetErrorBoundary}},s)}}const $ue=H("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ehe=H("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),the=H("bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),nhe=e=>{let{error:t,resetErrorBoundary:n,componentStack:r}=e;const[a,i]=B.useState(!1),[s,o]=B.useState(!1);return(0,yi.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4",children:(0,yi.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-xl shadow-2xl border border-red-200",children:[(0,yi.jsx)("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 text-white p-6 rounded-t-xl",children:(0,yi.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,yi.jsx)("div",{className:"p-2 bg-white/20 rounded-lg",children:(0,yi.jsx)($ue,{className:"w-6 h-6"})}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h1",{className:"text-xl font-bold",children:"System Error Detected"}),(0,yi.jsx)("p",{className:"text-red-100",children:"The CRM encountered an unexpected error"})]})]})}),(0,yi.jsxs)("div",{className:"p-6 space-y-6",children:[(0,yi.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,yi.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,yi.jsx)(ehe,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),(0,yi.jsxs)("div",{className:"flex-1",children:[(0,yi.jsx)("h3",{className:"font-semibold text-red-800 mb-1",children:"Error Details"}),(0,yi.jsx)("p",{className:"text-red-700 text-sm font-mono bg-red-100 p-2 rounded",children:t.message})]})]})}),(0,yi.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,yi.jsx)("h3",{className:"font-semibold text-blue-800 mb-3",children:"Troubleshooting Steps"}),(0,yi.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-blue-700 text-sm",children:[(0,yi.jsx)("li",{children:"Try refreshing the page to reload the application"}),(0,yi.jsx)("li",{children:"Clear your browser cache and cookies"}),(0,yi.jsx)("li",{children:"Check your internet connection"}),(0,yi.jsx)("li",{children:"Disable browser extensions temporarily"}),(0,yi.jsx)("li",{children:"Contact support if the problem persists"})]})]}),(0,yi.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,yi.jsxs)("button",{onClick:n,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,yi.jsx)(Ti,{className:"w-4 h-4"}),(0,yi.jsx)("span",{children:"Try Again"})]}),(0,yi.jsxs)("button",{onClick:async()=>{o(!0);try{const e={message:t.message,stack:t.stack,componentStack:r,url:window.location.href,userAgent:navigator.userAgent,timestamp:(new Date).toISOString(),userId:localStorage.getItem("userId")||"anonymous"};console.error("Error Report:",e),setTimeout(()=>o(!1),1e3)}catch(reportError){console.error("Failed to report error:",reportError),o(!1)}},disabled:s,className:"flex items-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50",children:[(0,yi.jsx)(the,{className:"w-4 h-4"}),(0,yi.jsx)("span",{children:s?"Reporting...":"Report Error"})]}),(0,yi.jsxs)("button",{onClick:()=>window.location.reload(),className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[(0,yi.jsx)(Ti,{className:"w-4 h-4"}),(0,yi.jsx)("span",{children:"Reload Page"})]})]}),(0,yi.jsxs)("div",{className:"border-t pt-4",children:[(0,yi.jsxs)("button",{onClick:()=>i(!a),className:"text-gray-600 hover:text-gray-800 text-sm font-medium",children:[a?"Hide":"Show"," Technical Details"]}),a&&(0,yi.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Stack Trace"}),(0,yi.jsx)("pre",{className:"text-xs bg-gray-100 p-3 rounded overflow-x-auto text-gray-700 font-mono",children:t.stack})]}),r&&(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Component Stack"}),(0,yi.jsx)("pre",{className:"text-xs bg-gray-100 p-3 rounded overflow-x-auto text-gray-700 font-mono",children:r})]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Environment"}),(0,yi.jsxs)("div",{className:"text-xs bg-gray-100 p-3 rounded text-gray-700 space-y-1",children:[(0,yi.jsxs)("div",{children:[(0,yi.jsx)("strong",{children:"URL:"})," ",window.location.href]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("strong",{children:"User Agent:"})," ",navigator.userAgent]}),(0,yi.jsxs)("div",{children:[(0,yi.jsx)("strong",{children:"Timestamp:"})," ",(new Date).toISOString()]})]})]})]})]})]}),(0,yi.jsx)("div",{className:"bg-gray-50 px-6 py-3 rounded-b-xl border-t text-center",children:(0,yi.jsxs)("p",{className:"text-xs text-gray-500",children:["Bhotch CRM System - Error ID: ",Date.now().toString(36)]})})]})})},rhe=(e,t)=>{console.group("\ud83d\udea8 Error Boundary Triggered"),console.error("Error:",e),console.error("Error Info:",t),console.error("Component Stack:",t.componentStack),console.error("Error Stack:",e.stack),console.groupEnd();const n={message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent};try{const e=JSON.parse(localStorage.getItem("errorLogs")||"[]");e.push(n),e.length>10&&e.splice(0,e.length-10),localStorage.setItem("errorLogs",JSON.stringify(e))}catch(r){console.warn("Failed to store error log:",r)}},ahe=e=>{let{children:t,fallback:n}=e;return(0,yi.jsx)(Zue,{FallbackComponent:n||nhe,onError:rhe,onReset:()=>{window.location.hash="",window.location.reload()},children:t})},ihe=ahe;function she(e){let{onLogout:t}=e;const{notifications:n,addNotification:r}=function(){const[e,t]=(0,B.useState)([]),n=(0,B.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const r={id:Date.now().toString(),message:e,type:n};t(e=>[r,...e.slice(0,4)]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==r.id))},5e3)},[]);return{notifications:e,addNotification:n}}(),{leads:a,loading:i,refreshLeads:s,addLead:o,updateLead:l,deleteLead:c}=function(e){const[t,n]=(0,B.useState)([]),[r,a]=(0,B.useState)(!0),i=(0,B.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||a(!0);const r=await ne.fetchLeads();if(r.success){const a=(r.data||r.leads||[]).map(e=>M(M({},e),{},{customerName:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"})).sort((e,t)=>new Date(t.createdDate||0)-new Date(e.createdDate||0));n(a),e(t?"Leads refreshed. Found ".concat(a.length," leads."):"Leads loaded. Found ".concat(a.length," leads."),"success")}else e("Error fetching leads: ".concat(r.message),"error");t||a(!1)},[e]);(0,B.useEffect)(()=>{i()},[i]);const s=(0,B.useCallback)(async t=>{const r=await ne.addLead(t);return r.success&&r.lead?(n(e=>[r.lead,...e].sort((e,t)=>new Date(t.createdDate||0)-new Date(e.createdDate||0))),e("Lead added: ".concat(r.lead.customerName),"success")):e("Error adding lead: ".concat(r.message),"error"),r},[e]),o=(0,B.useCallback)(async t=>{const r=await ne.updateLead(t);return r.success&&r.lead?(n(e=>e.map(e=>e.id===r.lead.id?r.lead:e)),e("Lead updated: ".concat(r.lead.customerName),"info")):e("Error updating lead: ".concat(r.message),"error"),r},[e]),l=(0,B.useCallback)(async r=>{const a=t.find(e=>e.id===r);if(a&&window.confirm("Are you sure you want to delete ".concat(a.customerName,"?"))){const t=await ne.deleteLead(r);t.success?(n(e=>e.filter(e=>e.id!==r)),e("Lead deleted: ".concat(a.customerName),"warning")):e("Error deleting lead: ".concat(t.message),"error")}},[t,e]);return{leads:t,loading:r,refreshLeads:()=>i(!0),addLead:s,updateLead:o,deleteLead:l}}(r),{jobCounts:u,loading:h,refreshJobCounts:d,addJobCount:A,updateJobCount:p,deleteJobCount:f}=function(e){const[t,n]=(0,B.useState)([]),[r,a]=(0,B.useState)(!0),i=(0,B.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||a(!0);try{const r=await ne.fetchJobCounts();if(r.success){const a=(r.data||r.jobCounts||[]).map((e,t)=>M(M({},e),{},{id:e.id||"jobcount_".concat(Date.now(),"_").concat(t),fullName:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown Customer"})).sort((e,t)=>new Date(t.date||0)-new Date(e.date||0));n(a);const i=t?"Job counts refreshed. Found ".concat(a.length," records."):"Job counts loaded. Found ".concat(a.length," records.");e(i,"success")}else e("Error fetching job counts: ".concat(r.message),"error")}catch(_S){e("Error loading job counts: ".concat(_S.message),"error")}finally{t||a(!1)}},[e]);(0,B.useEffect)(()=>{i()},[i]);const s=(0,B.useCallback)(async t=>{try{const r=await ne.addJobCount(t);if(r.success&&r.jobCount){const t=M(M({},r.jobCount),{},{id:r.jobCount.id||"jobcount_".concat(Date.now()),fullName:r.jobCount.customerName||"".concat(r.jobCount.firstName||""," ").concat(r.jobCount.lastName||"").trim()||"Unknown Customer"});n(e=>[t,...e].sort((e,t)=>new Date(t.date||0)-new Date(e.date||0))),e("Job count added: ".concat(t.fullName),"success")}else e("Error adding job count: ".concat(r.message),"error");return r}catch(_S){return e("Error adding job count: ".concat(_S.message),"error"),{success:!1,message:_S.message}}},[e]),o=(0,B.useCallback)(async t=>{try{const r=await ne.updateJobCount(t);if(r.success&&r.jobCount){const a=M(M({},r.jobCount),{},{id:r.jobCount.id||t.id,fullName:r.jobCount.customerName||"".concat(r.jobCount.firstName||""," ").concat(r.jobCount.lastName||"").trim()||"Unknown Customer"});n(e=>e.map(e=>e.id===a.id?a:e)),e("Job count updated: ".concat(a.fullName),"info")}else e("Error updating job count: ".concat(r.message),"error");return r}catch(_S){return e("Error updating job count: ".concat(_S.message),"error"),{success:!1,message:_S.message}}},[e]),l=(0,B.useCallback)(async r=>{const a=t.find(e=>e.id===r);if(!a)return void e("Job count not found","error");const i="Are you sure you want to delete the job count for ".concat(a.fullName,"?");if(window.confirm(i))try{const t=await ne.deleteJobCount(r);t.success?(n(e=>e.filter(e=>e.id!==r)),e("Job count deleted: ".concat(a.fullName),"info")):e("Error deleting job count: ".concat(t.message),"error")}catch(_S){e("Error deleting job count: ".concat(_S.message),"error")}},[t,e]);return{jobCounts:t,loading:r,refreshJobCounts:()=>i(!0),addJobCount:s,updateJobCount:o,deleteJobCount:l}}(r),{communications:m,addCommunication:g}=oe(r),[y,v]=(0,B.useState)("dashboard"),[b,x]=(0,B.useState)(null),[w,_]=(0,B.useState)(!1),[S,C]=(0,B.useState)(null),[E,N]=(0,B.useState)(""),[k,I]=(0,B.useState)(null),[T,F]=(0,B.useState)(!1),[R,L]=(0,B.useState)(null),U=(0,B.useMemo)(()=>({totalLeads:a.length,hotLeads:a.filter(e=>"Hot"===e.quality).length,quotedLeads:a.filter(e=>"Quoted"===e.disposition).length,totalQuoteValue:a.reduce((e,t)=>e+(parseFloat(String(t.dabellaQuote).replace(/[$,]/g,""))||0),0),totalJobCounts:u.length,totalSqFt:u.reduce((e,t)=>e+(parseFloat(t.sqFt)||0),0)}),[a,u]),P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";v(e),"map"===e&&t&&N(t),C(null),L(null)};return i||h?(0,yi.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,yi.jsx)(j,{className:"animate-spin h-12 w-12 text-blue-600"})}):(0,yi.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,yi.jsx)("header",{className:"bg-white shadow-sm border-b sticky top-0 z-30",children:(0,yi.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,yi.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,yi.jsxs)("div",{className:"flex items-center",children:[(0,yi.jsx)(Q,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,yi.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Bhotch CRM"})]}),(0,yi.jsxs)("nav",{className:"flex space-x-1 sm:space-x-2",children:[(0,yi.jsxs)("button",{onClick:()=>v("dashboard"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("dashboard"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(V,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Dashboard"})]}),(0,yi.jsxs)("button",{onClick:()=>v("leads"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("leads"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(W,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Leads"})]}),(0,yi.jsxs)("button",{onClick:()=>v("jobcount"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("jobcount"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(G,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Job Count"})]}),(0,yi.jsxs)("button",{onClick:()=>v("map"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("map"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(K,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Map"})]}),(0,yi.jsxs)("button",{onClick:()=>v("calendar"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("calendar"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(q,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Calendar"})]}),(0,yi.jsxs)("button",{onClick:()=>v("communications"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("communications"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(X,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"Comms"})]}),(0,yi.jsxs)("button",{onClick:()=>v("visualization"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("visualization"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,yi.jsx)(Y,{className:"w-4 h-4 mr-1"}),(0,yi.jsx)("span",{className:"hidden sm:inline",children:"360\xb0 View"})]}),(0,yi.jsx)("button",{onClick:t,className:"p-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors",children:(0,yi.jsx)(J,{className:"w-5 h-5"})})]})]})})}),(0,yi.jsx)("div",{className:"fixed top-20 right-5 w-80 z-50",children:n.map(e=>(0,yi.jsxs)("div",{className:"p-3 rounded-md mb-2 shadow-lg animate-fade-in-right flex items-start ".concat("success"===e.type?"bg-green-100 text-green-800":"error"===e.type?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:["success"===e.type&&(0,yi.jsx)(Z,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),"error"===e.type&&(0,yi.jsx)($,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),"info"===e.type&&(0,yi.jsx)(ee,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),(0,yi.jsx)("span",{className:"text-sm",children:e.message})]},e.id))}),(0,yi.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:["dashboard"===y&&(0,yi.jsxs)(yi.Fragment,{children:[(0,yi.jsx)(que,{}),(0,yi.jsx)(Si,{stats:U,leads:a,jobCounts:u,onNavigateToTab:P})]}),"leads"===y&&(0,yi.jsx)(Di,{leads:a,onAddLead:()=>_(!0),onEditLead:x,onDeleteLead:c,onRefreshLeads:s,onSelectLead:C}),"jobcount"===y&&(0,yi.jsx)(Oi,{jobCounts:u,onAddJobCount:()=>F(!0),onEditJobCount:I,onDeleteJobCount:f,onRefreshJobCounts:d,onSelectJobCount:L}),"map"===y&&(0,yi.jsx)(Gi,{leads:a,onLeadClick:C,searchAddress:E,onSearchComplete:()=>N("")}),"calendar"===y&&(0,yi.jsx)(Ji,{}),"communications"===y&&(0,yi.jsx)(ds,{leads:a,jobCounts:u,communications:m}),"visualization"===y&&(0,yi.jsx)("div",{style:{height:"calc(100vh - 120px)"},children:(0,yi.jsx)(bue,{})})]}),w&&(0,yi.jsx)(Bue,{onSubmit:async e=>{await o(e),_(!1)},onCancel:()=>_(!1)}),b&&(0,yi.jsx)(Bue,{initialData:b,onSubmit:async e=>{await l(e),x(null)},onCancel:()=>x(null),isEdit:!0}),S&&(0,yi.jsx)(Uue,{lead:S,onClose:()=>C(null),onEdit:()=>{x(S),C(null)},onDelete:()=>{c(S.id),C(null)},onNavigateToTab:P,onLogCommunication:g,onUpdateLead:l}),T&&(0,yi.jsx)(Gue,{onSubmit:async e=>{await A(e),F(!1)},onCancel:()=>F(!1)}),k&&(0,yi.jsx)(Gue,{initialData:k,onSubmit:async e=>{await p(e),I(null)},onCancel:()=>I(null),isEdit:!0}),R&&(0,yi.jsx)(Kue,{jobCount:R,onClose:()=>L(null),onEdit:()=>{I(R),L(null)},onDelete:()=>{f(R.id),L(null)},onJobCountUpdate:e=>{L(e),d()}})]})}function ohe(){const[e,t]=(0,B.useState)(!!sessionStorage.getItem("isAuthenticated")),n=["AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8","https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec","AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4"].some(e=>!e)?"One or more critical environment variables (Firebase, GAS URL, Maps API) are not set.":null;return n?(0,yi.jsx)(Xue,{error:n}):e?(0,yi.jsx)(ihe,{children:(0,yi.jsx)(she,{onLogout:()=>{sessionStorage.removeItem("isAuthenticated"),t(!1)}})}):(0,yi.jsx)(ihe,{children:(0,yi.jsx)(vi,{onLogin:()=>t(!0)})})}k.createRoot(document.getElementById("root")).render((0,yi.jsx)(B.StrictMode,{children:(0,yi.jsx)(ohe,{})}))})()})();
//# sourceMappingURL=main.03d0528f.js.map