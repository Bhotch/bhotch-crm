/*! For license information please see main.01bd1f68.js.LICENSE.txt */
(()=>{var e={551:()=>{},579:(e,t,n)=>{"use strict";e.exports=n(1153)},1153:(e,t,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},1234:()=>{},2016:(e,t,n)=>{"use strict";e.exports=n(6958)},2062:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,g&&(g=!1,y(E),E=-1),p=!0;var a=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,k=-1;function I(){return!(t.unstable_now()-k<N)}function T(){if(null!==C){var e=t.unstable_now();k=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(T)};else if("undefined"!==typeof MessageChannel){var B=new MessageChannel,M=B.port2;B.port1.onmessage=T,_=function(){M.postMessage(null)}}else _=function(){m(T,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=m(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(y(E),E=-1):g=!0,R(x,a-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2430:function(e,t,n){var r;!function(i,a,s){var o,l=256,c=s.pow(l,6),u=s.pow(2,52),h=2*u,d=255;function A(e,t,n){var r=[],d=m(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,y(a)]}}():e,3),r),A=new p(r),v=function(){for(var e=A.g(6),t=c,n=0;e<u;)e=(e+n)*l,t*=l,n=A.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|A.g(4)},v.quick=function(){return A.g(4)/4294967296},v.double=v,m(y(A.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&f(r,A),e.state=function(){return f(A,{})}),n?(s.random=e,t):e})(v,d,"global"in t?t.global:this==s,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<l;)s[i]=i++;for(i=0;i<l;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*l+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(l)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(g(e[n],t-1))}catch(a){}return r.length?r:"string"==i?e:e+"\0"}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(m(s.random(),a),e.exports){e.exports=A;try{o=n(1234)}catch(v){}}else void 0===(r=function(){return A}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},2730:(e,t,n)=>{"use strict";var r=n(5043),i=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},p={};function f(e,t,n,r,i,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var m=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(p,e)||!h.call(A,e)&&(d.test(e)?p[e]=!0:(A[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(m,y);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(m,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(m,y);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),N=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),M=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var F=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var P,U=Object.assign;function D(e){if(void 0===P)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var O=!1;function j(e,t){if(!e||O)return"";O=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{O=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?D(e):""}function z(e){switch(e.tag){case 5:return D(e.type);case 16:return D("Lazy");case 13:return D("Suspense");case 19:return D("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case I:return"Suspense";case T:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case N:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case B:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case M:t=e._payload,e=e._init;try{return H(e(t))}catch(n){}}return null}function Q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ae={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||Ae.hasOwnProperty(e)&&Ae[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(Ae).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ae[t]=Ae[e]})});var me=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,_e=null,Se=null;function Ce(e){if(e=vi(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=xi(t),we(e.stateNode,e.type,t))}}function Ee(e){_e?Se?Se.push(e):Se=[e]:_e=e}function Ne(){if(_e){var e=_e,t=Se;if(Se=_e=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function ke(e,t){return e(t)}function Ie(){}var Te=!1;function Be(e,t,n){if(Te)return e(t,n);Te=!0;try{return ke(e,t,n)}finally{Te=!1,(null!==_e||null!==Se)&&(Ie(),Ne())}}function Me(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Fe=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){Fe=!1}function Le(e,t,n,r,i,a,s,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Pe=!1,Ue=null,De=!1,Oe=null,je={onError:function(e){Pe=!0,Ue=e}};function ze(e,t,n,r,i,a,s,o,l){Pe=!1,Ue=null,Le.apply(je,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(He(e)!==e)throw Error(a(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Ve(i),e;if(s===r)return Ve(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Ye=i.unstable_requestPaint,Je=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~i;0!==o?r=ht(o):0!==(a&=s)&&(r=ht(a))}else 0!==(s=n&~i)?r=ht(s):0!==a&&(r=ht(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function At(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,_t,St,Ct,Et=!1,Nt=[],kt=null,It=null,Tt=null,Bt=new Map,Mt=new Map,Ft=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":kt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":Bt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mt.delete(t.pointerId)}}function Pt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=vi(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ut(e){var t=yi(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Qe(n)))return e.blockedOn=t,void Ct(e.priority,function(){_t(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Dt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vi(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ot(e,t,n){Dt(e)&&n.delete(t)}function jt(){Et=!1,null!==kt&&Dt(kt)&&(kt=null),null!==It&&Dt(It)&&(It=null),null!==Tt&&Dt(Tt)&&(Tt=null),Bt.forEach(Ot),Mt.forEach(Ot)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Ht(e){function t(t){return zt(t,e)}if(0<Nt.length){zt(Nt[0],e);for(var n=1;n<Nt.length;n++){var r=Nt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==kt&&zt(kt,e),null!==It&&zt(It,e),null!==Tt&&zt(Tt,e),Bt.forEach(t),Mt.forEach(t),n=0;n<Ft.length;n++)(r=Ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ft.length&&null===(n=Ft[0]).blockedOn;)Ut(n),null===n.blockedOn&&Ft.shift()}var Qt=b.ReactCurrentBatchConfig,Vt=!0;function Gt(e,t,n,r){var i=vt,a=Qt.transition;Qt.transition=null;try{vt=1,qt(e,t,n,r)}finally{vt=i,Qt.transition=a}}function Wt(e,t,n,r){var i=vt,a=Qt.transition;Qt.transition=null;try{vt=4,qt(e,t,n,r)}finally{vt=i,Qt.transition=a}}function qt(e,t,n,r){if(Vt){var i=Xt(e,t,n,r);if(null===i)Vr(e,t,r,Kt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return kt=Pt(kt,e,t,n,r,i),!0;case"dragenter":return It=Pt(It,e,t,n,r,i),!0;case"mouseover":return Tt=Pt(Tt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Bt.set(a,Pt(Bt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Mt.set(a,Pt(Mt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==i;){var a=vi(i);if(null!==a&&xt(a),null===(a=Xt(e,t,n,r))&&Vr(e,t,r,Kt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Kt=null;function Xt(e,t,n,r){if(Kt=null,null!==(e=yi(e=xe(r))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),hn=U({},cn,{view:0,detail:0}),dn=an(hn),An=U({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=an(An),fn=an(U({},An,{dataTransfer:0})),gn=an(U({},hn,{relatedTarget:0})),mn=an(U({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=U({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=an(yn),bn=an(U({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function Cn(){return Sn}var En=U({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Nn=an(En),kn=an(U({},An,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=an(U({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Tn=an(U({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Bn=U({},An,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mn=an(Bn),Fn=[9,13,27,32],Rn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var Pn=u&&"TextEvent"in window&&!Ln,Un=u&&(!Rn||Ln&&8<Ln&&11>=Ln),Dn=String.fromCharCode(32),On=!1;function jn(e,t){switch(e){case"keyup":return-1!==Fn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Qn[e.type]:"textarea"===t}function Gn(e,t,n,r){Ee(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,qn=null;function Kn(e){Dr(e,0)}function Xn(e){if(q(bi(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Zn;if(u){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),qn=Wn=null)}function nr(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Gn(t,qn,e,xe(e)),Be(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ar(e,t){if("click"===e)return Xn(t)}function sr(e,t){if("input"===e||"change"===e)return Xn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function Ar(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&Ar(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=ur(n,a);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,mr=null,yr=null,vr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==gr||gr!==K(r)||("selectionStart"in(r=gr)&&Ar(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Wr(mr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},_r={},Sr={};function Cr(e){if(_r[e])return _r[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return _r[e]=n[t];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Er=Cr("animationend"),Nr=Cr("animationiteration"),kr=Cr("animationstart"),Ir=Cr("transitionend"),Tr=new Map,Br="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mr(e,t){Tr.set(e,t),l(t,[e])}for(var Fr=0;Fr<Br.length;Fr++){var Rr=Br[Fr];Mr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Mr(Er,"onAnimationEnd"),Mr(Nr,"onAnimationIteration"),Mr(kr,"onAnimationStart"),Mr("dblclick","onDoubleClick"),Mr("focusin","onFocus"),Mr("focusout","onBlur"),Mr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,o,l,c){if(ze.apply(this,arguments),Pe){if(!Pe)throw Error(a(198));var u=Ue;Pe=!1,Ue=null,De||(De=!0,Oe=u)}}(r,t,void 0,e),e.currentTarget=null}function Dr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&i.isPropagationStopped())break e;Ur(i,o,c),a=l}else for(s=0;s<r.length;s++){if(l=(o=r[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&i.isPropagationStopped())break e;Ur(i,o,c),a=l}}}if(De)throw e=Oe,De=!1,Oe=null,e}function Or(e,t){var n=t[fi];void 0===n&&(n=t[fi]=new Set);var r=e+"__bubble";n.has(r)||(Qr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Qr(n,e,r,t)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Hr(e){if(!e[zr]){e[zr]=!0,s.forEach(function(t){"selectionchange"!==t&&(Pr.has(t)||jr(t,!1,e),jr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zr]||(t[zr]=!0,jr("selectionchange",!1,t))}}function Qr(e,t,n,r){switch(Yt(t)){case 1:var i=Gt;break;case 4:i=Wt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!Fe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==o;){if(null===(s=yi(o)))return;if(5===(l=s.tag)||6===l){r=a=s;continue e}o=o.parentNode}}r=r.return}Be(function(){var r=a,i=xe(n),s=[];e:{var o=Tr.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Nn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Er:case Nr:case kr:l=mn;break;case Ir:l=Tn;break;case"scroll":l=dn;break;case"wheel":l=Mn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=kn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var A,p=r;null!==p;){var f=(A=p).stateNode;if(5===A.tag&&null!==f&&(A=f,null!==d&&(null!=(f=Me(p,d))&&u.push(Gr(p,f,A)))),h)break;p=p.return}0<u.length&&(o=new l(o,c,null,n,i),s.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!yi(c)&&!c[pi])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?yi(c):null)&&(c!==(h=He(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,f="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=kn,f="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:bi(l),A=null==c?o:bi(c),(o=new u(f,p+"leave",l,n,i)).target=h,o.relatedTarget=A,f=null,yi(i)===r&&((u=new u(d,p+"enter",c,n,i)).target=A,u.relatedTarget=h,f=u),h=f,l&&c)e:{for(d=c,p=0,A=u=l;A;A=qr(A))p++;for(A=0,f=d;f;f=qr(f))A++;for(;0<p-A;)u=qr(u),p--;for(;0<A-p;)d=qr(d),A--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=qr(u),d=qr(d)}u=null}else u=null;null!==l&&Kr(s,o,l,u,!1),null!==c&&null!==h&&Kr(s,h,c,u,!0)}if("select"===(l=(o=r?bi(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Yn;else if(Vn(o))if(Jn)g=sr;else{g=ir;var m=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=ar);switch(g&&(g=g(e,r))?Gn(s,g,n,i):(m&&m(e,o,r),"focusout"===e&&(m=o._wrapperState)&&m.controlled&&"number"===o.type&&ee(o,"number",o.value)),m=r?bi(r):window,e){case"focusin":(Vn(m)||"true"===m.contentEditable)&&(gr=m,mr=r,yr=null);break;case"focusout":yr=mr=gr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,br(s,n,i);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":br(s,n,i)}var y;if(Rn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Hn?jn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Un&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Hn&&(y=en()):(Zt="value"in(Jt=i)?Jt.value:Jt.textContent,Hn=!0)),0<(m=Wr(r,v)).length&&(v=new bn(v,e,null,n,i),s.push({event:v,listeners:m}),y?v.data=y:null!==(y=zn(n))&&(v.data=y))),(y=Pn?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(On=!0,Dn);case"textInput":return(e=t.data)===Dn&&On?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Rn&&jn(e,t)?(e=en(),$t=Zt=Jt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y))}Dr(s,t)})}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Me(e,n))&&r.unshift(Gr(e,a,i)),null!=(a=Me(e,t))&&r.push(Gr(e,a,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=Me(n,a))&&s.unshift(Gr(n,l,o)):i||null!=(l=Me(n,a))&&s.push(Gr(n,l,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function Zr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout(function(){throw e})}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ht(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ht(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,Ai="__reactProps$"+hi,pi="__reactContainer$"+hi,fi="__reactEvents$"+hi,gi="__reactListeners$"+hi,mi="__reactHandles$"+hi;function yi(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[di])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function vi(e){return!(e=e[di]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function xi(e){return e[Ai]||null}var wi=[],_i=-1;function Si(e){return{current:e}}function Ci(e){0>_i||(e.current=wi[_i],wi[_i]=null,_i--)}function Ei(e,t){_i++,wi[_i]=e.current,e.current=t}var Ni={},ki=Si(Ni),Ii=Si(!1),Ti=Ni;function Bi(e,t){var n=e.type.contextTypes;if(!n)return Ni;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Mi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Fi(){Ci(Ii),Ci(ki)}function Ri(e,t,n){if(ki.current!==Ni)throw Error(a(168));Ei(ki,t),Ei(Ii,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,Q(e)||"Unknown",i));return U({},n,r)}function Pi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ni,Ti=ki.current,Ei(ki,e),Ei(Ii,Ii.current),!0}function Ui(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Li(e,t,Ti),r.__reactInternalMemoizedMergedChildContext=e,Ci(Ii),Ci(ki),Ei(ki,e)):Ci(Ii),Ei(Ii,n)}var Di=null,Oi=!1,ji=!1;function zi(e){null===Di?Di=[e]:Di.push(e)}function Hi(){if(!ji&&null!==Di){ji=!0;var e=0,t=vt;try{var n=Di;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Di=null,Oi=!1}catch(i){throw null!==Di&&(Di=Di.slice(e+1)),qe($e,Hi),i}finally{vt=t,ji=!1}}return null}var Qi=[],Vi=0,Gi=null,Wi=0,qi=[],Ki=0,Xi=null,Yi=1,Ji="";function Zi(e,t){Qi[Vi++]=Wi,Qi[Vi++]=Gi,Gi=e,Wi=t}function $i(e,t,n){qi[Ki++]=Yi,qi[Ki++]=Ji,qi[Ki++]=Xi,Xi=e;var r=Yi;e=Ji;var i=32-st(r)-1;r&=~(1<<i),n+=1;var a=32-st(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Yi=1<<32-st(t)+i|n<<i|r,Ji=a+e}else Yi=1<<a|n<<i|r,Ji=e}function ea(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function ta(e){for(;e===Gi;)Gi=Qi[--Vi],Qi[Vi]=null,Wi=Qi[--Vi],Qi[Vi]=null;for(;e===Xi;)Xi=qi[--Ki],qi[Ki]=null,Ji=qi[--Ki],qi[Ki]=null,Yi=qi[--Ki],qi[Ki]=null}var na=null,ra=null,ia=!1,aa=null;function sa(e,t){var n=Bc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Yi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Bc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(ia){var t=ra;if(t){var n=t;if(!oa(e,t)){if(la(e))throw Error(a(418));t=ci(n.nextSibling);var r=na;t&&oa(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ha(e){if(e!==na)return!1;if(!ia)return ua(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(la(e))throw da(),Error(a(418));for(;t;)sa(e,t),t=ci(t.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?ci(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ra;e;)e=ci(e.nextSibling)}function Aa(){ra=na=null,ia=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var fa=b.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ma(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ya(e){return(0,e._init)(e._payload)}function va(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Fc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===M&&ya(a)===t.type)?((r=i(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Rc(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Dc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case w:return(t=Dc(t,e.mode,n)).return=e,t;case M:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;ma(e,t)}return null}function A(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null;case M:return A(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:h(e,t,n,r,null);ma(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case M:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,i,null);ma(t,r)}return null}function f(i,a,o,l){for(var c=null,u=null,h=a,f=a=0,g=null;null!==h&&f<o.length;f++){h.index>f?(g=h,h=null):g=h.sibling;var m=A(i,h,o[f],l);if(null===m){null===h&&(h=g);break}e&&h&&null===m.alternate&&t(i,h),a=s(m,a,f),null===u?c=m:u.sibling=m,u=m,h=g}if(f===o.length)return n(i,h),ia&&Zi(i,f),c;if(null===h){for(;f<o.length;f++)null!==(h=d(i,o[f],l))&&(a=s(h,a,f),null===u?c=h:u.sibling=h,u=h);return ia&&Zi(i,f),c}for(h=r(i,h);f<o.length;f++)null!==(g=p(h,i,f,o[f],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?f:g.key),a=s(g,a,f),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach(function(e){return t(i,e)}),ia&&Zi(i,f),c}function g(i,o,l,c){var u=L(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,f=o,g=o=0,m=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(m=f,f=null):m=f.sibling;var v=A(i,f,y.value,c);if(null===v){null===f&&(f=m);break}e&&f&&null===v.alternate&&t(i,f),o=s(v,o,g),null===h?u=v:h.sibling=v,h=v,f=m}if(y.done)return n(i,f),ia&&Zi(i,g),u;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=d(i,y.value,c))&&(o=s(y,o,g),null===h?u=y:h.sibling=y,h=y);return ia&&Zi(i,g),u}for(f=r(i,f);!y.done;g++,y=l.next())null!==(y=p(f,i,g,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),o=s(y,o,g),null===h?u=y:h.sibling=y,h=y);return e&&f.forEach(function(e){return t(i,e)}),ia&&Zi(i,g),u}return function e(r,a,s,l){if("object"===typeof s&&null!==s&&s.type===_&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=a;null!==u;){if(u.key===c){if((c=s.type)===_){if(7===u.tag){n(r,u.sibling),(a=i(u,s.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===M&&ya(c)===u.type){n(r,u.sibling),(a=i(u,s.props)).ref=ga(r,u,s),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===_?((a=Lc(s.props.children,r.mode,l,s.key)).return=r,r=a):((l=Rc(s.type,s.key,s.props,null,r.mode,l)).ref=ga(r,a,s),l.return=r,r=l)}return o(r);case w:e:{for(u=s.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=i(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Dc(s,r.mode,l)).return=r,r=a}return o(r);case M:return e(r,a,(u=s._init)(s._payload),l)}if(te(s))return f(r,a,s,l);if(L(s))return g(r,a,s,l);ma(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,s)).return=r,r=a):(n(r,a),(a=Uc(s,r.mode,l)).return=r,r=a),o(r)):n(r,a)}}var ba=va(!0),xa=va(!1),wa=Si(null),_a=null,Sa=null,Ca=null;function Ea(){Ca=Sa=_a=null}function Na(e){var t=wa.current;Ci(wa),e._currentValue=t}function ka(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ia(e,t){_a=e,Ca=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vo=!0),e.firstContext=null)}function Ta(e){var t=e._currentValue;if(Ca!==e)if(e={context:e,memoizedValue:t,next:null},null===Sa){if(null===_a)throw Error(a(308));Sa=e,_a.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return t}var Ba=null;function Ma(e){null===Ba?Ba=[e]:Ba.push(e)}function Fa(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ma(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ra(e,r)}function Ra(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var La=!1;function Pa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ua(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Da(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&kl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ra(e,n)}return null===(i=r.interleaved)?(t.next=t,Ma(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ra(e,n)}function ja(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function za(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ha(e,t,n,r){var i=e.updateQueue;La=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==a){var h=i.baseState;for(s=0,u=c=l=null,o=a;;){var d=o.lane,A=o.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:A,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,f=o;switch(d=t,A=n,f.tag){case 1:if("function"===typeof(p=f.payload)){h=p.call(A,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=f.payload)?p.call(A,h,d):p)||void 0===d)break e;h=U({},h,d);break e;case 2:La=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[o]:d.push(o))}else A={eventTime:A,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=A,l=h):u=u.next=A,s|=d;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(d=o).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Pl|=s,e.lanes=s,e.memoizedState=h}}function Qa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Va={},Ga=Si(Va),Wa=Si(Va),qa=Si(Va);function Ka(e){if(e===Va)throw Error(a(174));return e}function Xa(e,t){switch(Ei(qa,t),Ei(Wa,e),Ei(Ga,Va),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ci(Ga),Ei(Ga,t)}function Ya(){Ci(Ga),Ci(Wa),Ci(qa)}function Ja(e){Ka(qa.current);var t=Ka(Ga.current),n=le(t,e.type);t!==n&&(Ei(Wa,e),Ei(Ga,n))}function Za(e){Wa.current===e&&(Ci(Ga),Ci(Wa))}var $a=Si(0);function es(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ts=[];function ns(){for(var e=0;e<ts.length;e++)ts[e]._workInProgressVersionPrimary=null;ts.length=0}var rs=b.ReactCurrentDispatcher,is=b.ReactCurrentBatchConfig,as=0,ss=null,os=null,ls=null,cs=!1,us=!1,hs=0,ds=0;function As(){throw Error(a(321))}function ps(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function fs(e,t,n,r,i,s){if(as=s,ss=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rs.current=null===e||null===e.memoizedState?Zs:$s,e=n(r,i),us){s=0;do{if(us=!1,hs=0,25<=s)throw Error(a(301));s+=1,ls=os=null,t.updateQueue=null,rs.current=eo,e=n(r,i)}while(us)}if(rs.current=Js,t=null!==os&&null!==os.next,as=0,ls=os=ss=null,cs=!1,t)throw Error(a(300));return e}function gs(){var e=0!==hs;return hs=0,e}function ms(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ls?ss.memoizedState=ls=e:ls=ls.next=e,ls}function ys(){if(null===os){var e=ss.alternate;e=null!==e?e.memoizedState:null}else e=os.next;var t=null===ls?ss.memoizedState:ls.next;if(null!==t)ls=t,os=e;else{if(null===e)throw Error(a(310));e={memoizedState:(os=e).memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},null===ls?ss.memoizedState=ls=e:ls=ls.next=e}return ls}function vs(e,t){return"function"===typeof t?t(e):t}function bs(e){var t=ys(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=os,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=o=null,c=null,u=s;do{var h=u.lane;if((as&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,ss.lanes|=h,Pl|=h}u=u.next}while(null!==u&&u!==s);null===c?o=r:c.next=l,or(r,t.memoizedState)||(vo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,ss.lanes|=s,Pl|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xs(e){var t=ys(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);or(s,t.memoizedState)||(vo=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function ws(){}function _s(e,t){var n=ss,r=ys(),i=t(),s=!or(r.memoizedState,i);if(s&&(r.memoizedState=i,vo=!0),r=r.queue,Ls(Es.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ls&&1&ls.memoizedState.tag){if(n.flags|=2048,Ts(9,Cs.bind(null,n,r,i,t),void 0,null),null===Il)throw Error(a(349));0!==(30&as)||Ss(n,t,i)}return i}function Ss(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Cs(e,t,n,r){t.value=n,t.getSnapshot=r,Ns(t)&&ks(e)}function Es(e,t,n){return n(function(){Ns(t)&&ks(e)})}function Ns(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function ks(e){var t=Ra(e,1);null!==t&&nc(t,e,1,-1)}function Is(e){var t=ms();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},t.queue=e,e=e.dispatch=qs.bind(null,ss,e),[t.memoizedState,e]}function Ts(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bs(){return ys().memoizedState}function Ms(e,t,n,r){var i=ms();ss.flags|=e,i.memoizedState=Ts(1|t,n,void 0,void 0===r?null:r)}function Fs(e,t,n,r){var i=ys();r=void 0===r?null:r;var a=void 0;if(null!==os){var s=os.memoizedState;if(a=s.destroy,null!==r&&ps(r,s.deps))return void(i.memoizedState=Ts(t,n,a,r))}ss.flags|=e,i.memoizedState=Ts(1|t,n,a,r)}function Rs(e,t){return Ms(8390656,8,e,t)}function Ls(e,t){return Fs(2048,8,e,t)}function Ps(e,t){return Fs(4,2,e,t)}function Us(e,t){return Fs(4,4,e,t)}function Ds(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Os(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fs(4,4,Ds.bind(null,t,e),n)}function js(){}function zs(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Hs(e,t){var n=ys();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ps(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Qs(e,t,n){return 0===(21&as)?(e.baseState&&(e.baseState=!1,vo=!0),e.memoizedState=n):(or(n,t)||(n=ft(),ss.lanes|=n,Pl|=n,e.baseState=!0),t)}function Vs(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=is.transition;is.transition={};try{e(!1),t()}finally{vt=n,is.transition=r}}function Gs(){return ys().memoizedState}function Ws(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ks(e))Xs(t,n);else if(null!==(n=Fa(e,t,n,r))){nc(n,e,r,ec()),Ys(n,t,r)}}function qs(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ks(e))Xs(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,or(o,s)){var l=t.interleaved;return null===l?(i.next=i,Ma(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Fa(e,t,i,r))&&(nc(n,e,r,i=ec()),Ys(n,t,r))}}function Ks(e){var t=e.alternate;return e===ss||null!==t&&t===ss}function Xs(e,t){us=cs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ys(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Js={readContext:Ta,useCallback:As,useContext:As,useEffect:As,useImperativeHandle:As,useInsertionEffect:As,useLayoutEffect:As,useMemo:As,useReducer:As,useRef:As,useState:As,useDebugValue:As,useDeferredValue:As,useTransition:As,useMutableSource:As,useSyncExternalStore:As,useId:As,unstable_isNewReconciler:!1},Zs={readContext:Ta,useCallback:function(e,t){return ms().memoizedState=[e,void 0===t?null:t],e},useContext:Ta,useEffect:Rs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ms(4194308,4,Ds.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ms(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ms(4,2,e,t)},useMemo:function(e,t){var n=ms();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ms();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ws.bind(null,ss,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ms().memoizedState=e},useState:Is,useDebugValue:js,useDeferredValue:function(e){return ms().memoizedState=e},useTransition:function(){var e=Is(!1),t=e[0];return e=Vs.bind(null,e[1]),ms().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ss,i=ms();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Il)throw Error(a(349));0!==(30&as)||Ss(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Rs(Es.bind(null,r,s,e),[e]),r.flags|=2048,Ts(9,Cs.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=ms(),t=Il.identifierPrefix;if(ia){var n=Ji;t=":"+t+"R"+(n=(Yi&~(1<<32-st(Yi)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ds++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$s={readContext:Ta,useCallback:zs,useContext:Ta,useEffect:Ls,useImperativeHandle:Os,useInsertionEffect:Ps,useLayoutEffect:Us,useMemo:Hs,useReducer:bs,useRef:Bs,useState:function(){return bs(vs)},useDebugValue:js,useDeferredValue:function(e){return Qs(ys(),os.memoizedState,e)},useTransition:function(){return[bs(vs)[0],ys().memoizedState]},useMutableSource:ws,useSyncExternalStore:_s,useId:Gs,unstable_isNewReconciler:!1},eo={readContext:Ta,useCallback:zs,useContext:Ta,useEffect:Ls,useImperativeHandle:Os,useInsertionEffect:Ps,useLayoutEffect:Us,useMemo:Hs,useReducer:xs,useRef:Bs,useState:function(){return xs(vs)},useDebugValue:js,useDeferredValue:function(e){var t=ys();return null===os?t.memoizedState=e:Qs(t,os.memoizedState,e)},useTransition:function(){return[xs(vs)[0],ys().memoizedState]},useMutableSource:ws,useSyncExternalStore:_s,useId:Gs,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=Da(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nc(t,e,i,r),ja(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),a=Da(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Oa(e,a,i))&&(nc(t,e,i,r),ja(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=Da(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Oa(e,i,r))&&(nc(t,e,r,n),ja(t,e,r))}};function io(e,t,n,r,i,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,a))}function ao(e,t,n){var r=!1,i=Ni,a=t.contextType;return"object"===typeof a&&null!==a?a=Ta(a):(i=Mi(t)?Ti:ki.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Bi(e,i):Ni),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function so(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Pa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Ta(a):(a=Mi(t)?Ti:ki.current,i.context=Bi(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(no(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ro.enqueueReplaceState(i,i.state,null),Ha(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function Ao(e,t,n){(n=Da(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Gl=r),uo(0,t)},n}function po(e,t,n){(n=Da(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){uo(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function mo(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Da(-1,1)).tag=2,Oa(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var yo=b.ReactCurrentOwner,vo=!1;function bo(e,t,n,r){t.child=null===e?xa(t,null,n,r):ba(t,e.child,n,r)}function xo(e,t,n,r,i){n=n.render;var a=t.ref;return Ia(t,i),r=fs(e,t,n,r,a,i),n=gs(),null===e||vo?(ia&&n&&ea(t),t.flags|=1,bo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function wo(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Mc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,_o(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Vo(e,t,i)}return t.flags|=1,(e=Fc(a,r)).ref=t.ref,e.return=t,t.child=e}function _o(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(vo=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Vo(e,t,i);0!==(131072&e.flags)&&(vo=!0)}}return Eo(e,t,n,r,i)}function So(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ei(Fl,Ml),Ml|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ei(Fl,Ml),Ml|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ei(Fl,Ml),Ml|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ei(Fl,Ml),Ml|=r;return bo(e,t,i,n),t.child}function Co(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Eo(e,t,n,r,i){var a=Mi(n)?Ti:ki.current;return a=Bi(t,a),Ia(t,i),n=fs(e,t,n,r,a,i),r=gs(),null===e||vo?(ia&&r&&ea(t),t.flags|=1,bo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vo(e,t,i))}function No(e,t,n,r,i){if(Mi(n)){var a=!0;Pi(t)}else a=!1;if(Ia(t,i),null===t.stateNode)Qo(e,t),ao(t,n,r),oo(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ta(c):c=Bi(t,c=Mi(n)?Ti:ki.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==r||l!==c)&&so(t,s,r,c),La=!1;var d=t.memoizedState;s.state=d,Ha(t,r,s,i),l=t.memoizedState,o!==r||d!==l||Ii.current||La?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=La||io(t,n,o,r,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Ua(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ta(l):l=Bi(t,l=Mi(n)?Ti:ki.current);var A=n.getDerivedStateFromProps;(u="function"===typeof A||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==h||d!==l)&&so(t,s,r,l),La=!1,d=t.memoizedState,s.state=d,Ha(t,r,s,i);var p=t.memoizedState;o!==h||d!==p||Ii.current||La?("function"===typeof A&&(no(t,n,A,r),p=t.memoizedState),(c=La||io(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return ko(e,t,n,r,a,i)}function ko(e,t,n,r,i,a){Co(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Ui(t,n,!1),Vo(e,t,a);r=t.stateNode,yo.current=t;var o=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=ba(t,e.child,null,a),t.child=ba(t,null,o,a)):bo(e,t,o,a),t.memoizedState=r.state,i&&Ui(t,n,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Ri(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ri(0,t.context,!1),Xa(e,t.containerInfo)}function To(e,t,n,r,i){return Aa(),pa(i),t.flags|=256,bo(e,t,n,r),t.child}var Bo,Mo,Fo,Ro,Lo={dehydrated:null,treeContext:null,retryLane:0};function Po(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,n){var r,i=t.pendingProps,s=$a.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ei($a,1&s),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,o?(i=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Pc(l,i,0,null),e=Lc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Po(n),t.memoizedState=Lo,e):Do(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,o){if(n)return 256&t.flags?(t.flags&=-257,Oo(e,t,o,r=co(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Pc({mode:"visible",children:r.children},i,0,null),(s=Lc(s,i,o,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&ba(t,e.child,null,o),t.child.memoizedState=Po(o),t.memoizedState=Lo,s);if(0===(1&t.mode))return Oo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Oo(e,t,o,r=co(s=Error(a(419)),r,void 0))}if(l=0!==(o&e.childLanes),vo||l){if(null!==(r=Il)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Ra(e,i),nc(r,e,i,-1))}return fc(),Oo(e,t,o,r=co(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Nc.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ra=ci(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(qi[Ki++]=Yi,qi[Ki++]=Ji,qi[Ki++]=Xi,Yi=e.id,Ji=e.overflow,Xi=t),t=Do(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,s,n);if(o){o=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Fc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?o=Fc(r,o):(o=Lc(o,l,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,l=null===(l=e.child.memoizedState)?Po(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Lo,i}return e=(o=e.child).sibling,i=Fc(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Do(e,t){return(t=Pc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Oo(e,t,n,r){return null!==r&&pa(r),ba(t,e.child,null,n),(e=Do(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function jo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ka(e.return,t,n)}function zo(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Ho(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(bo(e,t,r.children,n),0!==(2&(r=$a.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&jo(e,n,t);else if(19===e.tag)jo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ei($a,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===es(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),zo(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===es(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}zo(t,!0,n,null,a);break;case"together":zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Pl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Fc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Go(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qo(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Mi(t.type)&&Fi(),Wo(t),null;case 3:return r=t.stateNode,Ya(),Ci(Ii),Ci(ki),ns(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(sc(aa),aa=null))),Mo(e,t),Wo(t),null;case 5:Za(t);var i=Ka(qa.current);if(n=t.type,null!==e&&null!=t.stateNode)Fo(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Wo(t),null}if(e=Ka(Ga.current),ha(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[di]=t,r[Ai]=s,e=0!==(1&t.mode),n){case"dialog":Or("cancel",r),Or("close",r);break;case"iframe":case"object":case"embed":Or("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Or(Lr[i],r);break;case"source":Or("error",r);break;case"img":case"image":case"link":Or("error",r),Or("load",r);break;case"details":Or("toggle",r);break;case"input":Y(r,s),Or("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Or("invalid",r);break;case"textarea":ie(r,s),Or("invalid",r)}for(var l in ye(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Or("scroll",r)}switch(n){case"input":W(r),$(r,s,!0);break;case"textarea":W(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[di]=t,e[Ai]=r,Bo(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,r),n){case"dialog":Or("cancel",e),Or("close",e),i=r;break;case"iframe":case"object":case"embed":Or("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Or(Lr[i],e);i=r;break;case"source":Or("error",e),i=r;break;case"img":case"image":case"link":Or("error",e),Or("load",e),i=r;break;case"details":Or("toggle",e),i=r;break;case"input":Y(e,r),i=X(e,r),Or("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),Or("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Or("invalid",e)}for(s in ye(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Or("scroll",e):null!=u&&v(e,s,u,l))}switch(n){case"input":W(e),$(e,r,!1);break;case"textarea":W(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ka(qa.current),Ka(Ga.current),ha(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(s=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return Wo(t),null;case 13:if(Ci($a),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))da(),Aa(),t.flags|=98560,s=!1;else if(s=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(a(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(a(317));s[di]=t}else Aa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),s=!1}else null!==aa&&(sc(aa),aa=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$a.current)?0===Rl&&(Rl=3):fc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Ya(),Mo(e,t),null===e&&Hr(t.stateNode.containerInfo),Wo(t),null;case 10:return Na(t.type._context),Wo(t),null;case 19:if(Ci($a),null===(s=t.memoizedState))return Wo(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)Go(s,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=es(e))){for(t.flags|=128,Go(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ei($a,1&$a.current|2),t.child}e=e.sibling}null!==s.tail&&Je()>Hl&&(t.flags|=128,r=!0,Go(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=es(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Go(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ia)return Wo(t),null}else 2*Je()-s.renderingStartTime>Hl&&1073741824!==n&&(t.flags|=128,r=!0,Go(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Je(),t.sibling=null,n=$a.current,Ei($a,r?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ml)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ko(e,t){switch(ta(t),t.tag){case 1:return Mi(t.type)&&Fi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),Ci(Ii),Ci(ki),ns(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(Ci($a),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));Aa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ci($a),null;case 4:return Ya(),null;case 10:return Na(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Bo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Mo=function(){},Fo=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ka(Ga.current);var a,s=null;switch(n){case"input":i=X(e,i),r=X(e,r),s=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(u in ye(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Or("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Ro=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xo=!1,Yo=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Zo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Sc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&el(t,n,a)}i=i.next}while(i!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function il(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[di],delete t[Ai],delete t[fi],delete t[gi],delete t[mi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,hl=!1;function dl(e,t,n){for(n=n.child;null!==n;)Al(e,t,n),n=n.sibling}function Al(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Yo||$o(n,t);case 6:var r=ul,i=hl;ul=null,dl(e,t,n),hl=i,null!==(ul=r)&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(e=ul,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Ht(e)):li(ul,n.stateNode));break;case 4:r=ul,i=hl,ul=n.stateNode.containerInfo,hl=!0,dl(e,t,n),ul=r,hl=i;break;case 0:case 11:case 14:case 15:if(!Yo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,s=a.destroy;a=a.tag,void 0!==s&&(0!==(2&a)||0!==(4&a))&&el(n,t,s),i=i.next}while(i!==r)}dl(e,t,n);break;case 1:if(!Yo&&($o(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Sc(n,t,o)}dl(e,t,n);break;case 21:dl(e,t,n);break;case 22:1&n.mode?(Yo=(r=Yo)||null!==n.memoizedState,dl(e,t,n),Yo=r):dl(e,t,n);break;default:dl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Jo),t.forEach(function(t){var r=kc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function fl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===ul)throw Error(a(160));Al(s,o,i),ul=null,hl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Sc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),ml(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Sc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Sc(e,e.return,g)}}break;case 1:fl(t,e),ml(e),512&r&&null!==n&&$o(n,n.return);break;case 5:if(fl(t,e),ml(e),512&r&&null!==n&&$o(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(g){Sc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,o=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&J(i,s),ve(l,o);var u=ve(l,s);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):v(i,h,d,u)}switch(l){case"input":Z(i,s);break;case"textarea":ae(i,s);break;case"select":var A=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(i,!!s.multiple,p,!1):A!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ai]=s}catch(g){Sc(e,e.return,g)}}break;case 6:if(fl(t,e),ml(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){Sc(e,e.return,g)}}break;case 3:if(fl(t,e),ml(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(g){Sc(e,e.return,g)}break;case 4:default:fl(t,e),ml(e);break;case 13:fl(t,e),ml(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(zl=Je())),4&r&&pl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Yo=(u=Yo)||h,fl(t,e),Yo=u):fl(t,e),ml(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Zo=e,h=e.child;null!==h;){for(d=Zo=h;null!==Zo;){switch(p=(A=Zo).child,A.tag){case 0:case 11:case 14:case 15:nl(4,A,A.return);break;case 1:$o(A,A.return);var f=A.stateNode;if("function"===typeof f.componentWillUnmount){r=A,n=A.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Sc(r,n,g)}}break;case 5:$o(A,A.return);break;case 22:if(null!==A.memoizedState){xl(d);continue}}null!==p?(p.return=A,Zo=p):xl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=fe("display",o))}catch(g){Sc(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Sc(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:fl(t,e),ml(e),4&r&&pl(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),cl(e,ol(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;ll(e,ol(e),s);break;default:throw Error(a(161))}}catch(o){Sc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Zo=e,vl(e,t,n)}function vl(e,t,n){for(var r=0!==(1&e.mode);null!==Zo;){var i=Zo,a=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Xo;if(!s){var o=i.alternate,l=null!==o&&null!==o.memoizedState||Yo;o=Xo;var c=Yo;if(Xo=s,(Yo=l)&&!c)for(Zo=i;null!==Zo;)l=(s=Zo).child,22===s.tag&&null!==s.memoizedState?wl(i):null!==l?(l.return=s,Zo=l):wl(i);for(;null!==a;)Zo=a,vl(a,t,n),a=a.sibling;Zo=i,Xo=o,Yo=c}bl(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Zo=a):bl(e)}}function bl(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Yo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Yo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Qa(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Qa(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ht(d)}}}break;default:throw Error(a(163))}Yo||512&t.flags&&il(t)}catch(A){Sc(t,t.return,A)}}if(t===e){Zo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zo=n;break}Zo=t.return}}function xl(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zo=n;break}Zo=t.return}}function wl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Sc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Sc(t,i,l)}}var a=t.return;try{il(t)}catch(l){Sc(t,a,l)}break;case 5:var s=t.return;try{il(t)}catch(l){Sc(t,s,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var _l,Sl=Math.ceil,Cl=b.ReactCurrentDispatcher,El=b.ReactCurrentOwner,Nl=b.ReactCurrentBatchConfig,kl=0,Il=null,Tl=null,Bl=0,Ml=0,Fl=Si(0),Rl=0,Ll=null,Pl=0,Ul=0,Dl=0,Ol=null,jl=null,zl=0,Hl=1/0,Ql=null,Vl=!1,Gl=null,Wl=null,ql=!1,Kl=null,Xl=0,Yl=0,Jl=null,Zl=-1,$l=0;function ec(){return 0!==(6&kl)?Je():-1!==Zl?Zl:Zl=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&kl)&&0!==Bl?Bl&-Bl:null!==fa.transition?(0===$l&&($l=ft()),$l):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,n,r){if(50<Yl)throw Yl=0,Jl=null,Error(a(185));mt(e,n,r),0!==(2&kl)&&e===Il||(e===Il&&(0===(2&kl)&&(Ul|=n),4===Rl&&oc(e,Bl)),rc(e,r),1===n&&0===kl&&0===(1&t.mode)&&(Hl=Je()+500,Oi&&Hi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),o=1<<s,l=i[s];-1===l?0!==(o&n)&&0===(o&r)||(i[s]=At(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var r=dt(e,e===Il?Bl:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Oi=!0,zi(e)}(lc.bind(null,e)):zi(lc.bind(null,e)),si(function(){0===(6&kl)&&Hi()}),n=null;else{switch(bt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ic(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Zl=-1,$l=0,0!==(6&kl))throw Error(a(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=dt(e,e===Il?Bl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var i=kl;kl|=2;var s=pc();for(Il===e&&Bl===t||(Ql=null,Hl=Je()+500,dc(e,t));;)try{yc();break}catch(l){Ac(e,l)}Ea(),Cl.current=s,kl=i,null!==Tl?t=0:(Il=null,Bl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=ac(e,i))),1===t)throw n=Ll,dc(e,0),oc(e,r),rc(e,Je()),n;if(6===t)oc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!or(a(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gc(e,r))&&(0!==(s=pt(e))&&(r=s,t=ac(e,s))),1===t))throw n=Ll,dc(e,0),oc(e,r),rc(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:xc(e,jl,Ql);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=zl+500-Je())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xc.bind(null,e,jl,Ql),t);break}xc(e,jl,Ql);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-st(r);s=1<<o,(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sl(r/1960))-r)){e.timeoutHandle=ri(xc.bind(null,e,jl,Ql),r);break}xc(e,jl,Ql);break;default:throw Error(a(329))}}}return rc(e,Je()),e.callbackNode===n?ic.bind(null,e):null}function ac(e,t){var n=Ol;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=jl,jl=n,null!==t&&sc(t)),e}function sc(e){null===jl?jl=e:jl.push.apply(jl,e)}function oc(e,t){for(t&=~Dl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&kl))throw Error(a(327));wc();var t=dt(e,0);if(0===(1&t))return rc(e,Je()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Ll,dc(e,0),oc(e,t),rc(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,jl,Ql),rc(e,Je()),null}function cc(e,t){var n=kl;kl|=1;try{return e(t)}finally{0===(kl=n)&&(Hl=Je()+500,Oi&&Hi())}}function uc(e){null!==Kl&&0===Kl.tag&&0===(6&kl)&&wc();var t=kl;kl|=1;var n=Nl.transition,r=vt;try{if(Nl.transition=null,vt=1,e)return e()}finally{vt=r,Nl.transition=n,0===(6&(kl=t))&&Hi()}}function hc(){Ml=Fl.current,Ci(Fl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Tl)for(n=Tl.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Fi();break;case 3:Ya(),Ci(Ii),Ci(ki),ns();break;case 5:Za(r);break;case 4:Ya();break;case 13:case 19:Ci($a);break;case 10:Na(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Il=e,Tl=e=Fc(e.current,null),Bl=Ml=t,Rl=0,Ll=null,Dl=Ul=Pl=0,jl=Ol=null,null!==Ba){for(t=0;t<Ba.length;t++)if(null!==(r=(n=Ba[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=i,r.next=s}n.pending=r}Ba=null}return e}function Ac(e,t){for(;;){var n=Tl;try{if(Ea(),rs.current=Js,cs){for(var r=ss.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}cs=!1}if(as=0,ls=os=ss=null,us=!1,hs=0,El.current=null,null===n||null===n.return){Rl=1,Ll=t,Tl=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Bl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var A=h.alternate;A?(h.updateQueue=A.updateQueue,h.memoizedState=A.memoizedState,h.lanes=A.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,mo(p,o,l,0,t),1&p.mode&&fo(s,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){fo(s,u,t),fc();break e}c=Error(a(426))}else if(ia&&1&l.mode){var m=go(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),mo(m,o,l,0,t),pa(lo(c,l));break e}}s=c=lo(c,l),4!==Rl&&(Rl=2),null===Ol?Ol=[s]:Ol.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,za(s,Ao(0,c,t));break e;case 1:l=c;var y=s.type,v=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Wl||!Wl.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,za(s,po(s,l,t));break e}}s=s.return}while(null!==s)}bc(n)}catch(b){t=b,Tl===n&&null!==n&&(Tl=n=n.return);continue}break}}function pc(){var e=Cl.current;return Cl.current=Js,null===e?Js:e}function fc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Il||0===(268435455&Pl)&&0===(268435455&Ul)||oc(Il,Bl)}function gc(e,t){var n=kl;kl|=2;var r=pc();for(Il===e&&Bl===t||(Ql=null,dc(e,t));;)try{mc();break}catch(i){Ac(e,i)}if(Ea(),kl=n,Cl.current=r,null!==Tl)throw Error(a(261));return Il=null,Bl=0,Rl}function mc(){for(;null!==Tl;)vc(Tl)}function yc(){for(;null!==Tl&&!Xe();)vc(Tl)}function vc(e){var t=_l(e.alternate,e,Ml);e.memoizedProps=e.pendingProps,null===t?bc(e):Tl=t,El.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qo(n,t,Ml)))return void(Tl=n)}else{if(null!==(n=Ko(n,t)))return n.flags&=32767,void(Tl=n);if(null===e)return Rl=6,void(Tl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Tl=t);Tl=t=e}while(null!==t);0===Rl&&(Rl=5)}function xc(e,t,n){var r=vt,i=Nl.transition;try{Nl.transition=null,vt=1,function(e,t,n,r){do{wc()}while(null!==Kl);if(0!==(6&kl))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,s),e===Il&&(Tl=Il=null,Bl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||ql||(ql=!0,Ic(tt,function(){return wc(),null})),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Nl.transition,Nl.transition=null;var o=vt;vt=1;var l=kl;kl|=4,El.current=null,function(e,t){if(ei=Vt,Ar(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(x){n=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=e,A=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=o+i),d!==s||0!==r&&3!==d.nodeType||(c=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)A=d,d=p;for(;;){if(d===e)break t;if(A===n&&++u===i&&(l=o),A===s&&++h===r&&(c=o),null!==(p=d.nextSibling))break;A=(d=A).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Vt=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,m=f.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),m);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(x){Sc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}f=tl,tl=!1}(e,n),gl(n,e),pr(ti),Vt=!!ei,ti=ei=null,e.current=n,yl(n,e,i),Ye(),kl=l,vt=o,Nl.transition=s}else e.current=n;if(ql&&(ql=!1,Kl=e,Xl=i),s=e.pendingLanes,0===s&&(Wl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Vl)throw Vl=!1,e=Gl,Gl=null,e;0!==(1&Xl)&&0!==e.tag&&wc(),s=e.pendingLanes,0!==(1&s)?e===Jl?Yl++:(Yl=0,Jl=e):Yl=0,Hi()}(e,t,n,r)}finally{Nl.transition=i,vt=r}return null}function wc(){if(null!==Kl){var e=bt(Xl),t=Nl.transition,n=vt;try{if(Nl.transition=null,vt=16>e?16:e,null===Kl)var r=!1;else{if(e=Kl,Kl=null,Xl=0,0!==(6&kl))throw Error(a(331));var i=kl;for(kl|=4,Zo=e.current;null!==Zo;){var s=Zo,o=s.child;if(0!==(16&Zo.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zo=u;null!==Zo;){var h=Zo;switch(h.tag){case 0:case 11:case 15:nl(8,h,s)}var d=h.child;if(null!==d)d.return=h,Zo=d;else for(;null!==Zo;){var A=(h=Zo).sibling,p=h.return;if(al(h),h===u){Zo=null;break}if(null!==A){A.return=p,Zo=A;break}Zo=p}}}var f=s.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}Zo=s}}if(0!==(2064&s.subtreeFlags)&&null!==o)o.return=s,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(s=Zo).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Zo=y;break e}Zo=s.return}}var v=e.current;for(Zo=v;null!==Zo;){var b=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,Zo=b;else e:for(o=v;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Sc(l,l.return,w)}if(l===o){Zo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Zo=x;break e}Zo=l.return}}if(kl=i,Hi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(w){}r=!0}return r}finally{vt=n,Nl.transition=t}}return!1}function _c(e,t,n){e=Oa(e,t=Ao(0,t=lo(n,t),1),1),t=ec(),null!==e&&(mt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=Oa(t,e=po(t,e=lo(n,e),1),1),e=ec(),null!==t&&(mt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Bl&n)===n&&(4===Rl||3===Rl&&(130023424&Bl)===Bl&&500>Je()-zl?dc(e,0):Dl|=n),rc(e,t)}function Ec(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Ra(e,t))&&(mt(e,t,n),rc(e,n))}function Nc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ec(e,n)}function kc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ec(e,n)}function Ic(e,t){return qe(e,t)}function Tc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bc(e,t,n,r){return new Tc(e,t,n,r)}function Mc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fc(e,t){var n=e.alternate;return null===n?((n=Bc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,r,i,s){var o=2;if(r=e,"function"===typeof e)Mc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case _:return Lc(n.children,i,s,t);case S:o=8,i|=8;break;case C:return(e=Bc(12,n,t,2|i)).elementType=C,e.lanes=s,e;case I:return(e=Bc(13,n,t,i)).elementType=I,e.lanes=s,e;case T:return(e=Bc(19,n,t,i)).elementType=T,e.lanes=s,e;case F:return Pc(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case N:o=9;break e;case k:o=11;break e;case B:o=14;break e;case M:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Bc(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Lc(e,t,n,r){return(e=Bc(7,e,r,t)).lanes=n,e}function Pc(e,t,n,r){return(e=Bc(22,e,r,t)).elementType=F,e.lanes=n,e.stateNode={isHidden:!1},e}function Uc(e,t,n){return(e=Bc(6,e,null,t)).lanes=n,e}function Dc(e,t,n){return(t=Bc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Oc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,i,a,s,o,l){return e=new Oc(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Bc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pa(a),e}function zc(e){if(!e)return Ni;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Mi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Mi(n))return Li(e,n,t)}return t}function Hc(e,t,n,r,i,a,s,o,l){return(e=jc(n,r,!0,e,0,a,0,o,l)).context=zc(null),n=e.current,(a=Da(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Oa(n,a,i),e.current.lanes=i,mt(e,i,r),rc(e,r),e}function Qc(e,t,n,r){var i=t.current,a=ec(),s=tc(i);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Da(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oa(i,t,s))&&(nc(e,i,s,a),ja(e,i,s)),s}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}_l=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)vo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return vo=!1,function(e,t,n){switch(t.tag){case 3:Io(t),Aa();break;case 5:Ja(t);break;case 1:Mi(t.type)&&Pi(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ei(wa,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ei($a,1&$a.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Uo(e,t,n):(Ei($a,1&$a.current),null!==(e=Vo(e,t,n))?e.sibling:null);Ei($a,1&$a.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ho(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ei($a,$a.current),r)break;return null;case 22:case 23:return t.lanes=0,So(e,t,n)}return Vo(e,t,n)}(e,t,n);vo=0!==(131072&e.flags)}else vo=!1,ia&&0!==(1048576&t.flags)&&$i(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Qo(e,t),e=t.pendingProps;var i=Bi(t,ki.current);Ia(t,n),i=fs(null,t,r,e,i,n);var s=gs();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Mi(r)?(s=!0,Pi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Pa(t),i.updater=ro,t.stateNode=i,i._reactInternals=t,oo(t,r,e,n),t=ko(null,t,r,!0,s,n)):(t.tag=0,ia&&s&&ea(t),bo(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Qo(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Mc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===B)return 14}return 2}(r),e=to(r,e),i){case 0:t=Eo(null,t,r,e,n);break e;case 1:t=No(null,t,r,e,n);break e;case 11:t=xo(null,t,r,e,n);break e;case 14:t=wo(null,t,r,to(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Eo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 1:return r=t.type,i=t.pendingProps,No(e,t,r,i=t.elementType===r?i:to(r,i),n);case 3:e:{if(Io(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,Ua(e,t),Ha(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=To(e,t,r,n,i=lo(Error(a(423)),t));break e}if(r!==i){t=To(e,t,r,n,i=lo(Error(a(424)),t));break e}for(ra=ci(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=xa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Aa(),r===i){t=Vo(e,t,n);break e}bo(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&ca(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==s&&ni(r,s)&&(t.flags|=32),Co(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Uo(e,t,n);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ba(t,null,r,n):bo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,Ei(wa,r._currentValue),r._currentValue=o,null!==s)if(or(s.value,o)){if(s.children===i.children&&!Ii.current){t=Vo(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Da(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),ka(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),ka(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}bo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ia(t,n),r=r(i=Ta(i)),t.flags|=1,bo(e,t,r,n),t.child;case 14:return i=to(r=t.type,t.pendingProps),wo(e,t,r,i=to(r.type,i),n);case 15:return _o(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:to(r,i),Qo(e,t),t.tag=1,Mi(r)?(e=!0,Pi(t)):e=!1,Ia(t,n),ao(t,r,i),oo(t,r,i,n),ko(null,t,r,!0,e,n);case 19:return Ho(e,t,n);case 22:return So(e,t,n)}throw Error(a(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function $c(e,t,n,r,i){var a=n._reactRootContainer;if(a){var s=a;if("function"===typeof i){var o=i;i=function(){var e=Vc(s);o.call(e)}}Qc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=Vc(s);a.call(e)}}var s=Hc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[pi]=s.current,Hr(8===e.nodeType?e.parentNode:e),uc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var o=r;r=function(){var e=Vc(l);o.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[pi]=l.current,Hr(8===e.nodeType?e.parentNode:e),uc(function(){Qc(t,l,n,r)}),l}(n,t,e,i,r);return Vc(s)}Xc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Qc(e,t,null,null)},Xc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){Qc(null,e,null,null)}),t[pi]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ft.length&&0!==t&&t<Ft[n].priority;n++);Ft.splice(n,0,e),0===n&&Ut(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Je()),0===(6&kl)&&(Hl=Je()+500,Hi()))}break;case 13:uc(function(){var t=Ra(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Wc(e,1)}},wt=function(e){if(13===e.tag){var t=Ra(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},_t=function(e){if(13===e.tag){var t=tc(e),n=Ra(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},St=function(){return vt},Ct=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(a(90));q(r),Z(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=cc,Ie=uc;var eu={usingClientEntryPoint:!1,Events:[vi,bi,xi,Ee,Ne,cc]},tu={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),at=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var n=!1,r="",i=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Hr(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(a(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",o=qc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Hc(t,null,e,1,null!=n?n:null,i,0,s,o),e[pi]=t.current,Hr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(a(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(a(40));return!!e._reactRootContainer&&(uc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[pi]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return $c(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},3121:(e,t,n)=>{"use strict";n.r(t),n.d(t,{calculateBearing:()=>hr,calculateDistance:()=>nr,calculateRouteDistance:()=>or,calculateTerritoryArea:()=>er,clusterProperties:()=>dr,createBuffer:()=>lr,doTerritoriesOverlap:()=>ir,findPropertiesInRadius:()=>cr,generateGridInTerritory:()=>Ar,getBoundingBox:()=>ar,getTerritoryCenter:()=>rr,isPointInTerritory:()=>tr,optimizeRoute:()=>sr,polygonToGeoJSON:()=>pr,simplifyPolygon:()=>fr,snapToRoad:()=>ur});var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("coordinates must contain numbers");return a({type:"Point",coordinates:e},t,n)}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(const r of e){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<r[r.length-1].length;e++)if(r[r.length-1][e]!==r[0][e])throw new Error("First and last Position are not equivalent.")}return a({type:"Polygon",coordinates:e},t,n)}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function c(e,t){return a({type:"MultiPolygon",coordinates:e},t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kilometers";const n=i[t];if(!n)throw new Error(t+" units is invalid");return e*n}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kilometers";const n=i[t];if(!n)throw new Error(t+" units is invalid");return e/n}function d(e){return 180*(e%(2*Math.PI))/Math.PI}function A(e){return e%360*Math.PI/180}function p(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function f(e,t,n){if(null!==e)for(var r,i,a,s,o,l,c,u,h=0,d=0,A=e.type,p="FeatureCollection"===A,g="Feature"===A,m=p?e.features.length:1,y=0;y<m;y++){o=(u=!!(c=p?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<o;v++){var b=0,x=0;if(null!==(s=u?c.geometries[v]:c)){l=s.coordinates;var w=s.type;switch(h=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,y,b,x))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],d,y,b,x))return!1;d++,"MultiPoint"===w&&b++}"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-h;i++){if(!1===t(l[r][i],d,y,b,x))return!1;d++}"MultiLineString"===w&&b++,"Polygon"===w&&x++}"Polygon"===w&&b++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,i=0;i<l[r].length;i++){for(a=0;a<l[r][i].length-h;a++){if(!1===t(l[r][i][a],d,y,b,x))return!1;d++}x++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===f(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function g(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function m(e,t){var n,r,i,a,s,o,l,c,u,h,d=0,A="FeatureCollection"===e.type,p="Feature"===e.type,f=A?e.features.length:1;for(n=0;n<f;n++){for(o=A?e.features[n].geometry:p?e.geometry:e,c=A?e.features[n].properties:p?e.properties:{},u=A?e.features[n].bbox:p?e.bbox:void 0,h=A?e.features[n].id:p?e.id:void 0,s=(l=!!o&&"GeometryCollection"===o.type)?o.geometries.length:1,i=0;i<s;i++)if(null!==(a=l?o.geometries[i]:o))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(a,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===t(a.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function y(e){return function(e,t,n){var r=n;return m(e,function(e,i,a,s,o){r=0===i&&void 0===n?e:t(r,e,i,a,s,o)}),r}(e,(e,t)=>e+function(e){let t,n=0;switch(e.type){case"Polygon":return v(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)n+=v(e.coordinates[t]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t),0)}function v(e){let t=0;if(e&&e.length>0){t+=Math.abs(w(e[0]));for(let n=1;n<e.length;n++)t-=Math.abs(w(e[n]))}return t}var b=20294876564838.72,x=Math.PI/180;function w(e){const t=e.length-1;if(t<=2)return 0;let n=0,r=0;for(;r<t;){const i=e[r],a=e[r+1===t?0:r+1],s=e[r+2>=t?(r+2)%t:r+2],o=i[0]*x,l=a[1]*x;n+=(s[0]*x-o)*Math.sin(l),r++}return n*b}const _=134217729;function S(e,t,n,r,i){let a,s,o,l,c=t[0],u=r[0],h=0,d=0;u>c===u>-c?(a=c,c=t[++h]):(a=u,u=r[++d]);let A=0;if(h<e&&d<n)for(u>c===u>-c?(s=c+a,o=a-(s-c),c=t[++h]):(s=u+a,o=a-(s-u),u=r[++d]),a=s,0!==o&&(i[A++]=o);h<e&&d<n;)u>c===u>-c?(s=a+c,l=s-a,o=a-(s-l)+(c-l),c=t[++h]):(s=a+u,l=s-a,o=a-(s-l)+(u-l),u=r[++d]),a=s,0!==o&&(i[A++]=o);for(;h<e;)s=a+c,l=s-a,o=a-(s-l)+(c-l),c=t[++h],a=s,0!==o&&(i[A++]=o);for(;d<n;)s=a+u,l=s-a,o=a-(s-l)+(u-l),u=r[++d],a=s,0!==o&&(i[A++]=o);return 0===a&&0!==A||(i[A++]=a),A}function C(e){return new Float64Array(e)}const E=C(4),N=C(8),k=C(12),I=C(16),T=C(4);function B(e,t,n,r,i,a){const s=(t-a)*(n-i),o=(e-i)*(r-a),l=s-o,c=Math.abs(s+o);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,n,r,i,a,s){let o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,C,B;const M=e-i,F=n-i,R=t-a,L=r-a;b=M*L,d=_*M,A=d-(d-M),p=M-A,d=_*L,f=d-(d-L),g=L-f,x=p*g-(b-A*f-p*f-A*g),w=R*F,d=_*R,A=d-(d-R),p=R-A,d=_*F,f=d-(d-F),g=F-f,C=p*g-(w-A*f-p*f-A*g),m=x-C,h=x-m,E[0]=x-(m+h)+(h-C),y=b+m,h=y-b,v=b-(y-h)+(m-h),m=v-w,h=v-m,E[1]=v-(m+h)+(h-w),B=y+m,h=B-y,E[2]=y-(B-h)+(m-h),E[3]=B;let P=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,E),U=22204460492503146e-32*s;if(P>=U||-P>=U)return P;if(h=e-M,o=e-(M+h)+(h-i),h=n-F,c=n-(F+h)+(h-i),h=t-R,l=t-(R+h)+(h-a),h=r-L,u=r-(L+h)+(h-a),0===o&&0===l&&0===c&&0===u)return P;if(U=11093356479670487e-47*s+33306690738754706e-32*Math.abs(P),P+=M*u+L*o-(R*c+F*l),P>=U||-P>=U)return P;b=o*L,d=_*o,A=d-(d-o),p=o-A,d=_*L,f=d-(d-L),g=L-f,x=p*g-(b-A*f-p*f-A*g),w=l*F,d=_*l,A=d-(d-l),p=l-A,d=_*F,f=d-(d-F),g=F-f,C=p*g-(w-A*f-p*f-A*g),m=x-C,h=x-m,T[0]=x-(m+h)+(h-C),y=b+m,h=y-b,v=b-(y-h)+(m-h),m=v-w,h=v-m,T[1]=v-(m+h)+(h-w),B=y+m,h=B-y,T[2]=y-(B-h)+(m-h),T[3]=B;const D=S(4,E,4,T,N);b=M*u,d=_*M,A=d-(d-M),p=M-A,d=_*u,f=d-(d-u),g=u-f,x=p*g-(b-A*f-p*f-A*g),w=R*c,d=_*R,A=d-(d-R),p=R-A,d=_*c,f=d-(d-c),g=c-f,C=p*g-(w-A*f-p*f-A*g),m=x-C,h=x-m,T[0]=x-(m+h)+(h-C),y=b+m,h=y-b,v=b-(y-h)+(m-h),m=v-w,h=v-m,T[1]=v-(m+h)+(h-w),B=y+m,h=B-y,T[2]=y-(B-h)+(m-h),T[3]=B;const O=S(D,N,4,T,k);b=o*u,d=_*o,A=d-(d-o),p=o-A,d=_*u,f=d-(d-u),g=u-f,x=p*g-(b-A*f-p*f-A*g),w=l*c,d=_*l,A=d-(d-l),p=l-A,d=_*c,f=d-(d-c),g=c-f,C=p*g-(w-A*f-p*f-A*g),m=x-C,h=x-m,T[0]=x-(m+h)+(h-C),y=b+m,h=y-b,v=b-(y-h)+(m-h),m=v-w,h=v-m,T[1]=v-(m+h)+(h-w),B=y+m,h=B-y,T[2]=y-(B-h)+(m-h),T[3]=B;const j=S(O,k,4,T,I);return I[j-1]}(e,t,n,r,i,a,c)}C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(8),C(8),C(8),C(4),C(8),C(8),C(8),C(12);C(192),C(192);C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(8),C(8),C(8),C(8),C(8),C(8),C(8),C(8),C(8),C(4),C(4),C(4),C(8),C(16),C(16),C(16),C(32),C(32),C(48),C(64);C(1152),C(1152);C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(4),C(24),C(24),C(24),C(24),C(24),C(24),C(24),C(24),C(24),C(24),C(1152),C(1152),C(1152),C(1152),C(1152),C(2304),C(2304),C(3456),C(5760),C(8),C(8),C(8),C(16),C(24),C(48),C(48),C(96),C(192),C(384),C(384),C(384),C(768);C(96),C(96),C(96),C(1152);function M(e,t){var n,r,i,a,s,o,l,c,u,h=0,d=e[0],A=e[1],p=t.length;for(n=0;n<p;n++){r=0;var f=t[n],g=f.length-1;if((c=f[0])[0]!==f[g][0]&&c[1]!==f[g][1])throw new Error("First and last coordinates in a ring must be the same");for(a=c[0]-d,s=c[1]-A;r<g;r++){if(o=(u=f[r+1])[0]-d,l=u[1]-A,0===s&&0===l){if(o<=0&&a>=0||a<=0&&o>=0)return 0}else if(l>=0&&s<=0||l<=0&&s>=0){if(0===(i=B(a,o,s,l,0,0)))return 0;(i>0&&l>0&&s<=0||i<0&&l<=0&&s>0)&&h++}c=u,s=l,a=o}}return h%2!==0}function F(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function R(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function L(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const r=F(e),i="Feature"===(a=t).type?a.geometry:a;var a;const s=i.type,o=t.bbox;let l=i.coordinates;if(o&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,o))return!1;"Polygon"===s&&(l=[l]);let c=!1;for(var u=0;u<l.length;++u){const e=M(r,l[u]);if(0===e)return!n.ignoreBoundary;e&&(c=!0)}return c}function P(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r=F(e),i=F(t),a=A(i[1]-r[1]),s=A(i[0]-r[0]),o=A(r[1]),l=A(i[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(o)*Math.cos(l);return u(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,r=0,i=0;return f(e,function(e){n+=e[0],r+=e[1],i++},!0),s([n/i,r/i],t.properties)}var D=n(4980),O=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,j=Math.ceil,z=Math.floor,H="[BigNumber Error] ",Q=H+"Number primitive has more than 15 significant digits: ",V=1e14,G=14,W=9007199254740991,q=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],K=1e7,X=1e9;function Y(e){var t=0|e;return e>0||e===t?t:t-1}function J(e){for(var t,n,r=1,i=e.length,a=e[0]+"";r<i;){for(t=e[r++]+"",n=G-t.length;n--;t="0"+t);a+=t}for(i=a.length;48===a.charCodeAt(--i););return a.slice(0,i+1||1)}function Z(e,t){var n,r,i=e.c,a=t.c,s=e.s,o=t.s,l=e.e,c=t.e;if(!s||!o)return null;if(n=i&&!i[0],r=a&&!a[0],n||r)return n?r?0:-o:s;if(s!=o)return s;if(n=s<0,r=l==c,!i||!a)return r?0:!i^n?1:-1;if(!r)return l>c^n?1:-1;for(o=(l=i.length)<(c=a.length)?l:c,s=0;s<o;s++)if(i[s]!=a[s])return i[s]>a[s]^n?1:-1;return l==c?0:l>c^n?1:-1}function $(e,t,n,r){if(e<t||e>n||e!==z(e))throw Error(H+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function ee(e){var t=e.c.length-1;return Y(e.e/G)==t&&e.c[t]%2!=0}function te(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function ne(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(++t>(r=e.length)){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var re=function e(t){var n,r,i,a=v.prototype={constructor:v,toString:null,valueOf:null},s=new v(1),o=20,l=4,c=-7,u=21,h=-1e7,d=1e7,A=!1,p=1,f=0,g={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},m="0123456789abcdefghijklmnopqrstuvwxyz",y=!0;function v(e,t){var n,a,s,c,u,A,p,f,g=this;if(!(g instanceof v))return new v(e,t);if(null==t){if(e&&!0===e._isBigNumber)return g.s=e.s,void(!e.c||e.e>d?g.c=g.e=null:e.e<h?g.c=[g.e=0]:(g.e=e.e,g.c=e.c.slice()));if((A="number"==typeof e)&&0*e==0){if(g.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,u=e;u>=10;u/=10,c++);return void(c>d?g.c=g.e=null:(g.e=c,g.c=[e]))}f=String(e)}else{if(!O.test(f=String(e)))return i(g,f,A);g.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(c=f.indexOf("."))>-1&&(f=f.replace(".","")),(u=f.search(/e/i))>0?(c<0&&(c=u),c+=+f.slice(u+1),f=f.substring(0,u)):c<0&&(c=f.length)}else{if($(t,2,m.length,"Base"),10==t&&y)return _(g=new v(e),o+g.e+1,l);if(f=String(e),A="number"==typeof e){if(0*e!=0)return i(g,f,A,t);if(g.s=1/e<0?(f=f.slice(1),-1):1,v.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(Q+e)}else g.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(n=m.slice(0,t),c=u=0,p=f.length;u<p;u++)if(n.indexOf(a=f.charAt(u))<0){if("."==a){if(u>c){c=p;continue}}else if(!s&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){s=!0,u=-1,c=0;continue}return i(g,String(e),A,t)}A=!1,(c=(f=r(f,t,10,g.s)).indexOf("."))>-1?f=f.replace(".",""):c=f.length}for(u=0;48===f.charCodeAt(u);u++);for(p=f.length;48===f.charCodeAt(--p););if(f=f.slice(u,++p)){if(p-=u,A&&v.DEBUG&&p>15&&(e>W||e!==z(e)))throw Error(Q+g.s*e);if((c=c-u-1)>d)g.c=g.e=null;else if(c<h)g.c=[g.e=0];else{if(g.e=c,g.c=[],u=(c+1)%G,c<0&&(u+=G),u<p){for(u&&g.c.push(+f.slice(0,u)),p-=G;u<p;)g.c.push(+f.slice(u,u+=G));u=G-(f=f.slice(u)).length}else u-=p;for(;u--;f+="0");g.c.push(+f)}}else g.c=[g.e=0]}function b(e,t,n,r){var i,a,s,o,h;if(null==n?n=l:$(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)h=J(e.c),h=1==r||2==r&&(s<=c||s>=u)?te(h,s):ne(h,s,"0");else if(a=(e=_(new v(e),t,n)).e,o=(h=J(e.c)).length,1==r||2==r&&(t<=a||a<=c)){for(;o<t;h+="0",o++);h=te(h,a)}else if(t-=s+(2===r&&a>s),h=ne(h,a,"0"),a+1>o){if(--t>0)for(h+=".";t--;h+="0");}else if((t+=a-o)>0)for(a+1==o&&(h+=".");t--;h+="0");return e.s<0&&i?"-"+h:h}function x(e,t){for(var n,r,i=1,a=new v(e[0]);i<e.length;i++)(!(r=new v(e[i])).s||(n=Z(a,r))===t||0===n&&a.s===t)&&(a=r);return a}function w(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+n*G-1)>d?e.c=e.e=null:n<h?e.c=[e.e=0]:(e.e=n,e.c=t),e}function _(e,t,n,r){var i,a,s,o,l,c,u,A=e.c,p=q;if(A){e:{for(i=1,o=A[0];o>=10;o/=10,i++);if((a=t-i)<0)a+=G,s=t,l=A[c=0],u=z(l/p[i-s-1]%10);else if((c=j((a+1)/G))>=A.length){if(!r)break e;for(;A.length<=c;A.push(0));l=u=0,i=1,s=(a%=G)-G+1}else{for(l=o=A[c],i=1;o>=10;o/=10,i++);u=(s=(a%=G)-G+i)<0?0:z(l/p[i-s-1]%10)}if(r=r||t<0||null!=A[c+1]||(s<0?l:l%p[i-s-1]),r=n<4?(u||r)&&(0==n||n==(e.s<0?3:2)):u>5||5==u&&(4==n||r||6==n&&(a>0?s>0?l/p[i-s]:0:A[c-1])%10&1||n==(e.s<0?8:7)),t<1||!A[0])return A.length=0,r?(t-=e.e+1,A[0]=p[(G-t%G)%G],e.e=-t||0):A[0]=e.e=0,e;if(0==a?(A.length=c,o=1,c--):(A.length=c+1,o=p[G-a],A[c]=s>0?z(l/p[i-s]%p[s])*o:0),r)for(;;){if(0==c){for(a=1,s=A[0];s>=10;s/=10,a++);for(s=A[0]+=o,o=1;s>=10;s/=10,o++);a!=o&&(e.e++,A[0]==V&&(A[0]=1));break}if(A[c]+=o,A[c]!=V)break;A[c--]=0,o=1}for(a=A.length;0===A[--a];A.pop());}e.e>d?e.c=e.e=null:e.e<h&&(e.c=[e.e=0])}return e}function S(e){var t,n=e.e;return null===n?e.toString():(t=J(e.c),t=n<=c||n>=u?te(t,n):ne(t,n,"0"),e.s<0?"-"+t:t)}return v.clone=e,v.ROUND_UP=0,v.ROUND_DOWN=1,v.ROUND_CEIL=2,v.ROUND_FLOOR=3,v.ROUND_HALF_UP=4,v.ROUND_HALF_DOWN=5,v.ROUND_HALF_EVEN=6,v.ROUND_HALF_CEIL=7,v.ROUND_HALF_FLOOR=8,v.EUCLID=9,v.config=v.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(H+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&($(n=e[t],0,X,t),o=n),e.hasOwnProperty(t="ROUNDING_MODE")&&($(n=e[t],0,8,t),l=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?($(n[0],-X,0,t),$(n[1],0,X,t),c=n[0],u=n[1]):($(n,-X,X,t),c=-(u=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)$(n[0],-X,-1,t),$(n[1],1,X,t),h=n[0],d=n[1];else{if($(n,-X,X,t),!n)throw Error(H+t+" cannot be zero: "+n);h=-(d=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(H+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw A=!n,Error(H+"crypto unavailable");A=n}else A=n}if(e.hasOwnProperty(t="MODULO_MODE")&&($(n=e[t],0,9,t),p=n),e.hasOwnProperty(t="POW_PRECISION")&&($(n=e[t],0,X,t),f=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(H+t+" not an object: "+n);g=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(H+t+" invalid: "+n);y="0123456789"==n.slice(0,10),m=n}}return{DECIMAL_PLACES:o,ROUNDING_MODE:l,EXPONENTIAL_AT:[c,u],RANGE:[h,d],CRYPTO:A,MODULO_MODE:p,POW_PRECISION:f,FORMAT:g,ALPHABET:m}},v.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!v.DEBUG)return!0;var t,n,r=e.c,i=e.e,a=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===a||-1===a)&&i>=-X&&i<=X&&i===z(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%G)<1&&(t+=G),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=V||n!==z(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===a||1===a||-1===a))return!0;throw Error(H+"Invalid BigNumber: "+e)},v.maximum=v.max=function(){return x(arguments,-1)},v.minimum=v.min=function(){return x(arguments,1)},v.random=function(){var e=9007199254740992,t=Math.random()*e&2097151?function(){return z(Math.random()*e)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)};return function(e){var n,r,i,a,l,c=0,u=[],h=new v(s);if(null==e?e=o:$(e,0,X),a=j(e/G),A)if(crypto.getRandomValues){for(n=crypto.getRandomValues(new Uint32Array(a*=2));c<a;)(l=131072*n[c]+(n[c+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),n[c]=r[0],n[c+1]=r[1]):(u.push(l%1e14),c+=2);c=a/2}else{if(!crypto.randomBytes)throw A=!1,Error(H+"crypto unavailable");for(n=crypto.randomBytes(a*=7);c<a;)(l=281474976710656*(31&n[c])+1099511627776*n[c+1]+4294967296*n[c+2]+16777216*n[c+3]+(n[c+4]<<16)+(n[c+5]<<8)+n[c+6])>=9e15?crypto.randomBytes(7).copy(n,c):(u.push(l%1e14),c+=7);c=a/7}if(!A)for(;c<a;)(l=t())<9e15&&(u[c++]=l%1e14);for(a=u[--c],e%=G,a&&e&&(l=q[G-e],u[c]=z(a/l)*l);0===u[c];u.pop(),c--);if(c<0)u=[i=0];else{for(i=-1;0===u[0];u.splice(0,1),i-=G);for(c=1,l=u[0];l>=10;l/=10,c++);c<G&&(i-=G-c)}return h.e=i,h.c=u,h}}(),v.sum=function(){for(var e=1,t=arguments,n=new v(t[0]);e<t.length;)n=n.plus(t[e++]);return n},r=function(){var e="0123456789";function t(e,t,n,r){for(var i,a,s=[0],o=0,l=e.length;o<l;){for(a=s.length;a--;s[a]*=t);for(s[0]+=r.indexOf(e.charAt(o++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(r,i,a,s,c){var u,h,d,A,p,g,y,b,x=r.indexOf("."),w=o,_=l;for(x>=0&&(A=f,f=0,r=r.replace(".",""),g=(b=new v(i)).pow(r.length-x),f=A,b.c=t(ne(J(g.c),g.e,"0"),10,a,e),b.e=b.c.length),d=A=(y=t(r,i,a,c?(u=m,e):(u=e,m))).length;0==y[--A];y.pop());if(!y[0])return u.charAt(0);if(x<0?--d:(g.c=y,g.e=d,g.s=s,y=(g=n(g,b,w,_,a)).c,p=g.r,d=g.e),x=y[h=d+w+1],A=a/2,p=p||h<0||null!=y[h+1],p=_<4?(null!=x||p)&&(0==_||_==(g.s<0?3:2)):x>A||x==A&&(4==_||p||6==_&&1&y[h-1]||_==(g.s<0?8:7)),h<1||!y[0])r=p?ne(u.charAt(1),-w,u.charAt(0)):u.charAt(0);else{if(y.length=h,p)for(--a;++y[--h]>a;)y[h]=0,h||(++d,y=[1].concat(y));for(A=y.length;!y[--A];);for(x=0,r="";x<=A;r+=u.charAt(y[x++]));r=ne(r,d,u.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,i,a,s,o=0,l=e.length,c=t%K,u=t/K|0;for(e=e.slice();l--;)o=((i=c*(a=e[l]%K)+(r=u*a+(s=e[l]/K|0)*c)%K*K+o)/n|0)+(r/K|0)+u*s,e[l]=i%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var i,a;if(n!=r)a=n>r?1:-1;else for(i=a=0;i<n;i++)if(e[i]!=t[i]){a=e[i]>t[i]?1:-1;break}return a}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,a,s,o){var l,c,u,h,d,A,p,f,g,m,y,b,x,w,S,C,E,N=r.s==i.s?1:-1,k=r.c,I=i.c;if(!k||!k[0]||!I||!I[0])return new v(r.s&&i.s&&(k?!I||k[0]!=I[0]:I)?k&&0==k[0]||!I?0*N:N/0:NaN);for(g=(f=new v(N)).c=[],N=a+(c=r.e-i.e)+1,o||(o=V,c=Y(r.e/G)-Y(i.e/G),N=N/G|0),u=0;I[u]==(k[u]||0);u++);if(I[u]>(k[u]||0)&&c--,N<0)g.push(1),h=!0;else{for(w=k.length,C=I.length,u=0,N+=2,(d=z(o/(I[0]+1)))>1&&(I=e(I,d,o),k=e(k,d,o),C=I.length,w=k.length),x=C,y=(m=k.slice(0,C)).length;y<C;m[y++]=0);E=I.slice(),E=[0].concat(E),S=I[0],I[1]>=o/2&&S++;do{if(d=0,(l=t(I,m,C,y))<0){if(b=m[0],C!=y&&(b=b*o+(m[1]||0)),(d=z(b/S))>1)for(d>=o&&(d=o-1),p=(A=e(I,d,o)).length,y=m.length;1==t(A,m,p,y);)d--,n(A,C<p?E:I,p,o),p=A.length,l=1;else 0==d&&(l=d=1),p=(A=I.slice()).length;if(p<y&&(A=[0].concat(A)),n(m,A,y,o),y=m.length,-1==l)for(;t(I,m,C,y)<1;)d++,n(m,C<y?E:I,y,o),y=m.length}else 0===l&&(d++,m=[0]);g[u++]=d,m[0]?m[y++]=k[x]||0:(m=[k[x]],y=1)}while((x++<w||null!=m[0])&&N--);h=null!=m[0],g[0]||g.splice(0,1)}if(o==V){for(u=1,N=g[0];N>=10;N/=10,u++);_(f,a+(f.e=u+c*G-1)+1,s,h)}else f.e=c,f.r=+h;return f}}(),i=function(){var e=/^(-?)0([xbo])(?=\w[\w.]*$)/i,t=/^([^.]+)\.$/,n=/^\.([^.]+)$/,r=/^-?(Infinity|NaN)$/,i=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(a,s,o,l){var c,u=o?s:s.replace(i,"");if(r.test(u))a.s=isNaN(u)?null:u<0?-1:1;else{if(!o&&(u=u.replace(e,function(e,t,n){return c="x"==(n=n.toLowerCase())?16:"b"==n?2:8,l&&l!=c?e:t}),l&&(c=l,u=u.replace(t,"$1").replace(n,"0.$1")),s!=u))return new v(u,c);if(v.DEBUG)throw Error(H+"Not a"+(l?" base "+l:"")+" number: "+s);a.s=null}a.c=a.e=null}}(),a.absoluteValue=a.abs=function(){var e=new v(this);return e.s<0&&(e.s=1),e},a.comparedTo=function(e,t){return Z(this,new v(e,t))},a.decimalPlaces=a.dp=function(e,t){var n,r,i,a=this;if(null!=e)return $(e,0,X),null==t?t=l:$(t,0,8),_(new v(a),e+a.e+1,t);if(!(n=a.c))return null;if(r=((i=n.length-1)-Y(this.e/G))*G,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},a.dividedBy=a.div=function(e,t){return n(this,new v(e,t),o,l)},a.dividedToIntegerBy=a.idiv=function(e,t){return n(this,new v(e,t),0,1)},a.exponentiatedBy=a.pow=function(e,t){var n,r,i,a,o,c,u,h,d=this;if((e=new v(e)).c&&!e.isInteger())throw Error(H+"Exponent not an integer: "+S(e));if(null!=t&&(t=new v(t)),o=e.e>14,!d.c||!d.c[0]||1==d.c[0]&&!d.e&&1==d.c.length||!e.c||!e.c[0])return h=new v(Math.pow(+S(d),o?e.s*(2-ee(e)):+S(e))),t?h.mod(t):h;if(c=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new v(NaN);(r=!c&&d.isInteger()&&t.isInteger())&&(d=d.mod(t))}else{if(e.e>9&&(d.e>0||d.e<-1||(0==d.e?d.c[0]>1||o&&d.c[1]>=24e7:d.c[0]<8e13||o&&d.c[0]<=9999975e7)))return a=d.s<0&&ee(e)?-0:0,d.e>-1&&(a=1/a),new v(c?1/a:a);f&&(a=j(f/G+2))}for(o?(n=new v(.5),c&&(e.s=1),u=ee(e)):u=(i=Math.abs(+S(e)))%2,h=new v(s);;){if(u){if(!(h=h.times(d)).c)break;a?h.c.length>a&&(h.c.length=a):r&&(h=h.mod(t))}if(i){if(0===(i=z(i/2)))break;u=i%2}else if(_(e=e.times(n),e.e+1,1),e.e>14)u=ee(e);else{if(0===(i=+S(e)))break;u=i%2}d=d.times(d),a?d.c&&d.c.length>a&&(d.c.length=a):r&&(d=d.mod(t))}return r?h:(c&&(h=s.div(h)),t?h.mod(t):a?_(h,f,l,undefined):h)},a.integerValue=function(e){var t=new v(this);return null==e?e=l:$(e,0,8),_(t,t.e+1,e)},a.isEqualTo=a.eq=function(e,t){return 0===Z(this,new v(e,t))},a.isFinite=function(){return!!this.c},a.isGreaterThan=a.gt=function(e,t){return Z(this,new v(e,t))>0},a.isGreaterThanOrEqualTo=a.gte=function(e,t){return 1===(t=Z(this,new v(e,t)))||0===t},a.isInteger=function(){return!!this.c&&Y(this.e/G)>this.c.length-2},a.isLessThan=a.lt=function(e,t){return Z(this,new v(e,t))<0},a.isLessThanOrEqualTo=a.lte=function(e,t){return-1===(t=Z(this,new v(e,t)))||0===t},a.isNaN=function(){return!this.s},a.isNegative=function(){return this.s<0},a.isPositive=function(){return this.s>0},a.isZero=function(){return!!this.c&&0==this.c[0]},a.minus=function(e,t){var n,r,i,a,s=this,o=s.s;if(t=(e=new v(e,t)).s,!o||!t)return new v(NaN);if(o!=t)return e.s=-t,s.plus(e);var c=s.e/G,u=e.e/G,h=s.c,d=e.c;if(!c||!u){if(!h||!d)return h?(e.s=-t,e):new v(d?s:NaN);if(!h[0]||!d[0])return d[0]?(e.s=-t,e):new v(h[0]?s:3==l?-0:0)}if(c=Y(c),u=Y(u),h=h.slice(),o=c-u){for((a=o<0)?(o=-o,i=h):(u=c,i=d),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(r=(a=(o=h.length)<(t=d.length))?o:t,o=t=0;t<r;t++)if(h[t]!=d[t]){a=h[t]<d[t];break}if(a&&(i=h,h=d,d=i,e.s=-e.s),(t=(r=d.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=V-1;r>o;){if(h[--r]<d[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=V}h[r]-=d[r]}for(;0==h[0];h.splice(0,1),--u);return h[0]?w(e,h,u):(e.s=3==l?-1:1,e.c=[e.e=0],e)},a.modulo=a.mod=function(e,t){var r,i,a=this;return e=new v(e,t),!a.c||!e.s||e.c&&!e.c[0]?new v(NaN):!e.c||a.c&&!a.c[0]?new v(a):(9==p?(i=e.s,e.s=1,r=n(a,e,0,3),e.s=i,r.s*=i):r=n(a,e,0,p),(e=a.minus(r.times(e))).c[0]||1!=p||(e.s=a.s),e)},a.multipliedBy=a.times=function(e,t){var n,r,i,a,s,o,l,c,u,h,d,A,p,f,g,m=this,y=m.c,b=(e=new v(e,t)).c;if(!y||!b||!y[0]||!b[0])return!m.s||!e.s||y&&!y[0]&&!b||b&&!b[0]&&!y?e.c=e.e=e.s=null:(e.s*=m.s,y&&b?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=Y(m.e/G)+Y(e.e/G),e.s*=m.s,(l=y.length)<(h=b.length)&&(p=y,y=b,b=p,i=l,l=h,h=i),i=l+h,p=[];i--;p.push(0));for(f=V,g=K,i=h;--i>=0;){for(n=0,d=b[i]%g,A=b[i]/g|0,a=i+(s=l);a>i;)n=((c=d*(c=y[--s]%g)+(o=A*c+(u=y[s]/g|0)*d)%g*g+p[a]+n)/f|0)+(o/g|0)+A*u,p[a--]=c%f;p[a]=n}return n?++r:p.splice(0,1),w(e,p,r)},a.negated=function(){var e=new v(this);return e.s=-e.s||null,e},a.plus=function(e,t){var n,r=this,i=r.s;if(t=(e=new v(e,t)).s,!i||!t)return new v(NaN);if(i!=t)return e.s=-t,r.minus(e);var a=r.e/G,s=e.e/G,o=r.c,l=e.c;if(!a||!s){if(!o||!l)return new v(i/0);if(!o[0]||!l[0])return l[0]?e:new v(o[0]?r:0*i)}if(a=Y(a),s=Y(s),o=o.slice(),i=a-s){for(i>0?(s=a,n=l):(i=-i,n=o),n.reverse();i--;n.push(0));n.reverse()}for((i=o.length)-(t=l.length)<0&&(n=l,l=o,o=n,t=i),i=0;t;)i=(o[--t]=o[t]+l[t]+i)/V|0,o[t]=V===o[t]?0:o[t]%V;return i&&(o=[i].concat(o),++s),w(e,o,s)},a.precision=a.sd=function(e,t){var n,r,i,a=this;if(null!=e&&e!==!!e)return $(e,1,X),null==t?t=l:$(t,0,8),_(new v(a),e,t);if(!(n=a.c))return null;if(r=(i=n.length-1)*G+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&a.e+1>r&&(r=a.e+1),r},a.shiftedBy=function(e){return $(e,-9007199254740991,W),this.times("1e"+e)},a.squareRoot=a.sqrt=function(){var e,t,r,i,a,s=this,c=s.c,u=s.s,h=s.e,d=o+4,A=new v("0.5");if(1!==u||!c||!c[0])return new v(!u||u<0&&(!c||c[0])?NaN:c?s:1/0);if(0==(u=Math.sqrt(+S(s)))||u==1/0?(((t=J(c)).length+h)%2==0&&(t+="0"),u=Math.sqrt(+t),h=Y((h+1)/2)-(h<0||h%2),r=new v(t=u==1/0?"5e"+h:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+h)):r=new v(u+""),r.c[0])for((u=(h=r.e)+d)<3&&(u=0);;)if(a=r,r=A.times(a.plus(n(s,a,d,1))),J(a.c).slice(0,u)===(t=J(r.c)).slice(0,u)){if(r.e<h&&--u,"9999"!=(t=t.slice(u-3,u+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(_(r,r.e+o+2,1),e=!r.times(r).eq(s));break}if(!i&&(_(a,a.e+o+2,0),a.times(a).eq(s))){r=a;break}d+=4,u+=4,i=1}return _(r,r.e+o+1,l,e)},a.toExponential=function(e,t){return null!=e&&($(e,0,X),e++),b(this,e,t,1)},a.toFixed=function(e,t){return null!=e&&($(e,0,X),e=e+this.e+1),b(this,e,t)},a.toFormat=function(e,t,n){var r,i=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=g;else if("object"!=typeof n)throw Error(H+"Argument not an object: "+n);if(r=i.toFixed(e,t),i.c){var a,s=r.split("."),o=+n.groupSize,l=+n.secondaryGroupSize,c=n.groupSeparator||"",u=s[0],h=s[1],d=i.s<0,A=d?u.slice(1):u,p=A.length;if(l&&(a=o,o=l,l=a,p-=a),o>0&&p>0){for(a=p%o||o,u=A.substr(0,a);a<p;a+=o)u+=c+A.substr(a,o);l>0&&(u+=c+A.slice(a)),d&&(u="-"+u)}r=h?u+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):u}return(n.prefix||"")+r+(n.suffix||"")},a.toFraction=function(e){var t,r,i,a,o,c,u,h,A,p,f,g,m=this,y=m.c;if(null!=e&&(!(u=new v(e)).isInteger()&&(u.c||1!==u.s)||u.lt(s)))throw Error(H+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+S(u));if(!y)return new v(m);for(t=new v(s),A=r=new v(s),i=h=new v(s),g=J(y),o=t.e=g.length-m.e-1,t.c[0]=q[(c=o%G)<0?G+c:c],e=!e||u.comparedTo(t)>0?o>0?t:A:u,c=d,d=1/0,u=new v(g),h.c[0]=0;p=n(u,t,0,1),1!=(a=r.plus(p.times(i))).comparedTo(e);)r=i,i=a,A=h.plus(p.times(a=A)),h=a,t=u.minus(p.times(a=t)),u=a;return a=n(e.minus(r),i,0,1),h=h.plus(a.times(A)),r=r.plus(a.times(i)),h.s=A.s=m.s,f=n(A,i,o*=2,l).minus(m).abs().comparedTo(n(h,r,o,l).minus(m).abs())<1?[A,i]:[h,r],d=c,f},a.toNumber=function(){return+S(this)},a.toPrecision=function(e,t){return null!=e&&$(e,1,X),b(this,e,t,2)},a.toString=function(e){var t,n=this,i=n.s,a=n.e;return null===a?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=a<=c||a>=u?te(J(n.c),a):ne(J(n.c),a,"0"):10===e&&y?t=ne(J((n=_(new v(n),o+a+1,l)).c),n.e,"0"):($(e,2,m.length,"Base"),t=r(ne(J(n.c),a,"0"),10,e,i,!0)),i<0&&n.c[0]&&(t="-"+t)),t},a.valueOf=a.toJSON=function(){return S(this)},a._isBigNumber=!0,a[Symbol.toStringTag]="BigNumber",a[Symbol.for("nodejs.util.inspect.custom")]=a.valueOf,null!=t&&v.set(t),v}();const ie=re;var ae=class{constructor(e){(0,D.A)(this,"key",void 0),(0,D.A)(this,"left",null),(0,D.A)(this,"right",null),this.key=e}},se=class extends ae{constructor(e){super(e)}},oe=class e extends ae{constructor(e,t){super(e),(0,D.A)(this,"value",void 0),this.value=t}replaceValue(t){const n=new e(this.key,t);return n.left=this.left,n.right=this.right,n}},le=class{constructor(){(0,D.A)(this,"size",0),(0,D.A)(this,"modificationCount",0),(0,D.A)(this,"splayCount",0)}splay(e){const t=this.root;if(null==t)return this.compare(e,e),-1;let n=null,r=null,i=null,a=null,s=t;const o=this.compare;let l;for(;;)if(l=o(s.key,e),l>0){let t=s.left;if(null==t)break;if(l=o(t.key,e),l>0&&(s.left=t.right,t.right=s,s=t,t=s.left,null==t))break;null==n?r=s:n.left=s,n=s,s=t}else{if(!(l<0))break;{let t=s.right;if(null==t)break;if(l=o(t.key,e),l<0&&(s.right=t.left,t.left=s,s=t,t=s.right,null==t))break;null==i?a=s:i.right=s,i=s,s=t}}return null!=i&&(i.right=s.left,s.left=a),null!=n&&(n.left=s.right,s.right=r),this.root!==s&&(this.root=s,this.splayCount++),l}splayMin(e){let t=e,n=t.left;for(;null!=n;){const e=n;t.left=e.right,e.right=t,t=e,n=t.left}return t}splayMax(e){let t=e,n=t.right;for(;null!=n;){const e=n;t.right=e.left,e.left=t,t=e,n=t.right}return t}_delete(e){if(null==this.root)return null;if(0!=this.splay(e))return null;let t=this.root;const n=t,r=t.left;if(this.size--,null==r)this.root=t.right;else{const e=t.right;t=this.splayMax(r),t.right=e,this.root=t}return this.modificationCount++,n}addNewRoot(e,t){this.size++,this.modificationCount++;const n=this.root;null!=n?(t<0?(e.left=n,e.right=n.right,n.right=null):(e.right=n,e.left=n.left,n.left=null),this.root=e):this.root=e}_first(){const e=this.root;return null==e?null:(this.root=this.splayMin(e),this.root)}_last(){const e=this.root;return null==e?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&0==this.splay(e)}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},ce=(Symbol.iterator,class e extends le{constructor(e,t){super(),(0,D.A)(this,"root",null),(0,D.A)(this,"compare",void 0),(0,D.A)(this,"validKey",void 0),(0,D.A)(this,Symbol.toStringTag,"[object Set]"),this.compare=null!==e&&void 0!==e?e:this.defaultCompare(),this.validKey=null!==t&&void 0!==t?t:e=>null!=e&&void 0!=e}delete(e){return!!this.validKey(e)&&null!=this._delete(e)}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let n;for(;n=t.next(),!n.done;)e(n.value,n.value,this)}add(e){const t=this.splay(e);return 0!=t&&this.addNewRoot(new se(e),t),this}addAndReturn(e){const t=this.splay(e);return 0!=t&&this.addNewRoot(new se(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return null==this.root}isNotEmpty(){return null!=this.root}single(){if(0==this.size)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(0==this.size)throw"Bad state: No element";return this._first().key}last(){if(0==this.size)throw"Bad state: No element";return this._last().key}lastBefore(e){if(null==e)throw"Invalid arguments(s)";if(null==this.root)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(null==t)return null;let n=t.right;for(;null!=n;)t=n,n=t.right;return t.key}firstAfter(e){if(null==e)throw"Invalid arguments(s)";if(null==this.root)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(null==t)return null;let n=t.left;for(;null!=n;)t=n,n=t.left;return t.key}retainAll(t){const n=new e(this.compare,this.validKey),r=this.modificationCount;for(const e of t){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(e)&&0==this.splay(e)&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){if(!this.validKey(e))return null;return 0!=this.splay(e)?null:this.root.key}intersection(t){const n=new e(this.compare,this.validKey);for(const e of this)t.has(e)&&n.add(e);return n}difference(t){const n=new e(this.compare,this.validKey);for(const e of this)t.has(e)||n.add(e);return n}union(e){const t=this.clone();return t.addAll(e),t}clone(){const t=new e(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(e){if(null==e)return null;const t=new se(e.key);return function e(t,n){let r,i;do{if(r=t.left,i=t.right,null!=r){const t=new se(r.key);n.left=t,e(r,t)}if(null!=i){const e=new se(i.key);n.right=e,t=i,n=e}}while(null!=i)}(e,t),t}toSet(){return this.clone()}entries(){return new de(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new he(this.wrap())}}),ue=class{constructor(e){(0,D.A)(this,"tree",void 0),(0,D.A)(this,"path",new Array),(0,D.A)(this,"modificationCount",null),(0,D.A)(this,"splayCount",void 0),this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;null!=e;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(null==this.modificationCount){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;null!=e;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(null!=t){for(;null!=t;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},he=class extends ue{getValue(e){return e.key}},de=class extends ue{getValue(e){return[e.key,e.key]}},Ae=class extends ue{constructor(e){super(e)}getValue(e){return e.value}},pe=class extends ue{constructor(e){super(e)}getValue(e){return[e.key,e.value]}replaceValue(e){if(this.modificationCount!=this.tree.getModificationCount())throw"Concurrent modification during iteration.";this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);const t=this.path.pop(),n=t.replaceValue(e);if(this.path.length){const e=this.path[this.path.length-1];t===e.left?e.left=n:e.right=n}else this.tree.setRoot(n);this.path.push(n);const r=this.tree.getSplayCount()+1;this.tree.setSplayCount(r),this.splayCount=r}},fe=e=>()=>e,ge=e=>{const t=e?(t,n)=>n.minus(t).abs().isLessThanOrEqualTo(e):fe(!1);return(e,n)=>t(e,n)?0:e.comparedTo(n)};function me(e){const t=e?(t,n,r,i,a)=>t.exponentiatedBy(2).isLessThanOrEqualTo(i.minus(n).exponentiatedBy(2).plus(a.minus(r).exponentiatedBy(2)).times(e)):fe(!1);return(e,n,r)=>{const i=e.x,a=e.y,s=r.x,o=r.y,l=a.minus(o).times(n.x.minus(s)).minus(i.minus(s).times(n.y.minus(o)));return t(l,i,a,s,o)?0:l.comparedTo(0)}}var ye=e=>e,ve=e=>{if(e){const t=new ce(ge(e)),n=new ce(ge(e)),r=(e,t)=>t.addAndReturn(e),i=e=>({x:r(e.x,t),y:r(e.y,n)});return i({x:new ie(0),y:new ie(0)}),i}return ye},be=e=>({set:e=>{xe=be(e)},reset:()=>be(e),compare:ge(e),snap:ve(e),orient:me(e)}),xe=be(),we=(e,t)=>e.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(e.ur.x)&&e.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(e.ur.y),_e=(e,t)=>{if(t.ur.x.isLessThan(e.ll.x)||e.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(e.ll.y)||e.ur.y.isLessThan(t.ll.y))return null;const n=e.ll.x.isLessThan(t.ll.x)?t.ll.x:e.ll.x,r=e.ur.x.isLessThan(t.ur.x)?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y.isLessThan(t.ll.y)?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y.isLessThan(t.ur.y)?e.ur.y:t.ur.y}}},Se=(e,t)=>e.x.times(t.y).minus(e.y.times(t.x)),Ce=(e,t)=>e.x.times(t.x).plus(e.y.times(t.y)),Ee=e=>Ce(e,e).sqrt(),Ne=(e,t,n)=>{const r={x:t.x.minus(e.x),y:t.y.minus(e.y)},i={x:n.x.minus(e.x),y:n.y.minus(e.y)};return Se(i,r).div(Ee(i)).div(Ee(r))},ke=(e,t,n)=>{const r={x:t.x.minus(e.x),y:t.y.minus(e.y)},i={x:n.x.minus(e.x),y:n.y.minus(e.y)};return Ce(i,r).div(Ee(i)).div(Ee(r))},Ie=(e,t,n)=>t.y.isZero()?null:{x:e.x.plus(t.x.div(t.y).times(n.minus(e.y))),y:n},Te=(e,t,n)=>t.x.isZero()?null:{x:n,y:e.y.plus(t.y.div(t.x).times(n.minus(e.x)))},Be=class e{static compare(t,n){const r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Oe.compare(t.segment,n.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){(0,D.A)(this,"point",void 0),(0,D.A)(this,"isLeft",void 0),(0,D.A)(this,"segment",void 0),(0,D.A)(this,"otherSE",void 0),(0,D.A)(this,"consumedBy",void 0),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,r=t.length;n<r;n++){const e=t[n];this.point.events.push(e),e.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(void 0===n.segment.consumedBy)for(let r=t+1;r<e;r++){const e=this.point.events[r];void 0===e.consumedBy&&(n.otherSE.point.events===e.otherSE.point.events&&n.segment.consume(e.segment))}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){const t=new Map,n=n=>{const r=n.otherSE;t.set(n,{sine:Ne(this.point,e.point,r.point),cosine:ke(this.point,e.point,r.point)})};return(e,r)=>{t.has(e)||n(e),t.has(r)||n(r);const{sine:i,cosine:a}=t.get(e),{sine:s,cosine:o}=t.get(r);return i.isGreaterThanOrEqualTo(0)&&s.isGreaterThanOrEqualTo(0)?a.isLessThan(o)?1:a.isGreaterThan(o)?-1:0:i.isLessThan(0)&&s.isLessThan(0)?a.isLessThan(o)?-1:a.isGreaterThan(o)?1:0:s.isLessThan(i)?-1:s.isGreaterThan(i)?1:0}}},Me=class e{static factory(t){const n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(!i.isInResult()||i.ringOut)continue;let a=null,s=i.leftSE,o=i.rightSE;const l=[s],c=s.point,u=[];for(;a=s,s=o,l.push(s),s.point!==c;)for(;;){const t=s.getAvailableLinkedEvents();if(0===t.length){const e=l[0].point,t=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(e.x,", ").concat(e.y,"]. Last matching segment found ends at [").concat(t.x,", ").concat(t.y,"]."))}if(1===t.length){o=t[0].otherSE;break}let r=null;for(let e=0,n=u.length;e<n;e++)if(u[e].point===s.point){r=e;break}if(null!==r){const t=u.splice(r)[0],i=l.splice(t.index);i.unshift(i[0].otherSE),n.push(new e(i.reverse()));continue}u.push({index:l.length,point:s.point});const i=s.getLeftmostComparator(a);o=t.sort(i)[0].otherSE;break}n.push(new e(l))}return n}constructor(e){(0,D.A)(this,"events",void 0),(0,D.A)(this,"poly",void 0),(0,D.A)(this,"_isExteriorRing",void 0),(0,D.A)(this,"_enclosingRing",void 0),this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let l=1,c=this.events.length-1;l<c;l++){const n=this.events[l].point,r=this.events[l+1].point;0!==xe.orient(n,e,r)&&(t.push(n),e=n)}if(1===t.length)return null;const n=t[0],r=t[1];0===xe.orient(n,e,r)&&t.shift(),t.push(t[0]);const i=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,o=[];for(let l=a;l!=s;l+=i)o.push([t[l].x.toNumber(),t[l].y.toNumber()]);return o}isExteriorRing(){if(void 0===this._isExteriorRing){const e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,s=this.events.length;a<s;a++){const t=this.events[a];Be.compare(e,t)>0&&(e=t)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;var r,i;if(n.ringOut!==t.ringOut)return(null===(r=n.ringOut)||void 0===r?void 0:r.enclosingRing())!==t.ringOut?t.ringOut:null===(i=t.ringOut)||void 0===i?void 0:i.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}},Fe=class{constructor(e){(0,D.A)(this,"exteriorRing",void 0),(0,D.A)(this,"interiorRings",void 0),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=this.exteriorRing.getGeom();if(null===e)return null;const t=[e];for(let n=0,r=this.interiorRings.length;n<r;n++){const e=this.interiorRings[n].getGeom();null!==e&&t.push(e)}return t}},Re=class{constructor(e){(0,D.A)(this,"rings",void 0),(0,D.A)(this,"polys",void 0),this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getGeom();null!==n&&e.push(n)}return e}_composePolys(e){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];if(!i.poly)if(i.isExteriorRing())t.push(new Fe(i));else{var n;const e=i.enclosingRing();null!==e&&void 0!==e&&e.poly||t.push(new Fe(e)),null===e||void 0===e||null===(n=e.poly)||void 0===n||n.addInterior(i)}}return t}},Le=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oe.compare;(0,D.A)(this,"queue",void 0),(0,D.A)(this,"tree",void 0),(0,D.A)(this,"segments",void 0),this.queue=e,this.tree=new ce(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),n;e.isLeft&&this.tree.add(t);let r=t,i=t;do{r=this.tree.lastBefore(r)}while(null!=r&&void 0!=r.consumedBy);do{i=this.tree.firstAfter(i)}while(null!=i&&void 0!=i.consumedBy);if(e.isLeft){let a=null;if(r){const e=r.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(a=e),!r.isAnEndpoint(e))){const t=this._splitSafely(r,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}let s=null;if(i){const e=i.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(s=e),!i.isAnEndpoint(e))){const t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}if(null!==a||null!==s){let e=null;if(null===a)e=s;else if(null===s)e=a;else{e=Be.comparePoints(a,s)<=0?a:s}this.queue.delete(t.rightSE),n.push(t.rightSE);const r=t.split(e);for(let t=0,i=r.length;t<i;t++)n.push(r[t])}n.length>0?(this.tree.delete(t),n.push(e)):(this.segments.push(t),t.prev=r)}else{if(r&&i){const e=r.getIntersection(i);if(null!==e){if(!r.isAnEndpoint(e)){const t=this._splitSafely(r,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}if(!i.isAnEndpoint(e)){const t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}}this.tree.delete(t)}return n}_splitSafely(e,t){this.tree.delete(e);const n=e.rightSE;this.queue.delete(n);const r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}},Pe=new class{constructor(){(0,D.A)(this,"type",void 0),(0,D.A)(this,"numMultiPolys",void 0)}run(e,t,n){Pe.type=e;const r=[new He(t,!0)];for(let l=0,c=n.length;l<c;l++)r.push(new He(n[l],!1));if(Pe.numMultiPolys=r.length,"difference"===Pe.type){const e=r[0];let t=1;for(;t<r.length;)null!==_e(r[t].bbox,e.bbox)?t++:r.splice(t,1)}if("intersection"===Pe.type)for(let l=0,c=r.length;l<c;l++){const e=r[l];for(let t=l+1,n=r.length;t<n;t++)if(null===_e(e.bbox,r[t].bbox))return[]}const i=new ce(Be.compare);for(let l=0,c=r.length;l<c;l++){const e=r[l].getSweepEvents();for(let t=0,n=e.length;t<n;t++)i.add(e[t])}const a=new Le(i);let s=null;for(0!=i.size&&(s=i.first(),i.delete(s));s;){const e=a.process(s);for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0===n.consumedBy&&i.add(n)}0!=i.size?(s=i.first(),i.delete(s)):s=null}xe.reset();const o=Me.factory(a.segments);return new Re(o).getGeom()}},Ue=Pe,De=0,Oe=class e{static compare(e,t){const n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,a=t.rightSE.point.x;if(a.isLessThan(n))return 1;if(i.isLessThan(r))return-1;const s=e.leftSE.point.y,o=t.leftSE.point.y,l=e.rightSE.point.y,c=t.rightSE.point.y;if(n.isLessThan(r)){if(o.isLessThan(s)&&o.isLessThan(l))return 1;if(o.isGreaterThan(s)&&o.isGreaterThan(l))return-1;const n=e.comparePoint(t.leftSE.point);if(n<0)return 1;if(n>0)return-1;const r=t.comparePoint(e.rightSE.point);return 0!==r?r:-1}if(n.isGreaterThan(r)){if(s.isLessThan(o)&&s.isLessThan(c))return-1;if(s.isGreaterThan(o)&&s.isGreaterThan(c))return 1;const n=t.comparePoint(e.leftSE.point);if(0!==n)return n;const r=e.comparePoint(t.rightSE.point);return r<0?1:r>0?-1:1}if(s.isLessThan(o))return-1;if(s.isGreaterThan(o))return 1;if(i.isLessThan(a)){const n=t.comparePoint(e.rightSE.point);if(0!==n)return n}if(i.isGreaterThan(a)){const n=e.comparePoint(t.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(!i.eq(a)){const e=l.minus(s),t=i.minus(n),u=c.minus(o),h=a.minus(r);if(e.isGreaterThan(t)&&u.isLessThan(h))return 1;if(e.isLessThan(t)&&u.isGreaterThan(h))return-1}return i.isGreaterThan(a)?1:i.isLessThan(a)||l.isLessThan(c)?-1:l.isGreaterThan(c)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,r){(0,D.A)(this,"id",void 0),(0,D.A)(this,"leftSE",void 0),(0,D.A)(this,"rightSE",void 0),(0,D.A)(this,"rings",void 0),(0,D.A)(this,"windings",void 0),(0,D.A)(this,"ringOut",void 0),(0,D.A)(this,"consumedBy",void 0),(0,D.A)(this,"prev",void 0),(0,D.A)(this,"_prevInResult",void 0),(0,D.A)(this,"_beforeState",void 0),(0,D.A)(this,"_afterState",void 0),(0,D.A)(this,"_isInResult",void 0),this.id=++De,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=r}static fromRing(t,n,r){let i,a,s;const o=Be.comparePoints(t,n);if(o<0)i=t,a=n,s=1;else{if(!(o>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,a=t,s=-1}const l=new Be(i,!0),c=new Be(a,!1);return new e(l,c,[r],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return xe.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),n=e.bbox(),r=_e(t,n);if(null===r)return null;const i=this.leftSE.point,a=this.rightSE.point,s=e.leftSE.point,o=e.rightSE.point,l=we(t,s)&&0===this.comparePoint(s),c=we(n,i)&&0===e.comparePoint(i),u=we(t,o)&&0===this.comparePoint(o),h=we(n,a)&&0===e.comparePoint(a);if(c&&l)return h&&!u?a:!h&&u?o:null;if(c)return u&&i.x.eq(o.x)&&i.y.eq(o.y)?null:i;if(l)return h&&a.x.eq(s.x)&&a.y.eq(s.y)?null:s;if(h&&u)return null;if(h)return a;if(u)return o;const d=((e,t,n,r)=>{if(t.x.isZero())return Te(n,r,e.x);if(r.x.isZero())return Te(e,t,n.x);if(t.y.isZero())return Ie(n,r,e.y);if(r.y.isZero())return Ie(e,t,n.y);const i=Se(t,r);if(i.isZero())return null;const a={x:n.x.minus(e.x),y:n.y.minus(e.y)},s=Se(a,t).div(i),o=Se(a,r).div(i),l=e.x.plus(o.times(t.x)),c=n.x.plus(s.times(r.x)),u=e.y.plus(o.times(t.y)),h=n.y.plus(s.times(r.y));return{x:l.plus(c).div(2),y:u.plus(h).div(2)}})(i,this.vector(),s,e.vector());return null===d?null:we(r,d)?xe.snap(d):null}split(t){const n=[],r=void 0!==t.events,i=new Be(t,!0),a=new Be(t,!1),s=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);const o=new e(i,s,this.rings.slice(),this.windings.slice());return Be.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Be.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),a.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(t){let n=this,r=t;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=e.compare(n,r);if(0!==i){if(i>0){const e=n;n=r,r=e}if(n.prev===r){const e=n;n=r,r=e}for(let e=0,t=r.rings.length;e<t;e++){const t=r.rings[e],i=r.windings[e],a=n.rings.indexOf(t);-1===a?(n.rings.push(t),n.windings.push(i)):n.windings[a]+=i}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let s=0,o=this.rings.length;s<o;s++){const e=this.rings[s],r=this.windings[s],i=t.indexOf(e);-1===i?(t.push(e),n.push(r)):n[i]+=r}const i=[],a=[];for(let s=0,o=t.length;s<o;s++){if(0===n[s])continue;const e=t[s],r=e.poly;if(-1===a.indexOf(r))if(e.isExterior)i.push(r);else{-1===a.indexOf(r)&&a.push(r);const t=i.indexOf(e.poly);-1!==t&&i.splice(t,1)}}for(let s=0,o=i.length;s<o;s++){const e=i[s].multiPoly;-1===r.indexOf(e)&&r.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Ue.type){case"union":{const n=0===e.length,r=0===t.length;this._isInResult=n!==r;break}case"intersection":{let n,r;e.length<t.length?(n=e.length,r=t.length):(n=t.length,r=e.length),this._isInResult=r===Ue.numMultiPolys&&n<r;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=e=>1===e.length&&e[0].isSubject;this._isInResult=n(e)!==n(t);break}}return this._isInResult}},je=class{constructor(e,t,n){if((0,D.A)(this,"poly",void 0),(0,D.A)(this,"isExterior",void 0),(0,D.A)(this,"segments",void 0),(0,D.A)(this,"bbox",void 0),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],"number"!==typeof e[0][0]||"number"!==typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=xe.snap({x:new ie(e[0][0]),y:new ie(e[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let a=1,s=e.length;a<s;a++){if("number"!==typeof e[a][0]||"number"!==typeof e[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const t=xe.snap({x:new ie(e[a][0]),y:new ie(e[a][1])});t.x.eq(i.x)&&t.y.eq(i.y)||(this.segments.push(Oe.fromRing(i,t,this)),t.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=t.x),t.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=t.y),t.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=t.x),t.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=t.y),i=t)}r.x.eq(i.x)&&r.y.eq(i.y)||this.segments.push(Oe.fromRing(i,r,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}},ze=class{constructor(e,t){if((0,D.A)(this,"multiPoly",void 0),(0,D.A)(this,"exteriorRing",void 0),(0,D.A)(this,"interiorRings",void 0),(0,D.A)(this,"bbox",void 0),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new je(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,r=e.length;n<r;n++){const t=new je(e[n],this,!1);t.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=t.bbox.ll.x),t.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=t.bbox.ll.y),t.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=t.bbox.ur.x),t.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=t.bbox.ur.y),this.interiorRings.push(t)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const n=this.interiorRings[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}},He=class{constructor(e,t){if((0,D.A)(this,"isSubject",void 0),(0,D.A)(this,"polys",void 0),(0,D.A)(this,"bbox",void 0),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"===typeof e[0][0][0]&&(e=[e])}catch(n){}this.polys=[],this.bbox={ll:{x:new ie(Number.POSITIVE_INFINITY),y:new ie(Number.POSITIVE_INFINITY)},ur:{x:new ie(Number.NEGATIVE_INFINITY),y:new ie(Number.NEGATIVE_INFINITY)}};for(let r=0,i=e.length;r<i;r++){const t=new ze(e[r],this);t.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=t.bbox.ll.x),t.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=t.bbox.ll.y),t.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=t.bbox.ur.x),t.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=t.bbox.ur.y),this.polys.push(t)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}};xe.set;function Qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];if(m(e,e=>{n.push(e.coordinates)}),n.length<2)throw new Error("Must specify at least 2 geometries");const r=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Ue.run("intersection",e,n)}(n[0],...n.slice(1));return 0===r.length?null:1===r.length?o(r[0],t.properties):c(r,t.properties)}function Ve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return f(e,e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])}),n}function Ge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Ve(e);return s([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}var We=n(7207);function qe(){return new Ke}function Ke(){this.reset()}Ke.prototype={constructor:Ke,reset:function(){this.s=this.t=0},add:function(e){Ye(Xe,e,this.t),Ye(this,Xe.s,this.s),this.s?this.t+=Xe.t:this.s=Xe.t},valueOf:function(){return this.s}};var Xe=new Ke;function Ye(e,t,n){var r=e.s=t+n,i=r-t,a=r-i;e.t=t-a+(n-i)}var Je=1e-6,Ze=Math.PI,$e=Ze/2,et=Ze/4,tt=2*Ze,nt=180/Ze,rt=Ze/180,it=Math.abs,at=Math.atan,st=Math.atan2,ot=Math.cos,lt=(Math.ceil,Math.exp),ct=(Math.floor,Math.log),ut=(Math.pow,Math.sin),ht=(Math.sign,Math.sqrt),dt=Math.tan;function At(e){return e>1?0:e<-1?Ze:Math.acos(e)}function pt(e){return e>1?$e:e<-1?-$e:Math.asin(e)}function ft(){}function gt(e,t){e&&yt.hasOwnProperty(e.type)&&yt[e.type](e,t)}var mt={Feature:function(e,t){gt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)gt(n[r].geometry,t)}},yt={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){vt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)vt(n[r],t,0)},Polygon:function(e,t){bt(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)bt(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)gt(n[r],t)}};function vt(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function bt(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)vt(e[n],t,1);t.polygonEnd()}function xt(e,t){e&&mt.hasOwnProperty(e.type)?mt[e.type](e,t):gt(e,t)}qe(),qe();function wt(e){return[st(e[1],e[0]),pt(e[2])]}function _t(e){var t=e[0],n=e[1],r=ot(n);return[r*ot(t),r*ut(t),ut(n)]}function St(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Et(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Nt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function kt(e){var t=ht(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}qe();function It(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Tt(e,t){return[e>Ze?e-tt:e<-Ze?e+tt:e,t]}function Bt(e,t,n){return(e%=tt)?t||n?It(Ft(e),Rt(t,n)):Ft(e):t||n?Rt(t,n):Tt}function Mt(e){return function(t,n){return[(t+=e)>Ze?t-tt:t<-Ze?t+tt:t,n]}}function Ft(e){var t=Mt(e);return t.invert=Mt(-e),t}function Rt(e,t){var n=ot(e),r=ut(e),i=ot(t),a=ut(t);function s(e,t){var s=ot(t),o=ot(e)*s,l=ut(e)*s,c=ut(t),u=c*n+o*r;return[st(l*i-u*a,o*n-c*r),pt(u*i+l*a)]}return s.invert=function(e,t){var s=ot(t),o=ot(e)*s,l=ut(e)*s,c=ut(t),u=c*i-l*a;return[st(l*i+c*a,o*n+u*r),pt(u*n-o*r)]},s}function Lt(e,t,n,r,i,a){if(n){var s=ot(t),o=ut(t),l=r*n;null==i?(i=t+r*tt,a=t-l/2):(i=Pt(s,i),a=Pt(s,a),(r>0?i<a:i>a)&&(i+=r*tt));for(var c,u=i;r>0?u>a:u<a;u-=l)c=wt([s,-o*ot(u),-o*ut(u)]),e.point(c[0],c[1])}}function Pt(e,t){(t=_t(t))[0]-=e,kt(t);var n=At(-t[1]);return((-t[2]<0?-n:n)+tt-Je)%tt}function Ut(){var e,t=[];return{point:function(t,n){e.push([t,n])},lineStart:function(){t.push(e=[])},lineEnd:ft,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Dt(e,t){return it(e[0]-t[0])<Je&&it(e[1]-t[1])<Je}function Ot(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function jt(e,t,n,r,i){var a,s,o=[],l=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],s=e[t];if(Dt(r,s)){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);i.lineEnd()}else o.push(n=new Ot(r,e,null,!0)),l.push(n.o=new Ot(r,null,n,!1)),o.push(n=new Ot(s,e,null,!1)),l.push(n.o=new Ot(s,null,n,!0))}}),o.length){for(l.sort(t),zt(o),zt(l),a=0,s=l.length;a<s;++a)l[a].e=n=!n;for(var c,u,h=o[0];;){for(var d=h,A=!0;d.v;)if((d=d.n)===h)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(A)for(a=0,s=c.length;a<s;++a)i.point((u=c[a])[0],u[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(A)for(c=d.p.z,a=c.length-1;a>=0;--a)i.point((u=c[a])[0],u[1]);else r(d.x,d.p.x,-1,i);d=d.p}c=(d=d.o).z,A=!A}while(!d.v);i.lineEnd()}}}function zt(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Ht(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Tt.invert=Tt;var Qt=function(e){var t;return 1===e.length&&(t=e,e=function(e,n){return Ht(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)<0?r=a+1:i=a}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)>0?i=a:r=a+1}return r}}}(Ht);Qt.right,Qt.left;var Vt=Array.prototype;Vt.slice,Vt.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);function Gt(e){for(var t,n,r,i=e.length,a=-1,s=0;++a<i;)s+=e[a].length;for(n=new Array(s);--i>=0;)for(t=(r=e[i]).length;--t>=0;)n[--s]=r[t];return n}var Wt=1e9,qt=-Wt;function Kt(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,o,c){var u=0,h=0;if(null==i||(u=s(i,o))!==(h=s(a,o))||l(i,a)<0^o>0)do{c.point(0===u||3===u?e:n,u>1?r:t)}while((u=(u+o+4)%4)!==h);else c.point(a[0],a[1])}function s(r,i){return it(r[0]-e)<Je?i>0?0:3:it(r[0]-n)<Je?i>0?2:1:it(r[1]-t)<Je?i>0?1:0:i>0?3:2}function o(e,t){return l(e.x,t.x)}function l(e,t){var n=s(e,1),r=s(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){var l,c,u,h,d,A,p,f,g,m,y,v=s,b=Ut(),x={point:w,lineStart:function(){x.point=_,c&&c.push(u=[]);m=!0,g=!1,p=f=NaN},lineEnd:function(){l&&(_(h,d),A&&g&&b.rejoin(),l.push(b.result()));x.point=w,g&&v.lineEnd()},polygonStart:function(){v=b,l=[],c=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=c.length;n<i;++n)for(var a,s,o=c[n],l=1,u=o.length,h=o[0],d=h[0],A=h[1];l<u;++l)a=d,s=A,d=(h=o[l])[0],A=h[1],s<=r?A>r&&(d-a)*(r-s)>(A-s)*(e-a)&&++t:A<=r&&(d-a)*(r-s)<(A-s)*(e-a)&&--t;return t}(),n=y&&t,i=(l=Gt(l)).length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),a(null,null,1,s),s.lineEnd()),i&&jt(l,o,t,a,s),s.polygonEnd());v=s,l=c=u=null}};function w(e,t){i(e,t)&&v.point(e,t)}function _(a,s){var o=i(a,s);if(c&&u.push([a,s]),m)h=a,d=s,A=o,m=!1,o&&(v.lineStart(),v.point(a,s));else if(o&&g)v.point(a,s);else{var l=[p=Math.max(qt,Math.min(Wt,p)),f=Math.max(qt,Math.min(Wt,f))],b=[a=Math.max(qt,Math.min(Wt,a)),s=Math.max(qt,Math.min(Wt,s))];!function(e,t,n,r,i,a){var s,o=e[0],l=e[1],c=0,u=1,h=t[0]-o,d=t[1]-l;if(s=n-o,h||!(s>0)){if(s/=h,h<0){if(s<c)return;s<u&&(u=s)}else if(h>0){if(s>u)return;s>c&&(c=s)}if(s=i-o,h||!(s<0)){if(s/=h,h<0){if(s>u)return;s>c&&(c=s)}else if(h>0){if(s<c)return;s<u&&(u=s)}if(s=r-l,d||!(s>0)){if(s/=d,d<0){if(s<c)return;s<u&&(u=s)}else if(d>0){if(s>u)return;s>c&&(c=s)}if(s=a-l,d||!(s<0)){if(s/=d,d<0){if(s>u)return;s>c&&(c=s)}else if(d>0){if(s<c)return;s<u&&(u=s)}return c>0&&(e[0]=o+c*h,e[1]=l+c*d),u<1&&(t[0]=o+u*h,t[1]=l+u*d),!0}}}}}(l,b,e,t,n,r)?o&&(v.lineStart(),v.point(a,s),y=!1):(g||(v.lineStart(),v.point(l[0],l[1])),v.point(b[0],b[1]),o||v.lineEnd(),y=!1)}p=a,f=s,g=o}return x}}var Xt=qe();function Yt(e,t){var n=t[0],r=t[1],i=[ut(n),-ot(n),0],a=0,s=0;Xt.reset();for(var o=0,l=e.length;o<l;++o)if(u=(c=e[o]).length)for(var c,u,h=c[u-1],d=h[0],A=h[1]/2+et,p=ut(A),f=ot(A),g=0;g<u;++g,d=y,p=b,f=x,h=m){var m=c[g],y=m[0],v=m[1]/2+et,b=ut(v),x=ot(v),w=y-d,_=w>=0?1:-1,S=_*w,C=S>Ze,E=p*b;if(Xt.add(st(E*_*ut(S),f*x+E*ot(S))),a+=C?w+_*tt:w,C^d>=n^y>=n){var N=Ct(_t(h),_t(m));kt(N);var k=Ct(i,N);kt(k);var I=(C^w>=0?-1:1)*pt(k[2]);(r>I||r===I&&(N[0]||N[1]))&&(s+=C^w>=0?1:-1)}}return(a<-1e-6||a<Je&&Xt<-1e-6)^1&s}qe();qe(),qe();var Jt=1/0,Zt=Jt,$t=-Jt,en=$t,tn={point:function(e,t){e<Jt&&(Jt=e);e>$t&&($t=e);t<Zt&&(Zt=t);t>en&&(en=t)},lineStart:ft,lineEnd:ft,polygonStart:ft,polygonEnd:ft,result:function(){var e=[[Jt,Zt],[$t,en]];return $t=en=-(Zt=Jt=1/0),e}};const nn=tn;qe();function rn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function an(e,t,n,r){return function(i,a){var s,o,l,c=t(a),u=i.invert(r[0],r[1]),h=Ut(),d=t(h),A=!1,p={point:f,lineStart:m,lineEnd:y,polygonStart:function(){p.point=v,p.lineStart=b,p.lineEnd=x,o=[],s=[]},polygonEnd:function(){p.point=f,p.lineStart=m,p.lineEnd=y,o=Gt(o);var e=Yt(s,u);o.length?(A||(a.polygonStart(),A=!0),jt(o,on,e,n,a)):e&&(A||(a.polygonStart(),A=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),A&&(a.polygonEnd(),A=!1),o=s=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function f(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&a.point(t,n)}function g(e,t){var n=i(e,t);c.point(n[0],n[1])}function m(){p.point=g,c.lineStart()}function y(){p.point=f,c.lineEnd()}function v(e,t){l.push([e,t]);var n=i(e,t);d.point(n[0],n[1])}function b(){d.lineStart(),l=[]}function x(){v(l[0][0],l[0][1]),d.lineEnd();var e,t,n,r,i=d.clean(),c=h.result(),u=c.length;if(l.pop(),s.push(l),l=null,u)if(1&i){if((t=(n=c[0]).length-1)>0){for(A||(a.polygonStart(),A=!0),a.lineStart(),e=0;e<t;++e)a.point((r=n[e])[0],r[1]);a.lineEnd()}}else u>1&&2&i&&c.push(c.pop().concat(c.shift())),o.push(c.filter(sn))}return p}}function sn(e){return e.length>1}function on(e,t){return((e=e.x)[0]<0?e[1]-$e-Je:$e-e[1])-((t=t.x)[0]<0?t[1]-$e-Je:$e-t[1])}rn(4.5);const ln=an(function(){return!0},function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,s){var o=a>0?Ze:-Ze,l=it(a-n);it(l-Ze)<Je?(e.point(n,r=(r+s)/2>0?$e:-$e),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(o,r),e.point(a,r),t=0):i!==o&&l>=Ze&&(it(n-i)<Je&&(n-=i*Je),it(a-o)<Je&&(a-=o*Je),r=function(e,t,n,r){var i,a,s=ut(e-n);return it(s)>Je?at((ut(t)*(a=ot(r))*ut(n)-ut(r)*(i=ot(t))*ut(e))/(i*a*s)):(t+r)/2}(n,r,a,s),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(o,r),t=0),e.point(n=a,r=s),i=o},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}},function(e,t,n,r){var i;if(null==e)i=n*$e,r.point(-Ze,i),r.point(0,i),r.point(Ze,i),r.point(Ze,0),r.point(Ze,-i),r.point(0,-i),r.point(-Ze,-i),r.point(-Ze,0),r.point(-Ze,i);else if(it(e[0]-t[0])>Je){var a=e[0]<t[0]?Ze:-Ze;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])},[-Ze,-$e]);function cn(e){return e}function un(e){return function(t){var n=new hn;for(var r in e)n[r]=e[r];return n.stream=t,n}}function hn(){}function dn(e,t,n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=a&&e.clipExtent(null),xt(n,e.stream(nn));var s=nn.result(),o=Math.min(r/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),l=+t[0][0]+(r-o*(s[1][0]+s[0][0]))/2,c=+t[0][1]+(i-o*(s[1][1]+s[0][1]))/2;return null!=a&&e.clipExtent(a),e.scale(150*o).translate([l,c])}hn.prototype={constructor:hn,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var An=ot(30*rt);function pn(e,t){return+t?function(e,t){function n(r,i,a,s,o,l,c,u,h,d,A,p,f,g){var m=c-r,y=u-i,v=m*m+y*y;if(v>4*t&&f--){var b=s+d,x=o+A,w=l+p,_=ht(b*b+x*x+w*w),S=pt(w/=_),C=it(it(w)-1)<Je||it(a-h)<Je?(a+h)/2:st(x,b),E=e(C,S),N=E[0],k=E[1],I=N-r,T=k-i,B=y*I-m*T;(B*B/v>t||it((m*I+y*T)/v-.5)>.3||s*d+o*A+l*p<An)&&(n(r,i,a,s,o,l,N,k,C,b/=_,x/=_,w,f,g),g.point(N,k),n(N,k,C,b,x,w,c,u,h,d,A,p,f,g))}}return function(t){var r,i,a,s,o,l,c,u,h,d,A,p,f={point:g,lineStart:m,lineEnd:v,polygonStart:function(){t.polygonStart(),f.lineStart=b},polygonEnd:function(){t.polygonEnd(),f.lineStart=m}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function m(){u=NaN,f.point=y,t.lineStart()}function y(r,i){var a=_t([r,i]),s=e(r,i);n(u,h,c,d,A,p,u=s[0],h=s[1],c=r,d=a[0],A=a[1],p=a[2],16,t),t.point(u,h)}function v(){f.point=g,t.lineEnd()}function b(){m(),f.point=x,f.lineEnd=w}function x(e,t){y(r=e,t),i=u,a=h,s=d,o=A,l=p,f.point=y}function w(){n(u,h,c,d,A,p,i,a,r,s,o,l,16,t),f.lineEnd=v,v()}return f}}(e,t):function(e){return un({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var fn=un({point:function(e,t){this.stream.point(e*rt,t*rt)}});function gn(e){return function(e){var t,n,r,i,a,s,o,l,c,u,h=150,d=480,A=250,p=0,f=0,g=0,m=0,y=0,v=null,b=ln,x=null,w=cn,_=.5,S=pn(N,_);function C(e){return[(e=a(e[0]*rt,e[1]*rt))[0]*h+n,r-e[1]*h]}function E(e){return(e=a.invert((e[0]-n)/h,(r-e[1])/h))&&[e[0]*nt,e[1]*nt]}function N(e,i){return[(e=t(e,i))[0]*h+n,r-e[1]*h]}function k(){a=It(i=Bt(g,m,y),t);var e=t(p,f);return n=d-e[0]*h,r=A+e[1]*h,I()}function I(){return c=u=null,C}return C.stream=function(e){return c&&u===e?c:c=fn(b(i,S(w(u=e))))},C.clipAngle=function(e){return arguments.length?(b=+e?function(e,t){var n=ot(e),r=n>0,i=it(n)>Je;function a(e,t){return ot(e)*ot(t)>n}function s(e,t,r){var i=[1,0,0],a=Ct(_t(e),_t(t)),s=St(a,a),o=a[0],l=s-o*o;if(!l)return!r&&e;var c=n*s/l,u=-n*o/l,h=Ct(i,a),d=Nt(i,c);Et(d,Nt(a,u));var A=h,p=St(d,A),f=St(A,A),g=p*p-f*(St(d,d)-1);if(!(g<0)){var m=ht(g),y=Nt(A,(-p-m)/f);if(Et(y,d),y=wt(y),!r)return y;var v,b=e[0],x=t[0],w=e[1],_=t[1];x<b&&(v=b,b=x,x=v);var S=x-b,C=it(S-Ze)<Je;if(!C&&_<w&&(v=w,w=_,_=v),C||S<Je?C?w+_>0^y[1]<(it(y[0]-b)<Je?w:_):w<=y[1]&&y[1]<=_:S>Ze^(b<=y[0]&&y[0]<=x)){var E=Nt(A,(-p+m)/f);return Et(E,d),[y,wt(E)]}}}function o(t,n){var i=r?e:Ze-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return an(a,function(e){var t,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,d){var A,p=[h,d],f=a(h,d),g=r?f?0:o(h,d):f?o(h+(h<0?Ze:-Ze),d):0;if(!t&&(c=l=f)&&e.lineStart(),f!==l&&(!(A=s(t,p))||Dt(t,A)||Dt(p,A))&&(p[0]+=Je,p[1]+=Je,f=a(p[0],p[1])),f!==l)u=0,f?(e.lineStart(),A=s(p,t),e.point(A[0],A[1])):(A=s(t,p),e.point(A[0],A[1]),e.lineEnd()),t=A;else if(i&&t&&r^f){var m;g&n||!(m=s(p,t,!0))||(u=0,r?(e.lineStart(),e.point(m[0][0],m[0][1]),e.point(m[1][0],m[1][1]),e.lineEnd()):(e.point(m[1][0],m[1][1]),e.lineEnd(),e.lineStart(),e.point(m[0][0],m[0][1])))}!f||t&&Dt(t,p)||e.point(p[0],p[1]),t=p,l=f,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return u|(c&&l)<<1}}},function(n,r,i,a){Lt(a,e,t,i,n,r)},r?[0,-e]:[-Ze,e-Ze])}(v=e*rt,6*rt):(v=null,ln),I()):v*nt},C.clipExtent=function(e){return arguments.length?(w=null==e?(x=s=o=l=null,cn):Kt(x=+e[0][0],s=+e[0][1],o=+e[1][0],l=+e[1][1]),I()):null==x?null:[[x,s],[o,l]]},C.scale=function(e){return arguments.length?(h=+e,k()):h},C.translate=function(e){return arguments.length?(d=+e[0],A=+e[1],k()):[d,A]},C.center=function(e){return arguments.length?(p=e[0]%360*rt,f=e[1]%360*rt,k()):[p*nt,f*nt]},C.rotate=function(e){return arguments.length?(g=e[0]%360*rt,m=e[1]%360*rt,y=e.length>2?e[2]%360*rt:0,k()):[g*nt,m*nt,y*nt]},C.precision=function(e){return arguments.length?(S=pn(N,_=e*e),I()):ht(_)},C.fitExtent=function(e,t){return dn(C,e,t)},C.fitSize=function(e,t){return function(e,t,n){return dn(e,[[0,0],t],n)}(C,e,t)},function(){return t=e.apply(this,arguments),C.invert=t.invert&&E,k()}}(function(){return e})()}function mn(e){return function(t,n){var r=ot(t),i=ot(n),a=e(r*i);return[a*i*ut(t),a*ut(n)]}}function yn(e){return function(t,n){var r=ht(t*t+n*n),i=e(r),a=ut(i),s=ot(i);return[st(t*a,r*s),pt(r&&n*a/r)]}}var vn=mn(function(e){return ht(2/(1+e))});vn.invert=yn(function(e){return 2*pt(e/2)});var bn=mn(function(e){return(e=At(e))&&e/ut(e)});function xn(e,t){return[e,ct(dt(($e+t)/2))]}function wn(e,t){return[e,t]}function _n(e,t){var n=ot(t),r=ot(e)*n;return[n*ut(e)/r,ut(t)/r]}function Sn(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function Cn(e,t){return[ot(t)*ut(e),ut(t)]}function En(e,t){var n=ot(t),r=1+ot(e)*n;return[n*ut(e)/r,ut(t)/r]}function Nn(e,t){return[ct(dt(($e+t)/2)),-e]}bn.invert=yn(function(e){return e}),xn.invert=function(e,t){return[e,2*at(lt(t))-$e]},wn.invert=wn,_n.invert=yn(at),Sn.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,s=a*a;r-=n=(r*(1.007226+a*(.015085+s*(.028874*a-.044475-.005916*s)))-t)/(1.007226+a*(.045255+s*(.259866*a-.311325-.005916*11*s)))}while(it(n)>Je&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},Cn.invert=yn(pt),En.invert=yn(function(e){return 2*at(e)}),Nn.invert=function(e,t){return[-t,2*at(lt(e))-$e]};var{BufferOp:kn,GeoJSONReader:In,GeoJSONWriter:Tn}=We;function Bn(e,t,n){var r=(n=n||{}).units||"kilometers",i=n.steps||8;if(!e)throw new Error("geojson is required");if("object"!==typeof n)throw new Error("options must be an object");if("number"!==typeof i)throw new Error("steps must be an number");if(void 0===t)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var a=[];switch(e.type){case"GeometryCollection":return m(e,function(e){var n=Mn(e,t,r,i);n&&a.push(n)}),l(a);case"FeatureCollection":return g(e,function(e){var n=Mn(e,t,r,i);n&&g(n,function(e){e&&a.push(e)})}),l(a)}return Mn(e,t,r,i)}function Mn(e,t,n,i){var s=e.properties||{},o="Feature"===e.type?e.geometry:e;if("GeometryCollection"===o.type){var c=[];return m(e,function(e){var r=Mn(e,t,n,i);r&&c.push(r)}),l(c)}var d=function(e){var t=Ge(e).geometry.coordinates,n=[-t[0],-t[1]];return gn(bn).scale(79.4188).clipAngle(179.999).rotate(n).scale(r)}(o),A={type:o.type,coordinates:Rn(o.coordinates,d)},p=(new In).read(A),f=u(h(t,n),"meters"),g=kn.bufferOp(p,f,i);if(!Fn((g=(new Tn).write(g)).coordinates))return a({type:g.type,coordinates:Ln(g.coordinates,d)},s)}function Fn(e){return Array.isArray(e[0])?Fn(e[0]):isNaN(e[0])}function Rn(e,t){return"object"!==typeof e[0]?t(e):e.map(function(e){return Rn(e,t)})}function Ln(e,t){return"object"!==typeof e[0]?t.invert(e):e.map(function(e){return Ln(e,t)})}function Pn(e,t){if(!0===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).final)return function(e,t){let n=Pn(t,e);return n=(n+180)%360,n}(e,t);const n=F(e),r=F(t),i=A(n[0]),a=A(r[0]),s=A(n[1]),o=A(r[1]),l=Math.sin(a-i)*Math.cos(o),c=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(a-i);return d(Math.atan2(l,c))}function Un(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n="object"===typeof t?t.mutate:t;if(!e)throw new Error("geojson is required");var r=function(e){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}(e),i=[];switch(r){case"LineString":i=Dn(e,r);break;case"MultiLineString":case"Polygon":R(e).forEach(function(e){i.push(Dn(e,r))});break;case"MultiPolygon":R(e).forEach(function(e){var t=[];e.forEach(function(e){t.push(Dn(e,r))}),i.push(t)});break;case"Point":return e;case"MultiPoint":var s={};R(e).forEach(function(e){var t=e.join("-");Object.prototype.hasOwnProperty.call(s,t)||(i.push(e),s[t]=!0)});break;default:throw new Error(r+" geometry not supported")}return e.coordinates?!0===n?(e.coordinates=i,e):{type:r,coordinates:i}:!0===n?(e.geometry.coordinates=i,e):a({type:r,coordinates:i},e.properties,{bbox:e.bbox,id:e.id})}function Dn(e,t){var n=R(e);if(2===n.length&&!On(n[0],n[1]))return n;var r=[],i=n.length-1,a=r.length;r.push(n[0]);for(var s=1;s<i;s++){var o=r[r.length-1];n[s][0]===o[0]&&n[s][1]===o[1]||(r.push(n[s]),(a=r.length)>2&&jn(r[a-3],r[a-1],r[a-2])&&r.splice(r.length-2,1))}if(r.push(n[n.length-1]),a=r.length,("Polygon"===t||"MultiPolygon"===t)&&On(n[0],n[n.length-1])&&a<4)throw new Error("invalid polygon");return"LineString"===t&&a<3||jn(r[a-3],r[a-1],r[a-2])&&r.splice(r.length-2,1),r}function On(e,t){return e[0]===t[0]&&e[1]===t[1]}function jn(e,t,n){var r=n[0],i=n[1],a=e[0],s=e[1],o=t[0],l=t[1],c=o-a,u=l-s;return 0===(r-a)*u-(i-s)*c&&(Math.abs(c)>=Math.abs(u)?c>0?a<=r&&r<=o:o<=r&&r<=a:u>0?s<=i&&i<=l:l<=i&&i<=s)}function zn(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return Hn(e);case"FeatureCollection":return function(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"features":return;default:t[n]=e[n]}}),t.features=e.features.map(e=>Hn(e)),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Vn(e);default:throw new Error("unknown GeoJSON type")}}function Hn(e){const t={type:"Feature"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}}),t.properties=Qn(e.properties),null==e.geometry?t.geometry=null:t.geometry=Vn(e.geometry),t}function Qn(e){const t={};return e?(Object.keys(e).forEach(n=>{const r=e[n];"object"===typeof r?null===r?t[n]=null:Array.isArray(r)?t[n]=r.map(e=>e):t[n]=Qn(r):t[n]=r}),t):t}function Vn(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map(e=>Vn(e)),t):(t.coordinates=Gn(e.coordinates),t)}function Gn(e){const t=e;return"object"!==typeof t[0]?t.slice():t.map(e=>Gn(e))}function Wn(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function qn(e,t,n){var r=t[0],i=t[1],a=n[0]-r,s=n[1]-i;if(0!==a||0!==s){var o=((e[0]-r)*a+(e[1]-i)*s)/(a*a+s*s);o>1?(r=n[0],i=n[1]):o>0&&(r+=a*o,i+=s*o)}return(a=e[0]-r)*a+(s=e[1]-i)*s}function Kn(e,t,n,r,i){for(var a,s=r,o=t+1;o<n;o++){var l=qn(e[o],e[t],e[n]);l>s&&(a=o,s=l)}s>r&&(a-t>1&&Kn(e,t,a,r,i),i.push(e[a]),n-a>1&&Kn(e,a,n,r,i))}function Xn(e,t){var n=e.length-1,r=[e[0]];return Kn(e,0,n,t,r),r.push(e[n]),r}function Yn(e,t,n){if(e.length<=2)return e;var r=void 0!==t?t*t:1;return e=n?e:function(e,t){for(var n,r=e[0],i=[r],a=1,s=e.length;a<s;a++)Wn(n=e[a],r)>t&&(i.push(n),r=n);return r!==n&&i.push(n),i}(e,r),e=Xn(e,r)}function Jn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r,i,a;if(t=null!=t?t:{},null===(a=t)||"object"!==typeof a||Array.isArray(a))throw new Error("options is invalid");const s=null!=(n=t.tolerance)?n:1,o=null!=(r=t.highQuality)&&r,l=null!=(i=t.mutate)&&i;if(!e)throw new Error("geojson is required");if(s&&s<0)throw new Error("invalid tolerance");return!0!==l&&(e=zn(e)),m(e,function(e){!function(e,t,n){const r=e.type;if("Point"===r||"MultiPoint"===r)return e;if(Un(e,{mutate:!0}),"GeometryCollection"!==r)switch(r){case"LineString":e.coordinates=Yn(e.coordinates,t,n);break;case"MultiLineString":e.coordinates=e.coordinates.map(e=>Yn(e,t,n));break;case"Polygon":e.coordinates=Zn(e.coordinates,t,n);break;case"MultiPolygon":e.coordinates=e.coordinates.map(e=>Zn(e,t,n))}}(e,s,o)}),e}function Zn(e,t,n){return e.map(function(e){if(e.length<4)throw new Error("invalid polygon");let r=t,i=Yn(e,r,n);for(;!$n(i);)r-=.01*r,i=Yn(e,r,n);return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i})}function $n(e){return!(e.length<3)&&!(3===e.length&&e[2][0]===e[0][0]&&e[2][1]===e[0][1])}const er=e=>{try{const t=y(o([e]));return(3.86102e-7*t).toFixed(2)}catch(t){return console.error("Error calculating territory area:",t),0}},tr=(e,t)=>{try{const n=s([e.lng,e.lat]);return L(n,o([t]))}catch(n){return console.error("Error checking point in territory:",n),!1}},nr=(e,t)=>{try{const n=s([e.lng,e.lat]),r=s([t.lng,t.lat]);return P(n,r,{units:"miles"}).toFixed(2)}catch(n){return console.error("Error calculating distance:",n),0}},rr=e=>{try{const t=U(o([e]));return{lat:t.geometry.coordinates[1],lng:t.geometry.coordinates[0]}}catch(t){return console.error("Error getting territory center:",t),null}},ir=(e,t)=>{try{const n=o([e]),r=o([t]);return null!==Qe(l([n,r]))}catch(n){return console.error("Error checking territory overlap:",n),!1}},ar=e=>{try{const t=e.map(e=>s([e.lng||e[0],e.lat||e[1]])),n=Ve(l(t));return{southwest:{lat:n[1],lng:n[0]},northeast:{lat:n[3],lng:n[2]}}}catch(t){return console.error("Error getting bounding box:",t),null}},sr=(e,t)=>{try{if(!t||0===t.length)return[];const n=[];let r=e,i=[...t];for(;i.length>0;){let e=0,t=1/0;const a=r;i.forEach((n,r)=>{const i=nr(a,n);parseFloat(i)<t&&(t=parseFloat(i),e=r)});const s=i[e];n.push(s),r=s,i.splice(e,1)}return n}catch(n){return console.error("Error optimizing route:",n),t}},or=e=>{try{if(!e||e.length<2)return 0;let t=0;for(let n=0;n<e.length-1;n++)t+=parseFloat(nr(e[n],e[n+1]));return t.toFixed(2)}catch(t){return console.error("Error calculating route distance:",t),0}},lr=(e,t)=>{try{const n=s([e.lng,e.lat]);return Bn(n,t,{units:"miles"}).geometry.coordinates[0].map(e=>({lat:e[1],lng:e[0]}))}catch(n){return console.error("Error creating buffer:",n),[]}},cr=(e,t,n)=>{try{return t.filter(t=>{const r=nr(e,{lat:t.latitude,lng:t.longitude});return parseFloat(r)<=n})}catch(r){return console.error("Error finding properties in radius:",r),[]}},ur=e=>e,hr=(e,t)=>{try{const n=s([e.lng,e.lat]);return Pn(n,s([t.lng,t.lat]))}catch(n){return console.error("Error calculating bearing:",n),0}},dr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;try{const n=[],r=new Set;return e.forEach((i,a)=>{if(r.has(a))return;const s={center:{lat:i.latitude,lng:i.longitude},properties:[i]};e.forEach((e,n)=>{if(n===a||r.has(n))return;const o=nr({lat:i.latitude,lng:i.longitude},{lat:e.latitude,lng:e.longitude});parseFloat(o)<=t&&(s.properties.push(e),r.add(n))}),r.add(a),n.push(s)}),n}catch(n){return console.error("Error clustering properties:",n),e.map(e=>({center:{lat:e.latitude,lng:e.longitude},properties:[e]}))}},Ar=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;try{const n=Ve(o([e])),r=[],i=t/69,a=t/69;for(let t=n[0];t<=n[2];t+=i)for(let i=n[1];i<=n[3];i+=a){const n={lat:i,lng:t};tr(n,e)&&r.push(n)}return r}catch(n){return console.error("Error generating grid:",n),[]}},pr=e=>{try{return o([e])}catch(t){return console.error("Error converting to GeoJSON:",t),null}},fr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;try{const n=o([e]);return Jn(n,{tolerance:t,highQuality:!0}).geometry.coordinates[0]}catch(n){return console.error("Error simplifying polygon:",n),e}}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),A=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=m.prototype;var b=v.prototype=new y;b.constructor=v,f(b,m.prototype),b.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,_={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var i,a={},s=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:o,props:a,_owner:_.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var N=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,i,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===a?"."+k(l,0):a,x(s)?(i="",null!=e&&(i=e.replace(N,"$&/")+"/"),I(s,t,i,"",function(e){return e})):null!=s&&(E(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(N,"$&/")+"/")+e)),t.push(s)),1;if(l=0,a=""===a?".":a+":",x(e))for(var c=0;c<e.length;c++){var u=a+k(o=e[c],c);l+=I(o,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=A&&e[A]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,i,u=a+k(o,c++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function T(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",function(e){return t.call(n,e,i++)}),r}function B(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M={current:null},F={transition:null},R={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:F,ReactCurrentOwner:_};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,n){T(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=i,t.Profiler=s,t.PureComponent=v,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f({},e.props),a=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=_.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!S.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:a,ref:s,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:B}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=F.transition;F.transition={};try{e()}finally{F.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return M.current.useCallback(e,t)},t.useContext=function(e){return M.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return M.current.useDeferredValue(e)},t.useEffect=function(e,t){return M.current.useEffect(e,t)},t.useId=function(){return M.current.useId()},t.useImperativeHandle=function(e,t,n){return M.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return M.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return M.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return M.current.useMemo(e,t)},t.useReducer=function(e,t,n){return M.current.useReducer(e,t,n)},t.useRef=function(e){return M.current.useRef(e)},t.useState=function(e){return M.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return M.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return M.current.useTransition()},t.version="18.3.1"},4334:(e,t,n)=>{var r=n(7359),i=n(7066),a=n(9016),s=n(9538),o=n(6288),l=n(5262),c=n(2430);c.alea=r,c.xor128=i,c.xorwow=a,c.xorshift7=s,c.xor4096=o,c.tychei=l,e.exports=c},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4530:()=>{},4980:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(2284);function i(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(0,r.A)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}function a(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5239:function(e){e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,a){function s(e){try{l(r.next(e))}catch(Ut){a(Ut)}}function o(e){try{l(r.throw(e))}catch(Ut){a(Ut)}}function l(e){e.done?n(e.value):i(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())})}function i(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(Ut){a=[6,Ut],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function a(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}for(var s=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,i){return new e(this.left+t,this.top+n,this.width+r,this.height+i)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=Array.from(n).find(function(e){return 0!==e.width});return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),o=function(e,t){return s.fromClientRect(e,t.getBoundingClientRect())},l=function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),i=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new s(0,0,r,i)},c=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var a=e.charCodeAt(n++);56320===(64512&a)?t.push(((1023&i)<<10)+(1023&a)+65536):(t.push(i),n--)}else t.push(i)}return t},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,a="";++i<n;){var s=e[i];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(i+1===n||r.length>16384)&&(a+=String.fromCharCode.apply(String,r),r.length=0)}return a},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"===typeof Uint8Array?[]:new Uint8Array(256),A=0;A<h.length;A++)d[h.charCodeAt(A)]=A;for(var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="undefined"===typeof Uint8Array?[]:new Uint8Array(256),g=0;g<p.length;g++)f[p.charCodeAt(g)]=g;for(var m=function(e){var t,n,r,i,a,s=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=f[e.charCodeAt(t)],r=f[e.charCodeAt(t+1)],i=f[e.charCodeAt(t+2)],a=f[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&a;return c},y=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},v=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},b=5,x=11,w=2,_=65536>>b,S=(1<<b)-1,C=_+(1024>>b)+32,E=65536>>x,N=(1<<x-b)-1,k=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},I=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},T=function(e,t){var n=m(e),r=Array.isArray(n)?v(n):new Uint32Array(n),i=Array.isArray(n)?y(n):new Uint16Array(n),a=24,s=k(i,a/2,r[4]/2),o=2===r[5]?k(i,(a+r[4])/2):I(r,Math.ceil((a+r[4])/4));return new B(r[0],r[1],r[2],r[3],s,o)},B=function(){function e(e,t,n,r,i,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=a}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>b])<<w)+(e&S),this.data[t];if(e<=65535)return t=((t=this.index[_+(e-55296>>b)])<<w)+(e&S),this.data[t];if(e<this.highStart)return t=C-E+(e>>x),t=this.index[t],t+=e>>b&N,t=((t=this.index[t])<<w)+(e&S),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F="undefined"===typeof Uint8Array?[]:new Uint8Array(256),R=0;R<M.length;R++)F[M.charCodeAt(R)]=R;var L=50,P=1,U=2,D=3,O=4,j=5,z=7,H=8,Q=9,V=10,G=11,W=12,q=13,K=14,X=15,Y=16,J=17,Z=18,$=19,ee=20,te=21,ne=22,re=23,ie=24,ae=25,se=26,oe=27,le=28,ce=29,ue=30,he=31,de=32,Ae=33,pe=34,fe=35,ge=36,me=37,ye=38,ve=39,be=40,xe=41,we=42,_e=43,Se=[9001,65288],Ce="!",Ee="\xd7",Ne="\xf7",ke=T("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Ie=[ue,ge],Te=[P,U,D,j],Be=[V,H],Me=[oe,se],Fe=Te.concat(Be),Re=[ye,ve,be,pe,fe],Le=[X,q],Pe=function(e,t){void 0===t&&(t="strict");var n=[],r=[],i=[];return e.forEach(function(e,a){var s=ke.get(e);if(s>L?(i.push(!0),s-=L):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(a),n.push(Y);if(s===O||s===G){if(0===a)return r.push(a),n.push(ue);var o=n[a-1];return-1===Fe.indexOf(o)?(r.push(r[a-1]),n.push(o)):(r.push(a),n.push(ue))}return r.push(a),s===he?n.push("strict"===t?te:me):s===we||s===ce?n.push(ue):s===_e?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(me):n.push(ue):void n.push(s)}),[r,n,i]},Ue=function(e,t,n,r){var i=r[n];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var a=n;a<=r.length;){if((l=r[++a])===t)return!0;if(l!==V)break}if(i===V)for(a=n;a>0;){var s=r[--a];if(Array.isArray(e)?-1!==e.indexOf(s):e===s)for(var o=n;o<=r.length;){var l;if((l=r[++o])===t)return!0;if(l!==V)break}if(s!==V)break}return!1},De=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==V)return r;n--}return 0},Oe=function(e,t,n,r,i){if(0===n[r])return Ee;var a=r-1;if(Array.isArray(i)&&!0===i[a])return Ee;var s=a-1,o=a+1,l=t[a],c=s>=0?t[s]:0,u=t[o];if(l===U&&u===D)return Ee;if(-1!==Te.indexOf(l))return Ce;if(-1!==Te.indexOf(u))return Ee;if(-1!==Be.indexOf(u))return Ee;if(De(a,t)===H)return Ne;if(ke.get(e[a])===G)return Ee;if((l===de||l===Ae)&&ke.get(e[o])===G)return Ee;if(l===z||u===z)return Ee;if(l===Q)return Ee;if(-1===[V,q,X].indexOf(l)&&u===Q)return Ee;if(-1!==[J,Z,$,ie,le].indexOf(u))return Ee;if(De(a,t)===ne)return Ee;if(Ue(re,ne,a,t))return Ee;if(Ue([J,Z],te,a,t))return Ee;if(Ue(W,W,a,t))return Ee;if(l===V)return Ne;if(l===re||u===re)return Ee;if(u===Y||l===Y)return Ne;if(-1!==[q,X,te].indexOf(u)||l===K)return Ee;if(c===ge&&-1!==Le.indexOf(l))return Ee;if(l===le&&u===ge)return Ee;if(u===ee)return Ee;if(-1!==Ie.indexOf(u)&&l===ae||-1!==Ie.indexOf(l)&&u===ae)return Ee;if(l===oe&&-1!==[me,de,Ae].indexOf(u)||-1!==[me,de,Ae].indexOf(l)&&u===se)return Ee;if(-1!==Ie.indexOf(l)&&-1!==Me.indexOf(u)||-1!==Me.indexOf(l)&&-1!==Ie.indexOf(u))return Ee;if(-1!==[oe,se].indexOf(l)&&(u===ae||-1!==[ne,X].indexOf(u)&&t[o+1]===ae)||-1!==[ne,X].indexOf(l)&&u===ae||l===ae&&-1!==[ae,le,ie].indexOf(u))return Ee;if(-1!==[ae,le,ie,J,Z].indexOf(u))for(var h=a;h>=0;){if((d=t[h])===ae)return Ee;if(-1===[le,ie].indexOf(d))break;h--}if(-1!==[oe,se].indexOf(u))for(h=-1!==[J,Z].indexOf(l)?s:a;h>=0;){var d;if((d=t[h])===ae)return Ee;if(-1===[le,ie].indexOf(d))break;h--}if(ye===l&&-1!==[ye,ve,pe,fe].indexOf(u)||-1!==[ve,pe].indexOf(l)&&-1!==[ve,be].indexOf(u)||-1!==[be,fe].indexOf(l)&&u===be)return Ee;if(-1!==Re.indexOf(l)&&-1!==[ee,se].indexOf(u)||-1!==Re.indexOf(u)&&l===oe)return Ee;if(-1!==Ie.indexOf(l)&&-1!==Ie.indexOf(u))return Ee;if(l===ie&&-1!==Ie.indexOf(u))return Ee;if(-1!==Ie.concat(ae).indexOf(l)&&u===ne&&-1===Se.indexOf(e[o])||-1!==Ie.concat(ae).indexOf(u)&&l===Z)return Ee;if(l===xe&&u===xe){for(var A=n[a],p=1;A>0&&t[--A]===xe;)p++;if(p%2!==0)return Ee}return l===de&&u===Ae?Ee:Ne},je=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=Pe(e,t.lineBreak),r=n[0],i=n[1],a=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map(function(e){return-1!==[ae,ue,we].indexOf(e)?me:e}));var s="keep-all"===t.wordBreak?a.map(function(t,n){return t&&e[n]>=19968&&e[n]<=40959}):void 0;return[r,i,s]},ze=function(){function e(e,t,n,r){this.codePoints=e,this.required=t===Ce,this.start=n,this.end=r}return e.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),He=function(e,t){var n=c(e),r=je(n,t),i=r[0],a=r[1],s=r[2],o=n.length,l=0,u=0;return{next:function(){if(u>=o)return{done:!0,value:null};for(var e=Ee;u<o&&(e=Oe(n,a,i,++u,s))===Ee;);if(e!==Ee||u===o){var t=new ze(n,e,l,u);return l=u,{value:t,done:!1}}return{done:!0,value:null}}}},Qe=1,Ve=2,Ge=4,We=8,qe=10,Ke=47,Xe=92,Ye=9,Je=32,Ze=34,$e=61,et=35,tt=36,nt=37,rt=39,it=40,at=41,st=95,ot=45,lt=33,ct=60,ut=62,ht=64,dt=91,At=93,pt=61,ft=123,gt=63,mt=125,yt=124,vt=126,bt=128,xt=65533,wt=42,_t=43,St=44,Ct=58,Et=59,Nt=46,kt=0,It=8,Tt=11,Bt=14,Mt=31,Ft=127,Rt=-1,Lt=48,Pt=97,Ut=101,Dt=102,Ot=117,jt=122,zt=65,Ht=69,Qt=70,Vt=85,Gt=90,Wt=function(e){return e>=Lt&&e<=57},qt=function(e){return e>=55296&&e<=57343},Kt=function(e){return Wt(e)||e>=zt&&e<=Qt||e>=Pt&&e<=Dt},Xt=function(e){return e>=Pt&&e<=jt},Yt=function(e){return e>=zt&&e<=Gt},Jt=function(e){return Xt(e)||Yt(e)},Zt=function(e){return e>=bt},$t=function(e){return e===qe||e===Ye||e===Je},en=function(e){return Jt(e)||Zt(e)||e===st},tn=function(e){return en(e)||Wt(e)||e===ot},nn=function(e){return e>=kt&&e<=It||e===Tt||e>=Bt&&e<=Mt||e===Ft},rn=function(e,t){return e===Xe&&t!==qe},an=function(e,t,n){return e===ot?en(t)||rn(t,n):!!en(e)||!(e!==Xe||!rn(e,t))},sn=function(e,t,n){return e===_t||e===ot?!!Wt(t)||t===Nt&&Wt(n):Wt(e===Nt?t:e)},on=function(e){var t=0,n=1;e[t]!==_t&&e[t]!==ot||(e[t]===ot&&(n=-1),t++);for(var r=[];Wt(e[t]);)r.push(e[t++]);var i=r.length?parseInt(u.apply(void 0,r),10):0;e[t]===Nt&&t++;for(var a=[];Wt(e[t]);)a.push(e[t++]);var s=a.length,o=s?parseInt(u.apply(void 0,a),10):0;e[t]!==Ht&&e[t]!==Ut||t++;var l=1;e[t]!==_t&&e[t]!==ot||(e[t]===ot&&(l=-1),t++);for(var c=[];Wt(e[t]);)c.push(e[t++]);var h=c.length?parseInt(u.apply(void 0,c),10):0;return n*(i+o*Math.pow(10,-s))*Math.pow(10,l*h)},ln={type:2},cn={type:3},un={type:4},hn={type:13},dn={type:8},An={type:21},pn={type:9},fn={type:10},gn={type:11},mn={type:12},yn={type:14},vn={type:23},bn={type:1},xn={type:25},wn={type:24},_n={type:26},Sn={type:27},Cn={type:28},En={type:29},Nn={type:31},kn={type:32},In=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==kn;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Ze:return this.consumeStringToken(Ze);case et:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(tn(t)||rn(n,r)){var i=an(t,n,r)?Ve:Qe;return{type:5,value:this.consumeName(),flags:i}}break;case tt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),hn;break;case rt:return this.consumeStringToken(rt);case it:return ln;case at:return cn;case wt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),yn;break;case _t:if(sn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case St:return un;case ot:var a=e,s=this.peekCodePoint(0),o=this.peekCodePoint(1);if(sn(a,s,o))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(an(a,s,o))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(s===ot&&o===ut)return this.consumeCodePoint(),this.consumeCodePoint(),wn;break;case Nt:if(sn(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Ke:if(this.peekCodePoint(0)===wt)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===wt&&(l=this.consumeCodePoint())===Ke)return this.consumeToken();if(l===Rt)return this.consumeToken()}break;case Ct:return _n;case Et:return Sn;case ct:if(this.peekCodePoint(0)===lt&&this.peekCodePoint(1)===ot&&this.peekCodePoint(2)===ot)return this.consumeCodePoint(),this.consumeCodePoint(),xn;break;case ht:var c=this.peekCodePoint(0),h=this.peekCodePoint(1),d=this.peekCodePoint(2);if(an(c,h,d))return{type:7,value:this.consumeName()};break;case dt:return Cn;case Xe:if(rn(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case At:return En;case pt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),dn;break;case ft:return gn;case mt:return mn;case Ot:case Vt:var A=this.peekCodePoint(0),p=this.peekCodePoint(1);return A!==_t||!Kt(p)&&p!==gt||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case yt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),pn;if(this.peekCodePoint(0)===yt)return this.consumeCodePoint(),An;break;case vt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),fn;break;case Rt:return kn}return $t(e)?(this.consumeWhiteSpace(),Nn):Wt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):en(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:u(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return"undefined"===typeof e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Kt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===gt&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(u.apply(void 0,e.map(function(e){return e===gt?Lt:e})),16),end:parseInt(u.apply(void 0,e.map(function(e){return e===gt?Qt:e})),16)};var r=parseInt(u.apply(void 0,e),16);if(this.peekCodePoint(0)===ot&&Kt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];Kt(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(u.apply(void 0,i),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===it?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===it?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===rt||t===Ze){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt||this.peekCodePoint(0)===at)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),vn)}for(;;){var r=this.consumeCodePoint();if(r===Rt||r===at)return{type:22,value:u.apply(void 0,e)};if($t(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Rt||this.peekCodePoint(0)===at?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,e)}):(this.consumeBadUrlRemnants(),vn);if(r===Ze||r===rt||r===it||nn(r))return this.consumeBadUrlRemnants(),vn;if(r===Xe){if(!rn(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),vn;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;$t(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===at||e===Rt)return;rn(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var r=Math.min(t,e);n+=u.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),n},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(r===Rt||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(r===qe)return this._value.splice(0,n),bn;if(r===Xe){var i=this._value[n+1];i!==Rt&&void 0!==i&&(i===qe?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):rn(r,i)&&(t+=this.consumeStringSlice(n),t+=u(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=Ge,n=this.peekCodePoint(0);for(n!==_t&&n!==ot||e.push(this.consumeCodePoint());Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(n===Nt&&Wt(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=We;Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((n===Ht||n===Ut)&&((r===_t||r===ot)&&Wt(i)||Wt(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=We;Wt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[on(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),a=this.peekCodePoint(2);return an(r,i,a)?{type:15,number:t,flags:n,unit:this.consumeName()}:r===nt?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Kt(e)){for(var t=u(e);Kt(this.peekCodePoint(0))&&t.length<6;)t+=u(this.consumeCodePoint());$t(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||qt(n)||n>1114111?xt:n}return e===Rt?xt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(tn(t))e+=u(t);else{if(!rn(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=u(this.consumeEscapedCodePoint())}}},e}(),Tn=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new In;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||On(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return"undefined"===typeof e?kn:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Bn=function(e){return 15===e.type},Mn=function(e){return 17===e.type},Fn=function(e){return 20===e.type},Rn=function(e){return 0===e.type},Ln=function(e,t){return Fn(e)&&e.value===t},Pn=function(e){return 31!==e.type},Un=function(e){return 31!==e.type&&4!==e.type},Dn=function(e){var t=[],n=[];return e.forEach(function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)}),n.length&&t.push(n),t},On=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},jn=function(e){return 17===e.type||15===e.type},zn=function(e){return 16===e.type||jn(e)},Hn=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Qn={type:17,number:0,flags:Ge},Vn={type:16,number:50,flags:Ge},Gn={type:16,number:100,flags:Ge},Wn=function(e,t,n){var r=e[0],i=e[1];return[qn(r,t),qn("undefined"!==typeof i?i:r,n)]},qn=function(e,t){if(16===e.type)return e.number/100*t;if(Bn(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},Kn="deg",Xn="grad",Yn="rad",Jn="turn",Zn={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case Kn:return Math.PI*t.number/180;case Xn:return Math.PI/200*t.number;case Yn:return t.number;case Jn:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},$n=function(e){return 15===e.type&&(e.unit===Kn||e.unit===Xn||e.unit===Yn||e.unit===Jn)},er=function(e){switch(e.filter(Fn).map(function(e){return e.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Qn,Qn];case"to top":case"bottom":return tr(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Qn,Gn];case"to right":case"left":return tr(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Gn,Gn];case"to bottom":case"top":return tr(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Gn,Qn];case"to left":case"right":return tr(270)}return 0},tr=function(e){return Math.PI*e/180},nr={name:"color",parse:function(e,t){if(18===t.type){var n=ur[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),i=t.value.substring(1,2),a=t.value.substring(2,3);return ar(parseInt(r+r,16),parseInt(i+i,16),parseInt(a+a,16),1)}if(4===t.value.length){r=t.value.substring(0,1),i=t.value.substring(1,2),a=t.value.substring(2,3);var s=t.value.substring(3,4);return ar(parseInt(r+r,16),parseInt(i+i,16),parseInt(a+a,16),parseInt(s+s,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),a=t.value.substring(4,6),ar(parseInt(r,16),parseInt(i,16),parseInt(a,16),1);if(8===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),a=t.value.substring(4,6),s=t.value.substring(6,8),ar(parseInt(r,16),parseInt(i,16),parseInt(a,16),parseInt(s,16)/255)}if(20===t.type){var o=dr[t.value.toUpperCase()];if("undefined"!==typeof o)return o}return dr.TRANSPARENT}},rr=function(e){return 0===(255&e)},ir=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+r+","+n+","+t/255+")":"rgb("+i+","+r+","+n+")"},ar=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r))>>>0},sr=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},or=function(e,t){var n=t.filter(Un);if(3===n.length){var r=n.map(sr),i=r[0],a=r[1],s=r[2];return ar(i,a,s,1)}if(4===n.length){var o=n.map(sr),l=(i=o[0],a=o[1],s=o[2],o[3]);return ar(i,a,s,l)}return 0};function lr(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var cr=function(e,t){var n=t.filter(Un),r=n[0],i=n[1],a=n[2],s=n[3],o=(17===r.type?tr(r.number):Zn.parse(e,r))/(2*Math.PI),l=zn(i)?i.number/100:0,c=zn(a)?a.number/100:0,u="undefined"!==typeof s&&zn(s)?qn(s,1):1;if(0===l)return ar(255*c,255*c,255*c,1);var h=c<=.5?c*(l+1):c+l-c*l,d=2*c-h,A=lr(d,h,o+1/3),p=lr(d,h,o),f=lr(d,h,o-1/3);return ar(255*A,255*p,255*f,u)},ur={hsl:cr,hsla:cr,rgb:or,rgba:or},hr=function(e,t){return nr.parse(e,Tn.create(t).parseComponentValue())},dr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Ar={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Fn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},pr={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fr=function(e,t){var n=nr.parse(e,t[0]),r=t[1];return r&&zn(r)?{color:n,stop:r}:{color:n,stop:null}},gr=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=Qn),null===r.stop&&(r.stop=Gn);for(var i=[],a=0,s=0;s<e.length;s++){var o=e[s].stop;if(null!==o){var l=qn(o,t);l>a?i.push(l):i.push(a),a=l}else i.push(null)}var c=null;for(s=0;s<i.length;s++){var u=i[s];if(null===u)null===c&&(c=s);else if(null!==c){for(var h=s-c,d=(u-i[c-1])/(h+1),A=1;A<=h;A++)i[c+A-1]=d*A;c=null}}return e.map(function(e,n){return{color:e.color,stop:Math.max(Math.min(1,i[n]/t),0)}})},mr=function(e,t,n){var r=t/2,i=n/2,a=qn(e[0],t)-r,s=i-qn(e[1],n);return(Math.atan2(s,a)+2*Math.PI)%(2*Math.PI)},yr=function(e,t,n){var r="number"===typeof e?e:mr(e,t,n),i=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),a=t/2,s=n/2,o=i/2,l=Math.sin(r-Math.PI/2)*o,c=Math.cos(r-Math.PI/2)*o;return[i,a-c,a+c,s-l,s+l]},vr=function(e,t){return Math.sqrt(e*e+t*t)},br=function(e,t,n,r,i){return[[0,0],[0,t],[e,0],[e,t]].reduce(function(e,t){var a=t[0],s=t[1],o=vr(n-a,r-s);return(i?o<e.optimumDistance:o>e.optimumDistance)?{optimumCorner:t,optimumDistance:o}:e},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},xr=function(e,t,n,r,i){var a=0,s=0;switch(e.size){case 0:0===e.shape?a=s=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(a=Math.min(Math.abs(t),Math.abs(t-r)),s=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(0===e.shape)a=s=Math.min(vr(t,n),vr(t,n-i),vr(t-r,n),vr(t-r,n-i));else if(1===e.shape){var o=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(t),Math.abs(t-r)),l=br(r,i,t,n,!0),c=l[0],u=l[1];s=o*(a=vr(c-t,(u-n)/o))}break;case 1:0===e.shape?a=s=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(a=Math.max(Math.abs(t),Math.abs(t-r)),s=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(0===e.shape)a=s=Math.max(vr(t,n),vr(t,n-i),vr(t-r,n),vr(t-r,n-i));else if(1===e.shape){o=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(t),Math.abs(t-r));var h=br(r,i,t,n,!1);c=h[0],u=h[1],s=o*(a=vr(c-t,(u-n)/o))}}return Array.isArray(e.size)&&(a=qn(e.size[0],r),s=2===e.size.length?qn(e.size[1],i):a),[a,s]},wr=function(e,t){var n=tr(180),r=[];return Dn(t).forEach(function(t,i){if(0===i){var a=t[0];if(20===a.type&&-1!==["top","left","right","bottom"].indexOf(a.value))return void(n=er(t));if($n(a))return void(n=(Zn.parse(e,a)+tr(270))%tr(360))}var s=fr(e,t);r.push(s)}),{angle:n,stops:r,type:1}},_r="closest-side",Sr="farthest-side",Cr="closest-corner",Er="farthest-corner",Nr="circle",kr="ellipse",Ir="cover",Tr="contain",Br=function(e,t){var n=0,r=3,i=[],a=[];return Dn(t).forEach(function(t,s){var o=!0;if(0===s?o=t.reduce(function(e,t){if(Fn(t))switch(t.value){case"center":return a.push(Vn),!1;case"top":case"left":return a.push(Qn),!1;case"right":case"bottom":return a.push(Gn),!1}else if(zn(t)||jn(t))return a.push(t),!1;return e},o):1===s&&(o=t.reduce(function(e,t){if(Fn(t))switch(t.value){case Nr:return n=0,!1;case kr:return n=1,!1;case Tr:case _r:return r=0,!1;case Sr:return r=1,!1;case Cr:return r=2,!1;case Ir:case Er:return r=3,!1}else if(jn(t)||zn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e},o)),o){var l=fr(e,t);i.push(l)}}),{size:r,shape:n,stops:i,position:a,type:2}},Mr=function(e){return 1===e.type},Fr=function(e){return 2===e.type},Rr={name:"image",parse:function(e,t){if(22===t.type){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(18===t.type){var r=Ur[t.name];if("undefined"===typeof r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function Lr(e){return!(20===e.type&&"none"===e.value)&&(18!==e.type||!!Ur[e.name])}var Pr,Ur={"linear-gradient":function(e,t){var n=tr(180),r=[];return Dn(t).forEach(function(t,i){if(0===i){var a=t[0];if(20===a.type&&"to"===a.value)return void(n=er(t));if($n(a))return void(n=Zn.parse(e,a))}var s=fr(e,t);r.push(s)}),{angle:n,stops:r,type:1}},"-moz-linear-gradient":wr,"-ms-linear-gradient":wr,"-o-linear-gradient":wr,"-webkit-linear-gradient":wr,"radial-gradient":function(e,t){var n=0,r=3,i=[],a=[];return Dn(t).forEach(function(t,s){var o=!0;if(0===s){var l=!1;o=t.reduce(function(e,t){if(l)if(Fn(t))switch(t.value){case"center":return a.push(Vn),e;case"top":case"left":return a.push(Qn),e;case"right":case"bottom":return a.push(Gn),e}else(zn(t)||jn(t))&&a.push(t);else if(Fn(t))switch(t.value){case Nr:return n=0,!1;case kr:return n=1,!1;case"at":return l=!0,!1;case _r:return r=0,!1;case Ir:case Sr:return r=1,!1;case Tr:case Cr:return r=2,!1;case Er:return r=3,!1}else if(jn(t)||zn(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e},o)}if(o){var c=fr(e,t);i.push(c)}}),{size:r,shape:n,stops:i,position:a,type:2}},"-moz-radial-gradient":Br,"-ms-radial-gradient":Br,"-o-radial-gradient":Br,"-webkit-radial-gradient":Br,"-webkit-gradient":function(e,t){var n=tr(180),r=[],i=1,a=0,s=3,o=[];return Dn(t).forEach(function(t,n){var a=t[0];if(0===n){if(Fn(a)&&"linear"===a.value)return void(i=1);if(Fn(a)&&"radial"===a.value)return void(i=2)}if(18===a.type)if("from"===a.name){var s=nr.parse(e,a.values[0]);r.push({stop:Qn,color:s})}else if("to"===a.name)s=nr.parse(e,a.values[0]),r.push({stop:Gn,color:s});else if("color-stop"===a.name){var o=a.values.filter(Un);if(2===o.length){s=nr.parse(e,o[1]);var l=o[0];Mn(l)&&r.push({stop:{type:16,number:100*l.number,flags:l.flags},color:s})}}}),1===i?{angle:(n+tr(180))%tr(360),stops:r,type:i}:{size:s,shape:a,stops:r,position:o,type:i}}},Dr={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter(function(e){return Un(e)&&Lr(e)}).map(function(t){return Rr.parse(e,t)})}},Or={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Fn(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},jr={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(zn)}).map(Hn)}},zr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(Fn).map(function(e){return e.value}).join(" ")}).map(Hr)}},Hr=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Pr||(Pr={}));var Qr,Vr={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(e){return e.filter(Gr)})}},Gr=function(e){return Fn(e)||zn(e)},Wr=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},qr=Wr("top"),Kr=Wr("right"),Xr=Wr("bottom"),Yr=Wr("left"),Jr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return Hn(t.filter(zn))}}},Zr=Jr("top-left"),$r=Jr("top-right"),ei=Jr("bottom-right"),ti=Jr("bottom-left"),ni=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},ri=ni("top"),ii=ni("right"),ai=ni("bottom"),si=ni("left"),oi=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Bn(t)?t.number:0}}},li=oi("top"),ci=oi("right"),ui=oi("bottom"),hi=oi("left"),di={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ai={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},pi={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).reduce(function(e,t){return e|fi(t.value)},0)}},fi=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},gi={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},mi={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Qr||(Qr={}));var yi,vi={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Qr.STRICT:Qr.NORMAL}},bi={name:"line-height",initialValue:"normal",prefix:!1,type:4},xi=function(e,t){return Fn(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:zn(e)?qn(e,t):t},wi={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Rr.parse(e,t)}},_i={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},Si={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Ci=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Ei=Ci("top"),Ni=Ci("right"),ki=Ci("bottom"),Ii=Ci("left"),Ti={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},Bi={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Mi=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Fi=Mi("top"),Ri=Mi("right"),Li=Mi("bottom"),Pi=Mi("left"),Ui={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Di={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Oi={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Dn(t).map(function(t){for(var n={color:dr.TRANSPARENT,offsetX:Qn,offsetY:Qn,blur:Qn},r=0,i=0;i<t.length;i++){var a=t[i];jn(a)?(0===r?n.offsetX=a:1===r?n.offsetY=a:n.blur=a,r++):n.color=nr.parse(e,a)}return n})}},ji={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},zi={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=Hi[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},Hi={matrix:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number});return 6===t.length?t:null},matrix3d:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number}),n=t[0],r=t[1];t[2],t[3];var i=t[4],a=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var s=t[12],o=t[13];return t[14],t[15],16===t.length?[n,r,i,a,s,o]:null}},Qi={type:16,number:50,flags:Ge},Vi=[Qi,Qi],Gi={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(zn);return 2!==n.length?Vi:[n[0],n[1]]}},Wi={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(yi||(yi={}));for(var qi={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return yi.BREAK_ALL;case"keep-all":return yi.KEEP_ALL;default:return yi.NORMAL}}},Ki={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Mn(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Xi={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Yi={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Mn(t)?t.number:1}},Ji={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Zi={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Fn).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return 0!==e})}},$i={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],r=[];return t.forEach(function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:r.push(n.join(" ")),n.length=0}}),n.length&&r.push(n.join(" ")),r.map(function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"})}},ea={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ta={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Mn(t)?t.number:Fn(t)&&"bold"===t.value?700:400}},na={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Fn).map(function(e){return e.value})}},ra={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},ia=function(e,t){return 0!==(e&t)},aa={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},sa={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var r=[],i=t.filter(Pn),a=0;a<i.length;a++){var s=i[a],o=i[a+1];if(20===s.type){var l=o&&Mn(o)?o.number:1;r.push({counter:s.value,increment:l})}}return r}},oa={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(Pn),i=0;i<r.length;i++){var a=r[i],s=r[i+1];if(Fn(a)&&"none"!==a.value){var o=s&&Mn(s)?s.number:0;n.push({counter:a.value,reset:o})}}return n}},la={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Bn).map(function(t){return Xi.parse(e,t)})}},ca={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var r=[],i=t.filter(Rn);if(i.length%2!==0)return null;for(var a=0;a<i.length;a+=2){var s=i[a].value,o=i[a+1].value;r.push({open:s,close:o})}return r}},ua=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},ha={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Ln(t[0],"none")?[]:Dn(t).map(function(t){for(var n={color:255,offsetX:Qn,offsetY:Qn,blur:Qn,spread:Qn,inset:!1},r=0,i=0;i<t.length;i++){var a=t[i];Ln(a,"inset")?n.inset=!0:jn(a)?(0===r?n.offsetX=a:1===r?n.offsetY=a:2===r?n.blur=a:n.spread=a,r++):n.color=nr.parse(e,a)}return n})}},da={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[0,1,2],r=[];return t.filter(Fn).forEach(function(e){switch(e.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2)}}),n.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),r}},Aa={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},pa={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Bn(t)?t.number:0}},fa=function(){function e(e,t){var n,r;this.animationDuration=ya(e,la,t.animationDuration),this.backgroundClip=ya(e,Ar,t.backgroundClip),this.backgroundColor=ya(e,pr,t.backgroundColor),this.backgroundImage=ya(e,Dr,t.backgroundImage),this.backgroundOrigin=ya(e,Or,t.backgroundOrigin),this.backgroundPosition=ya(e,jr,t.backgroundPosition),this.backgroundRepeat=ya(e,zr,t.backgroundRepeat),this.backgroundSize=ya(e,Vr,t.backgroundSize),this.borderTopColor=ya(e,qr,t.borderTopColor),this.borderRightColor=ya(e,Kr,t.borderRightColor),this.borderBottomColor=ya(e,Xr,t.borderBottomColor),this.borderLeftColor=ya(e,Yr,t.borderLeftColor),this.borderTopLeftRadius=ya(e,Zr,t.borderTopLeftRadius),this.borderTopRightRadius=ya(e,$r,t.borderTopRightRadius),this.borderBottomRightRadius=ya(e,ei,t.borderBottomRightRadius),this.borderBottomLeftRadius=ya(e,ti,t.borderBottomLeftRadius),this.borderTopStyle=ya(e,ri,t.borderTopStyle),this.borderRightStyle=ya(e,ii,t.borderRightStyle),this.borderBottomStyle=ya(e,ai,t.borderBottomStyle),this.borderLeftStyle=ya(e,si,t.borderLeftStyle),this.borderTopWidth=ya(e,li,t.borderTopWidth),this.borderRightWidth=ya(e,ci,t.borderRightWidth),this.borderBottomWidth=ya(e,ui,t.borderBottomWidth),this.borderLeftWidth=ya(e,hi,t.borderLeftWidth),this.boxShadow=ya(e,ha,t.boxShadow),this.color=ya(e,di,t.color),this.direction=ya(e,Ai,t.direction),this.display=ya(e,pi,t.display),this.float=ya(e,gi,t.cssFloat),this.fontFamily=ya(e,$i,t.fontFamily),this.fontSize=ya(e,ea,t.fontSize),this.fontStyle=ya(e,ra,t.fontStyle),this.fontVariant=ya(e,na,t.fontVariant),this.fontWeight=ya(e,ta,t.fontWeight),this.letterSpacing=ya(e,mi,t.letterSpacing),this.lineBreak=ya(e,vi,t.lineBreak),this.lineHeight=ya(e,bi,t.lineHeight),this.listStyleImage=ya(e,wi,t.listStyleImage),this.listStylePosition=ya(e,_i,t.listStylePosition),this.listStyleType=ya(e,Si,t.listStyleType),this.marginTop=ya(e,Ei,t.marginTop),this.marginRight=ya(e,Ni,t.marginRight),this.marginBottom=ya(e,ki,t.marginBottom),this.marginLeft=ya(e,Ii,t.marginLeft),this.opacity=ya(e,Yi,t.opacity);var i=ya(e,Ti,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=ya(e,Bi,t.overflowWrap),this.paddingTop=ya(e,Fi,t.paddingTop),this.paddingRight=ya(e,Ri,t.paddingRight),this.paddingBottom=ya(e,Li,t.paddingBottom),this.paddingLeft=ya(e,Pi,t.paddingLeft),this.paintOrder=ya(e,da,t.paintOrder),this.position=ya(e,Di,t.position),this.textAlign=ya(e,Ui,t.textAlign),this.textDecorationColor=ya(e,Ji,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=ya(e,Zi,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=ya(e,Oi,t.textShadow),this.textTransform=ya(e,ji,t.textTransform),this.transform=ya(e,zi,t.transform),this.transformOrigin=ya(e,Gi,t.transformOrigin),this.visibility=ya(e,Wi,t.visibility),this.webkitTextStrokeColor=ya(e,Aa,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=ya(e,pa,t.webkitTextStrokeWidth),this.wordBreak=ya(e,qi,t.wordBreak),this.zIndex=ya(e,Ki,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return rr(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return ia(this.display,4)||ia(this.display,33554432)||ia(this.display,268435456)||ia(this.display,536870912)||ia(this.display,67108864)||ia(this.display,134217728)},e}(),ga=function(){function e(e,t){this.content=ya(e,aa,t.content),this.quotes=ya(e,ca,t.quotes)}return e}(),ma=function(){function e(e,t){this.counterIncrement=ya(e,sa,t.counterIncrement),this.counterReset=ya(e,oa,t.counterReset)}return e}(),ya=function(e,t,n){var r=new In,i=null!==n&&"undefined"!==typeof n?n.toString():t.initialValue;r.write(i);var a=new Tn(r.read());switch(t.type){case 2:var s=a.parseComponentValue();return t.parse(e,Fn(s)?s.value:t.initialValue);case 0:return t.parse(e,a.parseComponentValue());case 1:return t.parse(e,a.parseComponentValues());case 4:return a.parseComponentValue();case 3:switch(t.format){case"angle":return Zn.parse(e,a.parseComponentValue());case"color":return nr.parse(e,a.parseComponentValue());case"image":return Rr.parse(e,a.parseComponentValue());case"length":var o=a.parseComponentValue();return jn(o)?o:Qn;case"length-percentage":var l=a.parseComponentValue();return zn(l)?l:Qn;case"time":return Xi.parse(e,a.parseComponentValue())}}},va="data-html2canvas-debug",ba=function(e){switch(e.getAttribute(va)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},xa=function(e,t){var n=ba(e);return 1===n||t===n},wa=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,xa(t,3),this.styles=new fa(e,window.getComputedStyle(t,null)),co(t)&&(this.styles.animationDuration.some(function(e){return e>0})&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=o(this.context,t),xa(t,4)&&(this.flags|=16)}return e}(),_a="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Sa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ca="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Ea=0;Ea<Sa.length;Ea++)Ca[Sa.charCodeAt(Ea)]=Ea;for(var Na=function(e){var t,n,r,i,a,s=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=Ca[e.charCodeAt(t)],r=Ca[e.charCodeAt(t+1)],i=Ca[e.charCodeAt(t+2)],a=Ca[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&a;return c},ka=function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n},Ia=function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n},Ta=5,Ba=11,Ma=2,Fa=65536>>Ta,Ra=(1<<Ta)-1,La=Fa+(1024>>Ta)+32,Pa=65536>>Ba,Ua=(1<<Ba-Ta)-1,Da=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},Oa=function(e,t,n){return e.slice?e.slice(t,n):new Uint32Array(Array.prototype.slice.call(e,t,n))},ja=function(e,t){var n=Na(e),r=Array.isArray(n)?Ia(n):new Uint32Array(n),i=Array.isArray(n)?ka(n):new Uint16Array(n),a=24,s=Da(i,a/2,r[4]/2),o=2===r[5]?Da(i,(a+r[4])/2):Oa(r,Math.ceil((a+r[4])/4));return new za(r[0],r[1],r[2],r[3],s,o)},za=function(){function e(e,t,n,r,i,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=a}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>Ta])<<Ma)+(e&Ra),this.data[t];if(e<=65535)return t=((t=this.index[Fa+(e-55296>>Ta)])<<Ma)+(e&Ra),this.data[t];if(e<this.highStart)return t=La-Pa+(e>>Ba),t=this.index[t],t+=e>>Ta&Ua,t=((t=this.index[t])<<Ma)+(e&Ra),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Ha="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qa="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Va=0;Va<Ha.length;Va++)Qa[Ha.charCodeAt(Va)]=Va;var Ga,Wa=1,qa=2,Ka=3,Xa=4,Ya=5,Ja=7,Za=8,$a=9,es=10,ts=11,ns=12,rs=13,is=14,as=15,ss=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var a=e.charCodeAt(n++);56320===(64512&a)?t.push(((1023&i)<<10)+(1023&a)+65536):(t.push(i),n--)}else t.push(i)}return t},os=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,a="";++i<n;){var s=e[i];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(i+1===n||r.length>16384)&&(a+=String.fromCharCode.apply(String,r),r.length=0)}return a},ls=ja(_a),cs="\xd7",us="\xf7",hs=function(e){return ls.get(e)},ds=function(e,t,n){var r=n-2,i=t[r],a=t[n-1],s=t[n];if(a===qa&&s===Ka)return cs;if(a===qa||a===Ka||a===Xa)return us;if(s===qa||s===Ka||s===Xa)return us;if(a===Za&&-1!==[Za,$a,ts,ns].indexOf(s))return cs;if((a===ts||a===$a)&&(s===$a||s===es))return cs;if((a===ns||a===es)&&s===es)return cs;if(s===rs||s===Ya)return cs;if(s===Ja)return cs;if(a===Wa)return cs;if(a===rs&&s===is){for(;i===Ya;)i=t[--r];if(i===is)return cs}if(a===as&&s===as){for(var o=0;i===as;)o++,i=t[--r];if(o%2===0)return cs}return us},As=function(e){var t=ss(e),n=t.length,r=0,i=0,a=t.map(hs);return{next:function(){if(r>=n)return{done:!0,value:null};for(var e=cs;r<n&&(e=ds(t,a,++r))===cs;);if(e!==cs||r===n){var s=os.apply(null,t.slice(i,r));return i=r,{value:s,done:!1}}return{done:!0,value:null}}}},ps=function(e){for(var t,n=As(e),r=[];!(t=n.next()).done;)t.value&&r.push(t.value.slice());return r},fs=function(e){var t=123;if(e.createRange){var n=e.createRange();if(n.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height=t+"px",r.style.display="block",e.body.appendChild(r),n.selectNode(r);var i=n.getBoundingClientRect(),a=Math.round(i.height);if(e.body.removeChild(r),a===t)return!0}}return!1},gs=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"===typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,i=c(r.data).map(function(e){return u(e)}),a=0,s={},o=i.every(function(e,t){n.setStart(r,a),n.setEnd(r,a+e.length);var i=n.getBoundingClientRect();a+=e.length;var o=i.x>s.x||i.y>s.y;return s=i,0===t||o});return e.body.removeChild(t),o},ms=function(){return"undefined"!==typeof(new Image).crossOrigin},ys=function(){return"string"===typeof(new XMLHttpRequest).responseType},vs=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(Ut){return!1}return!0},bs=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},xs=function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,a=t.toDataURL();i.src=a;var s=ws(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),_s(s).then(function(t){r.drawImage(t,0,0);var i=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var s=e.createElement("div");return s.style.backgroundImage="url("+a+")",s.style.height=n+"px",bs(i)?_s(ws(n,n,0,0,s)):Promise.reject(!1)}).then(function(e){return r.drawImage(e,0,0),bs(r.getImageData(0,0,n,n).data)}).catch(function(){return!1})},ws=function(e,t,n,r,i){var a="http://www.w3.org/2000/svg",s=document.createElementNS(a,"svg"),o=document.createElementNS(a,"foreignObject");return s.setAttributeNS(null,"width",e.toString()),s.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",n.toString()),o.setAttributeNS(null,"y",r.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(o),o.appendChild(i),s},_s=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},Ss={get SUPPORT_RANGE_BOUNDS(){var e=fs(document);return Object.defineProperty(Ss,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Ss.SUPPORT_RANGE_BOUNDS&&gs(document);return Object.defineProperty(Ss,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=vs(document);return Object.defineProperty(Ss,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"===typeof Array.from&&"function"===typeof window.fetch?xs(document):Promise.resolve(!1);return Object.defineProperty(Ss,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=ms();return Object.defineProperty(Ss,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=ys();return Object.defineProperty(Ss,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ss,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"===typeof Intl||!Intl.Segmenter);return Object.defineProperty(Ss,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Cs=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),Es=function(e,t,n,r){var i=Bs(t,n),a=[],o=0;return i.forEach(function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Ss.SUPPORT_RANGE_BOUNDS){var i=ks(r,o,t.length).getClientRects();if(i.length>1){var l=Is(t),c=0;l.forEach(function(t){a.push(new Cs(t,s.fromDOMRectList(e,ks(r,c+o,t.length).getClientRects()))),c+=t.length})}else a.push(new Cs(t,s.fromDOMRectList(e,i)))}else{var u=r.splitText(t.length);a.push(new Cs(t,Ns(e,r))),r=u}else Ss.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));o+=t.length}),a},Ns=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(r,t);var a=o(e,r);return r.firstChild&&i.replaceChild(r.firstChild,r),a}}return s.EMPTY},ks=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(e,t),i.setEnd(e,t+n),i},Is=function(e){if(Ss.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(e){return e.segment})}return ps(e)},Ts=function(e,t){if(Ss.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map(function(e){return e.segment})}return Fs(e,t)},Bs=function(e,t){return 0!==t.letterSpacing?Is(e):Ts(e,t)},Ms=[32,160,4961,65792,65793,4153,4241],Fs=function(e,t){for(var n,r=He(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),i=[],a=function(){if(n.value){var e=n.value.slice(),t=c(e),r="";t.forEach(function(e){-1===Ms.indexOf(e)?r+=u(e):(r.length&&i.push(r),i.push(u(e)),r="")}),r.length&&i.push(r)}};!(n=r.next()).done;)a();return i},Rs=function(){function e(e,t,n){this.text=Ls(t.data,n.textTransform),this.textBounds=Es(e,this.text,n,t)}return e}(),Ls=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Ps,Us);case 2:return e.toUpperCase();default:return e}},Ps=/(^|\s|:|-|\(|\))([a-z])/g,Us=function(e,t,n){return e.length>0?t+n.toUpperCase():e},Ds=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(wa),Os=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(wa),js=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=new XMLSerializer,a=o(t,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(wa),zs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wa),Hs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"===typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(wa),Qs=[{type:15,flags:0,unit:"px",number:3}],Vs=[{type:16,flags:0,number:50}],Gs=function(e){return e.width>e.height?new s(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new s(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},Ws=function(e){var t=e.type===Xs?new Array(e.value.length+1).join("\u2022"):e.value;return 0===t.length?e.placeholder||"":t},qs="checkbox",Ks="radio",Xs="password",Ys=707406591,Js=function(e){function n(t,n){var r=e.call(this,t,n)||this;switch(r.type=n.type.toLowerCase(),r.checked=n.checked,r.value=Ws(n),r.type!==qs&&r.type!==Ks||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=Gs(r.bounds)),r.type){case qs:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Qs;break;case Ks:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Vs}return r}return t(n,e),n}(wa),Zs=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.options[n.selectedIndex||0];return r.value=i&&i.text||"",r}return t(n,e),n}(wa),$s=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wa),eo=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=io(t,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?hr(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):dr.TRANSPARENT,a=n.contentWindow.document.body?hr(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):dr.TRANSPARENT;r.backgroundColor=rr(i)?rr(a)?r.styles.backgroundColor:a:i}}catch(Ut){}return r}return t(n,e),n}(wa),to=["OL","UL","MENU"],no=function(e,t,n,r){for(var i=t.firstChild,a=void 0;i;i=a)if(a=i.nextSibling,oo(i)&&i.data.trim().length>0)n.textNodes.push(new Rs(e,i,n.styles));else if(lo(i))if(Eo(i)&&i.assignedNodes)i.assignedNodes().forEach(function(t){return no(e,t,n,r)});else{var s=ro(e,i);s.styles.isVisible()&&(ao(i,s,r)?s.flags|=4:so(s.styles)&&(s.flags|=2),-1!==to.indexOf(i.tagName)&&(s.flags|=8),n.elements.push(s),i.slot,i.shadowRoot?no(e,i.shadowRoot,s,r):So(i)||go(i)||Co(i)||no(e,i,s,r))}},ro=function(e,t){return bo(t)?new Ds(e,t):yo(t)?new Os(e,t):go(t)?new js(e,t):ho(t)?new zs(e,t):Ao(t)?new Hs(e,t):po(t)?new Js(e,t):Co(t)?new Zs(e,t):So(t)?new $s(e,t):xo(t)?new eo(e,t):new wa(e,t)},io=function(e,t){var n=ro(e,t);return n.flags|=4,no(e,t,n,n),n},ao=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||mo(e)&&n.styles.isTransparent()},so=function(e){return e.isPositioned()||e.isFloating()},oo=function(e){return e.nodeType===Node.TEXT_NODE},lo=function(e){return e.nodeType===Node.ELEMENT_NODE},co=function(e){return lo(e)&&"undefined"!==typeof e.style&&!uo(e)},uo=function(e){return"object"===typeof e.className},ho=function(e){return"LI"===e.tagName},Ao=function(e){return"OL"===e.tagName},po=function(e){return"INPUT"===e.tagName},fo=function(e){return"HTML"===e.tagName},go=function(e){return"svg"===e.tagName},mo=function(e){return"BODY"===e.tagName},yo=function(e){return"CANVAS"===e.tagName},vo=function(e){return"VIDEO"===e.tagName},bo=function(e){return"IMG"===e.tagName},xo=function(e){return"IFRAME"===e.tagName},wo=function(e){return"STYLE"===e.tagName},_o=function(e){return"SCRIPT"===e.tagName},So=function(e){return"TEXTAREA"===e.tagName},Co=function(e){return"SELECT"===e.tagName},Eo=function(e){return"SLOT"===e.tagName},No=function(e){return e.tagName.indexOf("-")>0},ko=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,i=!0;null!==n&&n.forEach(function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(i=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)});var a=[];return i&&r.forEach(function(e){var n=t.counters[e.counter];a.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)}),a},e}(),Io={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},To={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054f","\u054e","\u054d","\u054c","\u054b","\u054a","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053f","\u053e","\u053d","\u053c","\u053b","\u053a","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},Bo={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05d9\u05f3","\u05d8\u05f3","\u05d7\u05f3","\u05d6\u05f3","\u05d5\u05f3","\u05d4\u05f3","\u05d3\u05f3","\u05d2\u05f3","\u05d1\u05f3","\u05d0\u05f3","\u05ea","\u05e9","\u05e8","\u05e7","\u05e6","\u05e4","\u05e2","\u05e1","\u05e0","\u05de","\u05dc","\u05db","\u05d9\u05d8","\u05d9\u05d7","\u05d9\u05d6","\u05d8\u05d6","\u05d8\u05d5","\u05d9","\u05d8","\u05d7","\u05d6","\u05d5","\u05d4","\u05d3","\u05d2","\u05d1","\u05d0"]},Mo={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10f5","\u10f0","\u10ef","\u10f4","\u10ee","\u10ed","\u10ec","\u10eb","\u10ea","\u10e9","\u10e8","\u10e7","\u10e6","\u10e5","\u10e4","\u10f3","\u10e2","\u10e1","\u10e0","\u10df","\u10de","\u10dd","\u10f2","\u10dc","\u10db","\u10da","\u10d9","\u10d8","\u10d7","\u10f1","\u10d6","\u10d5","\u10d4","\u10d3","\u10d2","\u10d1","\u10d0"]},Fo=function(e,t,n,r,i,a){return e<t||e>n?Wo(e,i,a.length>0):r.integers.reduce(function(t,n,i){for(;e>=n;)e-=n,t+=r.values[i];return t},"")+a},Ro=function(e,t,n,r){var i="";do{n||e--,i=r(e)+i,e/=t}while(e*t>=t);return i},Lo=function(e,t,n,r,i){var a=n-t+1;return(e<0?"-":"")+(Ro(Math.abs(e),a,r,function(e){return u(Math.floor(e%a)+t)})+i)},Po=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return Ro(Math.abs(e),r,!1,function(e){return t[Math.floor(e%r)]})+n},Uo=1,Do=2,Oo=4,jo=8,zo=function(e,t,n,r,i,a){if(e<-9999||e>9999)return Wo(e,4,i.length>0);var s=Math.abs(e),o=i;if(0===s)return t[0]+o;for(var l=0;s>0&&l<=4;l++){var c=s%10;0===c&&ia(a,Uo)&&""!==o?o=t[c]+o:c>1||1===c&&0===l||1===c&&1===l&&ia(a,Do)||1===c&&1===l&&ia(a,Oo)&&e>100||1===c&&l>1&&ia(a,jo)?o=t[c]+(l>0?n[l-1]:"")+o:1===c&&l>0&&(o=n[l-1]+o),s=Math.floor(s/10)}return(e<0?r:"")+o},Ho="\u5341\u767e\u5343\u842c",Qo="\u62fe\u4f70\u4edf\u842c",Vo="\u30de\u30a4\u30ca\u30b9",Go="\ub9c8\uc774\ub108\uc2a4",Wo=function(e,t,n){var r=n?". ":"",i=n?"\u3001":"",a=n?", ":"",s=n?" ":"";switch(t){case 0:return"\u2022"+s;case 1:return"\u25e6"+s;case 2:return"\u25fe"+s;case 5:var o=Lo(e,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return Po(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",i);case 6:return Fo(e,1,3999,Io,3,r).toLowerCase();case 7:return Fo(e,1,3999,Io,3,r);case 8:return Lo(e,945,969,!1,r);case 9:return Lo(e,97,122,!1,r);case 10:return Lo(e,65,90,!1,r);case 11:return Lo(e,1632,1641,!0,r);case 12:case 49:return Fo(e,1,9999,To,3,r);case 35:return Fo(e,1,9999,To,3,r).toLowerCase();case 13:return Lo(e,2534,2543,!0,r);case 14:case 30:return Lo(e,6112,6121,!0,r);case 15:return Po(e,"\u5b50\u4e11\u5bc5\u536f\u8fb0\u5df3\u5348\u672a\u7533\u9149\u620c\u4ea5",i);case 16:return Po(e,"\u7532\u4e59\u4e19\u4e01\u620a\u5df1\u5e9a\u8f9b\u58ec\u7678",i);case 17:case 48:return zo(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Ho,"\u8ca0",i,Do|Oo|jo);case 47:return zo(e,"\u96f6\u58f9\u8cb3\u53c3\u8086\u4f0d\u9678\u67d2\u634c\u7396",Qo,"\u8ca0",i,Uo|Do|Oo|jo);case 42:return zo(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Ho,"\u8d1f",i,Do|Oo|jo);case 41:return zo(e,"\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396",Qo,"\u8d1f",i,Uo|Do|Oo|jo);case 26:return zo(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07",Vo,i,0);case 25:return zo(e,"\u96f6\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343\u4e07",Vo,i,Uo|Do|Oo);case 31:return zo(e,"\uc601\uc77c\uc774\uc0bc\uc0ac\uc624\uc721\uce60\ud314\uad6c","\uc2ed\ubc31\ucc9c\ub9cc",Go,a,Uo|Do|Oo);case 33:return zo(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u842c",Go,a,0);case 32:return zo(e,"\u96f6\u58f9\u8cb3\u53c3\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343",Go,a,Uo|Do|Oo);case 18:return Lo(e,2406,2415,!0,r);case 20:return Fo(e,1,19999,Mo,3,r);case 21:return Lo(e,2790,2799,!0,r);case 22:return Lo(e,2662,2671,!0,r);case 22:return Fo(e,1,10999,Bo,3,r);case 23:return Po(e,"\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093");case 24:return Po(e,"\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059");case 27:return Lo(e,3302,3311,!0,r);case 28:return Po(e,"\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3",i);case 29:return Po(e,"\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9",i);case 34:return Lo(e,3792,3801,!0,r);case 37:return Lo(e,6160,6169,!0,r);case 38:return Lo(e,4160,4169,!0,r);case 39:return Lo(e,2918,2927,!0,r);case 40:return Lo(e,1776,1785,!0,r);case 43:return Lo(e,3046,3055,!0,r);case 44:return Lo(e,3174,3183,!0,r);case 45:return Lo(e,3664,3673,!0,r);case 46:return Lo(e,3872,3881,!0,r);default:return Lo(e,48,57,!0,r)}},qo="data-html2canvas-ignore",Ko=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new ko,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var n=this,a=Yo(e,t);if(!a.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,l=a.contentWindow,c=l.document,u=$o(a).then(function(){return r(n,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return this.scrolledElements.forEach(il),l&&(l.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===t.top&&l.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-t.left,l.scrollY-t.top,0,0))),e=this.options.onclone,"undefined"===typeof(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Zo(c)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"===typeof e?[2,Promise.resolve().then(function(){return e(c,n)}).then(function(){return a})]:[2,a]}})})});return c.open(),c.write(nl(document.doctype)+"<html></html>"),rl(this.referenceElement.ownerDocument,s,o),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},e.prototype.createElementClone=function(e){if(xa(e,2),yo(e))return this.createCanvasClone(e);if(vo(e))return this.createVideoClone(e);if(wo(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return bo(t)&&(bo(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),No(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return tl(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(e,t){return t&&"string"===typeof t.cssText?e+t.cssText:e},""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(Ut){if(this.context.logger.error("Unable to access cssRules property",Ut),"SecurityError"!==Ut.name)throw Ut}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(Ut){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var i=e.getContext("2d"),a=r.getContext("2d");if(a)if(!this.options.allowTaint&&i)a.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var s=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(s){var o=s.getContextAttributes();!1===(null===o||void 0===o?void 0:o.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return r}catch(Ut){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch(Ut){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,n){lo(t)&&(_o(t)||t.hasAttribute(qo)||"function"===typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&lo(t)&&wo(t)||e.appendChild(this.cloneNode(t,n))},e.prototype.cloneChildNodes=function(e,t,n){for(var r=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(lo(i)&&Eo(i)&&"function"===typeof i.assignedNodes){var a=i.assignedNodes();a.length&&a.forEach(function(e){return r.appendChildNode(t,e,n)})}else this.appendChildNode(t,i,n)},e.prototype.cloneNode=function(e,t){if(oo(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&lo(e)&&(co(e)||uo(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var i=n.getComputedStyle(e),a=n.getComputedStyle(e,":before"),s=n.getComputedStyle(e,":after");this.referenceElement===e&&co(r)&&(this.clonedReferenceElement=r),mo(r)&&ul(r);var o=this.counters.parse(new ma(this.context,i)),l=this.resolvePseudoContent(e,r,a,Ga.BEFORE);No(e)&&(t=!0),vo(e)||this.cloneChildNodes(e,r,t),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(e,r,s,Ga.AFTER);return c&&r.appendChild(c),this.counters.pop(o),(i&&(this.options.copyStyles||uo(e))&&!xo(e)||t)&&tl(i,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(So(e)||Co(e))&&(So(r)||Co(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var i=this;if(n){var a=n.content,s=t.ownerDocument;if(s&&a&&"none"!==a&&"-moz-alt-content"!==a&&"none"!==n.display){this.counters.parse(new ma(this.context,n));var o=new ga(this.context,n),l=s.createElement("html2canvaspseudoelement");tl(n,l),o.content.forEach(function(t){if(0===t.type)l.appendChild(s.createTextNode(t.value));else if(22===t.type){var n=s.createElement("img");n.src=t.value,n.style.opacity="1",l.appendChild(n)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Fn);r.length&&l.appendChild(s.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var a=t.values.filter(Un),c=a[0],u=a[1];if(c&&Fn(c)){var h=i.counters.getCounterValue(c.value),d=u&&Fn(u)?Si.parse(i.context,u.value):3;l.appendChild(s.createTextNode(Wo(h,d,!1)))}}else if("counters"===t.name){var A=t.values.filter(Un),p=(c=A[0],A[1]);if(u=A[2],c&&Fn(c)){var f=i.counters.getCounterValues(c.value),g=u&&Fn(u)?Si.parse(i.context,u.value):3,m=p&&0===p.type?p.value:"",y=f.map(function(e){return Wo(e,g,!1)}).join(m);l.appendChild(s.createTextNode(y))}}}else if(20===t.type)switch(t.value){case"open-quote":l.appendChild(s.createTextNode(ua(o.quotes,i.quoteDepth++,!0)));break;case"close-quote":l.appendChild(s.createTextNode(ua(o.quotes,--i.quoteDepth,!1)));break;default:l.appendChild(s.createTextNode(t.value))}}),l.className=ol+" "+ll;var c=r===Ga.BEFORE?" "+ol:" "+ll;return uo(t)?t.className.baseValue+=c:t.className+=c,l}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Ga||(Ga={}));var Xo,Yo=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(qo,"true"),e.body.appendChild(n),n},Jo=function(e){return new Promise(function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()})},Zo=function(e){return Promise.all([].slice.call(e.images,0).map(Jo))},$o=function(e){return new Promise(function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval(function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),t(e))},50)}})},el=["all","d","content"],tl=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===el.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},nl=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},rl=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},il=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},al=":before",sl=":after",ol="___html2canvas___pseudoelement_before",ll="___html2canvas___pseudoelement_after",cl='{\n    content: "" !important;\n    display: none !important;\n}',ul=function(e){hl(e,"."+ol+al+cl+"\n         ."+ll+sl+cl)},hl=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},dl=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Al=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:bl(e)||ml(e)?((this._cache[e]=this.loadImage(e)).catch(function(){}),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){var t,n,r,a,s=this;return i(this,function(i){switch(i.label){case 0:return t=dl.isSameOrigin(e),n=!yl(e)&&!0===this._options.useCORS&&Ss.SUPPORT_CORS_IMAGES&&!t,r=!yl(e)&&!t&&!bl(e)&&"string"===typeof this._options.proxy&&Ss.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||yl(e)||bl(e)||r||n?(a=e,r?[4,this.proxy(a)]:[3,2]):[2];case 1:a=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(vl(a)||n)&&(r.crossOrigin="anonymous"),r.src=a,!0===r.complete&&setTimeout(function(){return e(r)},500),s._options.imageTimeout>0&&setTimeout(function(){return t("Timed out ("+s._options.imageTimeout+"ms) loading image")},s._options.imageTimeout)})];case 3:return[2,i.sent()]}})})},e.prototype.has=function(e){return"undefined"!==typeof this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise(function(i,a){var s=Ss.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(200===o.status)if("text"===s)i(o.response);else{var e=new FileReader;e.addEventListener("load",function(){return i(e.result)},!1),e.addEventListener("error",function(e){return a(e)},!1),e.readAsDataURL(o.response)}else a("Failed to proxy resource "+r+" with status code "+o.status)},o.onerror=a;var l=n.indexOf("?")>-1?"&":"?";if(o.open("GET",""+n+l+"url="+encodeURIComponent(e)+"&responseType="+s),"text"!==s&&o instanceof XMLHttpRequest&&(o.responseType=s),t._options.imageTimeout){var c=t._options.imageTimeout;o.timeout=c,o.ontimeout=function(){return a("Timed out ("+c+"ms) proxying "+r)}}o.send()})},e}(),pl=/^data:image\/svg\+xml/i,fl=/^data:image\/.*;base64,/i,gl=/^data:image\/.*/i,ml=function(e){return Ss.SUPPORT_SVG_DRAWING||!xl(e)},yl=function(e){return gl.test(e)},vl=function(e){return fl.test(e)},bl=function(e){return"blob"===e.substr(0,4)},xl=function(e){return"svg"===e.substr(-3).toLowerCase()||pl.test(e)},wl=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),_l=function(e,t,n){return new wl(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},Sl=function(){function e(e,t,n,r){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=_l(this.start,this.startControl,t),i=_l(this.startControl,this.endControl,t),a=_l(this.endControl,this.end,t),s=_l(r,i,t),o=_l(i,a,t),l=_l(s,o,t);return n?new e(this.start,r,s,l):new e(l,o,a,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Cl=function(e){return 1===e.type},El=function(){function e(e){var t=e.styles,n=e.bounds,r=Wn(t.borderTopLeftRadius,n.width,n.height),i=r[0],a=r[1],s=Wn(t.borderTopRightRadius,n.width,n.height),o=s[0],l=s[1],c=Wn(t.borderBottomRightRadius,n.width,n.height),u=c[0],h=c[1],d=Wn(t.borderBottomLeftRadius,n.width,n.height),A=d[0],p=d[1],f=[];f.push((i+o)/n.width),f.push((A+u)/n.width),f.push((a+p)/n.height),f.push((l+h)/n.height);var g=Math.max.apply(Math,f);g>1&&(i/=g,a/=g,o/=g,l/=g,u/=g,h/=g,A/=g,p/=g);var m=n.width-o,y=n.height-h,v=n.width-u,b=n.height-p,x=t.borderTopWidth,w=t.borderRightWidth,_=t.borderBottomWidth,S=t.borderLeftWidth,C=qn(t.paddingTop,e.bounds.width),E=qn(t.paddingRight,e.bounds.width),N=qn(t.paddingBottom,e.bounds.width),k=qn(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||a>0?Nl(n.left+S/3,n.top+x/3,i-S/3,a-x/3,Xo.TOP_LEFT):new wl(n.left+S/3,n.top+x/3),this.topRightBorderDoubleOuterBox=i>0||a>0?Nl(n.left+m,n.top+x/3,o-w/3,l-x/3,Xo.TOP_RIGHT):new wl(n.left+n.width-w/3,n.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||h>0?Nl(n.left+v,n.top+y,u-w/3,h-_/3,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w/3,n.top+n.height-_/3),this.bottomLeftBorderDoubleOuterBox=A>0||p>0?Nl(n.left+S/3,n.top+b,A-S/3,p-_/3,Xo.BOTTOM_LEFT):new wl(n.left+S/3,n.top+n.height-_/3),this.topLeftBorderDoubleInnerBox=i>0||a>0?Nl(n.left+2*S/3,n.top+2*x/3,i-2*S/3,a-2*x/3,Xo.TOP_LEFT):new wl(n.left+2*S/3,n.top+2*x/3),this.topRightBorderDoubleInnerBox=i>0||a>0?Nl(n.left+m,n.top+2*x/3,o-2*w/3,l-2*x/3,Xo.TOP_RIGHT):new wl(n.left+n.width-2*w/3,n.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||h>0?Nl(n.left+v,n.top+y,u-2*w/3,h-2*_/3,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-2*w/3,n.top+n.height-2*_/3),this.bottomLeftBorderDoubleInnerBox=A>0||p>0?Nl(n.left+2*S/3,n.top+b,A-2*S/3,p-2*_/3,Xo.BOTTOM_LEFT):new wl(n.left+2*S/3,n.top+n.height-2*_/3),this.topLeftBorderStroke=i>0||a>0?Nl(n.left+S/2,n.top+x/2,i-S/2,a-x/2,Xo.TOP_LEFT):new wl(n.left+S/2,n.top+x/2),this.topRightBorderStroke=i>0||a>0?Nl(n.left+m,n.top+x/2,o-w/2,l-x/2,Xo.TOP_RIGHT):new wl(n.left+n.width-w/2,n.top+x/2),this.bottomRightBorderStroke=u>0||h>0?Nl(n.left+v,n.top+y,u-w/2,h-_/2,Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w/2,n.top+n.height-_/2),this.bottomLeftBorderStroke=A>0||p>0?Nl(n.left+S/2,n.top+b,A-S/2,p-_/2,Xo.BOTTOM_LEFT):new wl(n.left+S/2,n.top+n.height-_/2),this.topLeftBorderBox=i>0||a>0?Nl(n.left,n.top,i,a,Xo.TOP_LEFT):new wl(n.left,n.top),this.topRightBorderBox=o>0||l>0?Nl(n.left+m,n.top,o,l,Xo.TOP_RIGHT):new wl(n.left+n.width,n.top),this.bottomRightBorderBox=u>0||h>0?Nl(n.left+v,n.top+y,u,h,Xo.BOTTOM_RIGHT):new wl(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=A>0||p>0?Nl(n.left,n.top+b,A,p,Xo.BOTTOM_LEFT):new wl(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||a>0?Nl(n.left+S,n.top+x,Math.max(0,i-S),Math.max(0,a-x),Xo.TOP_LEFT):new wl(n.left+S,n.top+x),this.topRightPaddingBox=o>0||l>0?Nl(n.left+Math.min(m,n.width-w),n.top+x,m>n.width+w?0:Math.max(0,o-w),Math.max(0,l-x),Xo.TOP_RIGHT):new wl(n.left+n.width-w,n.top+x),this.bottomRightPaddingBox=u>0||h>0?Nl(n.left+Math.min(v,n.width-S),n.top+Math.min(y,n.height-_),Math.max(0,u-w),Math.max(0,h-_),Xo.BOTTOM_RIGHT):new wl(n.left+n.width-w,n.top+n.height-_),this.bottomLeftPaddingBox=A>0||p>0?Nl(n.left+S,n.top+Math.min(b,n.height-_),Math.max(0,A-S),Math.max(0,p-_),Xo.BOTTOM_LEFT):new wl(n.left+S,n.top+n.height-_),this.topLeftContentBox=i>0||a>0?Nl(n.left+S+k,n.top+x+C,Math.max(0,i-(S+k)),Math.max(0,a-(x+C)),Xo.TOP_LEFT):new wl(n.left+S+k,n.top+x+C),this.topRightContentBox=o>0||l>0?Nl(n.left+Math.min(m,n.width+S+k),n.top+x+C,m>n.width+S+k?0:o-S+k,l-(x+C),Xo.TOP_RIGHT):new wl(n.left+n.width-(w+E),n.top+x+C),this.bottomRightContentBox=u>0||h>0?Nl(n.left+Math.min(v,n.width-(S+k)),n.top+Math.min(y,n.height+x+C),Math.max(0,u-(w+E)),h-(_+N),Xo.BOTTOM_RIGHT):new wl(n.left+n.width-(w+E),n.top+n.height-(_+N)),this.bottomLeftContentBox=A>0||p>0?Nl(n.left+S+k,n.top+b,Math.max(0,A-(S+k)),p-(_+N),Xo.BOTTOM_LEFT):new wl(n.left+S+k,n.top+n.height-(_+N))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Xo||(Xo={}));var Nl=function(e,t,n,r,i){var a=(Math.sqrt(2)-1)/3*4,s=n*a,o=r*a,l=e+n,c=t+r;switch(i){case Xo.TOP_LEFT:return new Sl(new wl(e,c),new wl(e,c-o),new wl(l-s,t),new wl(l,t));case Xo.TOP_RIGHT:return new Sl(new wl(e,t),new wl(e+s,t),new wl(l,c-o),new wl(l,c));case Xo.BOTTOM_RIGHT:return new Sl(new wl(l,t),new wl(l,t+o),new wl(e+s,c),new wl(e,c));case Xo.BOTTOM_LEFT:default:return new Sl(new wl(l,c),new wl(l-s,c),new wl(e,t+o),new wl(e,t))}},kl=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Il=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},Tl=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Bl=function(){function e(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return e}(),Ml=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),Fl=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),Rl=function(e){return 0===e.type},Ll=function(e){return 1===e.type},Pl=function(e){return 2===e.type},Ul=function(e,t){return e.length===t.length&&e.some(function(e,n){return e===t[n]})},Dl=function(e,t,n,r,i){return e.map(function(e,a){switch(a){case 0:return e.add(t,n);case 1:return e.add(t+r,n);case 2:return e.add(t+r,n+i);case 3:return e.add(t,n+i)}return e})},Ol=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),jl=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new El(this.container),this.container.styles.opacity<1&&this.effects.push(new Fl(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new Bl(n,r,i))}if(0!==this.container.styles.overflowX){var a=kl(this.curves),s=Tl(this.curves);Ul(a,s)?this.effects.push(new Ml(a,6)):(this.effects.push(new Ml(a,2)),this.effects.push(new Ml(s,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,r=this.effects.slice(0);n;){var i=n.effects.filter(function(e){return!Ll(e)});if(t||0!==n.container.styles.position||!n.parent){if(r.unshift.apply(r,i),t=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var a=kl(n.curves),s=Tl(n.curves);Ul(a,s)||r.unshift(new Ml(s,6))}}else r.unshift.apply(r,i);n=n.parent}return r.filter(function(t){return ia(t.target,e)})},e}(),zl=function(e,t,n,r){e.container.elements.forEach(function(i){var a=ia(i.flags,4),s=ia(i.flags,2),o=new jl(i,e);ia(i.styles.display,2048)&&r.push(o);var l=ia(i.flags,8)?[]:r;if(a||s){var c=a||i.styles.isPositioned()?n:t,u=new Ol(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var h=i.styles.zIndex.order;if(h<0){var d=0;c.negativeZIndex.some(function(e,t){return h>e.element.container.styles.zIndex.order?(d=t,!1):d>0}),c.negativeZIndex.splice(d,0,u)}else if(h>0){var A=0;c.positiveZIndex.some(function(e,t){return h>=e.element.container.styles.zIndex.order?(A=t+1,!1):A>0}),c.positiveZIndex.splice(A,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else i.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);zl(o,u,a?u:n,l)}else i.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),zl(o,t,n,l);ia(i.flags,8)&&Hl(i,l)})},Hl=function(e,t){for(var n=e instanceof Hs?e.start:1,r=e instanceof Hs&&e.reversed,i=0;i<t.length;i++){var a=t[i];a.container instanceof zs&&"number"===typeof a.container.value&&0!==a.container.value&&(n=a.container.value),a.listValue=Wo(n,a.container.styles.listStyleType,!0),n+=r?-1:1}},Ql=function(e){var t=new jl(e,null),n=new Ol(t),r=[];return zl(t,n,n,r),Hl(t.container,r),n},Vl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Xl(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Xl(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Xl(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Gl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Xl(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Xl(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Xl(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},Wl=function(e,t){switch(t){case 0:return Xl(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Xl(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Xl(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Xl(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},ql=function(e,t){switch(t){case 0:return Kl(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Kl(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Kl(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return Kl(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},Kl=function(e,t){var n=[];return Cl(e)?n.push(e.subdivide(.5,!1)):n.push(e),Cl(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},Xl=function(e,t,n,r){var i=[];return Cl(e)?i.push(e.subdivide(.5,!1)):i.push(e),Cl(n)?i.push(n.subdivide(.5,!0)):i.push(n),Cl(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),Cl(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},Yl=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},Jl=function(e){var t=e.styles,n=e.bounds,r=qn(t.paddingLeft,n.width),i=qn(t.paddingRight,n.width),a=qn(t.paddingTop,n.width),s=qn(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,a+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+a+s))},Zl=function(e,t){return 0===e?t.bounds:2===e?Jl(t):Yl(t)},$l=function(e,t){return 0===e?t.bounds:2===e?Jl(t):Yl(t)},ec=function(e,t,n){var r=Zl(ic(e.styles.backgroundOrigin,t),e),i=$l(ic(e.styles.backgroundClip,t),e),a=rc(ic(e.styles.backgroundSize,t),n,r),s=a[0],o=a[1],l=Wn(ic(e.styles.backgroundPosition,t),r.width-s,r.height-o);return[ac(ic(e.styles.backgroundRepeat,t),l,a,r,i),Math.round(r.left+l[0]),Math.round(r.top+l[1]),s,o]},tc=function(e){return Fn(e)&&e.value===Pr.AUTO},nc=function(e){return"number"===typeof e},rc=function(e,t,n){var r=t[0],i=t[1],a=t[2],s=e[0],o=e[1];if(!s)return[0,0];if(zn(s)&&o&&zn(o))return[qn(s,n.width),qn(o,n.height)];var l=nc(a);if(Fn(s)&&(s.value===Pr.CONTAIN||s.value===Pr.COVER))return nc(a)?n.width/n.height<a!==(s.value===Pr.COVER)?[n.width,n.width/a]:[n.height*a,n.height]:[n.width,n.height];var c=nc(r),u=nc(i),h=c||u;if(tc(s)&&(!o||tc(o)))return c&&u?[r,i]:l||h?h&&l?[c?r:i*a,u?i:r/a]:[c?r:n.width,u?i:n.height]:[n.width,n.height];if(l){var d=0,A=0;return zn(s)?d=qn(s,n.width):zn(o)&&(A=qn(o,n.height)),tc(s)?d=A*a:o&&!tc(o)||(A=d/a),[d,A]}var p=null,f=null;if(zn(s)?p=qn(s,n.width):o&&zn(o)&&(f=qn(o,n.height)),null===p||o&&!tc(o)||(f=c&&u?p/r*i:n.height),null!==f&&tc(s)&&(p=c&&u?f/i*r:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},ic=function(e,t){var n=e[t];return"undefined"===typeof n?e[0]:n},ac=function(e,t,n,r,i){var a=t[0],s=t[1],o=n[0],l=n[1];switch(e){case 2:return[new wl(Math.round(r.left),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(l+r.top+s)),new wl(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new wl(Math.round(r.left+a),Math.round(r.top)),new wl(Math.round(r.left+a+o),Math.round(r.top)),new wl(Math.round(r.left+a+o),Math.round(r.height+r.top)),new wl(Math.round(r.left+a),Math.round(r.height+r.top))];case 1:return[new wl(Math.round(r.left+a),Math.round(r.top+s)),new wl(Math.round(r.left+a+o),Math.round(r.top+s)),new wl(Math.round(r.left+a+o),Math.round(r.top+s+l)),new wl(Math.round(r.left+a),Math.round(r.top+s+l))];default:return[new wl(Math.round(i.left),Math.round(i.top)),new wl(Math.round(i.left+i.width),Math.round(i.top)),new wl(Math.round(i.left+i.width),Math.round(i.height+i.top)),new wl(Math.round(i.left),Math.round(i.height+i.top))]}},sc="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",oc="Hidden Text",lc=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),r.src=sc,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(oc)),n.appendChild(i),n.appendChild(r);var s=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode(oc)),n.style.lineHeight="normal",r.style.verticalAlign="super";var o=r.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:s,middle:o}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return"undefined"===typeof this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),cc=function(){function e(e,t){this.context=e,this.options=t}return e}(),uc=1e4,hc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new lc(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach(function(e){return t.applyEffect(e)})},n.prototype.applyEffect=function(e){this.ctx.save(),Pl(e)&&(this.ctx.globalAlpha=e.opacity),Rl(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Ll(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.renderNode=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return ia(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):Is(e.text).reduce(function(t,i){return r.ctx.fillText(i,t,e.bounds.top+n),t+r.ctx.measureText(i).width},e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return"normal"===e||"small-caps"===e}).join(""),n=gc(e.fontFamily).join(", "),r=Bn(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,h=this;return i(this,function(i){return n=this.createFontStyle(t),r=n[0],a=n[1],s=n[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",o=this.fontMetrics.getMetrics(a,s),l=o.baseline,c=o.middle,u=t.paintOrder,e.textBounds.forEach(function(e){u.forEach(function(n){switch(n){case 0:h.ctx.fillStyle=ir(t.color),h.renderTextWithLetterSpacing(e,t.letterSpacing,l);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach(function(n){h.ctx.shadowColor=ir(n.color),h.ctx.shadowOffsetX=n.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=n.offsetY.number*h.options.scale,h.ctx.shadowBlur=n.blur.number,h.renderTextWithLetterSpacing(e,t.letterSpacing,l)}),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),t.textDecorationLine.length&&(h.ctx.fillStyle=ir(t.textDecorationColor||t.color),t.textDecorationLine.forEach(function(t){switch(t){case 1:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+l),e.bounds.width,1);break;case 2:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:h.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+c),e.bounds.width,1)}}));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(h.ctx.strokeStyle=ir(t.webkitTextStrokeColor),h.ctx.lineWidth=t.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+l)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}})}),[2]})})},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=Jl(e),i=Tl(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,function(){var t,r,a,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x;return i(this,function(i){switch(i.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,r=e.curves,a=t.styles,o=0,l=t.textNodes,i.label=1;case 1:return o<l.length?(c=l[o],[4,this.renderTextNode(c,a)]):[3,4];case 2:i.sent(),i.label=3;case 3:return o++,[3,1];case 4:if(!(t instanceof Ds))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return y=i.sent(),this.renderReplacedElement(t,r,y),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Os&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof js))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return y=i.sent(),this.renderReplacedElement(t,r,y),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof eo&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:u=i.sent(),t.width&&t.height&&this.ctx.drawImage(u,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),i.label=14;case 14:if(t instanceof Js&&(h=Math.min(t.bounds.width,t.bounds.height),t.type===qs?t.checked&&(this.ctx.save(),this.path([new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h),new wl(t.bounds.left+.16*h,t.bounds.top+.5549*h),new wl(t.bounds.left+.27347*h,t.bounds.top+.44071*h),new wl(t.bounds.left+.39694*h,t.bounds.top+.5649*h),new wl(t.bounds.left+.72983*h,t.bounds.top+.23*h),new wl(t.bounds.left+.84*h,t.bounds.top+.34085*h),new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h)]),this.ctx.fillStyle=ir(Ys),this.ctx.fill(),this.ctx.restore()):t.type===Ks&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+h/2,t.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=ir(Ys),this.ctx.fill(),this.ctx.restore())),dc(t)&&t.value.length){switch(d=this.createFontStyle(a),b=d[0],A=d[1],p=this.fontMetrics.getMetrics(b,A).baseline,this.ctx.font=b,this.ctx.fillStyle=ir(a.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=pc(t.styles.textAlign),x=Jl(t),f=0,t.styles.textAlign){case 1:f+=x.width/2;break;case 2:f+=x.width}g=x.add(f,0,0,-x.height/2+1),this.ctx.save(),this.path([new wl(x.left,x.top),new wl(x.left+x.width,x.top),new wl(x.left+x.width,x.top+x.height),new wl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Cs(t.value,g),a.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ia(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(m=t.styles.listStyleImage).type)return[3,18];y=void 0,v=m.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(v)];case 16:return y=i.sent(),this.ctx.drawImage(y,t.bounds.left-(y.width+10),t.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+v),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(b=this.createFontStyle(a)[0],this.ctx.font=b,this.ctx.fillStyle=ir(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new s(t.bounds.left,t.bounds.top+qn(t.styles.paddingTop,t.bounds.width),t.bounds.width,xi(a.lineHeight,a.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Cs(e.listValue,x),a.letterSpacing,xi(a.lineHeight,a.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}})})},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,function(){var t,n,r,a,s,o,l,c,u,h,d,A,p,f,g;return i(this,function(i){switch(i.label){case 0:return ia(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:i.sent(),t=0,n=e.negativeZIndex,i.label=2;case 2:return t<n.length?(g=n[t],[4,this.renderStack(g)]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:i.sent(),r=0,a=e.nonInlineLevel,i.label=7;case 7:return r<a.length?(g=a[r],[4,this.renderNode(g)]):[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:s=0,o=e.nonPositionedFloats,i.label=11;case 11:return s<o.length?(g=o[s],[4,this.renderStack(g)]):[3,14];case 12:i.sent(),i.label=13;case 13:return s++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,i.label=15;case 15:return l<c.length?(g=c[l],[4,this.renderStack(g)]):[3,18];case 16:i.sent(),i.label=17;case 17:return l++,[3,15];case 18:u=0,h=e.inlineLevel,i.label=19;case 19:return u<h.length?(g=h[u],[4,this.renderNode(g)]):[3,22];case 20:i.sent(),i.label=21;case 21:return u++,[3,19];case 22:d=0,A=e.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return d<A.length?(g=A[d],[4,this.renderStack(g)]):[3,26];case 24:i.sent(),i.label=25;case 25:return d++,[3,23];case 26:p=0,f=e.positiveZIndex,i.label=27;case 27:return p<f.length?(g=f[p],[4,this.renderStack(g)]):[3,30];case 28:i.sent(),i.label=29;case 29:return p++,[3,27];case 30:return[2]}})})},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach(function(e,n){var r=Cl(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),Cl(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),i},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,function(){var t,n,r,a,s,o;return i(this,function(l){switch(l.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var a,s,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S,C,E,N,k,I,T,B,M,F,R,L;return i(this,function(i){switch(i.label){case 0:if(0!==n.type)return[3,5];a=void 0,s=n.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return a=i.sent(),[3,4];case 3:return i.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return a&&(o=ec(e,t,[a.width,a.height,a.width/a.height]),b=o[0],E=o[1],N=o[2],_=o[3],S=o[4],y=r.ctx.createPattern(r.resizeImage(a,_,S),"repeat"),r.renderRepeat(b,y,E,N)),[3,6];case 5:Mr(n)?(l=ec(e,t,[null,null,null]),b=l[0],E=l[1],N=l[2],_=l[3],S=l[4],c=yr(n.angle,_,S),u=c[0],h=c[1],d=c[2],A=c[3],p=c[4],(f=document.createElement("canvas")).width=_,f.height=S,g=f.getContext("2d"),m=g.createLinearGradient(h,A,d,p),gr(n.stops,u).forEach(function(e){return m.addColorStop(e.stop,ir(e.color))}),g.fillStyle=m,g.fillRect(0,0,_,S),_>0&&S>0&&(y=r.ctx.createPattern(f,"repeat"),r.renderRepeat(b,y,E,N))):Fr(n)&&(v=ec(e,t,[null,null,null]),b=v[0],x=v[1],w=v[2],_=v[3],S=v[4],C=0===n.position.length?[Vn]:n.position,E=qn(C[0],_),N=qn(C[C.length-1],S),k=xr(n,E,N,_,S),I=k[0],T=k[1],I>0&&T>0&&(B=r.ctx.createRadialGradient(x+E,w+N,0,x+E,w+N,I),gr(n.stops,2*I).forEach(function(e){return B.addColorStop(e.stop,ir(e.color))}),r.path(b),r.ctx.fillStyle=B,I!==T?(M=e.bounds.left+.5*e.bounds.width,F=e.bounds.top+.5*e.bounds.height,L=1/(R=T/I),r.ctx.save(),r.ctx.translate(M,F),r.ctx.transform(1,0,0,R,0,0),r.ctx.translate(-M,-F),r.ctx.fillRect(x,L*(w-F)+F,_,S*L),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return t--,[2]}})},r=this,a=0,s=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return a<s.length?(o=s[a],[5,n(o)]):[3,4];case 2:l.sent(),l.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,function(){return i(this,function(r){return this.path(Vl(n,t)),this.ctx.fillStyle=ir(e),this.ctx.fill(),[2]})})},n.prototype.renderDoubleBorder=function(e,t,n,a){return r(this,void 0,void 0,function(){var r,s;return i(this,function(i){switch(i.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,a)]:[3,2];case 1:return i.sent(),[2];case 2:return r=Gl(a,n),this.path(r),this.ctx.fillStyle=ir(e),this.ctx.fill(),s=Wl(a,n),this.path(s),this.ctx.fill(),[2]}})})},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,function(){var t,n,r,a,s,o,l,c,u=this;return i(this,function(i){switch(i.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!rr(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],a=Ac(ic(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),rr(t.backgroundColor)||(this.ctx.fillStyle=ir(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach(function(t){u.ctx.save();var n=kl(e.curves),r=t.inset?0:uc,i=Dl(n,-r+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(u.path(n),u.ctx.clip(),u.mask(i)):(u.mask(n),u.ctx.clip(),u.path(i)),u.ctx.shadowOffsetX=t.offsetX.number+r,u.ctx.shadowOffsetY=t.offsetY.number,u.ctx.shadowColor=ir(t.color),u.ctx.shadowBlur=t.blur.number,u.ctx.fillStyle=t.inset?ir(t.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()}),i.label=2;case 2:s=0,o=0,l=r,i.label=3;case 3:return o<l.length?0!==(c=l[o]).style&&!rr(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,2)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,3)];case 6:return i.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,s,e.curves)];case 8:return i.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,s,e.curves)];case 10:i.sent(),i.label=11;case 11:s++,i.label=12;case 12:return o++,[3,3];case 13:return[2]}})})},n.prototype.renderDashedDottedBorder=function(e,t,n,a,s){return r(this,void 0,void 0,function(){var r,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x;return i(this,function(i){return this.ctx.save(),r=ql(a,n),o=Vl(a,n),2===s&&(this.path(o),this.ctx.clip()),Cl(o[0])?(l=o[0].start.x,c=o[0].start.y):(l=o[0].x,c=o[0].y),Cl(o[1])?(u=o[1].end.x,h=o[1].end.y):(u=o[1].x,h=o[1].y),d=0===n||2===n?Math.abs(l-u):Math.abs(c-h),this.ctx.beginPath(),3===s?this.formatPath(r):this.formatPath(o.slice(0,2)),A=t<3?3*t:2*t,p=t<3?2*t:t,3===s&&(A=t,p=t),f=!0,d<=2*A?f=!1:d<=2*A+p?(A*=g=d/(2*A+p),p*=g):(m=Math.floor((d+p)/(A+p)),y=(d-m*A)/(m-1),p=(v=(d-(m+1)*A)/m)<=0||Math.abs(p-y)<Math.abs(p-v)?y:v),f&&(3===s?this.ctx.setLineDash([0,A+p]):this.ctx.setLineDash([A,p])),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=ir(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Cl(o[0])&&(b=o[3],x=o[0],this.ctx.beginPath(),this.formatPath([new wl(b.end.x,b.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke()),Cl(o[1])&&(b=o[1],x=o[2],this.ctx.beginPath(),this.formatPath([new wl(b.end.x,b.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},n.prototype.render=function(e){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ir(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=Ql(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},n}(cc),dc=function(e){return e instanceof $s||e instanceof Zs||e instanceof Js&&e.type!==Ks&&e.type!==qs},Ac=function(e,t){switch(e){case 0:return kl(t);case 2:return Il(t);default:return Tl(t)}},pc=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},fc=["-apple-system","system-ui"],gc=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(e){return-1===fc.indexOf(e)}):e},mc=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return t=ws(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,yc(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ir(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},n}(cc),yc=function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},vc=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.debug?console.debug.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!==typeof window&&window.console&&"function"===typeof console.info&&console.info.apply(console,a([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.warn?console.warn.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.error?console.error.apply(console,a([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),bc=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new vc({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new Al(this,t)}return e.instanceCount=1,e}(),xc=function(e,t){return void 0===t&&(t={}),wc(e,t)};"undefined"!==typeof window&&dl.setContext(window);var wc=function(e,t){return r(void 0,void 0,void 0,function(){var r,a,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S,C,E,N,k,I,T,B,M,F,R,L,P,U,D,O,j,z,H,Q,V;return i(this,function(i){switch(i.label){case 0:if(!e||"object"!==typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(a=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(k=t.allowTaint)&&void 0!==k&&k,imageTimeout:null!==(I=t.imageTimeout)&&void 0!==I?I:15e3,proxy:t.proxy,useCORS:null!==(T=t.useCORS)&&void 0!==T&&T},u=n({logging:null===(B=t.logging)||void 0===B||B,cache:t.cache},c),h={windowWidth:null!==(M=t.windowWidth)&&void 0!==M?M:a.innerWidth,windowHeight:null!==(F=t.windowHeight)&&void 0!==F?F:a.innerHeight,scrollX:null!==(R=t.scrollX)&&void 0!==R?R:a.pageXOffset,scrollY:null!==(L=t.scrollY)&&void 0!==L?L:a.pageYOffset},d=new s(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),A=new bc(u,d),p=null!==(P=t.foreignObjectRendering)&&void 0!==P&&P,f={allowTaint:null!==(U=t.allowTaint)&&void 0!==U&&U,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:p,copyStyles:p},A.logger.debug("Starting document clone with size "+d.width+"x"+d.height+" scrolled to "+-d.left+","+-d.top),g=new Ko(A,e,f),(m=g.clonedReferenceElement)?[4,g.toIFrame(r,d)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return y=i.sent(),v=mo(m)||fo(m)?l(m.ownerDocument):o(A,m),b=v.width,x=v.height,w=v.left,_=v.top,S=_c(A,m,t.backgroundColor),C={canvas:t.canvas,backgroundColor:S,scale:null!==(O=null!==(D=t.scale)&&void 0!==D?D:a.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(j=t.x)&&void 0!==j?j:0)+w,y:(null!==(z=t.y)&&void 0!==z?z:0)+_,width:null!==(H=t.width)&&void 0!==H?H:Math.ceil(b),height:null!==(Q=t.height)&&void 0!==Q?Q:Math.ceil(x)},p?(A.logger.debug("Document cloned, using foreign object rendering"),[4,new mc(A,C).render(m)]):[3,3];case 2:return E=i.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+w+","+_+" with size "+b+"x"+x+" using computed rendering"),A.logger.debug("Starting DOM parsing"),N=io(A,m),S===N.styles.backgroundColor&&(N.styles.backgroundColor=dr.TRANSPARENT),A.logger.debug("Starting renderer for element at "+C.x+","+C.y+" with size "+C.width+"x"+C.height),[4,new hc(A,C).render(N)];case 4:E=i.sent(),i.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(Ko.destroy(y)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,E]}})})},_c=function(e,t,n){var r=t.ownerDocument,i=r.documentElement?hr(e,getComputedStyle(r.documentElement).backgroundColor):dr.TRANSPARENT,a=r.body?hr(e,getComputedStyle(r.body).backgroundColor):dr.TRANSPARENT,s="string"===typeof n?hr(e,n):null===n?dr.TRANSPARENT:4294967295;return t===r.documentElement?rr(i)?rr(a)?s:a:i:s};return xc}()},5262:function(e,t,n){var r;!function(e,i){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.tychei=o}(0,e=n.nmd(e),n.amdD)},5817:()=>{},6288:function(e,t,n){var r;!function(e,i){function a(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,s,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,a=-32;a<l;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,i=0==(n=o[127&a]^=r+s)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;e.w=s,e.X=o,e.i=i}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.xor4096=o}(0,e=n.nmd(e),n.amdD)},6958:(e,t,n)=>{e.exports=function(e){var t={},r=n(5043),i=n(8513),a=Object.assign;function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),v=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var b=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var x=Symbol.iterator;function w(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=x&&e[x]||e["@@iterator"])?e:null}function _(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case m:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case f:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:_(e.type)||"Memo";case v:t=e._payload,e=e._init;try{return _(e(t))}catch(n){}}return null}function S(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function C(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function E(e){if(C(e)!==e)throw Error(s(188))}function N(e){var t=e.alternate;if(!t){if(null===(t=C(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return E(i),e;if(a===r)return E(i),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}function k(e){return null!==(e=N(e))?I(e):null}function I(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=I(e);if(null!==t)return t;e=e.sibling}return null}function T(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=T(e);if(null!==t)return t}e=e.sibling}return null}var B,M=Array.isArray,F=e.getPublicInstance,R=e.getRootHostContext,L=e.getChildHostContext,P=e.prepareForCommit,U=e.resetAfterCommit,D=e.createInstance,O=e.appendInitialChild,j=e.finalizeInitialChildren,z=e.prepareUpdate,H=e.shouldSetTextContent,Q=e.createTextInstance,V=e.scheduleTimeout,G=e.cancelTimeout,W=e.noTimeout,q=e.isPrimaryRenderer,K=e.supportsMutation,X=e.supportsPersistence,Y=e.supportsHydration,J=e.getInstanceFromNode,Z=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ie=e.findFiberRoot,ae=e.getBoundingRect,se=e.getTextContent,oe=e.isHiddenSubtree,le=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,he=e.appendChild,de=e.appendChildToContainer,Ae=e.commitTextUpdate,pe=e.commitMount,fe=e.commitUpdate,ge=e.insertBefore,me=e.insertInContainerBefore,ye=e.removeChild,ve=e.removeChildFromContainer,be=e.resetTextContent,xe=e.hideInstance,we=e.hideTextInstance,_e=e.unhideInstance,Se=e.unhideTextInstance,Ce=e.clearContainer,Ee=e.cloneInstance,Ne=e.createContainerChildSet,ke=e.appendChildToContainerChildSet,Ie=e.finalizeContainerChildren,Te=e.replaceContainerChildren,Be=e.cloneHiddenInstance,Me=e.cloneHiddenTextInstance,Fe=e.canHydrateInstance,Re=e.canHydrateTextInstance,Le=e.canHydrateSuspenseInstance,Pe=e.isSuspenseInstancePending,Ue=e.isSuspenseInstanceFallback,De=e.registerSuspenseInstanceRetry,Oe=e.getNextHydratableSibling,je=e.getFirstHydratableChild,ze=e.getFirstHydratableChildWithinContainer,He=e.getFirstHydratableChildWithinSuspenseInstance,Qe=e.hydrateInstance,Ve=e.hydrateTextInstance,Ge=e.hydrateSuspenseInstance,We=e.getNextHydratableInstanceAfterSuspenseInstance,qe=e.commitHydratedContainer,Ke=e.commitHydratedSuspenseInstance,Xe=e.clearSuspenseBoundary,Ye=e.clearSuspenseBoundaryFromContainer,Je=e.shouldDeleteUnhydratedTailInstances,Ze=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===B)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);B=t&&t[1]||""}return"\n"+B+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,it=[],at=-1;function st(e){return{current:e}}function ot(e){0>at||(e.current=it[at],it[at]=null,at--)}function lt(e,t){at++,it[at]=e.current,e.current=t}var ct={},ut=st(ct),ht=st(!1),dt=ct;function At(e,t){var n=e.type.contextTypes;if(!n)return ct;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ft(){ot(ht),ot(ut)}function gt(e,t,n){if(ut.current!==ct)throw Error(s(168));lt(ut,t),lt(ht,n)}function mt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,S(e)||"Unknown",i));return a({},n,r)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,dt=ut.current,lt(ut,e),lt(ht,ht.current),!0}function vt(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=mt(e,t,dt),r.__reactInternalMemoizedMergedChildContext=e,ot(ht),ot(ut),lt(ut,e)):ot(ht),lt(ht,n)}var bt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xt(e)/wt|0)|0},xt=Math.log,wt=Math.LN2;var _t=64,St=4194304;function Ct(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Et(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~i;0!==o?r=Ct(o):0!==(a&=s)&&(r=Ct(a))}else 0!==(s=n&~i)?r=Ct(s):0!==a&&(r=Ct(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-bt(t)),r|=e[n],t&=~i;return r}function Nt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function kt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function It(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Tt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-bt(t)]=n}function Bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-bt(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Mt=0;function Ft(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Rt=i.unstable_scheduleCallback,Lt=i.unstable_cancelCallback,Pt=i.unstable_shouldYield,Ut=i.unstable_requestPaint,Dt=i.unstable_now,Ot=i.unstable_ImmediatePriority,jt=i.unstable_UserBlockingPriority,zt=i.unstable_NormalPriority,Ht=i.unstable_IdlePriority,Qt=null,Vt=null;var Gt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Wt=null,qt=!1,Kt=!1;function Xt(e){null===Wt?Wt=[e]:Wt.push(e)}function Yt(){if(!Kt&&null!==Wt){Kt=!0;var e=0,t=Mt;try{var n=Wt;for(Mt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Wt=null,qt=!1}catch(i){throw null!==Wt&&(Wt=Wt.slice(e+1)),Rt(Ot,Yt),i}finally{Mt=t,Kt=!1}}return null}var Jt=o.ReactCurrentBatchConfig;function Zt(e,t){if(Gt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!rt.call(t,i)||!Gt(e[i],t[i]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=st(null),nn=null,rn=null,an=null;function sn(){an=rn=nn=null}function on(e,t,n){q?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;ot(tn),q?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Pi=!0),e.firstContext=null)}function hn(e){var t=q?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(s(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var dn=null,An=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function mn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Ka&&0!==(1&e.mode)&&0===(2&qa)?(null===(e=n.interleaved)?(t.next=t,null===dn?dn=[n]:dn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Bt(e,n)}}function vn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bn(e,t,n,r){var i=e.updateQueue;An=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(null!==l){i.shared.pending=null;var c=l,u=c.next;c.next=null,null===o?s=u:o.next=u,o=c;var h=e.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==s){var d=i.baseState;for(o=0,h=u=c=null,l=s;;){var A=l.lane,p=l.eventTime;if((r&A)===A){null!==h&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var f=e,g=l;switch(A=t,p=n,g.tag){case 1:if("function"===typeof(f=g.payload)){d=f.call(p,d,A);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(A="function"===typeof(f=g.payload)?f.call(p,d,A):f)||void 0===A)break e;d=a({},d,A);break e;case 2:An=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(A=i.effects)?i.effects=[l]:A.push(l))}else p={eventTime:p,lane:A,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,o|=A;if(null===(l=l.next)){if(null===(l=i.shared.pending))break;l=(A=l).next,A.next=null,i.lastBaseUpdate=A,i.shared.pending=null}}if(null===h&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=h,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);ts|=o,e.lanes=o,e.memoizedState=d}}function xn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var wn=(new r.Component).refs;function _n(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Sn={isMounted:function(e){return!!(e=e._reactInternals)&&C(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=bs(),i=xs(e),a=gn(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),mn(e,a),null!==(t=ws(e,i,r))&&yn(t,e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=bs(),i=xs(e),a=gn(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),mn(e,a),null!==(t=ws(e,i,r))&&yn(t,e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bs(),r=xs(e),i=gn(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),mn(e,i),null!==(t=ws(e,r,n))&&yn(t,e,r)}};function Cn(e,t,n,r,i,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!Zt(n,r)||!Zt(i,a))}function En(e,t,n){var r=!1,i=ct,a=t.contextType;return"object"===typeof a&&null!==a?a=hn(a):(i=pt(t)?dt:ut.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?At(e,i):ct),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Sn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Nn(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Sn.enqueueReplaceState(t,t.state,null)}function kn(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=wn,pn(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=hn(a):(a=pt(t)?dt:ut.current,i.context=At(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(_n(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Sn.enqueueReplaceState(i,i.state,null),bn(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}var In=[],Tn=0,Bn=null,Mn=0,Fn=[],Rn=0,Ln=null,Pn=1,Un="";function Dn(e,t){In[Tn++]=Mn,In[Tn++]=Bn,Bn=e,Mn=t}function On(e,t,n){Fn[Rn++]=Pn,Fn[Rn++]=Un,Fn[Rn++]=Ln,Ln=e;var r=Pn;e=Un;var i=32-bt(r)-1;r&=~(1<<i),n+=1;var a=32-bt(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Pn=1<<32-bt(t)+i|n<<i|r,Un=a+e}else Pn=1<<a|n<<i|r,Un=e}function jn(e){null!==e.return&&(Dn(e,1),On(e,1,0))}function zn(e){for(;e===Bn;)Bn=In[--Tn],In[Tn]=null,Mn=In[--Tn],In[Tn]=null;for(;e===Ln;)Ln=Fn[--Rn],Fn[Rn]=null,Un=Fn[--Rn],Fn[Rn]=null,Pn=Fn[--Rn],Fn[Rn]=null}var Hn=null,Qn=null,Vn=!1,Gn=!1,Wn=null;function qn(e,t){var n=Js(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Kn(e,t){switch(e.tag){case 5:return null!==(t=Fe(t,e.type,e.pendingProps))&&(e.stateNode=t,Hn=e,Qn=je(t),!0);case 6:return null!==(t=Re(t,e.pendingProps))&&(e.stateNode=t,Hn=e,Qn=null,!0);case 13:if(null!==(t=Le(t))){var n=null!==Ln?{id:Pn,overflow:Un}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Js(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Hn=e,Qn=null,!0}return!1;default:return!1}}function Xn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Yn(e){if(Vn){var t=Qn;if(t){var n=t;if(!Kn(e,t)){if(Xn(e))throw Error(s(418));t=Oe(n);var r=Hn;t&&Kn(e,t)?qn(r,n):(e.flags=-4097&e.flags|2,Vn=!1,Hn=e)}}else{if(Xn(e))throw Error(s(418));e.flags=-4097&e.flags|2,Vn=!1,Hn=e}}}function Jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Hn=e}function Zn(e){if(!Y||e!==Hn)return!1;if(!Vn)return Jn(e),Vn=!0,!1;if(3!==e.tag&&(5!==e.tag||Je(e.type)&&!H(e.type,e.memoizedProps))){var t=Qn;if(t){if(Xn(e)){for(e=Qn;e;)e=Oe(e);throw Error(s(418))}for(;t;)qn(e,t),t=Oe(t)}}if(Jn(e),13===e.tag){if(!Y)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));Qn=We(e)}else Qn=Hn?Oe(e.stateNode):null;return!0}function $n(){Y&&(Qn=Hn=null,Gn=Vn=!1)}function er(e){null===Wn?Wn=[e]:Wn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;t===wn&&(t=i.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ir(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=$s(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,r){return null===t||6!==t.tag?((t=ro(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n,r){var a=n.type;return a===u?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===v&&rr(a)===t.type)?((r=i(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=eo(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function A(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=io(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function p(e,t,n,r,a){return null===t||7!==t.tag?((t=to(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=ro(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=eo(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case c:return(t=io(t,e.mode,n)).return=e,t;case v:return f(e,(0,t._init)(t._payload),n)}if(M(t)||w(t))return(t=to(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function g(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:h(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===i?d(e,t,n,r):null;case c:return n.key===i?A(e,t,n,r):null;case v:return g(e,t,(i=n._init)(n._payload),r)}if(M(n)||w(n))return null!==i?null:p(e,t,n,r,null);nr(e,n)}return null}function m(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return h(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case l:return d(t,e=e.get(null===r.key?n:r.key)||null,r,i);case c:return A(t,e=e.get(null===r.key?n:r.key)||null,r,i);case v:return m(e,t,n,(0,r._init)(r._payload),i)}if(M(r)||w(r))return p(t,e=e.get(n)||null,r,i,null);nr(t,r)}return null}function y(i,s,o,l){for(var c=null,u=null,h=s,d=s=0,A=null;null!==h&&d<o.length;d++){h.index>d?(A=h,h=null):A=h.sibling;var p=g(i,h,o[d],l);if(null===p){null===h&&(h=A);break}e&&h&&null===p.alternate&&t(i,h),s=a(p,s,d),null===u?c=p:u.sibling=p,u=p,h=A}if(d===o.length)return n(i,h),Vn&&Dn(i,d),c;if(null===h){for(;d<o.length;d++)null!==(h=f(i,o[d],l))&&(s=a(h,s,d),null===u?c=h:u.sibling=h,u=h);return Vn&&Dn(i,d),c}for(h=r(i,h);d<o.length;d++)null!==(A=m(h,i,d,o[d],l))&&(e&&null!==A.alternate&&h.delete(null===A.key?d:A.key),s=a(A,s,d),null===u?c=A:u.sibling=A,u=A);return e&&h.forEach(function(e){return t(i,e)}),Vn&&Dn(i,d),c}function b(i,o,l,c){var u=w(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,d=o,A=o=0,p=null,y=l.next();null!==d&&!y.done;A++,y=l.next()){d.index>A?(p=d,d=null):p=d.sibling;var v=g(i,d,y.value,c);if(null===v){null===d&&(d=p);break}e&&d&&null===v.alternate&&t(i,d),o=a(v,o,A),null===h?u=v:h.sibling=v,h=v,d=p}if(y.done)return n(i,d),Vn&&Dn(i,A),u;if(null===d){for(;!y.done;A++,y=l.next())null!==(y=f(i,y.value,c))&&(o=a(y,o,A),null===h?u=y:h.sibling=y,h=y);return Vn&&Dn(i,A),u}for(d=r(i,d);!y.done;A++,y=l.next())null!==(y=m(d,i,A,y.value,c))&&(e&&null!==y.alternate&&d.delete(null===y.key?A:y.key),o=a(y,o,A),null===h?u=y:h.sibling=y,h=y);return e&&d.forEach(function(e){return t(i,e)}),Vn&&Dn(i,A),u}return function e(r,a,s,h){if("object"===typeof s&&null!==s&&s.type===u&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case l:e:{for(var d=s.key,A=a;null!==A;){if(A.key===d){if((d=s.type)===u){if(7===A.tag){n(r,A.sibling),(a=i(A,s.props.children)).return=r,r=a;break e}}else if(A.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===v&&rr(d)===A.type){n(r,A.sibling),(a=i(A,s.props)).ref=tr(r,A,s),a.return=r,r=a;break e}n(r,A);break}t(r,A),A=A.sibling}s.type===u?((a=to(s.props.children,r.mode,h,s.key)).return=r,r=a):((h=eo(s.type,s.key,s.props,null,r.mode,h)).ref=tr(r,a,s),h.return=r,r=h)}return o(r);case c:e:{for(A=s.key;null!==a;){if(a.key===A){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){n(r,a.sibling),(a=i(a,s.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=io(s,r.mode,h)).return=r,r=a}return o(r);case v:return e(r,a,(A=s._init)(s._payload),h)}if(M(s))return y(r,a,s,h);if(w(s))return b(r,a,s,h);nr(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,s)).return=r,r=a):(n(r,a),(a=ro(s,r.mode,h)).return=r,r=a),o(r)):n(r,a)}}var ar=ir(!0),sr=ir(!1),or={},lr=st(or),cr=st(or),ur=st(or);function hr(e){if(e===or)throw Error(s(174));return e}function dr(e,t){lt(ur,t),lt(cr,e),lt(lr,or),e=R(t),ot(lr),lt(lr,e)}function Ar(){ot(lr),ot(cr),ot(ur)}function pr(e){var t=hr(ur.current),n=hr(lr.current);n!==(t=L(n,e.type,t))&&(lt(cr,e),lt(lr,t))}function fr(e){cr.current===e&&(ot(lr),ot(cr))}var gr=st(0);function mr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Pe(n)||Ue(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yr=[];function vr(){for(var e=0;e<yr.length;e++){var t=yr[e];q?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yr.length=0}var br=o.ReactCurrentDispatcher,xr=o.ReactCurrentBatchConfig,wr=0,_r=null,Sr=null,Cr=null,Er=!1,Nr=!1,kr=0,Ir=0;function Tr(){throw Error(s(321))}function Br(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Gt(e[n],t[n]))return!1;return!0}function Mr(e,t,n,r,i,a){if(wr=a,_r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,br.current=null===e||null===e.memoizedState?pi:fi,e=n(r,i),Nr){a=0;do{if(Nr=!1,kr=0,25<=a)throw Error(s(301));a+=1,Cr=Sr=null,t.updateQueue=null,br.current=gi,e=n(r,i)}while(Nr)}if(br.current=Ai,t=null!==Sr&&null!==Sr.next,wr=0,Cr=Sr=_r=null,Er=!1,t)throw Error(s(300));return e}function Fr(){var e=0!==kr;return kr=0,e}function Rr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e,Cr}function Lr(){if(null===Sr){var e=_r.alternate;e=null!==e?e.memoizedState:null}else e=Sr.next;var t=null===Cr?_r.memoizedState:Cr.next;if(null!==t)Cr=t,Sr=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Sr=e).memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e}return Cr}function Pr(e,t){return"function"===typeof t?t(e):t}function Ur(e){var t=Lr(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Sr,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((wr&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=r):c=c.next=d,_r.lanes|=h,ts|=h}u=u.next}while(null!==u&&u!==a);null===c?o=r:c.next=l,Gt(r,t.memoizedState)||(Pi=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,_r.lanes|=a,ts|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Dr(e){var t=Lr(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);Gt(a,t.memoizedState)||(Pi=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Or(){}function jr(e,t){var n=_r,r=Lr(),i=t(),a=!Gt(r.memoizedState,i);if(a&&(r.memoizedState=i,Pi=!0),r=r.queue,Jr(Qr.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==Cr&&1&Cr.memoizedState.tag){if(n.flags|=2048,Wr(9,Hr.bind(null,n,r,i,t),void 0,null),null===Ka)throw Error(s(349));0!==(30&wr)||zr(n,t,i)}return i}function zr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Hr(e,t,n,r){t.value=n,t.getSnapshot=r,Vr(t)&&ws(e,1,-1)}function Qr(e,t,n){return n(function(){Vr(t)&&ws(e,1,-1)})}function Vr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Gt(e,n)}catch(r){return!0}}function Gr(e){var t=Rr();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:e},t.queue=e,e=e.dispatch=li.bind(null,_r,e),[t.memoizedState,e]}function Wr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function qr(){return Lr().memoizedState}function Kr(e,t,n,r){var i=Rr();_r.flags|=e,i.memoizedState=Wr(1|t,n,void 0,void 0===r?null:r)}function Xr(e,t,n,r){var i=Lr();r=void 0===r?null:r;var a=void 0;if(null!==Sr){var s=Sr.memoizedState;if(a=s.destroy,null!==r&&Br(r,s.deps))return void(i.memoizedState=Wr(t,n,a,r))}_r.flags|=e,i.memoizedState=Wr(1|t,n,a,r)}function Yr(e,t){return Kr(8390656,8,e,t)}function Jr(e,t){return Xr(2048,8,e,t)}function Zr(e,t){return Xr(4,2,e,t)}function $r(e,t){return Xr(4,4,e,t)}function ei(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ti(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Xr(4,4,ei.bind(null,t,e),n)}function ni(){}function ri(e,t){var n=Lr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Br(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ii(e,t){var n=Lr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Br(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ai(e,t){var n=Mt;Mt=0!==n&&4>n?n:4,e(!0);var r=xr.transition;xr.transition={};try{e(!1),t()}finally{Mt=n,xr.transition=r}}function si(){return Lr().memoizedState}function oi(e,t,n){var r=xs(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ci(e)?ui(t,n):(hi(e,t,n),null!==(e=ws(e,r,n=bs()))&&di(e,t,r))}function li(e,t,n){var r=xs(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ci(e))ui(t,i);else{hi(e,t,i);var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,Gt(o,s))return}catch(l){}null!==(e=ws(e,r,n=bs()))&&di(e,t,r)}}function ci(e){var t=e.alternate;return e===_r||null!==t&&t===_r}function ui(e,t){Nr=Er=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hi(e,t,n){null!==Ka&&0!==(1&e.mode)&&0===(2&qa)?(null===(e=t.interleaved)?(n.next=n,null===dn?dn=[t]:dn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function di(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Bt(e,n)}}var Ai={readContext:hn,useCallback:Tr,useContext:Tr,useEffect:Tr,useImperativeHandle:Tr,useInsertionEffect:Tr,useLayoutEffect:Tr,useMemo:Tr,useReducer:Tr,useRef:Tr,useState:Tr,useDebugValue:Tr,useDeferredValue:Tr,useTransition:Tr,useMutableSource:Tr,useSyncExternalStore:Tr,useId:Tr,unstable_isNewReconciler:!1},pi={readContext:hn,useCallback:function(e,t){return Rr().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Yr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Kr(4194308,4,ei.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Kr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kr(4,2,e,t)},useMemo:function(e,t){var n=Rr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Rr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=oi.bind(null,_r,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Rr().memoizedState=e},useState:Gr,useDebugValue:ni,useDeferredValue:function(e){var t=Gr(e),n=t[0],r=t[1];return Yr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){var e=Gr(!1),t=e[0];return e=ai.bind(null,e[1]),Rr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=_r,i=Rr();if(Vn){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Ka)throw Error(s(349));0!==(30&wr)||zr(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Yr(Qr.bind(null,r,a,e),[e]),r.flags|=2048,Wr(9,Hr.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Rr(),t=Ka.identifierPrefix;if(Vn){var n=Un;t=":"+t+"R"+(n=(Pn&~(1<<32-bt(Pn)-1)).toString(32)+n),0<(n=kr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ir++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},fi={readContext:hn,useCallback:ri,useContext:hn,useEffect:Jr,useImperativeHandle:ti,useInsertionEffect:Zr,useLayoutEffect:$r,useMemo:ii,useReducer:Ur,useRef:qr,useState:function(){return Ur(Pr)},useDebugValue:ni,useDeferredValue:function(e){var t=Ur(Pr),n=t[0],r=t[1];return Jr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){return[Ur(Pr)[0],Lr().memoizedState]},useMutableSource:Or,useSyncExternalStore:jr,useId:si,unstable_isNewReconciler:!1},gi={readContext:hn,useCallback:ri,useContext:hn,useEffect:Jr,useImperativeHandle:ti,useInsertionEffect:Zr,useLayoutEffect:$r,useMemo:ii,useReducer:Dr,useRef:qr,useState:function(){return Dr(Pr)},useDebugValue:ni,useDeferredValue:function(e){var t=Dr(Pr),n=t[0],r=t[1];return Jr(function(){var t=xr.transition;xr.transition={};try{r(e)}finally{xr.transition=t}},[e]),n},useTransition:function(){return[Dr(Pr)[0],Lr().memoizedState]},useMutableSource:Or,useSyncExternalStore:jr,useId:si,unstable_isNewReconciler:!1};function mi(e,t){try{var n="",r=t;do{n+=$t(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i}}function yi(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var vi,bi,xi,wi,_i="function"===typeof WeakMap?WeakMap:Map;function Si(e,t,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){us||(us=!0,hs=r),yi(0,t)},n}function Ci(e,t,n){(n=gn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){yi(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){yi(0,t),"function"!==typeof r&&(null===ds?ds=new Set([this]):ds.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Ei(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new _i;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Gs.bind(null,e,t,n),t.then(e,e))}function Ni(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ki(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=gn(-1,1)).tag=2,mn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}function Ii(e){e.flags|=4}function Ti(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(K)vi=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)O(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},bi=function(){},xi=function(e,t,n,r,i){if((e=e.memoizedProps)!==r){var a=t.stateNode,s=hr(lr.current);n=z(a,n,e,r,i,s),(t.updateQueue=n)&&Ii(t)}},wi=function(e,t,n,r){n!==r&&Ii(t)};else if(X){vi=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var a=i.stateNode;n&&r&&(a=Be(a,i.type,i.memoizedProps,i)),O(e,a)}else if(6===i.tag)a=i.stateNode,n&&r&&(a=Me(a,i.memoizedProps,i)),O(e,a);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(a=i.child)&&(a.return=i),vi(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var Bi=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var a=i.stateNode;n&&r&&(a=Be(a,i.type,i.memoizedProps,i)),ke(e,a)}else if(6===i.tag)a=i.stateNode,n&&r&&(a=Me(a,i.memoizedProps,i)),ke(e,a);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(a=i.child)&&(a.return=i),Bi(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};bi=function(e,t){var n=t.stateNode;if(!Ti(e,t)){e=n.containerInfo;var r=Ne(e);Bi(r,t,!1,!1),n.pendingChildren=r,Ii(t),Ie(e,r)}},xi=function(e,t,n,r,i){var a=e.stateNode,s=e.memoizedProps;if((e=Ti(e,t))&&s===r)t.stateNode=a;else{var o=t.stateNode,l=hr(lr.current),c=null;s!==r&&(c=z(o,n,s,r,i,l)),e&&null===c?t.stateNode=a:(a=Ee(a,c,n,s,r,t,e,o),j(a,n,r,i,l)&&Ii(t),t.stateNode=a,e?Ii(t):vi(a,t,!1,!1))}},wi=function(e,t,n,r){n!==r?(e=hr(ur.current),n=hr(lr.current),t.stateNode=Q(r,e,n,t),Ii(t)):t.stateNode=e.stateNode}}else bi=function(){},xi=function(){},wi=function(){};function Mi(e,t){if(!Vn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Fi(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ri(e,t,n){var r=t.pendingProps;switch(zn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(t),null;case 1:case 17:return pt(t.type)&&ft(),Fi(t),null;case 3:return r=t.stateNode,Ar(),ot(ht),ot(ut),vr(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Zn(t)?Ii(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Wn&&(Ns(Wn),Wn=null))),bi(e,t),Fi(t),null;case 5:fr(t),n=hr(ur.current);var i=t.type;if(null!==e&&null!=t.stateNode)xi(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Fi(t),null}if(e=hr(lr.current),Zn(t)){if(!Y)throw Error(s(175));e=Qe(t.stateNode,t.type,t.memoizedProps,n,e,t,!Gn),t.updateQueue=e,null!==e&&Ii(t)}else{var a=D(i,r,n,e,t);vi(a,t,!1,!1),t.stateNode=a,j(a,i,r,n,e)&&Ii(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Fi(t),null;case 6:if(e&&null!=t.stateNode)wi(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(e=hr(ur.current),n=hr(lr.current),Zn(t)){if(!Y)throw Error(s(176));if(e=t.stateNode,r=t.memoizedProps,(n=Ve(e,r,t,!Gn))&&null!==(i=Hn))switch(a=0!==(1&i.mode),i.tag){case 3:Ze(i.stateNode.containerInfo,e,r,a);break;case 5:$e(i.type,i.memoizedProps,i.stateNode,e,r,a)}n&&Ii(t)}else t.stateNode=Q(r,e,n,t)}return Fi(t),null;case 13:if(ot(gr),r=t.memoizedState,Vn&&null!==Qn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Qn;e;)e=Oe(e);return $n(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Zn(t),null===e){if(!r)throw Error(s(318));if(!Y)throw Error(s(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(317));Ge(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Fi(t),null}return null!==Wn&&(Ns(Wn),Wn=null),0!==(128&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Zn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&gr.current)?0===$a&&($a=3):Ls())),null!==t.updateQueue&&(t.flags|=4),Fi(t),null);case 4:return Ar(),bi(e,t),null===e&&Z(t.stateNode.containerInfo),Fi(t),null;case 10:return ln(t.type._context),Fi(t),null;case 19:if(ot(gr),null===(i=t.memoizedState))return Fi(t),null;if(r=0!==(128&t.flags),null===(a=i.rendering))if(r)Mi(i,!1);else{if(0!==$a||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=mr(e))){for(t.flags|=128,Mi(i,!1),null!==(e=a.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)i=e,(n=r).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,i=a.dependencies,n.dependencies=null===i?null:{lanes:i.lanes,firstContext:i.firstContext}),r=r.sibling;return lt(gr,1&gr.current|2),t.child}e=e.sibling}null!==i.tail&&Dt()>os&&(t.flags|=128,r=!0,Mi(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=mr(a))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Mi(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate&&!Vn)return Fi(t),null}else 2*Dt()-i.renderingStartTime>os&&1073741824!==n&&(t.flags|=128,r=!0,Mi(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=i.last)?e.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Dt(),t.sibling=null,e=gr.current,lt(gr,r?1&e|2:1&e),t):(Fi(t),null);case 22:case 23:return Bs(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ja)&&(Fi(t),K&&6&t.subtreeFlags&&(t.flags|=8192)):Fi(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}var Li=o.ReactCurrentOwner,Pi=!1;function Ui(e,t,n,r){t.child=null===e?sr(t,null,n,r):ar(t,e.child,n,r)}function Di(e,t,n,r,i){n=n.render;var a=t.ref;return un(t,i),r=Mr(e,t,n,r,a,i),n=Fr(),null===e||Pi?(Vn&&n&&jn(t),t.flags|=1,Ui(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ia(e,t,i))}function Oi(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Zs(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=eo(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ji(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:Zt)(s,r)&&e.ref===t.ref)return ia(e,t,i)}return t.flags|=1,(e=$s(a,r)).ref=t.ref,e.return=t,t.child=e}function ji(e,t,n,r,i){if(null!==e&&Zt(e.memoizedProps,r)&&e.ref===t.ref){if(Pi=!1,0===(e.lanes&i))return t.lanes=e.lanes,ia(e,t,i);0!==(131072&e.flags)&&(Pi=!0)}return Qi(e,t,n,r,i)}function zi(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},lt(Za,Ja),Ja|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Za,Ja),Ja|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==a?a.baseLanes:n,lt(Za,Ja),Ja|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,lt(Za,Ja),Ja|=r;return Ui(e,t,i,n),t.child}function Hi(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Qi(e,t,n,r,i){var a=pt(n)?dt:ut.current;return a=At(t,a),un(t,i),n=Mr(e,t,n,r,a,i),r=Fr(),null===e||Pi?(Vn&&r&&jn(t),t.flags|=1,Ui(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ia(e,t,i))}function Vi(e,t,n,r,i){if(pt(n)){var a=!0;yt(t)}else a=!1;if(un(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),En(t,n,r),kn(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=At(t,c=pt(n)?dt:ut.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==r||l!==c)&&Nn(t,s,r,c),An=!1;var d=t.memoizedState;s.state=d,bn(t,r,s,i),l=t.memoizedState,o!==r||d!==l||ht.current||An?("function"===typeof u&&(_n(t,n,u,r),l=t.memoizedState),(o=An||Cn(t,n,o,r,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,fn(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:en(t.type,o),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=At(t,l=pt(n)?dt:ut.current);var A=n.getDerivedStateFromProps;(u="function"===typeof A||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==h||d!==l)&&Nn(t,s,r,l),An=!1,d=t.memoizedState,s.state=d,bn(t,r,s,i);var p=t.memoizedState;o!==h||d!==p||ht.current||An?("function"===typeof A&&(_n(t,n,A,r),p=t.memoizedState),(c=An||Cn(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Gi(e,t,n,r,a,i)}function Gi(e,t,n,r,i,a){Hi(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&vt(t,n,!1),ia(e,t,a);r=t.stateNode,Li.current=t;var o=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=ar(t,e.child,null,a),t.child=ar(t,null,o,a)):Ui(e,t,o,a),t.memoizedState=r.state,i&&vt(t,n,!0),t.child}function Wi(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),dr(e,t.containerInfo)}function qi(e,t,n,r,i){return $n(),er(i),t.flags|=256,Ui(e,t,n,r),t.child}var Ki={dehydrated:null,treeContext:null,retryLane:0};function Xi(e){return{baseLanes:e,cachePool:null}}function Yi(e,t,n){var r,i=t.pendingProps,a=gr.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),lt(gr,1&a),null===e)return Yn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Ue(e)?t.lanes=8:t.lanes=1073741824,null):(a=i.children,e=i.fallback,o?(i=t.mode,o=t.child,a={mode:"hidden",children:a},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=a):o=no(a,i,0,null),e=to(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Xi(n),t.memoizedState=Ki,e):Ji(t,a));if(null!==(a=e.memoizedState)){if(null!==(r=a.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,ea(e,t,n,Error(s(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,a=t.mode,i=no({mode:"visible",children:i.children},a,0,null),(o=to(o,a,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&ar(t,e.child,null,n),t.child.memoizedState=Xi(n),t.memoizedState=Ki,o);if(0===(1&t.mode))t=ea(e,t,n,null);else if(Ue(r))t=ea(e,t,n,Error(s(419)));else if(i=0!==(n&e.childLanes),Pi||i){if(null!==(i=Ka)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(i=0!==(o&(i.suspendedLanes|n))?0:o)&&i!==a.retryLane&&(a.retryLane=i,ws(e,i,-1))}Ls(),t=ea(e,t,n,Error(s(421)))}else Pe(r)?(t.flags|=128,t.child=e.child,t=qs.bind(null,e),De(r,t),t=null):(n=a.treeContext,Y&&(Qn=He(r),Hn=t,Vn=!0,Wn=null,Gn=!1,null!==n&&(Fn[Rn++]=Pn,Fn[Rn++]=Un,Fn[Rn++]=Ln,Pn=n.id,Un=n.overflow,Ln=t)),(t=Ji(t,t.pendingProps.children)).flags|=4096);return t}return o?(i=$i(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?Xi(n):{baseLanes:a.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Ki,i):(n=Zi(e,t,i.children,n),t.memoizedState=null,n)}return o?(i=$i(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?Xi(n):{baseLanes:a.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Ki,i):(n=Zi(e,t,i.children,n),t.memoizedState=null,n)}function Ji(e,t){return(t=no({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Zi(e,t,n,r){var i=e.child;return e=i.sibling,n=$s(i,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function $i(e,t,n,r,i){var a=t.mode,s=(e=e.child).sibling,o={mode:"hidden",children:n};return 0===(1&a)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null):(n=$s(e,o)).subtreeFlags=14680064&e.subtreeFlags,null!==s?r=$s(s,r):(r=to(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ea(e,t,n,r){return null!==r&&er(r),ar(t,e.child,null,n),(e=Ji(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ta(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cn(e.return,t,n)}function na(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function ra(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Ui(e,t,r.children,n),0!==(2&(r=gr.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ta(e,n,t);else if(19===e.tag)ta(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(lt(gr,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===mr(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),na(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===mr(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}na(t,!0,n,null,a);break;case"together":na(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ia(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ts|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=$s(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=$s(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function aa(e,t){switch(zn(t),t.tag){case 1:return pt(t.type)&&ft(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ar(),ot(ht),ot(ut),vr(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return fr(t),null;case 13:if(ot(gr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ot(gr),null;case 4:return Ar(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Bs(),null;default:return null}}var sa=!1,oa=!1,la="function"===typeof WeakSet?WeakSet:Set,ca=null;function ua(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Vs(e,t,r)}else n.current=null}function ha(e,t,n){try{n()}catch(r){Vs(e,t,r)}}var da=!1;function Aa(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&ha(t,n,a)}i=i.next}while(i!==r)}}function pa(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function fa(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=F(n);else e=n;"function"===typeof t?t(e):t.current=e}}function ga(e,t,n){if(Vt&&"function"===typeof Vt.onCommitFiberUnmount)try{Vt.onCommitFiberUnmount(Qt,t)}catch(s){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var i=r,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&ha(t,n,a),r=r.next}while(r!==e)}break;case 1:if(ua(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(s){Vs(t,n,s)}break;case 5:ua(t,n);break;case 4:K?Sa(e,t,n):X&&X&&(t=t.stateNode.containerInfo,n=Ne(t),Te(t,n))}}function ma(e,t,n){for(var r=t;;)if(ga(e,r,n),null===r.child||K&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function ya(e){var t=e.alternate;null!==t&&(e.alternate=null,ya(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function va(e){return 5===e.tag||3===e.tag||4===e.tag}function ba(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||va(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function xa(e){if(K){e:{for(var t=e.return;null!==t;){if(va(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(be(t),n.flags&=-33),_a(e,n=ba(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,wa(e,n=ba(e),t);break;default:throw Error(s(161))}}}function wa(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?me(n,e,t):de(n,e);else if(4!==r&&null!==(e=e.child))for(wa(e,t,n),e=e.sibling;null!==e;)wa(e,t,n),e=e.sibling}function _a(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(_a(e,t,n),e=e.sibling;null!==e;)_a(e,t,n),e=e.sibling}function Sa(e,t,n){for(var r,i,a=t,o=!1;;){if(!o){o=a.return;e:for(;;){if(null===o)throw Error(s(160));switch(r=o.stateNode,o.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}o=o.return}o=!0}if(5===a.tag||6===a.tag)ma(e,a,n),i?ve(r,a.stateNode):ye(r,a.stateNode);else if(18===a.tag)i?Ye(r,a.stateNode):Xe(r,a.stateNode);else if(4===a.tag){if(null!==a.child){r=a.stateNode.containerInfo,i=!0,a.child.return=a,a=a.child;continue}}else if(ga(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(o=!1)}a.sibling.return=a.return,a=a.sibling}}function Ca(e,t){if(K){switch(t.tag){case 0:case 11:case 14:case 15:return Aa(3,t,t.return),pa(3,t),void Aa(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&fe(n,a,i,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return n=t.memoizedProps,void Ae(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Y&&null!==e&&e.memoizedState.isDehydrated&&qe(t.stateNode.containerInfo));case 13:case 19:return void Ea(t)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:return Aa(3,t,t.return),pa(3,t),void Aa(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ea(t);case 3:Y&&null!==e&&e.memoizedState.isDehydrated&&qe(t.stateNode.containerInfo)}e:if(X){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Te(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Ea(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new la),t.forEach(function(t){var r=Ks.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function Na(e,t,n){ca=e,ka(e,t,n)}function ka(e,t,n){for(var r=0!==(1&e.mode);null!==ca;){var i=ca,a=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||sa;if(!s){var o=i.alternate,l=null!==o&&null!==o.memoizedState||oa;o=sa;var c=oa;if(sa=s,(oa=l)&&!c)for(ca=i;null!==ca;)l=(s=ca).child,22===s.tag&&null!==s.memoizedState?Ba(i):null!==l?(l.return=s,ca=l):Ba(i);for(;null!==a;)ca=a,ka(a,t,n),a=a.sibling;ca=i,sa=o,oa=c}Ia(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,ca=a):Ia(e)}}function Ia(e){for(;null!==ca;){var t=ca;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:oa||pa(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!oa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&xn(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=F(t.child.stateNode);break;case 1:n=t.child.stateNode}xn(t,o,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&pe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Y&&null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Ke(h)}}}break;default:throw Error(s(163))}oa||512&t.flags&&fa(t)}catch(d){Vs(t,t.return,d)}}if(t===e){ca=null;break}if(null!==(n=t.sibling)){n.return=t.return,ca=n;break}ca=t.return}}function Ta(e){for(;null!==ca;){var t=ca;if(t===e){ca=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ca=n;break}ca=t.return}}function Ba(e){for(;null!==ca;){var t=ca;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pa(4,t)}catch(l){Vs(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Vs(t,i,l)}}var a=t.return;try{fa(t)}catch(l){Vs(t,a,l)}break;case 5:var s=t.return;try{fa(t)}catch(l){Vs(t,s,l)}}}catch(l){Vs(t,t.return,l)}if(t===e){ca=null;break}var o=t.sibling;if(null!==o){o.return=t.return,ca=o;break}ca=t.return}}var Ma=0,Fa=1,Ra=2,La=3,Pa=4;if("function"===typeof Symbol&&Symbol.for){var Ua=Symbol.for;Ma=Ua("selector.component"),Fa=Ua("selector.has_pseudo_class"),Ra=Ua("selector.role"),La=Ua("selector.test_id"),Pa=Ua("selector.text")}function Da(e){var t=J(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=ie(e)))throw Error(s(362));return e.stateNode.current}function Oa(e,t){switch(t.$$typeof){case Ma:if(e.type===t.value)return!0;break;case Fa:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],i=e[n++],a=t[i];if(5!==r.tag||!oe(r)){for(;null!=a&&Oa(r,a);)a=t[++i];if(i===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,i),r=r.sibling}}t=!1}return t;case Ra:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case Pa:if((5===e.tag||6===e.tag)&&(null!==(e=se(e))&&0<=e.indexOf(t.value)))return!0;break;case La:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function ja(e){switch(e.$$typeof){case Ma:return"<"+(_(e.value)||"Unknown")+">";case Fa:return":has("+(ja(e)||"")+")";case Ra:return'[role="'+e.value+'"]';case Pa:return'"'+e.value+'"';case La:return'[data-testname="'+e.value+'"]';default:throw Error(s(365))}}function za(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var i=e[r++],a=e[r++],s=t[a];if(5!==i.tag||!oe(i)){for(;null!=s&&Oa(i,s);)s=t[++a];if(a===t.length)n.push(i);else for(i=i.child;null!==i;)e.push(i,a),i=i.sibling}}return n}function Ha(e,t){if(!re)throw Error(s(363));e=za(e=Da(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)oe(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Qa=Math.ceil,Va=o.ReactCurrentDispatcher,Ga=o.ReactCurrentOwner,Wa=o.ReactCurrentBatchConfig,qa=0,Ka=null,Xa=null,Ya=0,Ja=0,Za=st(0),$a=0,es=null,ts=0,ns=0,rs=0,is=null,as=null,ss=0,os=1/0;function ls(){os=Dt()+500}var cs,us=!1,hs=null,ds=null,As=!1,ps=null,fs=0,gs=0,ms=null,ys=-1,vs=0;function bs(){return 0!==(6&qa)?Dt():-1!==ys?ys:ys=Dt()}function xs(e){return 0===(1&e.mode)?1:0!==(2&qa)&&0!==Ya?Ya&-Ya:null!==Jt.transition?(0===vs&&(e=_t,0===(4194240&(_t<<=1))&&(_t=64),vs=e),vs):0!==(e=Mt)?e:$()}function ws(e,t,n){if(50<gs)throw gs=0,ms=null,Error(s(185));var r=_s(e,t);return null===r?null:(Tt(r,t,n),0!==(2&qa)&&r===Ka||(r===Ka&&(0===(2&qa)&&(ns|=t),4===$a&&ks(r,Ya)),Ss(r,n),1===t&&0===qa&&0===(1&e.mode)&&(ls(),qt&&Yt())),r)}function _s(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ss(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-bt(a),o=1<<s,l=i[s];-1===l?0!==(o&n)&&0===(o&r)||(i[s]=Nt(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var r=Et(e,e===Ka?Ya:0);if(0===r)null!==n&&Lt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Lt(n),1===t)0===e.tag?function(e){qt=!0,Xt(e)}(Is.bind(null,e)):Xt(Is.bind(null,e)),te?ne(function(){0===qa&&Yt()}):Rt(Ot,Yt),n=null;else{switch(Ft(r)){case 1:n=Ot;break;case 4:n=jt;break;case 16:default:n=zt;break;case 536870912:n=Ht}n=Xs(n,Cs.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Cs(e,t){if(ys=-1,vs=0,0!==(6&qa))throw Error(s(327));var n=e.callbackNode;if(Hs()&&e.callbackNode!==n)return null;var r=Et(e,e===Ka?Ya:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Ps(e,r);else{t=r;var i=qa;qa|=2;var a=Rs();for(Ka===e&&Ya===t||(ls(),Ms(e,t));;)try{Ds();break}catch(l){Fs(e,l)}sn(),Va.current=a,qa=i,null!==Xa?t=0:(Ka=null,Ya=0,t=$a)}if(0!==t){if(2===t&&(0!==(i=kt(e))&&(r=i,t=Es(e,i))),1===t)throw n=es,Ms(e,0),ks(e,r),Ss(e,Dt()),n;if(6===t)ks(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Gt(a(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=Ps(e,r))&&(0!==(a=kt(e))&&(r=a,t=Es(e,a))),1===t))throw n=es,Ms(e,0),ks(e,r),Ss(e,Dt()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:zs(e,as);break;case 3:if(ks(e,r),(130023424&r)===r&&10<(t=ss+500-Dt())){if(0!==Et(e,0))break;if(((i=e.suspendedLanes)&r)!==r){bs(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=V(zs.bind(null,e,as),t);break}zs(e,as);break;case 4:if(ks(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-bt(r);a=1<<o,(o=t[o])>i&&(i=o),r&=~a}if(r=i,10<(r=(120>(r=Dt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Qa(r/1960))-r)){e.timeoutHandle=V(zs.bind(null,e,as),r);break}zs(e,as);break;default:throw Error(s(329))}}}return Ss(e,Dt()),e.callbackNode===n?Cs.bind(null,e):null}function Es(e,t){var n=is;return e.current.memoizedState.isDehydrated&&(Ms(e,t).flags|=256),2!==(e=Ps(e,t))&&(t=as,as=n,null!==t&&Ns(t)),e}function Ns(e){null===as?as=e:as.push.apply(as,e)}function ks(e,t){for(t&=~rs,t&=~ns,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-bt(t),r=1<<n;e[n]=-1,t&=~r}}function Is(e){if(0!==(6&qa))throw Error(s(327));Hs();var t=Et(e,0);if(0===(1&t))return Ss(e,Dt()),null;var n=Ps(e,t);if(0!==e.tag&&2===n){var r=kt(e);0!==r&&(t=r,n=Es(e,r))}if(1===n)throw n=es,Ms(e,0),ks(e,t),Ss(e,Dt()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,zs(e,as),Ss(e,Dt()),null}function Ts(e){null!==ps&&0===ps.tag&&0===(6&qa)&&Hs();var t=qa;qa|=1;var n=Wa.transition,r=Mt;try{if(Wa.transition=null,Mt=1,e)return e()}finally{Mt=r,Wa.transition=n,0===(6&(qa=t))&&Yt()}}function Bs(){Ja=Za.current,ot(Za)}function Ms(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==W&&(e.timeoutHandle=W,G(n)),null!==Xa)for(n=Xa.return;null!==n;){var r=n;switch(zn(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&ft();break;case 3:Ar(),ot(ht),ot(ut),vr();break;case 5:fr(r);break;case 4:Ar();break;case 13:case 19:ot(gr);break;case 10:ln(r.type._context);break;case 22:case 23:Bs()}n=n.return}if(Ka=e,Xa=e=$s(e.current,null),Ya=Ja=t,$a=0,es=null,rs=ns=ts=0,as=is=null,null!==dn){for(t=0;t<dn.length;t++)if(null!==(r=(n=dn[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var s=a.next;a.next=i,r.next=s}n.pending=r}dn=null}return e}function Fs(e,t){for(;;){var n=Xa;try{if(sn(),br.current=Ai,Er){for(var r=_r.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Er=!1}if(wr=0,Cr=Sr=_r=null,Nr=!1,kr=0,Ga.current=null,null===n||null===n.return){$a=1,es=t,Xa=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Ya,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var A=h.alternate;A?(h.updateQueue=A.updateQueue,h.memoizedState=A.memoizedState,h.lanes=A.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Ni(o);if(null!==p){p.flags&=-257,ki(p,o,l,0,t),1&p.mode&&Ei(a,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){Ei(a,u,t),Ls();break e}c=Error(s(426))}else if(Vn&&1&l.mode){var m=Ni(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),ki(m,o,l,0,t),er(c);break e}}a=c,4!==$a&&($a=2),null===is?is=[a]:is.push(a),c=mi(c,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,vn(l,Si(0,c,t));break e;case 1:a=c;var y=l.type,v=l.stateNode;if(0===(128&l.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===ds||!ds.has(v)))){l.flags|=65536,t&=-t,l.lanes|=t,vn(l,Ci(l,a,t));break e}}l=l.return}while(null!==l)}js(n)}catch(b){t=b,Xa===n&&null!==n&&(Xa=n=n.return);continue}break}}function Rs(){var e=Va.current;return Va.current=Ai,null===e?Ai:e}function Ls(){0!==$a&&3!==$a&&2!==$a||($a=4),null===Ka||0===(268435455&ts)&&0===(268435455&ns)||ks(Ka,Ya)}function Ps(e,t){var n=qa;qa|=2;var r=Rs();for(Ka===e&&Ya===t||Ms(e,t);;)try{Us();break}catch(i){Fs(e,i)}if(sn(),qa=n,Va.current=r,null!==Xa)throw Error(s(261));return Ka=null,Ya=0,$a}function Us(){for(;null!==Xa;)Os(Xa)}function Ds(){for(;null!==Xa&&!Pt();)Os(Xa)}function Os(e){var t=cs(e.alternate,e,Ja);e.memoizedProps=e.pendingProps,null===t?js(e):Xa=t,Ga.current=null}function js(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ri(n,t,Ja)))return void(Xa=n)}else{if(null!==(n=aa(n,t)))return n.flags&=32767,void(Xa=n);if(null===e)return $a=6,void(Xa=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Xa=t);Xa=t=e}while(null!==t);0===$a&&($a=5)}function zs(e,t){var n=Mt,r=Wa.transition;try{Wa.transition=null,Mt=1,function(e,t,n){do{Hs()}while(null!==ps);if(0!==(6&qa))throw Error(s(327));var r=e.finishedWork,i=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-bt(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,a),e===Ka&&(Xa=Ka=null,Ya=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||As||(As=!0,Xs(zt,function(){return Hs(),null})),a=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||a){a=Wa.transition,Wa.transition=null;var o=Mt;Mt=1;var l=qa;qa|=4,Ga.current=null,function(e,t){for(P(e.containerInfo),ca=t;null!==ca;)if(t=(e=ca).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,ca=t;else for(;null!==ca;){e=ca;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,i=n.memoizedState,a=e.stateNode,o=a.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),i);a.__reactInternalSnapshotBeforeUpdate=o}break;case 3:K&&Ce(e.stateNode.containerInfo);break;default:throw Error(s(163))}}catch(l){Vs(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,ca=t;break}ca=e.return}n=da,da=!1}(e,r),function(e,t){for(ca=t;null!==ca;){var n=(t=ca).deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e;K?Sa(a,i,t):ma(a,i,t);var s=i.alternate;null!==s&&(s.return=null),i.return=null}catch(x){Vs(i,t,x)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,ca=n;else for(;null!==ca;){t=ca;try{var o=t.flags;if(32&o&&K&&be(t.stateNode),512&o){var l=t.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(ss=Dt())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,A=null!==d&&null!==d.memoizedState;if(n=t,K)e:if(r=n,i=h,a=null,K)for(var p=r;;){if(5===p.tag){if(null===a){a=p;var f=p.stateNode;i?xe(f):_e(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===a){var g=p.stateNode;i?we(g):Se(g,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;a===p&&(a=null),p=p.return}a===p&&(a=null),p.sibling.return=p.return,p=p.sibling}if(h&&!A&&0!==(1&n.mode)){ca=n;for(var m=n.child;null!==m;){for(n=ca=m;null!==ca;){var y=(r=ca).child;switch(r.tag){case 0:case 11:case 14:case 15:Aa(4,r,r.return);break;case 1:ua(r,r.return);var v=r.stateNode;if("function"===typeof v.componentWillUnmount){var b=r.return;try{v.props=r.memoizedProps,v.state=r.memoizedState,v.componentWillUnmount()}catch(x){Vs(r,b,x)}}break;case 5:ua(r,r.return);break;case 22:if(null!==r.memoizedState){Ta(n);continue}}null!==y?(y.return=r,ca=y):Ta(n)}m=m.sibling}}}switch(4102&o){case 2:xa(t),t.flags&=-3;break;case 6:xa(t),t.flags&=-3,Ca(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ca(t.alternate,t);break;case 4:Ca(t.alternate,t)}}catch(x){Vs(t,t.return,x)}if(null!==(n=t.sibling)){n.return=t.return,ca=n;break}ca=t.return}}}(e,r),U(e.containerInfo),e.current=r,Na(r,e,i),Ut(),qa=l,Mt=o,Wa.transition=a}else e.current=r;if(As&&(As=!1,ps=e,fs=i),a=e.pendingLanes,0===a&&(ds=null),function(e){if(Vt&&"function"===typeof Vt.onCommitFiberRoot)try{Vt.onCommitFiberRoot(Qt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),Ss(e,Dt()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(us)throw us=!1,e=hs,hs=null,e;0!==(1&fs)&&0!==e.tag&&Hs(),a=e.pendingLanes,0!==(1&a)?e===ms?gs++:(gs=0,ms=e):gs=0,Yt()}(e,t,n)}finally{Wa.transition=r,Mt=n}return null}function Hs(){if(null!==ps){var e=Ft(fs),t=Wa.transition,n=Mt;try{if(Wa.transition=null,Mt=16>e?16:e,null===ps)var r=!1;else{if(e=ps,ps=null,fs=0,0!==(6&qa))throw Error(s(331));var i=qa;for(qa|=4,ca=e.current;null!==ca;){var a=ca,o=a.child;if(0!==(16&ca.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(ca=u;null!==ca;){var h=ca;switch(h.tag){case 0:case 11:case 15:Aa(8,h,a)}var d=h.child;if(null!==d)d.return=h,ca=d;else for(;null!==ca;){var A=(h=ca).sibling,p=h.return;if(ya(h),h===u){ca=null;break}if(null!==A){A.return=p,ca=A;break}ca=p}}}var f=a.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}ca=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,ca=o;else e:for(;null!==ca;){if(0!==(2048&(a=ca).flags))switch(a.tag){case 0:case 11:case 15:Aa(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,ca=y;break e}ca=a.return}}var v=e.current;for(ca=v;null!==ca;){var b=(o=ca).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,ca=b;else e:for(o=v;null!==ca;){if(0!==(2048&(l=ca).flags))try{switch(l.tag){case 0:case 11:case 15:pa(9,l)}}catch(w){Vs(l,l.return,w)}if(l===o){ca=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,ca=x;break e}ca=l.return}}if(qa=i,Yt(),Vt&&"function"===typeof Vt.onPostCommitFiberRoot)try{Vt.onPostCommitFiberRoot(Qt,e)}catch(w){}r=!0}return r}finally{Mt=n,Wa.transition=t}}return!1}function Qs(e,t,n){mn(e,t=Si(0,t=mi(n,t),1)),t=bs(),null!==(e=_s(e,1))&&(Tt(e,1,t),Ss(e,t))}function Vs(e,t,n){if(3===e.tag)Qs(e,e,n);else for(;null!==t;){if(3===t.tag){Qs(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===ds||!ds.has(r))){mn(t,e=Ci(t,e=mi(n,e),1)),e=bs(),null!==(t=_s(t,1))&&(Tt(t,1,e),Ss(t,e));break}}t=t.return}}function Gs(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=bs(),e.pingedLanes|=e.suspendedLanes&n,Ka===e&&(Ya&n)===n&&(4===$a||3===$a&&(130023424&Ya)===Ya&&500>Dt()-ss?Ms(e,0):rs|=n),Ss(e,t)}function Ws(e,t){0===t&&(0===(1&e.mode)?t=1:(t=St,0===(130023424&(St<<=1))&&(St=4194304)));var n=bs();null!==(e=_s(e,t))&&(Tt(e,t,n),Ss(e,n))}function qs(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ws(e,n)}function Ks(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),Ws(e,n)}function Xs(e,t){return Rt(e,t)}function Ys(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Js(e,t,n,r){return new Ys(e,t,n,r)}function Zs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function $s(e,t){var n=e.alternate;return null===n?((n=Js(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function eo(e,t,n,r,i,a){var o=2;if(r=e,"function"===typeof e)Zs(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case u:return to(n.children,i,a,t);case h:o=8,i|=8;break;case d:return(e=Js(12,n,t,2|i)).elementType=d,e.lanes=a,e;case g:return(e=Js(13,n,t,i)).elementType=g,e.lanes=a,e;case m:return(e=Js(19,n,t,i)).elementType=m,e.lanes=a,e;case b:return no(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:o=10;break e;case p:o=9;break e;case f:o=11;break e;case y:o=14;break e;case v:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Js(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function to(e,t,n,r){return(e=Js(7,e,r,t)).lanes=n,e}function no(e,t,n,r){return(e=Js(22,e,r,t)).elementType=b,e.lanes=n,e.stateNode={},e}function ro(e,t,n){return(e=Js(6,e,null,t)).lanes=n,e}function io(e,t,n){return(t=Js(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ao(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=W,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=It(0),this.expirationTimes=It(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=It(0),this.identifierPrefix=r,this.onRecoverableError=i,Y&&(this.mutableSourceEagerHydrationData=null)}function so(e,t,n,r,i,a,s,o,l){return e=new ao(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Js(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},pn(a),e}function oo(e){if(!e)return ct;e:{if(C(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(pt(n))return mt(e,n,t)}return t}function lo(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return null===(e=k(t))?null:e.stateNode}function co(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function uo(e,t){co(e,t),(e=e.alternate)&&co(e,t)}function ho(e){return null===(e=k(e))?null:e.stateNode}function Ao(){return null}return cs=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)Pi=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Pi=!1,function(e,t,n){switch(t.tag){case 3:Wi(t),$n();break;case 5:pr(t);break;case 1:pt(t.type)&&yt(t);break;case 4:dr(t,t.stateNode.containerInfo);break;case 10:on(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(lt(gr,1&gr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Yi(e,t,n):(lt(gr,1&gr.current),null!==(e=ia(e,t,n))?e.sibling:null);lt(gr,1&gr.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ra(e,t,n);t.flags|=128}var i=t.memoizedState;if(null!==i&&(i.rendering=null,i.tail=null,i.lastEffect=null),lt(gr,gr.current),r)break;return null;case 22:case 23:return t.lanes=0,zi(e,t,n)}return ia(e,t,n)}(e,t,n);Pi=0!==(131072&e.flags)}else Pi=!1,Vn&&0!==(1048576&t.flags)&&On(t,Mn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var i=At(t,ut.current);un(t,n),i=Mr(null,t,r,e,i,n);var a=Fr();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(r)?(a=!0,yt(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,pn(t),i.updater=Sn,t.stateNode=i,i._reactInternals=t,kn(t,r,e,n),t=Gi(null,t,r,!0,a,n)):(t.tag=0,Vn&&a&&jn(t),Ui(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Zs(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===f)return 11;if(e===y)return 14}return 2}(r),e=en(r,e),i){case 0:t=Qi(null,t,r,e,n);break e;case 1:t=Vi(null,t,r,e,n);break e;case 11:t=Di(null,t,r,e,n);break e;case 14:t=Oi(null,t,r,en(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Qi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 1:return r=t.type,i=t.pendingProps,Vi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 3:e:{if(Wi(t),null===e)throw Error(s(387));r=t.pendingProps,i=(a=t.memoizedState).element,fn(e,t),bn(t,r,null,n);var o=t.memoizedState;if(r=o.element,Y&&a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=qi(e,t,r,n,i=Error(s(423)));break e}if(r!==i){t=qi(e,t,r,n,i=Error(s(424)));break e}for(Y&&(Qn=ze(t.stateNode.containerInfo),Hn=t,Vn=!0,Wn=null,Gn=!1),n=sr(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),r===i){t=ia(e,t,n);break e}Ui(e,t,r,n)}t=t.child}return t;case 5:return pr(t),null===e&&Yn(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,H(r,i)?o=null:null!==a&&H(r,a)&&(t.flags|=32),Hi(e,t),Ui(e,t,o,n),t.child;case 6:return null===e&&Yn(t),null;case 13:return Yi(e,t,n);case 4:return dr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ar(t,null,r,n):Ui(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Di(e,t,r,i=t.elementType===r?i:en(r,i),n);case 7:return Ui(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ui(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,on(0,r,o=i.value),null!==a)if(Gt(a.value,o)){if(a.children===i.children&&!ht.current){t=ia(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=gn(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),cn(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),cn(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}Ui(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,un(t,n),r=r(i=hn(i)),t.flags|=1,Ui(e,t,r,n),t.child;case 14:return i=en(r=t.type,t.pendingProps),Oi(e,t,r,i=en(r.type,i),n);case 15:return ji(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:en(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(r)?(e=!0,yt(t)):e=!1,un(t,n),En(t,r,i),kn(t,r,i,n),Gi(null,t,r,!0,e,n);case 19:return ra(e,t,n);case 22:return zi(e,t,n)}throw Error(s(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(ws(e,134217728,bs()),uo(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=bs(),n=xs(e);ws(e,n,t),uo(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ct(t.pendingLanes);0!==n&&(Bt(t,1|n),Ss(t,Dt()),0===(6&qa)&&(ls(),Yt()))}break;case 13:var r=bs();Ts(function(){return ws(e,1,r)}),uo(e,1)}},t.batchedUpdates=function(e,t){var n=qa;qa|=1;try{return e(t)}finally{0===(qa=n)&&(ls(),qt&&Yt())}},t.createComponentSelector=function(e){return{$$typeof:Ma,value:e}},t.createContainer=function(e,t,n,r,i,a,s){return so(e,t,!1,null,0,r,0,a,s)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Fa,value:e}},t.createHydrationContainer=function(e,t,n,r,i,a,s,o,l){return(e=so(n,r,!0,e,0,a,0,o,l)).context=oo(null),n=e.current,(a=gn(r=bs(),i=xs(n))).callback=void 0!==t&&null!==t?t:null,mn(n,a),e.current.lanes=i,Tt(e,i,r),Ss(e,r),e},t.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Ra,value:e}},t.createTestNameSelector=function(e){return{$$typeof:La,value:e}},t.createTextSelector=function(e){return{$$typeof:Pa,value:e}},t.deferredUpdates=function(e){var t=Mt,n=Wa.transition;try{return Wa.transition=null,Mt=16,e()}finally{Mt=t,Wa.transition=n}},t.discreteUpdates=function(e,t,n,r,i){var a=Mt,s=Wa.transition;try{return Wa.transition=null,Mt=1,e(t,n,r,i)}finally{Mt=a,Wa.transition=s,0===qa&&ls()}},t.findAllNodes=Ha,t.findBoundingRects=function(e,t){if(!re)throw Error(s(363));t=Ha(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ae(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,i=r+n.width,a=n.y,o=a+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,h=u+c.width,d=c.y,A=d+c.height;if(r>=u&&a>=d&&i<=h&&o<=A){e.splice(t,1);break}if(!(r!==u||n.width!==c.width||A<a||d>o)){d>a&&(c.height+=d-a,c.y=a),A<o&&(c.height=o-d),e.splice(t,1);break}if(!(a!==d||n.height!==c.height||h<r||u>i)){u>r&&(c.width+=u-r,c.x=r),h<i&&(c.width=i-u),e.splice(t,1);break}}return e},t.findHostInstance=lo,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=N(e))?T(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return lo(e)},t.flushControlled=function(e){var t=qa;qa|=1;var n=Wa.transition,r=Mt;try{Wa.transition=null,Mt=1,e()}finally{Mt=r,Wa.transition=n,0===(qa=t)&&(ls(),Yt())}},t.flushPassiveEffects=Hs,t.flushSync=Ts,t.focusWithin=function(e,t){if(!re)throw Error(s(363));for(t=za(e=Da(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!oe(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Mt},t.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(s(363));var n=0,r=[];e=[Da(e),0];for(var i=0;i<e.length;){var a=e[i++],o=e[i++],l=t[o];if((5!==a.tag||!oe(a))&&(Oa(a,l)&&(r.push(ja(l)),++o>n&&(n=o)),o<t.length))for(a=a.child;null!==a;)e.push(a,o),a=a.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(ja(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?F(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:ho,findFiberByHostInstance:e.findFiberByHostInstance||Ao,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Qt=t.inject(e),Vt=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(s(363));e=Ha(e,t);var i=ue(e,n,r).disconnect;return{disconnect:function(){i()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Mt;try{return Mt=e,t()}finally{Mt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,r){var i=t.current,a=bs(),s=xs(i);return n=oo(n),null===t.context?t.context=n:t.pendingContext=n,(t=gn(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),mn(i,t),null!==(e=ws(i,s,a))&&yn(e,i,s),s},t}},7066:function(e,t,n){var r;!function(e,i){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.xor128=o}(0,e=n.nmd(e),n.amdD)},7205:(e,t,n)=>{"use strict";e.exports=n(7302)},7207:function(e){e.exports=function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e,t,n){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){if(u())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&h(i,n.prototype),i}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=f(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},o.apply(null,arguments)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function d(e,t,n,r){var i=o(l(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function A(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return r(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,e)},g(e)}var m=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=e.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=e.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==e.JOIN_ROUND&&(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(e){this._joinStyle=e}},{key:"setSimplifyFactor",value:function(e){this._simplifyFactor=e<0?0:e}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(e){this._endCapStyle=e}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(e){this._mitreLimit=e}},{key:"setSingleSided",value:function(e){this._isSingleSided=e}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2],o=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(a),this.setJoinStyle(s),this.setMitreLimit(o)}}},{key:"bufferDistanceError",value:function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)}}])}();m.CAP_ROUND=1,m.CAP_FLAT=2,m.CAP_SQUARE=3,m.JOIN_ROUND=1,m.JOIN_MITRE=2,m.JOIN_BEVEL=3,m.DEFAULT_QUADRANT_SEGMENTS=8,m.DEFAULT_MITRE_LIMIT=5,m.DEFAULT_SIMPLIFY_FACTOR=.01;var y=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({Exception:r})[0],i}return c(r,e),a(r,[{key:"toString",value:function(){return this.message}}])}(g(Error)),v=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({IllegalArgumentException:r})[0],i}return c(r,e),a(r)}(y),b=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]);function x(){}function w(){}function _(){}var S,C,E,N,k,I,T,B,M=a(function e(){n(this,e)},null,[{key:"equalsWithTolerance",value:function(e,t,n){return Math.abs(e-t)<=n}}]),F=a(function e(t,r){n(this,e),this.low=r||0,this.high=t||0},null,[{key:"toBinaryString",value:function(e){var t,n="";for(t=2147483648;t>0;t>>>=1)n+=(e.high&t)===t?"1":"0";for(t=2147483648;t>0;t>>>=1)n+=(e.low&t)===t?"1":"0";return n}}]);function R(){}function L(){}R.NaN=NaN,R.isNaN=function(e){return Number.isNaN(e)},R.isInfinite=function(e){return!Number.isFinite(e)},R.MAX_VALUE=Number.MAX_VALUE,R.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,R.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,"function"==typeof Float64Array&&"function"==typeof Int32Array?(I=2146435072,T=new Float64Array(1),B=new Int32Array(T.buffer),R.doubleToLongBits=function(e){T[0]=e;var t=0|B[0],n=0|B[1];return(n&I)===I&&1048575&n&&0!==t&&(t=0,n=2146959360),new F(n,t)},R.longBitsToDouble=function(e){return B[0]=e.low,B[1]=e.high,T[0]}):(S=1023,C=Math.log2,E=Math.floor,N=Math.pow,k=function(){for(var e=53;e>0;e--){var t=N(2,e)-1;if(E(C(t))+1===e)return t}return 0}(),R.doubleToLongBits=function(e){var t,n,r,i,a,s,o,l,c;if(e<0||1/e===Number.NEGATIVE_INFINITY?(s=1<<31,e=-e):s=0,0===e)return new F(l=s,c=0);if(e===1/0)return new F(l=2146435072|s,c=0);if(e!=e)return new F(l=2146959360,c=0);if(i=0,c=0,(t=E(e))>1)if(t<=k)(i=E(C(t)))<=20?(c=0,l=t<<20-i&1048575):(c=t%(n=N(2,r=i-20))<<32-r,l=t/n&1048575);else for(r=t,c=0;0!==(r=E(n=r/2));)i++,c>>>=1,c|=(1&l)<<31,l>>>=1,n!==r&&(l|=524288);if(o=i+S,a=0===t,t=e-t,i<52&&0!==t)for(r=0;;){if((n=2*t)>=1?(t=n-1,a?(o--,a=!1):(r<<=1,r|=1,i++)):(t=n,a?0==--o&&(i++,a=!1):(r<<=1,i++)),20===i)l|=r,r=0;else if(52===i){c|=r;break}if(1===n){i<20?l|=r<<20-i:i<52&&(c|=r<<52-i);break}}return l|=o<<20,new F(l|=s,c)},R.longBitsToDouble=function(e){var t,n,r,i,a=e.high,s=e.low,o=a&1<<31?-1:1;for(r=((2146435072&a)>>20)-S,i=0,n=1<<19,t=1;t<=20;t++)a&n&&(i+=N(2,-t)),n>>>=1;for(n=1<<31,t=21;t<=52;t++)s&n&&(i+=N(2,-t)),n>>>=1;if(-1023===r){if(0===i)return 0*o;r=-1022}else{if(1024===r)return 0===i?o/0:NaN;i+=1}return o*i*N(2,r)});var P=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({RuntimeException:r})[0],i}return c(r,e),a(r)}(y),U=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,null,[{key:"constructor_",value:function(){if(0===arguments.length)P.constructor_.call(this);else if(1===arguments.length){var e=arguments[0];P.constructor_.call(this,e)}}}])}(P),D=function(){function e(){n(this,e)}return a(e,null,[{key:"shouldNeverReachHere",value:function(){if(0===arguments.length)e.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new U("Should never reach here"+(null!==t?": "+t:""))}}},{key:"isTrue",value:function(){if(1===arguments.length){var t=arguments[0];e.isTrue(t,null)}else if(2===arguments.length){var n=arguments[1];if(!arguments[0])throw null===n?new U:new U(n)}}},{key:"equals",value:function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];e.equals(t,n,null)}else if(3===arguments.length){var r=arguments[0],i=arguments[1],a=arguments[2];if(!i.equals(r))throw new U("Expected "+r+" but encountered "+i+(null!==a?": "+a:""))}}}])}(),O=new ArrayBuffer(8),j=new Float64Array(O),z=new Int32Array(O),H=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getM",value:function(){return R.NaN}},{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;case e.Z:this.setZ(n);break;default:throw new v("Invalid ordinate index: "+t)}}},{key:"equals2D",value:function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!M.equalsWithTolerance(this.x,t.x,n)&&!!M.equalsWithTolerance(this.y,t.y,n)}}},{key:"setM",value:function(t){throw new v("Invalid ordinate index: "+e.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y;case e.Z:return this.getZ()}throw new v("Invalid ordinate index: "+t)}},{key:"equals3D",value:function(e){return this.x===e.x&&this.y===e.y&&(this.getZ()===e.getZ()||R.isNaN(this.getZ())&&R.isNaN(e.getZ()))}},{key:"equals",value:function(t){return t instanceof e&&this.equals2D(t)}},{key:"equalInZ",value:function(e,t){return M.equalsWithTolerance(this.getZ(),e.getZ(),t)}},{key:"setX",value:function(e){this.x=e}},{key:"compareTo",value:function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(e){this.z=e}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return D.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw e}}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.getZ()-e.getZ();return Math.sqrt(t*t+n*n+r*r)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(e){this.y=e}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var t=17;return 37*(t=37*t+e.hashCode(this.x))+e.hashCode(this.y)}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}},{key:"interfaces_",get:function(){return[x,w,_]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)e.constructor_.call(this,0,0);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.x,t.y,t.getZ())}else if(2===arguments.length){var n=arguments[0],r=arguments[1];e.constructor_.call(this,n,r,e.NULL_ORDINATE)}else if(3===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2];this.x=i,this.y=a,this.z=s}}},{key:"hashCode",value:function(e){return j[0]=e,z[0]^z[1]}}])}(),Q=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compare",value:function(t,n){var r=e.compare(t.x,n.x);if(0!==r)return r;var i=e.compare(t.y,n.y);return 0!==i?i:this._dimensionsToTest<=2?0:e.compare(t.getZ(),n.getZ())}},{key:"interfaces_",get:function(){return[L]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,0===arguments.length)e.constructor_.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new v("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}},{key:"compare",value:function(e,t){return e<t?-1:e>t?1:R.isNaN(e)?R.isNaN(t)?0:-1:R.isNaN(t)?1:0}}])}();H.DimensionalComparator=Q,H.NULL_ORDINATE=R.NaN,H.X=0,H.Y=1,H.Z=2,H.M=3;var V=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()}},{key:"intersection",value:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new e;var n=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny;return new e(n,this._maxx<t._maxx?this._maxx:t._maxx,r,this._maxy<t._maxy?this._maxy:t._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(1===arguments.length){if(arguments[0]instanceof H){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof e){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return!this.isNull()&&r>=this._minx&&r<=this._maxx&&i>=this._miny&&i<=this._maxy}}},{key:"intersects",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof H){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(2===arguments.length){if(arguments[0]instanceof H&&arguments[1]instanceof H){var r=arguments[0],i=arguments[1];return!this.isNull()&&!((r.x<i.x?r.x:i.x)>this._maxx)&&!((r.x>i.x?r.x:i.x)<this._minx)&&!((r.y<i.y?r.y:i.y)>this._maxy)&&!((r.y>i.y?r.y:i.y)<this._miny)}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],s=arguments[1];return!this.isNull()&&!(a>this._maxx||a<this._minx||s>this._maxy||s<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return Math.sqrt(e*e+t*t)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(1===arguments.length){if(arguments[0]instanceof H){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=i,this._maxy=i):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0}},{key:"translate",value:function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(e){return!(!this.isNull()&&!e.isNull())||e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t}},{key:"expandBy",value:function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof H){var n=arguments[0];return this.covers(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return this.covers(r,i)}}},{key:"centre",value:function(){return this.isNull()?null:new H((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof H){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2],l=arguments[3];a<s?(this._minx=a,this._maxx=s):(this._minx=s,this._maxx=a),o<l?(this._miny=o,this._maxy=l):(this._miny=l,this._maxy=o)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),0===t?n:0===n?t:Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var e=17;return 37*(e=37*(e=37*(e=37*e+H.hashCode(this._minx))+H.hashCode(this._maxx))+H.hashCode(this._miny))+H.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[x,_]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof H){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2],l=arguments[3];this.init(a,s,o,l)}}},{key:"intersects",value:function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],o=Math.min(a.x,s.x),l=Math.max(a.x,s.x),c=Math.min(r.x,i.x),u=Math.max(r.x,i.x);return!(c>l)&&!(u<o)&&(o=Math.min(a.y,s.y),l=Math.max(a.y,s.y),c=Math.min(r.y,i.y),u=Math.max(r.y,i.y),!(c>l)&&!(u<o))}}}])}(),G=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(e){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(e){return this===e||this.equalsExact(e,0)}},{key:"geometryChanged",value:function(){this.apply(e.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(e){return null!==e&&this.norm().equalsExact(e.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var e;if(1===arguments.length){var t=arguments[0];return e=t,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,r)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(t){if(t.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION)throw new v("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(e,t,n){return 0===n?e.equals(t):e.distance(t)<=n}},{key:"norm",value:function(){var e=this.copy();return e.normalize(),e}},{key:"reverse",value:function(){var e=this.reverseInternal();return null!=this.envelope&&(e.envelope=this.envelope.copy()),e.setSRID(this.getSRID()),e}},{key:"copy",value:function(){var e=this.copyInternal();return e.envelope=null==this._envelope?null:this._envelope.copy(),e._SRID=this._SRID,e._userData=this._userData,e}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new V(this._envelope)}},{key:"setSRID",value:function(e){this._SRID=e}},{key:"setUserData",value:function(e){this._userData=e}},{key:"compare",value:function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),a=r.next(),s=i.compareTo(a);if(0!==s)return s}return n.hasNext()?1:r.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(e){return this.getClass()===e.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===e.TYPECODE_MULTIPOINT||this.getTypeCode()===e.TYPECODE_MULTILINESTRING||this.getTypeCode()===e.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[w,x,_]}},{key:"getClass",value:function(){return e}}],[{key:"hasNonEmptyElements",value:function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1}}])}();G.constructor_=function(e){e&&(this._envelope=null,this._userData=null,this._factory=e,this._SRID=e.getSRID())},G.TYPECODE_POINT=0,G.TYPECODE_MULTIPOINT=1,G.TYPECODE_LINESTRING=2,G.TYPECODE_LINEARRING=3,G.TYPECODE_MULTILINESTRING=4,G.TYPECODE_POLYGON=5,G.TYPECODE_MULTIPOLYGON=6,G.TYPECODE_GEOMETRYCOLLECTION=7,G.TYPENAME_POINT="Point",G.TYPENAME_MULTIPOINT="MultiPoint",G.TYPENAME_LINESTRING="LineString",G.TYPENAME_LINEARRING="LinearRing",G.TYPENAME_MULTILINESTRING="MultiLineString",G.TYPENAME_POLYGON="Polygon",G.TYPENAME_MULTIPOLYGON="MultiPolygon",G.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",G.geometryChangedFilter={get interfaces_(){return[b]},filter:function(e){e.geometryChangedAction()}};var W=function(){function e(){n(this,e)}return a(e,null,[{key:"toLocationSymbol",value:function(t){switch(t){case e.EXTERIOR:return"e";case e.BOUNDARY:return"b";case e.INTERIOR:return"i";case e.NONE:return"-"}throw new v("Unknown location value: "+t)}}])}();W.INTERIOR=0,W.BOUNDARY=1,W.EXTERIOR=2,W.NONE=-1;var q=a(function e(){n(this,e)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),K=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({NoSuchElementException:r})[0],i}return c(r,e),a(r)}(y),X=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({UnsupportedOperationException:r})[0],i}return c(r,e),a(r)}(y),Y=function(e){function r(){return n(this,r),t(this,r,arguments)}return c(r,e),a(r,[{key:"contains",value:function(){}}])}(q),J=function(e){function r(e){var i;return n(this,r),(i=t(this,r)).map=new Map,e instanceof q&&i.addAll(e),i}return c(r,e),a(r,[{key:"contains",value:function(e){var t=e.hashCode?e.hashCode():e;return!!this.map.has(t)}},{key:"add",value:function(e){var t=e.hashCode?e.hashCode():e;return!this.map.has(t)&&!!this.map.set(t,e)}},{key:"addAll",value:function(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.add(r)}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new X}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return 0===this.map.size}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Z(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(Y),Z=a(function e(t){n(this,e),this.iterator=t.values();var r=this.iterator.next(),i=r.done,a=r.value;this.done=i,this.value=a},[{key:"next",value:function(){if(this.done)throw new K;var e=this.value,t=this.iterator.next(),n=t.done,r=t.value;return this.done=n,this.value=r,e}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new X}}]),$=function(){function e(){n(this,e)}return a(e,null,[{key:"opposite",value:function(t){return t===e.LEFT?e.RIGHT:t===e.RIGHT?e.LEFT:t}}])}();$.ON=0,$.LEFT=1,$.RIGHT=2;var ee=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({EmptyStackException:r})[0],i}return c(r,e),a(r)}(y),te=function(e){function r(e){var i;return n(this,r),(i=t(this,r,[e])).name=Object.keys({IndexOutOfBoundsException:r})[0],i}return c(r,e),a(r)}(y),ne=function(e){function r(){return n(this,r),t(this,r,arguments)}return c(r,e),a(r,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(q),re=function(e){function r(){var e;return n(this,r),(e=t(this,r)).array=[],e}return c(r,e),a(r,[{key:"add",value:function(e){return this.array.push(e),!0}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new te;return this.array[e]}},{key:"push",value:function(e){return this.array.push(e),e}},{key:"pop",value:function(){if(0===this.array.length)throw new ee;return this.array.pop()}},{key:"peek",value:function(){if(0===this.array.length)throw new ee;return this.array[this.array.length-1]}},{key:"empty",value:function(){return 0===this.array.length}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(e){return this.array.indexOf(e)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(ne);function ie(e,t){return e.interfaces_&&e.interfaces_.indexOf(t)>-1}var ae=a(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),se=function(){function e(t){n(this,e),this.value=t}return a(e,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(e){return this.value<e?-1:this.value>e?1:0}}],[{key:"compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"isNan",value:function(e){return Number.isNaN(e)}},{key:"valueOf",value:function(t){return new e(t)}}])}(),oe=a(function e(){n(this,e)},null,[{key:"isWhitespace",value:function(e){return e<=32&&e>=0||127===e}},{key:"toUpperCase",value:function(e){return e.toUpperCase()}}]),le=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"le",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<=e._lo}},{key:"extractSignificantDigits",value:function(t,n){var r=this.abs(),i=e.magnitude(r._hi),a=e.TEN.pow(i);(r=r.divide(a)).gt(e.TEN)?(r=r.divide(e.TEN),i+=1):r.lt(e.ONE)&&(r=r.multiply(e.TEN),i-=1);for(var s=i+1,o=new ae,l=e.MAX_PRINT_DIGITS-1,c=0;c<=l;c++){t&&c===s&&o.append(".");var u=Math.trunc(r._hi);if(u<0)break;var h=!1,d=0;u>9?(h=!0,d="9"):d="0"+u,o.append(d),r=r.subtract(e.valueOf(u)).multiply(e.TEN),h&&r.selfAdd(e.TEN);var A=!0,p=e.magnitude(r._hi);if(p<0&&Math.abs(p)>=l-c&&(A=!1),!A)break}return n[0]=i,o.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var n=arguments[0];return this.add(-n)}}},{key:"equals",value:function(){if(1===arguments.length&&arguments[0]instanceof e){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}},{key:"isZero",value:function(){return 0===this._hi&&0===this._lo}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(e){return this.le(e)?this:e}},{key:"selfDivide",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfDivide(n,0)}}else if(2===arguments.length){var r,i,a,s,o=arguments[0],l=arguments[1],c=null,u=null,h=null,d=null;return a=this._hi/o,d=(c=(h=e.SPLIT*a)-(c=h-a))*(u=(d=e.SPLIT*o)-(u=d-o))-(s=a*o)+c*(i=o-u)+(r=a-c)*u+r*i,d=a+(h=(this._hi-s-d+this._lo-a*l)/o),this._hi=d,this._lo=a-d+h,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof e){var t,n,r,i,a=arguments[0],s=null,o=null,l=null,c=null;return t=(r=this._hi/a._hi)-(s=(l=e.SPLIT*r)-(s=l-r)),c=s*(o=(c=e.SPLIT*a._hi)-(o=c-a._hi))-(i=r*a._hi)+s*(n=a._hi-o)+t*o+t*n,new e(c=r+(l=(this._hi-i-c+this._lo-r*a._lo)/a._hi),r-c+l)}if("number"==typeof arguments[0]){var u=arguments[0];return R.isNaN(u)?e.createNaN():e.copy(this).selfDivide(u,0)}}},{key:"ge",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>=e._lo}},{key:"pow",value:function(t){if(0===t)return e.valueOf(1);var n=new e(this),r=e.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2==1&&r.selfMultiply(n),(i/=2)>0&&(n=n.sqr());else r=n;return t<0?r.reciprocal():r}},{key:"ceil",value:function(){if(this.isNaN())return e.NaN;var t=Math.ceil(this._hi),n=0;return t===this._hi&&(n=Math.ceil(this._lo)),new e(t,n)}},{key:"compareTo",value:function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var n=arguments[0];return this.init(n),this}}},{key:"max",value:function(e){return this.ge(e)?this:e}},{key:"sqrt",value:function(){if(this.isZero())return e.valueOf(0);if(this.isNegative())return e.NaN;var t=1/Math.sqrt(this._hi),n=this._hi*t,r=e.valueOf(n),i=this.subtract(r.sqr())._hi*(.5*t);return r.add(i)}},{key:"selfAdd",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var n,r,i,a,s,o=arguments[0],l=null;return l=(i=this._hi+o)-(a=i-this._hi),r=(s=(l=o-a+(this._hi-l))+this._lo)+(i-(n=i+s)),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var c,u,h,d,A=arguments[0],p=arguments[1],f=null,g=null,m=null;h=this._hi+A,u=this._lo+p,g=h-(m=h-this._hi),f=u-(d=u-this._lo);var y=(c=h+(m=(g=A-m+(this._hi-g))+u))+(m=(f=p-d+(this._lo-f))+(m+(h-c))),v=m+(c-y);return this._hi=y,this._lo=v,this}}},{key:"selfMultiply",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfMultiply(n,0)}}else if(2===arguments.length){var r,i,a=arguments[0],s=arguments[1],o=null,l=null,c=null,u=null;o=(c=e.SPLIT*this._hi)-this._hi,u=e.SPLIT*a,o=c-o,r=this._hi-o,l=u-a;var h=(c=this._hi*a)+(u=o*(l=u-l)-c+o*(i=a-l)+r*l+r*i+(this._hi*s+this._lo*a)),d=u+(o=c-h);return this._hi=h,this._lo=d,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return e.NaN;var t=Math.floor(this._hi),n=0;return t===this._hi&&(n=Math.floor(this._lo)),new e(t,n)}},{key:"negate",value:function(){return this.isNaN()?this:new e(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}}},{key:"multiply",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return t.isNaN()?e.createNaN():e.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var n=arguments[0];return R.isNaN(n)?e.createNaN():e.copy(this).selfMultiply(n,0)}}},{key:"isNaN",value:function(){return R.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var t=e.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!0,n),i=n[0]+1,a=r;if("."===r.charAt(0))a="0"+r;else if(i<0)a="0."+e.stringOfChar("0",-i)+r;else if(-1===r.indexOf(".")){var s=i-r.length;a=r+e.stringOfChar("0",s)+".0"}return this.isNegative()?"-"+a:a}},{key:"reciprocal",value:function(){var t,n,r,i,a=null,s=null,o=null,l=null;t=(r=1/this._hi)-(a=(o=e.SPLIT*r)-(a=o-r)),s=(l=e.SPLIT*this._hi)-this._hi;var c=r+(o=(1-(i=r*this._hi)-(l=a*(s=l-s)-i+a*(n=this._hi-s)+t*s+t*n)-r*this._lo)/this._hi);return new e(c,r-c+o)}},{key:"toSciNotation",value:function(){if(this.isZero())return e.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!1,n),i=e.SCI_NOT_EXPONENT_CHAR+n[0];if("0"===r.charAt(0))throw new IllegalStateException("Found leading zero: "+r);var a="";r.length>1&&(a=r.substring(1));var s=r.charAt(0)+"."+a;return this.isNegative()?"-"+s+i:s+i}},{key:"abs",value:function(){return this.isNaN()?e.NaN:this.isNegative()?this.negate():new e(this)}},{key:"isPositive",value:function(){return this._hi>0||0===this._hi&&this._lo>0}},{key:"lt",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<e._lo}},{key:"add",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return e.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var n=arguments[0];return e.copy(this).selfAdd(n)}}},{key:"init",value:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof e){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this._hi=r,this._lo=i}}},{key:"gt",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>e._lo}},{key:"isNegative",value:function(){return this._hi<0||0===this._hi&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?e.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[_,x,w]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var r=arguments[0];e.constructor_.call(this,e.parse(r))}}else if(2===arguments.length){var i=arguments[0],a=arguments[1];this.init(i,a)}}},{key:"determinant",value:function(){if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];return e.determinant(e.valueOf(t),e.valueOf(n),e.valueOf(r),e.valueOf(i))}if(arguments[3]instanceof e&&arguments[2]instanceof e&&arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[1],s=arguments[2],o=arguments[3];return arguments[0].multiply(o).selfSubtract(a.multiply(s))}}},{key:"sqr",value:function(t){return e.valueOf(t).selfMultiply(t)}},{key:"valueOf",value:function(){if("string"==typeof arguments[0]){var t=arguments[0];return e.parse(t)}if("number"==typeof arguments[0])return new e(arguments[0])}},{key:"sqrt",value:function(t){return e.valueOf(t).sqrt()}},{key:"parse",value:function(t){for(var n=0,r=t.length;oe.isWhitespace(t.charAt(n));)n++;var i=!1;if(n<r){var a=t.charAt(n);"-"!==a&&"+"!==a||(n++,"-"===a&&(i=!0))}for(var s=new e,o=0,l=0,c=0,u=!1;!(n>=r);){var h=t.charAt(n);if(n++,oe.isDigit(h)){var d=h-"0";s.selfMultiply(e.TEN),s.selfAdd(d),o++}else{if("."!==h){if("e"===h||"E"===h){var A=t.substring(n);try{c=se.parseInt(A)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+A+" in string "+t):e}break}throw new NumberFormatException("Unexpected character '"+h+"' at position "+n+" in string "+t)}l=o,u=!0}}var p=s;u||(l=o);var f=o-l-c;if(0===f)p=s;else if(f>0){var g=e.TEN.pow(f);p=s.divide(g)}else if(f<0){var m=e.TEN.pow(-f);p=s.multiply(m)}return i?p.negate():p}},{key:"createNaN",value:function(){return new e(R.NaN,R.NaN)}},{key:"copy",value:function(t){return new e(t)}},{key:"magnitude",value:function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=t&&(r+=1),r}},{key:"stringOfChar",value:function(e,t){for(var n=new ae,r=0;r<t;r++)n.append(e);return n.toString()}}])}();le.PI=new le(3.141592653589793,12246467991473532e-32),le.TWO_PI=new le(6.283185307179586,24492935982947064e-32),le.PI_2=new le(1.5707963267948966,6123233995736766e-32),le.E=new le(2.718281828459045,14456468917292502e-32),le.NaN=new le(R.NaN,R.NaN),le.EPS=123259516440783e-46,le.SPLIT=134217729,le.MAX_PRINT_DIGITS=32,le.TEN=le.valueOf(10),le.ONE=le.valueOf(1),le.SCI_NOT_EXPONENT_CHAR="E",le.SCI_NOT_ZERO="0.0E0";var ce=function(){function e(){n(this,e)}return a(e,null,[{key:"orientationIndex",value:function(t,n,r){var i=e.orientationIndexFilter(t,n,r);if(i<=1)return i;var a=le.valueOf(n.x).selfAdd(-t.x),s=le.valueOf(n.y).selfAdd(-t.y),o=le.valueOf(r.x).selfAdd(-n.x),l=le.valueOf(r.y).selfAdd(-n.y);return a.selfMultiply(l).selfSubtract(s.selfMultiply(o)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof le&&arguments[2]instanceof le&&arguments[0]instanceof le&&arguments[1]instanceof le){var e=arguments[1],t=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(e.multiply(t)).signum()}if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],o=le.valueOf(r),l=le.valueOf(i),c=le.valueOf(a),u=le.valueOf(s);return o.multiply(u).selfSubtract(l.multiply(c)).signum()}}},{key:"intersection",value:function(e,t,n,r){var i=new le(e.y).selfSubtract(t.y),a=new le(t.x).selfSubtract(e.x),s=new le(e.x).selfMultiply(t.y).selfSubtract(new le(t.x).selfMultiply(e.y)),o=new le(n.y).selfSubtract(r.y),l=new le(r.x).selfSubtract(n.x),c=new le(n.x).selfMultiply(r.y).selfSubtract(new le(r.x).selfMultiply(n.y)),u=a.multiply(c).selfSubtract(l.multiply(s)),h=o.multiply(s).selfSubtract(i.multiply(c)),d=i.multiply(l).selfSubtract(o.multiply(a)),A=u.selfDivide(d).doubleValue(),p=h.selfDivide(d).doubleValue();return R.isNaN(A)||R.isInfinite(A)||R.isNaN(p)||R.isInfinite(p)?null:new H(A,p)}},{key:"orientationIndexFilter",value:function(t,n,r){var i=null,a=(t.x-r.x)*(n.y-r.y),s=(t.y-r.y)*(n.x-r.x),o=a-s;if(a>0){if(s<=0)return e.signum(o);i=a+s}else{if(!(a<0))return e.signum(o);if(s>=0)return e.signum(o);i=-a-s}var l=e.DP_SAFE_EPSILON*i;return o>=l||-o>=l?e.signum(o):2}},{key:"signum",value:function(e){return e>0?1:e<0?-1:0}}])}();ce.DP_SAFE_EPSILON=1e-15;var ue=a(function e(){n(this,e)},[{key:"getM",value:function(e){if(this.hasM()){var t=this.getDimension()-this.getMeasures();return this.getOrdinate(e,t)}return R.NaN}},{key:"setOrdinate",value:function(e,t,n){}},{key:"getZ",value:function(e){return this.hasZ()?this.getOrdinate(e,2):R.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(e,t){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(e){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(e){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(e){}},{key:"copy",value:function(){}},{key:"getY",value:function(e){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[w]}}]);ue.X=0,ue.Y=1,ue.Z=2,ue.M=3;var he=function(){function e(){n(this,e)}return a(e,null,[{key:"index",value:function(e,t,n){return ce.orientationIndex(e,t,n)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var t=arguments[0],n=t.length-1;if(n<3)throw new v("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],i=0,a=1;a<=n;a++){var s=t[a];s.y>r.y&&(r=s,i=a)}var o=i;do{(o-=1)<0&&(o=n)}while(t[o].equals2D(r)&&o!==i);var l=i;do{l=(l+1)%n}while(t[l].equals2D(r)&&l!==i);var c=t[o],u=t[l];if(c.equals2D(r)||u.equals2D(r)||c.equals2D(u))return!1;var h=e.index(c,r,u);return 0===h?c.x>u.x:h>0}if(ie(arguments[0],ue)){var d=arguments[0],A=d.size()-1;if(A<3)throw new v("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=d.getCoordinate(0),f=0,g=1;g<=A;g++){var m=d.getCoordinate(g);m.y>p.y&&(p=m,f=g)}var y=null,b=f;do{(b-=1)<0&&(b=A),y=d.getCoordinate(b)}while(y.equals2D(p)&&b!==f);var x=null,w=f;do{w=(w+1)%A,x=d.getCoordinate(w)}while(x.equals2D(p)&&w!==f);if(y.equals2D(p)||x.equals2D(p)||y.equals2D(x))return!1;var _=e.index(y,p,x);return 0===_?y.x>x.x:_>0}}}])}();he.CLOCKWISE=-1,he.RIGHT=he.CLOCKWISE,he.COUNTERCLOCKWISE=1,he.LEFT=he.COUNTERCLOCKWISE,he.COLLINEAR=0,he.STRAIGHT=he.COLLINEAR;var de=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n}},{key:"findRightmostEdgeAtVertex",value:function(){var e=this._minDe.getEdge().getCoordinates();D.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=he.index(this._minCoord,n,t),i=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===he.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===he.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(e,t){var n=e.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var r=$.LEFT;return n[t].y<n[t+1].y&&(r=$.RIGHT),r}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(e){for(var t=e.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this._minCoord||t[n].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=n,this._minCoord=t[n])}},{key:"findRightmostEdgeAtNode",value:function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}D.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===$.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),Ae=function(e){function r(e,i){var a;return n(this,r),(a=t(this,r,[i?e+" [ "+i+" ]":e])).pt=i?new H(i):void 0,a.name=Object.keys({TopologyException:r})[0],a}return c(r,e),a(r,[{key:"getCoordinate",value:function(){return this.pt}}])}(P),pe=a(function e(){n(this,e),this.array=[]},[{key:"addLast",value:function(e){this.array.push(e)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return 0===this.array.length}}]),fe=function(e){function r(e){var i;return n(this,r),(i=t(this,r)).array=[],e instanceof q&&i.addAll(e),i}return c(r,e),a(r,[{key:"interfaces_",get:function(){return[ne,q]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(e){return 1===arguments.length?this.array.push(e):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.array.push(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"set",value:function(e,t){var n=this.array[e];return this.array[e]=t,n}},{key:"iterator",value:function(){return new ge(this)}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new te;return this.array[e]}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"sort",value:function(e){e?this.array.sort(function(t,n){return e.compare(t,n)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(e){for(var t=0,n=this.array.length;t<n;t++)if(this.array[t]===e)return!!this.array.splice(t,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(ne),ge=a(function e(t){n(this,e),this.arrayList=t,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new K;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(e){return this.arrayList.set(this.position-1,e)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),me=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(e){for(var t=null,n=e.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){t=r;break}}if(null===t)throw new Ae("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var i=e.getEdges().iterator();i.hasNext();){var a=i.next();a.setVisited(!0),this.copySymDepths(a)}}},{key:"computeDepth",value:function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.getNode(),t.getLabel(),t.setEdgeDepths($.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)}},{key:"create",value:function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth($.RIGHT)>=1&&t.getDepth($.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}}},{key:"computeDepths",value:function(e){var t=new J,n=new pe,r=e.getNode();for(n.addLast(r),t.add(r),e.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();t.add(i),this.computeNodeDepth(i);for(var a=i.getEdges().iterator();a.hasNext();){var s=a.next().getSym();if(!s.isVisited()){var o=s.getNode();t.contains(o)||(n.addLast(o),t.add(o))}}}}},{key:"compareTo",value:function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(null===this._env){for(var e=new V,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)e.expandToInclude(n[r]);this._env=e}return this._env}},{key:"addReachable",value:function(e){var t=new re;for(t.add(e);!t.empty();){var n=t.pop();this.add(n,t)}}},{key:"copySymDepths",value:function(e){var t=e.getSym();t.setDepth($.LEFT,e.getDepth($.RIGHT)),t.setDepth($.RIGHT,e.getDepth($.LEFT))}},{key:"add",value:function(e,t){e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||t.push(i)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new fe,this._nodes=new fe,this._rightMostCoord=null,this._env=null,this._finder=new de}}]),ye=a(function e(){n(this,e)},null,[{key:"intersection",value:function(e,t,n,r){var i=e.x<t.x?e.x:t.x,a=e.y<t.y?e.y:t.y,s=e.x>t.x?e.x:t.x,o=e.y>t.y?e.y:t.y,l=n.x<r.x?n.x:r.x,c=n.y<r.y?n.y:r.y,u=n.x>r.x?n.x:r.x,h=n.y>r.y?n.y:r.y,d=((i>l?i:l)+(s<u?s:u))/2,A=((a>c?a:c)+(o<h?o:h))/2,p=e.x-d,f=e.y-A,g=t.x-d,m=t.y-A,y=n.x-d,v=n.y-A,b=r.x-d,x=r.y-A,w=f-m,_=g-p,S=p*m-g*f,C=v-x,E=b-y,N=y*x-b*v,k=w*E-C*_,I=(_*N-E*S)/k,T=(C*S-w*N)/k;return R.isNaN(I)||R.isInfinite(I)||R.isNaN(T)||R.isInfinite(T)?null:new H(I+d,T+A)}}]),ve=a(function e(){n(this,e)},null,[{key:"arraycopy",value:function(e,t,n,r,i){for(var a=0,s=t;s<t+i;s++)n[r+a]=e[s],a++}},{key:"getProperty",value:function(e){return{"line.separator":"\n"}[e]}}]),be=function(){function e(){n(this,e)}return a(e,null,[{key:"log10",value:function(t){var n=Math.log(t);return R.isInfinite(n)||R.isNaN(n)?n:n/e.LOG_10}},{key:"min",value:function(e,t,n,r){var i=e;return t<i&&(i=t),n<i&&(i=n),r<i&&(i=r),i}},{key:"clamp",value:function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],a=arguments[2];return r<i?i:r>a?a:r}}},{key:"wrap",value:function(e,t){return e<0?t- -e%t:e%t}},{key:"max",value:function(){if(3===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[0];return e>n&&(n=e),t>n&&(n=t),n}if(4===arguments.length){var r=arguments[1],i=arguments[2],a=arguments[3],s=arguments[0];return r>s&&(s=r),i>s&&(s=i),a>s&&(s=a),s}}},{key:"average",value:function(e,t){return(e+t)/2}}])}();be.LOG_10=Math.log(10);var xe=function(){function e(){n(this,e)}return a(e,null,[{key:"segmentToSegment",value:function(t,n,r,i){if(t.equals(n))return e.pointToSegment(t,r,i);if(r.equals(i))return e.pointToSegment(i,t,n);var a=!1;if(V.intersects(t,n,r,i)){var s=(n.x-t.x)*(i.y-r.y)-(n.y-t.y)*(i.x-r.x);if(0===s)a=!0;else{var o=(t.y-r.y)*(i.x-r.x)-(t.x-r.x)*(i.y-r.y),l=((t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y))/s,c=o/s;(c<0||c>1||l<0||l>1)&&(a=!0)}}else a=!0;return a?be.min(e.pointToSegment(t,r,i),e.pointToSegment(n,r,i),e.pointToSegment(r,t,n),e.pointToSegment(i,t,n)):0}},{key:"pointToSegment",value:function(e,t,n){if(t.x===n.x&&t.y===n.y)return e.distance(t);var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;if(i<=0)return e.distance(t);if(i>=1)return e.distance(n);var a=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(a)*Math.sqrt(r)}},{key:"pointToLinePerpendicular",value:function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),i=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(i)*Math.sqrt(r)}},{key:"pointToSegmentString",value:function(t,n){if(0===n.length)throw new v("Line array must contain at least one vertex");for(var r=t.distance(n[0]),i=0;i<n.length-1;i++){var a=e.pointToSegment(t,n[i],n[i+1]);a<r&&(r=a)}return r}}])}(),we=a(function e(){n(this,e)},[{key:"create",value:function(){if(1===arguments.length)arguments[0]instanceof Array||ie(arguments[0],ue);else if(2===arguments.length);else if(3===arguments.length){var e=arguments[0],t=arguments[1];return this.create(e,t)}}}]),_e=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),Se=a(function e(){n(this,e)},null,[{key:"ofLine",value:function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new H;e.getCoordinate(0,r);for(var i=r.x,a=r.y,s=1;s<t;s++){e.getCoordinate(s,r);var o=r.x,l=r.y,c=o-i,u=l-a;n+=Math.sqrt(c*c+u*u),i=o,a=l}return n}}]),Ce=a(function e(){n(this,e)}),Ee=function(){function e(){n(this,e)}return a(e,null,[{key:"copyCoord",value:function(e,t,n,r){for(var i=Math.min(e.getDimension(),n.getDimension()),a=0;a<i;a++)n.setOrdinate(r,a,e.getOrdinate(t,a))}},{key:"isRing",value:function(e){var t=e.size();return 0===t||!(t<=3)&&e.getOrdinate(0,ue.X)===e.getOrdinate(t-1,ue.X)&&e.getOrdinate(0,ue.Y)===e.getOrdinate(t-1,ue.Y)}},{key:"scroll",value:function(){if(2===arguments.length){if(ie(arguments[0],ue)&&Number.isInteger(arguments[1])){var t=arguments[0],n=arguments[1];e.scroll(t,n,e.isRing(t))}else if(ie(arguments[0],ue)&&arguments[1]instanceof H){var r=arguments[0],i=arguments[1],a=e.indexOf(i,r);if(a<=0)return null;e.scroll(r,a)}}else if(3===arguments.length){var s=arguments[0],o=arguments[1],l=arguments[2];if(o<=0)return null;for(var c=s.copy(),u=l?s.size()-1:s.size(),h=0;h<u;h++)for(var d=0;d<s.getDimension();d++)s.setOrdinate(h,d,c.getOrdinate((o+h)%u,d));if(l)for(var A=0;A<s.getDimension();A++)s.setOrdinate(u,A,s.getOrdinate(0,A))}}},{key:"isEqual",value:function(e,t){var n=e.size();if(n!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),i=0;i<n;i++)for(var a=0;a<r;a++){var s=e.getOrdinate(i,a),o=t.getOrdinate(i,a);if(e.getOrdinate(i,a)!==t.getOrdinate(i,a)&&(!R.isNaN(s)||!R.isNaN(o)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(1===arguments.length){var t=arguments[0];return e.minCoordinateIndex(t,0,t.size()-1)}if(3===arguments.length){for(var n=arguments[0],r=arguments[2],i=-1,a=null,s=arguments[1];s<=r;s++){var o=n.getCoordinate(s);(null===a||a.compareTo(o)>0)&&(a=o,i=s)}return i}}},{key:"extend",value:function(t,n,r){var i=t.create(r,n.getDimension()),a=n.size();if(e.copy(n,0,i,0,a),a>0)for(var s=a;s<r;s++)e.copy(n,a-1,i,s,1);return i}},{key:"reverse",value:function(t){for(var n=t.size()-1,r=Math.trunc(n/2),i=0;i<=r;i++)e.swap(t,i,n-i)}},{key:"swap",value:function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var i=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,i)}}},{key:"copy",value:function(t,n,r,i,a){for(var s=0;s<a;s++)e.copyCoord(t,n+s,r,i+s)}},{key:"ensureValidRing",value:function(t,n){var r=n.size();return 0===r?n:r<=3?e.createClosedRing(t,n,4):n.getOrdinate(0,ue.X)===n.getOrdinate(r-1,ue.X)&&n.getOrdinate(0,ue.Y)===n.getOrdinate(r-1,ue.Y)?n:e.createClosedRing(t,n,r+1)}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.size();n++)if(e.x===t.getOrdinate(n,ue.X)&&e.y===t.getOrdinate(n,ue.Y))return n;return-1}},{key:"createClosedRing",value:function(t,n,r){var i=t.create(r,n.getDimension()),a=n.size();e.copy(n,0,i,0,a);for(var s=a;s<r;s++)e.copy(n,0,i,s,1);return i}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.size();n++){var r=e.getCoordinate(n);(null===t||t.compareTo(r)>0)&&(t=r)}return t}}])}(),Ne=function(){function e(){n(this,e)}return a(e,null,[{key:"toDimensionSymbol",value:function(t){switch(t){case e.FALSE:return e.SYM_FALSE;case e.TRUE:return e.SYM_TRUE;case e.DONTCARE:return e.SYM_DONTCARE;case e.P:return e.SYM_P;case e.L:return e.SYM_L;case e.A:return e.SYM_A}throw new v("Unknown dimension value: "+t)}},{key:"toDimensionValue",value:function(t){switch(oe.toUpperCase(t)){case e.SYM_FALSE:return e.FALSE;case e.SYM_TRUE:return e.TRUE;case e.SYM_DONTCARE:return e.DONTCARE;case e.SYM_P:return e.P;case e.SYM_L:return e.L;case e.SYM_A:return e.A}throw new v("Unknown dimension symbol: "+t)}}])}();Ne.P=0,Ne.L=1,Ne.A=2,Ne.FALSE=-1,Ne.TRUE=-2,Ne.DONTCARE=-3,Ne.SYM_FALSE="F",Ne.SYM_TRUE="T",Ne.SYM_DONTCARE="*",Ne.SYM_P="0",Ne.SYM_L="1",Ne.SYM_A="2";var ke=a(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),Ie=a(function e(){n(this,e)},[{key:"filter",value:function(e,t){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),Te=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new V:this._points.expandEnvelope(new V)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new r(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),n._points.getCoordinate(i),t))return!1;return!0}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t))){if(this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0){var n=this._points.copy();Ee.reverse(n),this._points=n}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ne.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Ee.reverse(e),this.getFactory().createLineString(e)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return G.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Se.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(1===arguments.length){for(var e=arguments[0],t=0,n=0;t<this._points.size()&&n<e._points.size();){var r=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(n));if(0!==r)return r;t++,n++}return t<this._points.size()?1:n<e._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}}},{key:"apply",value:function(){if(ie(arguments[0],_e))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(ie(arguments[0],Ie)){var n=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(n.filter(this._points,r),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else(ie(arguments[0],ke)||ie(arguments[0],b))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new X}},{key:"isEquivalentClass",value:function(e){return e instanceof r}},{key:"getCoordinateN",value:function(e){return this._points.getCoordinate(e)}},{key:"getGeometryType",value:function(){return G.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return 0===this._points.size()}},{key:"init",value:function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new v("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e}},{key:"isCoordinate",value:function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))}},{key:"interfaces_",get:function(){return[Ce]}}],[{key:"constructor_",value:function(){if(this._points=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];G.constructor_.call(this,t),this.init(e)}}}])}(G),Be=a(function e(){n(this,e)}),Me=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new V;var e=new V;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new r(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),t))}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Ne.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return G.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}}},{key:"apply",value:function(){if(ie(arguments[0],_e)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(ie(arguments[0],Ie)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else(ie(arguments[0],ke)||ie(arguments[0],b))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return G.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return 0===this._coordinates.size()}},{key:"init",value:function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),D.isTrue(e.size()<=1),this._coordinates=e}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Be]}}],[{key:"constructor_",value:function(){this._coordinates=null;var e=arguments[0],t=arguments[1];G.constructor_.call(this,t),this.init(e)}}])}(G),Fe=function(){function e(){n(this,e)}return a(e,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(e.ofRingSigned(t))}if(ie(arguments[0],ue)){var n=arguments[0];return Math.abs(e.ofRingSigned(n))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var i=e[r].x-n,a=e[r+1].y;t+=i*(e[r-1].y-a)}return t/2}if(ie(arguments[0],ue)){var s=arguments[0],o=s.size();if(o<3)return 0;var l=new H,c=new H,u=new H;s.getCoordinate(0,c),s.getCoordinate(1,u);var h=c.x;u.x-=h;for(var d=0,A=1;A<o-1;A++)l.y=c.y,c.x=u.x,c.y=u.y,s.getCoordinate(A+1,u),u.x-=h,d+=c.x*(l.y-u.y);return d/2}}}])}(),Re=a(function e(){n(this,e)},null,[{key:"sort",value:function(){var e=arguments,t=arguments[0];if(1===arguments.length)t.sort(function(e,t){return e.compareTo(t)});else if(2===arguments.length)t.sort(function(t,n){return e[1].compare(t,n)});else if(3===arguments.length){var n=t.slice(arguments[1],arguments[2]);n.sort();var r=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));t.splice(0,t.length);var i,a=s(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.push(o)}}catch(e){a.e(e)}finally{a.f()}}else if(4===arguments.length){var l=t.slice(arguments[1],arguments[2]);l.sort(function(t,n){return e[3].compare(t,n)});var c=t.slice(0,arguments[1]).concat(l,t.slice(arguments[2],t.length));t.splice(0,t.length);var u,h=s(c);try{for(h.s();!(u=h.n()).done;){var d=u.value;t.push(d)}}catch(e){h.e(e)}finally{h.f()}}}},{key:"asList",value:function(e){var t,n=new fe,r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.add(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"copyOf",value:function(e,t){return e.slice(0,t)}}]),Le=a(function e(){n(this,e)}),Pe=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)e[++t]=n[r];for(var i=0;i<this._holes.length;i++)for(var a=this._holes[i].getCoordinates(),s=0;s<a.length;s++)e[++t]=a[s];return e}},{key:"getArea",value:function(){var e=0;e+=Fe.ofRing(this._shell.getCoordinateSequence());for(var t=0;t<this._holes.length;t++)e-=Fe.ofRing(this._holes[t].getCoordinateSequence());return e}},{key:"copyInternal",value:function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),n=0;n<this._holes.length;n++)t[n]=this._holes[n].copy();return new r(e,t,this._factory)}},{key:"isRectangle",value:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var r=e.getX(n);if(r!==t.getMinX()&&r!==t.getMaxX())return!1;var i=e.getY(n);if(i!==t.getMinY()&&i!==t.getMaxY())return!1}for(var a=e.getX(0),s=e.getY(0),o=1;o<=4;o++){var l=e.getX(o),c=e.getY(o);if(l!==a===(c!==s))return!1;a=l,s=c}return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,i=this._shell,a=n._shell;if(!i.equalsExact(a,t))return!1;if(this._holes.length!==n._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(n._holes[s],t))return!1;return!0}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(0===arguments.length){this._shell=this.normalized(this._shell,!0);for(var e=0;e<this._holes.length;e++)this._holes[e]=this.normalized(this._holes[e],!1);Re.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(t.isEmpty())return null;var r=t.getCoordinateSequence(),i=Ee.minCoordinateIndex(r,0,r.size()-2);Ee.scroll(r,i,!0),he.isCCW(r)===n&&Ee.reverse(r)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var e=this.getExteriorRing().reverse(),t=new Array(this.getNumInteriorRing()).fill(null),n=0;n<t.length;n++)t[n]=this.getInteriorRingN(n).reverse();return this.getFactory().createPolygon(e,t)}},{key:"getTypeCode",value:function(){return G.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(e,t){var n=e.copy();return this.normalize(n,t),n}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=this._shell,n=e._shell;return t.compareToSameClass(n)}if(2===arguments.length){var r=arguments[1],i=arguments[0],a=this._shell,s=i._shell,o=a.compareToSameClass(s,r);if(0!==o)return o;for(var l=this.getNumInteriorRing(),c=i.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),d=i.getInteriorRingN(u),A=h.compareToSameClass(d,r);if(0!==A)return A;u++}return u<l?1:u<c?-1:0}}},{key:"apply",value:function(){if(ie(arguments[0],_e)){var e=arguments[0];this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(ie(arguments[0],Ie)){var n=arguments[0];if(this._shell.apply(n),!n.isDone())for(var r=0;r<this._holes.length&&(this._holes[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(ie(arguments[0],ke))arguments[0].filter(this);else if(ie(arguments[0],b)){var i=arguments[0];i.filter(this),this._shell.apply(i);for(var a=0;a<this._holes.length;a++)this._holes[a].apply(i)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)}},{key:"getGeometryType",value:function(){return G.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(e){return this._holes[e]}},{key:"interfaces_",get:function(){return[Le]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(G.constructor_.call(this,n),null===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),G.hasNullElements(t))throw new v("holes must not contain null elements");if(e.isEmpty()&&G.hasNonEmptyElements(t))throw new v("shell is empty but holes are not");this._shell=e,this._holes=t}}])}(G),Ue=function(e){function r(){return n(this,r),t(this,r,arguments)}return c(r,e),a(r)}(Y),De=function(e){function r(e){var i;return n(this,r),(i=t(this,r)).array=[],e instanceof q&&i.addAll(e),i}return c(r,e),a(r,[{key:"contains",value:function(e){var t,n=s(this.array);try{for(n.s();!(t=n.n()).done;)if(0===t.value.compareTo(e))return!0}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"add",value:function(e){if(this.contains(e))return!1;for(var t=0,n=this.array.length;t<n;t++)if(1===this.array[t].compareTo(e))return!!this.array.splice(t,0,e);return this.array.push(e),!0}},{key:"addAll",value:function(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.add(r)}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new X}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Oe(this.array)}}])}(Ue),Oe=a(function e(t){n(this,e),this.array=t,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new K;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new X}}]),je=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"computeEnvelopeInternal",value:function(){for(var e=new V,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e}},{key:"getGeometryN",value:function(e){return this._geometries[e]}},{key:"getCoordinates",value:function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)e[++t]=r[i];return e}},{key:"getArea",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e}},{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(n._geometries[i],t))return!1;return!0}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();Re.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var e=Ne.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e}},{key:"reverseInternal",value:function(){for(var e=this._geometries.length,t=new fe(e),n=0;n<e;n++)t.add(this._geometries[n].reverse());return this.getFactory().buildGeometry(t)}},{key:"getTypeCode",value:function(){return G.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var e=Ne.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e}},{key:"getLength",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=new De(Re.asList(this._geometries)),n=new De(Re.asList(e._geometries));return this.compare(t,n)}if(2===arguments.length){for(var r=arguments[1],i=arguments[0],a=this.getNumGeometries(),s=i.getNumGeometries(),o=0;o<a&&o<s;){var l=this.getGeometryN(o),c=i.getGeometryN(o),u=l.compareToSameClass(c,r);if(0!==u)return u;o++}return o<a?1:o<s?-1:0}}},{key:"apply",value:function(){if(ie(arguments[0],_e))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(ie(arguments[0],Ie)){var n=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(ie(arguments[0],ke)){var i=arguments[0];i.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(i)}else if(ie(arguments[0],b)){var s=arguments[0];s.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(s)}}},{key:"getBoundary",value:function(){return G.checkNotGeometryCollection(this),D.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return G.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];if(G.constructor_.call(this,t),null===e&&(e=[]),G.hasNullElements(e))throw new v("geometries must not contain null elements");this._geometries=e}}}])}(G),ze=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(r,"equalsExact",this,1).call(this,e,t)}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(1===arguments.length&&Number.isInteger(arguments[0])){var e=arguments[0];return this._geometries[e].getCoordinate()}return d(r,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Ne.FALSE}},{key:"getTypeCode",value:function(){return G.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return G.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Be]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];je.constructor_.call(this,e,t)}}])}(je),He=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"copyInternal",value:function(){return new r(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Ne.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||d(r,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Ee.reverse(e),this.getFactory().createLinearRing(e)}},{key:"getTypeCode",value:function(){return G.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!d(r,"isClosed",this,1).call(this))throw new v("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<r.MINIMUM_VALID_SIZE)throw new v("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return G.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Te.constructor_.call(this,e,t),this.validateConstruction()}}])}(Te);He.MINIMUM_VALID_SIZE=4;var Qe=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"setOrdinate",value:function(e,t){switch(e){case r.X:this.x=t;break;case r.Y:this.y=t;break;default:throw new v("Invalid ordinate index: "+e)}}},{key:"getZ",value:function(){return H.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case r.X:return this.x;case r.Y:return this.y}throw new v("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new v("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new r(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}}],[{key:"constructor_",value:function(){if(0===arguments.length)H.constructor_.call(this);else if(1===arguments.length){if(arguments[0]instanceof r){var e=arguments[0];H.constructor_.call(this,e.x,e.y)}else if(arguments[0]instanceof H){var t=arguments[0];H.constructor_.call(this,t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];H.constructor_.call(this,n,i,H.NULL_ORDINATE)}}}])}(H);Qe.X=0,Qe.Y=1,Qe.Z=-1,Qe.M=-1;var Ve=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case r.X:this.x=t;break;case r.Y:this.y=t;break;case r.M:this._m=t;break;default:throw new v("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getZ",value:function(){return H.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case r.X:return this.x;case r.Y:return this.y;case r.M:return this._m}throw new v("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new v("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new r(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)H.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof r){var e=arguments[0];H.constructor_.call(this,e.x,e.y),this._m=e._m}else if(arguments[0]instanceof H){var t=arguments[0];H.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(3===arguments.length){var n=arguments[0],i=arguments[1],a=arguments[2];H.constructor_.call(this,n,i,H.NULL_ORDINATE),this._m=a}}}])}(H);Ve.X=0,Ve.Y=1,Ve.Z=-1,Ve.M=2;var Ge=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case H.X:this.x=t;break;case H.Y:this.y=t;break;case H.Z:this.z=t;break;case H.M:this._m=t;break;default:throw new v("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getOrdinate",value:function(e){switch(e){case H.X:return this.x;case H.Y:return this.y;case H.Z:return this.getZ();case H.M:return this.getM()}throw new v("Invalid ordinate index: "+e)}},{key:"copy",value:function(){return new r(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)H.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof r){var e=arguments[0];H.constructor_.call(this,e),this._m=e._m}else if(arguments[0]instanceof H){var t=arguments[0];H.constructor_.call(this,t),this._m=this.getM()}}else if(4===arguments.length){var n=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3];H.constructor_.call(this,n,i,a),this._m=s}}}])}(H),We=function(){function e(){n(this,e)}return a(e,null,[{key:"measures",value:function(e){return e instanceof Qe?0:e instanceof Ve||e instanceof Ge?1:0}},{key:"dimension",value:function(e){return e instanceof Qe?2:e instanceof Ve?3:e instanceof Ge?4:3}},{key:"create",value:function(){if(1===arguments.length){var t=arguments[0];return e.create(t,0)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return 2===n?new Qe:3===n&&0===r?new H:3===n&&1===r?new Ve:4===n&&1===r?new Ge:new H}}}])}(),qe=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getCoordinate",value:function(e){return this.get(e)}},{key:"addAll",value:function(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&ie(arguments[0],q)){for(var e=arguments[1],t=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),t=!0;return t}return d(r,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var e=d(r,"clone",this,1).call(this),t=0;t<this.size();t++)e.add(t,this.get(t).clone());return e}},{key:"toCoordinateArray",value:function(){if(0===arguments.length)return this.toArray(r.coordArrayType);if(1===arguments.length){if(arguments[0])return this.toArray(r.coordArrayType);for(var e=this.size(),t=new Array(e).fill(null),n=0;n<e;n++)t[n]=this.get(e-n-1);return t}}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];return d(r,"add",this,1).call(this,e)}if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return this.add(t,n,!0),!0}if(arguments[0]instanceof H&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;d(r,"add",this,1).call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var a=arguments[0],s=arguments[1];return this.add(a,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var o=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<o.length;c++)this.add(o[c],l);else for(var u=o.length-1;u>=0;u--)this.add(o[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof H){var h=arguments[0],A=arguments[1];if(!arguments[2]){var p=this.size();if(p>0){if(h>0&&this.get(h-1).equals2D(A))return null;if(h<p&&this.get(h).equals2D(A))return null}}d(r,"add",this,1).call(this,h,A)}}else if(4===arguments.length){var f=arguments[0],g=arguments[1],m=arguments[2],y=arguments[3],v=1;m>y&&(v=-1);for(var b=m;b!==y;b+=v)this.add(f[b],g);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var e=this.get(0).copy();this.add(e,!1)}}}],[{key:"constructor_",value:function(){if(0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.ensureCapacity(t.length),this.add(t,n)}}}])}(fe);qe.coordArrayType=new Array(0).fill(null);var Ke=function(){function e(){n(this,e)}return a(e,null,[{key:"isRing",value:function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])}},{key:"ptNotInList",value:function(t,n){for(var r=0;r<t.length;r++){var i=t[r];if(e.indexOf(i,n)<0)return i}return null}},{key:"scroll",value:function(t,n){var r=e.indexOf(n,t);if(r<0)return null;var i=new Array(t.length).fill(null);ve.arraycopy(t,r,i,0,t.length-r),ve.arraycopy(t,0,i,t.length-r,r),ve.arraycopy(i,0,t,0,t.length)}},{key:"equals",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],a=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var s=0;s<r.length;s++)if(0!==a.compare(r[s],i[s]))return!1;return!0}}},{key:"intersection",value:function(e,t){for(var n=new qe,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()}},{key:"measures",value:function(e){if(null===e||0===e.length)return 0;var t,n=0,r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n=Math.max(n,We.measures(i))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"hasRepeatedPoints",value:function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(t){return e.hasRepeatedPoints(t)?new qe(t,!1).toCoordinateArray():t}},{key:"reverse",value:function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var i=e[r];e[r]=e[t-r],e[t-r]=i}}},{key:"removeNull",value:function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n]&&t++;var r=new Array(t).fill(null);if(0===t)return r;for(var i=0,a=0;a<e.length;a++)null!==e[a]&&(r[i++]=e[a]);return r}},{key:"copyDeep",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=e[n].copy();return t}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],o=arguments[4],l=0;l<o;l++)a[s+l]=r[i+l].copy()}},{key:"isEqualReversed",value:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[e.length-n-1];if(0!==r.compareTo(i))return!1}return!0}},{key:"envelope",value:function(e){for(var t=new V,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t}},{key:"toCoordinateArray",value:function(t){return t.toArray(e.coordArrayType)}},{key:"dimension",value:function(e){if(null===e||0===e.length)return 3;var t,n=0,r=s(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n=Math.max(n,We.dimension(i))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"atLeastNCoordinatesOrNothing",value:function(e,t){return t.length>=e?t:[]}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1}},{key:"increasingDirection",value:function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(0!==r)return r}return 1}},{key:"compare",value:function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(0!==r)return r;n++}return n<t.length?-1:n<e.length?1:0}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.length;n++)(null===t||t.compareTo(e[n])>0)&&(t=e[n]);return t}},{key:"extract",value:function(e,t,n){t=be.clamp(t,0,e.length);var r=(n=be.clamp(n,-1,e.length))-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var a=0,s=t;s<=n;s++)i[a++]=e[s];return i}}])}(),Xe=a(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,r=t;return Ke.compare(n,r)}},{key:"interfaces_",get:function(){return[L]}}]),Ye=a(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=Ke.compare(n,r);return Ke.isEqualReversed(n,r)?0:i}},{key:"OLDcompare",value:function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=Ke.increasingDirection(n),a=Ke.increasingDirection(r),s=i>0?0:n.length-1,o=a>0?0:n.length-1,l=0;l<n.length;l++){var c=n[s].compareTo(r[o]);if(0!==c)return c;s+=i,o+=a}return 0}},{key:"interfaces_",get:function(){return[L]}}]);Ke.ForwardComparator=Xe,Ke.BidirectionalComparator=Ye,Ke.coordArrayType=new Array(0).fill(null);var Je=a(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),Ze=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getM",value:function(e){return this.hasM()?this._coordinates[e].getM():R.NaN}},{key:"setOrdinate",value:function(e,t,n){switch(t){case ue.X:this._coordinates[e].x=n;break;case ue.Y:this._coordinates[e].y=n;break;default:this._coordinates[e].setOrdinate(t,n)}}},{key:"getZ",value:function(e){return this.hasZ()?this._coordinates[e].getZ():R.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(e,t){switch(t){case ue.X:return this._coordinates[e].x;case ue.Y:return this._coordinates[e].y;default:return this._coordinates[e].getOrdinate(t)}}},{key:"getCoordinate",value:function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}},{key:"getCoordinateCopy",value:function(e){var t=this.createCoordinate();return t.setCoordinate(this._coordinates[e]),t}},{key:"createCoordinate",value:function(){return We.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(e){return this._coordinates[e].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e}},{key:"copy",value:function(){for(var t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++){var r=this.createCoordinate();r.setCoordinate(this._coordinates[n]),t[n]=r}return new e(t,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var e=new Je(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"}},{key:"getY",value:function(e){return this._coordinates[e].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ue,_]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];e.constructor_.call(this,t,Ke.dimension(t),Ke.measures(t))}else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var r=0;r<n;r++)this._coordinates[r]=new H}else if(ie(arguments[0],ue)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._measures=i.getMeasures(),this._coordinates=new Array(i.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)this._coordinates[a]=i.getCoordinateCopy(a)}}else if(2===arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var s=arguments[0],o=arguments[1];e.constructor_.call(this,s,o,Ke.measures(s))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],c=arguments[1];this._coordinates=new Array(l).fill(null),this._dimension=c;for(var u=0;u<l;u++)this._coordinates[u]=We.create(c)}}else if(3===arguments.length)if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var h=arguments[0],d=arguments[1],A=arguments[2];this._dimension=d,this._measures=A,this._coordinates=null===h?new Array(0).fill(null):h}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var p=arguments[0],f=arguments[1],g=arguments[2];this._coordinates=new Array(p).fill(null),this._dimension=f,this._measures=g;for(var m=0;m<p;m++)this._coordinates[m]=this.createCoordinate()}}}])}(),$e=function(){function e(){n(this,e)}return a(e,[{key:"readResolve",value:function(){return e.instance()}},{key:"create",value:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Ze(arguments[0]);if(ie(arguments[0],ue))return new Ze(arguments[0])}else{if(2===arguments.length){var e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new Ze(arguments[0],e)}if(3===arguments.length){var t=arguments[2],n=arguments[1]-t;return t>1&&(t=1),n>3&&(n=3),n<2&&(n=2),new Ze(arguments[0],n+t,t)}}}},{key:"interfaces_",get:function(){return[we,_]}}],[{key:"instance",value:function(){return e.instanceObject}}])}();$e.instanceObject=new $e;var et=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(r,"equalsExact",this,1).call(this,e,t)}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return G.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new fe,t=0;t<this._geometries.length;t++)for(var n=this._geometries[t].getBoundary(),r=0;r<n.getNumGeometries();r++)e.add(n.getGeometryN(r));var i=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(i))}},{key:"getGeometryType",value:function(){return G.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Le]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];je.constructor_.call(this,e,t)}}])}(je),tt=a(function e(){n(this,e)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),nt=function(e){function r(){var e;return n(this,r),(e=t(this,r)).map=new Map,e}return c(r,e),a(r,[{key:"get",value:function(e){return this.map.get(e)||null}},{key:"put",value:function(e,t){return this.map.set(e,t),t}},{key:"values",value:function(){for(var e=new fe,t=this.map.values(),n=t.next();!n.done;)e.add(n.value),n=t.next();return e}},{key:"entrySet",value:function(){var e=new J;return this.map.entries().forEach(function(t){return e.add(t)}),e}},{key:"size",value:function(){return this.map.size()}}])}(tt),rt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this._modelType===n._modelType&&this._scale===n._scale}},{key:"compareTo",value:function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return se.compare(n,r)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===e.FLOATING||this._modelType===e.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var t="UNKNOWN";return this._modelType===e.FLOATING?t="Floating":this._modelType===e.FLOATING_SINGLE?t="Floating-Single":this._modelType===e.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}},{key:"makePrecise",value:function(){if("number"==typeof arguments[0]){var t=arguments[0];return R.isNaN(t)||this._modelType===e.FLOATING_SINGLE?t:this._modelType===e.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof H){var n=arguments[0];if(this._modelType===e.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}}},{key:"getMaximumSignificantDigits",value:function(){var t=16;return this._modelType===e.FLOATING?t=16:this._modelType===e.FLOATING_SINGLE?t=6:this._modelType===e.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}},{key:"setScale",value:function(e){this._scale=Math.abs(e)}},{key:"interfaces_",get:function(){return[_,x]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof it){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},{key:"mostPrecise",value:function(e,t){return e.compareTo(t)>=0?e:t}}])}(),it=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"readResolve",value:function(){return e.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[_]}}],[{key:"constructor_",value:function(){this._name=null;var t=arguments[0];this._name=t,e.nameToTypeMap.put(t,this)}}])}();it.nameToTypeMap=new nt,rt.Type=it,rt.FIXED=new it("FIXED"),rt.FLOATING=new it("FLOATING"),rt.FLOATING_SINGLE=new it("FLOATING SINGLE"),rt.maximumPreciseValue=9007199254740992;var at=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof G){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(r,"equalsExact",this,1).call(this,e,t)}return d(r,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ne.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return G.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new X}},{key:"getGeometryType",value:function(){return G.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Ce]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];je.constructor_.call(this,e,t)}}])}(je),st=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"createEmpty",value:function(e){switch(e){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new v("Invalid dimension: "+e)}}},{key:"toGeometry",value:function(e){return e.isNull()?this.createPoint():e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new H(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new H(e.getMinX(),e.getMinY()),new H(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new H(e.getMinX(),e.getMinY()),new H(e.getMinX(),e.getMaxY()),new H(e.getMaxX(),e.getMaxY()),new H(e.getMaxX(),e.getMinY()),new H(e.getMinX(),e.getMinY())]),null)}},{key:"createLineString",value:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(ie(arguments[0],ue))return new Te(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return 0===arguments.length?new at(null,this):1===arguments.length?new at(arguments[0],this):void 0}},{key:"buildGeometry",value:function(t){for(var n=null,r=!1,i=!1,a=t.iterator();a.hasNext();){var s=a.next(),o=s.getTypeCode();null===n&&(n=o),o!==n&&(r=!0),s instanceof je&&(i=!0)}if(null===n)return this.createGeometryCollection();if(r||i)return this.createGeometryCollection(e.toGeometryArray(t));var l=t.iterator().next();if(t.size()>1){if(l instanceof Pe)return this.createMultiPolygon(e.toPolygonArray(t));if(l instanceof Te)return this.createMultiLineString(e.toLineStringArray(t));if(l instanceof Me)return this.createMultiPoint(e.toPointArray(t));D.shouldNeverReachHere("Unhandled geometry type: "+l.getGeometryType())}return l}},{key:"createMultiPointFromCoords",value:function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}},{key:"createPoint",value:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof H){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(ie(arguments[0],ue))return new Me(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(ie(arguments[0],ue)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof He){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Pe(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return 0===arguments.length?new je(null,this):1===arguments.length?new je(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(ie(arguments[0],ue))return new He(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return 0===arguments.length?new et(null,this):1===arguments.length?new et(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(0===arguments.length)return new ze(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new ze(arguments[0],this);if(ie(arguments[0],ue)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var t=new Array(e.size()).fill(null),n=0;n<e.size();n++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension(),e.getMeasures());Ee.copy(e,n,r,0,1),t[n]=this.createPoint(r)}return this.createMultiPoint(t)}}}},{key:"interfaces_",get:function(){return[_]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,0===arguments.length)e.constructor_.call(this,new rt,0);else if(1===arguments.length){if(ie(arguments[0],we)){var t=arguments[0];e.constructor_.call(this,new rt,0,t)}else if(arguments[0]instanceof rt){var n=arguments[0];e.constructor_.call(this,n,0,e.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];e.constructor_.call(this,r,i,e.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2];this._precisionModel=a,this._coordinateSequenceFactory=o,this._SRID=s}}},{key:"toMultiPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toGeometryArray",value:function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return $e.instance()}},{key:"toMultiLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toMultiPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLinearRingArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"createPointFromInternalCoord",value:function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)}}])}(),ot="XY",lt="XYZ",ct="XYM",ut="XYZM",ht={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},dt="EMPTY",At=1,pt=2,ft=3,gt=4,mt=5,yt=6;for(var vt in ht)ht[vt].toUpperCase();var bt=a(function e(t){n(this,e),this.wkt=t,this.index_=-1},[{key:"isAlpha_",value:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}},{key:"isNumeric_",value:function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)}},{key:"isWhiteSpace_",value:function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var e,t=this.nextChar_(),n=this.index_,r=t;if("("==t)e=pt;else if(","==t)e=mt;else if(")"==t)e=ft;else if(this.isNumeric_(t)||"-"==t)e=gt,r=this.readNumber_();else if(this.isAlpha_(t))e=At,r=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e=yt}return{position:n,value:r,type:e}}},{key:"readNumber_",value:function(){var e,t=this.index_,n=!1,r=!1;do{"."==e?n=!0:"e"!=e&&"E"!=e||(r=!0),e=this.nextChar_()}while(this.isNumeric_(e,n)||!r&&("e"==e||"E"==e)||r&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}},{key:"readText_",value:function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}]),xt=a(function e(t,r){n(this,e),this.lexer_=t,this.token_,this.layout_=ot,this.factory=r},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(e){return this.token_.type==e}},{key:"match",value:function(e){var t=this.isTokenType(e);return t&&this.consume_(),t}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var e=ot,t=this.token_;if(this.isTokenType(At)){var n=t.value;"Z"===n?e=lt:"M"===n?e=ct:"ZM"===n&&(e=ut),e!==ot&&this.consume_()}return e}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(pt)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(mt));if(this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(pt)){var e=this.parsePoint_();if(this.match(ft))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(pt)){var e=this.parsePointList_();if(this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(pt)){var e=this.parseLineStringTextList_();if(this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var e;if(this.match(pt)){if(e=this.token_.type==pt?this.parsePointTextList_():this.parsePointList_(),this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(pt)){var e=this.parseLineStringTextList_();if(this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(pt)){var e=this.parsePolygonTextList_();if(this.match(ft))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var e=[],t=this.layout_.length,n=0;n<t;++n){var r=this.token_;if(!this.match(gt))break;e.push(r.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var e=[this.parsePoint_()];this.match(mt);)e.push(this.parsePoint_());return e}},{key:"parsePointTextList_",value:function(){for(var e=[this.parsePointText_()];this.match(mt);)e.push(this.parsePointText_());return e}},{key:"parseLineStringTextList_",value:function(){for(var e=[this.parseLineStringText_()];this.match(mt);)e.push(this.parseLineStringText_());return e}},{key:"parsePolygonTextList_",value:function(){for(var e=[this.parsePolygonText_()];this.match(mt);)e.push(this.parsePolygonText_());return e}},{key:"isEmptyGeometry_",value:function(){var e=this.isTokenType(At)&&this.token_.value==dt;return e&&this.consume_(),e}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var e=this.factory,t=function(e){return r(H,A(e))},n=function(n){var r=n.map(function(n){return e.createLinearRing(n.map(t))});return r.length>1?e.createPolygon(r[0],r.slice(1)):e.createPolygon(r[0])},i=this.token_;if(this.match(At)){var a=i.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==a){var s=this.parseGeometryCollectionText_();return e.createGeometryCollection(s)}switch(a){case"POINT":var o=this.parsePointText_();return o?e.createPoint(r(H,A(o))):e.createPoint();case"LINESTRING":var l=this.parseLineStringText_().map(t);return e.createLineString(l);case"LINEARRING":var c=this.parseLineStringText_().map(t);return e.createLinearRing(c);case"POLYGON":var u=this.parsePolygonText_();return u&&0!==u.length?n(u):e.createPolygon();case"MULTIPOINT":var h=this.parseMultiPointText_();if(!h||0===h.length)return e.createMultiPoint();var d=h.map(t).map(function(t){return e.createPoint(t)});return e.createMultiPoint(d);case"MULTILINESTRING":var p=this.parseMultiLineStringText_().map(function(n){return e.createLineString(n.map(t))});return e.createMultiLineString(p);case"MULTIPOLYGON":var f=this.parseMultiPolygonText_();if(!f||0===f.length)return e.createMultiPolygon();var g=f.map(n);return e.createMultiPolygon(g);default:throw new Error("Invalid geometry type: "+a)}}throw new Error(this.formatErrorMessage_())}}]);function wt(e){if(e.isEmpty())return"";var t=e.getCoordinate(),n=[t.x,t.y];return void 0===t.z||Number.isNaN(t.z)||n.push(t.z),void 0===t.m||Number.isNaN(t.m)||n.push(t.m),n.join(" ")}function _t(e){for(var t=e.getCoordinates().map(function(e){var t=[e.x,e.y];return void 0===e.z||Number.isNaN(e.z)||t.push(e.z),void 0===e.m||Number.isNaN(e.m)||t.push(e.m),t}),n=[],r=0,i=t.length;r<i;++r)n.push(t[r].join(" "));return n.join(", ")}function St(e){var t=[];t.push("("+_t(e.getExteriorRing())+")");for(var n=0,r=e.getNumInteriorRing();n<r;++n)t.push("("+_t(e.getInteriorRingN(n))+")");return t.join(", ")}var Ct={Point:wt,LineString:_t,LinearRing:_t,Polygon:St,MultiPoint:function(e){for(var t=[],n=0,r=e.getNumGeometries();n<r;++n)t.push("("+wt(e.getGeometryN(n))+")");return t.join(", ")},MultiLineString:function(e){for(var t=[],n=0,r=e.getNumGeometries();n<r;++n)t.push("("+_t(e.getGeometryN(n))+")");return t.join(", ")},MultiPolygon:function(e){for(var t=[],n=0,r=e.getNumGeometries();n<r;++n)t.push("("+St(e.getGeometryN(n))+")");return t.join(", ")},GeometryCollection:function(e){for(var t=[],n=0,r=e.getNumGeometries();n<r;++n)t.push(Et(e.getGeometryN(n)));return t.join(", ")}};function Et(e){var t=e.getGeometryType(),n=Ct[t];t=t.toUpperCase();var r=function(e){var t="";if(e.isEmpty())return t;var n=e.getCoordinate();return void 0===n.z||Number.isNaN(n.z)||(t+="Z"),void 0===n.m||Number.isNaN(n.m)||(t+="M"),t}(e);return r.length>0&&(t+=" "+r),e.isEmpty()?t+" "+dt:t+" ("+n(e)+")"}var Nt=a(function e(t){n(this,e),this.geometryFactory=t||new st,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(e){var t=new bt(e);return new xt(t,this.geometryFactory).parse()}},{key:"write",value:function(e){return Et(e)}}]),kt=a(function e(t){n(this,e),this.parser=new Nt(t)},[{key:"write",value:function(e){return this.parser.write(e)}}],[{key:"toLineString",value:function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"}}]),It=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getIndexAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]}},{key:"getTopologySummary",value:function(){var e=new Je;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()}},{key:"computeIntersection",value:function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"isInteriorIntersection",value:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}}},{key:"getIntersection",value:function(e){return this._intPt[e]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==e.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(t,n){return e.computeEdgeDistance(this._intPt[n],this._inputLines[t][0],this._inputLines[t][1])}},{key:"isCollinear",value:function(){return this._result===e.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return kt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+kt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(e,t){return this._inputLines[e][t]}},{key:"isIntersection",value:function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new H,this._intPt[1]=new H,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(e,t,n){var r=Math.abs(n.x-t.x),i=Math.abs(n.y-t.y),a=-1;if(e.equals(t))a=0;else if(e.equals(n))a=r>i?r:i;else{var s=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);0!==(a=r>i?s:o)||e.equals(t)||(a=Math.max(s,o))}return D.isTrue(!(0===a&&!e.equals(t)),"Bad distance calculation"),a}},{key:"nonRobustComputeEdgeDistance",value:function(e,t,n){var r=e.x-t.x,i=e.y-t.y,a=Math.sqrt(r*r+i*i);return D.isTrue(!(0===a&&!e.equals(t)),"Invalid distance calculation"),a}}])}();It.DONT_INTERSECT=0,It.DO_INTERSECT=1,It.COLLINEAR=2,It.NO_INTERSECTION=0,It.POINT_INTERSECTION=1,It.COLLINEAR_INTERSECTION=2;var Tt=function(e){function r(){return n(this,r),t(this,r)}return c(r,e),a(r,[{key:"isInSegmentEnvelopes",value:function(e){var t=new V(this._inputLines[0][0],this._inputLines[0][1]),n=new V(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&n.contains(e)}},{key:"computeIntersection",value:function(){if(3!==arguments.length)return d(r,"computeIntersection",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1],n=arguments[2];if(this._isProper=!1,V.intersects(t,n,e)&&0===he.index(t,n,e)&&0===he.index(n,t,e))return this._isProper=!0,(e.equals(t)||e.equals(n))&&(this._isProper=!1),this._result=It.POINT_INTERSECTION,null;this._result=It.NO_INTERSECTION}},{key:"intersection",value:function(e,t,n,i){var a=this.intersectionSafe(e,t,n,i);return this.isInSegmentEnvelopes(a)||(a=new H(r.nearestEndpoint(e,t,n,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(a),a}},{key:"checkDD",value:function(e,t,n,r,i){var a=ce.intersection(e,t,n,r),s=this.isInSegmentEnvelopes(a);ve.out.println("DD in env = "+s+"  --------------------- "+a),i.distance(a)>1e-4&&ve.out.println("Distance = "+i.distance(a))}},{key:"intersectionSafe",value:function(e,t,n,i){var a=ye.intersection(e,t,n,i);return null===a&&(a=r.nearestEndpoint(e,t,n,i)),a}},{key:"computeCollinearIntersection",value:function(e,t,n,r){var i=V.intersects(e,t,n),a=V.intersects(e,t,r),s=V.intersects(n,r,e),o=V.intersects(n,r,t);return i&&a?(this._intPt[0]=n,this._intPt[1]=r,It.COLLINEAR_INTERSECTION):s&&o?(this._intPt[0]=e,this._intPt[1]=t,It.COLLINEAR_INTERSECTION):i&&s?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||a||o?It.COLLINEAR_INTERSECTION:It.POINT_INTERSECTION):i&&o?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||a||s?It.COLLINEAR_INTERSECTION:It.POINT_INTERSECTION):a&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||i||o?It.COLLINEAR_INTERSECTION:It.POINT_INTERSECTION):a&&o?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||i||s?It.COLLINEAR_INTERSECTION:It.POINT_INTERSECTION):It.NO_INTERSECTION}},{key:"computeIntersect",value:function(e,t,n,r){if(this._isProper=!1,!V.intersects(e,t,n,r))return It.NO_INTERSECTION;var i=he.index(e,t,n),a=he.index(e,t,r);if(i>0&&a>0||i<0&&a<0)return It.NO_INTERSECTION;var s=he.index(n,r,e),o=he.index(n,r,t);return s>0&&o>0||s<0&&o<0?It.NO_INTERSECTION:0===i&&0===a&&0===s&&0===o?this.computeCollinearIntersection(e,t,n,r):(0===i||0===a||0===s||0===o?(this._isProper=!1,e.equals2D(n)||e.equals2D(r)?this._intPt[0]=e:t.equals2D(n)||t.equals2D(r)?this._intPt[0]=t:0===i?this._intPt[0]=new H(n):0===a?this._intPt[0]=new H(r):0===s?this._intPt[0]=new H(e):0===o&&(this._intPt[0]=new H(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,n,r)),It.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(e,t,n,r){var i=e,a=xe.pointToSegment(e,n,r),s=xe.pointToSegment(t,n,r);return s<a&&(a=s,i=t),(s=xe.pointToSegment(n,e,t))<a&&(a=s,i=n),(s=xe.pointToSegment(r,e,t))<a&&(a=s,i=r),i}}])}(It),Bt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"countSegment",value:function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var i=he.index(e,t,this._p);if(i===he.COLLINEAR)return this._isPointOnSegment=!0,null;t.y<e.y&&(i=-i),i===he.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==W.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?W.BOUNDARY:this._crossingCount%2==1?W.INTERIOR:W.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof H&&ie(arguments[1],ue)){for(var t=arguments[1],n=new e(arguments[0]),r=new H,i=new H,a=1;a<t.size();a++)if(t.getCoordinate(a,r),t.getCoordinate(a-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof H&&arguments[1]instanceof Array){for(var s=arguments[1],o=new e(arguments[0]),l=1;l<s.length;l++){var c=s[l],u=s[l-1];if(o.countSegment(c,u),o.isOnSegment())return o.getLocation()}return o.getLocation()}}}])}(),Mt=function(){function e(){n(this,e)}return a(e,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof H&&ie(arguments[1],ue)){for(var e=arguments[0],t=arguments[1],n=new Tt,r=new H,i=new H,a=t.size(),s=1;s<a;s++)if(t.getCoordinate(s-1,r),t.getCoordinate(s,i),n.computeIntersection(e,r,i),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof H&&arguments[1]instanceof Array){for(var o=arguments[0],l=arguments[1],c=new Tt,u=1;u<l.length;u++){var h=l[u-1],d=l[u];if(c.computeIntersection(o,h,d),c.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(e,t){return Bt.locatePointInRing(e,t)}},{key:"isInRing",value:function(t,n){return e.locateInRing(t,n)!==W.EXTERIOR}}])}(),Ft=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"setAllLocations",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e}},{key:"isNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==W.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]===W.NONE&&(this.location[t]=e)}},{key:"isLine",value:function(){return 1===this.location.length}},{key:"merge",value:function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[$.ON]=this.location[$.ON],t[$.LEFT]=W.NONE,t[$.RIGHT]=W.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===W.NONE&&n<e.location.length&&(this.location[n]=e.location[n])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var e=this.location[$.LEFT];this.location[$.LEFT]=this.location[$.RIGHT],this.location[$.RIGHT]=e}},{key:"toString",value:function(){var e=new ae;return this.location.length>1&&e.append(W.toLocationSymbol(this.location[$.LEFT])),e.append(W.toLocationSymbol(this.location[$.ON])),this.location.length>1&&e.append(W.toLocationSymbol(this.location[$.RIGHT])),e.toString()}},{key:"setLocations",value:function(e,t,n){this.location[$.ON]=e,this.location[$.LEFT]=t,this.location[$.RIGHT]=n}},{key:"get",value:function(e){return e<this.location.length?this.location[e]:W.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===W.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(1===arguments.length){var e=arguments[0];this.setLocation($.ON,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}}},{key:"init",value:function(e){this.location=new Array(e).fill(null),this.setAllLocations(W.NONE)}},{key:"isEqualOnSide",value:function(e,t){return this.location[t]===e.location[t]}},{key:"allPositionsEqual",value:function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[$.ON]=n}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var i=0;i<this.location.length;i++)this.location[i]=r.location[i]}}else if(3===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2];this.init(3),this.location[$.ON]=a,this.location[$.LEFT]=s,this.location[$.RIGHT]=o}}}])}(),Rt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getGeometryCount",value:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e}},{key:"setAllLocations",value:function(e,t){this.elt[e].setAllLocations(t)}},{key:"isNull",value:function(e){return this.elt[e].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}}},{key:"isLine",value:function(e){return this.elt[e].isLine()}},{key:"merge",value:function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new Ft(e.elt[t]):this.elt[t].merge(e.elt[t])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get($.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}}},{key:"toString",value:function(){var e=new ae;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()}},{key:"isArea",value:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}}},{key:"isAnyNull",value:function(e){return this.elt[e].isAnyNull()}},{key:"setLocation",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation($.ON,t)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}}},{key:"isEqualOnSide",value:function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)}},{key:"allPositionsEqual",value:function(e,t){return this.elt[e].allPositionsEqual(t)}},{key:"toLine",value:function(e){this.elt[e].isArea()&&(this.elt[e]=new Ft(this.elt[e].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Ft(t),this.elt[1]=new Ft(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Ft(n.elt[0]),this.elt[1]=new Ft(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Ft(W.NONE),this.elt[1]=new Ft(W.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2];this.elt[0]=new Ft(a,s,o),this.elt[1]=new Ft(a,s,o)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Ft(W.NONE,W.NONE,W.NONE),this.elt[1]=new Ft(W.NONE,W.NONE,W.NONE),this.elt[l].setLocations(c,u,h)}}},{key:"toLineLabel",value:function(t){for(var n=new e(W.NONE),r=0;r<2;r++)n.setLocation(r,t.getLocation(r));return n}}])}(),Lt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=he.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"computePoints",value:function(e){this._startDe=e;var t=e,n=!0;do{if(null===t)throw new Ae("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Ae("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var r=t.getLabel();D.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(e){return this._pts.get(e)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(e,t,n){var r=e.getCoordinates();if(t){var i=1;n&&(i=0);for(var a=i;a<r.length;a++)this._pts.add(r[a])}else{var s=r.length-2;n&&(s=r.length-1);for(var o=s;o>=0;o--)this._pts.add(r[o])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)}},{key:"containsPoint",value:function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!Mt.isInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(e))return!1;return!0}},{key:"addHole",value:function(e){this._holes.add(e)}},{key:"isShell",value:function(){return null===this._shell}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[1],n=arguments[0].getLocation(t,$.RIGHT);if(n===W.NONE)return null;if(this._label.getLocation(t)===W.NONE)return this._label.setLocation(t,n),null}}},{key:"setShell",value:function(e){this._shell=e,null!==e&&e.addHole(this)}},{key:"toPolygon",value:function(e){for(var t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=this._holes.get(n).getLinearRing();return e.createPolygon(this.getLinearRing(),t)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new fe,this._pts=new fe,this._label=new Rt(W.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new fe,this._geometryFactory=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()}}}]),Pt=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"setEdgeRing",value:function(e,t){e.setMinEdgeRing(t)}},{key:"getNext",value:function(e){return e.getNextMin()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Lt.constructor_.call(this,e,t)}}])}(Lt),Ut=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"buildMinimalRings",value:function(){var e=new fe,t=this._startDe;do{if(null===t.getMinEdgeRing()){var n=new Pt(t,this._geometryFactory);e.add(n)}t=t.getNext()}while(t!==this._startDe);return e}},{key:"setEdgeRing",value:function(e,t){e.setEdgeRing(t)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)}},{key:"getNext",value:function(e){return e.getNext()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Lt.constructor_.call(this,e,t)}}])}(Lt),Dt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(e){this._isVisited=e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(e){this._label=e}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(e){this._isCovered=e,this._isCoveredSet=!0}},{key:"updateIM",value:function(e){D.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}}}]),Ot=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"isIncidentEdgeInResult",value:function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(e){e.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(e){}},{key:"computeMergedLocation",value:function(e,t){var n=W.NONE;if(n=this._label.getLocation(t),!e.isNull(t)){var r=e.getLocation(t);n!==W.BOUNDARY&&(n=r)}return n}},{key:"setLabel",value:function(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return d(r,"setLabel",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];null===this._label?this._label=new Rt(e,t):this._label.setLocation(e,t)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof r){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof Rt)for(var t=arguments[0],n=0;n<2;n++){var i=this.computeMergedLocation(t,n);this._label.getLocation(n)===W.NONE&&this._label.setLocation(n,i)}}},{key:"add",value:function(e){this._edges.insert(e),e.setNode(this)}},{key:"setLabelBoundary",value:function(e){if(null===this._label)return null;var t=W.NONE;null!==this._label&&(t=this._label.getLocation(e));var n=null;switch(t){case W.BOUNDARY:n=W.INTERIOR;break;case W.INTERIOR:default:n=W.BOUNDARY}this._label.setLocation(e,n)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new Rt(0,W.NONE)}}])}(Dt),jt=function(e){function r(){return n(this,r),t(this,r,arguments)}return c(r,e),a(r)}(tt);function zt(e){return null==e?0:e.color}function Ht(e){return null==e?null:e.parent}function Qt(e,t){null!==e&&(e.color=t)}function Vt(e){return null==e?null:e.left}function Gt(e){return null==e?null:e.right}var Wt=function(e){function r(){var e;return n(this,r),(e=t(this,r)).root_=null,e.size_=0,e}return c(r,e),a(r,[{key:"get",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null}},{key:"put",value:function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=e.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var a=i.value;return i.value=t,a}i=i.right}}while(null!==i);var s={key:e,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null}},{key:"fixAfterInsertion",value:function(e){var t;for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)Ht(e)===Vt(Ht(Ht(e)))?1===zt(t=Gt(Ht(Ht(e))))?(Qt(Ht(e),0),Qt(t,0),Qt(Ht(Ht(e)),1),e=Ht(Ht(e))):(e===Gt(Ht(e))&&(e=Ht(e),this.rotateLeft(e)),Qt(Ht(e),0),Qt(Ht(Ht(e)),1),this.rotateRight(Ht(Ht(e)))):1===zt(t=Vt(Ht(Ht(e))))?(Qt(Ht(e),0),Qt(t,0),Qt(Ht(Ht(e)),1),e=Ht(Ht(e))):(e===Vt(Ht(e))&&(e=Ht(e),this.rotateRight(e)),Qt(Ht(e),0),Qt(Ht(Ht(e)),1),this.rotateLeft(Ht(Ht(e))));this.root_.color=0}},{key:"values",value:function(){var e=new fe,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=r.successor(t));)e.add(t.value);return e}},{key:"entrySet",value:function(){var e=new J,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=r.successor(t));)e.add(t);return e}},{key:"rotateLeft",value:function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}}},{key:"rotateRight",value:function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}}},{key:"getFirstEntry",value:function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return!0;t=t.right}}return!1}}],[{key:"successor",value:function(e){var t;if(null===e)return null;if(null!==e.right){for(t=e.right;null!==t.left;)t=t.left;return t}t=e.parent;for(var n=e;null!==t&&n===t.right;)n=t,t=t.parent;return t}}])}(jt),qt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"find",value:function(e){return this.nodeMap.get(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof H){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof Ot){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}}},{key:"print",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(e){for(var t=new fe,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===W.BOUNDARY&&t.add(r)}return t}},{key:"add",value:function(e){var t=e.getCoordinate();this.addNode(t).add(e)}}],[{key:"constructor_",value:function(){this.nodeMap=new Wt,this.nodeFact=null;var e=arguments[0];this.nodeFact=e}}]),Kt=function(){function e(){n(this,e)}return a(e,null,[{key:"isNorthern",value:function(t){return t===e.NE||t===e.NW}},{key:"isOpposite",value:function(e,t){return e!==t&&2===(e-t+4)%4}},{key:"commonHalfPlane",value:function(e,t){if(e===t)return e;if(2===(e-t+4)%4)return-1;var n=e<t?e:t;return 0===n&&3===(e>t?e:t)?3:n}},{key:"isInHalfPlane",value:function(t,n){return n===e.SE?t===e.SE||t===e.SW:t===n||t===n+1}},{key:"quadrant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new v("Cannot compute the quadrant for point ( "+t+", "+n+" )");return t>=0?n>=0?e.NE:e.SE:n>=0?e.NW:e.SW}if(arguments[0]instanceof H&&arguments[1]instanceof H){var r=arguments[0],i=arguments[1];if(i.x===r.x&&i.y===r.y)throw new v("Cannot compute the quadrant for two identical points "+r);return i.x>=r.x?i.y>=r.y?e.NE:e.SE:i.y>=r.y?e.NW:e.SW}}}])}();Kt.NE=0,Kt.NW=1,Kt.SW=2,Kt.SE=3;var Xt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compareDirection",value:function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:he.index(e._p0,e._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(e){this._node=e}},{key:"print",value:function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);e.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)}},{key:"compareTo",value:function(e){var t=e;return this.compareDirection(t)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label}},{key:"computeLabel",value:function(e){}},{key:"init",value:function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Kt.quadrant(this._dx,this._dy),D.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];e.constructor_.call(this,n,r,i,null)}else if(4===arguments.length){var a=arguments[0],s=arguments[1],o=arguments[2],l=arguments[3];e.constructor_.call(this,a),this.init(s,o),this._label=l}}}])}(),Yt=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(e){return this._depth[e]}},{key:"setVisited",value:function(e){this._isVisited=e}},{key:"computeDirectedLabel",value:function(){this._label=new Rt(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new Ae("assigned depths do not match",this.getCoordinate());this._depth[e]=t}},{key:"isInteriorAreaEdge",value:function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,$.LEFT)===W.INTERIOR&&this._label.getLocation(t,$.RIGHT)===W.INTERIOR||(e=!1);return e}},{key:"setNextMin",value:function(e){this._nextMin=e}},{key:"print",value:function(e){d(r,"print",this,1).call(this,e),e.print(" "+this._depth[$.LEFT]+"/"+this._depth[$.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")}},{key:"setMinEdgeRing",value:function(e){this._minEdgeRing=e}},{key:"isLineEdge",value:function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,W.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,W.EXTERIOR);return e&&t&&n}},{key:"setEdgeRing",value:function(e){this._edgeRing=e}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)}},{key:"setSym",value:function(e){this._sym=e}},{key:"setVisitedEdge",value:function(e){this.setVisited(e),this._sym.setVisited(e)}},{key:"setEdgeDepths",value:function(e,t){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;e===$.LEFT&&(r=-1);var i=$.opposite(e),a=t+n*r;this.setDepth(e,t),this.setDepth(i,a)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(e){this._next=e}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var e=arguments[0],t=arguments[1];if(Xt.constructor_.call(this,e),this._isForward=t,t)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(e,t){return e===W.EXTERIOR&&t===W.INTERIOR?1:e===W.INTERIOR&&t===W.EXTERIOR?-1:0}}])}(Xt),Jt=a(function e(){n(this,e)},[{key:"createNode",value:function(e){return new Ot(e,null)}}]),Zt=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var n=this._edges.get(t);n.print(e),n.eiList.print(e)}}},{key:"find",value:function(e){return this._nodes.find(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ot){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof H){var t=arguments[0];return this._nodes.addNode(t)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(e){ve.out.println(e)}},{key:"isBoundaryNode",value:function(e,t){var n=this._nodes.find(t);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(e)===W.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(e,t,n,r){return!!e.equals(n)&&he.index(e,t,r)===he.COLLINEAR&&Kt.quadrant(e,t)===Kt.quadrant(n,r)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(e){ve.out.print(e)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(this.matchInSameDirection(e,t,i[0],i[1]))return r;if(this.matchInSameDirection(e,t,i[i.length-1],i[i.length-2]))return r}return null}},{key:"insertEdge",value:function(e){this._edges.add(e)}},{key:"findEdgeEnd",value:function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null}},{key:"addEdges",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this._edges.add(n);var r=new Yt(n,!0),i=new Yt(n,!1);r.setSym(i),i.setSym(r),this.add(r),this.add(i)}}},{key:"add",value:function(e){this._nodes.add(e),this._edgeEndList.add(e)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(e.equals(i[0])&&t.equals(i[1]))return r}return null}}],[{key:"constructor_",value:function(){if(this._edges=new fe,this._nodes=null,this._edgeEndList=new fe,0===arguments.length)this._nodes=new qt(new Jt);else if(1===arguments.length){var e=arguments[0];this._nodes=new qt(e)}}},{key:"linkResultDirectedEdges",value:function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}}]),$t=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"sortShellsAndHoles",value:function(e,t,n){for(var r=e.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):t.add(i)}}},{key:"computePolygons",value:function(e){for(var t=new fe,n=e.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);t.add(r)}return t}},{key:"placeFreeHoles",value:function(t,n){for(var r=n.iterator();r.hasNext();){var i=r.next();if(null===i.getShell()){var a=e.findEdgeRingContaining(i,t);if(null===a)throw new Ae("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(a)}}}},{key:"buildMinimalEdgeRings",value:function(e,t,n){for(var r=new fe,i=e.iterator();i.hasNext();){var a=i.next();if(a.getMaxNodeDegree()>2){a.linkDirectedEdgesForMinimalEdgeRings();var s=a.buildMinimalRings(),o=this.findShell(s);null!==o?(this.placePolygonHoles(o,s),t.add(o)):n.addAll(s)}else r.add(a)}return r}},{key:"buildMaximalEdgeRings",value:function(e){for(var t=new fe,n=e.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new Ut(r,this._geometryFactory);t.add(i),i.setInResult()}}return t}},{key:"placePolygonHoles",value:function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,t++)}return D.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];Zt.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(t),i=new fe,a=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(a,this._shellList,i),this.placeFreeHoles(this._shellList,i)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new fe;var e=arguments[0];this._geometryFactory=e}},{key:"findEdgeRingContaining",value:function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),a=null,s=null,o=t.iterator();o.hasNext();){var l=o.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();if(!u.equals(r)&&u.contains(r)){i=Ke.ptNotInList(n.getCoordinates(),c.getCoordinates());var h=!1;Mt.isInRing(i,c.getCoordinates())&&(h=!0),h&&(null===a||s.contains(u))&&(s=(a=l).getLinearRing().getEnvelopeInternal())}}return a}}])}(),en=a(function e(){n(this,e)},[{key:"getBounds",value:function(){}}]),tn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[en,_]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t}}]),nn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(e){for(var t=null,n=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(n)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,n)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return 0===this._size}},{key:"add",value:function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new fe,this._items.add(null)}}]),rn=a(function e(){n(this,e)},[{key:"insert",value:function(e,t){}},{key:"remove",value:function(e,t){}},{key:"query",value:function(){}}]),an=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(e){D.isTrue(null===this._bounds),this._childBoundables.add(e)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[en,_]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new fe,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}}}]),sn={reverseOrder:function(){return{compare:function(e,t){return t.compareTo(e)}}},min:function(e){return sn.sort(e),e.get(0)},sort:function(e,t){var n=e.toArray();t?Re.sort(n,t):Re.sort(n);for(var r=e.iterator(),i=0,a=n.length;i<a;i++)r.next(),r.set(n[i])},singletonList:function(e){var t=new fe;return t.add(e),t}},on=function(){function e(){n(this,e)}return a(e,null,[{key:"maxDistance",value:function(t,n,r,i,a,s,o,l){var c=e.distance(t,n,a,s);return c=Math.max(c,e.distance(t,n,o,l)),c=Math.max(c,e.distance(r,i,a,s)),Math.max(c,e.distance(r,i,o,l))}},{key:"distance",value:function(e,t,n,r){var i=n-e,a=r-t;return Math.sqrt(i*i+a*a)}},{key:"maximumDistance",value:function(t,n){var r=Math.min(t.getMinX(),n.getMinX()),i=Math.min(t.getMinY(),n.getMinY()),a=Math.max(t.getMaxX(),n.getMaxX()),s=Math.max(t.getMaxY(),n.getMaxY());return e.distance(r,i,a,s)}},{key:"minMaxDistance",value:function(t,n){var r=t.getMinX(),i=t.getMinY(),a=t.getMaxX(),s=t.getMaxY(),o=n.getMinX(),l=n.getMinY(),c=n.getMaxX(),u=n.getMaxY(),h=e.maxDistance(r,i,r,s,o,l,o,u);return h=Math.min(h,e.maxDistance(r,i,r,s,o,l,c,l)),h=Math.min(h,e.maxDistance(r,i,r,s,c,u,o,u)),h=Math.min(h,e.maxDistance(r,i,r,s,c,u,c,l)),h=Math.min(h,e.maxDistance(r,i,a,i,o,l,o,u)),h=Math.min(h,e.maxDistance(r,i,a,i,o,l,c,l)),h=Math.min(h,e.maxDistance(r,i,a,i,c,u,o,u)),h=Math.min(h,e.maxDistance(r,i,a,i,c,u,c,l)),h=Math.min(h,e.maxDistance(a,s,r,s,o,l,o,u)),h=Math.min(h,e.maxDistance(a,s,r,s,o,l,c,l)),h=Math.min(h,e.maxDistance(a,s,r,s,c,u,o,u)),h=Math.min(h,e.maxDistance(a,s,r,s,c,u,c,l)),h=Math.min(h,e.maxDistance(a,s,a,i,o,l,o,u)),h=Math.min(h,e.maxDistance(a,s,a,i,o,l,c,l)),h=Math.min(h,e.maxDistance(a,s,a,i,c,u,o,u)),Math.min(h,e.maxDistance(a,s,a,i,c,u,c,l))}}])}(),ln=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"maximumDistance",value:function(){return on.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(t,n){var r=e.isComposite(this._boundable1),i=e.isComposite(this._boundable2);if(r&&i)return e.area(this._boundable1)>e.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,n),null):(this.expand(this._boundable2,this._boundable1,!0,t,n),null);if(r)return this.expand(this._boundable1,this._boundable2,!1,t,n),null;if(i)return this.expand(this._boundable2,this._boundable1,!0,t,n),null;throw new v("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(e.isComposite(this._boundable1)||e.isComposite(this._boundable2))}},{key:"compareTo",value:function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0}},{key:"expand",value:function(t,n,r,i,a){for(var s=t.getChildBoundables().iterator();s.hasNext();){var o=s.next(),l=null;(l=r?new e(n,o,this._itemDistance):new e(o,n,this._itemDistance)).getDistance()<a&&i.add(l)}}},{key:"getBoundable",value:function(e){return 0===e?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()}},{key:"area",value:function(e){return e.getBounds().getArea()}},{key:"isComposite",value:function(e){return e instanceof an}}])}(),cn=a(function e(){n(this,e)},[{key:"visitItem",value:function(e){}}]),un=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"queryInternal",value:function(){if(ie(arguments[2],cn)&&arguments[0]instanceof Object&&arguments[1]instanceof an)for(var e=arguments[0],t=arguments[2],n=arguments[1].getChildBoundables(),r=0;r<n.size();r++){var i=n.get(r);this.getIntersectsOp().intersects(i.getBounds(),e)&&(i instanceof an?this.queryInternal(e,i,t):i instanceof tn?t.visitItem(i.getItem()):D.shouldNeverReachHere())}else if(ie(arguments[2],ne)&&arguments[0]instanceof Object&&arguments[1]instanceof an)for(var a=arguments[0],s=arguments[2],o=arguments[1].getChildBoundables(),l=0;l<o.size();l++){var c=o.get(l);this.getIntersectsOp().intersects(c.getBounds(),a)&&(c instanceof an?this.queryInternal(a,c,s):c instanceof tn?s.add(c.getItem()):D.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(e){return e.get(e.size()-1)}},{key:"size",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof an?e+=this.size(n):n instanceof tn&&(e+=1)}return e}}},{key:"removeItem",value:function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof tn&&i.getItem()===t&&(n=i)}return null!==n&&(e.getChildBoundables().remove(n),!0)}},{key:"itemsTree",value:function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new fe:e}if(1===arguments.length){for(var t=arguments[0],n=new fe,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof an){var a=this.itemsTree(i);null!==a&&n.add(a)}else i instanceof tn?n.add(i.getItem()):D.shouldNeverReachHere()}return n.size()<=0?null:n}}},{key:"insert",value:function(e,t){D.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new tn(e,t))}},{key:"boundablesAtLevel",value:function(){if(1===arguments.length){var e=arguments[0],t=new fe;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];if(D.isTrue(n>-2),r.getLevel()===n)return i.add(r),null;for(var a=r.getChildBoundables().iterator();a.hasNext();){var s=a.next();s instanceof an?this.boundablesAtLevel(n,s,i):(D.isTrue(s instanceof tn),-1===n&&i.add(s))}return null}}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new fe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.queryInternal(e,this._root,t),t}if(2===arguments.length){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,r)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],a=this.removeItem(r,i);if(a)return!0;for(var s=null,o=r.getChildBoundables().iterator();o.hasNext();){var l=o.next();if(this.getIntersectsOp().intersects(l.getBounds(),n)&&l instanceof an&&(a=this.remove(n,l,i))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),a}}},{key:"createHigherLevels",value:function(e,t){D.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)}},{key:"depth",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();if(n instanceof an){var r=this.depth(n);r>e&&(e=r)}}return e+1}}},{key:"createParentBoundables",value:function(e,t){D.isTrue(!e.isEmpty());var n=new fe;n.add(this.createNode(t));var r=new fe(e);sn.sort(r,this.getComparator());for(var i=r.iterator();i.hasNext();){var a=i.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(a)}return n}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[_]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new fe,this._nodeCapacity=null,0===arguments.length)e.constructor_.call(this,e.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];D.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}},{key:"compareDoubles",value:function(e,t){return e>t?1:e<t?-1:0}}])}();un.IntersectsOp=function(){},un.DEFAULT_NODE_CAPACITY=10;var hn=a(function e(){n(this,e)},[{key:"distance",value:function(e,t){}}]),dn=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"createParentBoundablesFromVerticalSlices",value:function(e,t){D.isTrue(e.length>0);for(var n=new fe,r=0;r<e.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(e[r],t));return n}},{key:"nearestNeighbourK",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.nearestNeighbourK(e,R.POSITIVE_INFINITY,t)}if(3===arguments.length){var n=arguments[0],i=arguments[2],a=arguments[1],s=new nn;s.add(n);for(var o=new nn;!s.isEmpty()&&a>=0;){var l=s.poll(),c=l.getDistance();if(c>=a)break;l.isLeaves()?o.size()<i?o.add(l):(o.peek().getDistance()>c&&(o.poll(),o.add(l)),a=o.peek().getDistance()):l.expandToQueue(s,a)}return r.getItems(o)}}},{key:"createNode",value:function(e){return new An(e)}},{key:"size",value:function(){return 0===arguments.length?d(r,"size",this,1).call(this):d(r,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof V))return d(r,"insert",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];if(e.isNull())return null;d(r,"insert",this,1).call(this,e,t)}},{key:"getIntersectsOp",value:function(){return r.intersectsOp}},{key:"verticalSlices",value:function(e,t){for(var n=Math.trunc(Math.ceil(e.size()/t)),r=new Array(t).fill(null),i=e.iterator(),a=0;a<t;a++){r[a]=new fe;for(var s=0;i.hasNext()&&s<n;){var o=i.next();r[a].add(o),s++}}return r}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];return d(r,"query",this,1).call(this,e)}if(2===arguments.length){var t=arguments[0],n=arguments[1];d(r,"query",this,1).call(this,t,n)}}},{key:"getComparator",value:function(){return r.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(e,t){return d(r,"createParentBoundables",this,1).call(this,e,t)}},{key:"remove",value:function(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof V){var e=arguments[0],t=arguments[1];return d(r,"remove",this,1).call(this,e,t)}return d(r,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return 0===arguments.length?d(r,"depth",this,1).call(this):d(r,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(e,t){D.isTrue(!e.isEmpty());var n=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),i=new fe(e);sn.sort(i,r.xComparator);var a=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(a,t)}},{key:"nearestNeighbour",value:function(){if(1===arguments.length){if(ie(arguments[0],hn)){var e=arguments[0];if(this.isEmpty())return null;var t=new ln(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof ln){var n=arguments[0],r=R.POSITIVE_INFINITY,i=null,a=new nn;for(a.add(n);!a.isEmpty()&&r>0;){var s=a.poll(),o=s.getDistance();if(o>=r)break;s.isLeaves()?(r=o,i=s):s.expandToQueue(a,r)}return null===i?null:[i.getBoundable(0).getItem(),i.getBoundable(1).getItem()]}}else{if(2===arguments.length){var l=arguments[0],c=arguments[1];if(this.isEmpty()||l.isEmpty())return null;var u=new ln(this.getRoot(),l.getRoot(),c);return this.nearestNeighbour(u)}if(3===arguments.length){var h=arguments[2],d=new tn(arguments[0],arguments[1]),A=new ln(this.getRoot(),d,h);return this.nearestNeighbour(A)[0]}if(4===arguments.length){var p=arguments[2],f=arguments[3],g=new tn(arguments[0],arguments[1]),m=new ln(this.getRoot(),g,p);return this.nearestNeighbourK(m,f)}}}},{key:"isWithinDistance",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=R.POSITIVE_INFINITY,r=new nn;for(r.add(e);!r.isEmpty();){var i=r.poll(),a=i.getDistance();if(a>t)return!1;if(i.maximumDistance()<=t)return!0;if(i.isLeaves()){if((n=a)<=t)return!0}else i.expandToQueue(r,n)}return!1}if(3===arguments.length){var s=arguments[0],o=arguments[1],l=arguments[2],c=new ln(this.getRoot(),s.getRoot(),o);return this.isWithinDistance(c,l)}}},{key:"interfaces_",get:function(){return[rn,_]}}],[{key:"constructor_",value:function(){if(0===arguments.length)r.constructor_.call(this,r.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var e=arguments[0];un.constructor_.call(this,e)}}},{key:"centreX",value:function(e){return r.avg(e.getMinX(),e.getMaxX())}},{key:"avg",value:function(e,t){return(e+t)/2}},{key:"getItems",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;!e.isEmpty();){var r=e.poll();t[n]=r.getBoundable(0).getItem(),n++}return t}},{key:"centreY",value:function(e){return r.avg(e.getMinY(),e.getMaxY())}}])}(un),An=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"computeBounds",value:function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===e?e=new V(n.getBounds()):e.expandToInclude(n.getBounds())}return e}}],[{key:"constructor_",value:function(){var e=arguments[0];an.constructor_.call(this,e)}}])}(an);dn.STRtreeNode=An,dn.xComparator=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[L]}},{key:"compare",value:function(e,t){return un.compareDoubles(dn.centreX(e.getBounds()),dn.centreX(t.getBounds()))}}])),dn.yComparator=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[L]}},{key:"compare",value:function(e,t){return un.compareDoubles(dn.centreY(e.getBounds()),dn.centreY(t.getBounds()))}}])),dn.intersectsOp=new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(e,t){return e.intersects(t)}}])),dn.DEFAULT_NODE_CAPACITY=10;var pn=function(){function e(){n(this,e)}return a(e,null,[{key:"relativeSign",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"compare",value:function(t,n,r){if(n.equals2D(r))return 0;var i=e.relativeSign(n.x,r.x),a=e.relativeSign(n.y,r.y);switch(t){case 0:return e.compareValue(i,a);case 1:return e.compareValue(a,i);case 2:return e.compareValue(a,-i);case 3:return e.compareValue(-i,a);case 4:return e.compareValue(-i,-a);case 5:return e.compareValue(-a,-i);case 6:return e.compareValue(-a,i);case 7:return e.compareValue(i,-a)}return D.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0}}])}(),fn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:this._isInterior?t._isInterior?pn.compare(this._segmentOctant,this.coord,t.coord):1:-1}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._segString=e,this.coord=new H(t),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(n))}}]),gn=a(function e(){n(this,e)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),mn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var e=new qe;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next();this.addEdgeCoordinates(n,r,e),n=r}return e.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var e=new fe;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._edge.getCoordinate(n),n)}}},{key:"createSplitEdgePts",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2;if(2===n)return[new H(e.coord),new H(t.coord)];var r=this._edge.getCoordinate(t.segmentIndex),i=t.isInterior()||!t.coord.equals2D(r);i||n--;var a=new Array(n).fill(null),s=0;a[s++]=new H(e.coord);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)a[s++]=this._edge.getCoordinate(o);return i&&(a[s]=new H(t.coord)),a}},{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"findCollapsesFromExistingVertices",value:function(e){for(var t=0;t<this._edge.size()-2;t++){var n=this._edge.getCoordinate(t);this._edge.getCoordinate(t+1);var r=this._edge.getCoordinate(t+2);n.equals2D(r)&&e.add(se.valueOf(t+1))}}},{key:"addEdgeCoordinates",value:function(e,t,n){var r=this.createSplitEdgePts(e,t);n.add(r,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}}},{key:"findCollapseIndex",value:function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,1===r&&(n[0]=e.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(e){for(var t=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,t)&&e.add(se.valueOf(t[0])),r=i}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)}},{key:"createSplitEdge",value:function(e,t){var n=this.createSplitEdgePts(e,t);return new xn(n,this._edge.getData())}},{key:"add",value:function(e,t){var n=new fn(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return null!==r?(D.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)}},{key:"checkSplitEdgesCorrectness",value:function(e){var t=this._edge.getCoordinates(),n=e.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new P("bad split edge start point at "+n);var r=e.get(e.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(t[t.length-1]))throw new P("bad split edge end point at "+i)}}],[{key:"constructor_",value:function(){this._nodeMap=new Wt,this._edge=null;var e=arguments[0];this._edge=e}}]),yn=function(){function e(){n(this,e)}return a(e,null,[{key:"octant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new v("Cannot compute the octant for point ( "+t+", "+n+" )");var r=Math.abs(t),i=Math.abs(n);return t>=0?n>=0?r>=i?0:1:r>=i?7:6:n>=0?r>=i?3:2:r>=i?4:5}if(arguments[0]instanceof H&&arguments[1]instanceof H){var a=arguments[0],s=arguments[1],o=s.x-a.x,l=s.y-a.y;if(0===o&&0===l)throw new v("Cannot compute the octant for two identical points "+a);return e.octant(o,l)}}}])}(),vn=a(function e(){n(this,e)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(e){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(e){}},{key:"getData",value:function(){}}]),bn=a(function e(){n(this,e)},[{key:"addIntersection",value:function(e,t){}},{key:"interfaces_",get:function(){return[vn]}}]),xn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(e){return this._pts[e]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))}},{key:"setData",value:function(e){this._data=e}},{key:"safeOctant",value:function(e,t){return e.equals2D(t)?0:yn.octant(e,t)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var n=arguments[1],r=arguments[3],i=new H(arguments[0].getIntersection(r));this.addIntersection(i,n)}}},{key:"toString",value:function(){return kt.toLineString(new Ze(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(e,t){var n=t,r=n+1;if(r<this._pts.length){var i=this._pts[r];e.equals2D(i)&&(n=r)}return this._nodeList.add(e,n)}},{key:"addIntersections",value:function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)}},{key:"interfaces_",get:function(){return[bn]}}],[{key:"constructor_",value:function(){this._nodeList=new mn(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}},{key:"getNodedSubstrings",value:function(){if(1===arguments.length){var t=arguments[0],n=new fe;return e.getNodedSubstrings(t,n),n}if(2===arguments.length)for(var r=arguments[1],i=arguments[0].iterator();i.hasNext();)i.next().getNodeList().addSplitEdges(r)}}])}(),wn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof e){var t=arguments[0],n=he.index(this.p0,this.p1,t.p0),r=he.index(this.p0,this.p1,t.p1);return n>=0&&r>=0||n<=0&&r<=0?Math.max(n,r):0}if(arguments[0]instanceof H){var i=arguments[0];return he.index(this.p0,this.p1,i)}}},{key:"toGeometry",value:function(e){return e.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)}},{key:"intersection",value:function(e){var t=new Tt;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof H){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new H(t);var n=this.projectionFactor(t),r=new H;return r.x=this.p0.x+n*(this.p1.x-this.p0.x),r.y=this.p0.y+n*(this.p1.y-this.p0.y),r}if(arguments[0]instanceof e){var i=arguments[0],a=this.projectionFactor(i.p0),s=this.projectionFactor(i.p1);if(a>=1&&s>=1)return null;if(a<=0&&s<=0)return null;var o=this.project(i.p0);a<0&&(o=this.p0),a>1&&(o=this.p1);var l=this.project(i.p1);return s<0&&(l=this.p0),s>1&&(l=this.p1),new e(o,l)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(e){return 0===e?this.p0:this.p1}},{key:"distancePerpendicular",value:function(e){return xe.pointToLinePerpendicular(e,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return e.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;return r<=0?R.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r}},{key:"closestPoints",value:function(e){var t=this.intersection(e);if(null!==t)return[t,t];var n=new Array(2).fill(null),r=R.MAX_VALUE,i=null,a=this.closestPoint(e.p0);r=a.distance(e.p0),n[0]=a,n[1]=e.p0;var s=this.closestPoint(e.p1);(i=s.distance(e.p1))<r&&(r=i,n[0]=s,n[1]=e.p1);var o=e.closestPoint(this.p0);(i=o.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=o);var l=e.closestPoint(this.p1);return(i=l.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=l),n}},{key:"closestPoint",value:function(e){var t=this.projectionFactor(e);return t>0&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(e){var t=e,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)}},{key:"reverse",value:function(){var e=this.p0;this.p0=this.p1,this.p1=e}},{key:"equalsTopo",value:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)}},{key:"lineIntersection",value:function(e){return ye.intersection(this.p0,this.p1,e.p0,e.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,s=Math.sqrt(i*i+a*a),o=0,l=0;if(0!==t){if(s<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");o=t*i/s,l=t*a/s}return new H(n-l,r+o)}},{key:"setCoordinates",value:function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}}},{key:"segmentFraction",value:function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||R.isNaN(t))&&(t=1),t}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(e){var t=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),r=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),i=t*t+n*n,a=t*t-n*n,s=e.getX(),o=e.getY();return new H((-a*s-2*t*n*o-2*t*r)/i,(a*o-2*t*n*s-2*n*r)/i)}},{key:"distance",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return xe.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof H){var n=arguments[0];return xe.pointToSegment(n,this.p0,this.p1)}}},{key:"pointAlong",value:function(e){var t=new H;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t}},{key:"hashCode",value:function(){var e=R.doubleToLongBits(this.p0.x);e^=31*R.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=R.doubleToLongBits(this.p1.x);return n^=31*R.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)}},{key:"interfaces_",get:function(){return[x,_]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,0===arguments.length)e.constructor_.call(this,new H,new H);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.p0,t.p1)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.p0=n,this.p1=r}else if(4===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2],o=arguments[3];e.constructor_.call(this,new H(i,a),new H(s,o))}}},{key:"midPoint",value:function(e,t){return new H((e.x+t.x)/2,(e.y+t.y)/2)}}])}(),_n=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[3];arguments[0].getLineSegment(e,this._overlapSeg1),t.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new wn,this._overlapSeg2=new wn}}]),Sn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]}},{key:"computeSelect",value:function(e,t,n,r){var i=this._pts[t],a=this._pts[n];if(n-t==1)return r.select(this,t),null;if(!e.intersects(i,a))return null;var s=Math.trunc((t+n)/2);t<s&&this.computeSelect(e,t,s,r),s<n&&this.computeSelect(e,s,n,r)}},{key:"getCoordinates",value:function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=this._pts[n];return e}},{key:"computeOverlaps",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.computeOverlaps(this._start,this._end,e,e._start,e._end,t)}else if(6===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3],s=arguments[4],o=arguments[5];if(r-n==1&&s-a==1)return o.overlap(this,n,i,a),null;if(!this.overlaps(n,r,i,a,s))return null;var l=Math.trunc((n+r)/2),c=Math.trunc((a+s)/2);n<l&&(a<c&&this.computeOverlaps(n,l,i,a,c,o),c<s&&this.computeOverlaps(n,l,i,c,s,o)),l<r&&(a<c&&this.computeOverlaps(l,r,i,a,c,o),c<s&&this.computeOverlaps(l,r,i,c,s,o))}}},{key:"setId",value:function(e){this._id=e}},{key:"select",value:function(e,t){this.computeSelect(e,this._start,this._end,t)}},{key:"getEnvelope",value:function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new V(e,t)}return this._env}},{key:"overlaps",value:function(e,t,n,r,i){return V.intersects(this._pts[e],this._pts[t],n._pts[r],n._pts[i])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=r}}]),Cn=function(){function e(){n(this,e)}return a(e,null,[{key:"findChainEnd",value:function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=Kt.quadrant(e[n],e[n+1]),i=t+1;i<e.length&&(e[i-1].equals2D(e[i])||Kt.quadrant(e[i-1],e[i])===r);)i++;return i-1}},{key:"getChains",value:function(){if(1===arguments.length){var t=arguments[0];return e.getChains(t,null)}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=new fe,a=0;do{var s=e.findChainEnd(n,a),o=new Sn(n,a,s,r);i.add(o),a=s}while(a<n.length-1);return i}}}])}(),En=a(function e(){n(this,e)},[{key:"computeNodes",value:function(e){}},{key:"getNodedSubstrings",value:function(){}}]),Nn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(e){this._segInt=e}},{key:"interfaces_",get:function(){return[En]}}],[{key:"constructor_",value:function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}}}]),kn=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return xn.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(e){for(var t=Cn.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var n=t.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var e=new In(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var n=t.next(),r=this._index.query(n.getEnvelope()).iterator();r.hasNext();){var i=r.next();if(i.getId()>n.getId()&&(n.computeOverlaps(i,e),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new fe,this._index=new dn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,0===arguments.length);else if(1===arguments.length){var e=arguments[0];Nn.constructor_.call(this,e)}}}])}(Nn),In=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"overlap",value:function(){if(4!==arguments.length)return d(r,"overlap",this,1).apply(this,arguments);var e=arguments[1],t=arguments[2],n=arguments[3],i=arguments[0].getContext(),a=t.getContext();this._si.processIntersections(i,e,a,n)}}],[{key:"constructor_",value:function(){this._si=null;var e=arguments[0];this._si=e}}])}(_n);kn.SegmentOverlapAction=In;var Tn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isDeletable",value:function(e,t,n,r){var i=this._inputLine[e],a=this._inputLine[t],s=this._inputLine[n];return!!this.isConcave(i,a,s)&&!!this.isShallow(i,a,s,r)&&this.isShallowSampled(i,a,e,n,r)}},{key:"deleteShallowConcavities",value:function(){for(var t=1,n=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var a=!1;this.isDeletable(t,n,r,this._distanceTol)&&(this._isDeleted[n]=e.DELETE,a=!0,i=!0),t=a?r:n,n=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(n)}return i}},{key:"isShallowConcavity",value:function(e,t,n,r){return he.index(e,t,n)===this._angleOrientation&&xe.pointToSegment(t,e,n)<r}},{key:"isShallowSampled",value:function(t,n,r,i,a){var s=Math.trunc((i-r)/e.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var o=r;o<i;o+=s)if(!this.isShallow(t,n,this._inputLine[o],a))return!1;return!0}},{key:"isConcave",value:function(e,t,n){return he.index(e,t,n)===this._angleOrientation}},{key:"simplify",value:function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=he.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(t){for(var n=t+1;n<this._inputLine.length&&this._isDeleted[n]===e.DELETE;)n++;return n}},{key:"isShallow",value:function(e,t,n,r){return xe.pointToSegment(t,e,n)<r}},{key:"collapseLine",value:function(){for(var t=new qe,n=0;n<this._inputLine.length;n++)this._isDeleted[n]!==e.DELETE&&t.add(this._inputLine[n]);return t.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=he.COUNTERCLOCKWISE;var e=arguments[0];this._inputLine=e}},{key:"simplify",value:function(t,n){return new e(t).simplify(n)}}])}();Tn.INIT=0,Tn.DELETE=1,Tn.KEEP=1,Tn.NUM_PTS_TO_CHECK=10;var Bn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getCoordinates",value:function(){return this._ptList.toArray(e.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"addPt",value:function(e){var t=new H(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var r=e.length-1;r>=0;r--)this.addPt(e[r])}},{key:"isRedundant",value:function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance}},{key:"toString",value:function(){return(new st).createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var e=new H(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)}},{key:"setMinimumVertexDistance",value:function(e){this._minimimVertexDistance=e}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new fe}}])}();Bn.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Mn=function(){function e(){n(this,e)}return a(e,null,[{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"normalize",value:function(t){for(;t>Math.PI;)t-=e.PI_TIMES_2;for(;t<=-Math.PI;)t+=e.PI_TIMES_2;return t}},{key:"angle",value:function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],r=n.x-t.x,i=n.y-t.y;return Math.atan2(i,r)}}},{key:"isAcute",value:function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)>0}},{key:"isObtuse",value:function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)<0}},{key:"interiorAngle",value:function(t,n,r){var i=e.angle(n,t),a=e.angle(n,r);return Math.abs(a-i)}},{key:"normalizePositive",value:function(t){if(t<0){for(;t<0;)t+=e.PI_TIMES_2;t>=e.PI_TIMES_2&&(t=0)}else{for(;t>=e.PI_TIMES_2;)t-=e.PI_TIMES_2;t<0&&(t=0)}return t}},{key:"angleBetween",value:function(t,n,r){var i=e.angle(n,t),a=e.angle(n,r);return e.diff(i,a)}},{key:"diff",value:function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n}},{key:"toRadians",value:function(e){return e*Math.PI/180}},{key:"getTurn",value:function(t,n){var r=Math.sin(n-t);return r>0?e.COUNTERCLOCKWISE:r<0?e.CLOCKWISE:e.NONE}},{key:"angleBetweenOriented",value:function(t,n,r){var i=e.angle(n,t),a=e.angle(n,r)-i;return a<=-Math.PI?a+e.PI_TIMES_2:a>Math.PI?a-e.PI_TIMES_2:a}}])}();Mn.PI_TIMES_2=2*Math.PI,Mn.PI_OVER_2=Math.PI/2,Mn.PI_OVER_4=Math.PI/4,Mn.COUNTERCLOCKWISE=he.COUNTERCLOCKWISE,Mn.CLOCKWISE=he.CLOCKWISE,Mn.NONE=he.COLLINEAR;var Fn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"addNextSegment",value:function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=he.index(this._s0,this._s1,this._s2),r=n===he.CLOCKWISE&&this._side===$.LEFT||n===he.COUNTERCLOCKWISE&&this._side===$.RIGHT;0===n?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)}},{key:"addLineEndCap",value:function(e,t){var n=new wn(e,t),r=new wn;this.computeOffsetSegment(n,$.LEFT,this._distance,r);var i=new wn;this.computeOffsetSegment(n,$.RIGHT,this._distance,i);var a=t.x-e.x,s=t.y-e.y,o=Math.atan2(s,a);switch(this._bufParams.getEndCapStyle()){case m.CAP_ROUND:this._segList.addPt(r.p1),this.addDirectedFillet(t,o+Math.PI/2,o-Math.PI/2,he.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case m.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case m.CAP_SQUARE:var l=new H;l.x=Math.abs(this._distance)*Math.cos(o),l.y=Math.abs(this._distance)*Math.sin(o);var c=new H(r.p1.x+l.x,r.p1.y+l.y),u=new H(i.p1.x+l.x,i.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(e,t,n,r){var i=ye.intersection(t.p0,t.p1,n.p0,n.p1);if(null!==i&&(r<=0?1:i.distance(e)/Math.abs(r))<=this._bufParams.getMitreLimit())return this._segList.addPt(i),null;this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(t,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*e.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===m.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===m.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(e){this._segList.addPt(new H(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new H(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new H(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new H(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(e,t){this._segList.addPts(e,t)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(e,t,n,r,i){var a=t.x-e.x,s=t.y-e.y,o=Math.atan2(s,a),l=n.x-e.x,c=n.y-e.y,u=Math.atan2(c,l);r===he.CLOCKWISE?o<=u&&(o+=2*Math.PI):o>=u&&(o-=2*Math.PI),this._segList.addPt(t),this.addDirectedFillet(e,o,u,r,i),this._segList.addPt(n)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(e,t,n,r){var i=this._seg0.p1,a=Mn.angle(i,this._seg0.p0),s=Mn.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,o=Mn.normalize(a+s),l=Mn.normalize(o+Math.PI),c=r*n,u=n-c*Math.abs(Math.sin(s)),h=i.x+c*Math.cos(l),d=i.y+c*Math.sin(l),A=new H(h,d),p=new wn(i,A),f=p.pointAlongOffset(1,u),g=p.pointAlongOffset(1,-u);this._side===$.LEFT?(this._segList.addPt(f),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(f))}},{key:"addDirectedFillet",value:function(e,t,n,r,i){var a=r===he.CLOCKWISE?-1:1,s=Math.abs(t-n),o=Math.trunc(s/this._filletAngleQuantum+.5);if(o<1)return null;for(var l=s/o,c=new H,u=0;u<o;u++){var h=t+a*u*l;c.x=e.x+i*Math.cos(h),c.y=e.y+i*Math.sin(h),this._segList.addPt(c)}}},{key:"computeOffsetSegment",value:function(e,t,n,r){var i=t===$.LEFT?1:-1,a=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,o=Math.sqrt(a*a+s*s),l=i*n*a/o,c=i*n*s/o;r.p0.x=e.p0.x-c,r.p0.y=e.p0.y+l,r.p1.x=e.p1.x-c,r.p1.y=e.p1.y+l}},{key:"addInsideTurn",value:function(t,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*e.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new H((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var i=new H((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(e){var t=new H(e.x+this._distance,e.y);this._segList.addPt(t),this.addDirectedFillet(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)}},{key:"init",value:function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Bn,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*e.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===m.JOIN_BEVEL||this._bufParams.getJoinStyle()===m.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,he.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new wn,this._seg1=new wn,this._offset0=new wn,this._offset1=new wn,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Tt,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===m.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)}}])}();Fn.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Fn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Fn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Fn.MAX_CLOSING_SEG_LEN_FACTOR=80;var Rn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getOffsetCurve",value:function(e,t){if(this._distance=t,0===t)return null;var n=t<0,r=Math.abs(t),i=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],i):this.computeOffsetCurve(e,n,i);var a=i.getCoordinates();return n&&Ke.reverse(a),a}},{key:"computeSingleSidedBufferCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var i=Tn.simplify(e,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],$.LEFT),n.addFirstSegment();for(var s=a-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{n.addSegments(e,!1);var o=Tn.simplify(e,r),l=o.length-1;n.initSideSegments(o[0],o[1],$.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(o[c],!0)}n.addLastSegment(),n.closeRing()}},{key:"computeRingBufferCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);t===$.RIGHT&&(r=-r);var i=Tn.simplify(e,r),a=i.length-1;n.initSideSegments(i[a-1],i[0],t);for(var s=1;s<=a;s++){var o=1!==s;n.addNextSegment(i[s],o)}n.closeRing()}},{key:"computeLineBufferCurve",value:function(e,t){var n=this.simplifyTolerance(this._distance),r=Tn.simplify(e,n),i=r.length-1;t.initSideSegments(r[0],r[1],$.LEFT);for(var a=2;a<=i;a++)t.addNextSegment(r[a],!0);t.addLastSegment(),t.addLineEndCap(r[i-1],r[i]);var s=Tn.simplify(e,-n),o=s.length-1;t.initSideSegments(s[o],s[o-1],$.LEFT);for(var l=o-2;l>=0;l--)t.addNextSegment(s[l],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()}},{key:"computePointCurve",value:function(e,t){switch(this._bufParams.getEndCapStyle()){case m.CAP_ROUND:t.createCircle(e);break;case m.CAP_SQUARE:t.createSquare(e)}}},{key:"getLineCurve",value:function(e,t){if(this._distance=t,this.isLineOffsetEmpty(t))return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var i=t<0;this.computeSingleSidedBufferCurve(e,i,r)}else this.computeLineBufferCurve(e,r);return r.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(e){return e*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(t,n,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(0===r)return e.copyCoordinates(t);var i=this.getSegGen(r);return this.computeRingBufferCurve(t,n,i),i.getCoordinates()}},{key:"computeOffsetCurve",value:function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var i=Tn.simplify(e,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],$.LEFT),n.addFirstSegment();for(var s=a-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{var o=Tn.simplify(e,r),l=o.length-1;n.initSideSegments(o[0],o[1],$.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(o[c],!0)}n.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(e){return 0===e||e<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(e){return new Fn(this._precisionModel,this._bufParams,e)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}},{key:"copyCoordinates",value:function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new H(e[n]);return t}}])}(),Ln=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new fe,n=this._subgraphs.iterator();n.hasNext();){var r=n.next(),i=r.getEnvelope();e.y<i.getMinY()||e.y>i.getMaxY()||this.findStabbedSegments(e,r.getDirectedEdges(),t)}return t}if(3===arguments.length)if(ie(arguments[2],ne)&&arguments[0]instanceof H&&arguments[1]instanceof Yt){for(var a=arguments[0],s=arguments[1],o=arguments[2],l=s.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<a.x||this._seg.isHorizontal()||a.y<this._seg.p0.y||a.y>this._seg.p1.y||he.index(this._seg.p0,this._seg.p1,a)===he.RIGHT)){var u=s.getDepth($.LEFT);this._seg.p0.equals(l[c])||(u=s.getDepth($.RIGHT));var h=new Pn(this._seg,u);o.add(h)}}else if(ie(arguments[2],ne)&&arguments[0]instanceof H&&ie(arguments[1],ne))for(var d=arguments[0],A=arguments[2],p=arguments[1].iterator();p.hasNext();){var f=p.next();f.isForward()&&this.findStabbedSegments(d,f,A)}}},{key:"getDepth",value:function(e){var t=this.findStabbedSegments(e);return 0===t.size()?0:sn.min(t)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new wn;var e=arguments[0];this._subgraphs=e}}]),Pn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==n||0!==(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(t._upwardSeg)}},{key:"compareX",value:function(e,t){var n=e.p0.compareTo(t.p0);return 0!==n?n:e.p1.compareTo(t.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new wn(e),this._leftDepth=t}}]);Ln.DepthSegment=Pn;var Un=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,null,[{key:"constructor_",value:function(){y.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(y),Dn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getY",value:function(){var e=this.y/this.w;if(R.isNaN(e)||R.isInfinite(e))throw new Un;return e}},{key:"getX",value:function(){var e=this.x/this.w;if(R.isNaN(e)||R.isInfinite(e))throw new Un;return e}},{key:"getCoordinate",value:function(){var e=new H;return e.x=this.getX(),e.y=this.getY(),e}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var i=arguments[0],a=arguments[1];this.x=i.y*a.w-a.y*i.w,this.y=a.x*i.w-i.x*a.w,this.w=i.x*a.y-a.x*i.y}else if(arguments[0]instanceof H&&arguments[1]instanceof H){var s=arguments[0],o=arguments[1];this.x=s.y-o.y,this.y=o.x-s.x,this.w=s.x*o.y-o.x*s.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],d=arguments[1],A=arguments[2],p=arguments[3],f=h.y-d.y,g=d.x-h.x,m=h.x*d.y-d.x*h.y,y=A.y-p.y,v=p.x-A.x,b=A.x*p.y-p.x*A.y;this.x=g*b-v*m,this.y=y*m-f*b,this.w=f*v-y*g}}}])}(),On=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"area",value:function(){return e.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return e.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(t){if(null===t)throw new v("Supplied point is null.");return e.interpolateZ(t,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return e.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return e.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return e.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return e.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return e.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return e.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.p0=e,this.p1=t,this.p2=n}},{key:"area",value:function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)}},{key:"signedArea",value:function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2}},{key:"det",value:function(e,t,n,r){return e*r-t*n}},{key:"interpolateZ",value:function(e,t,n,r){var i=t.x,a=t.y,s=n.x-i,o=r.x-i,l=n.y-a,c=r.y-a,u=s*c-o*l,h=e.x-i,d=e.y-a,A=(c*h-o*d)/u,p=(-l*h+s*d)/u;return t.getZ()+A*(n.getZ()-t.getZ())+p*(r.getZ()-t.getZ())}},{key:"longestSideLength",value:function(e,t,n){var r=e.distance(t),i=t.distance(n),a=n.distance(e),s=r;return i>s&&(s=i),a>s&&(s=a),s}},{key:"circumcentreDD",value:function(e,t,n){var r=le.valueOf(e.x).subtract(n.x),i=le.valueOf(e.y).subtract(n.y),a=le.valueOf(t.x).subtract(n.x),s=le.valueOf(t.y).subtract(n.y),o=le.determinant(r,i,a,s).multiply(2),l=r.sqr().add(i.sqr()),c=a.sqr().add(s.sqr()),u=le.determinant(i,l,s,c),h=le.determinant(r,l,a,c),d=le.valueOf(n.x).subtract(u.divide(o)).doubleValue(),A=le.valueOf(n.y).add(h.divide(o)).doubleValue();return new H(d,A)}},{key:"isAcute",value:function(e,t,n){return!!Mn.isAcute(e,t,n)&&!!Mn.isAcute(t,n,e)&&!!Mn.isAcute(n,e,t)}},{key:"circumcentre",value:function(t,n,r){var i=r.x,a=r.y,s=t.x-i,o=t.y-a,l=n.x-i,c=n.y-a,u=2*e.det(s,o,l,c),h=e.det(o,s*s+o*o,c,l*l+c*c),d=e.det(s,s*s+o*o,l,l*l+c*c);return new H(i-h/u,a+d/u)}},{key:"perpendicularBisector",value:function(e,t){var n=t.x-e.x,r=t.y-e.y,i=new Dn(e.x+n/2,e.y+r/2,1),a=new Dn(e.x-r+n/2,e.y+n+r/2,1);return new Dn(i,a)}},{key:"angleBisector",value:function(e,t,n){var r=t.distance(e),i=r/(r+t.distance(n)),a=n.x-e.x,s=n.y-e.y;return new H(e.x+i*a,e.y+i*s)}},{key:"area3D",value:function(e,t,n){var r=t.x-e.x,i=t.y-e.y,a=t.getZ()-e.getZ(),s=n.x-e.x,o=n.y-e.y,l=n.getZ()-e.getZ(),c=i*l-a*o,u=a*s-r*l,h=r*o-i*s,d=c*c+u*u+h*h;return Math.sqrt(d)/2}},{key:"centroid",value:function(e,t,n){var r=(e.x+t.x+n.x)/3,i=(e.y+t.y+n.y)/3;return new H(r,i)}},{key:"inCentre",value:function(e,t,n){var r=t.distance(n),i=e.distance(n),a=e.distance(t),s=r+i+a,o=(r*e.x+i*t.x+a*n.x)/s,l=(r*e.y+i*t.y+a*n.y)/s;return new H(o,l)}}])}(),jn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(e,t,n,r,i){if(0===t&&e.length<He.MINIMUM_VALID_SIZE)return null;var a=r,s=i;e.length>=He.MINIMUM_VALID_SIZE&&he.isCCW(e)&&(a=i,s=r,n=$.opposite(n));var o=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(o,a,s)}},{key:"addRingBothSides",value:function(e,t){this.addRingSide(e,t,$.LEFT,W.EXTERIOR,W.INTERIOR),this.addRingSide(e,t,$.RIGHT,W.INTERIOR,W.EXTERIOR)}},{key:"addPoint",value:function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,W.EXTERIOR,W.INTERIOR)}},{key:"addPolygon",value:function(e){var t=this._distance,n=$.LEFT;this._distance<0&&(t=-this._distance,n=$.RIGHT);var r=e.getExteriorRing(),i=Ke.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addRingSide(i,t,n,W.EXTERIOR,W.INTERIOR);for(var a=0;a<e.getNumInteriorRing();a++){var s=e.getInteriorRingN(a),o=Ke.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addRingSide(o,t,$.opposite(n),W.INTERIOR,W.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(e,t){var n=new On(e[0],e[1],e[2]),r=n.inCentre();return xe.pointToSegment(r,n.p0,n.p1)<Math.abs(t)}},{key:"addLineString",value:function(e){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var t=Ke.removeRepeatedPoints(e.getCoordinates());if(Ke.isRing(t)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(t,this._distance);else{var n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,W.EXTERIOR,W.INTERIOR)}}},{key:"addCurve",value:function(e,t,n){if(null===e||e.length<2)return null;var r=new xn(e,new Rt(0,W.BOUNDARY,t,n));this._curveList.add(r)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(e){if(e.isEmpty())return null;if(e instanceof Pe)this.addPolygon(e);else if(e instanceof Te)this.addLineString(e);else if(e instanceof Me)this.addPoint(e);else if(e instanceof ze)this.addCollection(e);else if(e instanceof at)this.addCollection(e);else if(e instanceof et)this.addCollection(e);else{if(!(e instanceof je))throw new X(e.getGeometryType());this.addCollection(e)}}},{key:"isErodedCompletely",value:function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>i}},{key:"addCollection",value:function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new fe;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n}}]),zn=a(function e(){n(this,e)},[{key:"locate",value:function(e){}}]),Hn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,e.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new K;var t=this._parent.getGeometryN(this._index++);return t instanceof je?(this._subcollectionIterator=new e(t),this._subcollectionIterator.next()):t}},{key:"remove",value:function(){throw new X(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[gn]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}},{key:"isAtomic",value:function(e){return!(e instanceof je)}}])}(),Qn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"locate",value:function(t){return e.locate(t,this._geom)}},{key:"interfaces_",get:function(){return[zn]}}],[{key:"constructor_",value:function(){this._geom=null;var e=arguments[0];this._geom=e}},{key:"locatePointInPolygon",value:function(t,n){if(n.isEmpty())return W.EXTERIOR;var r=n.getExteriorRing(),i=e.locatePointInRing(t,r);if(i!==W.INTERIOR)return i;for(var a=0;a<n.getNumInteriorRing();a++){var s=n.getInteriorRingN(a),o=e.locatePointInRing(t,s);if(o===W.BOUNDARY)return W.BOUNDARY;if(o===W.INTERIOR)return W.EXTERIOR}return W.INTERIOR}},{key:"locatePointInRing",value:function(e,t){return t.getEnvelopeInternal().intersects(e)?Mt.locateInRing(e,t.getCoordinates()):W.EXTERIOR}},{key:"containsPointInPolygon",value:function(t,n){return W.EXTERIOR!==e.locatePointInPolygon(t,n)}},{key:"locateInGeometry",value:function(t,n){if(n instanceof Pe)return e.locatePointInPolygon(t,n);if(n instanceof je)for(var r=new Hn(n);r.hasNext();){var i=r.next();if(i!==n){var a=e.locateInGeometry(t,i);if(a!==W.EXTERIOR)return a}}return W.EXTERIOR}},{key:"isContained",value:function(t,n){return W.EXTERIOR!==e.locate(t,n)}},{key:"locate",value:function(t,n){return n.isEmpty()?W.EXTERIOR:n.getEnvelopeInternal().intersects(t)?e.locateInGeometry(t,n):W.EXTERIOR}}])}(),Vn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return 0===t&&(n=this._edgeList.size()-1),this._edgeList.get(n)}},{key:"propagateSideLabels",value:function(e){for(var t=W.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(e)&&r.getLocation(e,$.LEFT)!==W.NONE&&(t=r.getLocation(e,$.LEFT))}if(t===W.NONE)return null;for(var i=t,a=this.iterator();a.hasNext();){var s=a.next(),o=s.getLabel();if(o.getLocation(e,$.ON)===W.NONE&&o.setLocation(e,$.ON,i),o.isArea(e)){var l=o.getLocation(e,$.LEFT),c=o.getLocation(e,$.RIGHT);if(c!==W.NONE){if(c!==i)throw new Ae("side location conflict",s.getCoordinate());l===W.NONE&&D.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=l}else D.isTrue(o.getLocation(e,$.LEFT)===W.NONE,"found single null side"),o.setLocation(e,$.RIGHT,i),o.setLocation(e,$.LEFT,i)}}}},{key:"getCoordinate",value:function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null}},{key:"print",value:function(e){ve.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"isAreaLabelsConsistent",value:function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel().getLocation(e,$.LEFT);D.isTrue(r!==W.NONE,"Found unlabelled area edge");for(var i=r,a=this.iterator();a.hasNext();){var s=a.next().getLabel();D.isTrue(s.isArea(e),"Found non-area edge");var o=s.getLocation(e,$.LEFT),l=s.getLocation(e,$.RIGHT);if(o===l)return!1;if(l!==i)return!1;i=o}return!0}},{key:"findIndex",value:function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return null===this._edgeList&&(this._edgeList=new fe(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(e,t,n){return this._ptInAreaLocation[e]===W.NONE&&(this._ptInAreaLocation[e]=Qn.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]}},{key:"toString",value:function(){var e=new ae;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append("\n")}return e.toString()}},{key:"computeEdgeEndLabels",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)}},{key:"computeLabelling",value:function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===W.BOUNDARY&&(t[i]=!0);for(var a=this.iterator();a.hasNext();)for(var s=a.next(),o=s.getLabel(),l=0;l<2;l++)if(o.isAnyNull(l)){var c=W.NONE;if(t[l])c=W.EXTERIOR;else{var u=s.getCoordinate();c=this.getLocation(l,u,e)}o.setAllLocationsIfNull(l,c)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(e,t){this._edgeMap.put(e,t),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Wt,this._edgeList=null,this._ptInAreaLocation=[W.NONE,W.NONE]}}]),Gn=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var e=null,t=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var i=this._resultAreaEdgeList.get(r),a=i.getSym();if(i.getLabel().isArea())switch(null===e&&i.isInResult()&&(e=i),n){case this._SCANNING_FOR_INCOMING:if(!a.isInResult())continue;t=a,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;t.setNext(i),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new Ae("no outgoing dirEdge found",this.getCoordinate());D.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}}},{key:"insert",value:function(e){var t=e;this.insertEdgeEnd(t,t)}},{key:"getRightmostEdge",value:function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var n=e.get(0);if(1===t)return n;var r=e.get(t-1),i=n.getQuadrant(),a=r.getQuadrant();return Kt.isNorthern(i)&&Kt.isNorthern(a)?n:Kt.isNorthern(i)||Kt.isNorthern(a)?0!==n.getDy()?n:0!==r.getDy()?r:(D.shouldNeverReachHere("found two horizontal edges incident on node"),null):r}},{key:"print",value:function(e){ve.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();e.print("out "),n.print(e),e.println(),e.print("in "),n.getSym().print(e),e.println()}}},{key:"getResultAreaEdges",value:function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new fe;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(e){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,e.getLocation(0)),n.setAllLocationsIfNull(1,e.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var e=null,t=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===t&&(t=i),null!==e&&i.setNext(e),e=r}t.setNext(e)}},{key:"computeDepths",value:function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),n=e.getDepth($.LEFT),r=e.getDepth($.RIGHT),i=this.computeDepths(t+1,this._edgeList.size(),n);if(this.computeDepths(0,t,i)!==r)throw new Ae("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var a=arguments[1],s=arguments[2],o=arguments[0];o<a;o++){var l=this._edgeList.get(o);l.setEdgeDepths($.RIGHT,s),s=l.getDepth($.LEFT)}return s}}},{key:"mergeSymLabels",value:function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(e){for(var t=null,n=null,r=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var a=this._resultAreaEdgeList.get(i),s=a.getSym();switch(null===t&&a.getEdgeRing()===e&&(t=a),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==e)continue;n=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(a.getEdgeRing()!==e)continue;n.setNextMin(a),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(D.isTrue(null!==t,"found null for first outgoing dirEdge"),D.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),n.setNextMin(t))}},{key:"getOutgoingDegree",value:function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var n=arguments[0],r=0,i=this.iterator();i.hasNext();)i.next().getEdgeRing()===n&&r++;return r}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var e=W.NONE,t=this.iterator();t.hasNext();){var n=t.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){e=W.INTERIOR;break}if(r.isInResult()){e=W.EXTERIOR;break}}}if(e===W.NONE)return null;for(var i=e,a=this.iterator();a.hasNext();){var s=a.next(),o=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===W.INTERIOR):(s.isInResult()&&(i=W.EXTERIOR),o.isInResult()&&(i=W.INTERIOR))}}},{key:"computeLabelling",value:function(e){d(r,"computeLabelling",this,1).call(this,e),this._label=new Rt(W.NONE);for(var t=this.iterator();t.hasNext();)for(var n=t.next().getEdge().getLabel(),i=0;i<2;i++){var a=n.getLocation(i);a!==W.INTERIOR&&a!==W.BOUNDARY||this._label.setLocation(i,W.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(Vn),Wn=function(e){function r(){return n(this,r),t(this,r)}return c(r,e),a(r,[{key:"createNode",value:function(e){return new Ot(e,new Gn)}}])}(Jt),qn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"compareTo",value:function(t){var n=t;return e.compareOriented(this._pts,this._orientation,n._pts,n._orientation)}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)}},{key:"orientation",value:function(e){return 1===Ke.increasingDirection(e)}},{key:"compareOriented",value:function(e,t,n,r){for(var i=t?1:-1,a=r?1:-1,s=t?e.length:-1,o=r?n.length:-1,l=t?0:e.length-1,c=r?0:n.length-1;;){var u=e[l].compareTo(n[c]);if(0!==u)return u;var h=(l+=i)===s,d=(c+=a)===o;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}}}])}(),Kn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&e.print(","),e.print(r[i].x+" "+r[i].y);e.println(")")}e.print(")  ")}},{key:"addAll",value:function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())}},{key:"findEdgeIndex",value:function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(e){return this._edges.get(e)}},{key:"findEqualEdge",value:function(e){var t=new qn(e.getCoordinates());return this._ocaMap.get(t)}},{key:"add",value:function(e){this._edges.add(e);var t=new qn(e.getCoordinates());this._ocaMap.put(t,e)}}],[{key:"constructor_",value:function(){this._edges=new fe,this._ocaMap=new Wt}}]),Xn=a(function e(){n(this,e)},[{key:"processIntersections",value:function(e,t,n,r){}},{key:"isDone",value:function(){}}]),Yn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isTrivialIntersection",value:function(t,n,r,i){if(t===r&&1===this._li.getIntersectionNum()){if(e.isAdjacentSegments(n,i))return!0;if(t.isClosed()){var a=t.size()-1;if(0===n&&i===a||0===i&&n===a)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var i=e.getCoordinates()[t],a=e.getCoordinates()[t+1],s=n.getCoordinates()[r],o=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,s,o),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Xn]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}},{key:"isAdjacentSegments",value:function(e,t){return 1===Math.abs(e-t)}}])}(),Jn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)}},{key:"compareTo",value:function(e){var t=e;return this.compare(t.segmentIndex,t.dist)}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new H(e),this.segmentIndex=t,this.dist=n}}]),Zn=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}}},{key:"addEndpoints",value:function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)}},{key:"createSplitEdge",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],i=t.dist>0||!t.coord.equals2D(r);i||n--;var a=new Array(n).fill(null),s=0;a[s++]=new H(e.coord);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)a[s++]=this.edge.pts[o];return i&&(a[s]=t.coord),new ir(a,new Rt(this.edge._label))}},{key:"add",value:function(e,t,n){var r=new Jn(e,t,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)}},{key:"isIntersection",value:function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Wt,this.edge=null;var e=arguments[0];this.edge=e}}]),$n=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])||e.isTrue(this._matrix[W.INTERIOR][W.BOUNDARY])||e.isTrue(this._matrix[W.BOUNDARY][W.INTERIOR])||e.isTrue(this._matrix[W.BOUNDARY][W.BOUNDARY]))&&this._matrix[W.EXTERIOR][W.INTERIOR]===Ne.FALSE&&this._matrix[W.EXTERIOR][W.BOUNDARY]===Ne.FALSE}},{key:"isCoveredBy",value:function(){return(e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])||e.isTrue(this._matrix[W.INTERIOR][W.BOUNDARY])||e.isTrue(this._matrix[W.BOUNDARY][W.INTERIOR])||e.isTrue(this._matrix[W.BOUNDARY][W.BOUNDARY]))&&this._matrix[W.INTERIOR][W.EXTERIOR]===Ne.FALSE&&this._matrix[W.BOUNDARY][W.EXTERIOR]===Ne.FALSE}},{key:"set",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),r=t%3;this._matrix[n][r]=Ne.toDimensionValue(e.charAt(t))}else if(3===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2];this._matrix[i][a]=s}}},{key:"isContains",value:function(){return e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&this._matrix[W.EXTERIOR][W.INTERIOR]===Ne.FALSE&&this._matrix[W.EXTERIOR][W.BOUNDARY]===Ne.FALSE}},{key:"setAtLeast",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),r=t%3;this.setAtLeast(n,r,Ne.toDimensionValue(e.charAt(t)))}else if(3===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2];this._matrix[i][a]<s&&(this._matrix[i][a]=s)}}},{key:"setAtLeastIfValid",value:function(e,t,n){e>=0&&t>=0&&this.setAtLeast(e,t,n)}},{key:"isWithin",value:function(){return e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&this._matrix[W.INTERIOR][W.EXTERIOR]===Ne.FALSE&&this._matrix[W.BOUNDARY][W.EXTERIOR]===Ne.FALSE}},{key:"isTouches",value:function(t,n){return t>n?this.isTouches(n,t):(t===Ne.A&&n===Ne.A||t===Ne.L&&n===Ne.L||t===Ne.L&&n===Ne.A||t===Ne.P&&n===Ne.A||t===Ne.P&&n===Ne.L)&&this._matrix[W.INTERIOR][W.INTERIOR]===Ne.FALSE&&(e.isTrue(this._matrix[W.INTERIOR][W.BOUNDARY])||e.isTrue(this._matrix[W.BOUNDARY][W.INTERIOR])||e.isTrue(this._matrix[W.BOUNDARY][W.BOUNDARY]))}},{key:"isOverlaps",value:function(t,n){return t===Ne.P&&n===Ne.P||t===Ne.A&&n===Ne.A?e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&e.isTrue(this._matrix[W.INTERIOR][W.EXTERIOR])&&e.isTrue(this._matrix[W.EXTERIOR][W.INTERIOR]):t===Ne.L&&n===Ne.L&&1===this._matrix[W.INTERIOR][W.INTERIOR]&&e.isTrue(this._matrix[W.INTERIOR][W.EXTERIOR])&&e.isTrue(this._matrix[W.EXTERIOR][W.INTERIOR])}},{key:"isEquals",value:function(t,n){return t===n&&e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&this._matrix[W.INTERIOR][W.EXTERIOR]===Ne.FALSE&&this._matrix[W.BOUNDARY][W.EXTERIOR]===Ne.FALSE&&this._matrix[W.EXTERIOR][W.INTERIOR]===Ne.FALSE&&this._matrix[W.EXTERIOR][W.BOUNDARY]===Ne.FALSE}},{key:"toString",value:function(){for(var e=new Je("123456789"),t=0;t<3;t++)for(var n=0;n<3;n++)e.setCharAt(3*t+n,Ne.toDimensionSymbol(this._matrix[t][n]));return e.toString()}},{key:"setAll",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this._matrix[t][n]=e}},{key:"get",value:function(e,t){return this._matrix[e][t]}},{key:"transpose",value:function(){var e=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=e,e=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=e,e=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=e,this}},{key:"matches",value:function(t){if(9!==t.length)throw new v("Should be length 9: "+t);for(var n=0;n<3;n++)for(var r=0;r<3;r++)if(!e.matches(this._matrix[n][r],t.charAt(3*n+r)))return!1;return!0}},{key:"add",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this.setAtLeast(t,n,e.get(t,n))}},{key:"isDisjoint",value:function(){return this._matrix[W.INTERIOR][W.INTERIOR]===Ne.FALSE&&this._matrix[W.INTERIOR][W.BOUNDARY]===Ne.FALSE&&this._matrix[W.BOUNDARY][W.INTERIOR]===Ne.FALSE&&this._matrix[W.BOUNDARY][W.BOUNDARY]===Ne.FALSE}},{key:"isCrosses",value:function(t,n){return t===Ne.P&&n===Ne.L||t===Ne.P&&n===Ne.A||t===Ne.L&&n===Ne.A?e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&e.isTrue(this._matrix[W.INTERIOR][W.EXTERIOR]):t===Ne.L&&n===Ne.P||t===Ne.A&&n===Ne.P||t===Ne.A&&n===Ne.L?e.isTrue(this._matrix[W.INTERIOR][W.INTERIOR])&&e.isTrue(this._matrix[W.EXTERIOR][W.INTERIOR]):t===Ne.L&&n===Ne.L&&0===this._matrix[W.INTERIOR][W.INTERIOR]}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){if(this._matrix=null,0===arguments.length)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(Ne.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];e.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof e){var n=arguments[0];e.constructor_.call(this),this._matrix[W.INTERIOR][W.INTERIOR]=n._matrix[W.INTERIOR][W.INTERIOR],this._matrix[W.INTERIOR][W.BOUNDARY]=n._matrix[W.INTERIOR][W.BOUNDARY],this._matrix[W.INTERIOR][W.EXTERIOR]=n._matrix[W.INTERIOR][W.EXTERIOR],this._matrix[W.BOUNDARY][W.INTERIOR]=n._matrix[W.BOUNDARY][W.INTERIOR],this._matrix[W.BOUNDARY][W.BOUNDARY]=n._matrix[W.BOUNDARY][W.BOUNDARY],this._matrix[W.BOUNDARY][W.EXTERIOR]=n._matrix[W.BOUNDARY][W.EXTERIOR],this._matrix[W.EXTERIOR][W.INTERIOR]=n._matrix[W.EXTERIOR][W.INTERIOR],this._matrix[W.EXTERIOR][W.BOUNDARY]=n._matrix[W.EXTERIOR][W.BOUNDARY],this._matrix[W.EXTERIOR][W.EXTERIOR]=n._matrix[W.EXTERIOR][W.EXTERIOR]}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return n===Ne.SYM_DONTCARE||n===Ne.SYM_TRUE&&(t>=0||t===Ne.TRUE)||n===Ne.SYM_FALSE&&t===Ne.FALSE||n===Ne.SYM_P&&t===Ne.P||n===Ne.SYM_L&&t===Ne.L||n===Ne.SYM_A&&t===Ne.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var r=arguments[1];return new e(arguments[0]).matches(r)}}},{key:"isTrue",value:function(e){return e>=0||e===Ne.TRUE}}])}(),er=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(e){return null===e||0===e.length?null:(this.ensureCapacity(this._size+e.length),ve.arraycopy(e,0,this._data,this._size,e.length),void(this._size+=e.length))}},{key:"ensureCapacity",value:function(e){if(e<=this._data.length)return null;var t=Math.max(e,2*this._data.length);this._data=Re.copyOf(this._data,t)}},{key:"toArray",value:function(){var e=new Array(this._size).fill(null);return ve.arraycopy(this._data,0,e,0,this._size),e}},{key:"add",value:function(e){this.ensureCapacity(this._size+1),this._data[this._size]=e,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,0===arguments.length)e.constructor_.call(this,10);else if(1===arguments.length){var t=arguments[0];this._data=new Array(t).fill(null)}}}])}(),tr=function(){function e(){n(this,e)}return a(e,[{key:"getChainStartIndices",value:function(e){var t=0,n=new er(Math.trunc(e.length/2));n.add(t);do{var r=this.findChainEnd(e,t);n.add(r),t=r}while(t<e.length-1);return n.toArray()}},{key:"findChainEnd",value:function(e,t){for(var n=Kt.quadrant(e[t],e[t+1]),r=t+1;r<e.length&&Kt.quadrant(e[r-1],e[r])===n;)r++;return r-1}},{key:"OLDgetChainStartIndices",value:function(t){var n=0,r=new fe;r.add(n);do{var i=this.findChainEnd(t,n);r.add(i),n=i}while(n<t.length-1);return e.toIntArray(r)}}],[{key:"toIntArray",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t}}])}(),nr=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n}},{key:"getMinX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n}},{key:"computeIntersectsForChain",value:function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],a=arguments[1],s=arguments[2],o=arguments[3],l=arguments[4],c=arguments[5];if(a-i==1&&l-o==1)return c.addIntersections(this.e,i,s.e,o),null;if(!this.overlaps(i,a,s,o,l))return null;var u=Math.trunc((i+a)/2),h=Math.trunc((o+l)/2);i<u&&(o<h&&this.computeIntersectsForChain(i,u,s,o,h,c),h<l&&this.computeIntersectsForChain(i,u,s,h,l,c)),u<a&&(o<h&&this.computeIntersectsForChain(u,a,s,o,h,c),h<l&&this.computeIntersectsForChain(u,a,s,h,l,c))}}},{key:"overlaps",value:function(e,t,n,r,i){return V.intersects(this.pts[e],this.pts[t],n.pts[r],n.pts[i])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(e,t){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<e.startIndex.length-1;r++)this.computeIntersectsForChain(n,e,r,t)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new tr;this.startIndex=t.getChainStartIndices(this.pts)}}]),rr=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"getDepth",value:function(e,t){return this._depth[e][t]}},{key:"setDepth",value:function(e,t,n){this._depth[e][t]=n}},{key:"isNull",value:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(this._depth[t][n]!==e.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===e.NULL_VALUE}if(2===arguments.length){var i=arguments[0],a=arguments[1];return this._depth[i][a]===e.NULL_VALUE}}},{key:"normalize",value:function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var r=0;this._depth[e][n]>t&&(r=1),this._depth[e][n]=r}}}},{key:"getDelta",value:function(e){return this._depth[e][$.RIGHT]-this._depth[e][$.LEFT]}},{key:"getLocation",value:function(e,t){return this._depth[e][t]<=0?W.EXTERIOR:W.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=t.getLocation(n,r);i!==W.EXTERIOR&&i!==W.INTERIOR||(this.isNull(n,r)?this._depth[n][r]=e.depthAtLocation(i):this._depth[n][r]+=e.depthAtLocation(i))}else if(3===arguments.length){var a=arguments[0],s=arguments[1];arguments[2]===W.INTERIOR&&this._depth[a][s]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var n=0;n<3;n++)this._depth[t][n]=e.NULL_VALUE}},{key:"depthAtLocation",value:function(t){return t===W.EXTERIOR?0:t===W.INTERIOR?1:e.NULL_VALUE}}])}();rr.NULL_VALUE=-1;var ir=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new r(e,Rt.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(e){this._isIsolated=e}},{key:"setName",value:function(e){this._name=e}},{key:"equals",value:function(e){if(!(e instanceof r))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var n=!0,i=!0,a=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(t.pts[s])||(n=!1),this.pts[s].equals2D(t.pts[--a])||(i=!1),!n&&!i)return!1;return!0}},{key:"getCoordinate",value:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}}},{key:"print",value:function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(e){r.updateIM(this._label,e)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")}},{key:"getMonotoneChainEdge",value:function(){return null===this._mce&&(this._mce=new nr(this)),this._mce}},{key:"getEnvelope",value:function(){if(null===this._env){this._env=new V;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env}},{key:"addIntersection",value:function(e,t,n,r){var i=new H(e.getIntersection(r)),a=t,s=e.getEdgeDistance(n,r),o=a+1;if(o<this.pts.length){var l=this.pts[o];i.equals2D(l)&&(a=o,s=0)}this.eiList.add(i,a,s)}},{key:"toString",value:function(){var e=new Je;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()}},{key:"isPointwiseEqual",value:function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0}},{key:"setDepthDelta",value:function(e){this._depthDelta=e}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Zn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new rr,this._depthDelta=0,1===arguments.length){var e=arguments[0];r.constructor_.call(this,e,null)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.pts=t,this._label=n}}},{key:"updateIM",value:function(){if(!(2===arguments.length&&arguments[1]instanceof $n&&arguments[0]instanceof Rt))return d(r,"updateIM",this).apply(this,arguments);var e=arguments[0],t=arguments[1];t.setAtLeastIfValid(e.getLocation(0,$.ON),e.getLocation(1,$.ON),1),e.isArea()&&(t.setAtLeastIfValid(e.getLocation(0,$.LEFT),e.getLocation(1,$.LEFT),2),t.setAtLeastIfValid(e.getLocation(0,$.RIGHT),e.getLocation(1,$.RIGHT),2))}}])}(Dt),ar=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"setWorkingPrecisionModel",value:function(e){this._workingPrecisionModel=e}},{key:"insertUniqueEdge",value:function(t){var n=this._edgeList.findEqualEdge(t);if(null!==n){var r=n.getLabel(),i=t.getLabel();n.isPointwiseEqual(t)||(i=new Rt(t.getLabel())).flip(),r.merge(i);var a=e.depthDelta(i),s=n.getDepthDelta()+a;n.setDepthDelta(s)}else this._edgeList.add(t),t.setDepthDelta(e.depthDelta(t.getLabel()))}},{key:"buildSubgraphs",value:function(e,t){for(var n=new fe,r=e.iterator();r.hasNext();){var i=r.next(),a=i.getRightmostCoordinate(),s=new Ln(n).getDepth(a);i.computeDepth(s),i.findResultEdges(),n.add(i),t.add(i.getDirectedEdges(),i.getNodes())}}},{key:"createSubgraphs",value:function(e){for(var t=new fe,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new me;i.create(r),t.add(i)}}return sn.sort(t,sn.reverseOrder()),t}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new kn,n=new Tt;return n.setPrecisionModel(e),t.setSegmentIntersector(new Yn(n)),t}},{key:"buffer",value:function(e,t){var n=this._workingPrecisionModel;null===n&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new Rn(n,this._bufParams),i=new jn(e,t,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Zt(new Wn),this._graph.addEdges(this._edgeList.getEdges());var a=this.createSubgraphs(this._graph),s=new $t(this._geomFact);this.buildSubgraphs(a,s);var o=s.getPolygons();return o.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(o)}},{key:"computeNodedEdges",value:function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),a=i.getCoordinates();if(2!==a.length||!a[0].equals2D(a[1])){var s=i.getData(),o=new ir(i.getCoordinates(),new Rt(s));this.insertUniqueEdge(o)}}}},{key:"setNoder",value:function(e){this._workingNoder=e}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Kn;var e=arguments[0];this._bufParams=e}},{key:"depthDelta",value:function(e){var t=e.getLocation(0,$.LEFT),n=e.getLocation(0,$.RIGHT);return t===W.INTERIOR&&n===W.EXTERIOR?1:t===W.EXTERIOR&&n===W.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(e){for(var t=new st,n=new fe;e.hasNext();){var r=e.next(),i=t.createLineString(r.getCoordinates());n.add(i)}return t.buildGeometry(n)}}])}(),sr=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"rescale",value:function(){if(ie(arguments[0],q))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],r=0;r<n.length;r++)n[r].x=n[r].x/this._scaleFactor+this._offsetX,n[r].y=n[r].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&ve.out.println(n)}}},{key:"scale",value:function(){if(ie(arguments[0],q)){for(var e=arguments[0],t=new fe(e.size()),n=e.iterator();n.hasNext();){var r=n.next();t.add(new xn(this.scale(r.getCoordinates()),r.getData()))}return t}if(arguments[0]instanceof Array){for(var i=arguments[0],a=new Array(i.length).fill(null),s=0;s<i.length;s++)a[s]=new H(Math.round((i[s].x-this._offsetX)*this._scaleFactor),Math.round((i[s].y-this._offsetY)*this._scaleFactor),i[s].getZ());return Ke.removeRepeatedPoints(a)}}},{key:"isIntegerPrecision",value:function(){return 1===this._scaleFactor}},{key:"getNodedSubstrings",value:function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e}},{key:"computeNodes",value:function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)}},{key:"interfaces_",get:function(){return[En]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],n=arguments[1];e.constructor_.call(this,t,n,0,0)}else if(4===arguments.length){var r=arguments[0],i=arguments[1];this._noder=r,this._scaleFactor=i,this._isScaled=!this.isIntegerPrecision()}}}])}(),or=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"checkEndPtVertexIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var i=r.next().getCoordinates(),a=1;a<i.length-1;a++)if(i[a].equals(n))throw new P("found endpt/interior pt intersection at index "+a+" :pt "+n)}},{key:"checkInteriorIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();this.checkInteriorIntersections(t,r)}else if(2===arguments.length)for(var i=arguments[0],a=arguments[1],s=i.getCoordinates(),o=a.getCoordinates(),l=0;l<s.length-1;l++)for(var c=0;c<o.length-1;c++)this.checkInteriorIntersections(i,l,a,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],d=arguments[2],A=arguments[3];if(u===d&&h===A)return null;var p=u.getCoordinates()[h],f=u.getCoordinates()[h+1],g=d.getCoordinates()[A],m=d.getCoordinates()[A+1];if(this._li.computeIntersection(p,f,g,m),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,p,f)||this.hasInteriorIntersection(this._li,g,m)))throw new P("found non-noded intersection at "+p+"-"+f+" and "+g+"-"+m)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),r=0;r<n.length-2;r++)this.checkCollapse(n[r],n[r+1],n[r+2])}},{key:"hasInteriorIntersection",value:function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var i=e.getIntersection(r);if(!i.equals(t)&&!i.equals(n))return!0}return!1}},{key:"checkCollapse",value:function(t,n,r){if(t.equals(r))throw new P("found non-noded collapse at "+e.fact.createLineString([t,n,r]))}}],[{key:"constructor_",value:function(){this._li=new Tt,this._segStrings=null;var e=arguments[0];this._segStrings=e}}])}();or.fact=new st;var lr=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"intersectsScaled",value:function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),i=Math.min(e.y,t.y),a=Math.max(e.y,t.y),s=this._maxx<n||this._minx>r||this._maxy<i||this._miny>a;if(s)return!1;var o=this.intersectsToleranceSquare(e,t);return D.isTrue(!(s&&o),"Found bad envelope test"),o}},{key:"initCorners",value:function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new H(this._maxx,this._maxy),this._corner[1]=new H(this._minx,this._maxy),this._corner[2]=new H(this._minx,this._miny),this._corner[3]=new H(this._maxx,this._miny)}},{key:"intersects",value:function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(e){return Math.round(e*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)}},{key:"getSafeEnvelope",value:function(){if(null===this._safeEnv){var t=e.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new V(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!n||!r)||!!e.equals(this._pt)||!!t.equals(this._pt))))}},{key:"addSnappedNode",value:function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(n,r)&&(e.addIntersection(this.getCoordinate(),t),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new v("Scale factor must be non-zero");1!==t&&(this._pt=new H(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new H,this._p1Scaled=new H),this.initCorners(this._pt)}}])}();lr.SAFE_ENV_EXPANSION_FACTOR=.75;var cr=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[1];arguments[0].getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new wn}}]),ur=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],r=arguments[1],i=arguments[2],s=t.getSafeEnvelope(),o=new hr(t,r,i);return this._index.query(s,new(a(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[cn]}},{key:"visitItem",value:function(e){e.select(s,o)}}]))),o.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var e=arguments[0];this._index=e}}]),hr=function(e){function r(){var e;return n(this,r),e=t(this,r),r.constructor_.apply(e,arguments),e}return c(r,e),a(r,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof Sn))return d(r,"select",this,1).apply(this,arguments);var e=arguments[1],t=arguments[0].getContext();if(this._parentEdge===t&&(e===this._hotPixelVertexIndex||e+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(t,e)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=n}}])}(cr);ur.HotPixelSnapAction=hr;var dr=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(e,t,n,r){if(e===n&&t===r)return null;var i=e.getCoordinates()[t],a=e.getCoordinates()[t+1],s=n.getCoordinates()[r],o=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,a,s,o),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Xn]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new fe}}]),Ar=a(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(e){var t=xn.getNodedSubstrings(e),n=new or(t);try{n.checkValid()}catch(e){if(!(e instanceof y))throw e;e.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return xn.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)}},{key:"findInteriorIntersections",value:function(e,t){var n=new dr(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(ie(arguments[0],q))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof xn)for(var n=arguments[0],r=n.getCoordinates(),i=0;i<r.length;i++){var a=new lr(r[i],this._scaleFactor,this._li);this._pointSnapper.snap(a,n,i)&&n.addIntersection(r[i],i)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e,this._noder=new kn,this._pointSnapper=new ur(this._noder.getIndex()),this.snapRound(e,this._li)}},{key:"computeIntersectionSnaps",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),r=new lr(n,this._scaleFactor,this._li);this._pointSnapper.snap(r)}}},{key:"interfaces_",get:function(){return[En]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Tt,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}}]),pr=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return a(e,[{key:"bufferFixedPrecision",value:function(e){var t=new sr(new Ar(new rt(1)),e.getScale()),n=new ar(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(0===arguments.length){for(var t=e.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(e){if(!(e instanceof Ae))throw e;this._saveException=e}if(null!==this._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=e.precisionScaleFactor(this._argGeom,this._distance,n),i=new rt(r);this.bufferFixedPrecision(i)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===rt.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(e){this._bufParams.setQuadrantSegments(e)}},{key:"bufferOriginalPrecision",value:function(){try{var e=new ar(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof P))throw e;this._saveException=e}}},{key:"getResultGeometry",value:function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(e){this._bufParams.setEndCapStyle(e)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new m,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}}},{key:"bufferOp",value:function(){if(2===arguments.length){var t=arguments[1];return new e(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof G&&"number"==typeof arguments[1]){var n=arguments[1],r=arguments[2],i=new e(arguments[0]);return i.setQuadrantSegments(r),i.getResultGeometry(n)}if(arguments[2]instanceof m&&arguments[0]instanceof G&&"number"==typeof arguments[1]){var a=arguments[1];return new e(arguments[0],arguments[2]).getResultGeometry(a)}}else if(4===arguments.length){var s=arguments[1],o=arguments[2],l=arguments[3],c=new e(arguments[0]);return c.setQuadrantSegments(o),c.setEndCapStyle(l),c.getResultGeometry(s)}}},{key:"precisionScaleFactor",value:function(e,t,n){var r=e.getEnvelopeInternal(),i=be.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(t>0?t:0),a=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,a)}}])}();pr.CAP_ROUND=m.CAP_ROUND,pr.CAP_BUTT=m.CAP_FLAT,pr.CAP_FLAT=m.CAP_FLAT,pr.CAP_SQUARE=m.CAP_SQUARE,pr.MAX_PRECISION_DIGITS=12;var fr=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],gr=a(function e(t){n(this,e),this.geometryFactory=t||new st},[{key:"read",value:function(e){var t,n=(t="string"==typeof e?JSON.parse(e):e).type;if(!mr[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==fr.indexOf(n)?mr[n].call(this,t.coordinates):"GeometryCollection"===n?mr[n].call(this,t.geometries):mr[n].call(this,t)}},{key:"write",value:function(e){var t=e.getGeometryType();if(!yr[t])throw new Error("Geometry is not supported");return yr[t].call(this,e)}}]),mr={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var r=e.geometry.type;if(!mr[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=mr.bbox.call(this,e.bbox)),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var n=0;n<e.features.length;++n)t.features.push(this.read(e.features[n]))}return e.bbox&&(t.bbox=this.parse.bbox.call(this,e.bbox)),t},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(r(H,A(i)))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new H(e[0],e[1]),new H(e[2],e[1]),new H(e[2],e[3]),new H(e[0],e[3]),new H(e[0],e[1])])},Point:function(e){var t=r(H,A(e));return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],n=0;n<e.length;++n)t.push(mr.Point.call(this,e[n]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=mr.coordinates.call(this,e);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],n=0;n<e.length;++n)t.push(mr.LineString.call(this,e[n]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=mr.coordinates.call(this,e[0]),n=this.geometryFactory.createLinearRing(t),r=[],i=1;i<e.length;++i){var a=e[i],s=mr.coordinates.call(this,a),o=this.geometryFactory.createLinearRing(s);r.push(o)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(mr.Polygon.call(this,r))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(this.read(r))}return this.geometryFactory.createGeometryCollection(t)}},yr={coordinate:function(e){var t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t},Point:function(e){return{type:"Point",coordinates:yr.coordinate.call(this,e.getCoordinate())}},MultiPoint:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=yr.Point.call(this,r);t.push(i.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],n=e.getCoordinates(),r=0;r<n.length;++r){var i=n[r];t.push(yr.coordinate.call(this,i))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=yr.LineString.call(this,r);t.push(i.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],n=yr.LineString.call(this,e._shell);t.push(n.coordinates);for(var r=0;r<e._holes.length;++r){var i=e._holes[r],a=yr.LineString.call(this,i);t.push(a.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=yr.Polygon.call(this,r);t.push(i.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=r.getGeometryType();t.push(yr[i].call(this,r))}return{type:"GeometryCollection",geometries:t}}};return{BufferOp:pr,GeoJSONReader:a(function e(t){n(this,e),this.parser=new gr(t||new st)},[{key:"read",value:function(e){return this.parser.read(e)}}]),GeoJSONWriter:a(function e(){n(this,e),this.parser=new gr(this.geometryFactory)},[{key:"write",value:function(e){return this.parser.write(e)}}])}}()},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,g&&(g=!1,y(E),E=-1),p=!0;var a=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,k=-1;function I(){return!(t.unstable_now()-k<N)}function T(){if(null!==C){var e=t.unstable_now();k=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(T)};else if("undefined"!==typeof MessageChannel){var B=new MessageChannel,M=B.port2;B.port1.onmessage=T,_=function(){M.postMessage(null)}}else _=function(){m(T,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=m(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(y(E),E=-1):g=!0,R(x,a-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}},7302:(e,t)=>{"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},7359:function(e,t,n){var r;!function(e,i){function a(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new a(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.alea=o}(0,e=n.nmd(e),n.amdD)},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8108:()=>{},8513:(e,t,n)=>{"use strict";e.exports=n(2062)},8590:()=>{},8784:(e,t,n)=>{"use strict";e.exports=n(9813)},8818:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(C){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},a={};function s(e,t){var n,r,s;return t?(s=0<=(e>>>=0)&&e<256)&&(r=a[e])?r:(n=l(e,(0|e)<0?-1:0,!0),s&&(a[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=l(e,e<0?-1:0,!1),s&&(i[e]=n),n)}function o(e,t){if(isNaN(e))return t?m:g;if(t){if(e<0)return m;if(e>=A)return w}else{if(e<=-p)return _;if(e+1>=p)return x}return e<0?o(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=s,n.fromNumber=o,n.fromBits=l;var c=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return u(e.substring(1),t,n).neg();for(var i=o(c(n,8)),a=g,s=0;s<e.length;s+=8){var l=Math.min(8,e.length-s),h=parseInt(e.substring(s,s+l),n);if(l<8){var d=o(c(n,l));a=a.mul(d).add(o(h))}else a=(a=a.mul(i)).add(o(h))}return a.unsigned=t,a}function h(e,t){return"number"===typeof e?o(e,t):"string"===typeof e?u(e,t):l(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=h;var d=4294967296,A=d*d,p=A/2,f=s(1<<24),g=s(0);n.ZERO=g;var m=s(0,!0);n.UZERO=m;var y=s(1);n.ONE=y;var v=s(1,!0);n.UONE=v;var b=s(-1);n.NEG_ONE=b;var x=l(-1,2147483647,!1);n.MAX_VALUE=x;var w=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var _=l(0,-2147483648,!1);n.MIN_VALUE=_;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=o(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(c(e,6),this.unsigned),a=this,s="";;){var l=a.div(i),u=(a.sub(l.mul(i)).toInt()>>>0).toString(e);if((a=l).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(y)},S.neg=S.negate,S.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,a=65535&this.low,s=e.high>>>16,o=65535&e.high,c=e.low>>>16,u=0,d=0,A=0,p=0;return A+=(p+=a+(65535&e.low))>>>16,d+=(A+=i+c)>>>16,u+=(d+=n+o)>>>16,u+=t+s,l((A&=65535)<<16|(p&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return g;if(r(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(_))return e.isOdd()?_:g;if(e.eq(_))return this.isOdd()?_:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return o(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,a=this.low>>>16,s=65535&this.low,c=e.high>>>16,u=65535&e.high,d=e.low>>>16,A=65535&e.low,p=0,m=0,y=0,v=0;return y+=(v+=s*A)>>>16,m+=(y+=a*A)>>>16,y&=65535,m+=(y+=s*d)>>>16,p+=(m+=i*A)>>>16,m&=65535,p+=(m+=a*d)>>>16,m&=65535,p+=(m+=s*u)>>>16,p+=n*A+i*d+a*u+s*c,l((y&=65535)<<16|(v&=65535),(p&=65535)<<16|(m&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,i,a;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?m:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return m;if(e.gt(this.shru(1)))return v;a=m}else{if(this.eq(_))return e.eq(y)||e.eq(b)?_:e.eq(_)?y:(n=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?y:b:(i=this.sub(e.mul(n)),a=n.add(i.div(e)));if(e.eq(_))return this.unsigned?m:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=g}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:c(2,s-48),d=o(n),A=d.mul(e);A.isNegative()||A.gt(i);)A=(d=o(n-=u,this.unsigned)).mul(e);d.isZero()&&(d=y),a=a.add(d),i=i.sub(A)}return a},S.div=S.divide,S.modulo=function(e){return r(e)||(e=h(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return l(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},9016:function(e,t,n){var r;!function(e,i){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.xorwow=o}(0,e=n.nmd(e),n.amdD)},9538:function(e,t,n){var r;!function(e,i){function a(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=o:n.amdD&&n.amdO?void 0===(r=function(){return o}.call(t,n,t,i))||(i.exports=r):this.xorshift7=o}(0,e=n.nmd(e),n.amdD)},9813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>a(l,n))c<i&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,A=3,p=!1,f=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(g=!1,b(e),!f)if(null!==r(c))f=!0,F(w);else{var t=r(u);null!==t&&R(x,t.startTime-e)}}function w(e,n){f=!1,g&&(g=!1,y(E),E=-1),p=!0;var a=A;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var s=d.callback;if("function"===typeof s){d.callback=null,A=d.priorityLevel;var o=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?d.callback=o:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&R(x,h.startTime-n),l=!1}return l}finally{d=null,A=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,E=-1,N=5,k=-1;function I(){return!(t.unstable_now()-k<N)}function T(){if(null!==C){var e=t.unstable_now();k=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof v)_=function(){v(T)};else if("undefined"!==typeof MessageChannel){var B=new MessageChannel,M=B.port2;B.port1.onmessage=T,_=function(){M.postMessage(null)}}else _=function(){m(T,0)};function F(e){C=e,S||(S=!0,_())}function R(e,n){E=m(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,F(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var n=A;A=t;try{return e()}finally{A=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=A;A=e;try{return t()}finally{A=n}},t.unstable_scheduleCallback=function(e,i,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(g?(y(E),E=-1):g=!0,R(x,a-s))):(e.sortIndex=o,n(c,e),f||p||(f=!0,F(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=A;return function(){var n=A;A=t;try{return e.apply(this,arguments)}finally{A=n}}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>s[e]=()=>r[e]);return s.default=()=>r,n.d(a,s),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,r)=>(n.f[r](e,t),t),[])),n.u=e=>"static/js/"+e+"."+{455:"073ea903",977:"fde04b13"}[e]+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="bhotch-crm:";n.l=(r,i,a,s)=>{if(e[r])e[r].push(i);else{var o,l;if(void 0!==a)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+a){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+a),o.src=r),e[r]=[i];var d=(t,n)=>{o.onerror=o.onload=null,clearTimeout(A);var i=e[r];if(delete e[r],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(e=>e(n)),t)return t(n)},A=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise((n,r)=>i=e[t]=[n,r]);r.push(i[2]=a);var s=n.p+n.u(t),o=new Error;n.l(s,r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",o.name="ChunkLoadError",o.type=a,o.request=s,i[1](o)}},"chunk-"+t,t)}};var t=(t,r)=>{var i,a,s=r[0],o=r[1],l=r[2],c=0;if(s.some(t=>0!==e[t])){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);if(l)l(n)}for(t&&t(r);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkbhotch_crm=self.webpackChunkbhotch_crm||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:()=>go,AddEquation:()=>Rs,AddOperation:()=>uo,AdditiveAnimationBlendMode:()=>$l,AdditiveBlending:()=>Ts,AgXToneMapping:()=>yo,AlphaFormat:()=>el,AlwaysCompare:()=>Uc,AlwaysDepth:()=>to,AlwaysStencilFunc:()=>Ic,AmbientLight:()=>ny,AnimationAction:()=>qy,AnimationClip:()=>Sm,AnimationLoader:()=>Fm,AnimationMixer:()=>Xy,AnimationObjectGroup:()=>Wy,AnimationUtils:()=>hm,ArcCurve:()=>Lf,ArrayCamera:()=>_y,ArrowHelper:()=>Yv,AttachedBindMode:()=>bo,Audio:()=>By,AudioAnalyser:()=>Uy,AudioContext:()=>my,AudioListener:()=>Ty,AudioLoader:()=>yy,AxesHelper:()=>Jv,BackSide:()=>Es,BasicDepthPacking:()=>rc,BasicShadowMap:()=>xs,BatchedMesh:()=>Vp,Bone:()=>tp,BooleanKeyframeTrack:()=>mm,Box2:()=>dv,Box3:()=>qu,Box3Helper:()=>Gv,BoxGeometry:()=>nA,BoxHelper:()=>Vv,BufferAttribute:()=>Cd,BufferGeometry:()=>Hd,BufferGeometryLoader:()=>cy,ByteType:()=>Ho,Cache:()=>Em,Camera:()=>lA,CameraHelper:()=>zv,CanvasTexture:()=>vf,CapsuleGeometry:()=>wf,CatmullRomCurve3:()=>zf,CineonToneMapping:()=>fo,CircleGeometry:()=>_f,ClampToEdgeWrapping:()=>Io,Clock:()=>Sy,Color:()=>dd,ColorKeyframeTrack:()=>ym,ColorManagement:()=>Iu,CompressedArrayTexture:()=>mf,CompressedCubeTexture:()=>yf,CompressedTexture:()=>gf,CompressedTextureLoader:()=>Rm,ConeGeometry:()=>Cf,ConstantAlphaFactor:()=>Zs,ConstantColorFactor:()=>Ys,Controls:()=>$v,CubeCamera:()=>pA,CubeReflectionMapping:()=>_o,CubeRefractionMapping:()=>So,CubeTexture:()=>fA,CubeTextureLoader:()=>Um,CubeUVReflectionMapping:()=>No,CubicBezierCurve:()=>Gf,CubicBezierCurve3:()=>Wf,CubicInterpolant:()=>Am,CullFaceBack:()=>ys,CullFaceFront:()=>vs,CullFaceFrontBack:()=>bs,CullFaceNone:()=>ms,Curve:()=>Ff,CurvePath:()=>$f,CustomBlending:()=>Fs,CustomToneMapping:()=>mo,CylinderGeometry:()=>Sf,Cylindrical:()=>cv,Data3DTexture:()=>Gu,DataArrayTexture:()=>Qu,DataTexture:()=>np,DataTextureLoader:()=>Dm,DataUtils:()=>xd,DecrementStencilOp:()=>yc,DecrementWrapStencilOp:()=>bc,DefaultLoadingManager:()=>km,DepthFormat:()=>rl,DepthStencilFormat:()=>il,DepthTexture:()=>bf,DetachedBindMode:()=>xo,DirectionalLight:()=>ty,DirectionalLightHelper:()=>Dv,DiscreteInterpolant:()=>fm,DodecahedronGeometry:()=>Nf,DoubleSide:()=>Ns,DstAlphaFactor:()=>Gs,DstColorFactor:()=>qs,DynamicCopyUsage:()=>Gc,DynamicDrawUsage:()=>Oc,DynamicReadUsage:()=>Hc,EdgesGeometry:()=>Mf,EllipseCurve:()=>Rf,EqualCompare:()=>Mc,EqualDepth:()=>io,EqualStencilFunc:()=>Sc,EquirectangularReflectionMapping:()=>Co,EquirectangularRefractionMapping:()=>Eo,Euler:()=>Th,EventDispatcher:()=>eu,ExternalTexture:()=>xf,ExtrudeGeometry:()=>Mg,FileLoader:()=>Mm,Float16BufferAttribute:()=>Fd,Float32BufferAttribute:()=>Rd,FloatType:()=>qo,Fog:()=>xA,FogExp2:()=>bA,FramebufferTexture:()=>ff,FrontSide:()=>Cs,Frustum:()=>wp,FrustumArray:()=>Cp,GLBufferAttribute:()=>tv,GLSL1:()=>qc,GLSL3:()=>Kc,GreaterCompare:()=>Rc,GreaterDepth:()=>so,GreaterEqualCompare:()=>Pc,GreaterEqualDepth:()=>ao,GreaterEqualStencilFunc:()=>kc,GreaterStencilFunc:()=>Ec,GridHelper:()=>Fv,Group:()=>mA,HalfFloatType:()=>Ko,HemisphereLight:()=>zm,HemisphereLightHelper:()=>Mv,IcosahedronGeometry:()=>Rg,ImageBitmapLoader:()=>fy,ImageLoader:()=>Pm,ImageUtils:()=>Fu,IncrementStencilOp:()=>mc,IncrementWrapStencilOp:()=>vc,InstancedBufferAttribute:()=>sp,InstancedBufferGeometry:()=>ly,InstancedInterleavedBuffer:()=>ev,InstancedMesh:()=>pp,Int16BufferAttribute:()=>Id,Int32BufferAttribute:()=>Bd,Int8BufferAttribute:()=>Ed,IntType:()=>Go,InterleavedBuffer:()=>_A,InterleavedBufferAttribute:()=>CA,Interpolant:()=>dm,InterpolateDiscrete:()=>Wl,InterpolateLinear:()=>ql,InterpolateSmooth:()=>Kl,InterpolationSamplingMode:()=>$c,InterpolationSamplingType:()=>Zc,InvertStencilOp:()=>xc,KeepStencilOp:()=>fc,KeyframeTrack:()=>gm,LOD:()=>VA,LatheGeometry:()=>Lg,Layers:()=>Bh,LessCompare:()=>Bc,LessDepth:()=>no,LessEqualCompare:()=>Fc,LessEqualDepth:()=>ro,LessEqualStencilFunc:()=>Cc,LessStencilFunc:()=>_c,Light:()=>jm,LightProbe:()=>ay,Line:()=>$p,Line3:()=>bv,LineBasicMaterial:()=>Gp,LineCurve:()=>qf,LineCurve3:()=>Kf,LineDashedMaterial:()=>am,LineLoop:()=>af,LineSegments:()=>rf,LinearFilter:()=>Po,LinearInterpolant:()=>pm,LinearMipMapLinearFilter:()=>jo,LinearMipMapNearestFilter:()=>Do,LinearMipmapLinearFilter:()=>Oo,LinearMipmapNearestFilter:()=>Uo,LinearSRGBColorSpace:()=>hc,LinearToneMapping:()=>Ao,LinearTransfer:()=>dc,Loader:()=>Im,LoaderUtils:()=>oy,LoadingManager:()=>Nm,LoopOnce:()=>Ql,LoopPingPong:()=>Gl,LoopRepeat:()=>Vl,MOUSE:()=>fs,Material:()=>fd,MaterialLoader:()=>sy,MathUtils:()=>hu,Matrix2:()=>uv,Matrix3:()=>mu,Matrix4:()=>bh,MaxEquation:()=>Ds,Mesh:()=>eA,MeshBasicMaterial:()=>gd,MeshDepthMaterial:()=>nm,MeshDistanceMaterial:()=>rm,MeshLambertMaterial:()=>tm,MeshMatcapMaterial:()=>im,MeshNormalMaterial:()=>em,MeshPhongMaterial:()=>Zg,MeshPhysicalMaterial:()=>Jg,MeshStandardMaterial:()=>Yg,MeshToonMaterial:()=>$g,MinEquation:()=>Us,MirroredRepeatWrapping:()=>To,MixOperation:()=>co,MultiplyBlending:()=>Ms,MultiplyOperation:()=>lo,NearestFilter:()=>Bo,NearestMipMapLinearFilter:()=>Lo,NearestMipMapNearestFilter:()=>Fo,NearestMipmapLinearFilter:()=>Ro,NearestMipmapNearestFilter:()=>Mo,NeutralToneMapping:()=>vo,NeverCompare:()=>Tc,NeverDepth:()=>eo,NeverStencilFunc:()=>wc,NoBlending:()=>ks,NoColorSpace:()=>cc,NoToneMapping:()=>ho,NormalAnimationBlendMode:()=>Zl,NormalBlending:()=>Is,NotEqualCompare:()=>Lc,NotEqualDepth:()=>oo,NotEqualStencilFunc:()=>Nc,NumberKeyframeTrack:()=>vm,Object3D:()=>qh,ObjectLoader:()=>uy,ObjectSpaceNormalMap:()=>lc,OctahedronGeometry:()=>Pg,OneFactor:()=>js,OneMinusConstantAlphaFactor:()=>$s,OneMinusConstantColorFactor:()=>Js,OneMinusDstAlphaFactor:()=>Ws,OneMinusDstColorFactor:()=>Ks,OneMinusSrcAlphaFactor:()=>Vs,OneMinusSrcColorFactor:()=>Hs,OrthographicCamera:()=>$m,PCFShadowMap:()=>ws,PCFSoftShadowMap:()=>_s,PMREMGenerator:()=>kb,Path:()=>eg,PerspectiveCamera:()=>dA,Plane:()=>yp,PlaneGeometry:()=>Ug,PlaneHelper:()=>Wv,PointLight:()=>Zm,PointLightHelper:()=>kv,Points:()=>hf,PointsMaterial:()=>sf,PolarGridHelper:()=>Rv,PolyhedronGeometry:()=>Ef,PositionalAudio:()=>Py,PropertyBinding:()=>Gy,PropertyMixer:()=>Dy,QuadraticBezierCurve:()=>Xf,QuadraticBezierCurve3:()=>Yf,Quaternion:()=>Au,QuaternionKeyframeTrack:()=>xm,QuaternionLinearInterpolant:()=>bm,RED_GREEN_RGTC2_Format:()=>zl,RED_RGTC1_Format:()=>Ol,REVISION:()=>ps,RGBADepthPacking:()=>ic,RGBAFormat:()=>nl,RGBAIntegerFormat:()=>ul,RGBA_ASTC_10x10_Format:()=>Fl,RGBA_ASTC_10x5_Format:()=>Tl,RGBA_ASTC_10x6_Format:()=>Bl,RGBA_ASTC_10x8_Format:()=>Ml,RGBA_ASTC_12x10_Format:()=>Rl,RGBA_ASTC_12x12_Format:()=>Ll,RGBA_ASTC_4x4_Format:()=>wl,RGBA_ASTC_5x4_Format:()=>_l,RGBA_ASTC_5x5_Format:()=>Sl,RGBA_ASTC_6x5_Format:()=>Cl,RGBA_ASTC_6x6_Format:()=>El,RGBA_ASTC_8x5_Format:()=>Nl,RGBA_ASTC_8x6_Format:()=>kl,RGBA_ASTC_8x8_Format:()=>Il,RGBA_BPTC_Format:()=>Pl,RGBA_ETC2_EAC_Format:()=>xl,RGBA_PVRTC_2BPPV1_Format:()=>yl,RGBA_PVRTC_4BPPV1_Format:()=>ml,RGBA_S3TC_DXT1_Format:()=>dl,RGBA_S3TC_DXT3_Format:()=>Al,RGBA_S3TC_DXT5_Format:()=>pl,RGBDepthPacking:()=>ac,RGBFormat:()=>tl,RGBIntegerFormat:()=>cl,RGB_BPTC_SIGNED_Format:()=>Ul,RGB_BPTC_UNSIGNED_Format:()=>Dl,RGB_ETC1_Format:()=>vl,RGB_ETC2_Format:()=>bl,RGB_PVRTC_2BPPV1_Format:()=>gl,RGB_PVRTC_4BPPV1_Format:()=>fl,RGB_S3TC_DXT1_Format:()=>hl,RGDepthPacking:()=>sc,RGFormat:()=>ol,RGIntegerFormat:()=>ll,RawShaderMaterial:()=>Xg,Ray:()=>vh,Raycaster:()=>rv,RectAreaLight:()=>ry,RedFormat:()=>al,RedIntegerFormat:()=>sl,ReinhardToneMapping:()=>po,RenderTarget:()=>zu,RenderTarget3D:()=>Yy,RepeatWrapping:()=>ko,ReplaceStencilOp:()=>gc,ReverseSubtractEquation:()=>Ps,RingGeometry:()=>Dg,SIGNED_RED_GREEN_RGTC2_Format:()=>Hl,SIGNED_RED_RGTC1_Format:()=>jl,SRGBColorSpace:()=>uc,SRGBTransfer:()=>Ac,Scene:()=>wA,ShaderChunk:()=>ib,ShaderLib:()=>sb,ShaderMaterial:()=>oA,ShadowMaterial:()=>Kg,Shape:()=>tg,ShapeGeometry:()=>Og,ShapePath:()=>Zv,ShapeUtils:()=>Ig,ShortType:()=>Qo,Skeleton:()=>ap,SkeletonHelper:()=>Ev,SkinnedMesh:()=>ep,Source:()=>Lu,Sphere:()=>hh,SphereGeometry:()=>jg,Spherical:()=>lv,SphericalHarmonics3:()=>iy,SplineCurve:()=>Jf,SpotLight:()=>qm,SpotLightHelper:()=>wv,Sprite:()=>jA,SpriteMaterial:()=>EA,SrcAlphaFactor:()=>Qs,SrcAlphaSaturateFactor:()=>Xs,SrcColorFactor:()=>zs,StaticCopyUsage:()=>Vc,StaticDrawUsage:()=>Dc,StaticReadUsage:()=>zc,StereoCamera:()=>wy,StreamCopyUsage:()=>Wc,StreamDrawUsage:()=>jc,StreamReadUsage:()=>Qc,StringKeyframeTrack:()=>wm,SubtractEquation:()=>Ls,SubtractiveBlending:()=>Bs,TOUCH:()=>gs,TangentSpaceNormalMap:()=>oc,TetrahedronGeometry:()=>zg,Texture:()=>Ou,TextureLoader:()=>Om,TextureUtils:()=>tb,Timer:()=>sv,TimestampQuery:()=>Jc,TorusGeometry:()=>Hg,TorusKnotGeometry:()=>Qg,Triangle:()=>od,TriangleFanDrawMode:()=>nc,TriangleStripDrawMode:()=>tc,TrianglesDrawMode:()=>ec,TubeGeometry:()=>Vg,UVMapping:()=>wo,Uint16BufferAttribute:()=>Td,Uint32BufferAttribute:()=>Md,Uint8BufferAttribute:()=>Nd,Uint8ClampedBufferAttribute:()=>kd,Uniform:()=>Jy,UniformsGroup:()=>$y,UniformsLib:()=>ab,UniformsUtils:()=>sA,UnsignedByteType:()=>zo,UnsignedInt101111Type:()=>$o,UnsignedInt248Type:()=>Jo,UnsignedInt5999Type:()=>Zo,UnsignedIntType:()=>Wo,UnsignedShort4444Type:()=>Xo,UnsignedShort5551Type:()=>Yo,UnsignedShortType:()=>Vo,VSMShadowMap:()=>Ss,Vector2:()=>du,Vector3:()=>pu,Vector4:()=>ju,VectorKeyframeTrack:()=>_m,VideoFrameTexture:()=>pf,VideoTexture:()=>Af,WebGL3DRenderTarget:()=>Wu,WebGLArrayRenderTarget:()=>Vu,WebGLCoordinateSystem:()=>Xc,WebGLCubeRenderTarget:()=>gA,WebGLRenderTarget:()=>Hu,WebGLRenderer:()=>Uw,WebGLUtils:()=>Tw,WebGPUCoordinateSystem:()=>Yc,WebXRController:()=>vA,WireframeGeometry:()=>Gg,WrapAroundEnding:()=>Jl,ZeroCurvatureEnding:()=>Xl,ZeroFactor:()=>Os,ZeroSlopeEnding:()=>Yl,ZeroStencilOp:()=>pc,createCanvasElement:()=>_u});var t={};n.r(t),n.d(t,{CompositeArrayBuffer:()=>mB,browserFiles:()=>dF,browserHTTPRequest:()=>xF,concatenateArrayBuffers:()=>UB,copyModel:()=>wM,decodeWeights:()=>kB,decodeWeightsStream:()=>FB,encodeWeights:()=>NB,fromMemory:()=>CF,fromMemorySync:()=>EF,getLoadHandlers:()=>KB,getModelArtifactsForJSON:()=>zB,getModelArtifactsForJSONSync:()=>jB,getModelArtifactsInfoForJSON:()=>HB,getSaveHandlers:()=>qB,getWeightSpecs:()=>QB,http:()=>bF,isHTTPScheme:()=>yF,listModels:()=>bM,loadWeights:()=>fF,moveModel:()=>_M,registerLoadRouter:()=>WB,registerSaveRouter:()=>GB,removeModel:()=>xM,weightsLoaderFactory:()=>gF,withSaveHandler:()=>NF,withSaveHandlerSync:()=>kF});var r={};n.r(r),n.d(r,{assertParamsValid:()=>LF,computeFlatOffset:()=>KF,computeOutShape:()=>UF,getNormalizedAxes:()=>zF,isSliceContinous:()=>qF,maskToAxes:()=>PF,parseSliceParams:()=>XF,sliceInfo:()=>YF,startForAxis:()=>GF,startIndicesWithElidedDims:()=>HF,stopForAxis:()=>WF,stopIndicesWithElidedDims:()=>QF,stridesForAxis:()=>VF,stridesWithElidedDims:()=>DF});var i={};n.r(i),n.d(i,{conv2d:()=>cD,depthwiseConv2d:()=>dD,matMul:()=>AD});var a={};n.r(a),n.d(a,{collectGatherOpShapeInfo:()=>Sj,computeOutShape:()=>_j,segOpComputeOptimalWindowSize:()=>wj});var s={};n.r(s),n.d(s,{ERF_A1:()=>jO,ERF_A2:()=>zO,ERF_A3:()=>HO,ERF_A4:()=>QO,ERF_A5:()=>VO,ERF_P:()=>OO,PARALLELIZE_THRESHOLD:()=>kO,RowPartitionType:()=>_O,SELU_SCALE:()=>DO,SELU_SCALEALPHA:()=>UO,applyActivation:()=>oD,assertAndGetBroadcastShape:()=>nF,assertAxesAreInnerMostDims:()=>_L,assertParamsConsistent:()=>xO,assignToTypedArray:()=>YO,axesAreInnerMostDims:()=>vL,calculateShapes:()=>UU,checkEinsumDimSizes:()=>aj,checkPadOnDimRoundingMode:()=>SR,combineLocations:()=>bL,combineRaggedTensorToTensorShapes:()=>SO,complexWithEvenIndex:()=>qO,complexWithOddIndex:()=>KO,computeConv2DInfo:()=>AR,computeConv3DInfo:()=>pR,computeDefaultPad:()=>fR,computeDilation2DInfo:()=>uR,computeOptimalWindowSize:()=>IO,computeOutAndReduceShapes:()=>xL,computeOutShape:()=>wO,computePool2DInfo:()=>hR,computePool3DInfo:()=>dR,convertConv2DDataFormat:()=>_R,decodeEinsumEquation:()=>rj,eitherStridesOrDilationsAreOne:()=>xR,expandShapeToKeepDim:()=>wL,exponent:()=>ZO,exponents:()=>JO,fromStringArrayToUint8:()=>Ej,fromUint8ToStringArray:()=>Cj,getAxesPermutation:()=>SL,getBroadcastDims:()=>eF,getComplexWithIndex:()=>XO,getEinsumComputePath:()=>sj,getEinsumPermutation:()=>ij,getFusedBiasGradient:()=>sD,getFusedDyActivation:()=>aD,getImageCenter:()=>TO,getInnerMostAxes:()=>EL,getPermuted:()=>MO,getRaggedRank:()=>EO,getReductionAxes:()=>tF,getReshaped:()=>BO,getReshapedPermuted:()=>FO,getRowPartitionTypesHelper:()=>CO,getSliceBeginCoords:()=>RO,getSliceSize:()=>LO,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>uj,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>hj,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>dj,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>fj,getSparseReshapeInputOutputMismatchErrorMessage:()=>mj,getSparseReshapeInputOutputMultipleErrorMessage:()=>gj,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>Aj,getSparseReshapeNegativeOutputDimErrorMessage:()=>pj,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>xj,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>yj,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>vj,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>bj,getUndoAxesPermutation:()=>CL,isIdentityPermutation:()=>oj,log:()=>VI,mergeRealAndImagArrays:()=>GO,prepareAndValidate:()=>PO,prepareSplitSize:()=>cj,segment_util:()=>a,shouldFuse:()=>lD,slice_util:()=>r,splitRealAndImagArrays:()=>WO,stridesOrDilationsArePositive:()=>wR,tupleValuesAreOne:()=>bR,upcastType:()=>HT,validateDefaultValueShape:()=>NO,validateInput:()=>PU,validateUpdateShape:()=>LU,warn:()=>QI});var o={};n.r(o),n.d(o,{json:()=>_K});var l={};n.r(l),n.d(l,{json:()=>SK});var c={};n.r(c),n.d(c,{json:()=>CK});var u={};n.r(u),n.d(u,{json:()=>EK});var h={};n.r(h),n.d(h,{json:()=>NK});var d={};n.r(d),n.d(d,{json:()=>kK});var A={};n.r(A),n.d(A,{json:()=>IK});var p={};n.r(p),n.d(p,{json:()=>TK});var f={};n.r(f),n.d(f,{json:()=>BK});var g={};n.r(g),n.d(g,{json:()=>MK});var m={};n.r(m),n.d(m,{json:()=>FK});var y={};n.r(y),n.d(y,{json:()=>RK});var v={};n.r(v),n.d(v,{json:()=>LK});var b={};n.r(b),n.d(b,{json:()=>PK});var x={};n.r(x),n.d(x,{json:()=>UK});var w={};n.r(w),n.d(w,{json:()=>DK});var _={};n.r(_),n.d(_,{json:()=>OK});var S={};n.r(S),n.d(S,{json:()=>jK});var C={};n.r(C),n.d(C,{json:()=>zK});var E={};n.r(E),n.d(E,{OP_SCOPE_SUFFIX:()=>hB,abs:()=>$M,acos:()=>ZF,acosh:()=>$F,add:()=>MM,addN:()=>eR,all:()=>tR,any:()=>nR,argMax:()=>rR,argMin:()=>iR,asin:()=>aR,asinh:()=>sR,atan:()=>oR,atan2:()=>lR,atanh:()=>cR,avgPool:()=>ER,avgPool3d:()=>NR,basicLSTMCell:()=>FR,batchNorm:()=>LR,batchNorm2d:()=>PR,batchNorm3d:()=>UR,batchNorm4d:()=>DR,batchToSpaceND:()=>RR,bincount:()=>OR,bitwiseAnd:()=>jR,booleanMaskAsync:()=>KU,broadcastArgs:()=>zR,broadcastTo:()=>HR,buffer:()=>kM,cast:()=>IM,ceil:()=>QR,clipByValue:()=>VR,clone:()=>TM,complex:()=>AB,concat:()=>kR,concat1d:()=>GR,concat2d:()=>WR,concat3d:()=>qR,concat4d:()=>KR,conv1d:()=>YR,conv2d:()=>XR,conv2dTranspose:()=>ZR,conv3d:()=>$R,conv3dTranspose:()=>tL,cos:()=>nL,cosh:()=>rL,cosineWindow:()=>nD,cumprod:()=>iL,cumsum:()=>aL,denseBincount:()=>sL,depthToSpace:()=>oL,depthwiseConv2d:()=>lL,diag:()=>cL,dilation2d:()=>uL,div:()=>RM,divNoNan:()=>AL,dot:()=>pL,dropout:()=>eD,einsum:()=>fL,elu:()=>gL,enclosingPowerOfTwo:()=>tD,ensureShape:()=>mL,equal:()=>hL,erf:()=>yL,euclideanNorm:()=>ML,exp:()=>FL,expandDims:()=>RL,expm1:()=>LL,eye:()=>UL,fft:()=>vU,fill:()=>KM,floor:()=>DL,floorDiv:()=>FM,fused:()=>i,gather:()=>OL,gatherND:()=>$U,greater:()=>jL,greaterEqual:()=>zL,ifft:()=>bU,imag:()=>HL,image:()=>AO,inTopKAsync:()=>rD,irfft:()=>xU,isFinite:()=>QL,isInf:()=>VL,isNaN:()=>GL,leakyRelu:()=>WL,less:()=>qL,lessEqual:()=>KL,linalg:()=>pO,linspace:()=>XL,localResponseNormalization:()=>YL,log:()=>JL,log1p:()=>ZL,logSigmoid:()=>tP,logSoftmax:()=>nP,logSumExp:()=>rP,logicalAnd:()=>iP,logicalNot:()=>aP,logicalOr:()=>sP,logicalXor:()=>oP,losses:()=>fO,lowerBound:()=>uP,matMul:()=>IR,max:()=>NL,maxPool:()=>hP,maxPool3d:()=>dP,maxPoolWithArgmax:()=>AP,maximum:()=>rF,mean:()=>pP,meshgrid:()=>mP,min:()=>kL,minimum:()=>yP,mirrorPad:()=>vP,mod:()=>bP,moments:()=>xP,movingAverage:()=>YU,mul:()=>LM,multiRNNCell:()=>wP,multinomial:()=>_P,neg:()=>$L,norm:()=>BL,notEqual:()=>SP,oneHot:()=>CP,ones:()=>gP,onesLike:()=>EP,op:()=>dB,outerProduct:()=>NP,pad:()=>kP,pad1d:()=>IP,pad2d:()=>TP,pad3d:()=>BP,pad4d:()=>MP,pool:()=>RP,pow:()=>YM,prelu:()=>LP,print:()=>BM,prod:()=>PP,raggedGather:()=>UP,raggedRange:()=>DP,raggedTensorToTensor:()=>OP,rand:()=>jP,randomGamma:()=>GP,randomNormal:()=>WP,randomStandardNormal:()=>qP,randomUniform:()=>KP,randomUniformInt:()=>XP,range:()=>YP,real:()=>JP,reciprocal:()=>ZP,relu:()=>$P,relu6:()=>eU,reshape:()=>CR,reverse:()=>tU,reverse1d:()=>nU,reverse2d:()=>rU,reverse3d:()=>iU,reverse4d:()=>aU,rfft:()=>_U,round:()=>sU,rsqrt:()=>oU,scalar:()=>jM,scatterND:()=>JU,searchSorted:()=>cP,selu:()=>lU,separableConv2d:()=>cU,setdiff1dAsync:()=>uU,sigmoid:()=>TR,sign:()=>hU,signal:()=>dO,sin:()=>dU,sinh:()=>AU,slice:()=>BR,slice1d:()=>pU,slice2d:()=>fU,slice3d:()=>gU,slice4d:()=>mU,softmax:()=>yU,softplus:()=>eP,spaceToBatchND:()=>FP,sparse:()=>gO,sparseToDense:()=>ZU,spectral:()=>hO,split:()=>wU,sqrt:()=>PM,square:()=>UM,squaredDifference:()=>SU,squeeze:()=>CU,stack:()=>EU,step:()=>NU,stridedSlice:()=>kU,string:()=>mO,sub:()=>JM,sum:()=>IL,tan:()=>IU,tanh:()=>MR,tensor:()=>fB,tensor1d:()=>TU,tensor2d:()=>BU,tensor3d:()=>IF,tensor4d:()=>MU,tensor5d:()=>FU,tensor6d:()=>RU,tensorScatterUpdate:()=>DU,tile:()=>PL,topk:()=>OU,transpose:()=>XU,truncatedNormal:()=>jU,unique:()=>zU,unsortedSegmentSum:()=>HU,unstack:()=>QU,upperBound:()=>VU,variable:()=>GU,where:()=>dL,whereAsync:()=>qU,zeros:()=>fP,zerosLike:()=>DM});var N={};n.r(N),n.d(N,{mx:()=>HY,XI:()=>RJ,Nk:()=>LJ,f6:()=>UJ,ct:()=>UY,YG:()=>zJ,hH:()=>qJ,z3:()=>BZ,sG:()=>HZ,uM:()=>qZ,vS:()=>u$,qB:()=>y$,GG:()=>b$,lg:()=>C$,rq:()=>w$,cu:()=>D$,WR:()=>L$,GE:()=>z$,px:()=>Q$,jC:()=>i0,He:()=>o0,hE:()=>m0,BF:()=>_Z,Dk:()=>N0,cl:()=>L0,_B:()=>K0,ub:()=>$0,_f:()=>n1,Ku:()=>l1,qy:()=>u1,Zy:()=>w1,bu:()=>C1,zv:()=>kY,dH:()=>JY,HS:()=>TJ,yH:()=>G1,l3:()=>q1,z9:()=>X1,x6:()=>e2,_m:()=>o2,eW:()=>d2,GK:()=>f2,SP:()=>y2,yr:()=>b2,dl:()=>$Z,Dw:()=>E2,xT:()=>T2,_X:()=>iJ,wz:()=>U2});var k=n(5043),I=n(4391),T=n(4980);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach(function(t){(0,T.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function F(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const R=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),L=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},P=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var U={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const D=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],O=(0,k.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:s="",children:o,iconNode:l}=e,c=F(e,D);return(0,k.createElement)("svg",M(M(M({ref:t},U),{},{width:r,height:r,stroke:n,strokeWidth:a?24*Number(i)/Number(r):i,className:P("lucide",s)},!o&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"}),c),[...l.map(e=>{let[t,n]=e;return(0,k.createElement)(t,n)}),...Array.isArray(o)?o:[o]])}),j=["className"],z=(e,t)=>{const n=(0,k.forwardRef)((n,r)=>{let{className:i}=n,a=F(n,j);return(0,k.createElement)(O,M({ref:r,iconNode:t,className:P("lucide-".concat(R(L(e))),"lucide-".concat(e),i)},a))});return n.displayName=L(e),n},H=z("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Q=z("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),V=z("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),G=z("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),W=z("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),q=z("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]),K=z("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),X=z("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),Y=z("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),J=z("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Z=z("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),$=z("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ee=z("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),te=z("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);let ne="https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec";ne&&ne.includes("REACT_APP_GAS_WEB_APP_URL=")&&(ne=ne.split("REACT_APP_GAS_WEB_APP_URL=")[1]),ne&&!ne.startsWith("http")&&(ne="https://"+ne.replace(/^\/+/,""));const re=new class{constructor(e){this.baseURL=e}async makeRequest(e,t){if(!this.baseURL)return{success:!1,message:"API endpoint is not configured."};try{const r=await fetch(this.baseURL,{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(M({action:e},t))});if(!r.ok)throw new Error("Server responded with status: ".concat(r.status));const i=await r.text();try{const e=JSON.parse(i);if(!1===e.success)throw new Error(e.message||"An unknown backend error occurred.");return e}catch(n){throw new Error("Invalid server response. The backend may have crashed.")}}catch(SS){return{success:!1,message:"Network error: ".concat(SS.message)}}}fetchLeads(){return this.makeRequest("getLeads",{})}addLead(e){return this.makeRequest("addLead",{lead:e})}updateLead(e){return this.makeRequest("updateLead",{lead:e})}deleteLead(e){return this.makeRequest("deleteLead",{leadId:e})}fetchJobCounts(){return this.makeRequest("getJobCounts",{})}addJobCount(e){return this.makeRequest("addJobCount",{jobCount:e})}updateJobCount(e){return this.makeRequest("updateJobCount",{jobCount:e})}deleteJobCount(e){return this.makeRequest("deleteJobCount",{jobCountId:e})}testConnection(){return this.makeRequest("testConnection",{})}geocodeAddress(e){return this.makeRequest("geocodeAddress",{address:e})}calculateLomacoVents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.makeRequest("calculateLomacoVents",{sqft:e,options:t})}batchCalculateVents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.makeRequest("batchCalculateVents",{jobCountIds:e})}}(ne);const ie="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";const ae="crm_communications";function se(e){try{const t=JSON.parse(localStorage.getItem(ae)||"[]");return t.push(M(M({},e),{},{id:Date.now().toString()})),localStorage.setItem(ae,JSON.stringify(t)),{success:!0,data:e}}catch(SS){throw console.error("Error saving to local storage:",SS),SS}}function oe(){try{return JSON.parse(localStorage.getItem(ae)||"[]")}catch(SS){return console.error("Error reading from local storage:",SS),[]}}function le(e){const[t,n]=(0,k.useState)([]),[r,i]=(0,k.useState)(!1),[a,s]=(0,k.useState)(null),o=(0,k.useCallback)(()=>{try{const e=oe();return n(e),e}catch(SS){return console.error("Error loading communications from local storage:",SS),[]}},[]);(0,k.useEffect)(()=>{o()},[o]);const l=(0,k.useCallback)(async t=>{i(!0);try{await async function(e){try{return await fetch("".concat(ie,"?action=addCommunication"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"no-cors"}),console.log("Communication logged successfully:",e),{success:!0,data:e}}catch(SS){throw console.error("Error logging communication:",SS),new Error("Failed to log communication")}}(t);const r=se(t);return n(e=>[...e,r.data]),e&&e("Communication logged successfully","success"),r.data}catch(SS){console.error("Error adding communication:",SS);try{const r=se(t);return n(e=>[...e,r.data]),e&&e("Communication saved locally (offline mode)","warning"),r.data}catch(r){throw e&&e("Failed to save communication","error"),r}}finally{i(!1)}},[e]),c=(0,k.useCallback)(async e=>{i(!0);try{const t=await async function(e){try{return await fetch("".concat(ie,"?action=getCommunications&leadId=").concat(e),{method:"GET",mode:"no-cors"}),console.log("Fetching communications for lead:",e),[]}catch(SS){return console.error("Error fetching communications:",SS),[]}}(e);if(!t||0===t.length){const t=oe();return t.filter(t=>t.leadId===e)}return t}catch(SS){console.error("Error fetching communications for lead:",SS);return oe().filter(t=>t.leadId===e)}finally{i(!1)}},[]),u=(0,k.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;i(!0);try{const t=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;try{return await fetch("".concat(ie,"?action=getRecentCommunications&days=").concat(e),{method:"GET",mode:"no-cors"}),console.log("Fetching communications from last ".concat(e," days")),[]}catch(SS){return console.error("Error fetching recent communications:",SS),[]}}(e);if(!t||0===t.length){const t=oe(),r=new Date;r.setDate(r.getDate()-e);const i=t.filter(e=>new Date(e.dateTime)>=r);return n(i),i}return n(t),t}catch(SS){console.error("Error fetching recent communications:",SS);const r=oe(),i=new Date;i.setDate(i.getDate()-e);const a=r.filter(e=>new Date(e.dateTime)>=i);return n(a),a}finally{i(!1)}},[]),h=(0,k.useCallback)(async()=>{i(!0);try{const e=await async function(){try{return await fetch("".concat(ie,"?action=getCommunicationStats"),{method:"GET",mode:"no-cors"}),console.log("Fetching communication statistics"),{totalCalls:0,totalSMS:0,totalEmails:0,appointmentsConfirmed:0,noAnswers:0,voicemailsLeft:0}}catch(SS){return console.error("Error fetching communication stats:",SS),null}}();if(!e){const e=oe(),t={totalCalls:e.filter(e=>"Call"===e.communicationType).length,totalSMS:e.filter(e=>"SMS"===e.communicationType).length,totalEmails:e.filter(e=>"Email"===e.communicationType).length,appointmentsConfirmed:e.filter(e=>{var t;return"Completed"===e.status&&(null===(t=e.notes)||void 0===t?void 0:t.includes("confirmed"))}).length,noAnswers:e.filter(e=>"No Answer"===e.status).length,voicemailsLeft:e.filter(e=>"Left Voicemail"===e.status).length};return s(t),t}return s(e),e}catch(SS){return console.error("Error fetching communication stats:",SS),null}finally{i(!1)}},[]),d=(0,k.useCallback)(async t=>{i(!0);try{await async function(e){try{return await fetch("".concat(ie,"?action=deleteCommunication&id=").concat(e),{method:"DELETE",mode:"no-cors"}),console.log("Communication deleted:",e),{success:!0}}catch(SS){throw console.error("Error deleting communication:",SS),new Error("Failed to delete communication")}}(t),n(e=>e.filter(e=>e.id!==t)),e&&e("Communication deleted","success")}catch(SS){throw console.error("Error deleting communication:",SS),e&&e("Failed to delete communication","error"),SS}finally{i(!1)}},[e]);return{communications:t,loading:r,stats:a,addCommunication:l,getForLead:c,getRecent:u,getStats:h,removeCommunication:d,loadFromLocal:o}}const ce=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},ue={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],a=i+1<e.length,s=a?e[i+1]:0,o=i+2<e.length,l=o?e[i+2]:0,c=t>>2,u=(3&t)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;o||(d=64,a||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(ce(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){const a=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{const a=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;const s=i<e.length?n[e.charAt(i)]:64;++i;const o=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==a||null==s||null==o)throw new he;const l=t<<2|a>>4;if(r.push(l),64!==s){const e=a<<4&240|s>>2;if(r.push(e),64!==o){const e=s<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class he extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const de=function(e){return function(e){const t=ce(e);return ue.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Ae=function(e){try{return ue.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const pe=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,fe=()=>{try{return pe()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AUTH_CODE:"IAMBRANDON",REACT_APP_FIREBASE_API_KEY:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",REACT_APP_FIREBASE_APP_ID:"1:874590395925:web:41fff249ed9a7b349af81c",REACT_APP_FIREBASE_AUTH_DOMAIN:"crmbackend-470221.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-4BG7SZMK6K",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"874590395925",REACT_APP_FIREBASE_PROJECT_ID:"crmbackend-470221",REACT_APP_FIREBASE_STORAGE_BUCKET:"crmbackend-470221.firebasestorage.app",REACT_APP_GAS_WEB_APP_URL:"https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4",REACT_APP_SHEET_NAME:"Bhotchleads",REACT_APP_SPREADSHEET_ID:"1E9VX7XI7GNGJa8Hq9__XAWv95WNgfJto1gUEXMbGqi0",REACT_APP_TWILIO_ACCOUNT_SID:"AC20e24f43ac063d43511d06c688b5ec06",REACT_APP_TWILIO_AUTH_TOKEN:"65cc837132a39a100d4b03a8a234f2ed",REACT_APP_TWILIO_PHONE_NUMBER:"+13852357204"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&Ae(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},ge=e=>{var t,n;return null===(n=null===(t=fe())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},me=()=>{var e;return null===(e=fe())||void 0===e?void 0:e.config},ye=e=>{var t;return null===(t=fe())||void 0===t?void 0:t["_".concat(e)]};class ve{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function be(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}class xe extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,xe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,we.prototype.create)}}class we{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(_e,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new xe(n,a,t)}}const _e=/\{\$([^}]+)}/g;function Se(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],a=t[i];if(Ce(n)&&Ce(a)){if(!Se(n,a))return!1}else if(n!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Ce(e){return null!==e&&"object"===typeof e}function Ee(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Ne(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function ke(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Ie{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Te),void 0===r.error&&(r.error=Te),void 0===r.complete&&(r.complete=Te);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Te(){}function Be(e){return e&&e._delegate?e._delegate:e}class Me{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Fe="[DEFAULT]";class Re{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new ve;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Fe})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,a]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&a.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(dS){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===Fe?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(dS){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe;return this.component?this.component.multipleInstances?e:Fe:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Le{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Re(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Pe=[];var Ue;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Ue||(Ue={}));const De={debug:Ue.DEBUG,verbose:Ue.VERBOSE,info:Ue.INFO,warn:Ue.WARN,error:Ue.ERROR,silent:Ue.SILENT},Oe=Ue.INFO,je={[Ue.DEBUG]:"log",[Ue.VERBOSE]:"log",[Ue.INFO]:"info",[Ue.WARN]:"warn",[Ue.ERROR]:"error"},ze=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=je[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];console[r]("[".concat(n,"]  ").concat(e.name,":"),...a)};class He{constructor(e){this.name=e,this._logLevel=Oe,this._logHandler=ze,this._userLogHandler=null,Pe.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ue))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?De[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.DEBUG,...t),this._logHandler(this,Ue.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.VERBOSE,...t),this._logHandler(this,Ue.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.INFO,...t),this._logHandler(this,Ue.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.WARN,...t),this._logHandler(this,Ue.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Ue.ERROR,...t),this._logHandler(this,Ue.ERROR,...t)}}let Qe,Ve;const Ge=new WeakMap,We=new WeakMap,qe=new WeakMap,Ke=new WeakMap,Xe=new WeakMap;let Ye={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return We.get(e);if("objectStoreNames"===t)return e.objectStoreNames||qe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $e(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Je(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ve||(Ve=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(et(this),n),$e(Ge.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return $e(e.apply(et(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const a=e.call(et(this),t,...r);return qe.set(a,t.sort?t.sort():[t]),$e(a)}}function Ze(e){return"function"===typeof e?Je(e):(e instanceof IDBTransaction&&function(e){if(We.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});We.set(e,t)}(e),t=e,(Qe||(Qe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Ye):e);var t}function $e(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t($e(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&Ge.set(t,e)}).catch(()=>{}),Xe.set(t,e),t}(e);if(Ke.has(e))return Ke.get(e);const t=Ze(e);return t!==e&&(Ke.set(e,t),Xe.set(t,e)),t}const et=e=>Xe.get(e);const tt=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],rt=new Map;function it(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(rt.get(t))return rt.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=nt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!tt.includes(n))return;const a=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let a=t.store;for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];return r&&(a=a.index(o.shift())),(await Promise.all([a[n](...o),i&&t.done]))[0]};return rt.set(t,a),a}Ye=(e=>M(M({},e),{},{get:(t,n,r)=>it(t,n)||e.get(t,n,r),has:(t,n)=>!!it(t,n)||e.has(t,n)}))(Ye);class at{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const st="@firebase/app",ot="0.10.13",lt=new He("@firebase/app"),ct="@firebase/app-compat",ut="@firebase/analytics-compat",ht="@firebase/analytics",dt="@firebase/app-check-compat",At="@firebase/app-check",pt="@firebase/auth",ft="@firebase/auth-compat",gt="@firebase/database",mt="@firebase/data-connect",yt="@firebase/database-compat",vt="@firebase/functions",bt="@firebase/functions-compat",xt="@firebase/installations",wt="@firebase/installations-compat",_t="@firebase/messaging",St="@firebase/messaging-compat",Ct="@firebase/performance",Et="@firebase/performance-compat",Nt="@firebase/remote-config",kt="@firebase/remote-config-compat",It="@firebase/storage",Tt="@firebase/storage-compat",Bt="@firebase/firestore",Mt="@firebase/vertexai-preview",Ft="@firebase/firestore-compat",Rt="firebase",Lt="[DEFAULT]",Pt={[st]:"fire-core",[ct]:"fire-core-compat",[ht]:"fire-analytics",[ut]:"fire-analytics-compat",[At]:"fire-app-check",[dt]:"fire-app-check-compat",[pt]:"fire-auth",[ft]:"fire-auth-compat",[gt]:"fire-rtdb",[mt]:"fire-data-connect",[yt]:"fire-rtdb-compat",[vt]:"fire-fn",[bt]:"fire-fn-compat",[xt]:"fire-iid",[wt]:"fire-iid-compat",[_t]:"fire-fcm",[St]:"fire-fcm-compat",[Ct]:"fire-perf",[Et]:"fire-perf-compat",[Nt]:"fire-rc",[kt]:"fire-rc-compat",[It]:"fire-gcs",[Tt]:"fire-gcs-compat",[Bt]:"fire-fst",[Ft]:"fire-fst-compat",[Mt]:"fire-vertex","fire-js":"fire-js",[Rt]:"fire-js-all"},Ut=new Map,Dt=new Map,Ot=new Map;function jt(e,t){try{e.container.addComponent(t)}catch(n){lt.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function zt(e){const t=e.name;if(Ot.has(t))return lt.debug("There were multiple attempts to register component ".concat(t,".")),!1;Ot.set(t,e);for(const n of Ut.values())jt(n,e);for(const n of Dt.values())jt(n,e);return!0}function Ht(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Qt(e){return void 0!==e.settings}const Vt=new we("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Gt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Me("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Vt.create("app-deleted",{appName:this._name})}}const Wt="10.14.1";function qt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:Lt,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw Vt.create("bad-app-name",{appName:String(i)});if(n||(n=me()),!n)throw Vt.create("no-options");const a=Ut.get(i);if(a){if(Se(n,a.options)&&Se(r,a.config))return a;throw Vt.create("duplicate-app",{appName:i})}const s=new Le(i);for(const l of Ot.values())s.addComponent(l);const o=new Gt(n,r,s);return Ut.set(i,o),o}function Kt(e,t,n){var r;let i=null!==(r=Pt[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const a=i.match(/\s|\//),s=t.match(/\s|\//);if(a||s){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&s&&e.push("and"),s&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void lt.warn(e.join(" "))}zt(new Me("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const Xt="firebase-heartbeat-store";let Yt=null;function Jt(){return Yt||(Yt=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),o=$e(s);return r&&s.addEventListener("upgradeneeded",e=>{r($e(s.result),e.oldVersion,e.newVersion,$e(s.transaction),e)}),n&&s.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{a&&e.addEventListener("close",()=>a()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Xt)}catch(n){console.warn(n)}}}).catch(e=>{throw Vt.create("idb-open",{originalErrorMessage:e.message})})),Yt}async function Zt(e,t){try{const n=(await Jt()).transaction(Xt,"readwrite"),r=n.objectStore(Xt);await r.put(t,$t(e)),await n.done}catch(n){if(n instanceof xe)lt.warn(n.message);else{const e=Vt.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});lt.warn(e.message)}}}function $t(e){return"".concat(e.name,"!").concat(e.options.appId)}class en{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nn(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=tn();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(n){lt.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=tn(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),rn(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),rn(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=de(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return lt.warn(t),""}}}function tn(){return(new Date).toISOString().substring(0,10)}class nn{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"===typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(SS){t(SS)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Jt()).transaction(Xt),n=await t.objectStore(Xt).get($t(e));return await t.done,n}catch(t){if(t instanceof xe)lt.warn(t.message);else{const e=Vt.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});lt.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Zt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Zt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function rn(e){return de(JSON.stringify({version:2,heartbeats:e})).length}var an;an="",zt(new Me("platform-logger",e=>new at(e),"PRIVATE")),zt(new Me("heartbeat",e=>new en(e),"PRIVATE")),Kt(st,ot,an),Kt(st,ot,"esm2017"),Kt("fire-js","");function sn(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function on(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ln=on,cn=new we("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),un=new He("@firebase/auth");function hn(e){if(un.logLevel<=Ue.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];un.error("Auth (".concat(Wt,"): ").concat(e),...n)}}function dn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw gn(e,...n)}function An(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return gn(e,...n)}function pn(e,t,n){const r=Object.assign(Object.assign({},ln()),{[t]:n});return new we("auth","Firebase",r).create(t,{appName:e.name})}function fn(e){return pn(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return cn.create(e,...n)}function mn(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw gn(t,...r)}}function yn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw hn(t),new Error(t)}function vn(e,t){e||yn(t)}function bn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function xn(){return"http:"===wn()||"https:"===wn()}function wn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function _n(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(xn()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Sn{constructor(e,t){this.shortDelay=e,this.longDelay=t,vn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(be())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return _n()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Cn(e,t){vn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class En{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void yn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void yn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void yn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Nn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},kn=new Sn(3e4,6e4);function In(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Tn(e,t,n,r){return Bn(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},a={};r&&("GET"===t?a=r:i={body:JSON.stringify(r)});const s=Ee(Object.assign({key:e.config.apiKey},a)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),En.fetch()(Fn(e,e.config.apiHost,n,s),l)})}async function Bn(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Nn),t);try{const t=new Ln(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Pn(e,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const t=i.ok?a.errorMessage:a.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Pn(e,"credential-already-in-use",a);if("EMAIL_EXISTS"===n)throw Pn(e,"email-already-in-use",a);if("USER_DISABLED"===n)throw Pn(e,"user-disabled",a);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw pn(e,o,s);dn(e,o)}}catch(i){if(i instanceof xe)throw i;dn(e,"network-request-failed",{message:String(i)})}}async function Mn(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=await Tn(e,t,n,r,i);return"mfaPendingCredential"in a&&dn(e,"multi-factor-auth-required",{_serverResponse:a}),a}function Fn(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?Cn(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function Rn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ln{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(An(this.auth,"network-request-failed")),kn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Pn(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=An(e,t,r);return i.customData._tokenResponse=n,i}function Un(e){return void 0!==e&&void 0!==e.enterprise}class Dn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Rn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function On(e,t){return Tn(e,"GET","/v2/recaptchaConfig",In(e,t))}async function jn(e,t){return Tn(e,"POST","/v1/accounts:lookup",t)}function zn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Hn(e){return 1e3*Number(e)}function Qn(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return hn("JWT malformed, contained fewer than 3 sections"),null;try{const e=Ae(n);return e?JSON.parse(e):(hn("Failed to decode base64 JWT payload"),null)}catch(i){return hn("Caught error parsing JWT payload as JSON",null===i||void 0===i?void 0:i.toString()),null}}function Vn(e){const t=Qn(e);return mn(t,"internal-error"),mn("undefined"!==typeof t.exp,"internal-error"),mn("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Gn(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof xe&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Wn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class qn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=zn(this.lastLoginAt),this.creationTime=zn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Kn(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Gn(e,jn(n,{idToken:r}));mn(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const s=(null===(t=a.providerUserInfo)||void 0===t?void 0:t.length)?Xn(a.providerUserInfo):[],o=function(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,s),l=e.isAnonymous,c=!(e.email&&a.passwordHash)&&!(null===o||void 0===o?void 0:o.length),u=!!l&&c,h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new qn(a.createdAt,a.lastLoginAt),isAnonymous:u};Object.assign(e,h)}function Xn(e){return e.map(e=>{var{providerId:t}=e,n=sn(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Yn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mn(e.idToken,"internal-error"),mn("undefined"!==typeof e.idToken,"internal-error"),mn("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Vn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mn(0!==e.length,"internal-error");const t=Vn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(mn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Bn(e,{},async()=>{const n=Ee({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,a=Fn(e,r,"/v1/token","key=".concat(i)),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",En.fetch()(a,{method:"POST",headers:s,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,a=new Yn;return n&&(mn("string"===typeof n,"internal-error",{appName:e}),a.refreshToken=n),r&&(mn("string"===typeof r,"internal-error",{appName:e}),a.accessToken=r),i&&(mn("number"===typeof i,"internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Yn,this.toJSON())}_performRefresh(){return yn("not implemented")}}function Jn(e,t){mn("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Zn{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=sn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new qn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Gn(this,this.stsTokenManager.getToken(this.auth,e));return mn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Be(e),r=await n.getIdToken(t),i=Qn(r);mn(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const a="object"===typeof i.firebase?i.firebase:void 0,s=null===a||void 0===a?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:zn(Hn(i.auth_time)),issuedAtTime:zn(Hn(i.iat)),expirationTime:zn(Hn(i.exp)),signInProvider:s||null,signInSecondFactor:(null===a||void 0===a?void 0:a.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Be(e);await Kn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(mn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Zn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){mn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Kn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qt(this.auth.app))return Promise.reject(fn(this.auth));const e=await this.getIdToken();return await Gn(this,async function(e,t){return Tn(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,a,s,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,A=null!==(a=t.photoURL)&&void 0!==a?a:void 0,p=null!==(s=t.tenantId)&&void 0!==s?s:void 0,f=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,m=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:v,isAnonymous:b,providerData:x,stsTokenManager:w}=t;mn(y&&w,e,"internal-error");const _=Yn.fromJSON(this.name,w);mn("string"===typeof y,e,"internal-error"),Jn(u,e.name),Jn(h,e.name),mn("boolean"===typeof v,e,"internal-error"),mn("boolean"===typeof b,e,"internal-error"),Jn(d,e.name),Jn(A,e.name),Jn(p,e.name),Jn(f,e.name),Jn(g,e.name),Jn(m,e.name);const S=new Zn({uid:y,auth:e,email:h,emailVerified:v,displayName:u,isAnonymous:b,photoURL:A,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:g,lastLoginAt:m});return x&&Array.isArray(x)&&(S.providerData=x.map(e=>Object.assign({},e))),f&&(S._redirectEventId=f),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Yn;r.updateFromServerResponse(t);const i=new Zn({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Kn(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];mn(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Xn(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),s=new Yn;s.updateFromIdToken(n);const o=new Zn({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:a}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new qn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(o,l),o}}const $n=new Map;function er(e){vn(e instanceof Function,"Expected a class definition");let t=$n.get(e);return t?(vn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,$n.set(e,t),t)}class tr{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}tr.type="NONE";const nr=tr;function rr(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class ir{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=rr(this.userKey,r.apiKey,i),this.fullPersistenceKey=rr("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Zn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new ir(er(nr),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||er(nr);const a=rr(n,e.config.apiKey,e.name);let s=null;for(const l of t)try{const t=await l._get(a);if(t){const n=Zn._fromJSON(e,t);l!==i&&(s=n),i=l;break}}catch(dS){}const o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length?(i=o[0],s&&await i._set(a,s.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(a)}catch(dS){}})),new ir(i,e,n)):new ir(i,e,n)}}function ar(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(cr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(sr(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(hr(t))return"Blackberry";if(dr(t))return"Webos";if(or(t))return"Safari";if((t.includes("chrome/")||lr(t))&&!t.includes("edge/"))return"Chrome";if(ur(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function sr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/firefox\//i.test(e)}function or(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:be()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function lr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/crios\//i.test(e)}function cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/iemobile/i.test(e)}function ur(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/android/i.test(e)}function hr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/blackberry/i.test(e)}function dr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/webos/i.test(e)}function Ar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function pr(){return function(){const e=be();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function fr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be();return Ar(e)||ur(e)||dr(e)||hr(e)||/windows phone/i.test(e)||cr(e)}function gr(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=ar(be());break;case"Worker":t="".concat(ar(be()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(Wt,"/").concat(r)}class mr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(rle){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class yr{constructor(e){var t,n,r,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=a.minPasswordLength)&&void 0!==t?t:6,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),void 0!==a.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),void 0!==a.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),void 0!==a.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),void 0!==a.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,a,s;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(a=o.containsNumericCharacter)||void 0===a||a),o.isValid&&(o.isValid=null===(s=o.containsNonAlphanumericCharacter)||void 0===s||s),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class vr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xr(this),this.idTokenSubscription=new xr(this),this.beforeStateQueue=new mr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=cn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=er(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ir.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await jn(this,{idToken:e}),n=await Zn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Qt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,a=null===r||void 0===r?void 0:r._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==a||!(null===s||void 0===s?void 0:s.user)||(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return mn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Kn(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qt(this.app))return Promise.reject(fn(this));const t=e?Be(e):null;return t&&mn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&mn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qt(this.app)?Promise.reject(fn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qt(this.app)?Promise.reject(fn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(er(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Tn(e,"GET","/v2/passwordPolicy",In(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new yr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new we("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Tn(e,"POST","/v2/accounts:revokeToken",In(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&er(e)||this._popupRedirectResolver;mn(t,this,"argument-error"),this.redirectPersistenceManager=await ir.create(this,[er(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let a=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(mn(s,this,"internal-error"),s.then(()=>{a||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{a=!0,i()}}{const n=e.addObserver(t);return()=>{a=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(un.logLevel<=Ue.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];un.warn("Auth (".concat(Wt,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function br(e){return Be(e)}class xr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Ie(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return mn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let wr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _r(e){return wr.loadJS(e)}function Sr(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Cr{constructor(e){this.type="recaptcha-enterprise",this.auth=br(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;Un(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{On(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Dn(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Un(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=wr.recaptchaEnterpriseScript;0!==t.length&&(t+=i),_r(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Er(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new Cr(e);let a;try{a=await i.verify(n)}catch(SS){a=await i.verify(n,!0)}const s=Object.assign({},t);return r?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Nr(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Er(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Er(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}function kr(e,t,n){const r=br(e);mn(r._canInitEmulator,r,"emulator-config-failed"),mn(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),a=Ir(t),{host:s,port:o}=function(e){const t=Ir(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Tr(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Tr(t)}}}(t),l=null===o?"":":".concat(o);r.config.emulator={url:"".concat(a,"//").concat(s).concat(l,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:o,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ir(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Tr(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Br{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yn("not implemented")}_getIdTokenResponse(e){return yn("not implemented")}_linkToIdToken(e,t){return yn("not implemented")}_getReauthenticationResolver(e){return yn("not implemented")}}async function Mr(e,t){return Tn(e,"POST","/v1/accounts:signUp",t)}async function Fr(e,t){return Mn(e,"POST","/v1/accounts:signInWithPassword",In(e,t))}class Rr extends Br{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Rr(e,t,"password")}static _fromEmailAndCode(e,t){return new Rr(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Nr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Fr);case"emailLink":return async function(e,t){return Mn(e,"POST","/v1/accounts:signInWithEmailLink",In(e,t))}(e,{email:this._email,oobCode:this._password});default:dn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Nr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Mr);case"emailLink":return async function(e,t){return Mn(e,"POST","/v1/accounts:signInWithEmailLink",In(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:dn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Lr(e,t){return Mn(e,"POST","/v1/accounts:signInWithIdp",In(e,t))}class Pr extends Br{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Pr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):dn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=sn(t,["providerId","signInMethod"]);if(!n||!r)return null;const a=new Pr(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return Lr(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Lr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Lr(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ee(t)}return e}}const Ur={USER_NOT_FOUND:"user-not-found"};class Dr extends Br{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Dr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Dr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Mn(e,"POST","/v1/accounts:signInWithPhoneNumber",In(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Mn(e,"POST","/v1/accounts:signInWithPhoneNumber",In(e,t));if(n.temporaryProof)throw Pn(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Mn(e,"POST","/v1/accounts:signInWithPhoneNumber",In(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ur)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Dr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Or{constructor(e){var t,n,r,i,a,s;const o=Ne(ke(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);mn(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(a=o.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(s=o.tenantId)&&void 0!==s?s:null}static parseLink(e){const t=function(e){const t=Ne(ke(e)).link,n=t?Ne(ke(t)).deep_link_id:null,r=Ne(ke(e)).deep_link_id;return(r?Ne(ke(r)).link:null)||r||n||t||e}(e);try{return new Or(t)}catch(dS){return null}}}class jr{constructor(){this.providerId=jr.PROVIDER_ID}static credential(e,t){return Rr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Or.parseLink(t);return mn(n,"argument-error"),Rr._fromEmailAndCode(e,n.code,n.tenantId)}}jr.PROVIDER_ID="password",jr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",jr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class zr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Hr extends zr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Qr extends Hr{constructor(){super("facebook.com")}static credential(e){return Pr._fromParams({providerId:Qr.PROVIDER_ID,signInMethod:Qr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qr.credentialFromTaggedObject(e)}static credentialFromError(e){return Qr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Qr.credential(t.oauthAccessToken)}catch(dS){return null}}}Qr.FACEBOOK_SIGN_IN_METHOD="facebook.com",Qr.PROVIDER_ID="facebook.com";class Vr extends Hr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Pr._fromParams({providerId:Vr.PROVIDER_ID,signInMethod:Vr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vr.credentialFromTaggedObject(e)}static credentialFromError(e){return Vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return Vr.credential(n,r)}catch(dS){return null}}}Vr.GOOGLE_SIGN_IN_METHOD="google.com",Vr.PROVIDER_ID="google.com";class Gr extends Hr{constructor(){super("github.com")}static credential(e){return Pr._fromParams({providerId:Gr.PROVIDER_ID,signInMethod:Gr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gr.credentialFromTaggedObject(e)}static credentialFromError(e){return Gr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Gr.credential(t.oauthAccessToken)}catch(dS){return null}}}Gr.GITHUB_SIGN_IN_METHOD="github.com",Gr.PROVIDER_ID="github.com";class Wr extends Hr{constructor(){super("twitter.com")}static credential(e,t){return Pr._fromParams({providerId:Wr.PROVIDER_ID,signInMethod:Wr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Wr.credentialFromTaggedObject(e)}static credentialFromError(e){return Wr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return Wr.credential(n,r)}catch(dS){return null}}}Wr.TWITTER_SIGN_IN_METHOD="twitter.com",Wr.PROVIDER_ID="twitter.com";class qr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Zn._fromIdTokenResponse(e,n,r),a=Kr(n);return new qr({user:i,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Kr(n);return new qr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Kr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Xr extends xe{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Xr.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Xr(e,t,n,r)}}function Yr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw Xr._fromErrorAndOperation(e,n,t,r);throw n})}async function Jr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Gn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return qr._forOperation(e,"link",r)}async function Zr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(Qt(r.app))return Promise.reject(fn(r));const i="reauthenticate";try{const a=await Gn(e,Yr(r,i,t,e),n);mn(a.idToken,r,"internal-error");const s=Qn(a.idToken);mn(s,r,"internal-error");const{sub:o}=s;return mn(e.uid===o,r,"user-mismatch"),qr._forOperation(e,i,a)}catch(a){throw(null===a||void 0===a?void 0:a.code)==="auth/".concat("user-not-found")&&dn(r,"user-mismatch"),a}}async function $r(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Qt(e.app))return Promise.reject(fn(e));const r="signIn",i=await Yr(e,r,t),a=await qr._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}async function ei(e,t){return $r(br(e),t)}async function ti(e){const t=br(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const ni="__sak";class ri{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ni,"1"),this.storage.removeItem(ni),Promise.resolve(!0)):Promise.resolve(!1)}catch(dS){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ii extends ri{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);pr()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ii.type="LOCAL";const ai=ii;class si extends ri{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}si.type="SESSION";const oi=si;class li{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new li(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!(null===a||void 0===a?void 0:a.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(a).map(async e=>e(t.origin,i)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function ci(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}li.receivers=[];class ui{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise((s,o)=>{const l=ci("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);a={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),s(t.data.response);break;default:clearTimeout(c),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function hi(){return window}function di(){return"undefined"!==typeof hi().WorkerGlobalScope&&"function"===typeof hi().importScripts}const Ai="firebaseLocalStorageDb",pi="firebaseLocalStorage",fi="fbase_key";class gi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function mi(e,t){return e.transaction([pi],t?"readwrite":"readonly").objectStore(pi)}function yi(){const e=indexedDB.open(Ai,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(pi,{keyPath:fi})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(pi)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Ai);return new gi(e).toPromise()}(),t(await yi()))})})}async function vi(e,t,n){const r=mi(e,!0).put({[fi]:t,value:n});return new gi(r).toPromise()}function bi(e,t){const n=mi(e,!0).delete(t);return new gi(n).toPromise()}class xi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await yi()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return di()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=li._getInstance(di()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ui(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(dS){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yi();return await vi(e,ni,"1"),await bi(e,ni),!0}catch(dS){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>vi(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=mi(e,!1).get(t),r=await new gi(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>bi(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=mi(e,!1).getAll();return new gi(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}xi.type="LOCAL";const wi=xi;Sr("rcb"),new Sn(3e4,6e4);const _i="recaptcha";async function Si(e,t,n){var r;const i=await n.verify();try{let a;if(mn("string"===typeof i,e,"argument-error"),mn(n.type===_i,e,"argument-error"),a="string"===typeof t?{phoneNumber:t}:t,"session"in a){const t=a.session;if("phoneNumber"in a){mn("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Tn(e,"POST","/v2/accounts/mfaEnrollment:start",In(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{mn("signin"===t.type,e,"internal-error");const n=(null===(r=a.multiFactorHint)||void 0===r?void 0:r.uid)||a.multiFactorUid;mn(n,e,"missing-multi-factor-info");const s=await function(e,t){return Tn(e,"POST","/v2/accounts/mfaSignIn:start",In(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return s.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Tn(e,"POST","/v1/accounts:sendVerificationCode",In(e,t))}(e,{phoneNumber:a.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Ci{constructor(e){this.providerId=Ci.PROVIDER_ID,this.auth=br(e)}verifyPhoneNumber(e,t){return Si(this.auth,e,Be(t))}static credential(e,t){return Dr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ci.credentialFromTaggedObject(t)}static credentialFromError(e){return Ci.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?Dr._fromTokenResponse(n,r):null}}function Ei(e,t){return t?er(t):(mn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ci.PROVIDER_ID="phone",Ci.PHONE_SIGN_IN_METHOD="phone";class Ni extends Br{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Lr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Lr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ki(e){return $r(e.auth,new Ni(e),e.bypassAuthState)}function Ii(e){const{auth:t,user:n}=e;return mn(n,t,"internal-error"),Zr(n,new Ni(e),e.bypassAuthState)}async function Ti(e){const{auth:t,user:n}=e;return mn(n,t,"internal-error"),Jr(n,new Ni(e),e.bypassAuthState)}class Bi{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:a,type:s}=e;if(a)return void this.reject(a);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(o))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ki;case"linkViaPopup":case"linkViaRedirect":return Ti;case"reauthViaPopup":case"reauthViaRedirect":return Ii;default:dn(this.auth,"internal-error")}}resolve(e){vn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Mi=new Sn(2e3,1e4);class Fi extends Bi{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Fi.currentPopupAction&&Fi.currentPopupAction.cancel(),Fi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mn(e,this.auth,"internal-error"),e}async onExecution(){vn(1===this.filter.length,"Popup operations only handle one event");const e=ci();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(An(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(An(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Fi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(An(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Mi.get())};e()}}Fi.currentPopupAction=null;const Ri=new Map;class Li extends Bi{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=Ri.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Di(t),r=Ui(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ri.set(this.auth._key(),e)}return this.bypassAuthState||Ri.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Pi(e,t){Ri.set(e._key(),t)}function Ui(e){return er(e._redirectPersistence)}function Di(e){return rr("pendingRedirect",e.config.apiKey,e.name)}async function Oi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Qt(e.app))return Promise.reject(fn(e));const r=br(e),i=Ei(r,t),a=new Li(r,i,n),s=await a.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}class ji{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hi(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Hi(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(An(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(zi(e))}saveEventToCache(e){this.cachedEventUids.add(zi(e)),this.lastProcessedEventTime=Date.now()}}function zi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Hi(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const Qi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vi=/^https?/;async function Gi(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Tn(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(Wi(n))return}catch(dS){}dn(e,"unauthorized-domain")}function Wi(e){const t=bn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Vi.test(n))return!1;if(Qi.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const qi=new Sn(3e4,6e4);function Ki(){const e=hi().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Xi(e){return new Promise((t,n)=>{var r,i,a;function s(){Ki(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Ki(),n(An(e,"network-request-failed"))},timeout:qi.get()})}if(null===(i=null===(r=hi().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=hi().gapi)||void 0===a?void 0:a.load)){const t=Sr("iframefcb");return hi()[t]=()=>{gapi.load?s():n(An(e,"network-request-failed"))},_r("".concat(wr.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}s()}}).catch(e=>{throw Yi=null,e})}let Yi=null;const Ji=new Sn(5e3,15e3),Zi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$i=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ea(e){const t=e.config;mn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Cn(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:Wt},i=$i.get(e.config.apiHost);i&&(r.eid=i);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat(Ee(r).slice(1))}async function ta(e){const t=await function(e){return Yi=Yi||Xi(e),Yi}(e),n=hi().gapi;return mn(n,e,"internal-error"),t.open({where:document.body,url:ea(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Zi,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=An(e,"network-request-failed"),a=hi().setTimeout(()=>{r(i)},Ji.get());function s(){hi().clearTimeout(a),n(t)}t.ping(s).then(s,()=>{r(i)})}))}const na={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ra{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ia(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const a=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},na),{width:r.toString(),height:i.toString(),top:a,left:s}),c=be().toLowerCase();n&&(o=lr(c)?"_blank":n),sr(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return Ar(arguments.length>0&&void 0!==arguments[0]?arguments[0]:be())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new ra(null);const h=window.open(t||"",o,u);mn(h,e,"popup-blocked");try{h.focus()}catch(d){}return new ra(h)}const aa="__/auth/handler",sa="emulator/auth/handler",oa=encodeURIComponent("fac");async function la(e,t,n,r,i,a){mn(e.config.authDomain,e,"auth-domain-config-required"),mn(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Wt,eventId:i};if(t instanceof zr){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))s[e]=t}if(t instanceof Hr){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const o=s;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const l=await e._getAppCheckToken(),c=l?"#".concat(oa,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(aa);return Cn(t,sa)}(e),"?").concat(Ee(o).slice(1)).concat(c)}const ca="webStorageSupport";const ua=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=oi,this._completeRedirectFn=Oi,this._overrideRedirectResult=Pi}async _openPopup(e,t,n,r){var i;vn(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return ia(e,await la(e,t,n,bn(),r),ci())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){hi().location.href=e}(await la(e,t,n,bn(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(vn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ta(e),n=new ji(e);return t.register("authEvent",t=>{mn(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ca,{type:ca},n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[ca];void 0!==i&&t(!!i),dn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Gi(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return fr()||or()||Ar()}};var ha="@firebase/auth",da="1.7.9";class Aa{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const pa=ye("authIdTokenMaxAge")||300;let fa=null;var ga;!function(e){wr=e}({loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=An("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),ga="Browser",zt(new Me("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=r.options;mn(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:s,authDomain:o,clientPlatform:ga,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gr(ga)},c=new vr(r,i,a,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(er);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),zt(new Me("auth-internal",e=>(e=>new Aa(e))(br(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Kt(ha,da,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(ga)),Kt(ha,da,"esm2017");Kt("firebase","10.14.1","app");const ma={apiKey:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",authDomain:"crmbackend-470221.firebaseapp.com",projectId:"crmbackend-470221",storageBucket:"crmbackend-470221.firebasestorage.app",messagingSenderId:"874590395925",appId:"1:874590395925:web:41fff249ed9a7b349af81c"};if(!ma.apiKey)throw new Error("Firebase config is missing: `REACT_APP_FIREBASE_API_KEY` is not set.");const ya=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Lt;const t=Ut.get(e);if(!t&&e===Lt&&me())return qt();if(!t)throw Vt.create("no-app",{appName:e});return t}();const t=Ht(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Ht(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Se(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;dn(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ua,persistence:[wi,ai,oi]}),r=ye("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>pa)return;const r=null===t||void 0===t?void 0:t.token;fa!==r&&(fa=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){Be(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){Be(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var i;const a=ge("auth");return a&&kr(n,"http://".concat(a)),n}(qt(ma));var va=n(579);const ba=function(e){let{onLogin:t}=e;const[n,r]=(0,k.useState)({email:"",password:""}),[i,a]=(0,k.useState)(""),[s,o]=(0,k.useState)(!1);return(0,va.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,va.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl w-96",children:[(0,va.jsxs)("div",{className:"text-center mb-6",children:[(0,va.jsx)("div",{className:"bg-blue-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:(0,va.jsx)(V,{className:"h-10 w-10 text-blue-600"})}),(0,va.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Bhotch CRM"}),(0,va.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Sign in to manage your leads"})]}),i&&(0,va.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm",children:i}),(0,va.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),o(!0),a("");try{await function(e,t,n){return Qt(e.app)?Promise.reject(fn(e)):ei(Be(e),jr.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&ti(e),t})}(ya,n.email,n.password),sessionStorage.setItem("isAuthenticated","true"),t()}catch(r){a("Login failed. Please check credentials.")}finally{o(!1)}},className:"space-y-4",children:[(0,va.jsx)("input",{type:"email",placeholder:"Email",value:n.email,onChange:e=>r(t=>M(M({},t),{},{email:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,va.jsx)("input",{type:"password",placeholder:"Password",value:n.password,onChange:e=>r(t=>M(M({},t),{},{password:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,va.jsx)("button",{type:"submit",disabled:s,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center",children:s?(0,va.jsx)(H,{className:"animate-spin h-5 w-5"}):"Sign In"})]})]})})},xa=k.memo(e=>{let{title:t,value:n,color:r,icon:i}=e;const a=(0,k.useMemo)(()=>({blue:"bg-blue-100 text-blue-800",red:"bg-red-100 text-red-800",green:"bg-green-100 text-green-800",purple:"bg-purple-100 text-purple-800"}),[]);return(0,va.jsx)("div",{className:"bg-white rounded-lg shadow p-5",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"p-3 rounded-full ".concat(a[r]),children:i&&(0,va.jsx)(i,{size:24})}),(0,va.jsxs)("div",{className:"ml-4",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-500 truncate",children:t}),(0,va.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:n})]})]})})}),wa=z("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),_a=z("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);const Sa=function(e){let{stats:t,leads:n,jobCounts:r=[],onNavigateToTab:i}=e;const a=n.slice(0,5);return(0,va.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,va.jsx)("div",{className:"flex justify-between items-center",children:(0,va.jsxs)("div",{children:[(0,va.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Dashboard"}),(0,va.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Welcome to your roofing business overview"})]})}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,va.jsx)(xa,{title:"Total Leads",value:t.totalLeads,icon:wa,color:"blue"}),(0,va.jsx)(xa,{title:"Hot Leads",value:t.hotLeads,icon:_a,color:"red"}),(0,va.jsx)(xa,{title:"Quoted Leads",value:t.quotedLeads,icon:J,color:"green"}),(0,va.jsx)(xa,{title:"Total Quote Value",value:(s=t.totalQuoteValue,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)),icon:Q,color:"purple"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 lg:p-6",children:[(0,va.jsx)("h3",{className:"text-base lg:text-lg font-semibold text-gray-900 mb-3 lg:mb-4",children:"Recent Leads"}),0===a.length?(0,va.jsx)("p",{className:"text-sm lg:text-base text-gray-500",children:"No leads yet. Add your first lead to get started!"}):(0,va.jsx)("div",{className:"overflow-x-auto",children:(0,va.jsxs)("table",{className:"min-w-full",children:[(0,va.jsx)("thead",{children:(0,va.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,va.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Name"}),(0,va.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Quality"}),(0,va.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm hidden sm:table-cell",children:"Disposition"}),(0,va.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm",children:"Quote"}),(0,va.jsx)("th",{className:"text-left py-2 px-2 lg:px-4 font-medium text-gray-700 text-xs lg:text-sm hidden md:table-cell",children:"Notes"})]})}),(0,va.jsx)("tbody",{children:a.map((e,t)=>(0,va.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,va.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-900 text-xs lg:text-sm",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"}),(0,va.jsx)("td",{className:"py-2 px-2 lg:px-4",children:(0,va.jsx)("span",{className:"px-1.5 lg:px-2 py-0.5 lg:py-1 rounded-full text-xs font-medium ".concat("Hot"===e.quality?"bg-red-100 text-red-800":"Warm"===e.quality?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:e.quality})}),(0,va.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-600 text-xs lg:text-sm hidden sm:table-cell",children:e.disposition||"New"}),(0,va.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-900 text-xs lg:text-sm",children:e.dabellaQuote||"N/A"}),(0,va.jsx)("td",{className:"py-2 px-2 lg:px-4 text-gray-600 text-xs lg:text-sm max-w-xs truncate hidden md:table-cell",children:e.notes||"No notes"})]},e.id||t))})]})})]})]});var s},Ca=z("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Ea=z("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Na=z("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),ka=z("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Ia=z("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Ta=z("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ba=z("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ma=z("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),Fa=z("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ra=z("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),La=z("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Pa=z("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Ua=z("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Da=function(e){let{leads:t,onAddLead:n,onEditLead:r,onDeleteLead:i,onRefreshLeads:a,onSelectLead:s}=e;const[o,l]=(0,k.useState)(""),[c,u]=(0,k.useState)(""),[h,d]=(0,k.useState)({key:null,direction:"asc"}),[A,p]=(0,k.useState)({}),[f,g]=(0,k.useState)(!1),[m,y]=(0,k.useState)(1),[v,b]=(0,k.useState)(25),[x,w]=(0,k.useState)(!1),_={id:!1,date:!0,createdDate:!1,modifiedDate:!1,customerName:!0,firstName:!1,lastName:!1,phoneNumber:!0,email:!1,address:!0,latitude:!1,longitude:!1,quality:!0,disposition:!0,leadSource:!0,status:!1,roofAge:!1,roofType:!1,sqFt:!0,ridgeLf:!0,valleyLf:!0,eavesLf:!1,dabellaQuote:!0,ridgeVents:!1,turbine:!1,rimeFlow:!1,highProfileRidgeCap:!1,valleyMetal:!1,pipes1Half:!1,pipes2:!1,pipes3:!1,pipes4:!1,gables:!1,turtleBacks:!1,satellite:!1,chimney:!1,solar:!1,swampCooler:!1,guttersLf:!1,downspouts:!1,gutterGuardLf:!1,permanentLighting:!1,notes:!1},S=()=>{try{const e=localStorage.getItem("leadsVisibleColumns");if(e)return JSON.parse(e)}catch(SS){console.error("Error loading saved columns:",SS)}return _},[C,E]=(0,k.useState)(S),[N,I]=(0,k.useState)(S),T=(0,k.useCallback)(()=>{try{localStorage.setItem("leadsVisibleColumns",JSON.stringify(N)),E(N),w(!1)}catch(SS){console.error("Error saving columns:",SS)}},[N]),B=(0,k.useCallback)(e=>{const t={New:{bg:"bg-blue-100",text:"text-blue-800",icon:Ca},Scheduled:{bg:"bg-cyan-100",text:"text-cyan-800",icon:K},Insurance:{bg:"bg-indigo-100",text:"text-indigo-800",icon:Ea},Quoted:{bg:"bg-yellow-100",text:"text-yellow-800",icon:Q},"Follow Up":{bg:"bg-orange-100",text:"text-orange-800",icon:te},"Closed Sold":{bg:"bg-green-100",text:"text-green-800",icon:$},"Closed Lost":{bg:"bg-red-100",text:"text-red-800",icon:Z}}[e]||{bg:"bg-gray-100",text:"text-gray-800",icon:ee},n=t.icon;return(0,va.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.bg," ").concat(t.text),children:[(0,va.jsx)(n,{className:"w-3 h-3 mr-1"}),e]})},[]),F=(0,k.useCallback)(e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",[]),R=(0,k.useCallback)(e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(t){return e}},[]),L=(0,k.useCallback)(e=>{const t=String(e||"");if(!t)return"-";const n=t.replace(/\D/g,"");return 10===n.length?"(".concat(n.slice(0,3),") ").concat(n.slice(3,6),"-").concat(n.slice(6)):t},[]),P=(0,k.useCallback)(e=>{d(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},[]),U=(0,k.useMemo)(()=>[{key:"id",label:"ID",type:"text",category:"Basic"},{key:"date",label:"Date",type:"date",category:"Basic"},{key:"createdDate",label:"Created Date",type:"date",category:"Basic"},{key:"modifiedDate",label:"Modified Date",type:"date",category:"Basic"},{key:"customerName",label:"Customer Name",type:"text",category:"Basic"},{key:"firstName",label:"First Name",type:"text",category:"Basic"},{key:"lastName",label:"Last Name",type:"text",category:"Basic"},{key:"phoneNumber",label:"Phone Number",type:"text",category:"Basic"},{key:"email",label:"Email",type:"text",category:"Basic"},{key:"address",label:"Address",type:"text",category:"Basic"},{key:"latitude",label:"Latitude",type:"number",category:"Basic"},{key:"longitude",label:"Longitude",type:"number",category:"Basic"},{key:"quality",label:"Quality",type:"text",category:"Lead Info"},{key:"disposition",label:"Disposition",type:"text",category:"Lead Info"},{key:"leadSource",label:"Lead Source",type:"text",category:"Lead Info"},{key:"status",label:"Status",type:"text",category:"Lead Info"},{key:"roofAge",label:"Roof Age",type:"text",category:"Roof Info"},{key:"roofType",label:"Roof Type",type:"text",category:"Roof Info"},{key:"sqFt",label:"SQ FT",type:"number",category:"Measurements"},{key:"ridgeLf",label:"Ridge LF",type:"number",category:"Measurements"},{key:"valleyLf",label:"Valley LF",type:"number",category:"Measurements"},{key:"eavesLf",label:"Eaves LF",type:"number",category:"Measurements"},{key:"dabellaQuote",label:"DaBella Quote",type:"number",category:"Financial"},{key:"ridgeVents",label:"Ridge Vents",type:"number",category:"Ventilation"},{key:"turbine",label:"Turbine",type:"number",category:"Ventilation"},{key:"rimeFlow",label:"Rime Flow",type:"number",category:"Ventilation"},{key:"highProfileRidgeCap",label:"High Profile Ridge Cap",type:"number",category:"Components"},{key:"valleyMetal",label:"Valley Metal",type:"number",category:"Components"},{key:"pipes1Half",label:'Pipes 1.5"',type:"number",category:"Pipes"},{key:"pipes2",label:'Pipes 2"',type:"number",category:"Pipes"},{key:"pipes3",label:'Pipes 3"',type:"number",category:"Pipes"},{key:"pipes4",label:'Pipes 4"',type:"number",category:"Pipes"},{key:"gables",label:"Gables",type:"number",category:"Features"},{key:"turtleBacks",label:"Turtle Backs",type:"number",category:"Features"},{key:"satellite",label:"Satellite",type:"number",category:"Features"},{key:"chimney",label:"Chimney",type:"number",category:"Features"},{key:"solar",label:"Solar",type:"number",category:"Features"},{key:"swampCooler",label:"Swamp Cooler",type:"number",category:"Features"},{key:"guttersLf",label:"Gutters LF",type:"number",category:"Gutters"},{key:"downspouts",label:"Downspouts",type:"number",category:"Gutters"},{key:"gutterGuardLf",label:"Gutter Guard LF",type:"number",category:"Gutters"},{key:"permanentLighting",label:"Permanent Lighting",type:"number",category:"Additional"},{key:"notes",label:"Notes",type:"text",category:"Additional"}],[]),D=(0,k.useCallback)((e,t)=>{const n=U.find(e=>e.key===t);return"customerName"===t?e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown":"number"===(null===n||void 0===n?void 0:n.type)?parseFloat(e[t])||0:e[t]||""},[U]),O=(0,k.useCallback)(e=>{I(t=>M(M({},t),{},{[e]:!t[e]}))},[]),j=(0,k.useCallback)((e,t)=>{p(n=>{const r=M({},n);return""===t||null===t||void 0===t?delete r[e]:r[e]=t,y(1),r})},[]),z=(0,k.useCallback)(()=>{p({}),l(""),u(""),y(1)},[]),H=(0,k.useMemo)(()=>{let e=t.filter(e=>{var t;const n=!o||[e.firstName,e.lastName,e.customerName,null===(t=e.phoneNumber)||void 0===t?void 0:t.toString(),e.address,e.quality,e.disposition,e.leadSource].some(e=>null===e||void 0===e?void 0:e.toLowerCase().includes(o.toLowerCase())),r=!c||e.date===c,i=Object.entries(A).every(t=>{let n,[r,i]=t;if(!i)return!0;if("customerName"===r)n=e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim();else{const t=U.find(e=>e.key===r);n="number"===(null===t||void 0===t?void 0:t.type)?parseFloat(e[r])||0:e[r]||""}const a=U.find(e=>e.key===r);return"number"===(null===a||void 0===a?void 0:a.type)?n>=parseFloat(i):n.toString().toLowerCase().includes(i.toLowerCase())});return n&&r&&i});return h.key&&e.sort((e,t)=>{const n=D(e,h.key),r=D(t,h.key);if("string"===typeof n&&"string"===typeof r){const e=n.toLowerCase().localeCompare(r.toLowerCase());return"asc"===h.direction?e:-e}{const e=n-r;return"asc"===h.direction?e:-e}}),e},[t,o,c,A,h,D,U]),V=(0,k.useMemo)(()=>{const e=(m-1)*v,t=e+v;return H.slice(e,t)},[H,m,v]),G=Math.ceil(H.length/v),W=(0,k.useMemo)(()=>o||c||Object.keys(A).length>0,[o,c,A]),q=e=>{var t;let{sortKey:n,children:r,className:i=""}=e;const a=A[n];return(0,va.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(i),children:(0,va.jsxs)("div",{className:"space-y-2",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors select-none p-1 rounded",onClick:()=>P(n),children:[(0,va.jsx)("span",{className:a?"text-blue-600 font-semibold":"",children:r}),(0,va.jsxs)("div",{className:"flex items-center space-x-1",children:[a&&(0,va.jsx)(Na,{className:"w-3 h-3 text-blue-600"}),(0,va.jsxs)("div",{className:"flex flex-col",children:[(0,va.jsx)(ka,{className:"w-3 h-3 ".concat(h.key===n&&"asc"===h.direction?"text-blue-600":"text-gray-300")}),(0,va.jsx)(Ia,{className:"w-3 h-3 -mt-1 ".concat(h.key===n&&"desc"===h.direction?"text-blue-600":"text-gray-300")})]})]})]}),f&&(0,va.jsx)(X,{column:n,value:A[n]||"",onChange:e=>j(n,e),type:(null===(t=U.find(e=>e.key===n))||void 0===t?void 0:t.type)||"text"})]})})},X=e=>{let{column:t,value:n,onChange:r,type:i}=e;const a="number"===i?"Min value...":"Filter...";return(0,va.jsxs)("div",{className:"relative",children:[(0,va.jsx)("input",{type:"number"===i?"number":"date"===i?"date":"text",value:n,onChange:e=>r(e.target.value),placeholder:a,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",onClick:e=>e.stopPropagation()}),n&&(0,va.jsx)("button",{onClick:e=>{e.stopPropagation(),r("")},className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{className:"w-3 h-3"})})]})};return(0,va.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,va.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Lead Management"}),(0,va.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Track and manage your sales leads"})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2 lg:space-x-3",children:[(0,va.jsxs)("button",{onClick:a,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-gray-300 rounded-lg text-xs lg:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[(0,va.jsx)(Ba,{className:"w-3 h-3 lg:w-4 lg:h-4 lg:mr-2"}),(0,va.jsx)("span",{className:"hidden lg:inline",children:"Refresh"})]}),(0,va.jsxs)("button",{onClick:n,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-transparent rounded-lg text-xs lg:text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(Ca,{className:"w-3 h-3 lg:w-4 lg:h-4 mr-1 lg:mr-2"}),"Add Lead"]})]})]}),(0,va.jsx)("div",{className:"bg-white p-3 lg:p-6 rounded-lg shadow-sm border",children:(0,va.jsxs)("div",{className:"space-y-3 lg:space-y-4",children:[(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 lg:gap-4",children:[(0,va.jsxs)("div",{className:"relative md:col-span-2",children:[(0,va.jsx)(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,va.jsx)("input",{type:"text",placeholder:"Search across all fields...",value:o,onChange:e=>l(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,va.jsxs)("div",{className:"relative",children:[(0,va.jsx)(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,va.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,va.jsxs)("button",{onClick:()=>g(!f),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(f?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,va.jsx)(Na,{className:"w-4 h-4 mr-2"}),"Column Filters",Object.keys(A).length>0&&(0,va.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:Object.keys(A).length})]}),(0,va.jsxs)("button",{onClick:()=>w(!x),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(x?"border-purple-500 text-purple-700 bg-purple-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,va.jsx)(Fa,{className:"w-4 h-4 mr-2"}),"Manage Columns",(0,va.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full",children:Object.values(C).filter(Boolean).length})]}),W&&(0,va.jsxs)("button",{onClick:z,className:"inline-flex items-center px-3 py-2 border border-red-300 rounded-lg text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 transition-colors",children:[(0,va.jsx)(Ta,{className:"w-4 h-4 mr-2"}),"Clear All Filters"]})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsxs)("select",{value:v,onChange:e=>{b(Number(e.target.value)),y(1)},className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,va.jsx)("option",{value:10,children:"10 per page"}),(0,va.jsx)("option",{value:25,children:"25 per page"}),(0,va.jsx)("option",{value:50,children:"50 per page"}),(0,va.jsx)("option",{value:100,children:"100 per page"})]}),(0,va.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",0===H.length?0:(m-1)*v+1,"-",Math.min(m*v,H.length)," of ",H.length]})]})]})]})}),x&&(0,va.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,va.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,va.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Visible Columns"}),(0,va.jsx)("button",{onClick:()=>{I(C),w(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{className:"w-5 h-5"})})]}),(0,va.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6",children:U.map(e=>(0,va.jsxs)("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer",children:[(0,va.jsx)("input",{type:"checkbox",checked:N[e.key],onChange:()=>O(e.key),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,va.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,va.jsx)("button",{onClick:()=>{I(C),w(!1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,va.jsxs)("button",{onClick:T,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(Ra,{className:"w-4 h-4 mr-2"}),"Save Column Selection"]})]})]}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:(0,va.jsxs)("div",{className:"overflow-x-auto",children:[(0,va.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,va.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,va.jsxs)("tr",{children:[U.filter(e=>C[e.key]).map(e=>(0,va.jsx)(q,{sortKey:e.key,children:e.label},e.key)),(0,va.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,va.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:V.map((e,t)=>(0,va.jsxs)("tr",{className:"cursor-pointer transition-all duration-200 hover:bg-blue-50 hover:shadow-md transform hover:-translate-y-0.5 ".concat(t%2===0?"bg-white":"bg-gray-50"),onClick:()=>s(e),children:[U.filter(e=>C[e.key]).map(t=>(0,va.jsx)("td",{className:"px-6 py-5 whitespace-nowrap",children:(()=>{if("date"===t.key||"createdDate"===t.key||"modifiedDate"===t.key)return(0,va.jsx)("div",{className:"text-sm font-medium text-gray-900",children:R(e[t.key])});if("customerName"===t.key)return(0,va.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"});if("phoneNumber"===t.key)return(0,va.jsx)("a",{href:"tel:".concat(e.phoneNumber),onClick:e=>e.stopPropagation(),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:L(e.phoneNumber)});if("email"===t.key)return e.email?(0,va.jsx)("a",{href:"mailto:".concat(e.email),onClick:e=>e.stopPropagation(),className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:e.email}):"-";if("address"===t.key)return(0,va.jsx)("div",{className:"text-sm text-gray-700 truncate max-w-xs",children:e.address||"-"});if("disposition"===t.key)return B(e.disposition);if("dabellaQuote"===t.key)return e.dabellaQuote?(0,va.jsxs)("span",{className:"text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-medium",children:["$",F(e.dabellaQuote)]}):"-";if("number"===t.type){const n=e[t.key];return n?(0,va.jsx)("div",{className:"text-sm font-medium text-gray-900",children:F(n)}):"-"}return(0,va.jsx)("div",{className:"text-sm text-gray-900",children:e[t.key]||"-"})})()},t.key)),(0,va.jsx)("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium",children:(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-100 transition-all duration-200 hover:scale-110",title:"View Details",children:(0,va.jsx)(Y,{className:"w-4 h-4"})}),(0,va.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"text-orange-600 hover:text-orange-900 p-2 rounded-lg hover:bg-orange-100 transition-all duration-200 hover:scale-110",title:"Edit",children:(0,va.jsx)(La,{className:"w-4 h-4"})})]})})]},e.id||t))})]}),0===H.length&&(0,va.jsxs)("div",{className:"text-center py-12",children:[(0,va.jsx)(ee,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,va.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No leads found"}),(0,va.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:W?"Try adjusting your search or filter criteria.":"Get started by adding your first lead."})]})]})}),H.length>0&&G>1&&(0,va.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("button",{onClick:()=>y(1),disabled:1===m,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,va.jsxs)("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===m,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,va.jsx)(Pa,{className:"w-4 h-4 mr-1"}),"Previous"]})]}),(0,va.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(7,G)},(e,t)=>{let n;return n=G<=7||m<=4?t+1:m>=G-3?G-6+t:m-3+t,(0,va.jsx)("button",{onClick:()=>y(n),className:"px-3 py-2 text-sm font-medium rounded-lg ".concat(m===n?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:n},n)})}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsxs)("button",{onClick:()=>y(e=>Math.min(G,e+1)),disabled:m===G,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",(0,va.jsx)(Ua,{className:"w-4 h-4 ml-1"})]}),(0,va.jsx)("button",{onClick:()=>y(G),disabled:m===G,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})})]})};const Oa=function(e){let{jobCounts:t,onAddJobCount:n,onEditJobCount:r,onDeleteJobCount:i,onRefreshJobCounts:a,onSelectJobCount:s}=e;const[o,l]=(0,k.useState)(""),[c,u]=(0,k.useState)(""),[h,d]=(0,k.useState)({key:null,direction:"asc"}),[A,p]=(0,k.useState)({}),[f,g]=(0,k.useState)(!1),[m,y]=(0,k.useState)(1),[v,b]=(0,k.useState)(25),[x,w]=(0,k.useState)(!1),_={date:!0,customer:!0,phone:!0,address:!0,email:!1,sqFt:!0,ridgeLf:!0,valleyLf:!0,eavesLf:!1,quote:!0,quality:!0,disposition:!0,leadSource:!0,roofAge:!1,roofType:!1,ridgeVents:!1,turbine:!1,rimeFlow:!1,highProfileRidgeCap:!1,valleyMetal:!1,pipes1Half:!1,pipes2:!1,pipes3:!1,pipes4:!1,gables:!1,turtleBacks:!1,satellite:!1,chimney:!1,solar:!1,swampCooler:!1,guttersLf:!1,downspouts:!1,gutterGuardLf:!1,permanentLighting:!1},S=()=>{try{const e=localStorage.getItem("jobCountVisibleColumns");if(e)return JSON.parse(e)}catch(SS){console.error("Error loading saved columns:",SS)}return _},[C,E]=(0,k.useState)(S),[N,I]=(0,k.useState)(S),T=(0,k.useCallback)(()=>{try{localStorage.setItem("jobCountVisibleColumns",JSON.stringify(N)),E(N),w(!1)}catch(SS){console.error("Error saving columns:",SS)}},[N]),B=(0,k.useCallback)(e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",[]),F=(0,k.useCallback)(e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString()}catch(t){return e}},[]),R=(0,k.useCallback)(e=>{if(!e)return"-";const t=e.toString().replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e},[]),L=(0,k.useCallback)(e=>{d(t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"}))},[]),P=(0,k.useMemo)(()=>[{key:"date",label:"Date",type:"date",category:"Basic"},{key:"customer",label:"Customer",type:"text",category:"Basic"},{key:"phone",label:"Phone",type:"text",category:"Basic"},{key:"email",label:"Email",type:"text",category:"Basic"},{key:"address",label:"Address",type:"text",category:"Basic"},{key:"quality",label:"Quality",type:"text",category:"Job Info"},{key:"disposition",label:"Disposition",type:"text",category:"Job Info"},{key:"leadSource",label:"Lead Source",type:"text",category:"Job Info"},{key:"roofAge",label:"Roof Age",type:"text",category:"Job Info"},{key:"roofType",label:"Roof Type",type:"text",category:"Job Info"},{key:"sqFt",label:"SQ FT",type:"number",category:"Measurements"},{key:"ridgeLf",label:"Ridge LF",type:"number",category:"Measurements"},{key:"valleyLf",label:"Valley LF",type:"number",category:"Measurements"},{key:"eavesLf",label:"Eaves LF",type:"number",category:"Measurements"},{key:"quote",label:"Quote",type:"number",category:"Financial"},{key:"ridgeVents",label:"Ridge Vents",type:"number",category:"Ventilation"},{key:"turbine",label:"Turbine",type:"number",category:"Ventilation"},{key:"rimeFlow",label:"Rime Flow",type:"number",category:"Ventilation"},{key:"highProfileRidgeCap",label:"High Profile Ridge Cap",type:"number",category:"Components"},{key:"valleyMetal",label:"Valley Metal",type:"number",category:"Components"},{key:"pipes1Half",label:'Pipes 1.5"',type:"number",category:"Pipes"},{key:"pipes2",label:'Pipes 2"',type:"number",category:"Pipes"},{key:"pipes3",label:'Pipes 3"',type:"number",category:"Pipes"},{key:"pipes4",label:'Pipes 4"',type:"number",category:"Pipes"},{key:"gables",label:"Gables",type:"number",category:"Features"},{key:"turtleBacks",label:"Turtle Backs",type:"number",category:"Features"},{key:"satellite",label:"Satellite",type:"number",category:"Features"},{key:"chimney",label:"Chimney",type:"number",category:"Features"},{key:"solar",label:"Solar",type:"number",category:"Features"},{key:"swampCooler",label:"Swamp Cooler",type:"number",category:"Features"},{key:"guttersLf",label:"Gutters LF",type:"number",category:"Gutters"},{key:"downspouts",label:"Downspouts",type:"number",category:"Gutters"},{key:"gutterGuardLf",label:"Gutter Guard LF",type:"number",category:"Gutters"},{key:"permanentLighting",label:"Permanent Lighting",type:"number",category:"Additional"}],[]),U=(0,k.useCallback)((e,t)=>{const n=P.find(e=>e.key===t);return"customer"===t?e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown":"phone"===t?e.phoneNumber||"":"quote"===t?parseFloat(e.dabellaQuote)||0:"number"===(null===n||void 0===n?void 0:n.type)?parseFloat(e[t])||0:e[t]||""},[P]),D=(0,k.useCallback)(e=>{I(t=>M(M({},t),{},{[e]:!t[e]}))},[]),O=(0,k.useCallback)((e,t)=>{p(n=>{const r=M({},n);return""===t||null===t||void 0===t?delete r[e]:r[e]=t,y(1),r})},[]),j=(0,k.useCallback)(()=>{p({}),l(""),u(""),y(1)},[]),z=(0,k.useMemo)(()=>{let e=t.filter(e=>{var t;const n=!o||[e.firstName,e.lastName,e.customerName,null===(t=e.phoneNumber)||void 0===t?void 0:t.toString(),e.address,e.quality,e.disposition,e.leadSource].some(e=>null===e||void 0===e?void 0:e.toLowerCase().includes(o.toLowerCase())),r=!c||e.date===c,i=Object.entries(A).every(t=>{let n,[r,i]=t;if(!i)return!0;if("customer"===r)n=e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim();else if("phone"===r){var a;n=(null===(a=e.phoneNumber)||void 0===a?void 0:a.toString())||""}else if("quote"===r)n=parseFloat(e.dabellaQuote)||0;else{const t=P.find(e=>e.key===r);n="number"===(null===t||void 0===t?void 0:t.type)?parseFloat(e[r])||0:e[r]||""}const s=P.find(e=>e.key===r);return"number"===(null===s||void 0===s?void 0:s.type)?n>=parseFloat(i):n.toString().toLowerCase().includes(i.toLowerCase())});return n&&r&&i});return h.key&&e.sort((e,t)=>{const n=U(e,h.key),r=U(t,h.key);if("string"===typeof n&&"string"===typeof r){const e=n.toLowerCase().localeCompare(r.toLowerCase());return"asc"===h.direction?e:-e}{const e=n-r;return"asc"===h.direction?e:-e}}),e},[t,o,c,A,h,U,P]),H=(0,k.useMemo)(()=>{const e=(m-1)*v,t=e+v;return z.slice(e,t)},[z,m,v]),Q=Math.ceil(z.length/v),V=(0,k.useMemo)(()=>o||c||Object.keys(A).length>0,[o,c,A]),G=(0,k.useMemo)(()=>z.reduce((e,t)=>(e.totalJobs+=1,e.totalSqFt+=parseFloat(t.sqFt)||0,e.totalRidgeLf+=parseFloat(t.ridgeLf)||0,e.totalValleyLf+=parseFloat(t.valleyLf)||0,e),{totalJobs:0,totalSqFt:0,totalRidgeLf:0,totalValleyLf:0}),[z]),q=e=>{var t;let{sortKey:n,children:r,className:i=""}=e;const a=A[n];return(0,va.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider ".concat(i),children:(0,va.jsxs)("div",{className:"space-y-2",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-100 transition-colors select-none p-1 rounded",onClick:()=>L(n),children:[(0,va.jsx)("span",{className:a?"text-blue-600 font-semibold":"",children:r}),(0,va.jsxs)("div",{className:"flex items-center space-x-1",children:[a&&(0,va.jsx)(Na,{className:"w-3 h-3 text-blue-600"}),(0,va.jsxs)("div",{className:"flex flex-col",children:[(0,va.jsx)(ka,{className:"w-3 h-3 ".concat(h.key===n&&"asc"===h.direction?"text-blue-600":"text-gray-300")}),(0,va.jsx)(Ia,{className:"w-3 h-3 -mt-1 ".concat(h.key===n&&"desc"===h.direction?"text-blue-600":"text-gray-300")})]})]})]}),f&&(0,va.jsx)(X,{column:n,value:A[n]||"",onChange:e=>O(n,e),type:(null===(t=P.find(e=>e.key===n))||void 0===t?void 0:t.type)||"text"})]})})},X=e=>{let{column:t,value:n,onChange:r,type:i}=e;const a="number"===i?"Min value...":"Filter...";return(0,va.jsxs)("div",{className:"relative",children:[(0,va.jsx)("input",{type:"number"===i?"number":"date"===i?"date":"text",value:n,onChange:e=>r(e.target.value),placeholder:a,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500",onClick:e=>e.stopPropagation()}),n&&(0,va.jsx)("button",{onClick:e=>{e.stopPropagation(),r("")},className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{className:"w-3 h-3"})})]})};return(0,va.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,va.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Job Count Management"}),(0,va.jsx)("p",{className:"text-sm lg:text-base text-gray-600 mt-1",children:"Track roofing job counts, measurements, and customer information"})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2 lg:space-x-3",children:[(0,va.jsxs)("button",{onClick:a,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-gray-300 rounded-lg text-xs lg:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[(0,va.jsx)(Ba,{className:"w-3 h-3 lg:w-4 lg:h-4 lg:mr-2"}),(0,va.jsx)("span",{className:"hidden lg:inline",children:"Refresh"})]}),(0,va.jsxs)("button",{onClick:n,className:"inline-flex items-center px-3 lg:px-4 py-2 border border-transparent rounded-lg text-xs lg:text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(Ca,{className:"w-3 h-3 lg:w-4 lg:h-4 mr-1 lg:mr-2"}),"Add Job Count"]})]})]}),(0,va.jsx)("div",{className:"bg-white p-3 lg:p-6 rounded-lg shadow-sm border",children:(0,va.jsxs)("div",{className:"space-y-3 lg:space-y-4",children:[(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 lg:gap-4",children:[(0,va.jsxs)("div",{className:"relative md:col-span-2",children:[(0,va.jsx)(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,va.jsx)("input",{type:"text",placeholder:"Search across all fields...",value:o,onChange:e=>l(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,va.jsxs)("div",{className:"relative",children:[(0,va.jsx)(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,va.jsx)("input",{type:"date",value:c,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,va.jsxs)("button",{onClick:()=>g(!f),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(f?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,va.jsx)(Na,{className:"w-4 h-4 mr-2"}),"Column Filters",Object.keys(A).length>0&&(0,va.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:Object.keys(A).length})]}),(0,va.jsxs)("button",{onClick:()=>w(!x),className:"inline-flex items-center px-3 py-2 border rounded-lg text-sm font-medium transition-colors ".concat(x?"border-purple-500 text-purple-700 bg-purple-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"),children:[(0,va.jsx)(Fa,{className:"w-4 h-4 mr-2"}),"Manage Columns",(0,va.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full",children:Object.values(C).filter(Boolean).length})]}),V&&(0,va.jsxs)("button",{onClick:j,className:"inline-flex items-center px-3 py-2 border border-red-300 rounded-lg text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 transition-colors",children:[(0,va.jsx)(Ta,{className:"w-4 h-4 mr-2"}),"Clear All Filters"]})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsxs)("select",{value:v,onChange:e=>{b(Number(e.target.value)),y(1)},className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,va.jsx)("option",{value:10,children:"10 per page"}),(0,va.jsx)("option",{value:25,children:"25 per page"}),(0,va.jsx)("option",{value:50,children:"50 per page"}),(0,va.jsx)("option",{value:100,children:"100 per page"})]}),(0,va.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",0===z.length?0:(m-1)*v+1,"-",Math.min(m*v,z.length)," of ",z.length]})]})]})]})}),x&&(0,va.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,va.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,va.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Visible Columns"}),(0,va.jsx)("button",{onClick:()=>{I(C),w(!1)},className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{className:"w-5 h-5"})})]}),(0,va.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6",children:P.map(e=>(0,va.jsxs)("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50 cursor-pointer",children:[(0,va.jsx)("input",{type:"checkbox",checked:N[e.key],onChange:()=>D(e.key),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,va.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,va.jsx)("button",{onClick:()=>{I(C),w(!1)},className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,va.jsxs)("button",{onClick:T,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(Ra,{className:"w-4 h-4 mr-2"}),"Save Column Selection"]})]})]}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-6",children:[(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4 lg:p-6",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)(wa,{className:"h-8 w-8 text-blue-600"})}),(0,va.jsxs)("div",{className:"ml-4",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Jobs"}),(0,va.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:G.totalJobs})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)(W,{className:"h-8 w-8 text-green-600"})}),(0,va.jsxs)("div",{className:"ml-4",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total SQ FT"}),(0,va.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:B(G.totalSqFt)})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)(_a,{className:"h-8 w-8 text-purple-600"})}),(0,va.jsxs)("div",{className:"ml-4",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Ridge LF"}),(0,va.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:B(G.totalRidgeLf)})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)(_a,{className:"h-8 w-8 text-orange-600"})}),(0,va.jsxs)("div",{className:"ml-4",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Valley LF"}),(0,va.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:B(G.totalValleyLf)})]})]})})]}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:(0,va.jsxs)("div",{className:"overflow-x-auto",children:[(0,va.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,va.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,va.jsxs)("tr",{children:[P.filter(e=>C[e.key]).map(e=>(0,va.jsx)(q,{sortKey:e.key,children:e.label},e.key)),(0,va.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,va.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:H.map((e,t)=>(0,va.jsxs)("tr",{className:"cursor-pointer transition-all duration-200 hover:bg-blue-50 hover:shadow-md transform hover:-translate-y-0.5 ".concat(t%2===0?"bg-white":"bg-gray-50"),onClick:()=>s(e),children:[P.filter(e=>C[e.key]).map(t=>(0,va.jsx)("td",{className:"px-6 py-5 whitespace-nowrap",children:(()=>{if("date"===t.key)return(0,va.jsx)("div",{className:"text-sm font-medium text-gray-900",children:F(e.date)});if("customer"===t.key)return(0,va.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"});if("phone"===t.key)return(0,va.jsx)("a",{href:"tel:".concat(e.phoneNumber),onClick:e=>e.stopPropagation(),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:R(e.phoneNumber)});if("email"===t.key)return e.email?(0,va.jsx)("a",{href:"mailto:".concat(e.email),onClick:e=>e.stopPropagation(),className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:e.email}):"-";if("address"===t.key)return(0,va.jsx)("div",{className:"text-sm text-gray-700 truncate max-w-xs",children:e.address||"-"});if("quote"===t.key)return e.dabellaQuote?(0,va.jsxs)("span",{className:"text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-medium",children:["$",B(e.dabellaQuote)]}):"-";if("number"===t.type){const n=e[t.key];return n?(0,va.jsx)("div",{className:"text-sm font-medium text-gray-900",children:B(n)}):"-"}return(0,va.jsx)("div",{className:"text-sm text-gray-900",children:e[t.key]||"-"})})()},t.key)),(0,va.jsx)("td",{className:"px-6 py-5 whitespace-nowrap text-sm font-medium",children:(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"text-blue-600 hover:text-blue-900 p-2 rounded-lg hover:bg-blue-100 transition-all duration-200 hover:scale-110",title:"View Details",children:(0,va.jsx)(Y,{className:"w-4 h-4"})}),(0,va.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"text-orange-600 hover:text-orange-900 p-2 rounded-lg hover:bg-orange-100 transition-all duration-200 hover:scale-110",title:"Edit",children:(0,va.jsx)(La,{className:"w-4 h-4"})})]})})]},e.id||t))})]}),0===z.length&&(0,va.jsxs)("div",{className:"text-center py-12",children:[(0,va.jsx)(W,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,va.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No job counts found"}),(0,va.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:V?"Try adjusting your search or filter criteria.":"Get started by adding your first job count."})]})]})}),z.length>0&&Q>1&&(0,va.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("button",{onClick:()=>y(1),disabled:1===m,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"First"}),(0,va.jsxs)("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===m,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,va.jsx)(Pa,{className:"w-4 h-4 mr-1"}),"Previous"]})]}),(0,va.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(7,Q)},(e,t)=>{let n;return n=Q<=7||m<=4?t+1:m>=Q-3?Q-6+t:m-3+t,(0,va.jsx)("button",{onClick:()=>y(n),className:"px-3 py-2 text-sm font-medium rounded-lg ".concat(m===n?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:n},n)})}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsxs)("button",{onClick:()=>y(e=>Math.min(Q,e+1)),disabled:m===Q,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",(0,va.jsx)(Ua,{className:"w-4 h-4 ml-1"})]}),(0,va.jsx)("button",{onClick:()=>y(Q),disabled:m===Q,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Last"})]})]})})]})},ja=z("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),za=z("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Ha=z("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),Qa="AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4";let Va=!1;const Ga=()=>new Promise((e,t)=>{var n;if(Va&&null!==(n=window.google)&&void 0!==n&&n.maps)return e(window.google);const r="google-maps-script",i=document.getElementById(r);if(i)return i.addEventListener("load",()=>{Va=!0,e(window.google)}),void i.addEventListener("error",()=>{t(new Error("Failed to load Google Maps. Please check your API key and internet connection."))});const a=document.createElement("script");a.id=r,a.src="https://maps.googleapis.com/maps/api/js?key=".concat(Qa,"&libraries=geometry,places&loading=async"),a.async=!0,a.defer=!0,a.onload=()=>{Va=!0,e(window.google)},a.onerror=()=>{document.head.removeChild(a),t(new Error("Failed to load Google Maps. Please check your API key and internet connection."))},document.head.appendChild(a)});function Wa(e){let{leads:t,onLeadClick:n,showDemoData:r,mapType:i,showTraffic:a,searchAddress:s,onSearchComplete:o,selectedCustomer:l,onCustomerLocated:c}=e;const u=(0,k.useRef)(null),h=(0,k.useRef)([]),d=(0,k.useRef)(null),A=(0,k.useRef)(null),[p,f]=(0,k.useState)(null),[g,m]=(0,k.useState)(!0),[y,v]=(0,k.useState)(null),b=(0,k.useMemo)(()=>[{id:"demo1",customerName:"John Smith",phoneNumber:"555-0123",address:"123 Main St, Ogden, UT",quality:"Hot",latitude:41.223,longitude:-111.9738},{id:"demo2",customerName:"Sarah Johnson",phoneNumber:"555-0456",address:"456 Oak Ave, Salt Lake City, UT",quality:"Warm",latitude:40.7608,longitude:-111.891},{id:"demo3",customerName:"Mike Wilson",phoneNumber:"555-0789",address:"789 Pine St, Provo, UT",quality:"Cold",latitude:40.2338,longitude:-111.6585},{id:"demo4",customerName:"Emily Davis",phoneNumber:"555-0321",address:"321 Elm Dr, West Valley, UT",quality:"Hot",latitude:40.6916,longitude:-112.0011},{id:"demo5",customerName:"Chris Brown",phoneNumber:"555-0654",address:"654 Cedar Ln, Layton, UT",quality:"Warm",latitude:41.0602,longitude:-111.9711}],[]),x=r?b:t,w=x.filter(e=>!e.address||""===e.address.trim()),_=(0,k.useCallback)(e=>{switch(e){case"Hot":return"#dc2626";case"Warm":return"#f59e0b";case"Cold":return"#3b82f6";default:return"#6b7280"}},[]),S=(0,k.useCallback)(e=>{const t=_(e);return{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('<svg width="36" height="36" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">\n          <path d="M18 2c-7.7 0-14 6.3-14 14 0 10.5 14 18 14 18s14-7.5 14-18c0-7.7-6.3-14-14-14z" fill="'.concat(t,'" stroke="#ffffff" stroke-width="2"/>\n          <circle cx="18" cy="16" r="6" fill="#ffffff"/>\n          <circle cx="18" cy="16" r="3" fill="').concat(t,'"/>\n        </svg>')),scaledSize:new window.google.maps.Size(36,36),anchor:new window.google.maps.Point(18,36)}},[_]);(0,k.useEffect)(()=>{(async()=>{try{const e=await Ga();if(!u.current)return;const t=[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]}],n=new e.maps.Map(u.current,{center:{lat:40.7608,lng:-111.891},zoom:9,styles:t,mapTypeId:i,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0});A.current=new e.maps.TrafficLayer,a&&A.current.setMap(n),d.current=new e.maps.InfoWindow,f(n)}catch(e){v(e.message)}finally{m(!1)}})()},[i,a]),(0,k.useEffect)(()=>{A.current&&p&&A.current.setMap(a?p:null)},[a,p]),(0,k.useEffect)(()=>{if(!p||!window.google||!s)return;(new window.google.maps.Geocoder).geocode({address:s},(e,t)=>{if("OK"===t&&e[0]){const t=e[0].geometry.location;p.setCenter(t),p.setZoom(15),new window.google.maps.Marker({position:t,map:p,title:s,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4F46E5",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}})}o&&o()})},[p,s,o]),(0,k.useEffect)(()=>(window.viewLeadDetails=e=>{const t=x.find(t=>t.id===e);t&&n&&n(t)},()=>{window.viewLeadDetails=null}),[x,n]);const C=(0,k.useCallback)((e,t)=>{if(!p||!window.google)return;(new window.google.maps.Geocoder).geocode({address:e},(e,n)=>{if("OK"===n&&e[0]){const n=e[0].geometry.location;t({lat:n.lat(),lng:n.lng(),success:!0})}else t({success:!1,error:n})})},[p]);return(0,k.useEffect)(()=>{l&&p&&window.google&&C(l.address,e=>{if(e.success){const t={lat:e.lat,lng:e.lng};h.current.forEach(e=>e.setMap(null)),h.current=[],p.setCenter(t),p.setZoom(15);const n=new window.google.maps.Marker({position:t,map:p,title:l.customerName,icon:S(l.quality),animation:window.google.maps.Animation.DROP});n.addListener("click",()=>{const e='\n            <div style="padding: 12px; min-width: 200px;">\n              <h3 style="margin: 0 0 8px 0; color: #1f2937; font-size: 16px; font-weight: 600;">\n                '.concat(l.customerName||"Unknown",'\n              </h3>\n              <div style="margin-bottom: 8px;">\n                <strong style="color: #374151;">Phone:</strong>\n                <a href="tel:').concat(l.phoneNumber,'" style="color: #3b82f6; text-decoration: none;">\n                  ').concat(l.phoneNumber||"N/A",'\n                </a>\n              </div>\n              <div style="margin-bottom: 8px;">\n                <strong style="color: #374151;">Quality:</strong>\n                <span style="background: ').concat(_(l.quality),"20; color: ").concat(_(l.quality),'; padding: 2px 6px; border-radius: 4px; font-size: 12px;">\n                  ').concat(l.quality,'\n                </span>\n              </div>\n              <div style="margin-bottom: 12px; color: #6b7280; font-size: 14px;">').concat(l.address,"</div>\n              <button onclick=\"window.viewLeadDetails('").concat(l.id,'\')"\n                      style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">\n                View Details\n              </button>\n            </div>\n          ');d.current.setContent(e),d.current.open(p,n)}),h.current.push(n),c&&c(M(M({},l),{},{lat:e.lat,lng:e.lng}))}else console.warn("Failed to geocode customer address:",l.address,e.error)})},[l,p,C,S,_,c]),g?(0,va.jsx)("div",{className:"h-[70vh] w-full rounded-lg border border-gray-300 flex items-center justify-center bg-gray-50",children:(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)(H,{className:"animate-spin h-10 w-10 text-blue-600 mx-auto mb-3"}),(0,va.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading Interactive Map..."}),(0,va.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"Connecting to Google Maps"})]})}):y?(0,va.jsx)("div",{className:"h-[70vh] w-full rounded-lg border border-red-300 flex items-center justify-center bg-red-50",children:(0,va.jsxs)("div",{className:"text-center max-w-md",children:[(0,va.jsx)(ee,{className:"h-12 w-12 text-red-600 mx-auto mb-3"}),(0,va.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Map Loading Failed"}),(0,va.jsx)("p",{className:"text-red-600 mb-3",children:y}),(0,va.jsx)("p",{className:"text-sm text-gray-600",children:"Please check your Google Maps API key configuration and internet connection."})]})}):(0,va.jsxs)("div",{children:[(0,va.jsx)("div",{ref:u,className:"h-[70vh] w-full rounded-lg overflow-hidden border border-gray-300 shadow-sm"}),!r&&w.length>0&&(0,va.jsxs)("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,va.jsxs)("h4",{className:"text-sm font-semibold text-yellow-800 mb-3 flex items-center",children:[(0,va.jsx)(ee,{className:"w-4 h-4 mr-2"}),"Leads Without Address Data (",w.length,")"]}),(0,va.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:w.slice(0,4).map(e=>(0,va.jsxs)("div",{className:"bg-white p-3 rounded border border-yellow-200 hover:shadow-sm transition-shadow cursor-pointer",onClick:()=>n&&n(e),children:[(0,va.jsx)("div",{className:"font-medium text-gray-900",children:e.customerName||"Unknown"}),(0,va.jsx)("div",{className:"text-sm text-gray-600",children:e.phoneNumber||"No phone"}),(0,va.jsx)("div",{className:"text-xs text-gray-500",children:"No address provided"})]},e.id))}),w.length>4&&(0,va.jsxs)("div",{className:"mt-3 text-sm text-yellow-700",children:["And ",w.length-4," more leads without addresses..."]})]})]})}const qa=function(e){let{leads:t,onLeadClick:n,searchAddress:r,onSearchComplete:i}=e;const[a,s]=(0,k.useState)(!1),[o,l]=(0,k.useState)("roadmap"),[c,u]=(0,k.useState)(!1),[h,d]=(0,k.useState)(null),[A,p]=(0,k.useState)(""),[f,g]=(0,k.useState)(!1),m=(0,k.useMemo)(()=>t.filter(e=>e.address&&""!==e.address.trim()),[t]),y=m.length>0,v=(0,k.useMemo)(()=>A?m.filter(e=>{var t,n,r;return(null===(t=e.customerName)||void 0===t?void 0:t.toLowerCase().includes(A.toLowerCase()))||(null===(n=e.firstName)||void 0===n?void 0:n.toLowerCase().includes(A.toLowerCase()))||(null===(r=e.lastName)||void 0===r?void 0:r.toLowerCase().includes(A.toLowerCase()))}):m,[m,A]);(0,k.useEffect)(()=>{const e=e=>{e.target.closest(".customer-search-dropdown")||g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const b=(0,k.useMemo)(()=>{const e=a?[{quality:"Hot"},{quality:"Hot"},{quality:"Warm"},{quality:"Warm"},{quality:"Cold"}]:t;return{hot:e.filter(e=>"Hot"===e.quality).length,warm:e.filter(e=>"Warm"===e.quality).length,cold:e.filter(e=>"Cold"===e.quality).length,total:e.length,mapped:m.length}},[t,m,a]);return(0,va.jsxs)("div",{className:"space-y-6",children:[(0,va.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[(0,va.jsxs)("div",{children:[(0,va.jsxs)("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(ja,{className:"w-8 h-8 mr-3 text-blue-600"}),"Customer Locations"]}),(0,va.jsx)("p",{className:"text-gray-600 mt-1",children:"Interactive map showing customer locations with lead quality indicators"})]}),(0,va.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,va.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[(0,va.jsxs)("button",{onClick:()=>s(!1),className:"px-3 py-1 text-sm font-medium rounded-md transition-colors ".concat(a?"text-gray-600 hover:text-gray-900":"bg-white text-gray-900 shadow-sm"),children:["Real Data (",t.length,")"]}),(0,va.jsx)("button",{onClick:()=>s(!0),className:"px-3 py-1 text-sm font-medium rounded-md transition-colors ".concat(a?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Demo Data (5)"})]}),(0,va.jsxs)("div",{className:"relative customer-search-dropdown",children:[(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)(Ma,{className:"w-4 h-4 text-gray-400 absolute left-3 z-10"}),(0,va.jsx)("input",{type:"text",placeholder:"Search customer...",value:A,onChange:e=>{p(e.target.value),g(!0)},onFocus:()=>g(!0),className:"pl-10 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"}),(0,va.jsx)(Ia,{className:"w-4 h-4 text-gray-400 absolute right-3"})]}),f&&v.length>0&&(0,va.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-20",children:[v.slice(0,10).map(e=>(0,va.jsxs)("button",{onClick:()=>(e=>{d(e),p(e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()),g(!1)})(e),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:[(0,va.jsx)("div",{className:"font-medium text-gray-900",children:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"}),(0,va.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.address}),(0,va.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:(0,va.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat("Hot"===e.quality?"bg-red-100 text-red-800":"Warm"===e.quality?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.quality})})]},e.id)),v.length>10&&(0,va.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-500 bg-gray-50",children:["And ",v.length-10," more results..."]})]})]}),(0,va.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,va.jsx)("option",{value:"roadmap",children:"Road Map"}),(0,va.jsx)("option",{value:"satellite",children:"Satellite"}),(0,va.jsx)("option",{value:"hybrid",children:"Hybrid"}),(0,va.jsx)("option",{value:"terrain",children:"Terrain"})]}),(0,va.jsxs)("button",{onClick:()=>u(!c),className:"flex items-center px-3 py-2 text-sm font-medium rounded-lg border transition-colors ".concat(c?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,va.jsx)(za,{className:"w-4 h-4 mr-2"}),"Traffic"]})]})]}),(0,va.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,va.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-red-500",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,va.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"})})}),(0,va.jsxs)("div",{className:"ml-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Hot Leads"}),(0,va.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.hot})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:(0,va.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"})})}),(0,va.jsxs)("div",{className:"ml-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Warm Leads"}),(0,va.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.warm})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-blue-500",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,va.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})})}),(0,va.jsxs)("div",{className:"ml-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Cold Leads"}),(0,va.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:b.cold})]})]})}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow p-4 border-l-4 border-gray-500",children:(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"flex-shrink-0",children:(0,va.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:(0,va.jsx)(ja,{className:"w-4 h-4 text-gray-600"})})}),(0,va.jsxs)("div",{className:"ml-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Mapped"}),(0,va.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:a?5:b.mapped})]})]})})]}),y||a?(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,va.jsx)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,va.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Interactive Map"}),(0,va.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-600",children:[(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-1"}),"Hot (",b.hot,")"]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-1"}),"Warm (",b.warm,")"]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-1"}),"Cold (",b.cold,")"]})]})]}),a&&(0,va.jsxs)("div",{className:"flex items-center text-sm text-blue-600 bg-blue-50 px-3 py-1 rounded-full",children:[(0,va.jsx)(Ha,{className:"w-4 h-4 mr-1"}),"Demo Mode"]})]})}),(0,va.jsx)(Wa,{leads:t,onLeadClick:n,showDemoData:a,mapType:o,showTraffic:c,searchAddress:r,onSearchComplete:i,selectedCustomer:h,onCustomerLocated:e=>console.log("Customer located:",e)})]}):(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:(0,va.jsxs)("div",{className:"text-center py-12",children:[(0,va.jsx)(q,{className:"mx-auto h-20 w-20 text-gray-400 mb-6"}),(0,va.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"No Location Data Available"}),(0,va.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Your leads don't have geocoded coordinates yet. Add addresses to your leads or use demo data to see the map in action."}),(0,va.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,va.jsxs)("button",{onClick:()=>s(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(q,{className:"w-4 h-4 mr-2"}),"View Demo Data"]}),(0,va.jsxs)("button",{className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,va.jsx)(Ma,{className:"w-4 h-4 mr-2"}),"Learn About Geocoding"]})]})]})})]})},Ka=z("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),Xa=z("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Ya=z("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Ja=z("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Za=function(){const[e,t]=(0,k.useState)("MONTH"),n="brandon@rimehq.net",r=()=>{window.open("https://calendar.google.com/calendar/u/0/r?cid=".concat(n),"_blank")},i=()=>{const e=document.getElementById("google-calendar-iframe");if(e){const t=e.src;e.src="",e.src=t}};return(0,va.jsxs)("div",{className:"space-y-6",children:[(0,va.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4",children:[(0,va.jsxs)("div",{children:[(0,va.jsxs)("h2",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(Ka,{className:"w-8 h-8 mr-3 text-blue-600"}),"Calendar"]}),(0,va.jsxs)("p",{className:"text-gray-600 mt-1",children:["View and manage appointments from Google Calendar for ",n]})]}),(0,va.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,va.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[(0,va.jsxs)("button",{onClick:()=>t("MONTH"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("MONTH"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,va.jsx)(Xa,{className:"w-4 h-4"}),"Month"]}),(0,va.jsxs)("button",{onClick:()=>t("WEEK"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("WEEK"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,va.jsx)(K,{className:"w-4 h-4"}),"Week"]}),(0,va.jsxs)("button",{onClick:()=>t("AGENDA"),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2 ".concat("AGENDA"===e?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,va.jsx)(Ya,{className:"w-4 h-4"}),"Agenda"]})]}),(0,va.jsxs)("button",{onClick:i,className:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors shadow-sm",children:[(0,va.jsx)(Ba,{className:"w-4 h-4 mr-2"}),"Refresh"]}),(0,va.jsxs)("button",{onClick:r,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,va.jsx)(Ja,{className:"w-4 h-4 mr-2"}),"Open in Google"]})]})]}),(0,va.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start",children:[(0,va.jsx)(te,{className:"w-5 h-5 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Google Calendar Integration"}),(0,va.jsxs)("p",{className:"text-sm text-blue-800",children:["This calendar displays all events from ",(0,va.jsx)("span",{className:"font-semibold",children:n}),'. To add or edit appointments, click "Open in Google" to manage them directly in Google Calendar.']})]})]}),(0,va.jsx)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200",children:(0,va.jsx)("iframe",{id:"google-calendar-iframe",src:(()=>{const t=new URLSearchParams({src:n,ctz:"America/Denver",mode:e,showTitle:"0",showNav:"1",showDate:"1",showPrint:"0",showTabs:"1",showCalendars:"0",showTz:"0",bgcolor:"%23ffffff",color:"%232952A3"});return"".concat("https://calendar.google.com/calendar/embed","?").concat(t.toString())})(),style:{border:0},width:"100%",height:"700",frameBorder:"0",scrolling:"no",title:"Google Calendar",className:"w-full"})}),(0,va.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[(0,va.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,va.jsx)(Ka,{className:"w-5 h-5 mr-2 text-blue-600"}),"Quick Actions"]}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,va.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,va.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Create Appointment"}),(0,va.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:'Click "Open in Google" above to create new appointments directly in Google Calendar.'}),(0,va.jsx)("button",{onClick:r,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Go to Google Calendar \u2192"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,va.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Sync with Leads"}),(0,va.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Appointments created in Google Calendar will be automatically reflected here in real-time."}),(0,va.jsx)("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Refresh Calendar \u2192"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[(0,va.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Time Zone"}),(0,va.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Calendar is set to Mountain Time (America/Denver). All appointments display in this time zone."}),(0,va.jsx)("span",{className:"text-sm text-gray-500 font-medium",children:"MT (UTC-7/UTC-6)"})]})]})]})]})},$a=z("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),es=z("message-circle-reply",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}],["path",{d:"M7 12h8a2 2 0 0 1 2 2v1",key:"89sh1g"}]]),ts=z("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),ns=z("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),rs=z("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),is=z("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),as=z("phone-call",[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),ss=z("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),os=z("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),ls=z("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),cs=z("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),us=z("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),hs=z("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ds=z("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);function As(e){let{leads:t,jobCounts:n,communications:r=[]}=e;const[i,a]=(0,k.useState)(""),[s,o]=(0,k.useState)(null),[l,c]=(0,k.useState)(null),[u,h]=(0,k.useState)("all"),[d,A]=(0,k.useState)(""),[p,f]=(0,k.useState)(""),[g,m]=(0,k.useState)(""),[y,v]=(0,k.useState)(""),b=(0,k.useMemo)(()=>[...t.map(e=>({id:"lead-".concat(e.id),type:"lead",name:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||e.name||"Unknown",address:e.address,phone:e.phone,email:e.email||"",notes:e.notes||"",quality:e.quality,disposition:e.disposition,lastContact:e.lastContact||null,source:"Bhotchleads"})),...n.map(e=>({id:"job-".concat(e.id),type:"jobcount",name:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown",address:e.address,phone:e.phone||"",email:e.email||"",notes:e.notes||"",sqFt:e.sqFt,status:e.status,source:"Job Count"}))],[t,n]),x=(0,k.useMemo)(()=>{let e=b;if("all"!==u&&(e=e.filter(e=>e.type===u)),i.trim()){const t=i.toLowerCase();e=e.filter(e=>{var n,r,i,a;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(r=e.address)||void 0===r?void 0:r.toLowerCase().includes(t))||(null===(i=e.phone)||void 0===i?void 0:i.includes(t))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(t))})}return e.sort((e,t)=>{const n=e.lastContact?new Date(e.lastContact):new Date(0);return(t.lastContact?new Date(t.lastContact):new Date(0))-n})},[b,i,u]),w=(0,k.useMemo)(()=>s?r.filter(e=>e.customerId===s.id).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)):[],[s,r]),_=(0,k.useMemo)(()=>{const e=s?w:r;return{totalCalls:e.filter(e=>"call"===e.type).length,totalSMS:e.filter(e=>"sms"===e.type).length,totalEmails:e.filter(e=>"email"===e.type).length,lastContact:e.length>0?e[0].timestamp:null}},[s,w,r]),S=[{id:"sent",label:"Sent SMS",icon:$a,color:"green"},{id:"received",label:"Received SMS",icon:es,color:"teal"},{id:"follow-up",label:"Follow-up Needed",icon:ts,color:"orange"},{id:"not-interested",label:"Not Interested",icon:ns,color:"red"}],C=e=>{if(l===e)c(null);else if(c(e),"call"===e){const e=s.phone.replace(/\D/g,"");window.open("https://voice.google.com/u/0/calls?a=nc,%2B1".concat(e),"_blank")}};return(0,va.jsxs)("div",{className:"h-[calc(100vh-140px)] flex flex-col lg:flex-row gap-4 lg:gap-6",children:[(0,va.jsxs)("div",{className:"w-full lg:w-1/3 bg-white rounded-lg shadow-sm border overflow-hidden flex flex-col max-h-[40vh] lg:max-h-none",children:[(0,va.jsxs)("div",{className:"p-3 lg:p-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,va.jsxs)("h2",{className:"text-lg lg:text-xl font-bold text-gray-900 mb-3 lg:mb-4 flex items-center",children:[(0,va.jsx)(X,{className:"w-5 h-5 lg:w-6 lg:h-6 mr-2 text-blue-600"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Communications Hub"}),(0,va.jsx)("span",{className:"sm:hidden",children:"Comms"})]}),(0,va.jsxs)("div",{className:"relative mb-3",children:[(0,va.jsx)(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,va.jsx)("input",{type:"text",placeholder:"Search customers by name, address, phone...",value:i,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),(0,va.jsxs)("div",{className:"flex gap-1 lg:gap-2",children:[(0,va.jsxs)("button",{onClick:()=>h("all"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("all"===u?"bg-blue-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,va.jsx)(Na,{className:"w-3 h-3 lg:w-4 lg:h-4 inline mr-1"}),(0,va.jsxs)("span",{className:"hidden sm:inline",children:["All (",b.length,")"]}),(0,va.jsx)("span",{className:"sm:hidden",children:b.length})]}),(0,va.jsxs)("button",{onClick:()=>h("lead"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("lead"===u?"bg-green-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,va.jsxs)("span",{className:"hidden sm:inline",children:["Leads (",t.length,")"]}),(0,va.jsxs)("span",{className:"sm:hidden",children:["L",t.length]})]}),(0,va.jsxs)("button",{onClick:()=>h("jobcount"),className:"flex-1 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg text-xs lg:text-sm font-medium transition-all ".concat("jobcount"===u?"bg-purple-600 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"),children:[(0,va.jsxs)("span",{className:"hidden sm:inline",children:["Jobs (",n.length,")"]}),(0,va.jsxs)("span",{className:"sm:hidden",children:["J",n.length]})]})]})]}),(0,va.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===x.length?(0,va.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 p-8",children:[(0,va.jsx)(Ma,{className:"w-16 h-16 mb-4 opacity-50"}),(0,va.jsx)("p",{className:"text-lg font-medium",children:"No customers found"}),(0,va.jsx)("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):x.map(e=>{return(0,va.jsxs)("div",{onClick:()=>(e=>{o(e),c(null),A(""),f(""),m(""),v("")})(e),className:"p-4 border-b hover:bg-blue-50 cursor-pointer transition-all ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-blue-100 border-l-4 border-l-blue-600":""),children:[(0,va.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(rs,{className:"w-4 h-4 mr-2 text-gray-500"}),e.name]}),(0,va.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,va.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full border ".concat("lead"===e.type?"bg-green-50 text-green-700 border-green-200":"bg-purple-50 text-purple-700 border-purple-200"),children:e.source}),e.quality&&(0,va.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full border ".concat((t=e.quality,{Hot:"bg-red-100 text-red-800 border-red-300",Warm:"bg-orange-100 text-orange-800 border-orange-300",Cold:"bg-blue-100 text-blue-800 border-blue-300"}[t]||"bg-gray-100 text-gray-800 border-gray-300")),children:e.quality})]})]}),(0,va.jsx)(Ua,{className:"w-5 h-5 text-gray-400 transition-transform ".concat((null===s||void 0===s?void 0:s.id)===e.id?"rotate-90":"")})]}),(0,va.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[e.phone&&(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)(is,{className:"w-3 h-3 mr-2 text-gray-400"}),e.phone]}),e.address&&(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)(ja,{className:"w-3 h-3 mr-2 text-gray-400"}),e.address]})]})]},e.id);var t})})]}),s?(0,va.jsxs)("div",{className:"flex-1 bg-white rounded-lg shadow-sm border overflow-hidden flex flex-col",children:[(0,va.jsxs)("div",{className:"p-6 border-b bg-gradient-to-r from-indigo-50 to-purple-50",children:[(0,va.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:s.name}),(0,va.jsxs)("p",{className:"text-gray-600 flex items-center",children:[(0,va.jsx)(ja,{className:"w-4 h-4 mr-2"}),s.address]})]}),(0,va.jsx)("button",{onClick:()=>o(null),className:"p-2 hover:bg-white rounded-lg transition-colors",children:(0,va.jsx)(Ta,{className:"w-5 h-5 text-gray-500"})})]}),(0,va.jsxs)("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[(0,va.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-blue-100 shadow-sm",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)(as,{className:"w-5 h-5 text-blue-600"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalCalls})]}),(0,va.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Calls"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-green-100 shadow-sm",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)(ss,{className:"w-5 h-5 text-green-600"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalSMS})]}),(0,va.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"SMS"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-purple-100 shadow-sm",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)(os,{className:"w-5 h-5 text-purple-600"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:_.totalEmails})]}),(0,va.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Emails"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-orange-100 shadow-sm",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)(_a,{className:"w-5 h-5 text-orange-600"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:w.length})]}),(0,va.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Total"})]})]}),s.notes&&(0,va.jsx)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:(0,va.jsxs)("div",{className:"flex items-start",children:[(0,va.jsx)(ls,{className:"w-4 h-4 mr-2 text-gray-500 mt-0.5"}),(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Notes"}),(0,va.jsx)("p",{className:"text-sm text-gray-600",children:s.notes})]})]})})]}),(0,va.jsx)("div",{className:"p-3 lg:p-4 border-b bg-gray-50",children:(0,va.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2 lg:gap-3",children:[(0,va.jsxs)("button",{onClick:()=>C("call"),disabled:!s.phone,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("call"===l?"bg-blue-600 text-white shadow-lg scale-105 ring-2 ring-blue-300":"bg-white text-gray-700 border-2 border-blue-200 hover:border-blue-400 hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,va.jsx)(as,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,va.jsx)("span",{children:"\ud83d\udcde Call"})]}),(0,va.jsxs)("button",{onClick:()=>C("sms"),disabled:!s.phone,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("sms"===l?"bg-green-600 text-white shadow-lg scale-105 ring-2 ring-green-300":"bg-white text-gray-700 border-2 border-green-200 hover:border-green-400 hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,va.jsx)(X,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,va.jsx)("span",{children:"\ud83d\udcac SMS"})]}),(0,va.jsxs)("button",{onClick:()=>C("email"),disabled:!s.email,className:"py-2 lg:py-3 px-2 lg:px-4 rounded-lg text-xs lg:text-sm font-medium transition-all flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 shadow-sm ".concat("email"===l?"bg-purple-600 text-white shadow-lg scale-105 ring-2 ring-purple-300":"bg-white text-gray-700 border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50 disabled:opacity-50 disabled:cursor-not-allowed"),children:[(0,va.jsx)(os,{className:"w-4 h-4 lg:w-5 lg:h-5"}),(0,va.jsx)("span",{children:"\u2709\ufe0f Email"})]})]})}),l&&(0,va.jsxs)("div",{className:"p-3 lg:p-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:["sms"===l&&(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("h3",{className:"text-sm lg:text-base font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(X,{className:"w-4 h-4 lg:w-5 lg:h-5 mr-2 text-green-600"}),"\ud83d\udcac Log SMS Communication"]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Select Quick Outcome ",(0,va.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,va.jsx)("div",{className:"grid grid-cols-2 gap-2",children:S.map(e=>{const t=e.icon,n=y===e.id,r={green:n?"bg-green-600 text-white ring-2 ring-green-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-green-200 hover:border-green-400 hover:bg-green-50",teal:n?"bg-teal-600 text-white ring-2 ring-teal-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-teal-200 hover:border-teal-400 hover:bg-teal-50",orange:n?"bg-orange-600 text-white ring-2 ring-orange-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-orange-200 hover:border-orange-400 hover:bg-orange-50",red:n?"bg-red-600 text-white ring-2 ring-red-300 shadow-lg scale-105":"bg-white text-gray-700 border-2 border-red-200 hover:border-red-400 hover:bg-red-50"},i={sent:"\ud83d\udce4",received:"\ud83d\udce5","follow-up":"\ud83d\udcc5","not-interested":"\ud83d\udeab"};return(0,va.jsxs)("button",{onClick:()=>v(e.id),className:"py-3 px-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ".concat(r[e.color]),children:[(0,va.jsx)(t,{className:"w-4 h-4"}),(0,va.jsxs)("span",{className:"hidden lg:inline",children:[i[e.id]," ",e.label]}),(0,va.jsx)("span",{className:"lg:hidden",children:i[e.id]})]},e.id)})})]}),(0,va.jsxs)("div",{children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Message Content ",(0,va.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,va.jsx)("textarea",{value:d,onChange:e=>A(e.target.value),placeholder:"Enter the SMS message content or notes...",className:"w-full p-3 text-sm lg:text-base border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",rows:"4"})]}),(0,va.jsxs)("button",{onClick:()=>{if(!d.trim()||!y)return;const e=s.phone.replace(/\D/g,"");console.log({customerId:s.id,type:"sms",outcome:y,notes:d,timestamp:(new Date).toISOString()}),"sent"===y&&window.open("https://voice.google.com/u/0/messages?itemId=t.%2B1".concat(e),"_blank"),A(""),v(""),c(null)},disabled:!d.trim()||!y,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 text-sm lg:text-base rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2",children:[(0,va.jsx)(cs,{className:"w-5 h-5"}),"sent"===y?"\u2713 Log & Open Google Voice":"\u2713 Log SMS Communication"]}),(!d.trim()||!y)&&(0,va.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Please select an outcome and enter message content"})]}),"email"===l&&(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("h3",{className:"text-sm lg:text-base font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(os,{className:"w-4 h-4 lg:w-5 lg:h-5 mr-2 text-purple-600"}),"\u2709\ufe0f Compose Email"]}),(0,va.jsx)("div",{children:(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["To: ",(0,va.jsx)("span",{className:"text-blue-600 font-semibold",children:s.email})]})}),(0,va.jsxs)("div",{children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Subject ",(0,va.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,va.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"Enter email subject...",className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),(0,va.jsxs)("div",{children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Message ",(0,va.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,va.jsx)("textarea",{value:g,onChange:e=>m(e.target.value),placeholder:"Enter email message...",className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",rows:"5"})]}),(0,va.jsxs)("button",{onClick:()=>{if(!p.trim()||!g.trim())return;const e="mailto:".concat(s.email,"?subject=").concat(encodeURIComponent(p),"&body=").concat(encodeURIComponent(g));window.location.href=e,f(""),m("")},disabled:!p.trim()||!g.trim(),className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2",children:[(0,va.jsx)(us,{className:"w-5 h-5"}),"\ud83d\udce7 Open Email Client"]})]}),"call"===l&&(0,va.jsxs)("div",{className:"text-center py-8 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg border-2 border-blue-200",children:[(0,va.jsxs)("div",{className:"relative inline-block mb-4",children:[(0,va.jsx)(as,{className:"w-16 h-16 text-blue-600 animate-pulse"}),(0,va.jsx)("div",{className:"absolute -top-2 -right-2 bg-green-500 rounded-full p-2",children:(0,va.jsx)("span",{className:"text-white text-xl",children:"\ud83d\udcde"})})]}),(0,va.jsx)("p",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Google Voice Call Window Opened"}),(0,va.jsx)("p",{className:"text-blue-600 font-medium text-lg mb-1",children:s.phone}),(0,va.jsx)("p",{className:"text-sm text-gray-600",children:s.name}),(0,va.jsx)("div",{className:"mt-4 pt-4 border-t border-blue-200",children:(0,va.jsx)("p",{className:"text-xs text-gray-500",children:"Complete the call in the Google Voice window"})})]})]}),(0,va.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(hs,{className:"w-5 h-5 mr-2 text-gray-600"}),"\ud83d\udcdc Communication History"]}),w.length>0&&(0,va.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold",children:[w.length," interaction",1!==w.length?"s":""]})]}),0===w.length?(0,va.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 bg-gradient-to-br from-gray-50 to-blue-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,va.jsxs)("div",{className:"relative",children:[(0,va.jsx)(ds,{className:"w-20 h-20 mb-4 opacity-30"}),(0,va.jsx)("div",{className:"absolute -bottom-1 -right-1 text-4xl",children:"\ud83d\udcac"})]}),(0,va.jsx)("p",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No communication history yet"}),(0,va.jsx)("p",{className:"text-sm text-gray-500",children:"Start by making a call, sending an SMS, or email"})]}):(0,va.jsx)("div",{className:"space-y-3",children:w.map((e,t)=>{var n;const r={sent:{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",icon:"\ud83d\udce4"},received:{bg:"bg-teal-50",border:"border-teal-200",text:"text-teal-700",icon:"\ud83d\udce5"},"follow-up":{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-700",icon:"\ud83d\udcc5"},"not-interested":{bg:"bg-red-50",border:"border-red-200",text:"text-red-700",icon:"\ud83d\udeab"},Completed:{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",icon:"\u2705"},"No Answer":{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-700",icon:"\ud83d\udcf5"}},i={call:{icon:as,color:"text-blue-600",emoji:"\ud83d\udcde",bg:"bg-blue-50"},sms:{icon:ss,color:"text-green-600",emoji:"\ud83d\udcac",bg:"bg-green-50"},email:{icon:os,color:"text-purple-600",emoji:"\u2709\ufe0f",bg:"bg-purple-50"}},a=(null===(n=i[e.type])||void 0===n?void 0:n.icon)||ss,s=i[e.type]||i.sms;return(0,va.jsxs)("div",{className:"".concat(s.bg," border-2 ").concat(e.outcome&&r[e.outcome]?r[e.outcome].border:"border-gray-200"," rounded-xl p-4 hover:shadow-lg transition-all hover:scale-[1.02]"),children:[(0,va.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2",children:[(0,va.jsx)("div",{className:"p-2 ".concat(s.bg," rounded-lg border border-gray-200"),children:(0,va.jsx)(a,{className:"w-5 h-5 ".concat(s.color)})}),(0,va.jsxs)("div",{children:[(0,va.jsxs)("span",{className:"font-semibold text-gray-900 capitalize flex items-center gap-1",children:[s.emoji," ",e.type]}),e.outcome&&r[e.outcome]&&(0,va.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full inline-flex items-center gap-1 mt-1 ".concat(r[e.outcome].bg," ").concat(r[e.outcome].text," border ").concat(r[e.outcome].border," font-medium"),children:[r[e.outcome].icon," ",e.outcome]})]})]}),(0,va.jsxs)("div",{className:"flex items-center text-xs text-gray-600 bg-white px-2 py-1 rounded-full border border-gray-200",children:[(0,va.jsx)(te,{className:"w-3 h-3 mr-1"}),new Date(e.timestamp).toLocaleDateString()," ",new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.notes&&(0,va.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mt-2",children:(0,va.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:e.notes})})]},t)})})]})]}):(0,va.jsx)("div",{className:"flex-1 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-lg shadow-sm border-2 border-dashed border-gray-300 flex items-center justify-center",children:(0,va.jsxs)("div",{className:"text-center text-gray-500 p-8 max-w-md",children:[(0,va.jsxs)("div",{className:"relative inline-block mb-6",children:[(0,va.jsx)(X,{className:"w-32 h-32 opacity-20"}),(0,va.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl",children:"\ud83d\udcac"})]}),(0,va.jsx)("h3",{className:"text-2xl font-bold mb-3 text-gray-700",children:"\ud83d\udc4b Select a Customer"}),(0,va.jsx)("p",{className:"text-lg text-gray-600 mb-4",children:"Choose a customer from the list to:"}),(0,va.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-left bg-white rounded-lg p-4 border border-gray-200 shadow-sm",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,va.jsx)("span",{className:"text-blue-500",children:"\ud83d\udcde"}),(0,va.jsx)("span",{className:"text-gray-700",children:"Make phone calls via Google Voice"})]}),(0,va.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,va.jsx)("span",{className:"text-green-500",children:"\ud83d\udcac"}),(0,va.jsx)("span",{className:"text-gray-700",children:"Send and log SMS messages"})]}),(0,va.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,va.jsx)("span",{className:"text-purple-500",children:"\u2709\ufe0f"}),(0,va.jsx)("span",{className:"text-gray-700",children:"Compose and send emails"})]}),(0,va.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,va.jsx)("span",{className:"text-orange-500",children:"\ud83d\udcdc"}),(0,va.jsx)("span",{className:"text-gray-700",children:"View communication history"})]})]})]})})]})}const ps="180",fs={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},gs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ms=0,ys=1,vs=2,bs=3,xs=0,ws=1,_s=2,Ss=3,Cs=0,Es=1,Ns=2,ks=0,Is=1,Ts=2,Bs=3,Ms=4,Fs=5,Rs=100,Ls=101,Ps=102,Us=103,Ds=104,Os=200,js=201,zs=202,Hs=203,Qs=204,Vs=205,Gs=206,Ws=207,qs=208,Ks=209,Xs=210,Ys=211,Js=212,Zs=213,$s=214,eo=0,to=1,no=2,ro=3,io=4,ao=5,so=6,oo=7,lo=0,co=1,uo=2,ho=0,Ao=1,po=2,fo=3,go=4,mo=5,yo=6,vo=7,bo="attached",xo="detached",wo=300,_o=301,So=302,Co=303,Eo=304,No=306,ko=1e3,Io=1001,To=1002,Bo=1003,Mo=1004,Fo=1004,Ro=1005,Lo=1005,Po=1006,Uo=1007,Do=1007,Oo=1008,jo=1008,zo=1009,Ho=1010,Qo=1011,Vo=1012,Go=1013,Wo=1014,qo=1015,Ko=1016,Xo=1017,Yo=1018,Jo=1020,Zo=35902,$o=35899,el=1021,tl=1022,nl=1023,rl=1026,il=1027,al=1028,sl=1029,ol=1030,ll=1031,cl=1032,ul=1033,hl=33776,dl=33777,Al=33778,pl=33779,fl=35840,gl=35841,ml=35842,yl=35843,vl=36196,bl=37492,xl=37496,wl=37808,_l=37809,Sl=37810,Cl=37811,El=37812,Nl=37813,kl=37814,Il=37815,Tl=37816,Bl=37817,Ml=37818,Fl=37819,Rl=37820,Ll=37821,Pl=36492,Ul=36494,Dl=36495,Ol=36283,jl=36284,zl=36285,Hl=36286,Ql=2200,Vl=2201,Gl=2202,Wl=2300,ql=2301,Kl=2302,Xl=2400,Yl=2401,Jl=2402,Zl=2500,$l=2501,ec=0,tc=1,nc=2,rc=3200,ic=3201,ac=3202,sc=3203,oc=0,lc=1,cc="",uc="srgb",hc="srgb-linear",dc="linear",Ac="srgb",pc=0,fc=7680,gc=7681,mc=7682,yc=7683,vc=34055,bc=34056,xc=5386,wc=512,_c=513,Sc=514,Cc=515,Ec=516,Nc=517,kc=518,Ic=519,Tc=512,Bc=513,Mc=514,Fc=515,Rc=516,Lc=517,Pc=518,Uc=519,Dc=35044,Oc=35048,jc=35040,zc=35045,Hc=35049,Qc=35041,Vc=35046,Gc=35050,Wc=35042,qc="100",Kc="300 es",Xc=2e3,Yc=2001,Jc={COMPUTE:"compute",RENDER:"render"},Zc={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},$c={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class eu{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}}const tu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let nu=1234567;const ru=Math.PI/180,iu=180/Math.PI;function au(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(tu[255&e]+tu[e>>8&255]+tu[e>>16&255]+tu[e>>24&255]+"-"+tu[255&t]+tu[t>>8&255]+"-"+tu[t>>16&15|64]+tu[t>>24&255]+"-"+tu[63&n|128]+tu[n>>8&255]+"-"+tu[n>>16&255]+tu[n>>24&255]+tu[255&r]+tu[r>>8&255]+tu[r>>16&255]+tu[r>>24&255]).toLowerCase()}function su(e,t,n){return Math.max(t,Math.min(n,e))}function ou(e,t){return(e%t+t)%t}function lu(e,t,n){return(1-n)*e+n*t}function cu(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function uu(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const hu={DEG2RAD:ru,RAD2DEG:iu,generateUUID:au,clamp:su,euclideanModulo:ou,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:lu,damp:function(e,t,n,r){return lu(e,t,1-Math.exp(-n*r))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(ou(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(nu=e);let t=nu+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*ru},radToDeg:function(e){return e*iu},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,s=Math.sin,o=a(n/2),l=s(n/2),c=a((t+r)/2),u=s((t+r)/2),h=a((t-r)/2),d=s((t-r)/2),A=a((r-t)/2),p=s((r-t)/2);switch(i){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*p,l*A,o*c);break;case"YXY":e.set(l*A,o*u,l*p,o*c);break;case"ZYZ":e.set(l*p,l*A,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:uu,denormalize:cu};class du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;du.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=su(this.x,e.x,t.x),this.y=su(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=su(this.x,e,t),this.y=su(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(su(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(su(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Au{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,s){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[a+0],d=i[a+1],A=i[a+2],p=i[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=A,void(e[t+3]=p);if(u!==p||o!==h||l!==d||c!==A){let e=1-s;const t=o*h+l*d+c*A+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,s=Math.sin(s*a)/i}const i=s*n;if(o=o*e+h*i,l=l*e+d*i,c=c*e+A*i,u=u*e+p*i,e===1-s){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const s=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[a],h=i[a+1],d=i[a+2],A=i[a+3];return e[t]=s*A+c*u+o*d-l*h,e[t+1]=o*A+c*h+l*u-s*d,e[t+2]=l*A+c*d+s*h-o*u,e[t+3]=c*A-s*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,r=e._y,i=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),h=o(n/2),d=o(r/2),A=o(i/2);switch(a){case"XYZ":this._x=h*c*u+l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u-h*d*A;break;case"YXZ":this._x=h*c*u+l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u+h*d*A;break;case"ZXY":this._x=h*c*u-l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u-h*d*A;break;case"ZYX":this._x=h*c*u-l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u+h*d*A;break;case"YZX":this._x=h*c*u+l*d*A,this._y=l*d*u+h*c*A,this._z=l*c*A-h*d*u,this._w=l*c*u-h*d*A;break;case"XZY":this._x=h*c*u-l*d*A,this._y=l*d*u-h*c*A,this._z=l*c*A+h*d*u,this._w=l*c*u+h*d*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(su(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+r*l-i*o,this._y=r*c+a*o+i*s-n*l,this._z=i*c+a*l+n*o-r*s,this._w=a*c-n*s-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let s=a*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;pu.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(gu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(gu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*r-s*n),c=2*(s*t-i*r),u=2*(i*n-a*t);return this.x=t+o*l+a*u-s*c,this.y=n+o*c+s*l-i*u,this.z=r+o*u+i*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=su(this.x,e.x,t.x),this.y=su(this.y,e.y,t.y),this.z=su(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=su(this.x,e,t),this.y=su(this.y,e,t),this.z=su(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(su(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=r*o-i*s,this.y=i*a-n*o,this.z=n*s-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return fu.copy(this).projectOnVector(e),this.sub(fu)}reflect(e){return this.sub(fu.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(su(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const fu=new pu,gu=new Au;class mu{constructor(e,t,n,r,i,a,s,o,l){mu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l)}set(e,t,n,r,i,a,s,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],A=n[8],p=r[0],f=r[3],g=r[6],m=r[1],y=r[4],v=r[7],b=r[2],x=r[5],w=r[8];return i[0]=a*p+s*m+o*b,i[3]=a*f+s*y+o*x,i[6]=a*g+s*v+o*w,i[1]=l*p+c*m+u*b,i[4]=l*f+c*y+u*x,i[7]=l*g+c*v+u*w,i[2]=h*p+d*m+A*b,i[5]=h*f+d*y+A*x,i[8]=h*g+d*v+A*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-n*i*c+n*s*o+r*i*l-r*a*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=c*a-s*l,h=s*o-c*i,d=l*i-a*o,A=t*u+n*h+r*d;if(0===A)return this.set(0,0,0,0,0,0,0,0,0);const p=1/A;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(s*n-r*a)*p,e[3]=h*p,e[4]=(c*t-r*o)*p,e[5]=(r*i-s*t)*p,e[6]=d*p,e[7]=(n*o-l*t)*p,e[8]=(a*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,s){const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-r*l,r*o,-r*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(yu.makeScale(e,t)),this}rotate(e){return this.premultiply(yu.makeRotation(-e)),this}translate(e,t){return this.premultiply(yu.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const yu=new mu;function vu(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const bu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function xu(e,t){return new bu[e](t)}function wu(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function _u(){const e=wu("canvas");return e.style.display="block",e}const Su={};function Cu(e){e in Su||(Su[e]=!0,console.warn(e))}const Eu=(new mu).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Nu=(new mu).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ku(){const e={enabled:!0,workingColorSpace:hc,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===Ac&&(e.r=Tu(e.r),e.g=Tu(e.g),e.b=Tu(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Ac&&(e.r=Bu(e.r),e.g=Bu(e.g),e.b=Bu(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===cc?dc:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Cu("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Cu("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[hc]:{primaries:t,whitePoint:r,transfer:dc,toXYZ:Eu,fromXYZ:Nu,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:uc},outputColorSpaceConfig:{drawingBufferColorSpace:uc}},[uc]:{primaries:t,whitePoint:r,transfer:Ac,toXYZ:Eu,fromXYZ:Nu,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:uc}}}),e}const Iu=ku();function Tu(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Bu(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Mu;class Fu{static getDataURL(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Mu&&(Mu=wu("canvas")),Mu.width=e.width,Mu.height=e.height;const n=Mu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Mu}return t.toDataURL(n)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=wu("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Tu(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Tu(t[e]/255)):t[e]=Tu(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Ru=0;class Lu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Ru++}),this.uuid=au(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Pu(r[t].image)):e.push(Pu(r[t]))}else e=Pu(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Pu(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Fu.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Uu=0;const Du=new pu;class Ou extends eu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ou.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ou.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Io,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Io,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Po,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Oo,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:nl,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:zo,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Ou.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:cc;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Uu++}),this.uuid=au(),this.name="",this.source=new Lu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new du(0,0),this.repeat=new du(1,1),this.center=new du(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Du).x}get height(){return this.source.getSize(Du).y}get depth(){return this.source.getSize(Du).z}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Texture.setValues(): parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n:console.warn("THREE.Texture.setValues(): property '".concat(t,"' does not exist."))}}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wo)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ko:e.x=e.x-Math.floor(e.x);break;case Io:e.x=e.x<0?0:1;break;case To:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ko:e.y=e.y-Math.floor(e.y);break;case Io:e.y=e.y<0?0:1;break;case To:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Ou.DEFAULT_IMAGE=null,Ou.DEFAULT_MAPPING=wo,Ou.DEFAULT_ANISOTROPY=1;class ju{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ju.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,s=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],A=o[9],p=o[2],f=o[6],g=o[10];if(Math.abs(c-h)<a&&Math.abs(u-p)<a&&Math.abs(A-f)<a){if(Math.abs(c+h)<s&&Math.abs(u+p)<s&&Math.abs(A+f)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,m=(g+1)/2,y=(c+h)/4,v=(u+p)/4,b=(A+f)/4;return e>o&&e>m?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=v/n):o>m?o<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=y/r,i=b/r):m<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=b/i),this.set(n,r,i,t),this}let m=Math.sqrt((f-A)*(f-A)+(u-p)*(u-p)+(h-c)*(h-c));return Math.abs(m)<.001&&(m=1),this.x=(f-A)/m,this.y=(u-p)/m,this.z=(h-c)/m,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=su(this.x,e.x,t.x),this.y=su(this.y,e.y,t.y),this.z=su(this.z,e.z,t.z),this.w=su(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=su(this.x,e,t),this.y=su(this.y,e,t),this.z=su(this.z,e,t),this.w=su(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(su(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class zu extends eu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Po,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new ju(0,0,e,t),this.scissorTest=!1,this.viewport=new ju(0,0,e,t);const r={width:e,height:t,depth:n.depth},i=new Ou(r);this.textures=[];const a=n.count;for(let s=0;s<a;s++)this.textures[s]=i.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={minFilter:Po,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(t)}}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new Lu(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Hu extends zu{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Qu extends Ou{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=Io,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Vu extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Qu(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Gu extends Ou{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=Io,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Wu extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Gu(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class qu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Xu.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Xu.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Xu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Xu):Xu.fromBufferAttribute(r,t),Xu.applyMatrix4(e.matrixWorld),this.expandByPoint(Xu);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Yu.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Yu.copy(n.boundingBox)),Yu.applyMatrix4(e.matrixWorld),this.union(Yu)}const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Xu),Xu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(rh),ih.subVectors(this.max,rh),Ju.subVectors(e.a,rh),Zu.subVectors(e.b,rh),$u.subVectors(e.c,rh),eh.subVectors(Zu,Ju),th.subVectors($u,Zu),nh.subVectors(Ju,$u);let t=[0,-eh.z,eh.y,0,-th.z,th.y,0,-nh.z,nh.y,eh.z,0,-eh.x,th.z,0,-th.x,nh.z,0,-nh.x,-eh.y,eh.x,0,-th.y,th.x,0,-nh.y,nh.x,0];return!!oh(t,Ju,Zu,$u,ih)&&(t=[1,0,0,0,1,0,0,0,1],!!oh(t,Ju,Zu,$u,ih)&&(ah.crossVectors(eh,th),t=[ah.x,ah.y,ah.z],oh(t,Ju,Zu,$u,ih)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Xu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Xu).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ku[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ku[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ku[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ku[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ku[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ku[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ku[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ku[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ku)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ku=[new pu,new pu,new pu,new pu,new pu,new pu,new pu,new pu],Xu=new pu,Yu=new qu,Ju=new pu,Zu=new pu,$u=new pu,eh=new pu,th=new pu,nh=new pu,rh=new pu,ih=new pu,ah=new pu,sh=new pu;function oh(e,t,n,r,i){for(let a=0,s=e.length-3;a<=s;a+=3){sh.fromArray(e,a);const s=i.x*Math.abs(sh.x)+i.y*Math.abs(sh.y)+i.z*Math.abs(sh.z),o=t.dot(sh),l=n.dot(sh),c=r.dot(sh);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}const lh=new qu,ch=new pu,uh=new pu;class hh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):lh.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ch.subVectors(e,this.center);const t=ch.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(ch,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(uh.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ch.copy(e.center).add(uh)),this.expandByPoint(ch.copy(e.center).sub(uh))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const dh=new pu,Ah=new pu,ph=new pu,fh=new pu,gh=new pu,mh=new pu,yh=new pu;class vh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dh.copy(this.origin).addScaledVector(this.direction,t),dh.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Ah.copy(e).add(t).multiplyScalar(.5),ph.copy(t).sub(e).normalize(),fh.copy(this.origin).sub(Ah);const i=.5*e.distanceTo(t),a=-this.direction.dot(ph),s=fh.dot(this.direction),o=-fh.dot(ph),l=fh.lengthSq(),c=Math.abs(1-a*a);let u,h,d,A;if(c>0)if(u=a*o-s,h=a*s-o,A=i*c,u>=0)if(h>=-A)if(h<=A){const e=1/c;u*=e,h*=e,d=u*(u+a*h+2*s)+h*(a*u+h+2*o)+l}else h=i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h=-i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h<=-A?(u=Math.max(0,-(-a*i+s)),h=u>0?-i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l):h<=A?(u=0,h=Math.min(Math.max(-i,-o),i),d=h*(h+2*o)+l):(u=Math.max(0,-(a*i+s)),h=u>0?i:Math.min(Math.max(-i,-o),i),d=-u*u+h*(h+2*o)+l);else h=a>0?-i:i,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(Ah).addScaledVector(ph,h),d}intersectSphere(e,t){dh.subVectors(e.center,this.origin);const n=dh.dot(this.direction),r=dh.dot(dh)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),s=n-a,o=n+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,s,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(s=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||s>r?null:((s>n||n!==n)&&(n=s),(o<r||r!==r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,dh)}intersectTriangle(e,t,n,r,i){gh.subVectors(t,e),mh.subVectors(n,e),yh.crossVectors(gh,mh);let a,s=this.direction.dot(yh);if(s>0){if(r)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}fh.subVectors(this.origin,e);const o=a*this.direction.dot(mh.crossVectors(fh,mh));if(o<0)return null;const l=a*this.direction.dot(gh.cross(fh));if(l<0)return null;if(o+l>s)return null;const c=-a*fh.dot(yh);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class bh{constructor(e,t,n,r,i,a,s,o,l,c,u,h,d,A,p,f){bh.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l,c,u,h,d,A,p,f)}set(e,t,n,r,i,a,s,o,l,c,u,h,d,A,p,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=A,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bh).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/xh.setFromMatrixColumn(e,0).length(),i=1/xh.setFromMatrixColumn(e,1).length(),a=1/xh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*o}else if("YXZ"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=a*o}else if("ZXY"===e.order){const e=o*c,n=o*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-a*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=a*c,t[9]=i-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){const e=a*c,n=a*u,r=s*c,i=s*u;t[0]=o*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_h,e,Sh)}lookAt(e,t,n){const r=this.elements;return Nh.subVectors(e,t),0===Nh.lengthSq()&&(Nh.z=1),Nh.normalize(),Ch.crossVectors(n,Nh),0===Ch.lengthSq()&&(1===Math.abs(n.z)?Nh.x+=1e-4:Nh.z+=1e-4,Nh.normalize(),Ch.crossVectors(n,Nh)),Ch.normalize(),Eh.crossVectors(Nh,Ch),r[0]=Ch.x,r[4]=Eh.x,r[8]=Nh.x,r[1]=Ch.y,r[5]=Eh.y,r[9]=Nh.y,r[2]=Ch.z,r[6]=Eh.z,r[10]=Nh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],A=n[2],p=n[6],f=n[10],g=n[14],m=n[3],y=n[7],v=n[11],b=n[15],x=r[0],w=r[4],_=r[8],S=r[12],C=r[1],E=r[5],N=r[9],k=r[13],I=r[2],T=r[6],B=r[10],M=r[14],F=r[3],R=r[7],L=r[11],P=r[15];return i[0]=a*x+s*C+o*I+l*F,i[4]=a*w+s*E+o*T+l*R,i[8]=a*_+s*N+o*B+l*L,i[12]=a*S+s*k+o*M+l*P,i[1]=c*x+u*C+h*I+d*F,i[5]=c*w+u*E+h*T+d*R,i[9]=c*_+u*N+h*B+d*L,i[13]=c*S+u*k+h*M+d*P,i[2]=A*x+p*C+f*I+g*F,i[6]=A*w+p*E+f*T+g*R,i[10]=A*_+p*N+f*B+g*L,i[14]=A*S+p*k+f*M+g*P,i[3]=m*x+y*C+v*I+b*F,i[7]=m*w+y*E+v*T+b*R,i[11]=m*_+y*N+v*B+b*L,i[15]=m*S+y*k+v*M+b*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*o*u-r*l*u-i*s*h+n*l*h+r*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+i*a*h-r*a*d+r*l*c-i*o*c)+e[11]*(+t*l*u-t*s*d-i*a*u+n*a*d+i*s*c-n*l*c)+e[15]*(-r*s*c-t*o*u+t*s*h+r*a*u-n*a*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],A=e[12],p=e[13],f=e[14],g=e[15],m=u*f*l-p*h*l+p*o*d-s*f*d-u*o*g+s*h*g,y=A*h*l-c*f*l-A*o*d+a*f*d+c*o*g-a*h*g,v=c*p*l-A*u*l+A*s*d-a*p*d-c*s*g+a*u*g,b=A*u*o-c*p*o-A*s*h+a*p*h+c*s*f-a*u*f,x=t*m+n*y+r*v+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=m*w,e[1]=(p*h*i-u*f*i-p*r*d+n*f*d+u*r*g-n*h*g)*w,e[2]=(s*f*i-p*o*i+p*r*l-n*f*l-s*r*g+n*o*g)*w,e[3]=(u*o*i-s*h*i-u*r*l+n*h*l+s*r*d-n*o*d)*w,e[4]=y*w,e[5]=(c*f*i-A*h*i+A*r*d-t*f*d-c*r*g+t*h*g)*w,e[6]=(A*o*i-a*f*i-A*r*l+t*f*l+a*r*g-t*o*g)*w,e[7]=(a*h*i-c*o*i+c*r*l-t*h*l-a*r*d+t*o*d)*w,e[8]=v*w,e[9]=(A*u*i-c*p*i-A*n*d+t*p*d+c*n*g-t*u*g)*w,e[10]=(a*p*i-A*s*i+A*n*l-t*p*l-a*n*g+t*s*g)*w,e[11]=(c*s*i-a*u*i-c*n*l+t*u*l+a*n*d-t*s*d)*w,e[12]=b*w,e[13]=(c*p*r-A*u*r+A*n*h-t*p*h-c*n*f+t*u*f)*w,e[14]=(A*s*r-a*p*r-A*n*o+t*p*o+a*n*f-t*s*f)*w,e[15]=(a*u*r-c*s*r+c*n*o-t*u*o-a*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,s=e.y,o=e.z,l=i*a,c=i*s;return this.set(l*a+n,l*s-r*o,l*o+r*s,0,l*s+r*o,c*s+n,c*o-r*a,0,l*o-r*s,c*o+r*a,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,l=i+i,c=a+a,u=s+s,h=i*l,d=i*c,A=i*u,p=a*c,f=a*u,g=s*u,m=o*l,y=o*c,v=o*u,b=n.x,x=n.y,w=n.z;return r[0]=(1-(p+g))*b,r[1]=(d+v)*b,r[2]=(A-y)*b,r[3]=0,r[4]=(d-v)*x,r[5]=(1-(h+g))*x,r[6]=(f+m)*x,r[7]=0,r[8]=(A+y)*w,r[9]=(f-m)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=xh.set(r[0],r[1],r[2]).length();const a=xh.set(r[4],r[5],r[6]).length(),s=xh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],wh.copy(this);const o=1/i,l=1/a,c=1/s;return wh.elements[0]*=o,wh.elements[1]*=o,wh.elements[2]*=o,wh.elements[4]*=l,wh.elements[5]*=l,wh.elements[6]*=l,wh.elements[8]*=c,wh.elements[9]*=c,wh.elements[10]*=c,t.setFromRotationMatrix(wh),n.x=i,n.y=a,n.z=s,this}makePerspective(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Xc,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*i/(t-e),u=2*i/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let A,p;if(o)A=i/(a-i),p=a*i/(a-i);else if(s===Xc)A=-(a+i)/(a-i),p=-2*a*i/(a-i);else{if(s!==Yc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);A=-a/(a-i),p=-a*i/(a-i)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=A,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Xc,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(t-e),u=2/(n-r),h=-(t+e)/(t-e),d=-(n+r)/(n-r);let A,p;if(o)A=1/(a-i),p=a/(a-i);else if(s===Xc)A=-2/(a-i),p=-(a+i)/(a-i);else{if(s!==Yc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);A=-1/(a-i),p=-i/(a-i)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=A,l[14]=p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const xh=new pu,wh=new bh,_h=new pu(0,0,0),Sh=new pu(1,1,1),Ch=new pu,Eh=new pu,Nh=new pu,kh=new bh,Ih=new Au;class Th{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Th.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,i=r[0],a=r[4],s=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(su(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-su(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(su(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-su(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(su(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-su(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return kh.makeRotationFromQuaternion(e),this.setFromRotationMatrix(kh,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Ih.setFromEuler(this),this.setFromQuaternion(Ih,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Th.DEFAULT_ORDER="XYZ";class Bh{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Mh=0;const Fh=new pu,Rh=new Au,Lh=new bh,Ph=new pu,Uh=new pu,Dh=new pu,Oh=new Au,jh=new pu(1,0,0),zh=new pu(0,1,0),Hh=new pu(0,0,1),Qh={type:"added"},Vh={type:"removed"},Gh={type:"childadded",child:null},Wh={type:"childremoved",child:null};class qh extends eu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Mh++}),this.uuid=au(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qh.DEFAULT_UP.clone();const e=new pu,t=new Th,n=new Au,r=new pu(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new bh},normalMatrix:{value:new mu}}),this.matrix=new bh,this.matrixWorld=new bh,this.matrixAutoUpdate=qh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=qh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Bh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Rh.setFromAxisAngle(e,t),this.quaternion.multiply(Rh),this}rotateOnWorldAxis(e,t){return Rh.setFromAxisAngle(e,t),this.quaternion.premultiply(Rh),this}rotateX(e){return this.rotateOnAxis(jh,e)}rotateY(e){return this.rotateOnAxis(zh,e)}rotateZ(e){return this.rotateOnAxis(Hh,e)}translateOnAxis(e,t){return Fh.copy(e).applyQuaternion(this.quaternion),this.position.add(Fh.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(jh,e)}translateY(e){return this.translateOnAxis(zh,e)}translateZ(e){return this.translateOnAxis(Hh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Lh.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ph.copy(e):Ph.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Uh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lh.lookAt(Uh,Ph,this.up):Lh.lookAt(Ph,Uh,this.up),this.quaternion.setFromRotationMatrix(Lh),r&&(Lh.extractRotation(r.matrixWorld),Rh.setFromRotationMatrix(Lh),this.quaternion.premultiply(Rh.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Qh),Gh.child=e,this.dispatchEvent(Gh),Gh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Vh),Wh.child=e,this.dispatchEvent(Wh),Wh.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Lh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Lh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Qh),Gh.child=e,this.dispatchEvent(Gh),Gh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uh,e,Dh),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uh,Oh,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(e=>M(M({},e),{},{boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(e=>M({},e)),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}qh.DEFAULT_UP=new pu(0,1,0),qh.DEFAULT_MATRIX_AUTO_UPDATE=!0,qh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Kh=new pu,Xh=new pu,Yh=new pu,Jh=new pu,Zh=new pu,$h=new pu,ed=new pu,td=new pu,nd=new pu,rd=new pu,id=new ju,ad=new ju,sd=new ju;class od{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Kh.subVectors(e,t),r.cross(Kh);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Kh.subVectors(r,t),Xh.subVectors(n,t),Yh.subVectors(e,t);const a=Kh.dot(Kh),s=Kh.dot(Xh),o=Kh.dot(Yh),l=Xh.dot(Xh),c=Xh.dot(Yh),u=a*l-s*s;if(0===u)return i.set(0,0,0),null;const h=1/u,d=(l*o-s*c)*h,A=(a*c-s*o)*h;return i.set(1-d-A,A,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,Jh)&&(Jh.x>=0&&Jh.y>=0&&Jh.x+Jh.y<=1)}static getInterpolation(e,t,n,r,i,a,s,o){return null===this.getBarycoord(e,t,n,r,Jh)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(i,Jh.x),o.addScaledVector(a,Jh.y),o.addScaledVector(s,Jh.z),o)}static getInterpolatedAttribute(e,t,n,r,i,a){return id.setScalar(0),ad.setScalar(0),sd.setScalar(0),id.fromBufferAttribute(e,t),ad.fromBufferAttribute(e,n),sd.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(id,i.x),a.addScaledVector(ad,i.y),a.addScaledVector(sd,i.z),a}static isFrontFacing(e,t,n,r){return Kh.subVectors(n,t),Xh.subVectors(e,t),Kh.cross(Xh).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Kh.subVectors(this.c,this.b),Xh.subVectors(this.a,this.b),.5*Kh.cross(Xh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return od.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return od.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return od.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return od.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return od.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,s;Zh.subVectors(r,n),$h.subVectors(i,n),td.subVectors(e,n);const o=Zh.dot(td),l=$h.dot(td);if(o<=0&&l<=0)return t.copy(n);nd.subVectors(e,r);const c=Zh.dot(nd),u=$h.dot(nd);if(c>=0&&u<=c)return t.copy(r);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return a=o/(o-c),t.copy(n).addScaledVector(Zh,a);rd.subVectors(e,i);const d=Zh.dot(rd),A=$h.dot(rd);if(A>=0&&d<=A)return t.copy(i);const p=d*l-o*A;if(p<=0&&l>=0&&A<=0)return s=l/(l-A),t.copy(n).addScaledVector($h,s);const f=c*A-d*u;if(f<=0&&u-c>=0&&d-A>=0)return ed.subVectors(i,r),s=(u-c)/(u-c+(d-A)),t.copy(r).addScaledVector(ed,s);const g=1/(f+p+h);return a=p*g,s=h*g,t.copy(n).addScaledVector(Zh,a).addScaledVector($h,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ld={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cd={h:0,s:0,l:0},ud={h:0,s:0,l:0};function hd(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class dd{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uc;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Iu.colorSpaceToWorking(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Iu.workingColorSpace;return this.r=e,this.g=t,this.b=n,Iu.colorSpaceToWorking(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Iu.workingColorSpace;if(e=ou(e,1),t=su(t,0,1),n=su(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=hd(i,r,e+1/3),this.g=hd(i,r,e),this.b=hd(i,r,e-1/3)}return Iu.colorSpaceToWorking(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uc;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=t[1],s=t[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===i)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uc;const n=ld[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Tu(e.r),this.g=Tu(e.g),this.b=Tu(e.b),this}copyLinearToSRGB(e){return this.r=Bu(e.r),this.g=Bu(e.g),this.b=Bu(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uc;return Iu.workingToColorSpace(Ad.copy(this),e),65536*Math.round(su(255*Ad.r,0,255))+256*Math.round(su(255*Ad.g,0,255))+Math.round(su(255*Ad.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uc;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Iu.workingColorSpace;Iu.workingToColorSpace(Ad.copy(this),t);const n=Ad.r,r=Ad.g,i=Ad.b,a=Math.max(n,r,i),s=Math.min(n,r,i);let o,l;const c=(s+a)/2;if(s===a)o=0,l=0;else{const e=a-s;switch(l=c<=.5?e/(a+s):e/(2-a-s),a){case n:o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Iu.workingColorSpace;return Iu.workingToColorSpace(Ad.copy(this),t),e.r=Ad.r,e.g=Ad.g,e.b=Ad.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uc;Iu.workingToColorSpace(Ad.copy(this),e);const t=Ad.r,n=Ad.g,r=Ad.b;return e!==uc?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(r.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*r),")")}offsetHSL(e,t,n){return this.getHSL(cd),this.setHSL(cd.h+e,cd.s+t,cd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(cd),e.getHSL(ud);const n=lu(cd.h,ud.h,t),r=lu(cd.s,ud.s,t),i=lu(cd.l,ud.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ad=new dd;dd.NAMES=ld;let pd=0;class fd extends eu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:pd++}),this.uuid=au(),this.name="",this.type="Material",this.blending=Is,this.side=Cs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Qs,this.blendDst=Vs,this.blendEquation=Rs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dd(0,0,0),this.blendAlpha=0,this.depthFunc=ro,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ic,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=fc,this.stencilZFail=fc,this.stencilZPass=fc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Is&&(n.blending=this.blending),this.side!==Cs&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Qs&&(n.blendSrc=this.blendSrc),this.blendDst!==Vs&&(n.blendDst=this.blendDst),this.blendEquation!==Rs&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==ro&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Ic&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==fc&&(n.stencilFail=this.stencilFail),this.stencilZFail!==fc&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==fc&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class gd extends fd{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=lo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const md=yd();function yd(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(r[l]=0,r[256|l]=32768,i[l]=24,i[256|l]=24):e<-14?(r[l]=1024>>-e-14,r[256|l]=1024>>-e-14|32768,i[l]=-e-1,i[256|l]=-e-1):e<=15?(r[l]=e+15<<10,r[256|l]=e+15<<10|32768,i[l]=13,i[256|l]=13):e<128?(r[l]=31744,r[256|l]=64512,i[l]=24,i[256|l]=24):(r[l]=31744,r[256|l]=64512,i[l]=13,i[256|l]=13)}const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[l]=e|t}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:s,offsetTable:o}}function vd(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=su(e,-65504,65504),md.floatView[0]=e;const t=md.uint32View[0],n=t>>23&511;return md.baseTable[n]+((8388607&t)>>md.shiftTable[n])}function bd(e){const t=e>>10;return md.uint32View[0]=md.mantissaTable[md.offsetTable[t]+(1023&e)]+md.exponentTable[t],md.floatView[0]}class xd{static toHalfFloat(e){return vd(e)}static fromHalfFloat(e){return bd(e)}}const wd=new pu,_d=new du;let Sd=0;class Cd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Sd++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Dc,this.updateRanges=[],this.gpuType=qo,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)_d.fromBufferAttribute(this,t),_d.applyMatrix3(e),this.setXY(t,_d.x,_d.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)wd.fromBufferAttribute(this,t),wd.applyMatrix3(e),this.setXYZ(t,wd.x,wd.y,wd.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)wd.fromBufferAttribute(this,t),wd.applyMatrix4(e),this.setXYZ(t,wd.x,wd.y,wd.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)wd.fromBufferAttribute(this,t),wd.applyNormalMatrix(e),this.setXYZ(t,wd.x,wd.y,wd.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)wd.fromBufferAttribute(this,t),wd.transformDirection(e),this.setXYZ(t,wd.x,wd.y,wd.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=cu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=uu(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=cu(t,this.array)),t}setX(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=cu(t,this.array)),t}setY(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=cu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=cu(t,this.array)),t}setW(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array),i=uu(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Dc&&(e.usage=this.usage),e}}class Ed extends Cd{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Nd extends Cd{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class kd extends Cd{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Id extends Cd{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Td extends Cd{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Bd extends Cd{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Md extends Cd{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Fd extends Cd{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=bd(this.array[e*this.itemSize]);return this.normalized&&(t=cu(t,this.array)),t}setX(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize]=vd(t),this}getY(e){let t=bd(this.array[e*this.itemSize+1]);return this.normalized&&(t=cu(t,this.array)),t}setY(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+1]=vd(t),this}getZ(e){let t=bd(this.array[e*this.itemSize+2]);return this.normalized&&(t=cu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+2]=vd(t),this}getW(e){let t=bd(this.array[e*this.itemSize+3]);return this.normalized&&(t=cu(t,this.array)),t}setW(e,t){return this.normalized&&(t=uu(t,this.array)),this.array[e*this.itemSize+3]=vd(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array)),this.array[e+0]=vd(t),this.array[e+1]=vd(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array)),this.array[e+0]=vd(t),this.array[e+1]=vd(n),this.array[e+2]=vd(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array),i=uu(i,this.array)),this.array[e+0]=vd(t),this.array[e+1]=vd(n),this.array[e+2]=vd(r),this.array[e+3]=vd(i),this}}class Rd extends Cd{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Ld=0;const Pd=new bh,Ud=new qh,Dd=new pu,Od=new qu,jd=new qu,zd=new pu;class Hd extends eu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ld++}),this.uuid=au(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vu(e)?Md:Td)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new mu).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Pd.makeRotationFromQuaternion(e),this.applyMatrix4(Pd),this}rotateX(e){return Pd.makeRotationX(e),this.applyMatrix4(Pd),this}rotateY(e){return Pd.makeRotationY(e),this.applyMatrix4(Pd),this}rotateZ(e){return Pd.makeRotationZ(e),this.applyMatrix4(Pd),this}translate(e,t,n){return Pd.makeTranslation(e,t,n),this.applyMatrix4(Pd),this}scale(e,t,n){return Pd.makeScale(e,t,n),this.applyMatrix4(Pd),this}lookAt(e){return Ud.lookAt(e),Ud.updateMatrix(),this.applyMatrix4(Ud.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dd).negate(),this.translate(Dd.x,Dd.y,Dd.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Rd(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new pu(-1/0,-1/0,-1/0),new pu(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];Od.setFromBufferAttribute(e),this.morphTargetsRelative?(zd.addVectors(this.boundingBox.min,Od.min),this.boundingBox.expandByPoint(zd),zd.addVectors(this.boundingBox.max,Od.max),this.boundingBox.expandByPoint(zd)):(this.boundingBox.expandByPoint(Od.min),this.boundingBox.expandByPoint(Od.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new pu,1/0);if(e){const n=this.boundingSphere.center;if(Od.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];jd.setFromBufferAttribute(n),this.morphTargetsRelative?(zd.addVectors(Od.min,jd.min),Od.expandByPoint(zd),zd.addVectors(Od.max,jd.max),Od.expandByPoint(zd)):(Od.expandByPoint(jd.min),Od.expandByPoint(jd.max))}Od.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)zd.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(zd));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],s=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)zd.fromBufferAttribute(a,t),s&&(Dd.fromBufferAttribute(e,t),zd.add(Dd)),r=Math.max(r,n.distanceToSquared(zd))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Cd(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),s=[],o=[];for(let _=0;_<n.count;_++)s[_]=new pu,o[_]=new pu;const l=new pu,c=new pu,u=new pu,h=new du,d=new du,A=new du,p=new pu,f=new pu;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),h.fromBufferAttribute(i,e),d.fromBufferAttribute(i,t),A.fromBufferAttribute(i,r),c.sub(l),u.sub(l),d.sub(h),A.sub(h);const a=1/(d.x*A.y-A.x*d.y);isFinite(a)&&(p.copy(c).multiplyScalar(A.y).addScaledVector(u,-d.y).multiplyScalar(a),f.copy(u).multiplyScalar(d.x).addScaledVector(c,-A.x).multiplyScalar(a),s[e].add(p),s[t].add(p),s[r].add(p),o[e].add(f),o[t].add(f),o[r].add(f))}let m=this.groups;0===m.length&&(m=[{start:0,count:e.count}]);for(let _=0,S=m.length;_<S;++_){const t=m[_],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)g(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const y=new pu,v=new pu,b=new pu,x=new pu;function w(e){b.fromBufferAttribute(r,e),x.copy(b);const t=s[e];y.copy(t),y.sub(b.multiplyScalar(b.dot(t))).normalize(),v.crossVectors(x,t);const n=v.dot(o[e])<0?-1:1;a.setXYZW(e,y.x,y.y,y.z,n)}for(let _=0,S=m.length;_<S;++_){const t=m[_],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)w(e.getX(r+0)),w(e.getX(r+1)),w(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Cd(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new pu,i=new pu,a=new pu,s=new pu,o=new pu,l=new pu,c=new pu,u=new pu;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),A=e.getX(h+1),p=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,A),a.fromBufferAttribute(t,p),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,A),l.fromBufferAttribute(n,p),s.add(c),o.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(A,o.x,o.y,o.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)zd.fromBufferAttribute(e,t),zd.normalize(),e.setXYZ(t,zd.x,zd.y,zd.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let s=0,o=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)a[o++]=n[s++]}return new Cd(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Hd,n=this.index.array,r=this.attributes;for(const s in r){const i=e(r[s],n);t.setAttribute(s,i)}const i=this.morphAttributes;for(const s in i){const r=[],a=i[s];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[s]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let s=0,o=a.length;s<o;s++){const e=a[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const o in n){const t=n[o];e.data.attributes[o]=t.toJSON(e.data)}const r={};let i=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[o]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere=s.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const i=e.morphAttributes;for(const l in i){const e=[],n=i[l];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Qd=new bh,Vd=new vh,Gd=new hh,Wd=new pu,qd=new pu,Kd=new pu,Xd=new pu,Yd=new pu,Jd=new pu,Zd=new pu,$d=new pu;class eA extends qh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gd;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(i&&s){Jd.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=s[n],o=i[n];0!==r&&(Yd.fromBufferAttribute(o,e),a?Jd.addScaledVector(Yd,r):Jd.addScaledVector(Yd.sub(t),r))}t.add(Jd)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Gd.copy(n.boundingSphere),Gd.applyMatrix4(i),Vd.copy(e.ray).recast(e.near),!1===Gd.containsPoint(Vd.origin)){if(null===Vd.intersectSphere(Gd,Wd))return;if(Vd.origin.distanceToSquared(Wd)>(e.far-e.near)**2)return}Qd.copy(i).invert(),Vd.copy(e.ray).applyMatrix4(Qd),null!==n.boundingBox&&!1===Vd.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Vd)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,s=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==s)if(Array.isArray(a))for(let A=0,p=h.length;A<p;A++){const i=h[A],o=a[i.materialIndex];for(let a=Math.max(i.start,d.start),h=Math.min(s.count,Math.min(i.start+i.count,d.start+d.count));a<h;a+=3){r=tA(this,o,e,n,l,c,u,s.getX(a),s.getX(a+1),s.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);i<o;i+=3){r=tA(this,a,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(a))for(let A=0,p=h.length;A<p;A++){const i=h[A],s=a[i.materialIndex];for(let a=Math.max(i.start,d.start),h=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));a<h;a+=3){r=tA(this,s,e,n,l,c,u,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);i<s;i+=3){r=tA(this,a,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function tA(e,t,n,r,i,a,s,o,l,c){e.getVertexPosition(o,qd),e.getVertexPosition(l,Kd),e.getVertexPosition(c,Xd);const u=function(e,t,n,r,i,a,s,o){let l;if(l=t.side===Es?r.intersectTriangle(s,a,i,!0,o):r.intersectTriangle(i,a,s,t.side===Cs,o),null===l)return null;$d.copy(o),$d.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo($d);return c<n.near||c>n.far?null:{distance:c,point:$d.clone(),object:e}}(e,t,n,r,qd,Kd,Xd,Zd);if(u){const e=new pu;od.getBarycoord(Zd,qd,Kd,Xd,e),i&&(u.uv=od.getInterpolatedAttribute(i,o,l,c,e,new du)),a&&(u.uv1=od.getInterpolatedAttribute(a,o,l,c,e,new du)),s&&(u.normal=od.getInterpolatedAttribute(s,o,l,c,e,new pu),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new pu,materialIndex:0};od.getNormal(qd,Kd,Xd,t.normal),u.face=t,u.barycoord=e}return u}class nA extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const s=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const o=[],l=[],c=[],u=[];let h=0,d=0;function A(e,t,n,r,i,a,A,p,f,g,m){const y=a/f,v=A/g,b=a/2,x=A/2,w=p/2,_=f+1,S=g+1;let C=0,E=0;const N=new pu;for(let s=0;s<S;s++){const a=s*v-x;for(let o=0;o<_;o++){const h=o*y-b;N[e]=h*r,N[t]=a*i,N[n]=w,l.push(N.x,N.y,N.z),N[e]=0,N[t]=0,N[n]=p>0?1:-1,c.push(N.x,N.y,N.z),u.push(o/f),u.push(1-s/g),C+=1}}for(let s=0;s<g;s++)for(let e=0;e<f;e++){const t=h+e+_*s,n=h+e+_*(s+1),r=h+(e+1)+_*(s+1),i=h+(e+1)+_*s;o.push(t,n,i),o.push(n,r,i),E+=6}s.addGroup(d,E,m),d+=E,h+=C}A("z","y","x",-1,-1,n,t,e,a,i,0),A("z","y","x",1,-1,n,t,-e,a,i,1),A("x","z","y",1,1,e,n,t,r,a,2),A("x","z","y",1,-1,e,n,-t,r,a,3),A("x","y","z",1,-1,e,t,n,r,i,4),A("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new Rd(l,3)),this.setAttribute("normal",new Rd(c,3)),this.setAttribute("uv",new Rd(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nA(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rA(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function iA(e){const t={};for(let n=0;n<e.length;n++){const r=rA(e[n]);for(const e in r)t[e]=r[e]}return t}function aA(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Iu.workingColorSpace}const sA={clone:rA,merge:iA};class oA extends fd{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rA(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class lA extends qh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bh,this.projectionMatrix=new bh,this.projectionMatrixInverse=new bh,this.coordinateSystem=Xc,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const cA=new pu,uA=new du,hA=new du;class dA extends lA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*iu*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ru*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*iu*Math.atan(Math.tan(.5*ru*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){cA.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(cA.x,cA.y).multiplyScalar(-e/cA.z),cA.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(cA.x,cA.y).multiplyScalar(-e/cA.z)}getViewSize(e,t){return this.getViewBounds(e,uA,hA),t.subVectors(hA,uA)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ru*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/s,r*=a.width/e,n*=a.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const AA=-90;class pA extends qh{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new dA(AA,1,e,t);r.layers=this.layers,this.add(r);const i=new dA(AA,1,e,t);i.layers=this.layers,this.add(i);const a=new dA(AA,1,e,t);a.layers=this.layers,this.add(a);const s=new dA(AA,1,e,t);s.layers=this.layers,this.add(s);const o=new dA(AA,1,e,t);o.layers=this.layers,this.add(o);const l=new dA(AA,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,s,o]=t;for(const l of t)this.remove(l);if(e===Xc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Yc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,s,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),A=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=A,n.texture.needsPMREMUpdate=!0}}class fA extends Ou{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:_o,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class gA extends Hu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new fA(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new nA(5,5,5),s=new oA({name:"CubemapFromEquirect",uniforms:rA(n),vertexShader:r,fragmentShader:i,side:Es,blending:ks});s.uniforms.tEquirect.value=t;const o=new eA(a,s),l=t.minFilter;t.minFilter===Oo&&(t.minFilter=Po);return new pA(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}class mA extends qh{constructor(){super(),this.isGroup=!0,this.type="Group"}}const yA={type:"move"};class vA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new mA,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new mA,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new pu,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new pu),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new mA,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new pu,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new pu),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(l,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(yA)))}return null!==s&&(s.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new mA;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class bA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new dd(e),this.density=t}clone(){return new bA(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class xA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new dd(e),this.near=t,this.far=n}clone(){return new xA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class wA extends qh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Th,this.environmentIntensity=1,this.environmentRotation=new Th,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class _A{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Dc,this.updateRanges=[],this.version=0,this.uuid=au()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=au()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=au()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const SA=new pu;class CA{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)SA.fromBufferAttribute(this,t),SA.applyMatrix4(e),this.setXYZ(t,SA.x,SA.y,SA.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)SA.fromBufferAttribute(this,t),SA.applyNormalMatrix(e),this.setXYZ(t,SA.x,SA.y,SA.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)SA.fromBufferAttribute(this,t),SA.transformDirection(e),this.setXYZ(t,SA.x,SA.y,SA.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=cu(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=uu(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=uu(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=uu(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=uu(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=uu(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=cu(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=cu(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=cu(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=cu(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=uu(t,this.array),n=uu(n,this.array),r=uu(r,this.array),i=uu(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Cd(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new CA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class EA extends fd{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dd(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let NA;const kA=new pu,IA=new pu,TA=new pu,BA=new du,MA=new du,FA=new bh,RA=new pu,LA=new pu,PA=new pu,UA=new du,DA=new du,OA=new du;class jA extends qh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new EA;if(super(),this.isSprite=!0,this.type="Sprite",void 0===NA){NA=new Hd;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new _A(e,5);NA.setIndex([0,1,2,0,2,3]),NA.setAttribute("position",new CA(t,3,0,!1)),NA.setAttribute("uv",new CA(t,2,3,!1))}this.geometry=NA,this.material=e,this.center=new du(.5,.5),this.count=1}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),IA.setFromMatrixScale(this.matrixWorld),FA.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),TA.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&IA.multiplyScalar(-TA.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const a=this.center;zA(RA.set(-.5,-.5,0),TA,a,IA,r,i),zA(LA.set(.5,-.5,0),TA,a,IA,r,i),zA(PA.set(.5,.5,0),TA,a,IA,r,i),UA.set(0,0),DA.set(1,0),OA.set(1,1);let s=e.ray.intersectTriangle(RA,LA,PA,!1,kA);if(null===s&&(zA(LA.set(-.5,.5,0),TA,a,IA,r,i),DA.set(0,1),s=e.ray.intersectTriangle(RA,PA,LA,!1,kA),null===s))return;const o=e.ray.origin.distanceTo(kA);o<e.near||o>e.far||t.push({distance:o,point:kA.clone(),uv:od.getInterpolation(kA,RA,LA,PA,UA,DA,OA,new du),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function zA(e,t,n,r,i,a){BA.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(MA.x=a*BA.x-i*BA.y,MA.y=i*BA.x+a*BA.y):MA.copy(BA),e.copy(t),e.x+=MA.x,e.y+=MA.y,e.applyMatrix4(FA)}const HA=new pu,QA=new pu;class VA extends qh{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){HA.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(HA);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){HA.setFromMatrixPosition(e.matrixWorld),QA.setFromMatrixPosition(this.matrixWorld);const n=HA.distanceTo(QA)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,i=n.length;r<i;r++){const e=n[r];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const GA=new pu,WA=new ju,qA=new ju,KA=new pu,XA=new bh,YA=new pu,JA=new hh,ZA=new bh,$A=new vh;class ep extends eA{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=bo,this.bindMatrix=new bh,this.bindMatrixInverse=new bh,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new qu),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,YA),this.boundingBox.expandByPoint(YA)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new hh),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,YA),this.boundingSphere.expandByPoint(YA)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),JA.copy(this.boundingSphere),JA.applyMatrix4(r),!1!==e.ray.intersectsSphere(JA)&&(ZA.copy(r).invert(),$A.copy(e.ray).applyMatrix4(ZA),null!==this.boundingBox&&!1===$A.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,$A)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ju,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===bo?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===xo?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;WA.fromBufferAttribute(r.attributes.skinIndex,e),qA.fromBufferAttribute(r.attributes.skinWeight,e),GA.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){const e=qA.getComponent(i);if(0!==e){const r=WA.getComponent(i);XA.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(KA.copy(GA).applyMatrix4(XA),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class tp extends qh{constructor(){super(),this.isBone=!0,this.type="Bone"}}class np extends Ou{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Bo,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Bo,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const rp=new bh,ip=new bh;class ap{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=au(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bh)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new bh;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,a=e.length;i<a;i++){const r=e[i]?e[i].matrixWorld:ip;rp.multiplyMatrices(r,t[i]),rp.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}clone(){return new ap(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new np(t,e,e,nl,qo);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new tp),this.bones.push(i),this.boneInverses.push((new bh).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class sp extends Cd{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const op=new bh,lp=new bh,cp=[],up=new qu,hp=new bh,dp=new eA,Ap=new hh;class pp extends eA{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new sp(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,hp)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new qu),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,op),up.copy(e.boundingBox).applyMatrix4(op),this.boundingBox.union(up)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new hh),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,op),Ap.copy(e.boundingSphere).applyMatrix4(op),this.boundingSphere.union(Ap)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let a=0;a<n.length;a++)n[a]=r[i+a]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(dp.geometry=this.geometry,dp.material=this.material,void 0!==dp.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ap.copy(this.boundingSphere),Ap.applyMatrix4(n),!1!==e.ray.intersectsSphere(Ap)))for(let i=0;i<r;i++){this.getMatrixAt(i,op),lp.multiplyMatrices(n,op),dp.matrixWorld=lp,dp.raycast(e,cp);for(let e=0,n=cp.length;e<n;e++){const n=cp[e];n.instanceId=i,n.object=this,t.push(n)}cp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new sp(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new np(new Float32Array(r*this.count),r,this.count,al,qo));const i=this.morphTexture.source.data.data;let a=0;for(let l=0;l<n.length;l++)a+=n[l];const s=this.geometry.morphTargetsRelative?1:1-a,o=r*e;i[o]=s,i.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const fp=new pu,gp=new pu,mp=new mu;class yp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=fp.subVectors(n,t).cross(gp.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(fp),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||mp.getNormalMatrix(e),r=this.coplanarPoint(fp).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const vp=new hh,bp=new du(.5,.5),xp=new pu;class wp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yp,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yp,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new yp,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new yp,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new yp;this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xc,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.planes,i=e.elements,a=i[0],s=i[1],o=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],A=i[8],p=i[9],f=i[10],g=i[11],m=i[12],y=i[13],v=i[14],b=i[15];if(r[0].setComponents(l-a,d-c,g-A,b-m).normalize(),r[1].setComponents(l+a,d+c,g+A,b+m).normalize(),r[2].setComponents(l+s,d+u,g+p,b+y).normalize(),r[3].setComponents(l-s,d-u,g-p,b-y).normalize(),n)r[4].setComponents(o,h,f,v).normalize(),r[5].setComponents(l-o,d-h,g-f,b-v).normalize();else if(r[4].setComponents(l-o,d-h,g-f,b-v).normalize(),t===Xc)r[5].setComponents(l+o,d+h,g+f,b+v).normalize();else{if(t!==Yc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,h,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),vp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),vp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(vp)}intersectsSprite(e){vp.center.set(0,0,0);const t=bp.distanceTo(e.center);return vp.radius=.7071067811865476+t,vp.applyMatrix4(e.matrixWorld),this.intersectsSphere(vp)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(xp.x=r.normal.x>0?e.max.x:e.min.x,xp.y=r.normal.y>0?e.max.y:e.min.y,xp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(xp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const _p=new bh,Sp=new wp;class Cp{constructor(){this.coordinateSystem=Xc}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(_p.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Sp.setFromProjectionMatrix(_p,r.coordinateSystem,r.reversedDepth),Sp.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(_p.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Sp.setFromProjectionMatrix(_p,r.coordinateSystem,r.reversedDepth),Sp.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(_p.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Sp.setFromProjectionMatrix(_p,r.coordinateSystem,r.reversedDepth),Sp.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(_p.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Sp.setFromProjectionMatrix(_p,r.coordinateSystem,r.reversedDepth),Sp.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(_p.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Sp.setFromProjectionMatrix(_p,r.coordinateSystem,r.reversedDepth),Sp.containsPoint(e))return!0}return!1}clone(){return new Cp}}function Ep(e,t){return e-t}function Np(e,t){return e.z-t.z}function kp(e,t){return t.z-e.z}class Ip{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,r){const i=this.pool,a=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1});const s=i[this.index];a.push(s),this.index++,s.start=e,s.count=t,s.z=n,s.index=r}reset(){this.list.length=0,this.index=0}}const Tp=new bh,Bp=new dd(1,1,1),Mp=new wp,Fp=new Cp,Rp=new qu,Lp=new hh,Pp=new pu,Up=new pu,Dp=new pu,Op=new Ip,jp=new eA,zp=[];function Hp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const i=e.count;for(let a=0;a<i;a++)for(let i=0;i<r;i++)t.setComponent(a+n,i,e.getComponent(a,i))}else t.array.set(e.array,n*r);t.needsUpdate=!0}function Qp(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)t[r]=e[r]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Vp extends eA{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,r=arguments.length>3?arguments[3]:void 0;super(new Hd,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new np(t,e,e,nl,qo);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new np(t,e,e,sl,Wo);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new np(t,e,e,nl,qo);n.colorSpace=Iu.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in e.attributes){const i=e.getAttribute(r),{array:a,itemSize:s,normalized:o}=i,l=new a.constructor(n*s),c=new Cd(l,s,o);t.setAttribute(r,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Cd(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error('THREE.BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid instanceId ".concat(e,". Instance is either out of range or has been deleted."))}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error("THREE.BatchedMesh: Invalid geometryId ".concat(e,". Geometry is either out of range or has been deleted."))}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qu);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Tp),this.getBoundingBoxAt(r,Rp).applyMatrix4(Tp),e.union(Rp)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hh);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Tp),this.getBoundingSphereAt(r,Lp).applyMatrix4(Tp),e.union(Lp)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Ep),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const r=this._matricesTexture;Tp.identity().toArray(r.image.data,16*n),r.needsUpdate=!0;const i=this._colorsTexture;return i&&(Bp.toArray(i.image.data,4*n),i.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},i=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const a=e.getIndex();if(null!==a&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=-1===n?a.count:n),-1!==r.indexStart&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let s;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Ep),s=this._availableGeometryIds.shift(),i[s]=r):(s=this._geometryCount,this._geometryCount++,i.push(r)),this.setGeometryAt(s,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,s}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),a=t.getIndex(),s=this._geometryInfo[e];if(r&&a.count>s.reservedIndexCount||t.attributes.position.count>s.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const o=s.vertexStart,l=s.reservedVertexCount;s.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),r=n.getAttribute(c);Hp(e,r,o);const i=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=o+t;for(let t=0;t<i;t++)r.setComponent(e,t,0)}r.needsUpdate=!0,r.addUpdateRange(o*i,l*i)}if(r){const e=s.indexStart,n=s.reservedIndexCount;s.indexCount=t.getIndex().count;for(let t=0;t<a.count;t++)i.setX(e+t,o+a.getX(t));for(let t=a.count,r=n;t<r;t++)i.setX(e+t,o);i.needsUpdate=!0,i.addUpdateRange(e,s.reservedIndexCount)}return s.start=r?s.indexStart:s.vertexStart,s.count=r?s.indexCount:s.vertexCount,s.boundingBox=null,null!==t.boundingBox&&(s.boundingBox=t.boundingBox.clone()),s.boundingSphere=null,null!==t.boundingSphere&&(s.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let r=0,i=n.length;r<i;r++)n[r].active&&n[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),i=this.geometry;for(let a=0,s=n.length;a<s;a++){const s=r[a],o=n[s];if(!1!==o.active){if(null!==i.index){if(o.indexStart!==t){const{indexStart:n,vertexStart:r,reservedIndexCount:a}=o,s=i.index,l=s.array,c=e-r;for(let e=n;e<n+a;e++)l[e]=l[e]+c;s.array.copyWithin(t,n,n+a),s.addUpdateRange(t,a),o.indexStart=t}t+=o.reservedIndexCount}if(o.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=o,r=i.attributes;for(const i in r){const a=r[i],{array:s,itemSize:o}=a;s.copyWithin(e*o,t*o,(t+n)*o),a.addUpdateRange(e*o,n*o)}o.vertexStart=e}e+=o.reservedVertexCount,o.start=i.index?o.indexStart:o.vertexStart,this._nextIndexStart=i.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingBox){const e=new qu,t=n.index,i=n.attributes.position;for(let n=r.start,a=r.start+r.count;n<a;n++){let r=n;t&&(r=t.getX(r)),e.expandByPoint(Pp.fromBufferAttribute(i,r))}r.boundingBox=e}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingSphere){const t=new hh;this.getBoundingBoxAt(e,Rp),Rp.getCenter(t.center);const i=n.index,a=n.attributes.position;let s=0;for(let e=r.start,n=r.start+r.count;e<n;e++){let n=e;i&&(n=i.getX(n)),Pp.fromBufferAttribute(a,n),s=Math.max(s,t.center.distanceToSquared(Pp))}t.radius=Math.sqrt(s),r.boundingSphere=t}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Ep);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error("BatchedMesh: Instance ids outside the range ".concat(e," are being used. Cannot shrink instance count."));const r=new Int32Array(e),i=new Int32Array(e);Qp(this._multiDrawCounts,r),Qp(this._multiDrawStarts,i),this._multiDrawCounts=r,this._multiDrawStarts=i,this._maxInstanceCount=e;const a=this._indirectTexture,s=this._matricesTexture,o=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Qp(a.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),Qp(s.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),Qp(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw new Error("BatchedMesh: Geometry vertex values are being used outside the range ".concat(t,". Cannot shrink further."));if(this.geometry.index){if(Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount))>t)throw new Error("BatchedMesh: Geometry index values are being used outside the range ".concat(t,". Cannot shrink further."))}const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Hd,this._initializeGeometry(r));const i=this.geometry;r.index&&Qp(r.index.array,i.index.array);for(const a in r.attributes)Qp(r.attributes[a].array,i.attributes[a].array)}raycast(e,t){const n=this._instanceInfo,r=this._geometryInfo,i=this.matrixWorld,a=this.geometry;jp.material=this.material,jp.geometry.index=a.index,jp.geometry.attributes=a.attributes,null===jp.geometry.boundingBox&&(jp.geometry.boundingBox=new qu),null===jp.geometry.boundingSphere&&(jp.geometry.boundingSphere=new hh);for(let s=0,o=n.length;s<o;s++){if(!n[s].visible||!n[s].active)continue;const a=n[s].geometryIndex,o=r[a];jp.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(s,jp.matrixWorld).premultiply(i),this.getBoundingBoxAt(a,jp.geometry.boundingBox),this.getBoundingSphereAt(a,jp.geometry.boundingSphere),jp.raycast(e,zp);for(let e=0,n=zp.length;e<n;e++){const n=zp[e];n.object=this,n.batchId=s,t.push(n)}zp.length=0}jp.material=null,jp.geometry.index=null,jp.geometry.attributes={},jp.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>M(M({},e),{},{boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>M({},e)),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,A=d.image.data,p=n.isArrayCamera?Fp:Mp;h&&!n.isArrayCamera&&(Tp.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Mp.setFromProjectionMatrix(Tp,n.coordinateSystem,n.reversedDepth));let f=0;if(this.sortObjects){Tp.copy(this.matrixWorld).invert(),Pp.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Tp),Up.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Tp);for(let r=0,i=o.length;r<i;r++)if(o[r].visible&&o[r].active){const e=o[r].geometryIndex;this.getMatrixAt(r,Tp),this.getBoundingSphereAt(e,Lp).applyMatrix4(Tp);let t=!1;if(h&&(t=!p.intersectsSphere(Lp,n)),!t){const t=u[e],n=Dp.subVectors(Lp.center,Pp).dot(Up);Op.push(t.start,t.count,n,r)}}const e=Op.list,t=this.customSort;null===t?e.sort(i.transparent?kp:Np):t.call(this,e,n);for(let n=0,r=e.length;n<r;n++){const t=e[n];l[f]=t.start*s,c[f]=t.count,A[f]=t.index,f++}Op.reset()}else for(let g=0,m=o.length;g<m;g++)if(o[g].visible&&o[g].active){const e=o[g].geometryIndex;let t=!1;if(h&&(this.getMatrixAt(g,Tp),this.getBoundingSphereAt(e,Lp).applyMatrix4(Tp),t=!p.intersectsSphere(Lp,n)),!t){const t=u[e];l[f]=t.start*s,c[f]=t.count,A[f]=g,f++}}d.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,i,a){this.onBeforeRender(e,null,r,i,a)}}class Gp extends fd{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dd(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Wp=new pu,qp=new pu,Kp=new bh,Xp=new vh,Yp=new hh,Jp=new pu,Zp=new pu;class $p extends qh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gp;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Wp.fromBufferAttribute(t,e-1),qp.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Wp.distanceTo(qp);e.setAttribute("lineDistance",new Rd(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Yp.copy(n.boundingSphere),Yp.applyMatrix4(r),Yp.radius+=i,!1===e.ray.intersectsSphere(Yp))return;Kp.copy(r).invert(),Xp.copy(e.ray).applyMatrix4(Kp);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=c.getX(i),r=c.getX(i+1),a=ef(this,e,Xp,o,n,r,i);a&&t.push(a)}if(this.isLineLoop){const i=c.getX(r-1),a=c.getX(n),s=ef(this,e,Xp,o,i,a,r-1);s&&t.push(s)}}else{const n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=ef(this,e,Xp,o,i,i+1,i);n&&t.push(n)}if(this.isLineLoop){const i=ef(this,e,Xp,o,r-1,n,r-1);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ef(e,t,n,r,i,a,s){const o=e.geometry.attributes.position;Wp.fromBufferAttribute(o,i),qp.fromBufferAttribute(o,a);if(n.distanceSqToSegment(Wp,qp,Jp,Zp)>r)return;Jp.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(Jp);return l<t.near||l>t.far?void 0:{distance:l,point:Zp.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}const tf=new pu,nf=new pu;class rf extends $p{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)tf.fromBufferAttribute(t,e),nf.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+tf.distanceTo(nf);e.setAttribute("lineDistance",new Rd(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class af extends $p{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class sf extends fd{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dd(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const of=new bh,lf=new vh,cf=new hh,uf=new pu;class hf extends qh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hd,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sf;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),cf.copy(n.boundingSphere),cf.applyMatrix4(r),cf.radius+=i,!1===e.ray.intersectsSphere(cf))return;of.copy(r).invert(),lf.copy(e.ray).applyMatrix4(of);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++){const i=l.getX(n);uf.fromBufferAttribute(c,i),df(uf,i,o,r,e,t,this)}}else{for(let n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);n<i;n++)uf.fromBufferAttribute(c,n),df(uf,n,o,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function df(e,t,n,r,i,a,s){const o=lf.distanceSqToPoint(e);if(o<n){const n=new pu;lf.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:s})}}class Af extends Ou{constructor(e,t,n,r){super(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:Po,arguments.length>5&&void 0!==arguments[5]?arguments[5]:Po,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const i=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){i.needsUpdate=!0,i._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class pf extends Af{constructor(e,t,n,r,i,a,s,o){super({},e,t,n,r,i,a,s,o),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class ff extends Ou{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Bo,this.minFilter=Bo,this.generateMipmaps=!1,this.needsUpdate=!0}}class gf extends Ou{constructor(e,t,n,r,i,a,s,o,l,c,u,h){super(null,a,s,o,l,c,r,i,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class mf extends gf{constructor(e,t,n,r,i,a){super(e,t,n,i,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Io,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class yf extends gf{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,_o),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class vf extends Ou{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class bf extends Ou{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wo,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Bo,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Bo,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:rl,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(c!==rl&&c!==il)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:u},r,i,a,s,o,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Lu(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class xf extends Ou{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class wf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:r,heightSegments:i},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),r=Math.max(3,Math.floor(r)),i=Math.max(1,Math.floor(i));const a=[],s=[],o=[],l=[],c=t/2,u=Math.PI/2*e,h=t,d=2*u+h,A=2*n+i,p=r+1,f=new pu,g=new pu;for(let m=0;m<=A;m++){let y=0,v=0,b=0,x=0;if(m<=n){const t=m/n,r=t*Math.PI/2;v=-c-e*Math.cos(r),b=e*Math.sin(r),x=-e*Math.cos(r),y=t*u}else if(m<=n+i){const r=(m-n)/i;v=r*t-c,b=e,x=0,y=u+r*h}else{const t=(m-n-i)/n,r=t*Math.PI/2;v=c+e*Math.sin(r),b=e*Math.cos(r),x=e*Math.sin(r),y=u+h+t*u}const w=Math.max(0,Math.min(1,y/d));let _=0;0===m?_=.5/r:m===A&&(_=-.5/r);for(let e=0;e<=r;e++){const t=e/r,n=t*Math.PI*2,i=Math.sin(n),a=Math.cos(n);g.x=-b*a,g.y=v,g.z=b*i,s.push(g.x,g.y,g.z),f.set(-b*a,x,b*i),f.normalize(),o.push(f.x,f.y,f.z),l.push(t+_,w)}if(m>0){const e=(m-1)*p;for(let t=0;t<r;t++){const n=e+t,r=e+t+1,i=m*p+t,s=m*p+t+1;a.push(n,r,i),a.push(r,s,i)}}}this.setIndex(a),this.setAttribute("position",new Rd(s,3)),this.setAttribute("normal",new Rd(o,3)),this.setAttribute("uv",new Rd(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wf(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class _f extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],a=[],s=[],o=[],l=new pu,c=new du;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const i=n+u/t*r;l.x=e*Math.cos(i),l.y=e*Math.sin(i),a.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(a[h]/e+1)/2,c.y=(a[h+1]/e+1)/2,o.push(c.x,c.y)}for(let u=1;u<=t;u++)i.push(u,u+1,0);this.setIndex(i),this.setAttribute("position",new Rd(a,3)),this.setAttribute("normal",new Rd(s,3)),this.setAttribute("uv",new Rd(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _f(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Sf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let A=0;const p=[],f=n/2;let g=0;function m(n){const i=A,a=new du,p=new pu;let m=0;const y=!0===n?e:t,v=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,f*v,0),h.push(0,v,0),d.push(.5,.5),A++;const b=A;for(let e=0;e<=r;e++){const t=e/r*o+s,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=f*v,p.z=y*n,u.push(p.x,p.y,p.z),h.push(0,v,0),a.x=.5*n+.5,a.y=.5*i*v+.5,d.push(a.x,a.y),A++}for(let e=0;e<r;e++){const t=i+e,r=b+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),m+=3}l.addGroup(g,m,!0===n?1:2),g+=m}!function(){const a=new pu,m=new pu;let y=0;const v=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+s,l=Math.sin(i),p=Math.cos(i);m.x=y*l,m.y=-g*n+f,m.z=y*p,u.push(m.x,m.y,m.z),a.set(l,v,p).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),c.push(A++)}p.push(c)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const a=p[r][n],s=p[r+1][n],o=p[r+1][n+1],l=p[r][n+1];(e>0||0!==r)&&(c.push(a,s,l),y+=3),(t>0||r!==i-1)&&(c.push(s,o,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===a&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(c),this.setAttribute("position",new Rd(u,3)),this.setAttribute("normal",new Rd(h,3)),this.setAttribute("uv",new Rd(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sf(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Cf extends Sf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,r,i,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:s}}static fromJSON(e){return new Cf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ef extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],a=[];function s(e,t,n,r){const i=r+1,a=[];for(let s=0;s<=i;s++){a[s]=[];const r=e.clone().lerp(n,s/i),o=t.clone().lerp(n,s/i),l=i-s;for(let e=0;e<=l;e++)a[s][e]=0===e&&s===i?r:r.clone().lerp(o,e/l)}for(let s=0;s<i;s++)for(let e=0;e<2*(i-s)-1;e++){const t=Math.floor(e/2);e%2===0?(o(a[s][t+1]),o(a[s+1][t]),o(a[s][t])):(o(a[s][t+1]),o(a[s+1][t+1]),o(a[s+1][t]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new pu,r=new pu,i=new pu;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],r),l(t[a+2],i),s(n,r,i,e)}(r),function(e){const t=new pu;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new pu;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=u(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;a.push(n,1-r)}(function(){const e=new pu,t=new pu,n=new pu,r=new pu,s=new du,o=new du,l=new du;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const A=u(r);c(s,d+0,e,A),c(o,d+2,t,A),c(l,d+4,n,A)}})(),function(){for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Rd(i,3)),this.setAttribute("normal",new Rd(i.slice(),3)),this.setAttribute("uv",new Rd(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ef(e.vertices,e.indices,e.radius,e.details)}}class Nf extends Ef{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Nf(e.radius,e.detail)}}const kf=new pu,If=new pu,Tf=new pu,Bf=new od;class Mf extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(ru*t),a=e.getIndex(),s=e.getAttribute("position"),o=a?a.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<o;e+=3){a?(l[0]=a.getX(e),l[1]=a.getX(e+1),l[2]=a.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=Bf;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),o.fromBufferAttribute(s,l[2]),Bf.getNormal(Tf),u[0]="".concat(Math.round(t.x*r),",").concat(Math.round(t.y*r),",").concat(Math.round(t.z*r)),u[1]="".concat(Math.round(n.x*r),",").concat(Math.round(n.y*r),",").concat(Math.round(n.z*r)),u[2]="".concat(Math.round(o.x*r),",").concat(Math.round(o.y*r),",").concat(Math.round(o.z*r)),u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],a=Bf[c[e]],s=Bf[c[t]],o="".concat(n,"_").concat(r),A="".concat(r,"_").concat(n);A in h&&h[A]?(Tf.dot(h[A].normal)<=i&&(d.push(a.x,a.y,a.z),d.push(s.x,s.y,s.z)),h[A]=null):o in h||(h[o]={index0:l[e],index1:l[t],normal:Tf.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];kf.fromBufferAttribute(s,t),If.fromBufferAttribute(s,n),d.push(kf.x,kf.y,kf.z),d.push(If.x,If.y,If.z)}this.setAttribute("position",new Rd(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Ff{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let s,o=0,l=i-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),s=n[r]-a,s<0)o=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===a)return r/(i-1);const c=n[r];return(r+(a-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const a=this.getPoint(r),s=this.getPoint(i),o=t||(a.isVector2?new du:new pu);return o.copy(s).sub(a).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new pu,r=[],i=[],a=[],s=new pu,o=new bh;for(let d=0;d<=e;d++){const t=d/e;r[d]=this.getTangentAt(t,new pu)}i[0]=new pu,a[0]=new pu;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),a[0].crossVectors(r[0],i[0]);for(let d=1;d<=e;d++){if(i[d]=i[d-1].clone(),a[d]=a[d-1].clone(),s.crossVectors(r[d-1],r[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(su(r[d-1].dot(r[d]),-1,1));i[d].applyMatrix4(o.makeRotationAxis(s,e))}a[d].crossVectors(r[d],i[d])}if(!0===t){let t=Math.acos(su(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Rf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const i=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=i?0:n),!0!==this.aClockwise||i||(r===n?r=-n:r-=n);const a=this.aStartAngle+e*r;let s=this.aX+this.xRadius*Math.cos(a),o=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=o-this.aY;s=n*e-r*t+this.aX,o=n*t+r*e+this.aY}return t.set(s,o)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Lf extends Rf{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Pf(){let e=0,t=0,n=0,r=0;function i(i,a,s,o){e=i,t=s,n=-3*i+3*a-2*s-o,r=2*i-2*a+s+o}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,s,o){let l=(t-e)/a-(n-e)/(a+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+o)+(r-n)/o;l*=s,c*=s,i(t,n,l,c)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}const Uf=new pu,Df=new Pf,Of=new Pf,jf=new Pf;class zf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=this.points,r=n.length,i=(r-(this.closed?0:1))*e;let a,s,o=Math.floor(i),l=i-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:0===l&&o===r-1&&(o=r-2,l=1),this.closed||o>0?a=n[(o-1)%r]:(Uf.subVectors(n[0],n[1]).add(n[0]),a=Uf);const c=n[o%r],u=n[(o+1)%r];if(this.closed||o+2<r?s=n[(o+2)%r]:(Uf.subVectors(n[r-1],n[r-2]).add(n[r-1]),s=Uf),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Df.initNonuniformCatmullRom(a.x,c.x,u.x,s.x,t,n,r),Of.initNonuniformCatmullRom(a.y,c.y,u.y,s.y,t,n,r),jf.initNonuniformCatmullRom(a.z,c.z,u.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Df.initCatmullRom(a.x,c.x,u.x,s.x,this.tension),Of.initCatmullRom(a.y,c.y,u.y,s.y,this.tension),jf.initCatmullRom(a.z,c.z,u.z,s.z,this.tension));return t.set(Df.calc(l),Of.calc(l),jf.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new pu).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Hf(e,t,n,r,i){const a=.5*(r-t),s=.5*(i-n),o=e*e;return(2*n-2*r+a+s)*(e*o)+(-3*n+3*r-2*a-s)*o+a*e+n}function Qf(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Vf(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class Gf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new du,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new du,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new du;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Vf(e,n.x,r.x,i.x,a.x),Vf(e,n.y,r.y,i.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Wf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pu;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(Vf(e,n.x,r.x,i.x,a.x),Vf(e,n.y,r.y,i.y,a.y),Vf(e,n.z,r.z,i.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class qf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new du,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Kf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Xf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new du,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new du;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=this.v0,r=this.v1,i=this.v2;return t.set(Qf(e,n.x,r.x,i.x),Qf(e,n.y,r.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Yf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,n=this.v0,r=this.v1,i=this.v2;return t.set(Qf(e,n.x,r.x,i.x),Qf(e,n.y,r.y,i.y),Qf(e,n.z,r.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jf extends Ff{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du,n=this.points,r=(n.length-1)*e,i=Math.floor(r),a=r-i,s=n[0===i?i:i-1],o=n[i],l=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return t.set(Hf(a,s.x,o.x,l.x,c.x),Hf(a,s.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new du).fromArray(n))}return this}}var Zf=Object.freeze({__proto__:null,ArcCurve:Lf,CatmullRomCurve3:zf,CubicBezierCurve:Gf,CubicBezierCurve3:Wf,EllipseCurve:Rf,LineCurve:qf,LineCurve3:Kf,QuadraticBezierCurve:Xf,QuadraticBezierCurve3:Yf,SplineCurve:Jf});class $f extends Ff{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Zf[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,a=this.curves[i],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const a=i[r],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){const r=o[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Zf[n.type]).fromJSON(n))}return this}}class eg extends $f{constructor(e){super(),this.type="Path",this.currentPoint=new du,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new qf(this.currentPoint.clone(),new du(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Xf(this.currentPoint.clone(),new du(e,t),new du(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){const s=new Gf(this.currentPoint.clone(),new du(e,t),new du(n,r),new du(i,a));return this.curves.push(s),this.currentPoint.set(i,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Jf(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){const s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,s,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,s,o),this}absellipse(e,t,n,r,i,a,s,o){const l=new Rf(e,t,n,r,i,a,s,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class tg extends eg{constructor(e){super(e),this.uuid=au(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new eg).fromJSON(n))}return this}}function ng(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,i=r?t[0]*n:e.length;let a=rg(e,0,i,n,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,c;if(r&&(a=function(e,t,n,r){const i=[];for(let a=0,s=t.length;a<s;a++){const n=rg(e,t[a]*r,a<s-1?t[a+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(pg(n))}i.sort(ug);for(let a=0;a<i.length;a++)n=hg(i[a],n);return n}(e,t,a,n)),e.length>80*n){o=1/0,l=1/0;let t=-1/0,r=-1/0;for(let a=n;a<i;a+=n){const n=e[a],i=e[a+1];n<o&&(o=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-o,r-l),c=0!==c?32767/c:0}return ag(a,s,n,o,l,c,0),s}function rg(e,t,n,r,i){let a;if(i===function(e,t,n,r){let i=0;for(let a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}(e,t,n,r)>0)for(let s=t;s<n;s+=r)a=Cg(s/r|0,e[s],e[s+1],a);else for(let s=n-r;s>=t;s-=r)a=Cg(s/r|0,e[s],e[s+1],a);return a&&vg(a,a.next)&&(Eg(a),a=a.next),a}function ig(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!vg(r,r.next)&&0!==yg(r.prev,r,r.next))r=r.next;else{if(Eg(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function ag(e,t,n,r,i,a,s){if(!e)return;!s&&a&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Ag(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let a=null;for(t=0;i;){t++;let s=i,o=0;for(let e=0;e<n&&(o++,s=s.nextZ,s);e++);let l=n;for(;o>0||l>0&&s;)0!==o&&(0===l||!s||i.z<=s.z)?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=s}a.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,a);let o=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?og(e,r,i,a):sg(e))t.push(l.i,e.i,c.i),Eg(e),e=c.next,o=c.next;else if((e=c)===o){s?1===s?ag(e=lg(ig(e),t),t,n,r,i,a,2):2===s&&cg(e,t,n,r,i,a):ag(ig(e),t,n,r,i,a,1);break}}}function sg(e){const t=e.prev,n=e,r=e.next;if(yg(t,n,r)>=0)return!1;const i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,c=r.y,u=Math.min(i,a,s),h=Math.min(o,l,c),d=Math.max(i,a,s),A=Math.max(o,l,c);let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=A&&gg(i,o,a,l,s,c,p.x,p.y)&&yg(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function og(e,t,n,r){const i=e.prev,a=e,s=e.next;if(yg(i,a,s)>=0)return!1;const o=i.x,l=a.x,c=s.x,u=i.y,h=a.y,d=s.y,A=Math.min(o,l,c),p=Math.min(u,h,d),f=Math.max(o,l,c),g=Math.max(u,h,d),m=Ag(A,p,t,n,r),y=Ag(f,g,t,n,r);let v=e.prevZ,b=e.nextZ;for(;v&&v.z>=m&&b&&b.z<=y;){if(v.x>=A&&v.x<=f&&v.y>=p&&v.y<=g&&v!==i&&v!==s&&gg(o,u,l,h,c,d,v.x,v.y)&&yg(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=A&&b.x<=f&&b.y>=p&&b.y<=g&&b!==i&&b!==s&&gg(o,u,l,h,c,d,b.x,b.y)&&yg(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=m;){if(v.x>=A&&v.x<=f&&v.y>=p&&v.y<=g&&v!==i&&v!==s&&gg(o,u,l,h,c,d,v.x,v.y)&&yg(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=A&&b.x<=f&&b.y>=p&&b.y<=g&&b!==i&&b!==s&&gg(o,u,l,h,c,d,b.x,b.y)&&yg(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function lg(e,t){let n=e;do{const r=n.prev,i=n.next.next;!vg(r,i)&&bg(r,n,n.next,i)&&_g(r,i)&&_g(i,r)&&(t.push(r.i,n.i,i.i),Eg(n),Eg(n.next),n=e=i),n=n.next}while(n!==e);return ig(n)}function cg(e,t,n,r,i,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&mg(s,e)){let o=Sg(s,e);return s=ig(s,s.next),o=ig(o,o.next),ag(s,t,n,r,i,a,0),void ag(o,t,n,r,i,a,0)}e=e.next}s=s.next}while(s!==e)}function ug(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return n}function hg(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let a,s=-1/0;if(vg(e,n))return n;do{if(vg(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s&&(s=e,a=n.x<n.next.x?n:n.next,e===r))return a}n=n.next}while(n!==t);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=l&&r!==n.x&&fg(i<c?r:s,i,l,c,i<c?s:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);_g(n,e)&&(t<u||t===u&&(n.x>a.x||n.x===a.x&&dg(a,n)))&&(a=n,u=t)}n=n.next}while(n!==o);return a}(e,t);if(!n)return t;const r=Sg(n,e);return ig(r,r.next),ig(n,n.next)}function dg(e,t){return yg(e.prev,e,t.prev)<0&&yg(t.next,e,e.next)<0}function Ag(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pg(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function fg(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function gg(e,t,n,r,i,a,s,o){return!(e===s&&t===o)&&fg(e,t,n,r,i,a,s,o)}function mg(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&bg(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(_g(e,t)&&_g(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(yg(e.prev,e,t.prev)||yg(e,t.prev,t))||vg(e,t)&&yg(e.prev,e,e.next)>0&&yg(t.prev,t,t.next)>0)}function yg(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function vg(e,t){return e.x===t.x&&e.y===t.y}function bg(e,t,n,r){const i=wg(yg(e,t,n)),a=wg(yg(e,t,r)),s=wg(yg(n,r,e)),o=wg(yg(n,r,t));return i!==a&&s!==o||(!(0!==i||!xg(e,n,t))||(!(0!==a||!xg(e,r,t))||(!(0!==s||!xg(n,e,r))||!(0!==o||!xg(n,t,r)))))}function xg(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function wg(e){return e>0?1:e<0?-1:0}function _g(e,t){return yg(e.prev,e,e.next)<0?yg(e,t,e.next)>=0&&yg(e,e.prev,t)>=0:yg(e,t,e.prev)<0||yg(e,e.next,t)<0}function Sg(e,t){const n=Ng(e.i,e.x,e.y),r=Ng(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Cg(e,t,n,r){const i=Ng(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Eg(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ng(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class kg{static triangulate(e,t){return ng(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:2)}}class Ig{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Ig.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Tg(e),Bg(n,e);let a=e.length;t.forEach(Tg);for(let o=0;o<t.length;o++)r.push(a),a+=t[o].length,Bg(n,t[o]);const s=kg.triangulate(n,r);for(let o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}}function Tg(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Bg(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Mg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tg([new du(.5,.5),new du(-.5,.5),new du(-.5,-.5),new du(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let s=0,o=e.length;s<o;s++){a(e[s])}function a(e){const a=[],s=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,A=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:Fg;let g,m,y,v,b,x=!1;p&&(g=p.getSpacedPoints(o),x=!0,c=!1,m=p.computeFrenetFrames(o,!1),y=new pu,v=new pu,b=new pu),c||(A=0,u=0,h=0,d=0);const w=e.extractPoints(s);let _=w.shape;const S=w.holes;if(!Ig.isClockWise(_)){_=_.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];Ig.isClockWise(t)&&(S[e]=t.reverse())}}function C(e){const t=1e-10*1e-10;let n=e[0];for(let r=1;r<=e.length;r++){const i=r%e.length,a=e[i],s=a.x-n.x,o=a.y-n.y,l=s*s+o*o,c=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(i,1),r--):n=a}}C(_),S.forEach(C);const E=S.length,N=_;for(let t=0;t<E;t++){const e=S[t];_=_.concat(e)}function k(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const I=_.length;function T(e,t,n){let r,i,a;const s=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+o*o,h=s*c-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),A=t.x-o/h,p=t.y+s/h,f=((n.x-c/d-A)*c-(n.y+l/d-p)*l)/(s*c-o*l);r=A+s*f-e.x,i=p+o*f-e.y;const g=r*r+i*i;if(g<=2)return new du(r,i);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(r=-o,i=s,a=Math.sqrt(u)):(r=s,i=o,a=Math.sqrt(u/2))}return new du(r/a,i/a)}const B=[];for(let t=0,n=N.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),B[t]=T(N[t],N[r],N[i]);const M=[];let F,R,L=B.concat();for(let t=0,n=E;t<n;t++){const e=S[t];F=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),F[t]=T(e[t],e[r],e[i]);M.push(F),L=L.concat(F)}if(0===A)R=Ig.triangulateShape(N,S);else{const e=[],t=[];for(let n=0;n<A;n++){const r=n/A,i=u*Math.cos(r*Math.PI/2),a=h*Math.sin(r*Math.PI/2)+d;for(let t=0,n=N.length;t<n;t++){const n=k(N[t],B[t],a);O(n.x,n.y,-i),0===r&&e.push(n)}for(let e=0,n=E;e<n;e++){const n=S[e];F=M[e];const s=[];for(let e=0,t=n.length;e<t;e++){const t=k(n[e],F[e],a);O(t.x,t.y,-i),0===r&&s.push(t)}0===r&&t.push(s)}}R=Ig.triangulateShape(e,t)}const P=R.length,U=h+d;for(let t=0;t<I;t++){const e=c?k(_[t],L[t],U):_[t];x?(v.copy(m.normals[0]).multiplyScalar(e.x),y.copy(m.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(v).add(y),O(b.x,b.y,b.z)):O(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<I;e++){const n=c?k(_[e],L[e],U):_[e];x?(v.copy(m.normals[t]).multiplyScalar(n.x),y.copy(m.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(v).add(y),O(b.x,b.y,b.z)):O(n.x,n.y,l/o*t)}for(let t=A-1;t>=0;t--){const e=t/A,n=u*Math.cos(e*Math.PI/2),r=h*Math.sin(e*Math.PI/2)+d;for(let t=0,i=N.length;t<i;t++){const e=k(N[t],B[t],r);O(e.x,e.y,l+n)}for(let t=0,i=S.length;t<i;t++){const e=S[t];F=M[t];for(let t=0,i=e.length;t<i;t++){const i=k(e[t],F[t],r);x?O(i.x,i.y+g[o-1].y,g[o-1].x+n):O(i.x,i.y,l+n)}}}function D(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=o+2*A;e<n;e++){const n=I*e,a=I*(e+1);z(t+r+n,t+i+n,t+i+a,t+r+a)}}}function O(e,t,n){a.push(e),a.push(t),a.push(n)}function j(e,t,i){H(e),H(t),H(i);const a=r.length/3,s=f.generateTopUV(n,r,a-3,a-2,a-1);Q(s[0]),Q(s[1]),Q(s[2])}function z(e,t,i,a){H(e),H(t),H(a),H(t),H(i),H(a);const s=r.length/3,o=f.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);Q(o[0]),Q(o[1]),Q(o[3]),Q(o[1]),Q(o[2]),Q(o[3])}function H(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function Q(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=I*e;for(let n=0;n<P;n++){const e=R[n];j(e[2]+t,e[1]+t,e[0]+t)}e=o+2*A,t=I*e;for(let n=0;n<P;n++){const e=R[n];j(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<P;e++){const t=R[e];j(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=R[e];j(t[0]+I*o,t[1]+I*o,t[2]+I*o)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;D(N,t),t+=N.length;for(let n=0,r=S.length;n<r;n++){const e=S[n];D(e,t),t+=e.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Rd(r,3)),this.setAttribute("uv",new Rd(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){const t=e[r];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,a=e.shapes.length;i<a;i++){const r=t[e.shapes[i]];n.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Zf[r.type]).fromJSON(r)),new Mg(n,e.options)}}const Fg={generateTopUV:function(e,t,n,r,i){const a=t[3*n],s=t[3*n+1],o=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new du(a,s),new du(o,l),new du(c,u)]},generateSideWallUV:function(e,t,n,r,i,a){const s=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],A=t[3*i+1],p=t[3*i+2],f=t[3*a],g=t[3*a+1],m=t[3*a+2];return Math.abs(o-u)<Math.abs(s-c)?[new du(s,1-l),new du(c,1-h),new du(d,1-p),new du(f,1-m)]:[new du(o,1-l),new du(u,1-h),new du(A,1-p),new du(g,1-m)]}};class Rg extends Ef{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rg(e.radius,e.detail)}}class Lg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new du(0,-.5),new du(.5,0),new du(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=su(r,0,2*Math.PI);const i=[],a=[],s=[],o=[],l=[],c=1/t,u=new pu,h=new du,d=new pu,A=new pu,p=new pu;let f=0,g=0;for(let m=0;m<=e.length-1;m++)switch(m){case 0:f=e[m+1].x-e[m].x,g=e[m+1].y-e[m].y,d.x=1*g,d.y=-f,d.z=0*g,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:f=e[m+1].x-e[m].x,g=e[m+1].y-e[m].y,d.x=1*g,d.y=-f,d.z=0*g,A.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(A)}for(let m=0;m<=t;m++){const i=n+m*c*r,d=Math.sin(i),A=Math.cos(i);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*A,a.push(u.x,u.y,u.z),h.x=m/t,h.y=n/(e.length-1),s.push(h.x,h.y);const r=o[3*n+0]*d,i=o[3*n+1],c=o[3*n+0]*A;l.push(r,i,c)}}for(let m=0;m<t;m++)for(let t=0;t<e.length-1;t++){const n=t+m*e.length,r=n,a=n+e.length,s=n+e.length+1,o=n+1;i.push(r,a,o),i.push(s,o,a)}this.setIndex(i),this.setAttribute("position",new Rd(a,3)),this.setAttribute("uv",new Rd(s,2)),this.setAttribute("normal",new Rd(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lg(e.points,e.segments,e.phiStart,e.phiLength)}}class Pg extends Ef{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Pg(e.radius,e.detail)}}class Ug extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,s=Math.floor(n),o=Math.floor(r),l=s+1,c=o+1,u=e/s,h=t/o,d=[],A=[],p=[],f=[];for(let g=0;g<c;g++){const e=g*h-a;for(let t=0;t<l;t++){const n=t*u-i;A.push(n,-e,0),p.push(0,0,1),f.push(t/s),f.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),r=e+1+l*(g+1),i=e+1+l*g;d.push(t,n,i),d.push(n,r,i)}this.setIndex(d),this.setAttribute("position",new Rd(A,3)),this.setAttribute("normal",new Rd(p,3)),this.setAttribute("uv",new Rd(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ug(e.width,e.height,e.widthSegments,e.heightSegments)}}class Dg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n),r=Math.max(1,r);const s=[],o=[],l=[],c=[];let u=e;const h=(t-e)/r,d=new pu,A=new du;for(let p=0;p<=r;p++){for(let e=0;e<=n;e++){const r=i+e/n*a;d.x=u*Math.cos(r),d.y=u*Math.sin(r),o.push(d.x,d.y,d.z),l.push(0,0,1),A.x=(d.x/t+1)/2,A.y=(d.y/t+1)/2,c.push(A.x,A.y)}u+=h}for(let p=0;p<r;p++){const e=p*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,a=r+n+1,o=r+n+2,l=r+1;s.push(i,a,l),s.push(a,o,l)}}this.setIndex(s),this.setAttribute("position",new Rd(o,3)),this.setAttribute("normal",new Rd(l,3)),this.setAttribute("uv",new Rd(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dg(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Og extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tg([new du(0,.5),new du(-.5,-.5),new du(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],a=[];let s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,o,c),s+=o,o=0;function l(e){const s=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Ig.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===Ig.isClockWise(e)&&(u[t]=e.reverse())}const h=Ig.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),a.push(e.x,e.y)}for(let t=0,r=h.length;t<r;t++){const e=h[t],r=e[0]+s,i=e[1]+s,a=e[2]+s;n.push(r,i,a),o+=3}}this.setIndex(n),this.setAttribute("position",new Rd(r,3)),this.setAttribute("normal",new Rd(i,3)),this.setAttribute("uv",new Rd(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new Og(n,e.curveSegments)}}class jg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(a+s,Math.PI);let l=0;const c=[],u=new pu,h=new pu,d=[],A=[],p=[],f=[];for(let g=0;g<=n;g++){const d=[],m=g/n;let y=0;0===g&&0===a?y=.5/t:g===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const o=n/t;u.x=-e*Math.cos(r+o*i)*Math.sin(a+m*s),u.y=e*Math.cos(a+m*s),u.z=e*Math.sin(r+o*i)*Math.sin(a+m*s),A.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),f.push(o+y,1-m),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],r=c[g][e],i=c[g+1][e],s=c[g+1][e+1];(0!==g||a>0)&&d.push(t,r,s),(g!==n-1||o<Math.PI)&&d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new Rd(A,3)),this.setAttribute("normal",new Rd(p,3)),this.setAttribute("uv",new Rd(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jg(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class zg extends Ef{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zg(e.radius,e.detail)}}class Hg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const a=[],s=[],o=[],l=[],c=new pu,u=new pu,h=new pu;for(let d=0;d<=n;d++)for(let a=0;a<=r;a++){const A=a/r*i,p=d/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(A),u.y=(e+t*Math.cos(p))*Math.sin(A),u.z=t*Math.sin(p),s.push(u.x,u.y,u.z),c.x=e*Math.cos(A),c.y=e*Math.sin(A),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(a/r),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=r;e++){const t=(r+1)*d+e-1,n=(r+1)*(d-1)+e-1,i=(r+1)*(d-1)+e,s=(r+1)*d+e;a.push(t,n,s),a.push(n,i,s)}this.setIndex(a),this.setAttribute("position",new Rd(s,3)),this.setAttribute("normal",new Rd(o,3)),this.setAttribute("uv",new Rd(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hg(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Qg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},n=Math.floor(n),r=Math.floor(r);const s=[],o=[],l=[],c=[],u=new pu,h=new pu,d=new pu,A=new pu,p=new pu,f=new pu,g=new pu;for(let y=0;y<=n;++y){const s=y/n*i*Math.PI*2;m(s,i,a,e,d),m(s+.01,i,a,e,A),f.subVectors(A,d),g.addVectors(A,d),p.crossVectors(f,g),g.crossVectors(p,f),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,a=-t*Math.cos(i),s=t*Math.sin(i);u.x=d.x+(a*g.x+s*p.x),u.y=d.y+(a*g.y+s*p.y),u.z=d.z+(a*g.z+s*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(e/r)}}for(let y=1;y<=n;y++)for(let e=1;e<=r;e++){const t=(r+1)*(y-1)+(e-1),n=(r+1)*y+(e-1),i=(r+1)*y+e,a=(r+1)*(y-1)+e;s.push(t,n,a),s.push(n,i,a)}function m(e,t,n,r,i){const a=Math.cos(e),s=Math.sin(e),o=n/t*e,l=Math.cos(o);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new Rd(o,3)),this.setAttribute("normal",new Rd(l,3)),this.setAttribute("uv",new Rd(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qg(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Vg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yf(new pu(-1,-1,0),new pu(-1,1,0),new pu(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const s=new pu,o=new pu,l=new du;let c=new pu;const u=[],h=[],d=[],A=[];function p(i){c=e.getPointAt(i/t,c);const l=a.normals[i],d=a.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+i*d.x,o.y=a*l.y+i*d.y,o.z=a*l.z+i*d.z,o.normalize(),h.push(o.x,o.y,o.z),s.x=c.x+n*o.x,s.y=c.y+n*o.y,s.z=c.z+n*o.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,s=(r+1)*(e-1)+t;A.push(n,i,s),A.push(i,a,s)}}()}(),this.setIndex(A),this.setAttribute("position",new Rd(u,3)),this.setAttribute("normal",new Rd(h,3)),this.setAttribute("uv",new Rd(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Vg((new Zf[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Gg extends Hd{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new pu,i=new pu;if(null!==e.index){const a=e.attributes.position,s=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let l=0;l<3;l++){const o=s.getX(e+l),c=s.getX(e+(l+1)%3);r.fromBufferAttribute(a,o),i.fromBufferAttribute(a,c),!0===Wg(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let o=0;o<3;o++){const s=3*e+o,l=3*e+(o+1)%3;r.fromBufferAttribute(a,s),i.fromBufferAttribute(a,l),!0===Wg(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new Rd(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Wg(e,t,n){const r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var qg=Object.freeze({__proto__:null,BoxGeometry:nA,CapsuleGeometry:wf,CircleGeometry:_f,ConeGeometry:Cf,CylinderGeometry:Sf,DodecahedronGeometry:Nf,EdgesGeometry:Mf,ExtrudeGeometry:Mg,IcosahedronGeometry:Rg,LatheGeometry:Lg,OctahedronGeometry:Pg,PlaneGeometry:Ug,PolyhedronGeometry:Ef,RingGeometry:Dg,ShapeGeometry:Og,SphereGeometry:jg,TetrahedronGeometry:zg,TorusGeometry:Hg,TorusKnotGeometry:Qg,TubeGeometry:Vg,WireframeGeometry:Gg});class Kg extends fd{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dd(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Xg extends oA{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Yg extends fd{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new dd(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Jg extends Yg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new du(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return su(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dd(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dd(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dd(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Zg extends fd{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dd(16777215),this.specular=new dd(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=lo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $g extends fd{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dd(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class em extends fd{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class tm extends fd{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=lo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nm extends fd{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=rc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rm extends fd{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class im extends fd{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dd(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new du(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class am extends Gp{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function sm(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function om(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lm(e){const t=e.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(function(t,n){return e[t]-e[n]}),n}function cm(e,t,n){const r=e.length,i=new e.constructor(r);for(let a=0,s=0;s!==r;++a){const r=n[a]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i}function um(e,t,n,r){let i=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[i++];if(void 0===a)return;let s=a[r];if(void 0!==s)if(Array.isArray(s))do{s=a[r],void 0!==s&&(t.push(a.time),n.push(...s)),a=e[i++]}while(void 0!==a);else if(void 0!==s.toArray)do{s=a[r],void 0!==s&&(t.push(a.time),s.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{s=a[r],void 0!==s&&(t.push(a.time),n.push(s)),a=e[i++]}while(void 0!==a)}class hm{static convertArray(e,t){return sm(e,t)}static isTypedArray(e){return om(e)}static getKeyframeOrder(e){return lm(e)}static sortedArray(e,t,n){return cm(e,t,n)}static flattenJSON(e,t,n,r){um(e,t,n,r)}static subclip(e,t,n,r){return function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const a=e.clone();a.name=t;const s=[];for(let l=0;l<a.tracks.length;++l){const e=a.tracks[l],t=e.getValueSize(),o=[],c=[];for(let a=0;a<e.times.length;++a){const s=e.times[a]*i;if(!(s<n||s>=r)){o.push(e.times[a]);for(let n=0;n<t;++n)c.push(e.values[a*t+n])}}0!==o.length&&(e.times=sm(o,e.times.constructor),e.values=sm(c,e.values.constructor),s.push(e))}a.tracks=s;let o=1/0;for(let l=0;l<a.tracks.length;++l)o>a.tracks[l].times[0]&&(o=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*o);return a.resetDuration(),a}(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:30)}static makeClipAdditive(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);const i=n.tracks.length,a=t/r;for(let s=0;s<i;++s){const t=n.tracks[s],r=t.ValueTypeName;if("bool"===r||"string"===r)continue;const i=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===r});if(void 0===i)continue;let o=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=t.times.length-1;let d;if(a<=t.times[0]){const e=o,n=l-o;d=t.values.slice(e,n)}else if(a>=t.times[h]){const e=h*l+o,n=e+l-o;d=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=o,r=l-o;e.evaluate(a),d=e.resultBuffer.slice(n,r)}"quaternion"===r&&(new Au).fromArray(d).normalize().conjugate().toArray(d);const A=i.times.length;for(let e=0;e<A;++e){const t=e*u+c;if("quaternion"===r)Au.multiplyQuaternionsFlat(i.values,t,d,0,i.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)i.values[t+n]-=d[n]}}}return e.blendMode=$l,e}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:30)}}class dm{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(!(e>=i)){const s=t[1];e<s&&(n=2,i=s);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0;break n}break e}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let a=0;a!==r;++a)t[a]=n[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Am extends dm{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Xl,endingEnd:Xl}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,s=r[i],o=r[a];if(void 0===s)switch(this.getSettings_().endingStart){case Yl:i=e,s=2*t-n;break;case Jl:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case Yl:a=e,o=2*n-t;break;case Jl:a=1,o=n+r[1]-r[0];break;default:a=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,A=(n-t)/(r-t),p=A*A,f=p*A,g=-h*f+2*h*p-h*A,m=(1+h)*f+(-1.5-2*h)*p+(-.5+h)*A+1,y=(-1-d)*f+(1.5+d)*p+.5*A,v=d*f-d*p;for(let b=0;b!==s;++b)i[b]=g*a[c+b]+m*a[l+b]+y*a[o+b]+v*a[u+b];return i}}class pm extends dm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(n-t)/(r-t),u=1-c;for(let h=0;h!==s;++h)i[h]=a[l+h]*u+a[o+h]*c;return i}}class fm extends dm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class gm{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sm(t,this.TimeBufferType),this.values=sm(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:sm(e.times,Array),values:sm(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new fm(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new pm(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Am(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Wl:t=this.InterpolantFactoryMethodDiscrete;break;case ql:t=this.InterpolantFactoryMethodLinear;break;case Kl:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wl;case this.InterpolantFactoryMethodLinear:return ql;case this.InterpolantFactoryMethodSmooth:return Kl}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let s=0;s!==i;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,a),e=!1;break}a=t}if(void 0!==r&&om(r))for(let s=0,o=r.length;s!==o;++s){const t=r[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Kl,i=e.length-1;let a=1;for(let s=1;s<i;++s){let i=!1;const o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,a=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[a+s]){i=!0;break}}}if(i){if(s!==a){e[a]=e[s];const r=s*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,s=0;s!==n;++s)t[r+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}gm.prototype.ValueTypeName="",gm.prototype.TimeBufferType=Float32Array,gm.prototype.ValueBufferType=Float32Array,gm.prototype.DefaultInterpolation=ql;class mm extends gm{constructor(e,t,n){super(e,t,n)}}mm.prototype.ValueTypeName="bool",mm.prototype.ValueBufferType=Array,mm.prototype.DefaultInterpolation=Wl,mm.prototype.InterpolantFactoryMethodLinear=void 0,mm.prototype.InterpolantFactoryMethodSmooth=void 0;class ym extends gm{constructor(e,t,n,r){super(e,t,n,r)}}ym.prototype.ValueTypeName="color";class vm extends gm{constructor(e,t,n,r){super(e,t,n,r)}}vm.prototype.ValueTypeName="number";class bm extends dm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(n-t)/(r-t);let l=e*s;for(let c=l+s;l!==c;l+=4)Au.slerpFlat(i,0,a,l-s,a,l,o);return i}}class xm extends gm{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new bm(this.times,this.values,this.getValueSize(),e)}}xm.prototype.ValueTypeName="quaternion",xm.prototype.InterpolantFactoryMethodSmooth=void 0;class wm extends gm{constructor(e,t,n){super(e,t,n)}}wm.prototype.ValueTypeName="string",wm.prototype.ValueBufferType=Array,wm.prototype.DefaultInterpolation=Wl,wm.prototype.InterpolantFactoryMethodLinear=void 0,wm.prototype.InterpolantFactoryMethodSmooth=void 0;class _m extends gm{constructor(e,t,n,r){super(e,t,n,r)}}_m.prototype.ValueTypeName="vector";class Sm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zl;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=au(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let a=0,s=n.length;a!==s;++a)t.push(Cm(n[a]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i.userData=JSON.parse(e.userData||"{}"),i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let i=0,a=n.length;i!==a;++i)t.push(gm.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,a=[];for(let s=0;s<i;s++){let e=[],o=[];e.push((s+i-1)%i,s,(s+1)%i),o.push(0,1,0);const l=lm(e);e=cm(e,1,l),o=cm(o,1,l),r||0!==e[0]||(e.push(i),o.push(o[0])),a.push(new vm(".morphTargetInfluences["+t[s].name+"]",e,o).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let s=0,o=e.length;s<o;s++){const t=e[s],n=t.name.match(i);if(n&&n.length>1){const e=n[1];let i=r[e];i||(r[e]=i=[]),i.push(t)}}const a=[];for(const s in r)a.push(this.CreateFromMorphTargetSequence(s,r[s],t,n));return a}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const a=[],s=[];um(n,a,s,r),0!==a.length&&i.push(new e(t,a,s))}},r=[],i=e.name||"default",a=e.fps||30,s=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let r=0;r<e[n].morphTargets.length;r++)t[e[n].morphTargets[r]]=-1;for(const i in t){const t=[],a=[];for(let r=0;r!==e[n].morphTargets.length;++r){const r=e[n];t.push(r.time),a.push(r.morphTarget===i?1:0)}r.push(new vm(".morphTargetInfluence["+i+"]",t,a))}o=t.length*a}else{const i=".bones["+t[c].name+"]";n(_m,i+".position",e,"pos",r),n(xm,i+".quaternion",e,"rot",r),n(_m,i+".scale",e,"scl",r)}}if(0===r.length)return null;return new this(i,o,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function Cm(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return vm;case"vector":case"vector2":case"vector3":case"vector4":return _m;case"color":return ym;case"quaternion":return xm;case"bool":case"boolean":return mm;case"string":return wm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];um(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Em={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Nm{constructor(e,t,n){const r=this;let i,a=!1,s=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(e){o++,!1===a&&void 0!==r.onStart&&r.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const km=new Nm;class Im{constructor(e){this.manager=void 0!==e?e:km,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Im.DEFAULT_MATERIAL_NAME="__DEFAULT";const Tm={};class Bm extends Error{constructor(e,t){super(e),this.response=t}}class Mm extends Im{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Em.get("file:".concat(e));if(void 0!==i)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(void 0!==Tm[e])return void Tm[e].push({onLoad:t,onProgress:n,onError:r});Tm[e]=[],Tm[e].push({onLoad:t,onProgress:n,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),s=this.mimeType,o=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=Tm[e],r=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),a=i?parseInt(i):0,s=0!==a;let o=0;const l=new ReadableStream({start(e){!function t(){r.read().then(r=>{let{done:i,value:l}=r;if(i)e.close();else{o+=l.byteLength;const r=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:a});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(l),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new Bm('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,s));case"json":return e.json();default:if(""===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{Em.add("file:".concat(e),t);const n=Tm[e];delete Tm[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=Tm[e];if(void 0===n)throw this.manager.itemError(e),t;delete Tm[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class Fm extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Mm(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Sm.parse(e[n]);t.push(r)}return t}}class Rm extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=[],s=new gf,o=new Mm(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials);let l=0;function c(c){o.load(e[c],function(e){const n=i.parse(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=Po),s.image=a,s.format=n.format,s.needsUpdate=!0,t&&t(s))},n,r)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)c(u);else o.load(e,function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}s.image=a}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=Po),s.format=n.format,s.needsUpdate=!0,t&&t(s)},n,r);return s}}const Lm=new WeakMap;class Pm extends Im{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Em.get("image:".concat(e));if(void 0!==a){if(!0===a.complete)i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0);else{let e=Lm.get(a);void 0===e&&(e=[],Lm.set(a,e)),e.push({onLoad:t,onError:r})}return a}const s=wu("img");function o(){c(),t&&t(this);const n=Lm.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}Lm.delete(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),Em.remove("image:".concat(e));const n=Lm.get(this)||[];for(let e=0;e<n.length;e++){const r=n[e];r.onError&&r.onError(t)}Lm.delete(this),i.manager.itemError(e),i.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),Em.add("image:".concat(e),s),i.manager.itemStart(e),s.src=e,s}}class Um extends Im{constructor(e){super(e)}load(e,t,n,r){const i=new fA;i.colorSpace=uc;const a=new Pm(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function o(n){a.load(e[n],function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(let l=0;l<e.length;++l)o(l);return i}}class Dm extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new np,s=new Mm(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,function(e){let n;try{n=i.parse(e)}catch(SS){if(void 0===r)return void console.error(SS);r(SS)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:Io,a.wrapT=void 0!==n.wrapT?n.wrapT:Io,a.magFilter=void 0!==n.magFilter?n.magFilter:Po,a.minFilter=void 0!==n.minFilter?n.minFilter:Po,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Oo),1===n.mipmapCount&&(a.minFilter=Po),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n)},n,r),a}}class Om extends Im{constructor(e){super(e)}load(e,t,n,r){const i=new Ou,a=new Pm(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class jm extends qh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new dd(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class zm extends jm{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(qh.DEFAULT_UP),this.updateMatrix(),this.groundColor=new dd(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Hm=new bh,Qm=new pu,Vm=new pu;class Gm{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new du(512,512),this.mapType=zo,this.map=null,this.mapPass=null,this.matrix=new bh,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new wp,this._frameExtents=new du(1,1),this._viewportCount=1,this._viewports=[new ju(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Qm.setFromMatrixPosition(e.matrixWorld),t.position.copy(Qm),Vm.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Vm),t.updateMatrixWorld(),Hm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Hm,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Hm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Wm extends Gm{constructor(){super(new dA(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*iu*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class qm extends jm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(qh.DEFAULT_UP),this.updateMatrix(),this.target=new qh,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new Wm}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Km=new bh,Xm=new pu,Ym=new pu;class Jm extends Gm{constructor(){super(new dA(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new du(4,2),this._viewportCount=6,this._viewports=[new ju(2,1,1,1),new ju(0,1,1,1),new ju(3,1,1,1),new ju(1,1,1,1),new ju(3,0,1,1),new ju(1,0,1,1)],this._cubeDirections=[new pu(1,0,0),new pu(-1,0,0),new pu(0,0,1),new pu(0,0,-1),new pu(0,1,0),new pu(0,-1,0)],this._cubeUps=[new pu(0,1,0),new pu(0,1,0),new pu(0,1,0),new pu(0,1,0),new pu(0,0,1),new pu(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Xm.setFromMatrixPosition(e.matrixWorld),n.position.copy(Xm),Ym.copy(n.position),Ym.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Ym),n.updateMatrixWorld(),r.makeTranslation(-Xm.x,-Xm.y,-Xm.z),Km.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Km,n.coordinateSystem,n.reversedDepth)}}class Zm extends jm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Jm}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class $m extends lA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,s=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,s,o,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class ey extends Gm{constructor(){super(new $m(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ty extends jm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(qh.DEFAULT_UP),this.updateMatrix(),this.target=new qh,this.shadow=new ey}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ny extends jm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class ry extends jm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class iy{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new pu)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class ay extends jm{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new iy;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class sy extends Im{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,a=new Mm(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new dd).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const i in e.uniforms){const t=e.uniforms[i];switch(r.uniforms[i]={},t.type){case"t":r.uniforms[i].value=n(t.value);break;case"c":r.uniforms[i].value=(new dd).setHex(t.value);break;case"v2":r.uniforms[i].value=(new du).fromArray(t.value);break;case"v3":r.uniforms[i].value=(new pu).fromArray(t.value);break;case"v4":r.uniforms[i].value=(new ju).fromArray(t.value);break;case"m3":r.uniforms[i].value=(new mu).fromArray(t.value);break;case"m4":r.uniforms[i].value=(new bh).fromArray(t.value);break;default:r.uniforms[i].value=t.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const i in e.extensions)r.extensions[i]=e.extensions[i];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new du).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new du).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return sy.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Kg,SpriteMaterial:EA,RawShaderMaterial:Xg,ShaderMaterial:oA,PointsMaterial:sf,MeshPhysicalMaterial:Jg,MeshStandardMaterial:Yg,MeshPhongMaterial:Zg,MeshToonMaterial:$g,MeshNormalMaterial:em,MeshLambertMaterial:tm,MeshDepthMaterial:nm,MeshDistanceMaterial:rm,MeshBasicMaterial:gd,MeshMatcapMaterial:im,LineDashedMaterial:am,LineBasicMaterial:Gp,Material:fd}[e]}}class oy{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ly extends Hd{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class cy extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Mm(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers,i=r[t],a=new Uint32Array(i).buffer;return n[t]=a,a}(e,i.buffer),s=xu(i.type,a),o=new _A(s,i.stride);return o.uuid=i.uuid,t[r]=o,o}const i=e.isInstancedBufferGeometry?new ly:new Hd,a=e.data.index;if(void 0!==a){const e=xu(a.type,a.array);i.setIndex(new Cd(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute){const i=r(e.data,t.data);n=new CA(i,t.itemSize,t.offset,t.normalized)}else{const e=xu(t.type,t.array);n=new(t.isInstancedBufferAttribute?sp:Cd)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),i.setAttribute(u,n)}const o=e.data.morphAttributes;if(o)for(const u in o){const t=o[u],n=[];for(let i=0,a=t.length;i<a;i++){const a=t[i];let s;if(a.isInterleavedBufferAttribute){const t=r(e.data,a.data);s=new CA(t,a.itemSize,a.offset,a.normalized)}else{const e=xu(a.type,a.array);s=new Cd(e,a.itemSize,a.normalized)}void 0!==a.name&&(s.name=a.name),n.push(s)}i.morphAttributes[u]=n}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const e=l[u];i.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;return void 0!==c&&(i.boundingSphere=(new hh).fromJSON(c)),e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}class uy extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===this.path?oy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const s=new Mm(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){let a=null;try{a=JSON.parse(n)}catch(SS){return void 0!==r&&r(SS),void console.error("THREE:ObjectLoader: Can't parse "+e+".",SS.message)}const s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(a,t)},n,r)}async loadAsync(e,t){const n=""===this.path?oy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Mm(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),a=JSON.parse(i),s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){void 0!==t&&t(l)}),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,o,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,r,s,a,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new tg).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let i=0,a=e.length;i<a;i++){const t=(new ap).fromJSON(e[i],r);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new cy;for(let i=0,a=e.length;i<a;i++){let a;const s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;default:s.type in qg?a=qg[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new sy;i.setTextures(t);for(let t=0,a=e.length;t<a;t++){const a=e[t];void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Sm.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function a(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:xu(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Nm(t);i=new Pm(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=a(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new np(n.data,n.width,n.height)))}r[n.uuid]=new Lu(e)}else{const e=a(n.url);r[n.uuid]=new Lu(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"===typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:xu(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Pm(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],a=r.url;if(Array.isArray(a)){const e=[];for(let t=0,n=a.length;t<n;t++){const n=a[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new np(r.data,r.width,r.height)))}n[r.uuid]=new Lu(e)}else{const e=await i(r.url);n[r.uuid]=new Lu(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,a=e.length;i<a;i++){const a=e[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const s=t[a.image],o=s.data;let l;Array.isArray(o)?(l=new fA,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new np:new Ou,o&&(l.needsUpdate=!0)),l.source=s,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=n(a.mapping,hy)),void 0!==a.channel&&(l.channel=a.channel),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=n(a.wrap[0],dy),l.wrapT=n(a.wrap[1],dy)),void 0!==a.format&&(l.format=a.format),void 0!==a.internalFormat&&(l.internalFormat=a.internalFormat),void 0!==a.type&&(l.type=a.type),void 0!==a.colorSpace&&(l.colorSpace=a.colorSpace),void 0!==a.minFilter&&(l.minFilter=n(a.minFilter,Ay)),void 0!==a.magFilter&&(l.magFilter=n(a.magFilter,Ay)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.generateMipmaps&&(l.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(l.compareFunction=a.compareFunction),void 0!==a.userData&&(l.userData=a.userData),r[a.uuid]=l}return r}parseObject(e,t,n,r,i){let a,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new wA,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new dd(e.background):a.background=u(e.background)),void 0!==e.environment&&(a.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new xA(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new bA(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new dA(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new $m(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new ny(e.color,e.intensity);break;case"DirectionalLight":a=new ty(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Zm(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new ry(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new qm(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new zm(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new ay).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),o=c(e.material),a=new ep(s,o),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),o=c(e.material),a=new eA(s,o);break;case"InstancedMesh":s=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;a=new pp(s,o,t),a.instanceMatrix=new sp(new Float32Array(n.array),16),void 0!==r&&(a.instanceColor=new sp(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=c(e.material),a=new Vp(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),a.geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new qu).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new hh).fromJSON(e.boundingSphere)),M(M({},e),{},{boundingBox:t,boundingSphere:n})}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=u(e.matricesTexture.uuid),a._indirectTexture=u(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(a._colorsTexture=u(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(a.boundingSphere=(new hh).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(a.boundingBox=(new qu).fromJSON(e.boundingBox));break;case"LOD":a=new VA;break;case"Line":a=new $p(l(e.geometry),c(e.material));break;case"LineLoop":a=new af(l(e.geometry),c(e.material));break;case"LineSegments":a=new rf(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new hf(l(e.geometry),c(e.material));break;case"Sprite":a=new jA(c(e.material));break;case"Group":a=new mA;break;case"Bone":a=new tp;break;default:a=new qh}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(a.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];a.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,r=e.getObjectByProperty("uuid",n);t.target=void 0!==r?r:new qh}})}}const hy={UVMapping:wo,CubeReflectionMapping:_o,CubeRefractionMapping:So,EquirectangularReflectionMapping:Co,EquirectangularRefractionMapping:Eo,CubeUVReflectionMapping:No},dy={RepeatWrapping:ko,ClampToEdgeWrapping:Io,MirroredRepeatWrapping:To},Ay={NearestFilter:Bo,NearestMipmapNearestFilter:Mo,NearestMipmapLinearFilter:Ro,LinearFilter:Po,LinearMipmapNearestFilter:Uo,LinearMipmapLinearFilter:Oo},py=new WeakMap;class fy extends Im{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Em.get("image-bitmap:".concat(e));if(void 0!==a)return i.manager.itemStart(e),a.then?void a.then(n=>{if(!0!==py.has(a))return t&&t(n),i.manager.itemEnd(e),n;r&&r(py.get(a)),i.manager.itemError(e),i.manager.itemEnd(e)}):(setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,s.signal="function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const o=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(n){return Em.add("image-bitmap:".concat(e),n),t&&t(n),i.manager.itemEnd(e),n}).catch(function(t){r&&r(t),py.set(o,t),Em.remove("image-bitmap:".concat(e)),i.manager.itemError(e),i.manager.itemEnd(e)});Em.add("image-bitmap:".concat(e),o),i.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let gy;class my{static getContext(){return void 0===gy&&(gy=new(window.AudioContext||window.webkitAudioContext)),gy}static setContext(e){gy=e}}class yy extends Im{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Mm(this.manager);function s(t){r?r(t):console.error(t),i.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){try{const n=e.slice(0);my.getContext().decodeAudioData(n,function(e){t(e)}).catch(s)}catch(n){s(n)}},n,r)}}const vy=new bh,by=new bh,xy=new bh;class wy{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new dA,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new dA,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,xy.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(ru*t.fov*.5)/t.zoom;let a,s;by.elements[12]=-n,vy.elements[12]=n,a=-i*t.aspect+r,s=i*t.aspect+r,xy.elements[0]=2*t.near/(s-a),xy.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(xy),a=-i*t.aspect-r,s=i*t.aspect-r,xy.elements[0]=2*t.near/(s-a),xy.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(xy)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(by),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(vy)}}class _y extends dA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Sy{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Cy=new pu,Ey=new Au,Ny=new pu,ky=new pu,Iy=new pu;class Ty extends qh{constructor(){super(),this.type="AudioListener",this.context=my.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Sy}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Cy,Ey,Ny),ky.set(0,0,-1).applyQuaternion(Ey),Iy.set(0,1,0).applyQuaternion(Ey),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Cy.x,e),t.positionY.linearRampToValueAtTime(Cy.y,e),t.positionZ.linearRampToValueAtTime(Cy.z,e),t.forwardX.linearRampToValueAtTime(ky.x,e),t.forwardY.linearRampToValueAtTime(ky.y,e),t.forwardZ.linearRampToValueAtTime(ky.z,e),t.upX.linearRampToValueAtTime(Iy.x,e),t.upY.linearRampToValueAtTime(Iy.y,e),t.upZ.linearRampToValueAtTime(Iy.z,e)}else t.setPosition(Cy.x,Cy.y,Cy.z),t.setOrientation(ky.x,ky.y,ky.z,Iy.x,Iy.y,Iy.z)}}class By extends qh{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const My=new pu,Fy=new Au,Ry=new pu,Ly=new pu;class Py extends By{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(My,Fy,Ry),Ly.set(0,0,1).applyQuaternion(Fy);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(My.x,e),t.positionY.linearRampToValueAtTime(My.y,e),t.positionZ.linearRampToValueAtTime(My.z,e),t.orientationX.linearRampToValueAtTime(Ly.x,e),t.orientationY.linearRampToValueAtTime(Ly.y,e),t.orientationZ.linearRampToValueAtTime(Ly.z,e)}else t.setPosition(My.x,My.y,My.z),t.setOrientation(Ly.x,Ly.y,Ly.z)}}class Uy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Dy{constructor(e,t,n){let r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;const e=t/a;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(n[o]!==n[o+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let a=0;a!==i;++a)e[t+a]=e[n+a]}_slerp(e,t,n,r){Au.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const a=this._workIndex*i;Au.multiplyQuaternionsFlat(e,a,e,t,e,n),Au.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,n,r,i){const a=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*a+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]+e[n+a]*r}}}const Oy="\\[\\]\\.:\\/",jy=new RegExp("["+Oy+"]","g"),zy="[^"+Oy+"]",Hy="[^"+Oy.replace("\\.","")+"]",Qy=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",zy)+/(WCOD+)?/.source.replace("WCOD",Hy)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zy)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zy)+"$"),Vy=["material","materials","bones","map"];class Gy{constructor(e,t,n){this.path=t,this.parsedPath=n||Gy.parseTrackName(t),this.node=Gy.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Gy.Composite(e,t,n):new Gy(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(jy,"")}static parseTrackName(e){const t=Qy.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Vy.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Gy.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?s=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Gy.Composite=class{constructor(e,t,n){const r=n||Gy.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Gy.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Gy.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Gy.prototype.GetterByBindingType=[Gy.prototype._getValue_direct,Gy.prototype._getValue_array,Gy.prototype._getValue_arrayElement,Gy.prototype._getValue_toArray],Gy.prototype.SetterByBindingTypeAndVersioning=[[Gy.prototype._setValue_direct,Gy.prototype._setValue_direct_setNeedsUpdate,Gy.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Gy.prototype._setValue_array,Gy.prototype._setValue_array_setNeedsUpdate,Gy.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Gy.prototype._setValue_arrayElement,Gy.prototype._setValue_arrayElement_setNeedsUpdate,Gy.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Gy.prototype._setValue_fromArray,Gy.prototype._setValue_fromArray_setNeedsUpdate,Gy.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Wy{constructor(){this.isAnimationObjectGroup=!0,this.uuid=au(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length;let s,o=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(u);for(let e=0,t=a;e!==t;++e)i[e].push(new Gy(u,n[e],r[e]))}else if(d<l){s=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[h]=o,e[o]=u;for(let e=0,t=a;e!==t;++e){const t=i[e],a=t[o];let s=t[d];t[d]=a,void 0===s&&(s=new Gy(u,n[e],r[e])),t[o]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=i){const a=i++,c=e[a];t[c.uuid]=l,e[l]=c,t[o]=a,e[a]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[l];t[l]=r,t[a]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,a=e.length;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<i){const s=--i,o=e[s],c=--a,u=e[c];t[o.uuid]=l,e[l]=o,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[c];t[l]=r,t[s]=i,t.pop()}}else{const i=--a,s=e[i];i>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),s.push(t),i.push(u);for(let h=c,d=o.length;h!==d;++h){const n=o[h];u[h]=new Gy(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=n,a[n]=o,a.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}class qy{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,a=i.length,s=new Array(a),o={endingStart:Xl,endingEnd:Xl};for(let l=0;l!==a;++l){const e=i[l].createInterpolant(null);s[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Vl,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,r=e._clip.duration,i=r/n,a=n/r;e.warp(1,i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=i,o[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const a=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===$l)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const a=n===Gl;if(0===e)return-1===i?r:a&&1===(1&i)?t-r:r;if(n===Ql){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&1===(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Yl,r.endingEnd=Yl):(r.endingStart=e?this.zeroSlopeAtStart?Yl:Xl:Jl,r.endingEnd=t?this.zeroSlopeAtEnd?Yl:Xl:Jl)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,o=a.sampleValues;return s[0]=i,o[0]=t,s[1]=i+e,o[1]=n,this}}const Ky=new Float32Array(1);class Xy extends eu{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,s=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let u=0;u!==i;++u){const e=r[u],i=e.name;let l=c[i];if(void 0!==l)++l.referenceCount,a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,i));continue}const r=t&&t._propertyBindings[u].binding.parsedPath;l=new Dy(Gy.create(n,i,r),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,i),a[u]=l}s[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,s=a[i],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,s=a[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[i],0===Object.keys(s).length&&delete a[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new pm(new Float32Array(2),new Float32Array(2),1,Ky),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let a="string"===typeof e?Sm.findByName(r,e):e;const s=null!==a?a.uuid:e,o=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:Zl),void 0!==o){const e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new qy(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"===typeof e?Sm.findByName(n,e):e,a=i?i.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(r,e,i,a)}const s=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)s[l].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=i,t[i]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const i in n){const e=n[i].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const i in r){const e=r[i];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Yy extends zu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Gu(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class Jy{constructor(e){this.value=e}clone(){return new Jy(void 0===this.value.clone?this.value:this.value.clone())}}let Zy=0;class $y extends eu{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Zy++}),this.name="",this.usage=Dc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class ev extends _A{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class tv{constructor(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.normalized=a,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const nv=new bh;class rv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new vh(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Bh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return nv.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(nv),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return av(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(iv),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let r=0,i=e.length;r<i;r++)av(e[r],this,n,t);return n.sort(iv),n}}function iv(e,t){return e.distance-t.distance}function av(e,t,n,r){let i=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(i=!1)}if(!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)av(r[e],t,n,!0)}}class sv{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=ov.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function ov(){!1===this._document.hidden&&this.reset()}class lv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=su(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(su(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class cv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}class uv{constructor(e,t,n,r){uv.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}const hv=new du;class dv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new du(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new du(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=hv.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hv).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Av=new pu,pv=new pu,fv=new pu,gv=new pu,mv=new pu,yv=new pu,vv=new pu;class bv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Av.subVectors(e,this.start),pv.subVectors(this.end,this.start);const n=pv.dot(pv);let r=pv.dot(Av)/n;return t&&(r=su(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}distanceSqToLine3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yv,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vv;const r=1e-8*1e-8;let i,a;const s=this.start,o=e.start,l=this.end,c=e.end;fv.subVectors(l,s),gv.subVectors(c,o),mv.subVectors(s,o);const u=fv.dot(fv),h=gv.dot(gv),d=gv.dot(mv);if(u<=r&&h<=r)return t.copy(s),n.copy(o),t.sub(n),t.dot(t);if(u<=r)i=0,a=d/h,a=su(a,0,1);else{const e=fv.dot(mv);if(h<=r)a=0,i=su(-e/u,0,1);else{const t=fv.dot(gv),n=u*h-t*t;i=0!==n?su((t*d-e*h)/n,0,1):0,a=(t*i+d)/h,a<0?(a=0,i=su(-e/u,0,1)):a>1&&(a=1,i=su((t-e)/u,0,1))}}return t.copy(s).add(fv.multiplyScalar(i)),n.copy(o).add(gv.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const xv=new pu;class wv extends qh{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Hd,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,s=1,o=32;a<o;a++,s++){const e=a/o*Math.PI*2,t=s/o*Math.PI*2;r.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Rd(r,3));const i=new Gp({fog:!1,toneMapped:!1});this.cone=new rf(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xv),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _v=new pu,Sv=new bh,Cv=new bh;class Ev extends rf{constructor(e){const t=Nv(e),n=new Hd,r=[],i=[];for(let o=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(0,0,0),i.push(0,0,0))}n.setAttribute("position",new Rd(r,3)),n.setAttribute("color",new Rd(i,3));super(n,new Gp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const a=new dd(255),s=new dd(65280);this.setColors(a,s)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Cv.copy(this.root.matrixWorld).invert();for(let i=0,a=0;i<t.length;i++){const e=t[i];e.parent&&e.parent.isBone&&(Sv.multiplyMatrices(Cv,e.matrixWorld),_v.setFromMatrixPosition(Sv),r.setXYZ(a,_v.x,_v.y,_v.z),Sv.multiplyMatrices(Cv,e.parent.matrixWorld),_v.setFromMatrixPosition(Sv),r.setXYZ(a+1,_v.x,_v.y,_v.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let r=0;r<n.count;r+=2)n.setXYZ(r,e.r,e.g,e.b),n.setXYZ(r+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Nv(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...Nv(e.children[n]));return t}class kv extends eA{constructor(e,t,n){super(new jg(t,4,2),new gd({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Iv=new pu,Tv=new dd,Bv=new dd;class Mv extends qh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Pg(t);r.rotateY(.5*Math.PI),this.material=new gd({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new Cd(a,3)),this.add(new eA(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Tv.copy(this.light.color),Bv.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Tv:Bv;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Iv.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Fv extends rf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new dd(n),r=new dd(r);const i=t/2,a=e/t,s=e/2,o=[],l=[];for(let u=0,h=0,d=-s;u<=t;u++,d+=a){o.push(-s,0,d,s,0,d),o.push(d,0,-s,d,0,s);const e=u===i?n:r;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const c=new Hd;c.setAttribute("position",new Rd(o,3)),c.setAttribute("color",new Rd(l,3));super(c,new Gp({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rv extends rf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;i=new dd(i),a=new dd(a);const s=[],o=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),r=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(r,0,l);const u=1&c?i:a;o.push(u.r,u.g,u.b),o.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?i:a,l=e-e/n*c;for(let e=0;e<r;e++){let n=e/r*(2*Math.PI),i=Math.sin(n)*l,a=Math.cos(n)*l;s.push(i,0,a),o.push(t.r,t.g,t.b),n=(e+1)/r*(2*Math.PI),i=Math.sin(n)*l,a=Math.cos(n)*l,s.push(i,0,a),o.push(t.r,t.g,t.b)}}const l=new Hd;l.setAttribute("position",new Rd(s,3)),l.setAttribute("color",new Rd(o,3));super(l,new Gp({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Lv=new pu,Pv=new pu,Uv=new pu;class Dv extends qh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Hd;r.setAttribute("position",new Rd([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new Gp({fog:!1,toneMapped:!1});this.lightPlane=new $p(r,i),this.add(this.lightPlane),r=new Hd,r.setAttribute("position",new Rd([0,0,0,0,0,1],3)),this.targetLine=new $p(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Lv.setFromMatrixPosition(this.light.matrixWorld),Pv.setFromMatrixPosition(this.light.target.matrixWorld),Uv.subVectors(Pv,Lv),this.lightPlane.lookAt(Pv),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Pv),this.targetLine.scale.z=Uv.length()}}const Ov=new pu,jv=new lA;class zv extends rf{constructor(e){const t=new Hd,n=new Gp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],a={};function s(e,t){o(e),o(t)}function o(e){r.push(0,0,0),i.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new Rd(r,3)),t.setAttribute("color",new Rd(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new dd(16755200),c=new dd(16711680),u=new dd(43775),h=new dd(16777215),d=new dd(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,r,i){const a=this.geometry.getAttribute("color");return a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,r;if(jv.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,r=0;else if(this.camera.coordinateSystem===Xc)n=-1,r=1;else{if(this.camera.coordinateSystem!==Yc)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,r=1}Hv("c",t,e,jv,0,0,n),Hv("t",t,e,jv,0,0,r),Hv("n1",t,e,jv,-1,-1,n),Hv("n2",t,e,jv,1,-1,n),Hv("n3",t,e,jv,-1,1,n),Hv("n4",t,e,jv,1,1,n),Hv("f1",t,e,jv,-1,-1,r),Hv("f2",t,e,jv,1,-1,r),Hv("f3",t,e,jv,-1,1,r),Hv("f4",t,e,jv,1,1,r),Hv("u1",t,e,jv,.7,1.1,n),Hv("u2",t,e,jv,-.7,1.1,n),Hv("u3",t,e,jv,0,2,n),Hv("cf1",t,e,jv,-1,0,r),Hv("cf2",t,e,jv,1,0,r),Hv("cf3",t,e,jv,0,-1,r),Hv("cf4",t,e,jv,0,1,r),Hv("cn1",t,e,jv,-1,0,n),Hv("cn2",t,e,jv,1,0,n),Hv("cn3",t,e,jv,0,-1,n),Hv("cn4",t,e,jv,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Hv(e,t,n,r,i,a,s){Ov.set(i,a,s).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],Ov.x,Ov.y,Ov.z)}}const Qv=new qu;class Vv extends rf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Hd;i.setIndex(new Cd(n,1)),i.setAttribute("position",new Cd(r,3)),super(i,new Gp({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Qv.setFromObject(this.object),Qv.isEmpty())return;const e=Qv.min,t=Qv.max,n=this.geometry.attributes.position,r=n.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Gv extends rf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Hd;r.setIndex(new Cd(n,1)),r.setAttribute("position",new Rd([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Gp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Wv extends $p{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,r=new Hd;r.setAttribute("position",new Rd([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Gp({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const i=new Hd;i.setAttribute("position",new Rd([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new eA(i,new gd({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const qv=new pu;let Kv,Xv;class Yv extends qh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*i;super(),this.type="ArrowHelper",void 0===Kv&&(Kv=new Hd,Kv.setAttribute("position",new Rd([0,0,0,0,1,0],3)),Xv=new Cf(.5,1,5,1),Xv.translate(0,-.5,0)),this.position.copy(t),this.line=new $p(Kv,new Gp({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new eA(Xv,new gd({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{qv.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(qv,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Jv extends rf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Hd;n.setAttribute("position",new Rd(t,3)),n.setAttribute("color",new Rd([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Gp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new dd,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Zv{constructor(){this.type="ShapePath",this.color=new dd,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new eg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],s=t[a],o=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],o=-o,s=t[i],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const n=Ig.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,a,s;const o=[];if(1===r.length)return a=r[0],s=new tg,s.curves=a.curves,o.push(s),o;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,A=[],p=0;u[p]=void 0,A[p]=[];for(let f=0,g=r.length;f<g;f++)a=r[f],h=a.getPoints(),i=n(h),i=e?!i:i,i?(!l&&u[p]&&p++,u[p]={s:new tg,p:h},u[p].s.curves=a.curves,l&&p++,A[p]=[]):A[p].push({h:a,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new tg;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let t=0,r=u.length;t<r;t++)c[t]=[];for(let r=0,i=u.length;r<i;r++){const i=A[r];for(let a=0;a<i.length;a++){const s=i[a];let o=!0;for(let i=0;i<u.length;i++)t(s.p,u[i].p)&&(r!==i&&n++,o?(o=!1,c[i].push(s)):e=!0);o&&c[r].push(s)}}n>0&&!1===e&&(A=c)}for(let f=0,g=u.length;f<g;f++){s=u[f].s,o.push(s),d=A[f];for(let e=0,t=d.length;e<t;e++)s.holes.push(d[e].h)}return o}}class $v extends eu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function eb(e,t,n,r){const i=function(e){switch(e){case zo:case Ho:return{byteLength:1,components:1};case Vo:case Qo:case Ko:return{byteLength:2,components:1};case Xo:case Yo:return{byteLength:2,components:4};case Wo:case Go:case qo:return{byteLength:4,components:1};case Zo:case $o:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(e,"."))}(r);switch(n){case el:return e*t;case al:case sl:return e*t/i.components*i.byteLength;case ol:case ll:return e*t*2/i.components*i.byteLength;case tl:return e*t*3/i.components*i.byteLength;case nl:case ul:return e*t*4/i.components*i.byteLength;case hl:case dl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Al:case pl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case gl:case yl:return Math.max(e,16)*Math.max(t,8)/4;case fl:case ml:return Math.max(e,8)*Math.max(t,8)/2;case vl:case bl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case xl:case wl:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case _l:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case Sl:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case Cl:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case El:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case Nl:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case kl:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Il:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case Tl:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Bl:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Ml:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Fl:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Rl:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Ll:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case Pl:case Ul:case Dl:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Ol:case jl:return Math.ceil(e/4)*Math.ceil(t/4)*8;case zl:case Hl:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}class tb{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,r){return eb(e,t,n,r)}}function nb(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function rb(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,a=r.byteLength,s=e.createBuffer();let o;if(e.bindBuffer(n,s),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)o=e.FLOAT;else if("undefined"!==typeof Float16Array&&r instanceof Float16Array)o=e.HALF_FLOAT;else if(r instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=e.SHORT;else if(r instanceof Uint32Array)o=e.UNSIGNED_INT;else if(r instanceof Int32Array)o=e.INT;else if(r instanceof Int8Array)o=e.BYTE;else if(r instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=e.UNSIGNED_BYTE}return{buffer:s,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:a}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,a=n.updateRanges;if(e.bindBuffer(r,t),0===a.length)e.bufferSubData(r,0,i);else{a.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<a.length;e++){const n=a[t],r=a[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,a[t]=r)}a.length=t+1;for(let n=0,s=a.length;n<s;n++){const t=a[n];e.bufferSubData(r,t.start*i.BYTES_PER_ELEMENT,i,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ps}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ps);const ib={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare, distribution.x );\n\t\t#endif\n\t\tif ( hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ab={common:{diffuse:{value:new dd(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new mu},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new mu}},envmap:{envMap:{value:null},envMapRotation:{value:new mu},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new mu}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new mu}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new mu},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new mu},normalScale:{value:new du(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new mu},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new mu}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new mu}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new mu}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dd(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dd(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0},uvTransform:{value:new mu}},sprite:{diffuse:{value:new dd(16777215)},opacity:{value:1},center:{value:new du(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new mu},alphaMap:{value:null},alphaMapTransform:{value:new mu},alphaTest:{value:0}}},sb={basic:{uniforms:iA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.fog]),vertexShader:ib.meshbasic_vert,fragmentShader:ib.meshbasic_frag},lambert:{uniforms:iA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,ab.lights,{emissive:{value:new dd(0)}}]),vertexShader:ib.meshlambert_vert,fragmentShader:ib.meshlambert_frag},phong:{uniforms:iA([ab.common,ab.specularmap,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,ab.lights,{emissive:{value:new dd(0)},specular:{value:new dd(1118481)},shininess:{value:30}}]),vertexShader:ib.meshphong_vert,fragmentShader:ib.meshphong_frag},standard:{uniforms:iA([ab.common,ab.envmap,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.roughnessmap,ab.metalnessmap,ab.fog,ab.lights,{emissive:{value:new dd(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ib.meshphysical_vert,fragmentShader:ib.meshphysical_frag},toon:{uniforms:iA([ab.common,ab.aomap,ab.lightmap,ab.emissivemap,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.gradientmap,ab.fog,ab.lights,{emissive:{value:new dd(0)}}]),vertexShader:ib.meshtoon_vert,fragmentShader:ib.meshtoon_frag},matcap:{uniforms:iA([ab.common,ab.bumpmap,ab.normalmap,ab.displacementmap,ab.fog,{matcap:{value:null}}]),vertexShader:ib.meshmatcap_vert,fragmentShader:ib.meshmatcap_frag},points:{uniforms:iA([ab.points,ab.fog]),vertexShader:ib.points_vert,fragmentShader:ib.points_frag},dashed:{uniforms:iA([ab.common,ab.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ib.linedashed_vert,fragmentShader:ib.linedashed_frag},depth:{uniforms:iA([ab.common,ab.displacementmap]),vertexShader:ib.depth_vert,fragmentShader:ib.depth_frag},normal:{uniforms:iA([ab.common,ab.bumpmap,ab.normalmap,ab.displacementmap,{opacity:{value:1}}]),vertexShader:ib.meshnormal_vert,fragmentShader:ib.meshnormal_frag},sprite:{uniforms:iA([ab.sprite,ab.fog]),vertexShader:ib.sprite_vert,fragmentShader:ib.sprite_frag},background:{uniforms:{uvTransform:{value:new mu},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ib.background_vert,fragmentShader:ib.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new mu}},vertexShader:ib.backgroundCube_vert,fragmentShader:ib.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ib.cube_vert,fragmentShader:ib.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ib.equirect_vert,fragmentShader:ib.equirect_frag},distanceRGBA:{uniforms:iA([ab.common,ab.displacementmap,{referencePosition:{value:new pu},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ib.distanceRGBA_vert,fragmentShader:ib.distanceRGBA_frag},shadow:{uniforms:iA([ab.lights,ab.fog,{color:{value:new dd(0)},opacity:{value:1}}]),vertexShader:ib.shadow_vert,fragmentShader:ib.shadow_frag}};sb.physical={uniforms:iA([sb.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new mu},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new mu},clearcoatNormalScale:{value:new du(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new mu},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new mu},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new mu},sheen:{value:0},sheenColor:{value:new dd(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new mu},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new mu},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new mu},transmissionSamplerSize:{value:new du},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new mu},attenuationDistance:{value:0},attenuationColor:{value:new dd(0)},specularColor:{value:new dd(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new mu},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new mu},anisotropyVector:{value:new du},anisotropyMap:{value:null},anisotropyMapTransform:{value:new mu}}]),vertexShader:ib.meshphysical_vert,fragmentShader:ib.meshphysical_frag};const ob={r:0,b:0,g:0},lb=new Th,cb=new bh;function ub(e,t,n,r,i,a,s){const o=new dd(0);let l,c,u=!0===a?0:1,h=null,d=0,A=null;function p(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function f(t,n){t.getRGB(ob,aA(e)),r.buffers.color.setClear(ob.r,ob.g,ob.b,n,s)}return{getClearColor:function(){return o},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o.set(e),u=t,f(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(o,u)},render:function(t){let n=!1;const i=p(t);null===i?f(o,u):i&&i.isColor&&(f(i,1),n=!0);const a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=p(n);r&&(r.isCubeTexture||r.mapping===No)?(void 0===c&&(c=new eA(new nA(1,1,1),new oA({name:"BackgroundCubeMaterial",uniforms:rA(sb.backgroundCube.uniforms),vertexShader:sb.backgroundCube.vertexShader,fragmentShader:sb.backgroundCube.fragmentShader,side:Es,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),lb.copy(n.backgroundRotation),lb.x*=-1,lb.y*=-1,lb.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(lb.y*=-1,lb.z*=-1),c.material.uniforms.envMap.value=r,c.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(cb.makeRotationFromEuler(lb)),c.material.toneMapped=Iu.getTransfer(r.colorSpace)!==Ac,h===r&&d===r.version&&A===e.toneMapping||(c.material.needsUpdate=!0,h=r,d=r.version,A=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new eA(new Ug(2,2),new oA({name:"BackgroundMaterial",uniforms:rA(sb.background.uniforms),vertexShader:sb.background.vertexShader,fragmentShader:sb.background.fragmentShader,side:Cs,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Iu.getTransfer(r.colorSpace)!==Ac,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&d===r.version&&A===e.toneMapping||(l.material.needsUpdate=!0,h=r,d=r.version,A=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function hb(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=c(null);let a=i,s=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],r=[],i=[];for(let a=0;a<n;a++)t[a]=0,r[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const r=a.newAttributes,i=a.enabledAttributes,s=a.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function A(){const t=a.newAttributes,n=a.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,r,i,a,s,o){!0===o?e.vertexAttribIPointer(t,n,r,a,s):e.vertexAttribPointer(t,n,r,i,a,s)}function f(){g(),s=!0,a!==i&&(a=i,o(a.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,f,g){let m=!1;const y=function(t,n,i){const a=!0===i.wireframe;let s=r[t.id];void 0===s&&(s={},r[t.id]=s);let o=s[n.id];void 0===o&&(o={},s[n.id]=o);let l=o[a];void 0===l&&(l=c(e.createVertexArray()),o[a]=l);return l}(f,l,i);a!==y&&(a=y,o(a.object)),m=function(e,t,n,r){const i=a.attributes,s=t.attributes;let o=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){const t=i[a];let n=s[a];if(void 0===n&&("instanceMatrix"===a&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return a.attributesNum!==o||a.index!==r}(n,f,l,g),m&&function(e,t,n,r){const i={},s=t.attributes;let o=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){let t=s[a];void 0===t&&("instanceMatrix"===a&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[a]=n,o++}}a.attributes=i,a.attributesNum=o,a.index=r}(n,f,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(m||s)&&(s=!1,function(n,r,i,a){u();const s=a.attributes,o=i.getAttributes(),l=r.defaultAttributeValues;for(const c in o){const r=o[c];if(r.location>=0){let i=s[c];if(void 0===i&&("instanceMatrix"===c&&n.instanceMatrix&&(i=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(i=n.instanceColor)),void 0!==i){const s=i.normalized,o=i.itemSize,l=t.get(i);if(void 0===l)continue;const c=l.buffer,u=l.type,A=l.bytesPerElement,f=u===e.INT||u===e.UNSIGNED_INT||i.gpuType===Go;if(i.isInterleavedBufferAttribute){const t=i.data,l=t.stride,g=i.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)d(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,o/r.locationSize,u,s,l*A,(g+o/r.locationSize*e)*A,f)}else{if(i.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)d(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)h(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,o/r.locationSize,u,s,o*A,o/r.locationSize*e*A,f)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}A()}(n,i,l,f),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:f,resetDefaultState:g,dispose:function(){f();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:A}}function db(e,t,n){let r;function i(t,i,a){0!==a&&(e.drawArraysInstanced(r,t,i,a),n.update(i,r,a))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,a);let s=0;for(let t=0;t<a;t++)s+=i[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,a,s,o){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],a[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,a,0,o,0,s);let t=0;for(let e=0;e<s;e++)t+=a[e]*o[e];n.update(t,r,1)}}}function Ab(e,t,n,r){let i;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const o=a(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:a,textureFormatReadable:function(t){return t===nl||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===Ko&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==zo&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==qo&&!i)},precision:s,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function pb(e){const t=this;let n=null,r=0,i=!1,a=!1;const s=new yp,o=new mu,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=r;n!==a;++n,l+=4)s.copy(e[n]).applyMatrix4(i,o),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,o,u){const h=s.clippingPlanes,d=s.clipIntersection,A=s.clipShadows,p=e.get(s);if(!i||null===h||0===h.length||a&&!A)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=a?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=c(h,o,t,u);for(let r=0;r!==t;++r)i[r]=n[r];p.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function fb(e){let t=new WeakMap;function n(e,t){return t===Co?e.mapping=_o:t===Eo&&(e.mapping=So),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===Co||a===Eo){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const a=i.image;if(a&&a.height>0){const s=new gA(a.height);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}const gb=[.125,.215,.35,.446,.526,.582],mb=20,yb=new $m,vb=new dd;let bb=null,xb=0,wb=0,_b=!1;const Sb=(1+Math.sqrt(5))/2,Cb=1/Sb,Eb=[new pu(-Sb,Cb,0),new pu(Sb,Cb,0),new pu(-Cb,0,Sb),new pu(Cb,0,Sb),new pu(0,Sb,-Cb),new pu(0,Sb,Cb),new pu(-1,1,-1),new pu(1,1,-1),new pu(-1,1,1),new pu(1,1,1)],Nb=new pu;class kb{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:a=256,position:s=Nb}=i;bb=this._renderer.getRenderTarget(),xb=this._renderer.getActiveCubeFace(),wb=this._renderer.getActiveMipmapLevel(),_b=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,r,o,s),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Mb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Bb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(bb,xb,wb),this._renderer.xr.enabled=_b,e.scissorTest=!1,Tb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_o||e.mapping===So?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),bb=this._renderer.getRenderTarget(),xb=this._renderer.getActiveCubeFace(),wb=this._renderer.getActiveMipmapLevel(),_b=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Po,minFilter:Po,generateMipmaps:!1,type:Ko,format:nl,colorSpace:hc,depthBuffer:!1},r=Ib(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ib(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+gb.length;for(let s=0;s<a;s++){const a=Math.pow(2,i);n.push(a);let o=1/a;s>e-4?o=gb[s-e+4-1]:0===s&&(o=0),r.push(o);const l=1/(a-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,A=6,p=3,f=2,g=1,m=new Float32Array(p*A*d),y=new Float32Array(f*A*d),v=new Float32Array(g*A*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];m.set(r,p*A*e),y.set(h,f*A*e);const i=[e,e,e,e,e,e];v.set(i,g*A*e)}const b=new Hd;b.setAttribute("position",new Cd(m,p)),b.setAttribute("uv",new Cd(y,f)),b.setAttribute("faceIndex",new Cd(v,g)),t.push(b),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(mb),i=new pu(0,1,0),a=new oA({name:"SphericalGaussianBlur",defines:{n:mb,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:ks,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return r}_compileMaterial(e){const t=new eA(this._lodPlanes[0],e);this._renderer.compile(t,yb)}_sceneToCubeUV(e,t,n,r,i){const a=new dA(90,1,t,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(vb),l.toneMapping=ho,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(r),l.clearDepth(),l.setRenderTarget(null));const h=new gd({name:"PMREM.Background",side:Es,depthWrite:!1,depthTest:!1}),d=new eA(new nA,h);let A=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,A=!0):(h.color.copy(vb),A=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(a.up.set(0,s[f],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+o[f],i.y,i.z)):1===t?(a.up.set(0,0,s[f]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+o[f],i.z)):(a.up.set(0,s[f],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+o[f]));const n=this._cubeSize;Tb(r,t*n,f>2?n:0,n,n),l.setRenderTarget(r),A&&l.render(d,a),l.render(e,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===_o||e.mapping===So;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Mb()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Bb());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new eA(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const s=this._cubeSize;Tb(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,yb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let i=1;i<r;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=Eb[(r-i-1)%Eb.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new eA(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,A=i/d,p=isFinite(i)?1+Math.floor(3*A):mb;p>mb&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(mb));const f=[];let g=0;for(let v=0;v<mb;++v){const e=v/A,t=Math.exp(-e*e/2);f.push(t),0===v?g+=t:v<p&&(g+=2*t)}for(let v=0;v<f.length;v++)f[v]=f[v]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=f,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);const{_lodMax:m}=this;u.dTheta.value=d,u.mipInt.value=m-n;const y=this._sizeLods[r];Tb(t,3*y*(r>m-4?r-m+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,yb)}}function Ib(e,t,n){const r=new Hu(e,t,n);return r.texture.mapping=No,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Tb(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Bb(){return new oA({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:ks,depthTest:!1,depthWrite:!1})}function Mb(){return new oA({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:ks,depthTest:!1,depthWrite:!1})}function Fb(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,s=a===Co||a===Eo,o=a===_o||a===So;if(s||o){let a=t.get(i);const l=void 0!==a?a.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new kb(e)),a=s?n.fromEquirectangular(i,a):n.fromCubemap(i,a),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),a.texture;if(void 0!==a)return a.texture;{const l=i.image;return s&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)?(null===n&&(n=new kb(e)),a=s?n.fromEquirectangular(i):n.fromCubemap(i),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),i.addEventListener("dispose",r),a.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Rb(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Cu("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Lb(e,t,n,r){const i={},a=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const n in o.attributes)t.remove(o.attributes[n]);o.removeEventListener("dispose",s),delete i[o.id];const l=a.get(o);l&&(t.remove(l),a.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const o=new(vu(n)?Md:Td)(n,1);o.version=s;const l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const i in r)t.update(r[i],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function Pb(e,t,n){let r,i,a;function s(t,s,o){0!==o&&(e.drawElementsInstanced(r,s,i,t*a,o),n.update(s,r,o))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,a=e.bytesPerElement},this.render=function(t,s){e.drawElements(r,s,i,t*a),n.update(s,r,1)},this.renderInstances=s,this.renderMultiDraw=function(e,a,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,i,e,0,s);let o=0;for(let t=0;t<s;t++)o+=a[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/a,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(r,o,0,i,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];n.update(t,r,1)}}}function Ub(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Db(e,t,n){const r=new WeakMap,i=new ju;return{update:function(a,s,o){const l=a.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==c?c.length:0;let h=r.get(s);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==s.morphAttributes.position,A=void 0!==s.morphAttributes.normal,p=void 0!==s.morphAttributes.color,f=s.morphAttributes.position||[],g=s.morphAttributes.normal||[],m=s.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===A&&(y=2),!0===p&&(y=3);let v=s.attributes.position.count*y,b=1;v>t.maxTextureSize&&(b=Math.ceil(v/t.maxTextureSize),v=t.maxTextureSize);const x=new Float32Array(v*b*4*u),w=new Qu(x,v,b,u);w.type=qo,w.needsUpdate=!0;const _=4*y;for(let C=0;C<u;C++){const E=f[C],N=g[C],k=m[C],I=v*b*4*C;for(let T=0;T<E.count;T++){const B=T*_;!0===d&&(i.fromBufferAttribute(E,T),x[I+B+0]=i.x,x[I+B+1]=i.y,x[I+B+2]=i.z,x[I+B+3]=0),!0===A&&(i.fromBufferAttribute(N,T),x[I+B+4]=i.x,x[I+B+5]=i.y,x[I+B+6]=i.z,x[I+B+7]=0),!0===p&&(i.fromBufferAttribute(k,T),x[I+B+8]=i.x,x[I+B+9]=i.y,x[I+B+10]=i.z,x[I+B+11]=4===k.itemSize?i.w:1)}}function S(){w.dispose(),r.delete(s),s.removeEventListener("dispose",S)}h={count:u,texture:w,size:new du(v,b)},r.set(s,h),s.addEventListener("dispose",S)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)o.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let M=0;for(let R=0;R<l.length;R++)M+=l[R];const F=s.morphTargetsRelative?1:1-M;o.getUniforms().setValue(e,"morphTargetBaseInfluence",F),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function Ob(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const o=r.render.frame,l=s.geometry,c=t.get(s,l);if(i.get(c)!==o&&(t.update(c),i.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),i.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,o))),s.isSkinnedMesh){const e=s.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return c},dispose:function(){i=new WeakMap}}}const jb=new Ou,zb=new bf(1,1),Hb=new Qu,Qb=new Gu,Vb=new fA,Gb=[],Wb=[],qb=new Float32Array(16),Kb=new Float32Array(9),Xb=new Float32Array(4);function Yb(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Gb[i];if(void 0===a&&(a=new Float32Array(i),Gb[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function Jb(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Zb(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function $b(e,t){let n=Wb[t];void 0===n&&(n=new Int32Array(t),Wb[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function ex(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function tx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Jb(n,t))return;e.uniform2fv(this.addr,t),Zb(n,t)}}function nx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Jb(n,t))return;e.uniform3fv(this.addr,t),Zb(n,t)}}function rx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Jb(n,t))return;e.uniform4fv(this.addr,t),Zb(n,t)}}function ix(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Jb(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Zb(n,t)}else{if(Jb(n,r))return;Xb.set(r),e.uniformMatrix2fv(this.addr,!1,Xb),Zb(n,r)}}function ax(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Jb(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Zb(n,t)}else{if(Jb(n,r))return;Kb.set(r),e.uniformMatrix3fv(this.addr,!1,Kb),Zb(n,r)}}function sx(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Jb(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Zb(n,t)}else{if(Jb(n,r))return;qb.set(r),e.uniformMatrix4fv(this.addr,!1,qb),Zb(n,r)}}function ox(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function lx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Jb(n,t))return;e.uniform2iv(this.addr,t),Zb(n,t)}}function cx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Jb(n,t))return;e.uniform3iv(this.addr,t),Zb(n,t)}}function ux(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Jb(n,t))return;e.uniform4iv(this.addr,t),Zb(n,t)}}function hx(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function dx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Jb(n,t))return;e.uniform2uiv(this.addr,t),Zb(n,t)}}function Ax(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Jb(n,t))return;e.uniform3uiv(this.addr,t),Zb(n,t)}}function px(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Jb(n,t))return;e.uniform4uiv(this.addr,t),Zb(n,t)}}function fx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let a;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(zb.compareFunction=Fc,a=zb):a=jb,n.setTexture2D(t||a,i)}function gx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Qb,i)}function mx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Vb,i)}function yx(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Hb,i)}function vx(e,t){e.uniform1fv(this.addr,t)}function bx(e,t){const n=Yb(t,this.size,2);e.uniform2fv(this.addr,n)}function xx(e,t){const n=Yb(t,this.size,3);e.uniform3fv(this.addr,n)}function wx(e,t){const n=Yb(t,this.size,4);e.uniform4fv(this.addr,n)}function _x(e,t){const n=Yb(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Sx(e,t){const n=Yb(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Cx(e,t){const n=Yb(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ex(e,t){e.uniform1iv(this.addr,t)}function Nx(e,t){e.uniform2iv(this.addr,t)}function kx(e,t){e.uniform3iv(this.addr,t)}function Ix(e,t){e.uniform4iv(this.addr,t)}function Tx(e,t){e.uniform1uiv(this.addr,t)}function Bx(e,t){e.uniform2uiv(this.addr,t)}function Mx(e,t){e.uniform3uiv(this.addr,t)}function Fx(e,t){e.uniform4uiv(this.addr,t)}function Rx(e,t,n){const r=this.cache,i=t.length,a=$b(n,i);Jb(r,a)||(e.uniform1iv(this.addr,a),Zb(r,a));for(let s=0;s!==i;++s)n.setTexture2D(t[s]||jb,a[s])}function Lx(e,t,n){const r=this.cache,i=t.length,a=$b(n,i);Jb(r,a)||(e.uniform1iv(this.addr,a),Zb(r,a));for(let s=0;s!==i;++s)n.setTexture3D(t[s]||Qb,a[s])}function Px(e,t,n){const r=this.cache,i=t.length,a=$b(n,i);Jb(r,a)||(e.uniform1iv(this.addr,a),Zb(r,a));for(let s=0;s!==i;++s)n.setTextureCube(t[s]||Vb,a[s])}function Ux(e,t,n){const r=this.cache,i=t.length,a=$b(n,i);Jb(r,a)||(e.uniform1iv(this.addr,a),Zb(r,a));for(let s=0;s!==i;++s)n.setTexture2DArray(t[s]||Hb,a[s])}class Dx{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return ex;case 35664:return tx;case 35665:return nx;case 35666:return rx;case 35674:return ix;case 35675:return ax;case 35676:return sx;case 5124:case 35670:return ox;case 35667:case 35671:return lx;case 35668:case 35672:return cx;case 35669:case 35673:return ux;case 5125:return hx;case 36294:return dx;case 36295:return Ax;case 36296:return px;case 35678:case 36198:case 36298:case 36306:case 35682:return fx;case 35679:case 36299:case 36307:return gx;case 35680:case 36300:case 36308:case 36293:return mx;case 36289:case 36303:case 36311:case 36292:return yx}}(t.type)}}class Ox{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return vx;case 35664:return bx;case 35665:return xx;case 35666:return wx;case 35674:return _x;case 35675:return Sx;case 35676:return Cx;case 5124:case 35670:return Ex;case 35667:case 35671:return Nx;case 35668:case 35672:return kx;case 35669:case 35673:return Ix;case 5125:return Tx;case 36294:return Bx;case 36295:return Mx;case 36296:return Fx;case 35678:case 36198:case 36298:case 36306:case 35682:return Rx;case 35679:case 36299:case 36307:return Lx;case 35680:case 36300:case 36308:case 36293:return Px;case 36289:case 36303:case 36311:case 36292:return Ux}}(t.type)}}class jx{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const zx=/(\w+)(\])?(\[|\.)?/g;function Hx(e,t){e.seq.push(t),e.map[t.id]=t}function Qx(e,t,n){const r=e.name,i=r.length;for(zx.lastIndex=0;;){const a=zx.exec(r),s=zx.lastIndex;let o=a[1];const l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===i){Hx(n,void 0===c?new Dx(o,e,t):new Ox(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new jx(o),Hx(n,e)),n=e}}}class Vx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Qx(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function Gx(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let Wx=0;const qx=new mu;function Kx(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=(e.getShaderInfoLog(t)||"").trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let s=i;s<a;s++){const e=s+1;r.push("".concat(e===t?">":" "," ").concat(e,": ").concat(n[s]))}return r.join("\n")}(e.getShaderSource(t),r)}return i}function Xx(e,t){const n=function(e){Iu._getMatrix(qx,Iu.workingColorSpace,e);const t="mat3( ".concat(qx.elements.map(e=>e.toFixed(4))," )");switch(Iu.getTransfer(e)){case dc:return[t,"LinearTransferOETF"];case Ac:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return["vec4 ".concat(e,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function Yx(e,t){let n;switch(t){case Ao:n="Linear";break;case po:n="Reinhard";break;case fo:n="Cineon";break;case go:n="ACESFilmic";break;case yo:n="AgX";break;case vo:n="Neutral";break;case mo:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Jx=new pu;function Zx(){Iu.getLuminanceCoefficients(Jx);const e=Jx.x.toFixed(4),t=Jx.y.toFixed(4),n=Jx.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(e,", ").concat(t,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function $x(e){return""!==e}function ew(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function tw(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const nw=/^[ \t]*#include +<([\w\d./]+)>/gm;function rw(e){return e.replace(nw,aw)}const iw=new Map;function aw(e,t){let n=ib[t];if(void 0===n){const e=iw.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=ib[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return rw(n)}const sw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ow(e){return e.replace(sw,lw)}function lw(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function cw(e){let t="precision ".concat(e.precision," float;\n\tprecision ").concat(e.precision," int;\n\tprecision ").concat(e.precision," sampler2D;\n\tprecision ").concat(e.precision," samplerCube;\n\tprecision ").concat(e.precision," sampler3D;\n\tprecision ").concat(e.precision," sampler2DArray;\n\tprecision ").concat(e.precision," sampler2DShadow;\n\tprecision ").concat(e.precision," samplerCubeShadow;\n\tprecision ").concat(e.precision," sampler2DArrayShadow;\n\tprecision ").concat(e.precision," isampler2D;\n\tprecision ").concat(e.precision," isampler3D;\n\tprecision ").concat(e.precision," isamplerCube;\n\tprecision ").concat(e.precision," isampler2DArray;\n\tprecision ").concat(e.precision," usampler2D;\n\tprecision ").concat(e.precision," usampler3D;\n\tprecision ").concat(e.precision," usamplerCube;\n\tprecision ").concat(e.precision," usampler2DArray;\n\t");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function uw(e,t,n,r){const i=e.getContext(),a=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===ws?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===_s?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Ss&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case _o:case So:t="ENVMAP_TYPE_CUBE";break;case No:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===So&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case lo:t="ENVMAP_BLENDING_MULTIPLY";break;case co:t="ENVMAP_BLENDING_MIX";break;case uo:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),A=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter($x).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),f=i.createProgram();let g,m,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter($x).join("\n"),g.length>0&&(g+="\n"),m=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter($x).join("\n"),m.length>0&&(m+="\n")):(g=[cw(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($x).join("\n"),m=[cw(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ho?"#define TONE_MAPPING":"",n.toneMapping!==ho?ib.tonemapping_pars_fragment:"",n.toneMapping!==ho?Yx("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ib.colorspace_pars_fragment,Xx("linearToOutputTexel",n.outputColorSpace),Zx(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter($x).join("\n")),s=rw(s),s=ew(s,n),s=tw(s,n),o=rw(o),o=ew(o,n),o=tw(o,n),s=ow(s),o=ow(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[A,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,m=["#define varying in",n.glslVersion===Kc?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Kc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+m);const v=y+g+s,b=y+m+o,x=Gx(i,i.VERTEX_SHADER,v),w=Gx(i,i.FRAGMENT_SHADER,b);function _(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(f)||"",r=i.getShaderInfoLog(x)||"",a=i.getShaderInfoLog(w)||"",s=n.trim(),o=r.trim(),l=a.trim();let c=!0,u=!0;if(!1===i.getProgramParameter(f,i.LINK_STATUS))if(c=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(i,f,x,w);else{const e=Kx(i,x,"vertex"),n=Kx(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(f,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+s+"\n"+e+"\n"+n)}else""!==s?console.warn("THREE.WebGLProgram: Program Info Log:",s):""!==o&&""!==l||(u=!1);u&&(t.diagnostics={runnable:c,programLog:s,vertexShader:{log:o,prefix:g},fragmentShader:{log:l,prefix:m}})}i.deleteShader(x),i.deleteShader(w),S=new Vx(i,f),C=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:s}}return n}(i,f)}let S,C;i.attachShader(f,x),i.attachShader(f,w),void 0!==n.index0AttributeName?i.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(f,0,"position"),i.linkProgram(f),this.getUniforms=function(){return void 0===S&&_(this),S},this.getAttributes=function(){return void 0===C&&_(this),C};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=i.getProgramParameter(f,37297)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(f),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Wx++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=x,this.fragmentShader=w,this}let hw=0;class dw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new Aw(e),t.set(e,n)),n}}class Aw{constructor(e){this.id=hw++,this.code=e,this.usedTimes=0}}function pw(e,t,n,r,i,a,s){const o=new Bh,l=new dw,c=new Set,u=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let A=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(e){return c.add(e),0===e?"uv":"uv".concat(e)}return{getParameters:function(a,o,u,g,m){const y=g.fog,v=m.geometry,b=a.isMeshStandardMaterial?g.environment:null,x=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),w=x&&x.mapping===No?x.image.height:null,_=p[a.type];null!==a.precision&&(A=i.getMaxPrecision(a.precision),A!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",A,"instead."));const S=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,C=void 0!==S?S.length:0;let E,N,k,I,T=0;if(void 0!==v.morphAttributes.position&&(T=1),void 0!==v.morphAttributes.normal&&(T=2),void 0!==v.morphAttributes.color&&(T=3),_){const e=sb[_];E=e.vertexShader,N=e.fragmentShader}else E=a.vertexShader,N=a.fragmentShader,l.update(a),k=l.getVertexShaderID(a),I=l.getFragmentShaderID(a);const B=e.getRenderTarget(),M=e.state.buffers.depth.getReversed(),F=!0===m.isInstancedMesh,R=!0===m.isBatchedMesh,L=!!a.map,P=!!a.matcap,U=!!x,D=!!a.aoMap,O=!!a.lightMap,j=!!a.bumpMap,z=!!a.normalMap,H=!!a.displacementMap,Q=!!a.emissiveMap,V=!!a.metalnessMap,G=!!a.roughnessMap,W=a.anisotropy>0,q=a.clearcoat>0,K=a.dispersion>0,X=a.iridescence>0,Y=a.sheen>0,J=a.transmission>0,Z=W&&!!a.anisotropyMap,$=q&&!!a.clearcoatMap,ee=q&&!!a.clearcoatNormalMap,te=q&&!!a.clearcoatRoughnessMap,ne=X&&!!a.iridescenceMap,re=X&&!!a.iridescenceThicknessMap,ie=Y&&!!a.sheenColorMap,ae=Y&&!!a.sheenRoughnessMap,se=!!a.specularMap,oe=!!a.specularColorMap,le=!!a.specularIntensityMap,ce=J&&!!a.transmissionMap,ue=J&&!!a.thicknessMap,he=!!a.gradientMap,de=!!a.alphaMap,Ae=a.alphaTest>0,pe=!!a.alphaHash,fe=!!a.extensions;let ge=ho;a.toneMapped&&(null!==B&&!0!==B.isXRRenderTarget||(ge=e.toneMapping));const me={shaderID:_,shaderType:a.type,shaderName:a.name,vertexShader:E,fragmentShader:N,defines:a.defines,customVertexShaderID:k,customFragmentShaderID:I,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:A,batching:R,batchingColor:R&&null!==m._colorsTexture,instancing:F,instancingColor:F&&null!==m.instanceColor,instancingMorph:F&&null!==m.morphTexture,supportsVertexTextures:d,outputColorSpace:null===B?e.outputColorSpace:!0===B.isXRRenderTarget?B.texture.colorSpace:hc,alphaToCoverage:!!a.alphaToCoverage,map:L,matcap:P,envMap:U,envMapMode:U&&x.mapping,envMapCubeUVHeight:w,aoMap:D,lightMap:O,bumpMap:j,normalMap:z,displacementMap:d&&H,emissiveMap:Q,normalMapObjectSpace:z&&a.normalMapType===lc,normalMapTangentSpace:z&&a.normalMapType===oc,metalnessMap:V,roughnessMap:G,anisotropy:W,anisotropyMap:Z,clearcoat:q,clearcoatMap:$,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:K,iridescence:X,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:Y,sheenColorMap:ie,sheenRoughnessMap:ae,specularMap:se,specularColorMap:oe,specularIntensityMap:le,transmission:J,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===a.transparent&&a.blending===Is&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:Ae,alphaHash:pe,combine:a.combine,mapUv:L&&f(a.map.channel),aoMapUv:D&&f(a.aoMap.channel),lightMapUv:O&&f(a.lightMap.channel),bumpMapUv:j&&f(a.bumpMap.channel),normalMapUv:z&&f(a.normalMap.channel),displacementMapUv:H&&f(a.displacementMap.channel),emissiveMapUv:Q&&f(a.emissiveMap.channel),metalnessMapUv:V&&f(a.metalnessMap.channel),roughnessMapUv:G&&f(a.roughnessMap.channel),anisotropyMapUv:Z&&f(a.anisotropyMap.channel),clearcoatMapUv:$&&f(a.clearcoatMap.channel),clearcoatNormalMapUv:ee&&f(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&f(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&f(a.iridescenceMap.channel),iridescenceThicknessMapUv:re&&f(a.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&f(a.sheenColorMap.channel),sheenRoughnessMapUv:ae&&f(a.sheenRoughnessMap.channel),specularMapUv:se&&f(a.specularMap.channel),specularColorMapUv:oe&&f(a.specularColorMap.channel),specularIntensityMapUv:le&&f(a.specularIntensityMap.channel),transmissionMapUv:ce&&f(a.transmissionMap.channel),thicknessMapUv:ue&&f(a.thicknessMap.channel),alphaMapUv:de&&f(a.alphaMap.channel),vertexTangents:!!v.attributes.tangent&&(z||W),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,pointsUvs:!0===m.isPoints&&!!v.attributes.uv&&(L||de),fog:!!y,useFog:!0===a.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:M,skinning:!0===m.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:C,morphTextureStride:T,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:L&&!0===a.map.isVideoTexture&&Iu.getTransfer(a.map.colorSpace)===Ac,decodeVideoTextureEmissive:Q&&!0===a.emissiveMap.isVideoTexture&&Iu.getTransfer(a.emissiveMap.colorSpace)===Ac,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===Ns,flipSided:a.side===Es,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:fe&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===a.extensions.multiDraw||R)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return me.vertexUv1s=c.has(1),me.vertexUv2s=c.has(2),me.vertexUv3s=c.has(3),c.clear(),me},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);t.gradientMap&&o.enable(22);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reversedDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=sb[t];n=sA.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,i=u.length;e<i;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new uw(e,n,t,a),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function fw(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function gw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function mw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function yw(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?r.push(u):!0===s.transparent?i.push(u):n.push(u)},unshift:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?r.unshift(u):!0===s.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||gw),r.length>1&&r.sort(t||mw),i.length>1&&i.sort(t||mw)}}}function vw(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new yw,e.set(t,[i])):n>=r.length?(i=new yw,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function bw(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new pu,color:new dd};break;case"SpotLight":n={position:new pu,direction:new pu,color:new dd,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new pu,color:new dd,distance:0,decay:0};break;case"HemisphereLight":n={direction:new pu,skyColor:new dd,groundColor:new dd};break;case"RectAreaLight":n={color:new dd,position:new pu,halfWidth:new pu,halfHeight:new pu}}return e[t.id]=n,n}}}let xw=0;function ww(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function _w(e){const t=new bw,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new du};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new du,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)r.probe.push(new pu);const i=new pu,a=new bh,s=new bh;return{setup:function(i){let a=0,s=0,o=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,A=0,p=0,f=0,g=0,m=0,y=0;i.sort(ww);for(let e=0,b=i.length;e<b;e++){const v=i[e],b=v.color,x=v.intensity,w=v.distance,_=v.shadow&&v.shadow.map?v.shadow.map.texture:null;if(v.isAmbientLight)a+=b.r*x,s+=b.g*x,o+=b.b*x;else if(v.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(v.sh.coefficients[e],x);y++}else if(v.isDirectionalLight){const e=t.get(v);if(e.color.copy(v.color).multiplyScalar(v.intensity),v.castShadow){const e=v.shadow,t=n.get(v);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=_,r.directionalShadowMatrix[l]=v.shadow.matrix,A++}r.directional[l]=e,l++}else if(v.isSpotLight){const e=t.get(v);e.position.setFromMatrixPosition(v.matrixWorld),e.color.copy(b).multiplyScalar(x),e.distance=w,e.coneCos=Math.cos(v.angle),e.penumbraCos=Math.cos(v.angle*(1-v.penumbra)),e.decay=v.decay,r.spot[u]=e;const i=v.shadow;if(v.map&&(r.spotLightMap[g]=v.map,g++,i.updateMatrices(v),v.castShadow&&m++),r.spotLightMatrix[u]=i.matrix,v.castShadow){const e=n.get(v);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=_,f++}u++}else if(v.isRectAreaLight){const e=t.get(v);e.color.copy(b).multiplyScalar(x),e.halfWidth.set(.5*v.width,0,0),e.halfHeight.set(0,.5*v.height,0),r.rectArea[h]=e,h++}else if(v.isPointLight){const e=t.get(v);if(e.color.copy(v.color).multiplyScalar(v.intensity),e.distance=v.distance,e.decay=v.decay,v.castShadow){const e=v.shadow,t=n.get(v);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[c]=t,r.pointShadowMap[c]=_,r.pointShadowMatrix[c]=v.shadow.matrix,p++}r.point[c]=e,c++}else if(v.isHemisphereLight){const e=t.get(v);e.skyColor.copy(v.color).multiplyScalar(x),e.groundColor.copy(v.groundColor).multiplyScalar(x),r.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ab.LTC_FLOAT_1,r.rectAreaLTC2=ab.LTC_FLOAT_2):(r.rectAreaLTC1=ab.LTC_HALF_1,r.rectAreaLTC2=ab.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=s,r.ambient[2]=o;const v=r.hash;v.directionalLength===l&&v.pointLength===c&&v.spotLength===u&&v.rectAreaLength===h&&v.hemiLength===d&&v.numDirectionalShadows===A&&v.numPointShadows===p&&v.numSpotShadows===f&&v.numSpotMaps===g&&v.numLightProbes===y||(r.directional.length=l,r.spot.length=u,r.rectArea.length=h,r.point.length=c,r.hemi.length=d,r.directionalShadow.length=A,r.directionalShadowMap.length=A,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=f,r.spotShadowMap.length=f,r.directionalShadowMatrix.length=A,r.pointShadowMatrix.length=p,r.spotLightMatrix.length=f+g-m,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=m,r.numLightProbes=y,v.directionalLength=l,v.pointLength=c,v.spotLength=u,v.rectAreaLength=h,v.hemiLength=d,v.numDirectionalShadows=A,v.numPointShadows=p,v.numSpotShadows=f,v.numSpotMaps=g,v.numLightProbes=y,r.version=xw++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,A=e.length;d<A;d++){const t=e[d];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(t.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=r.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:r}}function Sw(e){const t=new _w(e),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Cw(e){let t=new WeakMap;return{get:function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=t.get(n);let a;return void 0===i?(a=new Sw(e),t.set(n,[a])):r>=i.length?(a=new Sw(e),i.push(a)):a=i[r],a},dispose:function(){t=new WeakMap}}}function Ew(e,t,n){let r=new wp;const i=new du,a=new du,s=new ju,o=new nm({depthPacking:ic}),l=new rm,c={},u=n.maxTextureSize,h={[Cs]:Es,[Es]:Cs,[Ns]:Ns},d=new oA({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new du},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),A=d.clone();A.defines.HORIZONTAL_PASS=1;const p=new Hd;p.setAttribute("position",new Cd(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new eA(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ws;let m=this.type;function y(n,r){const a=t.update(f);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,A.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,A.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Hu(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,f,null),A.uniforms.shadow_pass.value=n.mapPass.texture,A.uniforms.resolution.value=n.mapSize,A.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,A,f,null)}function v(t,n,r,i){let a=null;const s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=a.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",x)),a=i}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=i===Ss?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=r}return a}function b(n,i,a,s,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===Ss)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=v(n,h,s,o);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}}else if(l.visible){const t=v(n,l,s,o);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,a,s,o)}function x(e){e.target.removeEventListener("dispose",x);for(const t in c){const n=c[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(ks),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const A=m!==Ss&&this.type===Ss,p=m===Ss&&this.type!==Ss;for(let f=0,g=t.length;f<g;f++){const l=t[f],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);const h=c.getFrameExtents();if(i.multiply(h),a.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/h.x),i.x=a.x*h.x,c.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/h.y),i.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map||!0===A||!0===p){const e=this.type!==Ss?{minFilter:Bo,magFilter:Bo}:{};null!==c.map&&c.map.dispose(),c.map=new Hu(i.x,i.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(s),c.updateMatrices(l,e),r=c.getFrustum(),b(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===Ss&&y(c,o),c.needsUpdate=!1}m=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const Nw={[eo]:to,[no]:so,[io]:oo,[ro]:ao,[to]:eo,[so]:no,[oo]:io,[ao]:ro};function kw(e,t){const n=new function(){let t=!1;const n=new ju;let r=null;const i=new ju(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,s,o){!0===o&&(t*=s,r*=s,a*=s),n.set(t,r,a,s),!1===i.equals(n)&&(e.clearColor(t,r,a,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,a=null,s=null;return{setReversed:function(e){if(r!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),r=e;const i=s;s=null,this.setClear(i)}},getReversed:function(){return r},setTest:function(t){t?j(e.DEPTH_TEST):z(e.DEPTH_TEST)},setMask:function(t){i===t||n||(e.depthMask(t),i=t)},setFunc:function(t){if(r&&(t=Nw[t]),a!==t){switch(t){case eo:e.depthFunc(e.NEVER);break;case to:e.depthFunc(e.ALWAYS);break;case no:e.depthFunc(e.LESS);break;case ro:e.depthFunc(e.LEQUAL);break;case io:e.depthFunc(e.EQUAL);break;case ao:e.depthFunc(e.GEQUAL);break;case so:e.depthFunc(e.GREATER);break;case oo:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){s!==t&&(r&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){n=!1,i=null,a=null,s=null,r=!1}}},i=new function(){let t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?j(e.STENCIL_TEST):z(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&a===s||(e.stencilFunc(t,n,s),r=t,i=n,a=s)},setOp:function(t,n,r){s===t&&o===n&&l===r||(e.stencilOp(t,n,r),s=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,c=null}}},a=new WeakMap,s=new WeakMap;let o={},l={},c=new WeakMap,u=[],h=null,d=!1,A=null,p=null,f=null,g=null,m=null,y=null,v=null,b=new dd(0,0,0),x=0,w=!1,_=null,S=null,C=null,E=null,N=null;const k=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let I=!1,T=0;const B=e.getParameter(e.VERSION);-1!==B.indexOf("WebGL")?(T=parseFloat(/^WebGL (\d)/.exec(B)[1]),I=T>=1):-1!==B.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),I=T>=2);let M=null,F={};const R=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),P=(new ju).fromArray(R),U=(new ju).fromArray(L);function D(t,n,r,i){const a=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return s}const O={};function j(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function z(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}O[e.TEXTURE_2D]=D(e.TEXTURE_2D,e.TEXTURE_2D,1),O[e.TEXTURE_CUBE_MAP]=D(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),O[e.TEXTURE_2D_ARRAY]=D(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),O[e.TEXTURE_3D]=D(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),j(e.DEPTH_TEST),r.setFunc(ro),G(!1),W(ys),j(e.CULL_FACE),V(ks);const H={[Rs]:e.FUNC_ADD,[Ls]:e.FUNC_SUBTRACT,[Ps]:e.FUNC_REVERSE_SUBTRACT};H[Us]=e.MIN,H[Ds]=e.MAX;const Q={[Os]:e.ZERO,[js]:e.ONE,[zs]:e.SRC_COLOR,[Qs]:e.SRC_ALPHA,[Xs]:e.SRC_ALPHA_SATURATE,[qs]:e.DST_COLOR,[Gs]:e.DST_ALPHA,[Hs]:e.ONE_MINUS_SRC_COLOR,[Vs]:e.ONE_MINUS_SRC_ALPHA,[Ks]:e.ONE_MINUS_DST_COLOR,[Ws]:e.ONE_MINUS_DST_ALPHA,[Ys]:e.CONSTANT_COLOR,[Js]:e.ONE_MINUS_CONSTANT_COLOR,[Zs]:e.CONSTANT_ALPHA,[$s]:e.ONE_MINUS_CONSTANT_ALPHA};function V(t,n,r,i,a,s,o,l,c,u){if(t!==ks){if(!1===d&&(j(e.BLEND),d=!0),t===Fs)a=a||n,s=s||r,o=o||i,n===p&&a===m||(e.blendEquationSeparate(H[n],H[a]),p=n,m=a),r===f&&i===g&&s===y&&o===v||(e.blendFuncSeparate(Q[r],Q[i],Q[s],Q[o]),f=r,g=i,y=s,v=o),!1!==l.equals(b)&&c===x||(e.blendColor(l.r,l.g,l.b,c),b.copy(l),x=c),A=t,w=!1;else if(t!==A||u!==w){if(p===Rs&&m===Rs||(e.blendEquation(e.FUNC_ADD),p=Rs,m=Rs),u)switch(t){case Is:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ts:e.blendFunc(e.ONE,e.ONE);break;case Bs:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Ms:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Is:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ts:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case Bs:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ms:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,g=null,y=null,v=null,b.set(0,0,0),x=0,A=t,w=u}}else!0===d&&(z(e.BLEND),d=!1)}function G(t){_!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),_=t)}function W(t){t!==ms?(j(e.CULL_FACE),t!==S&&(t===ys?e.cullFace(e.BACK):t===vs?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):z(e.CULL_FACE),S=t}function q(t,n,r){t?(j(e.POLYGON_OFFSET_FILL),E===n&&N===r||(e.polygonOffset(n,r),E=n,N=r)):z(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:j,disable:z,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=u,i=!1;if(t){r=c.get(n),void 0===r&&(r=[],c.set(n,r));const a=t.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=a.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:V,setMaterial:function(t,a){t.side===Ns?z(e.CULL_FACE):j(e.CULL_FACE);let s=t.side===Es;a&&(s=!s),G(s),t.blending===Is&&!1===t.transparent?V(ks):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;i.setTest(o),o&&(i.setMask(t.stencilWriteMask),i.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),i.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?j(e.SAMPLE_ALPHA_TO_COVERAGE):z(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==C&&(I&&e.lineWidth(t),C=t)},setPolygonOffset:q,setScissorTest:function(t){t?j(e.SCISSOR_TEST):z(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+k-1),M!==t&&(e.activeTexture(t),M=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===M?e.TEXTURE0+k-1:M);let i=F[r];void 0===i&&(i={type:void 0,texture:void 0},F[r]=i),i.type===t&&i.texture===n||(M!==r&&(e.activeTexture(r),M=r),e.bindTexture(t,n||O[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=F[M];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},updateUBOMapping:function(t,n){let r=s.get(n);void 0===r&&(r=new WeakMap,s.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=s.get(n).get(t);a.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(SS){console.error("THREE.WebGLState:",SS)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},M=null,F={},l={},c=new WeakMap,u=[],h=null,d=!1,A=null,p=null,f=null,g=null,m=null,y=null,v=null,b=new dd(0,0,0),x=0,w=!1,_=null,S=null,C=null,E=null,N=null,P.set(0,0,e.canvas.width,e.canvas.height),U.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),i.reset()}}}function Iw(e,t,n,r,i,a,s){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new du,u=new WeakMap;let h;const d=new WeakMap;let A=!1;try{A="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function p(e,t){return A?new OffscreenCanvas(e,t):wu("canvas")}function f(e,t,n){let r=1;const i=Q(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),a=Math.floor(r*i.height);void 0===h&&(h=p(n,a));const s=t?p(n,a):h;s.width=n,s.height=a;return s.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps}function m(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function v(n,r,i,a){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;if(r===e.RED&&(i===e.FLOAT&&(o=e.R32F),i===e.HALF_FLOAT&&(o=e.R16F),i===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.R8UI),i===e.UNSIGNED_SHORT&&(o=e.R16UI),i===e.UNSIGNED_INT&&(o=e.R32UI),i===e.BYTE&&(o=e.R8I),i===e.SHORT&&(o=e.R16I),i===e.INT&&(o=e.R32I)),r===e.RG&&(i===e.FLOAT&&(o=e.RG32F),i===e.HALF_FLOAT&&(o=e.RG16F),i===e.UNSIGNED_BYTE&&(o=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RG8UI),i===e.UNSIGNED_SHORT&&(o=e.RG16UI),i===e.UNSIGNED_INT&&(o=e.RG32UI),i===e.BYTE&&(o=e.RG8I),i===e.SHORT&&(o=e.RG16I),i===e.INT&&(o=e.RG32I)),r===e.RGB_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RGB8UI),i===e.UNSIGNED_SHORT&&(o=e.RGB16UI),i===e.UNSIGNED_INT&&(o=e.RGB32UI),i===e.BYTE&&(o=e.RGB8I),i===e.SHORT&&(o=e.RGB16I),i===e.INT&&(o=e.RGB32I)),r===e.RGBA_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),i===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),i===e.UNSIGNED_INT&&(o=e.RGBA32UI),i===e.BYTE&&(o=e.RGBA8I),i===e.SHORT&&(o=e.RGBA16I),i===e.INT&&(o=e.RGBA32I)),r===e.RGB&&(i===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),i===e.UNSIGNED_INT_10F_11F_11F_REV&&(o=e.R11F_G11F_B10F)),r===e.RGBA){const t=s?dc:Iu.getTransfer(a);i===e.FLOAT&&(o=e.RGBA32F),i===e.HALF_FLOAT&&(o=e.RGBA16F),i===e.UNSIGNED_BYTE&&(o=t===Ac?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function b(t,n){let r;return t?null===n||n===Wo||n===Jo?r=e.DEPTH24_STENCIL8:n===qo?r=e.DEPTH32F_STENCIL8:n===Vo&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Wo||n===Jo?r=e.DEPTH_COMPONENT24:n===qo?r=e.DEPTH_COMPONENT32F:n===Vo&&(r=e.DEPTH_COMPONENT16),r}function x(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==Bo&&e.minFilter!==Po?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=d.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(e),0===Object.keys(i).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function _(t){const n=t.target;n.removeEventListener("dispose",_),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let a=0,o=i.length;a<o;a++){const t=r.get(i[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),r.remove(i[a])}r.remove(t)}(n)}function S(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete d.get(i)[n.__cacheKey],s.memory.textures--}let C=0;function E(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void F(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else t.isExternalTexture&&(a.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const N={[ko]:e.REPEAT,[Io]:e.CLAMP_TO_EDGE,[To]:e.MIRRORED_REPEAT},k={[Bo]:e.NEAREST,[Mo]:e.NEAREST_MIPMAP_NEAREST,[Ro]:e.NEAREST_MIPMAP_LINEAR,[Po]:e.LINEAR,[Uo]:e.LINEAR_MIPMAP_NEAREST,[Oo]:e.LINEAR_MIPMAP_LINEAR},I={[Tc]:e.NEVER,[Uc]:e.ALWAYS,[Bc]:e.LESS,[Fc]:e.LEQUAL,[Mc]:e.EQUAL,[Pc]:e.GEQUAL,[Rc]:e.GREATER,[Lc]:e.NOTEQUAL};function T(n,a){if(a.type!==qo||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Po&&a.magFilter!==Uo&&a.magFilter!==Ro&&a.magFilter!==Oo&&a.minFilter!==Po&&a.minFilter!==Uo&&a.minFilter!==Ro&&a.minFilter!==Oo||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,N[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,N[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,N[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,k[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,k[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,I[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===Bo)return;if(a.minFilter!==Ro&&a.minFilter!==Oo)return;if(a.type===qo&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function B(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let a=d.get(i);void 0===a&&(a={},d.set(i,a));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),a[o].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&S(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return r}function M(e,t,n){return Math.floor(Math.floor(e/n)/t)}function F(t,s,o){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=B(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=r.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=Iu.getPrimaries(Iu.workingColorSpace),r=s.colorSpace===cc?null:Iu.getPrimaries(s.colorSpace),d=s.colorSpace===cc||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let A=f(s.image,!1,i.maxTextureSize);A=H(s,A);const p=a.convert(s.format,s.colorSpace),y=a.convert(s.type);let w,_=v(s.internalFormat,p,y,s.colorSpace,s.isVideoTexture);T(l,s);const S=s.mipmaps,C=!0!==s.isVideoTexture,E=void 0===h.__version||!0===c,N=u.dataReady,k=x(s,A);if(s.isDepthTexture)_=b(s.format===il,s.type),E&&(C?n.texStorage2D(e.TEXTURE_2D,1,_,A.width,A.height):n.texImage2D(e.TEXTURE_2D,0,_,A.width,A.height,0,p,y,null));else if(s.isDataTexture)if(S.length>0){C&&E&&n.texStorage2D(e.TEXTURE_2D,k,_,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)w=S[t],C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,p,y,w.data);s.generateMipmaps=!1}else C?(E&&n.texStorage2D(e.TEXTURE_2D,k,_,A.width,A.height),N&&function(t,r,i,a){const s=t.updateRanges;if(0===s.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,i,a,r.data);else{s.sort((e,t)=>e.start-t.start);let o=0;for(let e=1;e<s.length;e++){const t=s[o],n=s[e],i=t.start+t.count,a=M(n.start,r.width,4),l=M(t.start,r.width,4);n.start<=i+1&&a===l&&M(n.start+n.count-1,r.width,4)===a?t.count=Math.max(t.count,n.start+n.count-t.start):(++o,s[o]=n)}s.length=o+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),u=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width);for(let t=0,h=s.length;t<h;t++){const o=s[t],l=Math.floor(o.start/4),c=Math.ceil(o.count/4),u=l%r.width,h=Math.floor(l/r.width),d=c,A=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,h),n.texSubImage2D(e.TEXTURE_2D,0,u,h,d,A,i,a,r.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,u)}}(s,A,p,y)):n.texImage2D(e.TEXTURE_2D,0,_,A.width,A.height,0,p,y,A.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){C&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,_,S[0].width,S[0].height,A.depth);for(let t=0,r=S.length;t<r;t++)if(w=S[t],s.format!==nl)if(null!==p)if(C){if(N)if(s.layerUpdates.size>0){const r=eb(w.width,w.height,s.format,s.type);for(const i of s.layerUpdates){const a=w.data.subarray(i*r/w.data.BYTES_PER_ELEMENT,(i+1)*r/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,w.width,w.height,1,p,a)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,A.depth,p,w.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,w.width,w.height,A.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else C?N&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,A.depth,p,y,w.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,w.width,w.height,A.depth,0,p,y,w.data)}else{C&&E&&n.texStorage2D(e.TEXTURE_2D,k,_,S[0].width,S[0].height);for(let t=0,r=S.length;t<r;t++)w=S[t],s.format!==nl?null!==p?C?N&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,w.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,_,w.width,w.height,0,p,y,w.data)}else if(s.isDataArrayTexture)if(C){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,k,_,A.width,A.height,A.depth),N)if(s.layerUpdates.size>0){const t=eb(A.width,A.height,s.format,s.type);for(const r of s.layerUpdates){const i=A.data.subarray(r*t/A.data.BYTES_PER_ELEMENT,(r+1)*t/A.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,A.width,A.height,1,p,y,i)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,A.width,A.height,A.depth,p,y,A.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,A.width,A.height,A.depth,0,p,y,A.data);else if(s.isData3DTexture)C?(E&&n.texStorage3D(e.TEXTURE_3D,k,_,A.width,A.height,A.depth),N&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,A.width,A.height,A.depth,p,y,A.data)):n.texImage3D(e.TEXTURE_3D,0,_,A.width,A.height,A.depth,0,p,y,A.data);else if(s.isFramebufferTexture){if(E)if(C)n.texStorage2D(e.TEXTURE_2D,k,_,A.width,A.height);else{let t=A.width,r=A.height;for(let i=0;i<k;i++)n.texImage2D(e.TEXTURE_2D,i,_,t,r,0,p,y,null),t>>=1,r>>=1}}else if(S.length>0){if(C&&E){const t=Q(S[0]);n.texStorage2D(e.TEXTURE_2D,k,_,t.width,t.height)}for(let t=0,r=S.length;t<r;t++)w=S[t],C?N&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,y,w):n.texImage2D(e.TEXTURE_2D,t,_,p,y,w);s.generateMipmaps=!1}else if(C){if(E){const t=Q(A);n.texStorage2D(e.TEXTURE_2D,k,_,t.width,t.height)}N&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,y,A)}else n.texImage2D(e.TEXTURE_2D,0,_,p,y,A);g(s)&&m(l),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function R(t,i,s,l,c,u){const h=a.convert(s.format,s.colorSpace),d=a.convert(s.type),A=v(s.internalFormat,h,d,s.colorSpace),p=r.get(i),f=r.get(s);if(f.__renderTarget=i,!p.__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,A,t,r,i.depth,0,h,d,null):n.texImage2D(c,u,A,t,r,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),z(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,f.__webglTexture,0,j(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,f.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,a=i&&i.isDepthTexture?i.type:null,s=b(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=j(n);z(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const s=t[i],l=a.convert(s.format,s.colorSpace),c=a.convert(s.type),u=v(s.internalFormat,l,c,s.colorSpace),h=j(n);r&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):z(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function P(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=r.get(i.depthTexture);a.__renderTarget=i,a.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);const s=a.__webglTexture,l=j(i);if(i.depthTexture.format===rl)z(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(i.depthTexture.format!==il)throw new Error("Unknown depthTexture format");z(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}function U(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),e){const t=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),i.__depthDisposeCallback=t}i.__boundDepthTexture=e}if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?P(i.__webglFramebuffer[0],t):P(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=e.createRenderbuffer(),L(i.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=i.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else{const r=t.texture.mipmaps;if(r&&r.length>0?n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),L(i.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const D=[],O=[];function j(e){return Math.min(i.maxSamples,e.samples)}function z(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,t){const n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==hc&&n!==cc&&(Iu.getTransfer(n)===Ac?r===nl&&i===zo||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function Q(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=C;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=E,this.setTexture2DArray=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?F(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?F(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,s){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,s,o){if(6!==s.image.length)return;const l=B(t,s),c=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=r.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=Iu.getPrimaries(Iu.workingColorSpace),r=s.colorSpace===cc?null:Iu.getPrimaries(s.colorSpace),h=s.colorSpace===cc||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=s.isCompressedTexture||s.image[0].isCompressedTexture,A=s.image[0]&&s.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=d||A?A?s.image[e].image:s.image[e]:f(s.image[e],!0,i.maxCubemapSize),p[e]=H(s,p[e]);const y=p[0],b=a.convert(s.format,s.colorSpace),w=a.convert(s.type),_=v(s.internalFormat,b,w,s.colorSpace),S=!0!==s.isVideoTexture,C=void 0===u.__version||!0===l,E=c.dataReady;let N,k=x(s,y);if(T(e.TEXTURE_CUBE_MAP,s),d){S&&C&&n.texStorage2D(e.TEXTURE_CUBE_MAP,k,_,y.width,y.height);for(let t=0;t<6;t++){N=p[t].mipmaps;for(let r=0;r<N.length;r++){const i=N[r];s.format!==nl?null!==b?S?E&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,b,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,b,w,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,_,i.width,i.height,0,b,w,i.data)}}}else{if(N=s.mipmaps,S&&C){N.length>0&&k++;const t=Q(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,k,_,t.width,t.height)}for(let t=0;t<6;t++)if(A){S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,b,w,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,p[t].width,p[t].height,0,b,w,p[t].data);for(let r=0;r<N.length;r++){const i=N[r].image[t].image;S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,b,w,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,i.width,i.height,0,b,w,i.data)}}else{S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,b,w,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,b,w,p[t]);for(let r=0;r<N.length;r++){const i=N[r];S?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,b,w,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,_,b,w,i.image[t])}}}g(s)&&m(e.TEXTURE_CUBE_MAP),u.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(o,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&R(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&U(t)},this.setupRenderTarget=function(t){const i=t.texture,o=r.get(t),l=r.get(i);t.addEventListener("dispose",_);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,s.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=r.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===z(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),s=a.convert(r.type),l=v(r.internalFormat,i,s,r.colorSpace,!0===t.isXRRenderTarget),u=j(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),L(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),T(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)R(o.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else R(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&m(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let i=0,a=c.length;i<a;i++){const a=c[i],s=r.get(a);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,s.__webglTexture),T(l,a),R(o.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,l,0),g(a)&&m(l)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),T(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)R(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else R(o.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&m(r),n.unbindTexture()}t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let i=0,a=t.length;i<a;i++){const a=t[i];if(g(a)){const t=y(e),i=r.get(a).__webglTexture;n.bindTexture(t,i),m(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===z(t)){const i=t.textures,a=t.width,s=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=i.length>1;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const d=t.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),!0===l&&(D.length=0,O.length=0,D.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(D.push(c),O.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,O)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,D))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=R,this.useMultisampledRTT=z}function Tw(e,t){return{convert:function(n){let r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cc;const a=Iu.getTransfer(i);if(n===zo)return e.UNSIGNED_BYTE;if(n===Xo)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Yo)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Zo)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===$o)return e.UNSIGNED_INT_10F_11F_11F_REV;if(n===Ho)return e.BYTE;if(n===Qo)return e.SHORT;if(n===Vo)return e.UNSIGNED_SHORT;if(n===Go)return e.INT;if(n===Wo)return e.UNSIGNED_INT;if(n===qo)return e.FLOAT;if(n===Ko)return e.HALF_FLOAT;if(n===el)return e.ALPHA;if(n===tl)return e.RGB;if(n===nl)return e.RGBA;if(n===rl)return e.DEPTH_COMPONENT;if(n===il)return e.DEPTH_STENCIL;if(n===al)return e.RED;if(n===sl)return e.RED_INTEGER;if(n===ol)return e.RG;if(n===ll)return e.RG_INTEGER;if(n===ul)return e.RGBA_INTEGER;if(n===hl||n===dl||n===Al||n===pl)if(a===Ac){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===hl)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===dl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Al)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===pl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===hl)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===dl)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Al)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===pl)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===fl||n===gl||n===ml||n===yl){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===fl)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===gl)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===ml)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===yl)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===vl||n===bl||n===xl){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===vl||n===bl)return a===Ac?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===xl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===wl||n===_l||n===Sl||n===Cl||n===El||n===Nl||n===kl||n===Il||n===Tl||n===Bl||n===Ml||n===Fl||n===Rl||n===Ll){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===wl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===_l)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Sl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Cl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===El)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Nl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===kl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Il)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Tl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Bl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ml)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Fl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Rl)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Ll)return a===Ac?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Pl||n===Ul||n===Dl){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Pl)return a===Ac?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Ul)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Dl)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Ol||n===jl||n===zl||n===Hl){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Ol)return r.COMPRESSED_RED_RGTC1_EXT;if(n===jl)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===zl)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Hl)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Jo?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class Bw{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new xf(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new oA({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new eA(new Ug(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Mw extends eu{constructor(e,t){super();const n=this;let r=null,i=1,a=null,s="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,A=null;const p="undefined"!==typeof XRWebGLBinding,f=new Bw,g={},m=t.getContextAttributes();let y=null,v=null;const b=[],x=[],w=new du;let _=null;const S=new dA;S.viewport=new ju;const C=new dA;C.viewport=new ju;const E=[S,C],N=new _y;let k=null,I=null;function T(e){const t=x.indexOf(e.inputSource);if(-1===t)return;const n=b[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function B(){r.removeEventListener("select",T),r.removeEventListener("selectstart",T),r.removeEventListener("selectend",T),r.removeEventListener("squeeze",T),r.removeEventListener("squeezestart",T),r.removeEventListener("squeezeend",T),r.removeEventListener("end",B),r.removeEventListener("inputsourceschange",M);for(let e=0;e<b.length;e++){const t=x[e];null!==t&&(x[e]=null,b[e].disconnect(t))}k=null,I=null,f.reset();for(const e in g)delete g[e];e.setRenderTarget(y),d=null,h=null,u=null,r=null,v=null,U.stop(),n.isPresenting=!1,e.setPixelRatio(_),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}function M(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=x.indexOf(n);r>=0&&(x[r]=null,b[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=x.indexOf(n);if(-1===r){for(let e=0;e<b.length;e++){if(e>=x.length){x.push(n),r=e;break}if(null===x[e]){x[e]=n,r=e;break}}if(-1===r)break}const i=b[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new vA,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new vA,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new vA,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===u&&p&&(u=new XRWebGLBinding(r,t)),u},this.getFrame=function(){return A},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){y=e.getRenderTarget(),r.addEventListener("select",T),r.addEventListener("selectstart",T),r.addEventListener("selectend",T),r.addEventListener("squeeze",T),r.addEventListener("squeezestart",T),r.addEventListener("squeezeend",T),r.addEventListener("end",B),r.addEventListener("inputsourceschange",M),!0!==m.xrCompatible&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(w);if(p&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?il:rl,a=m.stencil?Jo:Wo);const o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i};u=this.getBinding(),h=u.createProjectionLayer(o),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new Hu(h.textureWidth,h.textureHeight,{format:nl,type:zo,depthTexture:new bf(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Hu(d.framebufferWidth,d.framebufferHeight,{format:nl,type:zo,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await r.requestReferenceSpace(s),U.setContext(r),U.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const F=new pu,R=new pu;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),N.near=C.near=S.near=t,N.far=C.far=S.far=n,k===N.near&&I===N.far||(r.updateRenderState({depthNear:N.near,depthFar:N.far}),k=N.near,I=N.far),N.layers.mask=6|e.layers.mask,S.layers.mask=3&N.layers.mask,C.layers.mask=5&N.layers.mask;const i=e.parent,a=N.cameras;L(N,i);for(let r=0;r<a.length;r++)L(a[r],i);2===a.length?function(e,t,n){F.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const r=F.distanceTo(R),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=s*u,A=s*h,p=r/(-u+h),f=p*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+p,n=o+p,i=d-f,a=A+(r-f),u=l*o/n*t,h=c*o/n*t;e.projectionMatrix.makePerspective(i,a,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(N,S,C):N.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*iu*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,N,i)},this.getCamera=function(){return N},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(N)},this.getCameraTexture=function(e){return g[e]};let P=null;const U=new nb;U.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||a),A=i,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let i=!1;t.length!==N.cameras.length&&(N.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let a=null;if(null!==d)a=d.getViewport(r);else{const t=u.getViewSubImage(h,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(v,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(v))}let s=E[n];void 0===s&&(s=new dA,s.layers.enable(n),s.viewport=new ju,E[n]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===n&&(N.matrix.copy(s.matrix),N.matrix.decompose(N.position,N.quaternion,N.scale)),!0===i&&N.cameras.push(s)}const a=r.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&p){u=n.getBinding();const e=u.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&f.init(e,r.renderState)}if(a&&a.includes("camera-access")&&p){e.state.unbindTexture(),u=n.getBinding();for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=g[n];e||(e=new xf,g[n]=e);const t=u.getCameraImage(n);e.sourceTexture=t}}}}for(let e=0;e<b.length;e++){const t=x[e],n=b[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}P&&P(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),A=null}),this.setAnimationLoop=function(e){P=e},this.dispose=function(){}}}const Fw=new Th,Rw=new bh;function Lw(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,r.side===Es&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),r.side===Es&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),a=i.envMap,s=i.envMapRotation;a&&(e.envMap.value=a,Fw.copy(s),Fw.x*=-1,Fw.y*=-1,Fw.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Fw.y*=-1,Fw.z*=-1),e.envMapRotation.value.setFromMatrix4(Rw.makeRotationFromEuler(Fw)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,aA(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===Es&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Pw(e,t,n,r){let i={},a={},s=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"===typeof i||"boolean"===typeof i?i:i.clone(),!0;{const e=r[a];if("number"===typeof i||"boolean"===typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let a=0,s=t.length;a<s;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,i=e.length;t<i;t++){const i=e[t],a=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]),s=n%r,o=s%t.boundary,l=s+o;n+=o,0!==l&&r-l<t.storage&&(n+=r-l),i.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,n+=t.storage}}}const i=n%r;i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u));const A=h.program;r.updateUBOMapping(n,A);const p=t.render.frame;a[n.id]!==p&&(!function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,s=r.length;i<s;i++){const t=Array.isArray(r[i])?r[i]:[r[i]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===l(r,i,n,a)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let a=0;a<n.length;a++){const s=n[a],o=c(s);"number"===typeof s||"boolean"===typeof s?(r.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):s.isMatrix3?(r.__data[0]=s.elements[0],r.__data[1]=s.elements[1],r.__data[2]=s.elements[2],r.__data[3]=0,r.__data[4]=s.elements[3],r.__data[5]=s.elements[4],r.__data[6]=s.elements[5],r.__data[7]=0,r.__data[8]=s.elements[6],r.__data[9]=s.elements[7],r.__data[10]=s.elements[8],r.__data[11]=0):(s.toArray(r.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=p)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);s=[],i={},a={}}}}class Uw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=_u(),context:n=null,depth:r=!0,stencil:i=!1,alpha:a=!1,antialias:s=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:h=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=a;const A=new Uint32Array(4),p=new Int32Array(4);let f=null,g=null;const m=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=ho,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const v=this;let b=!1;this._outputColorSpace=uc;let x=0,w=0,_=null,S=-1,C=null;const E=new ju,N=new ju;let k=null;const I=new dd(0);let T=0,B=t.width,M=t.height,F=1,R=null,L=null;const P=new ju(0,0,B,M),U=new ju(0,0,B,M);let D=!1;const O=new wp;let j=!1,z=!1;const H=new bh,Q=new pu,V=new ju,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let W=!1;function q(){return null===_?F:1}let K,X,Y,J,Z,$,ee,te,ne,re,ie,ae,se,oe,le,ce,ue,he,de,Ae,pe,fe,ge,me,ye=n;function ve(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(ps)),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",_e,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ye){const t="webgl2";if(ye=ve(t,e),null===ye)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(SS){throw console.error("THREE.WebGLRenderer: "+SS.message),SS}function be(){K=new Rb(ye),K.init(),fe=new Tw(ye,K),X=new Ab(ye,K,e,fe),Y=new kw(ye,K),X.reversedDepthBuffer&&h&&Y.buffers.depth.setReversed(!0),J=new Ub(ye),Z=new fw,$=new Iw(ye,K,Y,Z,X,fe,J),ee=new fb(v),te=new Fb(v),ne=new rb(ye),ge=new hb(ye,ne),re=new Lb(ye,ne,J,ge),ie=new Ob(ye,re,ne,J),de=new Db(ye,X,$),ce=new pb(Z),ae=new pw(v,ee,te,K,X,ge,ce),se=new Lw(v,Z),oe=new vw,le=new Cw(K),he=new ub(v,ee,te,Y,ie,d,o),ue=new Ew(v,ie,X),me=new Pw(ye,J,X,Y),Ae=new db(ye,K,J),pe=new Pb(ye,K,J),J.programs=ae.programs,v.capabilities=X,v.extensions=K,v.properties=Z,v.renderLists=oe,v.shadowMap=ue,v.state=Y,v.info=J}be();const xe=new Mw(v,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=J.autoReset,t=ue.enabled,n=ue.autoUpdate,r=ue.needsUpdate,i=ue.type;be(),J.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=r,ue.type=i}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){ae.releaseProgram(e)}),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&e.side===Ns&&!1===e.forceSinglePass?(e.side=Es,e.needsUpdate=!0,Pe(e,t,n),e.side=Cs,e.needsUpdate=!0,Pe(e,t,n),e.side=Ns):Pe(e,t,n)}this.xr=xe,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(e){void 0!==e&&(F=e,this.setSize(B,M,!1))},this.getSize=function(e){return e.set(B,M)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=e,M=n,t.width=Math.floor(e*F),t.height=Math.floor(n*F),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(B*F,M*F).floor()},this.setDrawingBufferSize=function(e,n,r){B=e,M=n,F=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),Y.viewport(E.copy(P).multiplyScalar(F).round())},this.getScissor=function(e){return e.copy(U)},this.setScissor=function(e,t,n,r){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,r),Y.scissor(N.copy(U).multiplyScalar(F).round())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){Y.setScissorTest(D=e)},this.setOpaqueSort=function(e){R=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor(...arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==_){const t=_.texture.format;e=t===ul||t===ll||t===sl}if(e){const e=_.texture.type,t=e===zo||e===Wo||e===Vo||e===Jo||e===Xo||e===Yo,n=he.getClearColor(),r=he.getClearAlpha(),i=n.r,a=n.g,s=n.b;t?(A[0]=i,A[1]=a,A[2]=s,A[3]=r,ye.clearBufferuiv(ye.COLOR,0,A)):(p[0]=i,p[1]=a,p[2]=s,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else n|=ye.COLOR_BUFFER_BIT}e&&(n|=ye.DEPTH_BUFFER_BIT),t&&(n|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",_e,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),he.dispose(),oe.dispose(),le.dispose(),Z.dispose(),ee.dispose(),te.dispose(),ie.dispose(),ge.dispose(),me.dispose(),ae.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",ke),xe.removeEventListener("sessionend",Ie),Te.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=G);const s=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=G);$.resetTextureUnits();const a=t.fog,s=r.isMeshStandardMaterial?t.environment:null,o=null===_?v.outputColorSpace:!0===_.isXRRenderTarget?_.texture.colorSpace:hc,l=(r.isMeshStandardMaterial?te:ee).get(r.envMap||s),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,A=!!n.morphAttributes.color;let p=ho;r.toneMapped&&(null!==_&&!0!==_.isXRRenderTarget||(p=v.toneMapping));const f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,m=void 0!==f?f.length:0,y=Z.get(r),b=g.state.lights;if(!0===j&&(!0===z||e!==C)){const t=e===C&&r.id===S;ce.setState(r,e,t)}let x=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputColorSpace!==o||i.isBatchedMesh&&!1===y.batching?x=!0:i.isBatchedMesh||!0!==y.batching?i.isBatchedMesh&&!0===y.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===y.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===y.instancing?x=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?x=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===y.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===y.instancingMorph&&null!==i.morphTexture||y.envMap!==l||!0===r.fog&&y.fog!==a?x=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ce.numPlanes&&y.numIntersection===ce.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==h||y.morphNormals!==d||y.morphColors!==A||y.toneMapping!==p||y.morphTargetsCount!==m)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,y.__version=r.version);let w=y.currentProgram;!0===x&&(w=Pe(r,t,i));let E=!1,N=!1,k=!1;const I=w.getUniforms(),T=y.uniforms;Y.useProgram(w.program)&&(E=!0,N=!0,k=!0);r.id!==S&&(S=r.id,N=!0);if(E||C!==e){Y.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),I.setValue(ye,"projectionMatrix",e.projectionMatrix),I.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=I.map.cameraPosition;void 0!==t&&t.setValue(ye,Q.setFromMatrixPosition(e.matrixWorld)),X.logarithmicDepthBuffer&&I.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&I.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),C!==e&&(C=e,N=!0,k=!0)}if(i.isSkinnedMesh){I.setOptional(ye,i,"bindMatrix"),I.setOptional(ye,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(ye,"boneTexture",e.boneTexture,$))}i.isBatchedMesh&&(I.setOptional(ye,i,"batchingTexture"),I.setValue(ye,"batchingTexture",i._matricesTexture,$),I.setOptional(ye,i,"batchingIdTexture"),I.setValue(ye,"batchingIdTexture",i._indirectTexture,$),I.setOptional(ye,i,"batchingColorTexture"),null!==i._colorsTexture&&I.setValue(ye,"batchingColorTexture",i._colorsTexture,$));const B=n.morphAttributes;void 0===B.position&&void 0===B.normal&&void 0===B.color||de.update(i,n,w);(N||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,I.setValue(ye,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(T.envMap.value=l,T.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(T.envMapIntensity.value=t.environmentIntensity);N&&(I.setValue(ye,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&(L=k,(R=T).ambientLightColor.needsUpdate=L,R.lightProbe.needsUpdate=L,R.directionalLights.needsUpdate=L,R.directionalLightShadows.needsUpdate=L,R.pointLights.needsUpdate=L,R.pointLightShadows.needsUpdate=L,R.spotLights.needsUpdate=L,R.spotLightShadows.needsUpdate=L,R.rectAreaLights.needsUpdate=L,R.hemisphereLights.needsUpdate=L),a&&!0===r.fog&&se.refreshFogUniforms(T,a),se.refreshMaterialUniforms(T,r,F,M,g.state.transmissionRenderTarget[e.id]),Vx.upload(ye,Ue(y),T,$));var R,L;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Vx.upload(ye,Ue(y),T,$),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&I.setValue(ye,"center",i.center);if(I.setValue(ye,"modelViewMatrix",i.modelViewMatrix),I.setValue(ye,"normalMatrix",i.normalMatrix),I.setValue(ye,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];me.update(n,w),me.bind(n,w)}}return w}(e,t,n,r,i);Y.setMaterial(r,s);let l=n.index,c=1;if(!0===r.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,A=(u.start+u.count)*c;null!==a&&(d=Math.max(d,a.start*c),A=Math.min(A,(a.start+a.count)*c)),null!==l?(d=Math.max(d,0),A=Math.min(A,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),A=Math.min(A,h.count));const p=A-d;if(p<0||p===1/0)return;let f;ge.setup(i,r,o,n,l);let m=Ae;if(null!==l&&(f=ne.get(l),m=pe,m.setIndex(f)),i.isMesh)!0===r.wireframe?(Y.setLineWidth(r.wireframeLinewidth*q()),m.setMode(ye.LINES)):m.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*q()),i.isLineSegments?m.setMode(ye.LINES):i.isLineLoop?m.setMode(ye.LINE_LOOP):m.setMode(ye.LINE_STRIP)}else i.isPoints?m.setMode(ye.POINTS):i.isSprite&&m.setMode(ye.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)Cu("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),m.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))m.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,a=l?ne.get(l).bytesPerElement:1,s=Z.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)s.setValue(ye,"_gl_DrawID",r),m.render(e[r]/a,t[r])}else if(i.isInstancedMesh)m.renderInstances(d,p,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);m.renderInstances(d,p,t)}else m.render(d,p)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),g=le.get(n),g.init(t),y.push(g),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),g.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];Ee(a,n,e),r.add(a)}else Ee(t,n,e),r.add(t)}),g=y.pop(),r},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){Z.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ne=null;function ke(){Te.stop()}function Ie(){Te.start()}const Te=new nb;function Be(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){r&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),i=e.material;i.visible&&f.push(e,t,i,n,V.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||O.intersectsObject(e))){const t=ie.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),V.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),V.copy(t.boundingSphere.center)),V.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let a=0,s=r.length;a<s;a++){const s=r[a],o=i[s.materialIndex];o&&o.visible&&f.push(e,t,o,n,V.z,s)}}else i.visible&&f.push(e,t,i,n,V.z,null)}const i=e.children;for(let a=0,s=i.length;a<s;a++)Be(i[a],t,n,r)}function Me(e,t,n,r){const i=e.opaque,a=e.transmissive,s=e.transparent;g.setupLightsView(n),!0===j&&ce.setGlobalState(v.clippingPlanes,n),r&&Y.viewport(E.copy(r)),i.length>0&&Re(i,t,n),a.length>0&&Re(a,t,n),s.length>0&&Re(s,t,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Fe(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[r.id]&&(g.state.transmissionRenderTarget[r.id]=new Hu(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?Ko:zo,minFilter:Oo,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Iu.workingColorSpace}));const a=g.state.transmissionRenderTarget[r.id],s=r.viewport||E;a.setSize(s.z*v.transmissionResolutionScale,s.w*v.transmissionResolutionScale);const o=v.getRenderTarget(),l=v.getActiveCubeFace(),c=v.getActiveMipmapLevel();v.setRenderTarget(a),v.getClearColor(I),T=v.getClearAlpha(),T<1&&v.setClearColor(16777215,.5),v.clear(),W&&he.render(n);const u=v.toneMapping;v.toneMapping=ho;const h=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),g.setupLightsView(r),!0===j&&ce.setGlobalState(v.clippingPlanes,r),Re(e,n,r),$.updateMultisampleRenderTarget(a),$.updateRenderTargetMipmap(a),!1===K.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,a=t.length;i<a;i++){const a=t[i],s=a.object,o=a.geometry,l=a.material,c=a.group;if(l.side===Ns&&s.layers.test(r.layers)){const t=l.side;l.side=Es,l.needsUpdate=!0,Le(s,n,r,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&($.updateMultisampleRenderTarget(a),$.updateRenderTargetMipmap(a))}v.setRenderTarget(o,l,c),v.setClearColor(I,T),void 0!==h&&(r.viewport=h),v.toneMapping=u}function Re(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],s=a.object,o=a.geometry,l=a.group;let c=a.material;!0===c.allowOverride&&null!==r&&(c=r),s.layers.test(n.layers)&&Le(s,t,n,o,c,l)}}function Le(e,t,n,r,i,a){e.onBeforeRender(v,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,a),!0===i.transparent&&i.side===Ns&&!1===i.forceSinglePass?(i.side=Es,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=Cs,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=Ns):v.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(v,t,n,r,i,a)}function Pe(e,t,n){!0!==t.isScene&&(t=G);const r=Z.get(e),i=g.state.lights,a=g.state.shadowsArray,s=i.state.version,o=ae.getParameters(e,i.state,a,t,n),l=ae.getProgramCacheKey(o);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ce),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return De(e,o),u}else o.uniforms=ae.getUniforms(e),e.onBeforeCompile(o,v),u=ae.acquireProgram(o,l),c.set(l,u),r.uniforms=o.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ce.uniform),De(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Ue(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Vx.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function De(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Te.setAnimationLoop(function(e){Ne&&Ne(e)}),"undefined"!==typeof self&&Te.setContext(self),this.setAnimationLoop=function(e){Ne=e,xe.setAnimationLoop(e),null===e?Te.stop():Te.start()},xe.addEventListener("sessionstart",ke),xe.addEventListener("sessionend",Ie),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,_),g=le.get(e,y.length),g.init(t),y.push(g),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(H,Xc,t.reversedDepth),z=this.localClippingEnabled,j=ce.init(this.clippingPlanes,z),f=oe.get(e,m.length),f.init(),m.push(f),!0===xe.enabled&&!0===xe.isPresenting){const e=v.xr.getDepthSensingMesh();null!==e&&Be(e,t,-1/0,v.sortObjects)}Be(e,t,0,v.sortObjects),f.finish(),!0===v.sortObjects&&f.sort(R,L),W=!1===xe.enabled||!1===xe.isPresenting||!1===xe.hasDepthSensing(),W&&he.addToRenderList(f,e),this.info.render.frame++,!0===j&&ce.beginShadows();const n=g.state.shadowsArray;ue.render(n,e,t),!0===j&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=f.opaque,i=f.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(i.length>0)for(let t=0,a=n.length;t<a;t++){Fe(r,i,e,n[t])}W&&he.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Me(f,e,r,r.viewport)}}else i.length>0&&Fe(r,i,e,t),W&&he.render(e),Me(f,e,t);null!==_&&0===w&&($.updateMultisampleRenderTarget(_),$.updateRenderTargetMipmap(_)),!0===e.isScene&&e.onAfterRender(v,e,t),ge.resetDefaultState(),S=-1,C=null,y.pop(),y.length>0?(g=y[y.length-1],!0===j&&ce.setGlobalState(v.clippingPlanes,g.state.camera)):g=null,m.pop(),f=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(e,t,n){const r=Z.get(e);r.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:n,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Oe=ye.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=e,x=t,w=n;let r=!0,i=null,a=!1,s=!1;if(e){const o=Z.get(e);if(void 0!==o.__useDefaultFramebuffer)Y.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1;else if(void 0===o.__webglFramebuffer)$.setupRenderTarget(e);else if(o.__hasExternalTextures)$.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&Z.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");$.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],a=!0):i=e.samples>0&&!1===$.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),N.copy(e.scissor),k=e.scissorTest}else E.copy(P).multiplyScalar(F).floor(),N.copy(U).multiplyScalar(F).floor(),k=D;0!==n&&(i=Oe);if(Y.bindFramebuffer(ye.FRAMEBUFFER,i)&&r&&Y.drawBuffers(e,i),Y.viewport(E),Y.scissor(N),Y.setScissorTest(k),a){const r=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){const r=t;for(let t=0;t<e.textures.length;t++){const i=Z.get(e.textures[t]);ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0+t,i.__webglTexture,n,r)}}else if(null!==e&&0!==n){const t=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,t.__webglTexture,n)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,s){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(l=l[s]),l){Y.bindFramebuffer(ye.FRAMEBUFFER,l);try{const s=e.textures[o],l=s.format,c=s.type;if(!X.textureFormatReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!X.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&(e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+o),ye.readPixels(t,n,r,i,fe.convert(l),fe.convert(c),a))}finally{const e=null!==_?Z.get(_).__webglFramebuffer:null;Y.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,a,s){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(l=l[s]),l){if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){Y.bindFramebuffer(ye.FRAMEBUFFER,l);const s=e.textures[o],c=s.format,u=s.type;if(!X.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!X.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.bufferData(ye.PIXEL_PACK_BUFFER,a.byteLength,ye.STREAM_READ),e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+o),ye.readPixels(t,n,r,i,fe.convert(c),fe.convert(u),0);const d=null!==_?Z.get(_).__webglFramebuffer:null;Y.bindFramebuffer(ye.FRAMEBUFFER,d);const A=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t,n){return new Promise(function(r,i){setTimeout(function a(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}},n)})}(ye,A,4),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,h),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,a),ye.deleteBuffer(h),ye.deleteSync(A),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),a=Math.floor(e.image.height*r),s=null!==t?t.x:0,o=null!==t?t.y:0;$.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,s,o,i,a),Y.unbindTexture()};const je=ye.createFramebuffer(),ze=ye.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,r,i,a,s,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===p&&(0!==A?(Cu("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),p=A,A=0):p=0);const f=e.isCompressedTexture?e.mipmaps[p]:e.image;if(null!==h)n=h.max.x-h.min.x,r=h.max.y-h.min.y,i=h.isBox3?h.max.z-h.min.z:1,a=h.min.x,s=h.min.y,o=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-A);n=Math.floor(f.width*t),r=Math.floor(f.height*t),i=e.isDataArrayTexture?f.depth:e.isData3DTexture?Math.floor(f.depth*t):1,a=0,s=0,o=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=fe.convert(t.format),m=fe.convert(t.type);let y;t.isData3DTexture?($.setTexture3D(t,0),y=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?($.setTexture2DArray(t,0),y=ye.TEXTURE_2D_ARRAY):($.setTexture2D(t,0),y=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const v=ye.getParameter(ye.UNPACK_ROW_LENGTH),b=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),x=ye.getParameter(ye.UNPACK_SKIP_PIXELS),w=ye.getParameter(ye.UNPACK_SKIP_ROWS),_=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,f.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,a),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,s),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,o);const S=e.isDataArrayTexture||e.isData3DTexture,C=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=Z.get(e),d=Z.get(t),f=Z.get(h.__renderTarget),g=Z.get(d.__renderTarget);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,f.__webglFramebuffer),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let m=0;m<i;m++)S&&(ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(e).__webglTexture,A,o+m),ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,Z.get(t).__webglTexture,p,u+m)),ye.blitFramebuffer(a,s,n,r,l,c,n,r,ye.DEPTH_BUFFER_BIT,ye.NEAREST);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else if(0!==A||e.isRenderTargetTexture||Z.has(e)){const h=Z.get(e),d=Z.get(t);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,je),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,ze);for(let e=0;e<i;e++)S?ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,h.__webglTexture,A,o+e):ye.framebufferTexture2D(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,h.__webglTexture,A),C?ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,d.__webglTexture,p,u+e):ye.framebufferTexture2D(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,d.__webglTexture,p),0!==A?ye.blitFramebuffer(a,s,n,r,l,c,n,r,ye.COLOR_BUFFER_BIT,ye.NEAREST):C?ye.copyTexSubImage3D(y,p,l,c,u+e,a,s,n,r):ye.copyTexSubImage2D(y,p,l,c,a,s,n,r);Y.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Y.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else C?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(y,p,l,c,u,n,r,i,g,m,f.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(y,p,l,c,u,n,r,i,g,f.data):ye.texSubImage3D(y,p,l,c,u,n,r,i,g,m,f):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,p,l,c,n,r,g,m,f.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,p,l,c,f.width,f.height,g,f.data):ye.texSubImage2D(ye.TEXTURE_2D,p,l,c,n,r,g,m,f);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,v),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,b),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,w),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,_),0===p&&t.generateMipmaps&&ye.generateMipmap(y),Y.unbindTexture()},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&$.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?$.setTextureCube(e,0):e.isData3DTexture?$.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?$.setTexture2DArray(e,0):$.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){x=0,w=0,_=null,Y.reset(),ge.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Xc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Iu._getDrawingBufferColorSpace(e),t.unpackColorSpace=Iu._getUnpackColorSpace()}}var Dw=n(7205);function Ow(e){let t;const n=new Set,r=(e,r)=>{const i="function"===typeof e?e(t):e;if(i!==t){const e=t;t=r?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,subscribe:(e,r,a)=>r||a?function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=r(t);function o(){const n=r(t);if(!a(s,n)){const t=s;e(s=n,t)}}return n.add(o),()=>n.delete(o)}(e,r,a):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,i,a),a}const jw="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?k.useEffect:k.useLayoutEffect;const zw=[];function Hw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0}function Qw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(const s of zw)if(Hw(t,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:t,equal:r.equal,remove:()=>{const e=zw.indexOf(i);-1!==e&&zw.splice(e,1)},promise:(a=e,"object"===typeof a&&"function"===typeof a.then?e:e(...t)).then(e=>{i.response=e,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(e=>i.error=e)};var a;if(zw.push(i),!n)throw i.promise}var Vw=n(2016),Gw=n.n(Vw),Ww=n(8784);const qw=["args","attach"],Kw=["args","children"],Xw=["args","children"],Yw=["children","key","ref"],Jw=["children","key","ref"],Zw=["params"];const $w={};var e_,t_;const n_=e=>"colorSpace"in e||"outputColorSpace"in e,r_=()=>{var e;return null!=(e=$w.ColorManagement)?e:null},i_=e=>e&&e.isOrthographicCamera,a_="undefined"!==typeof window&&(null!=(e_=window.document)&&e_.createElement||"ReactNative"===(null==(t_=window.navigator)?void 0:t_.product))?k.useLayoutEffect:k.useEffect;function s_(e){const t=k.useRef(e);return a_(()=>{t.current=e},[e]),t}function o_(e){let{set:t}=e;return a_(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class l_ extends k.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}l_.getDerivedStateFromError=()=>({error:!0});const c_="__default",u_=new Map,h_=e=>e&&!!e.memoized&&!!e.changes;function d_(e){var t;const n="undefined"!==typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const A_=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function p_(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const f_={obj:e=>e===Object(e)&&!f_.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,boo:e=>"boolean"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){let{arrays:n="shallow",objects:r="reference",strict:i=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof e!==typeof t||!!e!==!!t)return!1;if(f_.str(e)||f_.num(e)||f_.boo(e))return e===t;const a=f_.obj(e);if(a&&"reference"===r)return e===t;const s=f_.arr(e);if(s&&"reference"===n)return e===t;if((s||a)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(a&&"shallow"===n&&"shallow"===r){for(o in i?t:e)if(!f_.equ(e[o],t[o],{strict:i,objects:"reference"}))return!1}else for(o in i?t:e)if(e[o]!==t[o])return!1;if(f_.und(o)){if(s&&0===e.length&&0===t.length)return!0;if(a&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function g_(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}function m_(e,t){return e.__r3f=M({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t),e}function y_(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),i=r.pop();return n=r.reduce((e,t)=>e[t],e),{target:n,key:i}}return{target:n,key:t}}const v_=/-\d+$/;function b_(e,t,n){if(f_.str(n)){if(v_.test(n)){const t=n.replace(v_,""),{target:r,key:i}=y_(e,t);Array.isArray(r[i])||(r[i]=[])}const{target:r,key:i}=y_(e,n);t.__r3f.previousAttach=r[i],r[i]=t}else t.__r3f.previousAttach=n(e,t)}function x_(e,t,n){var r,i;if(f_.str(n)){const{target:r,key:i}=y_(e,n),a=t.__r3f.previousAttach;void 0===a?delete r[i]:r[i]=a}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(i=t.__r3f)||delete i.previousAttach}function w_(e,t){let{children:n,key:r,ref:i}=t,a=F(t,Yw),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{children:o,key:l,ref:c}=s,u=F(s,Jw),h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=e.__r3f,A=Object.entries(a),p=[];if(h){const e=Object.keys(u);for(let t=0;t<e.length;t++)a.hasOwnProperty(e[t])||A.unshift([e[t],c_+"remove"])}A.forEach(t=>{let[n,r]=t;var i;if(null!=(i=e.__r3f)&&i.primitive&&"object"===n)return;if(f_.equ(r,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return p.push([n,r,!0,[]]);let s=[];n.includes("-")&&(s=n.split("-")),p.push([n,r,!1,s]);for(const e in a){const t=a[e];e.startsWith("".concat(n,"-"))&&p.push([e,t,!1,e.split("-")])}});const f=M({},a);return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(f.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(f.attach=d.memoizedProps.attach),{memoized:f,changes:p}}const __="undefined"!==typeof process&&!1;function S_(e,t){var n;const r=e.__r3f,i=null==r?void 0:r.root,a=null==i||null==i.getState?void 0:i.getState(),{memoized:s,changes:o}=h_(t)?t:w_(e,t),l=null==r?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let h=0;h<o.length;h++){let[t,n,i,s]=o[h];if(n_(e)){const e=3001,r="srgb",i="srgb-linear";"encoding"===t?(t="colorSpace",n=n===e?r:i):"outputEncoding"===t&&(t="outputColorSpace",n=n===e?r:i)}let l=e,d=l[t];if(s.length&&(d=s.reduce((e,t)=>e[t],e),!d||!d.set)){const[n,...r]=s.reverse();l=r.reverse().reduce((e,t)=>e[t],e),t=n}if(n===c_+"remove")if(l.constructor){let e=u_.get(l.constructor);e||(e=new l.constructor,u_.set(l.constructor,e)),n=e[t]}else n=0;if(i&&r)n?r.handlers[t]=n:delete r.handlers[t],r.eventCount=Object.keys(r.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Bh)){if(Array.isArray(n))d.fromArray?d.fromArray(n):d.set(...n);else if(d.copy&&n&&n.constructor&&(__?d.constructor.name===n.constructor.name:d.constructor===n.constructor))d.copy(n);else if(void 0!==n){var c;const e=null==(c=d)?void 0:c.isColor;!e&&d.setScalar?d.setScalar(n):d instanceof Bh&&n instanceof Bh?d.mask=n.mask:d.set(n),!r_()&&a&&!a.linear&&e&&d.convertSRGBToLinear()}}else{var u;if(l[t]=n,null!=(u=l[t])&&u.isTexture&&l[t].format===nl&&l[t].type===zo&&a){const e=l[t];n_(e)&&n_(a.gl)?e.colorSpace=a.gl.outputColorSpace:e.encoding=a.gl.outputEncoding}}C_(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const t=p_(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),r.eventCount&&t.interaction.push(e)}return!(1===o.length&&"onUpdate"===o[0][0])&&o.length&&null!=(n=e.__r3f)&&n.parent&&E_(e),e}function C_(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function E_(e){null==e.onUpdate||e.onUpdate(e)}function N_(e,t){e.manual||(i_(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function k_(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function I_(e,t,n,r){const i=n.get(t);i&&(n.delete(t),0===n.size&&(e.delete(r),i.target.releasePointerCapture(r)))}function T_(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f,i=null==r?void 0:r.handlers;if(n.hovered.delete(k_(e)),null!=r&&r.eventCount){const n=M(M({},e),{},{intersections:t});null==i.onPointerOut||i.onPointerOut(n),null==i.onPointerLeave||i.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(a){const{onPointerMissed:s,internal:o}=e.getState();o.lastEvent.current=a;const l="onPointerMove"===i,c="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,u=function(t,n){const r=e.getState(),i=new Set,a=[],s=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<s.length;e++){const t=A_(s[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let o=s.flatMap(function(e){const n=A_(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=A_(e.object),r=A_(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=k_(e);return!i.has(t)&&(i.add(t),!0)});r.events.filter&&(o=r.events.filter(o,r));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&a.push(M(M({},e),{},{eventObject:t})),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())i.has(k_(e.intersection))||a.push(e.intersection);return a}(a,l?t:void 0),h=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],i=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}(a):0;"onPointerDown"===i&&(o.initialClick=[a.offsetX,a.offsetY],o.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&h<=2&&(r(a,o.interaction),s&&s(a)),l&&n(u),function(t,r,i,a){const s=e.getState();if(t.length){const e={stopped:!1};for(const o of t){const l=A_(o.object)||s,{raycaster:c,pointer:u,camera:h,internal:d}=l,A=new pu(u.x,u.y,0).unproject(h),p=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},f=e=>{const t={intersection:o,target:r.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,t):d.capturedMap.set(e,new Map([[o.eventObject,t]])),r.target.setPointerCapture(e)},g=e=>{const t=d.capturedMap.get(e);t&&I_(d.capturedMap,o.eventObject,t,e)};let m={};for(let e in r){let t=r[e];"function"!==typeof t&&(m[e]=t)}let y=M(M(M({},o),m),{},{pointer:u,intersections:t,stopped:e.stopped,delta:i,unprojectedPoint:A,ray:c.ray,camera:h,stopPropagation(){const i="pointerId"in r&&d.capturedMap.get(r.pointerId);(!i||i.has(o.eventObject))&&(y.stopped=e.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...t.slice(0,t.indexOf(o)),o])},target:{hasPointerCapture:p,setPointerCapture:f,releasePointerCapture:g},currentTarget:{hasPointerCapture:p,setPointerCapture:f,releasePointerCapture:g},nativeEvent:r});if(a(y),!0===e.stopped)break}}}(u,a,h,function(e){const t=e.eventObject,n=t.__r3f,s=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(s.onPointerOver||s.onPointerEnter||s.onPointerOut||s.onPointerLeave){const t=k_(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==s.onPointerOver||s.onPointerOver(e),null==s.onPointerEnter||s.onPointerEnter(e))}null==s.onPointerMove||s.onPointerMove(e)}else{const n=s[i];n?c&&!o.initialHits.includes(t)||(r(a,o.interaction.filter(e=>!o.initialHits.includes(e))),n(e)):c&&o.initialHits.includes(t)&&r(a,o.interaction.filter(e=>!o.initialHits.includes(e)))}})}}}}const B_=e=>!(null==e||!e.render),M_=k.createContext(null),F_=(e,t)=>{const n=function(e){const t="function"===typeof e?Ow(e):e,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,k.useReducer)(e=>e+1,0),i=t.getState(),a=(0,k.useRef)(i),s=(0,k.useRef)(e),o=(0,k.useRef)(n),l=(0,k.useRef)(!1),c=(0,k.useRef)();let u;void 0===c.current&&(c.current=e(i));let h=!1;(a.current!==i||s.current!==e||o.current!==n||l.current)&&(u=e(i),h=!n(c.current,u)),jw(()=>{h&&(c.current=u),a.current=i,s.current=e,o.current=n,l.current=!1});const d=(0,k.useRef)(i);jw(()=>{const e=()=>{try{const e=t.getState(),n=s.current(e);o.current(c.current,n)||(a.current=e,c.current=n,r())}catch(SS){l.current=!0,r()}},n=t.subscribe(e);return t.getState()!==d.current&&e(),n},[]);const A=h?u:c.current;return(0,k.useDebugValue)(A),A};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}((n,r)=>{const i=new pu,a=new pu,s=new pu;function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:o,height:l,top:c,left:u}=n,h=o/l;t.isVector3?s.copy(t):s.set(...t);const d=e.getWorldPosition(i).distanceTo(s);if(i_(e))return{width:o/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*d,r=n*(o/l);return{width:r,height:n,top:c,left:u,factor:o/r,distance:d,aspect:h}}}let l;const c=e=>n(t=>({performance:M(M({},t.performance),{},{current:e})})),u=new du,h={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Sy,pointer:u,mouse:u,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();l&&clearTimeout(l),e.performance.current!==e.performance.min&&c(e.performance.min),l=setTimeout(()=>c(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:o},setEvents:e=>n(t=>M(M({},t),{},{events:M(M({},t.events),e)})),setSize:(e,t,i,s,l)=>{const c=r().camera,u={width:e,height:t,top:s||0,left:l||0,updateStyle:i};n(e=>({size:u,viewport:M(M({},e.viewport),o(c,a,u))}))},setDpr:e=>n(t=>{const n=d_(e);return{viewport:M(M({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:k.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return h}),r=n.getState();let i=r.size,a=r.viewport.dpr,s=r.camera;return n.subscribe(()=>{const{camera:e,size:t,viewport:r,gl:o,set:l}=n.getState();if(t.width!==i.width||t.height!==i.height||r.dpr!==a){var c;i=t,a=r.dpr,N_(e,t),o.setPixelRatio(r.dpr);const n=null!=(c=t.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&o.domElement instanceof HTMLCanvasElement;o.setSize(t.width,t.height,n)}e!==s&&(s=e,l(t=>({viewport:M(M({},t.viewport),t.viewport.getCurrentViewport(e))})))}),n.subscribe(t=>e(t)),n};let R_,L_=new Set,P_=new Set,U_=new Set;function D_(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function O_(e,t){switch(e){case"before":return D_(L_,t);case"after":return D_(P_,t);case"tail":return D_(U_,t)}}let j_,z_;function H_(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),j_=t.internal.subscribers,R_=0;R_<j_.length;R_++)z_=j_[R_],z_.ref.current(z_.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Q_(){const e=k.useContext(M_);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function V_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return Q_()(e,t)}function G_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Q_(),r=n.getState().internal.subscribe,i=s_(e);return a_(()=>r(i,t,n),[t,r,n]),null}const W_=new WeakMap;function q_(e,t){return function(n){let r=W_.get(n);r||(r=new n,W_.set(n,r)),e&&e(r);for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return Promise.all(a.map(e=>new Promise((n,i)=>r.load(e,e=>{e.scene&&Object.assign(e,g_(e.scene)),n(e)},t,t=>i(new Error("Could not load ".concat(e,": ").concat(null==t?void 0:t.message)))))))}}function K_(e,t,n,r){const i=Array.isArray(t)?t:[t],a=((e,t,n)=>Qw(e,t,!1,n))(q_(n,r),[e,...i],{equal:f_.equ});return Array.isArray(t)?a:a[0]}K_.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return((e,t,n)=>{Qw(e,t,!0,n)})(q_(n),[e,...r])},K_.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)zw.splice(0,zw.length);else{const t=zw.find(t=>Hw(e,t.keys,t.equal));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const X_=new Map,{invalidate:Y_,advance:J_}=function(e){let t,n,r,i=!1,a=!1;function s(o){n=requestAnimationFrame(s),i=!0,t=0,O_("before",o),a=!0;for(const n of e.values()){var l;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=H_(o,r))}if(a=!1,O_("after",o),0===t)return O_("tail",o),i=!1,cancelAnimationFrame(n)}return{loop:s,invalidate:function t(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var o;if(!n)return e.forEach(e=>t(e.store.getState(),r));null!=(o=n.gl.xr)&&o.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):a?2:1,i||(i=!0,requestAnimationFrame(s)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(n&&O_("before",t),r)H_(t,r,i);else for(const a of e.values())H_(t,a.store.getState());n&&O_("after",t)}}}(X_),{reconciler:Z_,applyProps:$_}=function(e,t){function n(e,t,n){let r,{args:i=[],attach:a}=t,s=F(t,qw),o="".concat(e[0].toUpperCase()).concat(e.slice(1));if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");r=m_(s.object,{type:e,root:n,attach:a,primitive:!0})}else{const t=$w[o];if(!t)throw new Error("R3F: ".concat(o," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(i))throw new Error("R3F: The args prop must be an array!");r=m_(new t(...i),{type:e,root:n,attach:a,memoizedProps:{args:i}})}return void 0===r.__r3f.attach&&(r.isBufferGeometry?r.__r3f.attach="geometry":r.isMaterial&&(r.__r3f.attach="material")),"inject"!==o&&S_(r,s),r}function r(e,t){let n=!1;var r,i;t&&(null!=(r=t.__r3f)&&r.attach?b_(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||m_(t,{}),t.__r3f.parent=e,E_(t),C_(t))}function i(e,t,n){let r=!1;if(t){var i,a;if(null!=(i=t.__r3f)&&i.attach)b_(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const i=e.children.filter(e=>e!==t),a=i.indexOf(n);e.children=[...i.slice(0,a),t,...i.slice(a)],r=!0}r||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||m_(t,{}),t.__r3f.parent=e,E_(t),C_(t)}}function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach(e=>s(t,e,n))}function s(e,t,n){if(t){var r,i,s;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(i=t.__r3f)&&i.attach)x_(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var o;e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{I_(n.capturedMap,t,e,r)})}(p_(t),t)}const c=null==(s=t.__r3f)?void 0:s.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)a(null==(l=t.__r3f)?void 0:l.objects,t,u),a(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,Ww.unstable_scheduleCallback)(Ww.unstable_IdlePriority,e):e()}C_(e)}}const o=()=>{};return{reconciler:Gw()({createInstance:n,removeChild:s,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&s(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&i(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var i;if((null!=(i=null==e?void 0:e.__r3f)?i:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:i}=r,a=F(r,Kw),{args:s=[],children:o}=n,l=F(n,Xw);if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==s[t]))return[!0];const c=w_(e,a,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,t,i,a,o,l){let[c,u]=t;c?function(e,t,i,a){var o;const l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;const c=n(t,i,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(c,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>r(c,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||s(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),r(l,c),c.raycast&&c.__r3f.eventCount&&p_(c).getState().internal.interaction.push(c);[a,a.alternate].forEach(e=>{null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))})}(e,i,o,l):S_(e,u)},commitMount(e,t,n,r){var i;const a=null!=(i=e.__r3f)?i:{};e.raycast&&a.handlers&&a.eventCount&&p_(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>m_(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&x_(r,e,n),e.isObject3D&&(e.visible=!1),C_(e)},unhideInstance(e,t){var n;const{attach:r,parent:i}=null!=(n=e.__r3f)?n:{};r&&i&&b_(i,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),C_(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():Dw.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&f_.fun(performance.now)?performance.now:f_.fun(Date.now)?Date.now:()=>0,scheduleTimeout:f_.fun(setTimeout)?setTimeout:void 0,cancelTimeout:f_.fun(clearTimeout)?clearTimeout:void 0}),applyProps:S_}}(0,function(){var e;const t="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!t)return Dw.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Dw.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Dw.ContinuousEventPriority;default:return Dw.DefaultEventPriority}}),eS={objects:"shallow",strict:!1},tS=(e,t)=>{const n="function"===typeof e?e(t):e;return B_(n)?n:new Uw(M({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function nS(e){const t=X_.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const i="function"===typeof reportError?reportError:console.error,a=r||F_(Y_,J_),s=n||Z_.createContainer(a,Dw.ConcurrentRoot,null,!1,null,"",i,null);let o;t||X_.set(e,{fiber:s,store:a});let l,c=!1;return{configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:r,scene:i,events:s,onCreated:u,shadows:h=!1,linear:d=!1,flat:A=!1,legacy:p=!1,orthographic:f=!1,frameloop:g="always",dpr:m=[1,2],performance:y,raycaster:v,camera:b,onPointerMissed:x}=t,w=a.getState(),_=w.gl;w.gl||w.set({gl:_=tS(n,e)});let S=w.raycaster;S||w.set({raycaster:S=new rv});const C=v||{},{params:E}=C,N=F(C,Zw);if(f_.equ(N,S,eS)||$_(S,M({},N)),f_.equ(E,S.params,eS)||$_(S,{params:M(M({},S.params),E)}),!w.camera||w.camera===l&&!f_.equ(l,b,eS)){l=b;const e=b instanceof lA,t=e?b:f?new $m(0,0,0,0,.1,1e3):new dA(75,0,.1,1e3);e||(t.position.z=5,b&&($_(t,b),("aspect"in b||"left"in b||"right"in b||"bottom"in b||"top"in b)&&(t.manual=!0,t.updateProjectionMatrix())),w.camera||null!=b&&b.rotation||t.lookAt(0,0,0)),w.set({camera:t}),S.camera=t}if(!w.scene){let e;null!=i&&i.isScene?e=i:(e=new wA,i&&$_(e,i)),w.set({scene:m_(e)})}if(!w.xr){var k;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&J_(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Y_(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"===typeof(null==(k=_.xr)?void 0:k.addEventListener)&&n.connect(),w.set({xr:n})}if(_.shadowMap){const e=_.shadowMap.enabled,t=_.shadowMap.type;if(_.shadowMap.enabled=!!h,f_.boo(h))_.shadowMap.type=_s;else if(f_.str(h)){var I;const e={basic:xs,percentage:ws,soft:_s,variance:Ss};_.shadowMap.type=null!=(I=e[h])?I:_s}else f_.obj(h)&&Object.assign(_.shadowMap,h);e===_.shadowMap.enabled&&t===_.shadowMap.type||(_.shadowMap.needsUpdate=!0)}const T=r_();if(T&&("enabled"in T?T.enabled=!p:"legacyMode"in T&&(T.legacyMode=p)),!c){$_(_,{outputEncoding:d?3e3:3001,toneMapping:A?ho:go})}w.legacy!==p&&w.set(()=>({legacy:p})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==A&&w.set(()=>({flat:A})),!n||f_.fun(n)||B_(n)||f_.equ(n,_,eS)||$_(_,n),s&&!w.events.handlers&&w.set({events:s(a)});const B=function(e,t){const n="undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:i,left:a,updateStyle:s=n}=t;return{width:e,height:r,top:i,left:a,updateStyle:s}}if("undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:i,left:a}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:i,left:a,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return f_.equ(B,w.size,eS)||w.setSize(B.width,B.height,B.updateStyle,B.top,B.left),m&&w.viewport.dpr!==d_(m)&&w.setDpr(m),w.frameloop!==g&&w.setFrameloop(g),w.onPointerMissed||w.set({onPointerMissed:x}),y&&!f_.equ(y,w.performance,eS)&&w.set(e=>({performance:M(M({},e.performance),y)})),o=u,c=!0,this},render(t){return c||this.configure(),Z_.updateContainer((0,va.jsx)(rS,{store:a,children:t,onCreated:o,rootElement:e}),s,null,()=>{}),a},unmount(){iS(e)}}}function rS(e){let{store:t,children:n,onCreated:r,rootElement:i}=e;return a_(()=>{const e=t.getState();e.set(e=>({internal:M(M({},e.internal),{},{active:!0})})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(i)},[]),(0,va.jsx)(M_.Provider,{value:t,children:n})}function iS(e,t){const n=X_.get(e),r=null==n?void 0:n.fiber;if(r){const i=null==n?void 0:n.store.getState();i&&(i.internal.active=!1),Z_.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var n,r,a,s;null==i.events.disconnect||i.events.disconnect(),null==(n=i.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(a=i.gl)||null==a.forceContextLoss||a.forceContextLoss(),null!=(s=i.gl)&&s.xr&&i.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(i),X_.delete(e),t&&t(e)}catch(o){}},500)})}}Z_.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:k.version});k.unstable_act;const aS={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function sS(e){const{handlePointer:t}=T_(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(aS).reduce((e,n)=>M(M({},e),{},{[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:i}=e.getState();null==i.disconnect||i.disconnect(),r(e=>({events:M(M({},e.events),{},{connected:t})})),Object.entries(null!=(n=i.handlers)?n:[]).forEach(e=>{let[n,r]=e;const[i,a]=aS[n];t.addEventListener(i,r,{passive:a})})},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach(e=>{let[t,r]=e;if(n&&n.connected instanceof HTMLElement){const[e]=aS[t];n.connected.removeEventListener(e,r)}}),t(e=>({events:M(M({},e.events),{},{connected:void 0})})))}}}function oS(e,t){let n;return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];window.clearTimeout(n),n=window.setTimeout(()=>e(...i),t)}}function lS(){let{debounce:e,scroll:t,polyfill:n,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const i=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,s]=(0,k.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=(0,k.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a,orientationHandler:null}),l=e?"number"==typeof e?e:e.scroll:null,c=e?"number"==typeof e?e:e.resize:null,u=(0,k.useRef)(!1);(0,k.useEffect)(()=>(u.current=!0,()=>{u.current=!1}));const[h,d,A]=(0,k.useMemo)(()=>{const e=()=>{if(!o.current.element)return;const{left:e,top:t,width:n,height:i,bottom:a,right:l,x:c,y:h}=o.current.element.getBoundingClientRect(),d={left:e,top:t,width:n,height:i,bottom:a,right:l,x:c,y:h};o.current.element instanceof HTMLElement&&r&&(d.height=o.current.element.offsetHeight,d.width=o.current.element.offsetWidth),Object.freeze(d),u.current&&!hS(o.current.lastBounds,d)&&s(o.current.lastBounds=d)};return[e,c?oS(e,c):e,l?oS(e,l):e]},[s,r,l,c]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",A,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function f(){o.current.element&&(o.current.resizeObserver=new i(A),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(e=>e.addEventListener("scroll",A,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{A()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}return function(e,t){(0,k.useEffect)(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(A,!!t),function(e){(0,k.useEffect)(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(d),(0,k.useEffect)(()=>{p(),f()},[t,A,d]),(0,k.useEffect)(()=>p,[]),[e=>{!e||e===o.current.element||(p(),o.current.element=e,o.current.scrollContainers=cS(e),f())},a,h]}function cS(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...cS(e.parentElement)]}const uS=["x","y","top","bottom","left","right","width","height"],hS=(e,t)=>uS.every(n=>e[n]===t[n]);var dS,AS,pS=Object.defineProperty,fS=Object.defineProperties,gS=Object.getOwnPropertyDescriptors,mS=Object.getOwnPropertySymbols,yS=Object.prototype.hasOwnProperty,vS=Object.prototype.propertyIsEnumerable,bS=(e,t,n)=>t in e?pS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xS=(e,t)=>{for(var n in t||(t={}))yS.call(t,n)&&bS(e,n,t[n]);if(mS)for(var n of mS(t))vS.call(t,n)&&bS(e,n,t[n]);return e};"undefined"===typeof window||!(null==(dS=window.document)?void 0:dS.createElement)&&"ReactNative"!==(null==(AS=window.navigator)?void 0:AS.product)?k.useEffect:k.useLayoutEffect;function wS(e,t,n){if(!e)return;if(!0===n(e))return e;let r=t?e.return:e.child;for(;r;){const e=wS(r,t,n);if(e)return e;r=t?null:r.sibling}}function _S(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(rle){return e}}const SS=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return SS.apply(this,arguments);console.error=SS};const CS=_S(k.createContext(null));class ES extends k.Component{render(){return k.createElement(CS.Provider,{value:this._reactInternals},this.props.children)}}function NS(){const e=k.useContext(CS);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=k.useId();return k.useMemo(()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=wS(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}function kS(){const e=function(){const e=NS(),[t]=k.useState(()=>new Map);t.clear();let n=e;for(;n;){if(n.type&&"object"===typeof n.type){const e=void 0===n.type._context&&n.type.Provider===n.type?n.type:n.type._context;e&&e!==CS&&!t.has(e)&&t.set(e,k.useContext(_S(e)))}n=n.return}return t}();return k.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>k.createElement(t,null,k.createElement(n.Provider,((e,t)=>fS(e,gS(t)))(xS({},r),{value:e.get(n)}))),e=>k.createElement(ES,xS({},e))),[e])}const IS=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],TS=k.forwardRef(function(t,n){let{children:r,fallback:i,resize:a,style:s,gl:o,events:l=sS,eventSource:c,eventPrefix:u,shadows:h,linear:d,flat:A,legacy:p,orthographic:f,frameloop:g,dpr:m,performance:y,raycaster:v,camera:b,scene:x,onPointerMissed:w,onCreated:_}=t,S=F(t,IS);k.useMemo(()=>{return t=e,void Object.assign($w,t);var t},[]);const C=kS(),[E,N]=lS(M({scroll:!0,debounce:{scroll:50,resize:0}},a)),I=k.useRef(null),T=k.useRef(null);k.useImperativeHandle(n,()=>I.current);const B=s_(w),[R,L]=k.useState(!1),[P,U]=k.useState(!1);if(R)throw R;if(P)throw P;const D=k.useRef(null);a_(()=>{const e=I.current;N.width>0&&N.height>0&&e&&(D.current||(D.current=nS(e)),D.current.configure({gl:o,events:l,shadows:h,linear:d,flat:A,legacy:p,orthographic:f,frameloop:g,dpr:m,performance:y,raycaster:v,camera:b,scene:x,size:N,onPointerMissed:function(){return null==B.current?void 0:B.current(...arguments)},onCreated:e=>{var t;null==e.events.connect||e.events.connect(c?(t=c)&&t.hasOwnProperty("current")?c.current:c:T.current),u&&e.setEvents({compute:(e,t)=>{const n=e[u+"X"],r=e[u+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==_||_(e)}}),D.current.render((0,va.jsx)(C,{children:(0,va.jsx)(l_,{set:U,children:(0,va.jsx)(k.Suspense,{fallback:(0,va.jsx)(o_,{set:L}),children:null!=r?r:null})})})))}),k.useEffect(()=>{const e=I.current;if(e)return()=>iS(e)},[]);const O=c?"none":"auto";return(0,va.jsx)("div",M(M({ref:T,style:M({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:O},s)},S),{},{children:(0,va.jsx)("div",{ref:E,style:{width:"100%",height:"100%"},children:(0,va.jsx)("canvas",{ref:I,style:{display:"block"},children:i})})}))}),BS=k.forwardRef(function(e,t){return(0,va.jsx)(ES,{children:(0,va.jsx)(TS,M(M({},e),{},{ref:t}))})}),MS=e=>e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e;function FS(e,t){const n=V_(e=>e.gl),r=K_(Om,MS(e)?Object.values(e):e);(0,k.useLayoutEffect)(()=>{null==t||t(r)},[t]),(0,k.useEffect)(()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof Ou?e=[r]:MS(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof Ou&&n.initTexture(e)})}},[n,r]);const i=(0,k.useMemo)(()=>{if(MS(e)){const t={};let n=0;for(const i in e)t[i]=r[n++];return t}return r},[e,r]);return i}FS.preload=e=>K_.preload(Om,e),FS.clear=e=>K_.clear(Om,e);function RS(){return RS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},RS.apply(null,arguments)}const LS=["args","children"];function PS(e,t){const n=e+"Geometry";return k.forwardRef((e,r)=>{let{args:i,children:a}=e,s=F(e,LS);const o=k.useRef(null);return k.useImperativeHandle(r,()=>o.current),k.useLayoutEffect(()=>{null==t||t(o.current)}),k.createElement("mesh",RS({ref:o},s),k.createElement(n,{attach:"geometry",args:i}),a)})}const US=PS("sphere"),DS=["samples","depth"];function OS(e,t,n){const r=V_(e=>e.size),i=V_(e=>e.viewport),a="number"===typeof e?e:r.width*i.dpr,s="number"===typeof t?t:r.height*i.dpr,o=("number"===typeof e?n:e)||{},{samples:l=0,depth:c}=o,u=F(o,DS),h=k.useMemo(()=>{const e=new Hu(a,s,M({minFilter:Po,magFilter:Po,type:Ko},u));return c&&(e.depthTexture=new bf(a,s,qo)),e.samples=l,e},[]);return k.useLayoutEffect(()=>{h.setSize(a,s),l&&(h.samples=l)},[l,h,a,s]),k.useEffect(()=>()=>h.dispose(),[]),h}const jS=["envMap","resolution","frames","makeDefault","children"],zS=k.forwardRef((e,t)=>{let{envMap:n,resolution:r=256,frames:i=1/0,makeDefault:a,children:s}=e,o=F(e,jS);const l=V_(e=>{let{set:t}=e;return t}),c=V_(e=>{let{camera:t}=e;return t}),u=V_(e=>{let{size:t}=e;return t}),h=k.useRef(null);k.useImperativeHandle(t,()=>h.current,[]);const d=k.useRef(null),A=OS(r);k.useLayoutEffect(()=>{o.manual||(h.current.aspect=u.width/u.height)},[u,o]),k.useLayoutEffect(()=>{h.current.updateProjectionMatrix()});let p=0,f=null;const g="function"===typeof s;return G_(e=>{g&&(i===1/0||p<i)&&(d.current.visible=!1,e.gl.setRenderTarget(A),f=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,h.current),e.scene.background=f,e.gl.setRenderTarget(null),d.current.visible=!0,p++)}),k.useLayoutEffect(()=>{if(a){const e=c;return l(()=>({camera:h.current})),()=>l(()=>({camera:e}))}},[h,a,l]),k.createElement(k.Fragment,null,k.createElement("perspectiveCamera",RS({ref:h},o),!g&&s),k.createElement("group",{ref:d},g&&s(A.texture)))});var HS=Object.defineProperty,QS=(e,t,n)=>(((e,t,n)=>{t in e?HS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);class VS{constructor(){QS(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}var GS=Object.defineProperty,WS=(e,t,n)=>(((e,t,n)=>{t in e?GS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const qS=new vh,KS=new yp,XS=Math.cos(Math.PI/180*70),YS=(e,t)=>(e%t+t)%t;class JS extends VS{constructor(e,t){super(),WS(this,"object"),WS(this,"domElement"),WS(this,"enabled",!0),WS(this,"target",new pu),WS(this,"minDistance",0),WS(this,"maxDistance",1/0),WS(this,"minZoom",0),WS(this,"maxZoom",1/0),WS(this,"minPolarAngle",0),WS(this,"maxPolarAngle",Math.PI),WS(this,"minAzimuthAngle",-1/0),WS(this,"maxAzimuthAngle",1/0),WS(this,"enableDamping",!1),WS(this,"dampingFactor",.05),WS(this,"enableZoom",!0),WS(this,"zoomSpeed",1),WS(this,"enableRotate",!0),WS(this,"rotateSpeed",1),WS(this,"enablePan",!0),WS(this,"panSpeed",1),WS(this,"screenSpacePanning",!0),WS(this,"keyPanSpeed",7),WS(this,"zoomToCursor",!1),WS(this,"autoRotate",!1),WS(this,"autoRotateSpeed",2),WS(this,"reverseOrbit",!1),WS(this,"reverseHorizontalOrbit",!1),WS(this,"reverseVerticalOrbit",!1),WS(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),WS(this,"mouseButtons",{LEFT:fs.ROTATE,MIDDLE:fs.DOLLY,RIGHT:fs.PAN}),WS(this,"touches",{ONE:gs.ROTATE,TWO:gs.DOLLY_PAN}),WS(this,"target0"),WS(this,"position0"),WS(this,"zoom0"),WS(this,"_domElementKeyEvents",null),WS(this,"getPolarAngle"),WS(this,"getAzimuthalAngle"),WS(this,"setPolarAngle"),WS(this,"setAzimuthalAngle"),WS(this,"getDistance"),WS(this,"getZoomScale"),WS(this,"listenToKeyEvents"),WS(this,"stopListenToKeyEvents"),WS(this,"saveState"),WS(this,"reset"),WS(this,"update"),WS(this,"connect"),WS(this,"dispose"),WS(this,"dollyIn"),WS(this,"dollyOut"),WS(this,"getScale"),WS(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=YS(e,2*Math.PI),r=c.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=YS(e,2*Math.PI),r=c.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Y),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Y),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),o=s.NONE},this.update=(()=>{const t=new pu,i=new pu(0,1,0),a=(new Au).setFromUnitVectors(e.up,i),A=a.clone().invert(),p=new pu,f=new Au,g=2*Math.PI;return function(){const m=n.object.position;a.setFromUnitVectors(e.up,i),A.copy(a).invert(),t.copy(m).sub(n.target),t.applyQuaternion(a),c.setFromVector3(t),n.autoRotate&&o===s.NONE&&k(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=n.minAzimuthAngle,v=n.maxAzimuthAngle;isFinite(y)&&isFinite(v)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),v<-Math.PI?v+=g:v>Math.PI&&(v-=g),c.theta=y<=v?Math.max(y,Math.min(v,c.theta)):c.theta>(y+v)/2?Math.max(y,c.theta):Math.min(v,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&S||n.object.isOrthographicCamera?c.radius=U(c.radius):c.radius=U(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(A),m.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0));let b=!1;if(n.zoomToCursor&&S){let r=null;if(n.object instanceof dA&&n.object.isPerspectiveCamera){const e=t.length();r=U(e*h);const i=e-r;n.object.position.addScaledVector(w,i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new pu(_.x,_.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix(),b=!0;const i=new pu(_.x,_.y,0);i.unproject(n.object),n.object.position.sub(i).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(qS.origin.copy(n.object.position),qS.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(qS.direction))<XS?e.lookAt(n.target):(KS.setFromNormalAndCoplanarPoint(n.object.up,n.target),qS.intersectPlane(KS,n.target))))}else n.object instanceof $m&&n.object.isOrthographicCamera&&(b=1!==h,b&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix()));return h=1,S=!1,!!(b||p.distanceToSquared(n.object.position)>l||8*(1-f.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),p.copy(n.object.position),f.copy(n.object.quaternion),b=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",J),n.domElement.addEventListener("pointerdown",W),n.domElement.addEventListener("pointercancel",K),n.domElement.addEventListener("wheel",X)},this.dispose=()=>{var e,t,r,i,a,s;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",J),null==(t=n.domElement)||t.removeEventListener("pointerdown",W),null==(r=n.domElement)||r.removeEventListener("pointercancel",K),null==(i=n.domElement)||i.removeEventListener("wheel",X),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointermove",q),null==(s=n.domElement)||s.ownerDocument.removeEventListener("pointerup",K),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Y)};const n=this,r={type:"change"},i={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const l=1e-6,c=new lv,u=new lv;let h=1;const d=new pu,A=new du,p=new du,f=new du,g=new du,m=new du,y=new du,v=new du,b=new du,x=new du,w=new pu,_=new du;let S=!1;const C=[],E={};function N(){return Math.pow(.95,n.zoomSpeed)}function k(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function I(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const T=(()=>{const e=new pu;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}})(),B=(()=>{const e=new pu;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}})(),M=(()=>{const e=new pu;return function(t,r){const i=n.domElement;if(i&&n.object instanceof dA&&n.object.isPerspectiveCamera){const a=n.object.position;e.copy(a).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),T(2*t*s/i.clientHeight,n.object.matrix),B(2*r*s/i.clientHeight,n.object.matrix)}else i&&n.object instanceof $m&&n.object.isOrthographicCamera?(T(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),B(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function F(e){n.object instanceof dA&&n.object.isPerspectiveCamera||n.object instanceof $m&&n.object.isOrthographicCamera?h=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(e){F(h/e)}function L(e){F(h*e)}function P(e){if(!n.zoomToCursor||!n.domElement)return;S=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,a=t.width,s=t.height;_.x=r/a*2-1,_.y=-i/s*2+1,w.set(_.x,_.y,1).unproject(n.object).sub(n.object.position).normalize()}function U(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function D(e){A.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY)}function j(){if(1==C.length)A.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);A.set(e,t)}}function z(){if(1==C.length)g.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);g.set(e,t)}}function H(){const e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,n=Math.sqrt(e*e+t*t);v.set(0,n)}function Q(e){if(1==C.length)p.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}f.subVectors(p,A).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(k(2*Math.PI*f.x/t.clientHeight),I(2*Math.PI*f.y/t.clientHeight)),A.copy(p)}function V(e){if(1==C.length)m.set(e.pageX,e.pageY);else{const t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}y.subVectors(m,g).multiplyScalar(n.panSpeed),M(y.x,y.y),g.copy(m)}function G(e){const t=$(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);b.set(0,a),x.set(0,Math.pow(b.y/v.y,n.zoomSpeed)),R(x.y),v.copy(b)}function W(e){var t,r;!1!==n.enabled&&(0===C.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",q),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",K)),function(e){C.push(e)}(e),"touch"===e.pointerType?function(e){switch(Z(e),C.length){case 1:switch(n.touches.ONE){case gs.ROTATE:if(!1===n.enableRotate)return;j(),o=s.TOUCH_ROTATE;break;case gs.PAN:if(!1===n.enablePan)return;z(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(n.touches.TWO){case gs.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&H(),n.enablePan&&z(),o=s.TOUCH_DOLLY_PAN;break;case gs.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&H(),n.enableRotate&&j(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(i)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case fs.DOLLY:if(!1===n.enableZoom)return;!function(e){P(e),v.set(e.clientX,e.clientY)}(e),o=s.DOLLY;break;case fs.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;O(e),o=s.PAN}else{if(!1===n.enableRotate)return;D(e),o=s.ROTATE}break;case fs.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;D(e),o=s.ROTATE}else{if(!1===n.enablePan)return;O(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&n.dispatchEvent(i)}(e))}function q(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Z(e),o){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;Q(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;V(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&G(e),n.enablePan&&V(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&G(e),n.enableRotate&&Q(e)}(e),n.update();break;default:o=s.NONE}}(e):function(e){if(!1===n.enabled)return;switch(o){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,A).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(k(2*Math.PI*f.x/t.clientHeight),I(2*Math.PI*f.y/t.clientHeight)),A.copy(p),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,v),x.y>0?R(N()):x.y<0&&L(N()),v.copy(b),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),y.subVectors(m,g).multiplyScalar(n.panSpeed),M(y.x,y.y),g.copy(m),n.update()}(e)}}(e))}function K(e){var t,r,i;!function(e){delete E[e.pointerId];for(let t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}(e),0===C.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",q),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointerup",K)),n.dispatchEvent(a),o=s.NONE}function X(e){!1===n.enabled||!1===n.enableZoom||o!==s.NONE&&o!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(i),function(e){P(e),e.deltaY<0?L(N()):e.deltaY>0&&R(N()),n.update()}(e),n.dispatchEvent(a))}function Y(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:M(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:M(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:M(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:M(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function J(e){!1!==n.enabled&&e.preventDefault()}function Z(e){let t=E[e.pointerId];void 0===t&&(t=new du,E[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){const t=e.pointerId===C[0].pointerId?C[1]:C[0];return E[t.pointerId]}this.dollyIn=function(){L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:N()),n.update()},this.dollyOut=function(){R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:N()),n.update()},this.getScale=()=>h,this.setScale=e=>{F(e),n.update()},this.getZoomScale=()=>N(),void 0!==t&&this.connect(t),this.update()}}const ZS=["makeDefault","camera","regress","domElement","enableDamping","keyEvents","onChange","onStart","onEnd"],$S=k.forwardRef((e,t)=>{let{makeDefault:n,camera:r,regress:i,domElement:a,enableDamping:s=!0,keyEvents:o=!1,onChange:l,onStart:c,onEnd:u}=e,h=F(e,ZS);const d=V_(e=>e.invalidate),A=V_(e=>e.camera),p=V_(e=>e.gl),f=V_(e=>e.events),g=V_(e=>e.setEvents),m=V_(e=>e.set),y=V_(e=>e.get),v=V_(e=>e.performance),b=r||A,x=a||f.connected||p.domElement,w=k.useMemo(()=>new JS(b),[b]);return G_(()=>{w.enabled&&w.update()},-1),k.useEffect(()=>(o&&w.connect(!0===o?x:o),w.connect(x),()=>{w.dispose()}),[o,x,i,w,d]),k.useEffect(()=>{const e=e=>{d(),i&&v.regress(),l&&l(e)},t=e=>{c&&c(e)},n=e=>{u&&u(e)};return w.addEventListener("change",e),w.addEventListener("start",t),w.addEventListener("end",n),()=>{w.removeEventListener("start",t),w.removeEventListener("end",n),w.removeEventListener("change",e)}},[l,c,u,w,d,g]),k.useEffect(()=>{if(n){const e=y().controls;return m({controls:w}),()=>m({controls:e})}},[n,w]),k.createElement("primitive",RS({ref:t,object:w,enableDamping:s},h))}),eC=["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","castShadow","receiveShadow","material","geometry","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents"],tC=new pu,nC=new pu,rC=new pu,iC=new du;function aC(e,t,n){const r=tC.setFromMatrixPosition(e.matrixWorld);r.project(t);const i=n.width/2,a=n.height/2;return[r.x*i+i,-r.y*a+a]}const sC=e=>Math.abs(e)<1e-10?0:e;function oC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r="matrix3d(";for(let i=0;16!==i;i++)r+=sC(t[i]*e.elements[i])+(15!==i?",":")");return n+r}const lC=(cC=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>oC(e,cC));var cC;const uC=(e,t)=>oC(e,(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1])(t),"translate(-50%,-50%)");const hC=k.forwardRef((e,t)=>{let{children:n,eps:r=.001,style:i,className:a,prepend:s,center:o,fullscreen:l,portal:c,distanceFactor:u,sprite:h=!1,transform:d=!1,occlude:A,onOcclude:p,castShadow:f,receiveShadow:g,material:m,geometry:y,zIndexRange:v=[16777271,0],calculatePosition:b=aC,as:x="div",wrapperClass:w,pointerEvents:_="auto"}=e,S=F(e,eC);const{gl:C,camera:E,scene:N,size:T,raycaster:B,events:R,viewport:L}=V_(),[P]=k.useState(()=>document.createElement(x)),U=k.useRef(),D=k.useRef(null),O=k.useRef(0),j=k.useRef([0,0]),z=k.useRef(null),H=k.useRef(null),Q=(null==c?void 0:c.current)||R.connected||C.domElement.parentNode,V=k.useRef(null),G=k.useRef(!1),W=k.useMemo(()=>A&&"blending"!==A||Array.isArray(A)&&A.length&&function(e){return e&&"object"===typeof e&&"current"in e}(A[0]),[A]);k.useLayoutEffect(()=>{const e=C.domElement;A&&"blending"===A?(e.style.zIndex="".concat(Math.floor(v[0]/2)),e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[A]),k.useLayoutEffect(()=>{if(D.current){const e=U.current=I.createRoot(P);if(N.updateMatrixWorld(),d)P.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=b(D.current,E,T);P.style.cssText="position:absolute;top:0;left:0;transform:translate3d(".concat(e[0],"px,").concat(e[1],"px,0);transform-origin:0 0;")}return Q&&(s?Q.prepend(P):Q.appendChild(P)),()=>{Q&&Q.removeChild(P),e.unmount()}}},[Q,d]),k.useLayoutEffect(()=>{w&&(P.className=w)},[w]);const q=k.useMemo(()=>d?{position:"absolute",top:0,left:0,width:T.width,height:T.height,transformStyle:"preserve-3d",pointerEvents:"none"}:M(M({position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none"},l&&{top:-T.height/2,left:-T.width/2,width:T.width,height:T.height}),i),[i,o,l,T,d]),K=k.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);k.useLayoutEffect(()=>{var e,r;(G.current=!1,d)?null==(e=U.current)||e.render(k.createElement("div",{ref:z,style:q},k.createElement("div",{ref:H,style:K},k.createElement("div",{ref:t,className:a,style:i,children:n})))):null==(r=U.current)||r.render(k.createElement("div",{ref:t,style:q,className:a,children:n}))});const X=k.useRef(!0);G_(e=>{if(D.current){E.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const e=d?j.current:b(D.current,E,T);if(d||Math.abs(O.current-E.zoom)>r||Math.abs(j.current[0]-e[0])>r||Math.abs(j.current[1]-e[1])>r){const t=function(e,t){const n=tC.setFromMatrixPosition(e.matrixWorld),r=nC.setFromMatrixPosition(t.matrixWorld),i=n.sub(r),a=t.getWorldDirection(rC);return i.angleTo(a)>Math.PI/2}(D.current,E);let n=!1;W&&(Array.isArray(A)?n=A.map(e=>e.current):"blending"!==A&&(n=[N]));const r=X.current;if(n){const e=function(e,t,n,r){const i=tC.setFromMatrixPosition(e.matrixWorld),a=i.clone();a.project(t),iC.set(a.x,a.y),n.setFromCamera(iC,t);const s=n.intersectObjects(r,!0);if(s.length){const e=s[0].distance;return i.distanceTo(n.ray.origin)<e}return!0}(D.current,E,B,n);X.current=e&&!t}else X.current=!t;r!==X.current&&(p?p(!X.current):P.style.display=X.current?"block":"none");const i=Math.floor(v[0]/2),a=A?W?[v[0],i]:[i-1,0]:v;if(P.style.zIndex="".concat(function(e,t,n){if(t instanceof dA||t instanceof $m){const r=tC.setFromMatrixPosition(e.matrixWorld),i=nC.setFromMatrixPosition(t.matrixWorld),a=r.distanceTo(i),s=(n[1]-n[0])/(t.far-t.near),o=n[1]-s*t.far;return Math.round(s*a+o)}}(D.current,E,a)),d){const[e,t]=[T.width/2,T.height/2],n=E.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:i,left:a,bottom:s,right:o}=E,l=lC(E.matrixWorldInverse),c=r?"scale(".concat(n,")translate(").concat(sC(-(o+a)/2),"px,").concat(sC((i+s)/2),"px)"):"translateZ(".concat(n,"px)");let d=D.current.matrixWorld;h&&(d=E.matrixWorldInverse.clone().transpose().copyPosition(d).scale(D.current.scale),d.elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),P.style.width=T.width+"px",P.style.height=T.height+"px",P.style.perspective=r?"":"".concat(n,"px"),z.current&&H.current&&(z.current.style.transform="".concat(c).concat(l,"translate(").concat(e,"px,").concat(t,"px)"),H.current.style.transform=uC(d,1/((u||10)/400)))}else{const t=void 0===u?1:function(e,t){if(t instanceof $m)return t.zoom;if(t instanceof dA){const n=tC.setFromMatrixPosition(e.matrixWorld),r=nC.setFromMatrixPosition(t.matrixWorld),i=t.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(i/2)*a)}return 1}(D.current,E)*u;P.style.transform="translate3d(".concat(e[0],"px,").concat(e[1],"px,0) scale(").concat(t,")")}j.current=e,O.current=E.zoom}}if(!W&&V.current&&!G.current)if(d){if(z.current){const e=z.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=E;if(t||y)S.scale&&(Array.isArray(S.scale)?S.scale instanceof pu?V.current.scale.copy(S.scale.clone().divideScalar(1)):V.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):V.current.scale.setScalar(1/S.scale));else{const t=(u||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;V.current.scale.set(n,r,1)}G.current=!0}}}else{const t=P.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/L.factor,n=t.clientWidth*e,r=t.clientHeight*e;V.current.scale.set(n,r,1),G.current=!0}V.current.lookAt(e.camera.position)}});const Y=k.useMemo(()=>({vertexShader:d?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "}),[d]);return k.createElement("group",RS({},S,{ref:D}),A&&!W&&k.createElement("mesh",{castShadow:f,receiveShadow:g,ref:V},y||k.createElement("planeGeometry",null),m||k.createElement("shaderMaterial",{side:Ns,vertexShader:Y.vertexShader,fragmentShader:Y.fragmentShader})))}),dC=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"===typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!==typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e))},s=t=e(r,i,a);return a},AC=e=>e;const pC=e=>{const t=(e=>e?dC(e):dC)(e),n=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AC;const n=k.useSyncExternalStore(e.subscribe,k.useCallback(()=>t(e.getState()),[e,t]),k.useCallback(()=>t(e.getInitialState()),[e,t]));return k.useDebugValue(n),n}(t,e);return Object.assign(n,t),n},fC=e=>e?pC(e):pC,gC=fC((e,t)=>({images:{before:null,after:null,captured:[],panorama:null},setBeforeImage:t=>e(e=>({images:M(M({},e.images),{},{before:t})})),setAfterImage:t=>e(e=>({images:M(M({},e.images),{},{after:t})})),addCapturedImage:t=>e(e=>({images:M(M({},e.images),{},{captured:[...e.images.captured,t]})})),clearCapturedImages:()=>e(e=>({images:M(M({},e.images),{},{captured:[]})})),viewMode:"before",setViewMode:t=>e({viewMode:t}),shingles:{selectedColor:"weathered-wood",appliedRegions:[],opacity:.95},setShingleColor:t=>e(e=>({shingles:M(M({},e.shingles),{},{selectedColor:t})})),addShingleRegion:t=>e(e=>({shingles:M(M({},e.shingles),{},{appliedRegions:[...e.shingles.appliedRegions,t]})})),removeShingleRegion:t=>e(e=>({shingles:M(M({},e.shingles),{},{appliedRegions:e.shingles.appliedRegions.filter(e=>e.id!==t)})})),setShingleOpacity:t=>e(e=>({shingles:M(M({},e.shingles),{},{opacity:t})})),lighting:{enabled:!1,trackColor:"white",lights:[],pattern:"solid",color:"#ffffff",brightness:100},toggleLighting:()=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:!e.lighting.enabled})})),setLightingEnabled:t=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:t})})),setTrackColor:t=>e(e=>({lighting:M(M({},e.lighting),{},{trackColor:t})})),addLight:t=>e(e=>({lighting:M(M({},e.lighting),{},{lights:[...e.lighting.lights,M(M({},t),{},{id:Date.now()})]})})),removeLight:t=>e(e=>({lighting:M(M({},e.lighting),{},{lights:e.lighting.lights.filter(e=>e.id!==t)})})),updateLight:(t,n)=>e(e=>({lighting:M(M({},e.lighting),{},{lights:e.lighting.lights.map(e=>e.id===t?M(M({},e),n):e)})})),setLightingPattern:t=>e(e=>({lighting:M(M({},e.lighting),{},{pattern:t})})),setLightingColor:t=>e(e=>({lighting:M(M({},e.lighting),{},{color:t})})),setLightingBrightness:t=>e(e=>({lighting:M(M({},e.lighting),{},{brightness:t})})),generateDefaultLighting:()=>e(e=>({lighting:M(M({},e.lighting),{},{enabled:!0,lights:[{id:Date.now()+1,position:[-15,8,-25],color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12},{id:Date.now()+2,position:[15,8,-25],color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12},{id:Date.now()+3,position:[-10,4,-20],color:"#fffacd",intensity:2,range:15,beamWidth:2,beamLength:10},{id:Date.now()+4,position:[10,4,-20],color:"#fffacd",intensity:2,range:15,beamWidth:2,beamLength:10},{id:Date.now()+5,position:[0,3,-18],color:"#ffffff",intensity:1.8,range:12,beamWidth:1.8,beamLength:8}]})})),roofProducts:[],addRoofProduct:t=>e(e=>({roofProducts:[...e.roofProducts,M(M({},t),{},{id:Date.now()})]})),removeRoofProduct:t=>e(e=>({roofProducts:e.roofProducts.filter(e=>e.id!==t)})),updateRoofProduct:(t,n)=>e(e=>({roofProducts:e.roofProducts.map(e=>e.id===t?M(M({},e),n):e)})),photoCapture:{isCapturing:!1,currentStep:0,requiredPhotos:[{id:1,name:"Front Left Corner",angle:"front-left",captured:!1},{id:2,name:"Front Right Corner",angle:"front-right",captured:!1},{id:3,name:"Left Side Elevation",angle:"left-side",captured:!1},{id:4,name:"Right Side Elevation",angle:"right-side",captured:!1},{id:5,name:"Back Left Corner",angle:"back-left",captured:!1},{id:6,name:"Back Right Corner",angle:"back-right",captured:!1},{id:7,name:"Overhead/Drone View",angle:"overhead",captured:!1},{id:8,name:"Roof Detail Close-up",angle:"detail",captured:!1}],capturedPhotos:[]},startPhotoCapture:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{isCapturing:!0,currentStep:0})})),stopPhotoCapture:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{isCapturing:!1})})),nextCaptureStep:()=>e(e=>({photoCapture:M(M({},e.photoCapture),{},{currentStep:Math.min(e.photoCapture.currentStep+1,7)})})),capturePhoto:t=>e(e=>{const n=[...e.photoCapture.requiredPhotos];return n[e.photoCapture.currentStep].captured=!0,{photoCapture:M(M({},e.photoCapture),{},{requiredPhotos:n,capturedPhotos:[...e.photoCapture.capturedPhotos,t]})}}),ui:{activePanel:"products",showControls:!0,isLoading:!1,uploadProgress:0},setActivePanel:t=>e(e=>({ui:M(M({},e.ui),{},{activePanel:t})})),toggleControls:()=>e(e=>({ui:M(M({},e.ui),{},{showControls:!e.ui.showControls})})),setLoading:t=>e(e=>({ui:M(M({},e.ui),{},{isLoading:t})})),setUploadProgress:t=>e(e=>({ui:M(M({},e.ui),{},{uploadProgress:t})})),scene:{cameraPosition:[0,0,.1],fov:75,controls:{enableZoom:!0,enablePan:!1,enableRotate:!0}},setCameraPosition:t=>e(e=>({scene:M(M({},e.scene),{},{cameraPosition:t})})),setFov:t=>e(e=>({scene:M(M({},e.scene),{},{fov:t})})),measurements:{roofArea:0,perimeter:0,pitch:0,sqFt:0},setMeasurements:t=>e({measurements:t}),export:{format:"png",quality:.95,includeWatermark:!1},setExportFormat:t=>e(e=>({export:M(M({},e.export),{},{format:t})})),setExportQuality:t=>e(e=>({export:M(M({},e.export),{},{quality:t})})),resetAll:()=>e({images:{before:null,after:null,captured:[],panorama:null},viewMode:"before",shingles:{selectedColor:"weathered-wood",appliedRegions:[],opacity:.95},lighting:{enabled:!1,trackColor:"white",lights:[],pattern:"solid",color:"#ffffff",brightness:100},roofProducts:[],ui:{activePanel:"products",showControls:!0,isLoading:!1,uploadProgress:0}})})),mC={"weathered-wood":{name:"Weathered Wood",hex:"#8B7355",baseColor:new dd(9139029),roughness:.85,metalness:0},driftwood:{name:"Driftwood",hex:"#A0907A",baseColor:new dd(10522746),roughness:.82,metalness:0},"storm-gray":{name:"Storm Gray",hex:"#6B6B6B",baseColor:new dd(7039851),roughness:.8,metalness:0},"coal-black":{name:"Coal Black",hex:"#2F2F2F",baseColor:new dd(3092271),roughness:.88,metalness:0},"antique-brown":{name:"Antique Brown",hex:"#8B4513",baseColor:new dd(9127187),roughness:.84,metalness:0},"forest-green":{name:"Forest Green",hex:"#355E3B",baseColor:new dd(3497531),roughness:.83,metalness:0},"brick-red":{name:"Brick Red",hex:"#B22222",baseColor:new dd(11674146),roughness:.86,metalness:0},"slate-blue":{name:"Slate Blue",hex:"#6A5ACD",baseColor:new dd(6970061),roughness:.81,metalness:0}},yC={white:{name:"White",hex:"#FFFFFF",color:new dd(16777215)},black:{name:"Black",hex:"#000000",color:new dd(0)},bronze:{name:"Bronze",hex:"#CD7F32",color:new dd(13467442)},silver:{name:"Silver",hex:"#C0C0C0",color:new dd(12632256)},charcoal:{name:"Charcoal",hex:"#36454F",color:new dd(3556687)},brown:{name:"Brown",hex:"#8B4513",color:new dd(9127187)},beige:{name:"Beige",hex:"#F5F5DC",color:new dd(16119260)},gray:{name:"Gray",hex:"#808080",color:new dd(8421504)}};function vC(e){let{type:t,data:n}=e;if("shingle"===t){const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95;const n=mC[e]||mC["weathered-wood"];return new Yg({color:n.baseColor,roughness:n.roughness,metalness:n.metalness,transparent:t<1,opacity:t,side:Ns})}(n.color,n.opacity);return(0,va.jsxs)("mesh",{position:n.position||[0,20,-50],scale:n.scale||[10,10,1],rotation:n.rotation||[0,0,0],children:[(0,va.jsx)("planeGeometry",{args:[1,1]}),(0,va.jsx)("primitive",{object:e,attach:"material"})]})}return"roof-product"===t?(0,va.jsxs)("mesh",{position:n.position||[0,15,-40],scale:n.scale||[5,5,1],rotation:n.rotation||[0,0,0],children:[(0,va.jsx)("planeGeometry",{args:[1,1]}),(0,va.jsx)("meshStandardMaterial",{color:new dd(8947848),transparent:!0,opacity:.9,side:Ns})]}):null}function bC(e){let{lights:t=[]}=e;return(0,va.jsx)("group",{children:t.map(e=>(0,va.jsxs)("group",{position:e.position||[0,5,-20],children:[(0,va.jsx)("pointLight",{color:e.color||"#ffffff",intensity:e.intensity||2,distance:e.range||15,decay:2}),(0,va.jsxs)("mesh",{children:[(0,va.jsx)("sphereGeometry",{args:[.3,16,16]}),(0,va.jsx)("meshBasicMaterial",{color:e.color||"#ffffff"})]}),(0,va.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,va.jsx)("coneGeometry",{args:[e.beamWidth||2,e.beamLength||10,32,1,!0]}),(0,va.jsx)("meshBasicMaterial",{color:e.color||"#ffffff",transparent:!0,opacity:.15,side:Ns,blending:Ts,depthWrite:!1})]})]},e.id))})}function xC(e){let{imageUrl:t,opacity:n=1}=e;const r=FS(t);return(0,k.useEffect)(()=>{r&&(r.mapping=Co,r.colorSpace=uc)},[r]),(0,va.jsx)(US,{args:[500,60,40],scale:[-1,1,1],children:(0,va.jsx)("meshBasicMaterial",{map:r,side:Es,transparent:n<1,opacity:n})})}function wC(){const{camera:e}=V_(),{images:t,viewMode:n,shingles:r,lighting:i,roofProducts:a}=gC();(0,k.useEffect)(()=>{e.position.set(0,0,.1)},[e]);const s="before"===n||"compare"===n,o="after"===n||"compare"===n,l="compare"===n?.5:1,c="compare"===n?.5:1;return(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)("ambientLight",{intensity:.6}),(0,va.jsx)("directionalLight",{position:[10,10,5],intensity:.8}),s&&t.before&&(0,va.jsx)(xC,{imageUrl:t.before,opacity:l}),o&&t.before&&(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(xC,{imageUrl:t.after||t.before,opacity:c}),r.appliedRegions.map(e=>(0,va.jsx)(vC,{type:"shingle",data:e},e.id)),a.map(e=>(0,va.jsx)(vC,{type:"roof-product",data:e},e.id)),i.enabled&&(0,va.jsx)(bC,{lights:i.lights})]})]})}function _C(e){let{className:t=""}=e;const{images:n}=gC();return(0,va.jsxs)("div",{className:"house-360-viewer w-full h-full relative ".concat(t),children:[(0,va.jsxs)(BS,{gl:{antialias:!0,alpha:!1,preserveDrawingBuffer:!0},dpr:[1,2],children:[(0,va.jsx)(zS,{makeDefault:!0,fov:75,position:[0,0,.1]}),(0,va.jsx)($S,{enableZoom:!0,enablePan:!1,enableDamping:!0,dampingFactor:.05,rotateSpeed:-.5,minDistance:.1,maxDistance:100,minPolarAngle:0,maxPolarAngle:Math.PI}),(0,va.jsx)(k.Suspense,{fallback:(0,va.jsx)(hC,{center:!0,children:(0,va.jsx)("div",{className:"text-white text-lg font-medium bg-gray-900 bg-opacity-75 px-4 py-2 rounded",children:"Loading visualization..."})}),children:n.before?(0,va.jsx)(wC,{}):(0,va.jsx)(hC,{center:!0,children:(0,va.jsxs)("div",{className:"text-center bg-white bg-opacity-90 p-6 rounded-lg shadow-lg max-w-sm",children:[(0,va.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Upload a Photo to Begin"}),(0,va.jsx)("p",{className:"text-sm text-gray-600",children:"Upload a 360\xb0 panorama or standard house photo to start visualizing products"})]})})})]}),n.before&&(0,va.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-60 text-white px-4 py-2 rounded-lg text-sm pointer-events-none",children:"Click & drag to rotate \u2022 Scroll to zoom"})]})}const SC=z("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),CC=z("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),EC=z("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),NC=z("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),kC=z("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),IC=z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);function TC(e){let{file:t,onValidationComplete:n}=e;const[r,i]=(0,k.useState)({isValidating:!0,dimensions:null,quality:null,brightness:null,errors:[],warnings:[]});(0,k.useEffect)(()=>{t&&a(t)},[t]);const a=async e=>{const t=[],r=[];try{const a=await(async e=>new Promise((t,n)=>{if(!e)return void n(new Error("No file provided"));if(!e.type.startsWith("image/"))return void n(new Error("File must be an image"));if(e.size>10485760)return void n(new Error("Image must be less than 10MB"));const r=new Image,i=URL.createObjectURL(e);r.onload=()=>{URL.revokeObjectURL(i),r.width<800||r.height<600?n(new Error("Image must be at least 800x600 pixels")):t({width:r.width,height:r.height,aspectRatio:r.width/r.height,size:e.size,type:e.type})},r.onerror=()=>{URL.revokeObjectURL(i),n(new Error("Failed to load image"))},r.src=i}))(e);a.width<1200&&r.push("Image resolution is low. Higher resolution recommended for better results.");const s=new Image,o=URL.createObjectURL(e);s.onload=async()=>{URL.revokeObjectURL(o);const e=await(async e=>new Promise(t=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=e.width,n.height=e.height,r.drawImage(e,0,0);const i=r.getImageData(0,0,n.width,n.height).data;let a=0;for(let e=0;e<1e3;e++){const e=Math.floor(Math.random()*(n.width-1)),t=4*(Math.floor(Math.random()*(n.height-1))*n.width+e),r=i[t],s=i[t+4];a+=Math.abs(r-s)}const s=a/1e3,o=s<10;t({isBlurry:o,score:s,quality:o?"poor":s>30?"excellent":"good"})}))(s);e.isBlurry&&r.push("Image appears to be slightly blurry. Consider retaking for best results.");const l=await(async e=>new Promise(t=>{const n=document.createElement("canvas"),r=n.getContext("2d");n.width=e.width,n.height=e.height,r.drawImage(e,0,0);const i=r.getImageData(0,0,n.width,n.height).data;let a=0;const s=i.length/4;for(let e=0;e<i.length;e+=4)a+=.299*i[e]+.587*i[e+1]+.114*i[e+2];const o=a/s;t({brightness:o,quality:o<50?"too-dark":o>200?"too-bright":"good",percentage:o/255*100})}))(s);"too-dark"===l.quality?r.push("Image is too dark. Try taking the photo in better lighting."):"too-bright"===l.quality&&r.push("Image is overexposed. Reduce brightness or avoid direct sunlight."),i({isValidating:!1,dimensions:a,quality:e.quality,brightness:l.quality,errors:t,warnings:r}),n({valid:0===t.length,errors:t,warnings:r,imageData:a})},s.onerror=()=>{URL.revokeObjectURL(o),t.push("Failed to load image. File may be corrupted."),i({isValidating:!1,dimensions:null,quality:null,brightness:null,errors:t,warnings:r}),n({valid:!1,errors:t,warnings:r})},s.src=o}catch(SS){t.push(SS.message),i({isValidating:!1,dimensions:null,quality:null,brightness:null,errors:t,warnings:r}),n({valid:!1,errors:t,warnings:r})}};if(r.isValidating)return(0,va.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[(0,va.jsx)(H,{className:"w-5 h-5 text-blue-600 animate-spin"}),(0,va.jsx)("span",{className:"text-sm text-blue-800",children:"Validating image quality..."})]});const s=r.errors.length>0,o=r.warnings.length>0,l=!s;return(0,va.jsxs)("div",{className:"space-y-2",children:[(0,va.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg ".concat(l?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[l?(0,va.jsx)($,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):(0,va.jsx)(ee,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("p",{className:"text-sm font-medium ".concat(l?"text-green-800":"text-red-800"),children:l?"Image looks good!":"Image has quality issues"}),r.dimensions&&(0,va.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[r.dimensions.width," \xd7 ",r.dimensions.height," pixels \u2022"," ",(r.dimensions.size/1024/1024).toFixed(2)," MB \u2022"," ","Quality: ",r.quality]})]})]}),s&&(0,va.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-red-800 mb-2",children:"Errors:"}),(0,va.jsx)("ul",{className:"space-y-1",children:r.errors.map((e,t)=>(0,va.jsxs)("li",{className:"text-xs text-red-700 flex items-start gap-2",children:[(0,va.jsx)("span",{children:"\u2022"}),(0,va.jsx)("span",{children:e})]},t))})]}),o&&(0,va.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,va.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Warnings:"}),(0,va.jsx)("ul",{className:"space-y-1",children:r.warnings.map((e,t)=>(0,va.jsxs)("li",{className:"text-xs text-yellow-700 flex items-start gap-2",children:[(0,va.jsx)("span",{children:"\u2022"}),(0,va.jsx)("span",{children:e})]},t))})]})]})}const BC=z("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),MC=z("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),FC=z("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function RC(e){let{onComplete:t,className:n=""}=e;const[r,i]=(0,k.useState)(!1),[a,s]=(0,k.useState)(0),[o,l]=(0,k.useState)([]),[c,u]=(0,k.useState)(null),[h,d]=(0,k.useState)(null),[A,p]=(0,k.useState)("environment"),f=(0,k.useRef)(null),g=(0,k.useRef)(null),m=(0,k.useRef)(null),{photoCapture:y,addCapturedImage:v}=gC(),b=[{id:1,name:"Front Left Corner",angle:"front-left",instruction:"Stand at the front left corner of the house. Capture the front and left side.",tips:"Include both the front facade and left side wall in frame"},{id:2,name:"Front Right Corner",angle:"front-right",instruction:"Move to the front right corner. Capture the front and right side.",tips:"Overlap slightly with the previous photo"},{id:3,name:"Left Side Elevation",angle:"left-side",instruction:"Position yourself to capture the full left side of the house.",tips:"Keep the camera level and capture the entire roof line"},{id:4,name:"Right Side Elevation",angle:"right-side",instruction:"Move to capture the full right side of the house.",tips:"Maintain consistent distance from previous photos"},{id:5,name:"Back Left Corner",angle:"back-left",instruction:"Position at the back left corner to capture rear and left side.",tips:"Include chimney, vents, and other roof features"},{id:6,name:"Back Right Corner",angle:"back-right",instruction:"Move to the back right corner to complete the perimeter.",tips:"Ensure good overlap with previous photos"},{id:7,name:"Overhead/Drone View",angle:"overhead",instruction:"Capture from elevated position (ladder, drone, or 2nd story window).",tips:"This is crucial for roof detail. Use a drone if available."},{id:8,name:"Roof Detail Close-up",angle:"detail",instruction:"Close-up of roof surface showing shingle texture and condition.",tips:"Focus on shingle detail, valleys, and flashing"}],x=async()=>{try{const e={video:{facingMode:A,width:{ideal:1920},height:{ideal:1080}}},t=await navigator.mediaDevices.getUserMedia(e);m.current=t,f.current&&(f.current.srcObject=t,f.current.play()),i(!0),d(null)}catch(SS){console.error("Camera access error:",SS),d("Unable to access camera. Please grant camera permissions.")}},w=()=>{m.current&&(m.current.getTracks().forEach(e=>e.stop()),m.current=null),f.current&&(f.current.srcObject=null),i(!1)},_=()=>new Promise(e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},()=>e(null),{timeout:5e3}):e(null)}),S=()=>{var e;return null!==(e=window.screen)&&void 0!==e&&e.orientation?window.screen.orientation.type:"unknown"};(0,k.useEffect)(()=>()=>{w(),o.forEach(e=>{null!==e&&void 0!==e&&e.preview&&URL.revokeObjectURL(e.preview)})},[]);const C=o.filter(e=>e).length/b.length*100;return(0,va.jsxs)("div",{className:"camera-integration bg-white rounded-lg shadow-lg ".concat(n),children:[(0,va.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-t-lg",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2",children:[(0,va.jsx)(kC,{className:"w-6 h-6"}),(0,va.jsx)("h3",{className:"text-lg font-bold",children:"8-Photo Capture"})]}),(0,va.jsxs)("div",{className:"text-sm font-medium",children:[o.filter(e=>e).length," / ",b.length]})]}),(0,va.jsx)("div",{className:"w-full bg-blue-800 rounded-full h-2",children:(0,va.jsx)("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:"".concat(C,"%")}})})]}),(0,va.jsxs)("div",{className:"p-4",children:[h&&(0,va.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4",children:(0,va.jsx)("p",{className:"text-sm text-red-800",children:h})}),(0,va.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded p-4 mb-4",children:(0,va.jsxs)("div",{className:"flex items-start gap-3",children:[(0,va.jsx)(BC,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:b[a].name}),(0,va.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:b[a].instruction}),(0,va.jsxs)("p",{className:"text-xs text-blue-700",children:["\ud83d\udca1 ",b[a].tips]})]})]})}),r&&!c&&(0,va.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden mb-4",children:[(0,va.jsx)("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto"}),(0,va.jsxs)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-4",children:[(0,va.jsx)("button",{onClick:()=>{w(),p(e=>"user"===e?"environment":"user"),setTimeout(()=>x(),100)},className:"p-3 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full",title:"Switch Camera",children:(0,va.jsx)(MC,{className:"w-5 h-5 text-gray-800"})}),(0,va.jsx)("button",{onClick:()=>{if(!f.current||!g.current)return;const e=f.current,n=g.current,r=n.getContext("2d");n.width=e.videoWidth,n.height=e.videoHeight,r.drawImage(e,0,0),n.toBlob(async e=>{const n={id:Date.now(),angle:b[a].angle,name:b[a].name,blob:e,preview:URL.createObjectURL(e),timestamp:(new Date).toISOString(),gps:await _(),orientation:S(),file:new File([e],"photo-".concat(a+1,".jpg"),{type:"image/jpeg"})},r=[...o];r[a]=n,l(r),v(n),u(n.preview),setTimeout(()=>{u(null),a<b.length-1?s(a+1):(w(),t&&t(r))},2e3)},"image/jpeg",.95)},className:"p-4 bg-blue-600 hover:bg-blue-700 rounded-full shadow-lg",title:"Capture Photo",children:(0,va.jsx)(kC,{className:"w-8 h-8 text-white"})})]})]}),c&&(0,va.jsxs)("div",{className:"relative mb-4",children:[(0,va.jsx)("img",{src:c,alt:"Preview",className:"w-full h-auto rounded-lg"}),(0,va.jsx)("div",{className:"absolute top-4 right-4",children:(0,va.jsx)("div",{className:"bg-green-500 text-white p-2 rounded-full",children:(0,va.jsx)($,{className:"w-6 h-6"})})}),(0,va.jsx)("button",{onClick:()=>{u(null);const e=[...o];e[a]=null,l(e)},className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-white hover:bg-gray-100 text-gray-800 rounded-lg shadow-lg font-medium",children:"Retake"})]}),!r&&!c&&(0,va.jsxs)("button",{onClick:x,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium flex items-center justify-center gap-2 mb-4",children:[(0,va.jsx)(kC,{className:"w-5 h-5"}),"Start Camera"]}),(0,va.jsx)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:b.map((e,t)=>{const n=o[t],r=t===a;return(0,va.jsxs)("div",{className:"relative aspect-square rounded border-2 ".concat(r?"border-blue-500":n?"border-green-500":"border-gray-300"," cursor-pointer hover:border-blue-400 transition-colors"),onClick:()=>(s(t),void u(null)),children:[n?(0,va.jsx)("img",{src:n.preview,alt:e.name,className:"w-full h-full object-cover rounded"}):(0,va.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,va.jsx)(FC,{className:"w-6 h-6 text-gray-400"})}),n&&(0,va.jsx)("div",{className:"absolute top-1 right-1 bg-green-500 rounded-full p-0.5",children:(0,va.jsx)($,{className:"w-3 h-3 text-white"})}),(0,va.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs px-1 py-0.5 text-center",children:t+1})]},e.id)})}),(0,va.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,va.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Or upload existing photos:"}),(0,va.jsxs)("label",{className:"block w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded border border-gray-300 text-center cursor-pointer",children:[(0,va.jsx)("input",{type:"file",accept:"image/*",onChange:e=>((e,t)=>{const n=e.target.files[0];if(!n)return;const r={id:Date.now(),angle:b[t].angle,name:b[t].name,blob:n,preview:URL.createObjectURL(n),timestamp:(new Date).toISOString(),gps:null,orientation:"unknown",file:n},i=[...o];i[t]=r,l(i),v(r)})(e,a),className:"hidden"}),"Upload Photo ",a+1]})]}),o.filter(e=>e).length===b.length&&(0,va.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,va.jsxs)("button",{onClick:()=>{o.forEach((e,t)=>{if(!e)return;const n=document.createElement("a");n.href=e.preview,n.download="".concat(e.angle,"-").concat(t+1,".jpg"),n.click()})},className:"flex-1 py-2 px-4 bg-gray-600 hover:bg-gray-700 text-white rounded flex items-center justify-center gap-2",children:[(0,va.jsx)(IC,{className:"w-4 h-4"}),"Export All"]}),(0,va.jsx)("button",{onClick:()=>t&&t(o),className:"flex-1 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded font-medium",children:"Process Photos"})]})]}),(0,va.jsx)("canvas",{ref:g,className:"hidden"})]})}const LC=z("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),PC=z("triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]),UC=z("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),DC=z("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function OC(e){let{className:t=""}=e;const[n,r]=(0,k.useState)(null),[i,a]=(0,k.useState)([]),[s,o]=(0,k.useState)(null),[l,c]=(0,k.useState)("feet"),{images:u,setMeasurements:h}=((0,k.useRef)(null),gC()),d=[{id:"distance",name:"Distance",icon:NC,description:"Measure linear distance"},{id:"area",name:"Area",icon:LC,description:"Measure surface area"},{id:"pitch",name:"Roof Pitch",icon:PC,description:"Calculate roof pitch"},{id:"perimeter",name:"Perimeter",icon:UC,description:"Measure perimeter"}],A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;e&&e.value&&(a(t=>[...t,e]),o(null),r(null),p([...i,e]))},p=e=>{const t={roofArea:0,perimeter:0,pitch:0,sqFt:0};e.forEach(e=>{"area"===e.type?(t.roofArea+=e.value,t.sqFt+=e.value):"perimeter"===e.type?t.perimeter+=e.value:"pitch"===e.type&&e.value.degrees&&(t.pitch=Math.max(t.pitch,parseFloat(e.value.degrees)))}),h(t)},f=e=>{const{type:t,value:n,unit:r}=e;if(!n)return"-";switch(t){case"distance":case"perimeter":return"".concat(n.toFixed(2)," ").concat(r);case"area":return"".concat(n.toFixed(2)," sq ").concat(r);case"pitch":return"".concat(n.ratio," (").concat(n.degrees,"\xb0)");default:return n.toString()}};return(0,va.jsxs)("div",{className:"measurement-tools bg-white rounded-lg shadow-lg p-4 ".concat(t),children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2",children:[(0,va.jsx)(W,{className:"w-5 h-5 text-blue-600"}),(0,va.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Measurement Tools"})]}),(0,va.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm",children:[(0,va.jsx)("option",{value:"feet",children:"Feet"}),(0,va.jsx)("option",{value:"meters",children:"Meters"}),(0,va.jsx)("option",{value:"inches",children:"Inches"})]})]}),(0,va.jsx)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:d.map(e=>{const t=e.icon,i=n===e.id;return(0,va.jsxs)("button",{onClick:()=>{return t=e.id,r(t),void o({id:Date.now(),type:t,points:[],value:null,unit:l});var t},className:"flex items-center gap-2 px-3 py-2 rounded border-2 transition-all ".concat(i?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300 text-gray-700"),title:e.description,children:[(0,va.jsx)(t,{className:"w-4 h-4"}),(0,va.jsx)("span",{className:"text-sm font-medium",children:e.name})]},e.id)})}),n&&s&&(0,va.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[(0,va.jsxs)("p",{className:"text-sm text-blue-800 font-medium",children:["distance"===s.type&&"Click two points to measure distance","area"===s.type&&"Click points to define area (double-click to finish)","pitch"===s.type&&"Click base point, then peak point","perimeter"===s.type&&"Click points around perimeter"]}),(0,va.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:["Points: ",s.points.length]}),(0,va.jsxs)("div",{className:"flex gap-2 mt-2",children:[s.points.length>=2&&(0,va.jsx)("button",{onClick:()=>A(),className:"px-3 py-1 bg-blue-600 text-white rounded text-xs font-medium hover:bg-blue-700",children:"Finish"}),(0,va.jsx)("button",{onClick:()=>{o(null),r(null)},className:"px-3 py-1 bg-gray-300 text-gray-700 rounded text-xs font-medium hover:bg-gray-400",children:"Cancel"})]})]}),(0,va.jsxs)("div",{className:"space-y-2 mb-4 max-h-64 overflow-y-auto",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Saved Measurements"}),i.length>0&&(0,va.jsxs)("button",{onClick:()=>{const e=[["Type","Value","Unit","Points"].join(","),...i.map(e=>[e.type,"object"===typeof e.value?JSON.stringify(e.value):e.value,e.unit,e.points.length].join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="measurements-".concat(Date.now(),".csv"),r.click()},className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[(0,va.jsx)(Ra,{className:"w-3 h-3"}),"Export CSV"]})]}),0===i.length?(0,va.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No measurements yet. Select a tool to begin."}):i.map(e=>(0,va.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("div",{className:"text-sm font-medium text-gray-800 capitalize",children:e.type}),(0,va.jsx)("div",{className:"text-sm text-gray-600",children:f(e)})]}),(0,va.jsx)("button",{onClick:()=>(e=>{const t=i.filter(t=>t.id!==e);a(t),p(t)})(e.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete measurement",children:(0,va.jsx)(DC,{className:"w-4 h-4"})})]},e.id))]}),i.length>0&&(0,va.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Summary"}),(0,va.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Total Area:"}),(0,va.jsxs)("span",{className:"ml-2 font-semibold text-gray-800",children:[i.filter(e=>"area"===e.type).reduce((e,t)=>e+t.value,0).toFixed(2)," sq ",l]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Max Pitch:"}),(0,va.jsxs)("span",{className:"ml-2 font-semibold text-gray-800",children:[i.filter(e=>"pitch"===e.type).reduce((e,t)=>Math.max(e,parseFloat(t.value.degrees)||0),0).toFixed(1),"\xb0"]})]})]})]}),(0,va.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[(0,va.jsx)("button",{className:"w-full px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded border border-blue-200",children:"Set Scale / Calibrate"}),(0,va.jsx)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Click to set a known distance for accurate measurements"})]})]})}class jC{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class zC{refCount(e){return HC("refCount")}incRef(e){return HC("incRef")}timerAvailable(){return!0}time(e){return HC("time")}read(e){return HC("read")}readSync(e){return HC("readSync")}readToGPU(e,t){return HC("readToGPU")}numDataIds(){return HC("numDataIds")}disposeData(e,t){return HC("disposeData")}write(e,t,n){return HC("write")}move(e,t,n,r,i){return HC("move")}createTensorFromGPUData(e,t,n){return HC("createTensorFromGPUData")}memory(){return HC("memory")}floatPrecision(){return HC("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return HC("dispose")}}function HC(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function QC(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,WC(e,t,n)}function VC(e,t,n){return Math.max(e,Math.min(t,n))}function GC(e){return e%2===0?e:e+1}function WC(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function qC(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function KC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";qC(JC(e,t),()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}function XC(e){qC(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function YC(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function JC(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ZC(e){return e%1===0}function $C(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function eE(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function tE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((i,a)=>{let s=0;const o=()=>{if(e())return void i();s++;const l=t(s);null!=n&&s>=n?a():null!=r?r(o,l):setTimeout(o,l)};o()})}function nE(e,t){let n=1,r=-1;for(let a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const i=e.slice();return i[r]=t/n,i}function rE(e,t){const n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),qC(e.every(e=>e>=-n&&e<n),()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)),qC(e.every(e=>ZC(e)),()=>"All values in axis param must be integers but "+"got axis ".concat(e)),e.map(e=>e<0?n+e:e)}function iE(e,t){const n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:rE(t,e).sort();let s=0;for(let o=0;o<e.length;++o){if(null!=a){if(a[s]===o&&1!==e[o])throw new Error("Can't squeeze axis ".concat(o," since its dim '").concat(e[o],"' is not 1"));(null==a[s]||a[s]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),a[s]<=o&&s++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function aE(e,t){return sE(e,t)}function sE(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function oE(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function lE(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function cE(e){return"string"===typeof e||e instanceof String}function uE(e){return"number"===typeof e}function hE(e){return Array.isArray(e)?hE(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":uE(e)?"float32":cE(e)?"string":"boolean"===typeof e?"bool":"float32"}function dE(e){return!!(e&&e.constructor&&e.call&&e.apply)}function AE(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function pE(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function fE(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new Array;if(1===t.length){const a=t[0]*(r?2:1);for(let t=0;t<a;t++)i[t]=n[e+t]}else{const a=t[0],s=t.slice(1),o=s.reduce((e,t)=>e*t)*(r?2:1);for(let t=0;t<a;t++)i[t]=fE(e+t*o,s,n,r)}return i}function gE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];const r=e.reduce((e,t)=>e*t)*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return fE(0,e,t,n)}function mE(e,t){const n=yE(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function yE(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function vE(e,t){const n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return gE(e,new Float32Array(n));if("int32"===t)return gE(e,new Int32Array(n));if("bool"===t)return gE(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function bE(e){e.forEach(t=>{qC(Number.isInteger(t)&&t>=0,()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"]."))})}function xE(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function wE(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function _E(e){return e&&e.then&&"function"===typeof e.then}const SE="tfjsflags";class CE{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=EE,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(NE().getBool("IS_TEST")||NE().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];NE().getBool("IS_TEST")||NE().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(_E(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);if(SE in e){e[SE].split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){const n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,n)})}}}function EE(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")}),t}function NE(){return IE}let kE,IE=null;function TE(){if(null==kE){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}kE=e}return kE}function BE(e,t){const n=function(){const e=TE();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const ME="Abs",FE="Acos",RE="Acosh",LE="Add",PE="AddN",UE="All",DE="Any",OE="ArgMax",jE="ArgMin",zE="Asin",HE="Asinh",QE="Atan",VE="Atanh",GE="Atan2",WE="AvgPool",qE="AvgPoolGrad",KE="AvgPool3D",XE="AvgPool3DGrad",YE="BatchMatMul",JE="BatchToSpaceND",ZE="Bincount",$E="BitwiseAnd",eN="BroadcastArgs",tN="Cast",nN="Ceil",rN="ClipByValue",iN="Complex",aN="ComplexAbs",sN="Concat",oN="Conv2D",lN="Conv2DBackpropFilter",cN="Conv2DBackpropInput",uN="Conv3D",hN="Conv3DBackpropFilterV2",dN="Conv3DBackpropInputV2",AN="Cos",pN="Cosh",fN="Cumprod",gN="Cumsum",mN="CropAndResize",yN="DenseBincount",vN="DepthToSpace",bN="DepthwiseConv2dNative",xN="DepthwiseConv2dNativeBackpropFilter",wN="DepthwiseConv2dNativeBackpropInput",_N="Diag",SN="Dilation2D",CN="Dilation2DBackpropInput",EN="Dilation2DBackpropFilter",NN="Draw",kN="RealDiv",IN="Einsum",TN="Elu",BN="EluGrad",MN="Erf",FN="Equal",RN="Exp",LN="ExpandDims",PN="Expm1",UN="FFT",DN="Fill",ON="FlipLeftRight",jN="Floor",zN="FloorDiv",HN="FusedBatchNorm",QN="GatherV2",VN="GatherNd",GN="Greater",WN="GreaterEqual",qN="Identity",KN="IFFT",XN="Imag",YN="IsFinite",JN="IsInf",ZN="IsNan",$N="LeakyRelu",ek="Less",tk="LessEqual",nk="LinSpace",rk="Log",ik="Log1p",ak="LogicalAnd",sk="LogicalNot",ok="LogicalOr",lk="LRN",ck="LRNGrad",uk="Max",hk="Maximum",dk="MaxPool",Ak="MaxPoolGrad",pk="MaxPool3D",fk="MaxPool3DGrad",gk="MaxPoolWithArgmax",mk="Mean",yk="Min",vk="Minimum",bk="MirrorPad",xk="Mod",wk="Multinomial",_k="Multiply",Sk="Neg",Ck="NotEqual",Ek="NonMaxSuppressionV3",Nk="NonMaxSuppressionV4",kk="NonMaxSuppressionV5",Ik="OnesLike",Tk="OneHot",Bk="Pack",Mk="PadV2",Fk="Pow",Rk="Prelu",Lk="Prod",Pk="RaggedGather",Uk="RaggedRange",Dk="RaggedTensorToTensor",Ok="Range",jk="Real",zk="Reciprocal",Hk="Relu",Qk="Reshape",Vk="ResizeNearestNeighbor",Gk="ResizeNearestNeighborGrad",Wk="ResizeBilinear",qk="ResizeBilinearGrad",Kk="Relu6",Xk="Reverse",Yk="Round",Jk="Rsqrt",Zk="ScatterNd",$k="TensorScatterUpdate",eI="SearchSorted",tI="Select",nI="Selu",rI="Slice",iI="Sin",aI="Sinh",sI="Sign",oI="Sigmoid",lI="Softplus",cI="Sqrt",uI="Sum",hI="SpaceToBatchND",dI="SplitV",AI="Softmax",pI="SparseFillEmptyRows",fI="SparseReshape",gI="SparseSegmentMean",mI="SparseSegmentSum",yI="SparseToDense",vI="SquaredDifference",bI="Square",xI="StaticRegexReplace",wI="StridedSlice",_I="StringNGrams",SI="StringSplit",CI="StringToHashBucketFast",EI="Sub",NI="Tan",kI="Tanh",II="Tile",TI="TopK",BI="Transform",MI="Transpose",FI="Unique",RI="Unpack",LI="UnsortedSegmentSum",PI="ZerosLike",UI="Step",DI="FromPixels",OI="RotateWithOffset",jI="_FusedMatMul",zI="FusedConv2D",HI="FusedDepthwiseConv2D";function QI(){NE().getBool("IS_TEST")||NE().getBool("PROD")||console.warn(...arguments)}function VI(){NE().getBool("IS_TEST")||NE().getBool("PROD")||console.log(...arguments)}const GI=BE("kernelRegistry",()=>new Map),WI=BE("gradRegistry",()=>new Map);function qI(e,t){const n=ZI(e,t);return GI.get(n)}function KI(e){return WI.get(e)}function XI(e){const t=GI.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[a,s]=i,[o]=a.split("_");o===e&&n.push(s)}return n}function YI(e){const{kernelName:t,backendName:n}=e,r=ZI(t,n);GI.has(r)&&QI("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),GI.set(r,e)}function JI(e){const{kernelName:t}=e;WI.has(t)&&NE().getBool("DEBUG")&&QI("Overriding the gradient for '".concat(t,"'")),WI.set(t,e)}function ZI(e,t){return"".concat(t,"_").concat(e)}function $I(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var eT=n(8818);const tT=n.n(eT)()||eT;function nT(e){return tT.fromString(e,!0,16)}const rT=nT("c3a5c85c97cb3127"),iT=nT("b492b66fbe98f273"),aT=nT("9ae16a3b2f90404f");function sT(e){return e.xor(e.shru(47))}function oT(e,t,n){const r=e.slice(t,t+n);return tT.fromBytes(Array.from(r),!0,!0)}function lT(e,t){return oT(e,t,8)}function cT(e,t){return oT(e,t,4)}function uT(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function hT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nT("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function dT(e,t,n,r){return function(e,t,n,r,i,a){i=i.add(e),a=uT(a.add(i).add(r),21);const s=i;return i=(i=i.add(t)).add(n),a=a.add(uT(i,44)),[i.add(r),a.add(s)]}(lT(e,t),lT(e,t+8),lT(e,t+16),lT(e,t+24),n,r)}function AT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=tT.fromNumber(81,!0);if(t<=32)return t<=16?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){const n=aT.add(2*t),r=lT(e,0).add(aT),i=lT(e,t-8);return hT(uT(i,37).mul(n).add(r),uT(r,25).add(i).mul(n),n)}if(t>=4){const n=aT.add(2*t);return hT(cT(e,0).shl(3).add(t),cT(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return sT(aT.mul(n).xor(rT.mul(r))).mul(aT)}return aT}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=aT.add(2*t),r=lT(e,0).mul(iT),i=lT(e,8),a=lT(e,t-8).mul(n),s=lT(e,t-16).mul(aT);return hT(uT(r.add(i),43).add(uT(a,30)).add(s),r.add(uT(i.add(aT),18)).add(a),n)}(e,t);if(t<=64)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;const n=aT.add(2*t),r=lT(e,0).mul(aT),i=lT(e,8),a=lT(e,t-8).mul(n),s=lT(e,t-16).mul(aT),o=uT(r.add(i),43).add(uT(a,30)).add(s),l=hT(o,r.add(uT(i.add(aT),18)).add(a),n),c=lT(e,16).mul(n),u=lT(e,24),h=o.add(lT(e,t-32)).mul(n),d=l.add(lT(e,t-24)).mul(n);return hT(uT(c.add(u),43).add(uT(h,30)).add(d),c.add(uT(u.add(r),18)).add(h),n)}(e,t);let r=n,i=n.mul(iT).add(113),a=sT(i.mul(aT).add(113)).mul(aT),s=[tT.UZERO,tT.UZERO],o=[tT.UZERO,tT.UZERO];r=r.mul(aT).add(lT(e,0));let l=0;const c=64*(t-1>>6),u=c+(t-1&63)-63;do{r=uT(r.add(i).add(s[0]).add(lT(e,l+8)),37).mul(iT),i=uT(i.add(s[1]).add(lT(e,l+48)),42).mul(iT),r=r.xor(o[1]),i=i.add(s[0]).add(lT(e,l+40)),a=uT(a.add(o[0]),33).mul(iT),s=dT(e,l,s[1].mul(iT),r.add(o[0])),o=dT(e,l+32,a.add(o[1]),i.add(lT(e,l+16))),[a,r]=[r,a],l+=64}while(l!==c);const h=iT.add(a.and(255).shl(1));return l=u,o[0]=o[0].add(t-1&63),s[0]=s[0].add(o[0]),o[0]=o[0].add(s[0]),r=uT(r.add(i).add(s[0]).add(lT(e,l+8)),37).mul(h),i=uT(i.add(s[1]).add(lT(e,l+48)),42).mul(h),r=r.xor(o[1].mul(9)),i=i.add(s[0].mul(9).add(lT(e,l+40))),a=uT(a.add(o[0]),33).mul(h),s=dT(e,l,s[1].mul(h),r.add(o[0])),o=dT(e,l+32,a.add(o[1]),i.add(lT(e,l+16))),[a,r]=[r,a],hT(hT(s[0],o[0],h).add(sT(i).mul(rT)).add(a),hT(s[1],o[1],h).add(r),h)}function pT(e,t){return"string"===t?mT(e):fT([e],t)}function fT(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=bT(e)),NE().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function gT(){return NE().platform.now()}function mT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",NE().platform.encode(e,t)}function yT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",NE().platform.decode(e,t)}function vT(e){return null!=NE().platform.isTypedArray?NE().platform.isTypedArray(e):$I(e)}function bT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||_E(e)||null==e||vT(e)&&n)t.push(e);else if(Array.isArray(e)||vT(e))for(let r=0;r<e.length;++r)bT(e[r],t,n);else{let r=-1;for(const t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let i=0;i<=r;i++)bT(e[i],t,n)}return t}class xT{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new _T)}profileKernel(e,t,n){let r;const i=()=>{r=n()};let a;const s=gT();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();for(const e of r)e.dataSync();a=Promise.resolve({kernelMs:gT()-s})}if(NE().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let o=0;o<r.length;o++){const t=r[o];t.data().then(n=>{wT(n,t.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(e=>e.kernelMs),extraInfo:a.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:i,extraInfo:a}=e;n.forEach(e=>{Promise.all([e.data(),r,a]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],i,n[2])})})}}function wT(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class _T{logKernelProfile(e,t,n,r,i,a){const s="number"===typeof r?eE("".concat(r,"ms"),9):r.error,o=eE(e,25),l=t.rank,c=t.size,u=eE(t.shape.toString(),14);let h="";for(const d in i){const e=i[d];if(null!=e){const n=e.shape||t.shape,r=n.length;h+="".concat(d,": ").concat(r,"D ").concat(r>0?n:""," ")}}console.log("%c".concat(o,"\t%c").concat(s,"\t%c").concat(l,"D ").concat(u,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(a),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function ST(e,t,n,r){const i=pE(t),a=function(e,t,n,r){const i=YC(t),a=r[r.length-1],s=new Array(a).fill(0),o=t.length,l="complex64"===n?kT(e):e;if(o>1)for(let c=0;c<i/a;c++){const e=c*a;for(let t=0;t<a;t++)s[t]=Math.max(s[t],CT(l[e+t],0,n).length)}return s}(e,t,n,i),s=t.length,o=NT(e,t,n,i,a),l=["Tensor"];return r&&(l.push("  dtype: ".concat(n)),l.push("  rank: ".concat(s)),l.push("  shape: [".concat(t,"]")),l.push("  values:")),l.push(o.map(e=>"    "+e).join("\n")),l.join("\n")}function CT(e,t,n){let r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):cE(e)?"'".concat(e,"'"):"bool"===n?ET(e):parseFloat(e.toFixed(7)).toString(),eE(r,t)}function ET(e){return 0===e?"false":"true"}function NT(e,t,n,r,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s="complex64"===n?2:1,o=t[0],l=t.length;if(0===l){if("complex64"===n){return[CT(kT(e)[0],0,n)]}return"bool"===n?[ET(e[0])]:[e[0].toString()]}if(1===l){if(o>20){const t=3*s;let r=Array.from(e.slice(0,t)),a=Array.from(e.slice((o-3)*s,o*s));return"complex64"===n&&(r=kT(r),a=kT(a)),["["+r.map((e,t)=>CT(e,i[t],n)).join(", ")+", ..., "+a.map((e,t)=>CT(e,i[o-3+t],n)).join(", ")+"]"]}return["["+("complex64"===n?kT(e):Array.from(e)).map((e,t)=>CT(e,i[t],n)).join(", ")+"]"]}const c=t.slice(1),u=r.slice(1),h=r[0]*s,d=[];if(o>20){for(let t=0;t<3;t++){const r=t*h,a=r+h;d.push(...NT(e.slice(r,a),c,n,u,i,!1))}d.push("...");for(let t=o-3;t<o;t++){const r=t*h,a=r+h;d.push(...NT(e.slice(r,a),c,n,u,i,t===o-1))}}else for(let f=0;f<o;f++){const t=f*h,r=t+h;d.push(...NT(e.slice(t,r),c,n,u,i,f===o-1))}const A=2===l?",":"";d[0]="["+(o>0?d[0]+A:"");for(let f=1;f<d.length-1;f++)d[f]=" "+d[f]+A;let p=",\n";for(let f=2;f<l;f++)p+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(a?"":p),d}function kT(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class IT{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=YC(e),null!=n){const e=n.length;qC(e===this.size,()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'."))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||sE(t,this.size),this.strides=pE(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),qC(n.length===this.rank,()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")"));const i=this.locToIndex(n);this.values[i]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let r=0;for(const a of t){if(a<0||a>=this.shape[r]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}r++}let i=t[t.length-1];for(let a=0;a<t.length-1;++a)i+=this.strides[a]*t[a];return this.values[i]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return TT().makeTensor(this.values,this.shape,this.dtype)}}let TT=null,BT=null,MT=null;class FT{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=YC(e),this.strides=pE(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return BT.buffer(this.shape,this.dtype,e)}bufferSync(){return BT.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return gE(this.shape,e,"complex64"===this.dtype)}arraySync(){return gE(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=TT().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map(e=>yT(e))}catch(dS){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),TT().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=TT().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>yT(e))}catch(dS){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await TT().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),TT().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return BT.print(this,e)}clone(){return this.throwIfDisposed(),BT.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ST(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),BT.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),TT().makeVariable(this,e,t,n)}}function RT(){return BE("Tensor",()=>FT)}Object.defineProperty(FT,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),RT();class LT extends FT{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!JC(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));TT().disposeTensor(this),this.dataId=e.dataId,TT().incRef(this,null)}dispose(){TT().disposeVariable(this),this.isDisposedInternal=!0}}var PT,UT,DT,OT,jT;Object.defineProperty(LT,Symbol.hasInstance,{value:e=>e instanceof FT&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(PT||(PT={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(UT||(UT={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(DT||(DT={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(OT||(OT={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(jT||(jT={}));const zT={float32:OT,int32:UT,bool:DT,complex64:jT};function HT(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return zT[e][t]}function QT(e){return HT(e,"int32")}function VT(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function GT(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function WT(e,t){if(e.dtype===t.dtype)return[e,t];const n=HT(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function qT(e,t){return t.some(t=>t.id===e.id)}function KT(e){const t=[];return XT(e,t,new Set),t}function XT(e,t,n){if(null==e)return;if(e instanceof FT)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!==typeof r)return;var r;const i=e;for(const a in i){const e=i[a];n.has(e)||(n.add(e),XT(e,t,n))}}function YT(e){return null!=e.kernelName}class JT{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ZT{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new JT}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(QI("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new xT(this.backendInstance),!0}setupRegisteredKernels(){XI(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){XI(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof zC||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,QI("Initialization of backend ".concat(e," failed")),QI(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return QI("Initialization of backend ".concat(e," failed")),QI(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t),a=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return ZT.nextTensorId++}nextVariableId(){return ZT.nextVariableId++}clone(e){const t=eB.runKernel(qN,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return eB.runKernel(tN,t,n)}}),[],{}),t}runKernel(e,t,n){null==this.backendName&&this.backend;if(!(null!=qI(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let i=0;n.forEach(e=>{i+="complex64"===e.dtype?3:1});const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-i-a;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;let s,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=YT(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(YT(e)){const{kernelName:t,inputs:i,attrs:a}=e;null==this.backendName&&this.backend;const l=qI(t,this.backendName);qC(null!=l,()=>"Cannot find registered kernel '".concat(t,"' for backend '").concat(this.backendName,"'")),s=()=>{const e=this.backend.numDataIds();o=l.kernelFunc({inputs:i,attrs:a,backend:this.backend});const s=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,s);const c=s.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(r){const e=this.getTensorsForGradient(t,i,c);n=this.saveTensorsForBackwardMode(e)}return c}}else{const{forwardFunc:t}=e,i=e=>{r&&(n=e.map(e=>this.keep(this.clone(e))))};s=()=>{const e=this.backend.numDataIds();o=this.tidy(()=>t(this.backend,i));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:c,attrs:u}=e,h=YT(e)?null:e.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,c,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs):t=s()}),r&&this.addTapeNode(l,c,t,h,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(e=>null!=c[e]?c[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(o)?t:t[0]}saveTensorsForBackwardMode(e){const t=e.map(e=>this.keep(this.clone(e)));return t}getTensorsForGradient(e,t,n){const r=KI(e);if(null!=r){const e=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(qC(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(e=>t[e])):a=e.map(e=>t[e]);const s=n.filter((e,t)=>i[t]);return a.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=e;"string"===n&&cE(e[0])&&(i=e.map(e=>mT(e)));const a=r.write(i,t,n),s=new FT(t,n,a,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){const e=this.state.tensorInfo.get(a),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(i);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){const i={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:n,shape:r,dtype:i}=e,a=new FT(r,i,n,this.nextTensorId());return this.trackTensor(a,t),a}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const i=new LT(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*lE(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof LT||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*lE(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,i,a){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},o=KI(e);null!=o&&(r=o.gradFunc),null!=r&&(s.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=yE(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],i,a))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=KT(e),n=new Set(t.map(e=>e.id));for(let i=0;i<this.state.activeScope.track.length;i++){const e=this.state.activeScope.track[i];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(qC(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));qC(i instanceof FT,()=>"The result y returned by f() must be a tensor.");const a=function(e,t,n){const r={},i={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<e.length;l++){const n=e[l],a=n.inputs;for(const e in a){const s=a[e];let o=!1;for(let e=0;e<t.length;e++)if(r[s.id]){n.outputs.forEach(e=>r[e.id]=!0),o=!0,i[n.id]=!0;break}if(o)break}}const a={};a[n.id]=!0;const s={};for(let l=e.length-1;l>=0;l--){const t=e[l],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(a[t.outputs[e].id]){for(const e in n)a[n[e].id]=!0,s[t.id]=!0;break}}const o=[];for(let l=0;l<e.length;l++){const t=e[l];if(i[t.id]&&s[t.id]){const e={};for(const i in t.inputs){const n=t.inputs[i];r[n.id]&&(e[i]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,o.push(n)}}return o}(this.state.activeTape,t,i);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[i.id]=null==n?function(e){const t=mE(YC(e),"float32");return eB.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(let i=t.length-1;i>=0;i--){const a=t[i],s=[];if(a.outputs.forEach(t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)}),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));const o=a.gradient(s);for(const t in a.inputs){if(!(t in o))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(o),"."));const i=n(()=>o[t]());if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));const s=a.inputs[t];if(!JC(i.shape,s.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(i.shape,"', which does not match ")+"the shape of the input '".concat(s.shape,"'"));if(null==e[s.id])e[s.id]=i;else{const t=e[s.id];e[s.id]=r(t,i),t.dispose()}}}}(e,a,e=>this.tidy(e),tB);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:i,grads:r}})}customGrad(e){var t=this;return qC(dE(e),()=>"The f passed in customGrad(f) must be a function."),function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];let a;qC(r.every(e=>e instanceof FT),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const s={};r.forEach((e,t)=>{s[t]=e});return t.runKernelFunc({forwardFunc:(t,n)=>(a=e(...r,n),qC(a.value instanceof FT,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),qC(dE(a.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),a.value),backwardsFunc:(e,t)=>{const n=a.gradFunc(e,t),i=Array.isArray(n)?n:[n];qC(i.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),qC(i.every(e=>e instanceof FT),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const s={};return i.forEach((e,t)=>{s[t]=()=>e}),s},inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=gT(),n=await this.backend.time(e);return n.wallMs=gT()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new JT;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function $T(){const e=TE();if(null==e._tfengine){const t=new CE(e);e._tfengine=new ZT(t)}var t;return t=e._tfengine.ENV,IE=t,TT=()=>e._tfengine,e._tfengine}ZT.nextTensorId=0,ZT.nextVariableId=0;const eB=$T();function tB(e,t){const n={a:e,b:t};return eB.runKernel(LE,n)}let nB;function rB(e){if(void 0!==nB)return nB;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function iB(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}const aB=NE();function sB(e,t){let n=e;if(vT(e))return"string"===t?[]:[e.length];if(VT(e)){const t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(GT(e))return[e.buffer.size/(null==t?4:lE(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||vT(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&NE().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&oB(e,r,[]),r}function oB(e,t,n){if(n=n||[],!Array.isArray(e)&&!vT(e))return void qC(0===t.length,()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements"));qC(t.length>0,()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")),qC(e.length===t[0],()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements"));const r=t.slice(1);for(let i=0;i<e.length;++i)oB(e[i],r,n.concat(i))}function lB(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function cB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof RT())return lB(r,e.dtype,t,n),e;let i=hE(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),lB(r,i,t,n),null==e||!vT(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const r=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(r,"'"))}const a=sB(e,i);vT(e)||Array.isArray(e)||(e=[e]);const s="string"!==i?fT(e,i):bT(e,[],!0);return eB.makeTensor(s,a,i)}function uB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((e,i)=>cB(e,"".concat(t,"[").concat(i,"]"),n,r))}aB.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),aB.registerFlag("IS_BROWSER",()=>iB()),aB.registerFlag("IS_NODE",()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node),aB.registerFlag("IS_CHROME",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),aB.registerFlag("IS_SAFARI",()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),aB.registerFlag("PROD",()=>!1),aB.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>aB.getBool("DEBUG")),aB.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),aB.registerFlag("IS_TEST",()=>!1),aB.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>aB.getBool("DEBUG")),aB.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),aB.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),aB.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);const hB="__op";function dB(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=hB;const i=function(){eB.startScope(n);try{const e=r(...arguments);return _E(e)&&console.error("Cannot return a Promise inside of tidy."),eB.endScope(e),e}catch(e){throw eB.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}const AB=dB({complex_:function(e,t){const n=cB(e,"real","complex"),r=cB(t,"imag","complex");KC(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");const i={real:n,imag:r};return eB.runKernel(iN,i)}});function pB(e,t,n,r){if(null==r)r=hE(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(GT(e)||VT(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return eB.backend.createTensorFromGPUData(e,t||n,r)}if(!vT(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){bE(t);const e=YC(t),r=YC(n);qC(e===r,()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(r));for(let i=0;i<n.length;++i){const e=n[i],r=i!==n.length-1||e!==YC(t.slice(i));qC(n[i]===t[i]||!r,()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). "))}}return vT(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?fT(e,r):bT(e,[],!0),eB.makeTensor(e,t,r)}function fB(e,t,n){return pB(e,t,sB(e,n),n)}const gB={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class mB{static join(e){return new mB(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e)return;if(e instanceof Array||(e=[e]),0===(e=e.map(e=>vT(e)?e.buffer:e)).length)return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));const r=new ArrayBuffer(t-e),i=new Uint8Array(r);let a=0;for(let s=n;s<this.shards.length;s++){const n=this.shards[s],r=e+a-n.start,o=a,l=Math.min(t,n.end)-n.start,c=new Uint8Array(n.buffer,r,l-r);if(i.set(c,o),a+=c.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(e,t){let n=0,r=e.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,a=t(e[i]);if(0===a)return i;a<0?r=i:n=i+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function yB(){return eB}function vB(){return eB.memory()}function bB(e,t){return eB.tidy(e,t)}function xB(e){KT(e).forEach(e=>e.dispose())}function wB(e){return eB.keep(e)}function _B(){return eB.backendName}function SB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return eB.registerBackend(e,t,n)}function CB(){return eB.backend}MT=function(e){NE().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")};const EB=4;async function NB(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let a=0;a<i.length;++a){const s=i[a],o=Array.isArray(e)?e[a].tensor:e[s];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(o.dtype));const l={name:s,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise(async e=>{const t=await o.bytes(),n=t.reduce((e,t)=>e+t.length,0)+EB*t.length,r=new Uint8Array(n);let i=0;for(let a=0;a<t.length;a++){const e=t[a],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,i),i+=EB,r.set(e,i),i+=e.length}e(r)});r.push(e)}else r.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:RB(await Promise.all(r)),specs:n}}function kB(e,t){const n=new mB(e),r={};let i=0;for(const a of t){const e=IB(a,(e,t)=>n.slice(i+e,i+t));r[a.name]=BB(a,n.slice(i,i+e)),i+=e}return r}function IB(e,t){const n=YC(e.shape);let r;if("quantization"in e){const t=e.quantization;r=gB[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=EB+new Uint32Array(t(e,e+EB))[0];return e}r=gB[e.dtype]}return n*r}async function TB(e,t){const n=YC(e.shape);let r;if("quantization"in e){const t=e.quantization;r=gB[t.dtype]}else{if("string"===e.dtype){let e=0;for(let r=0;r<n;r++)e+=EB+new Uint32Array(await t(e,e+EB))[0];return e}r=gB[e.dtype]}return n*r}function BB(e,t){const n=e.name,r=e.dtype,i=e.shape,a=YC(i);let s,o=0;if("quantization"in e){const i=e.quantization;if("uint8"===i.dtype||"uint16"===i.dtype){if(!("min"in i)||!("scale"in i))throw new Error("Weight ".concat(e.name," with quantization ").concat(i.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==i.dtype)throw new Error("Weight ".concat(e.name," has unknown ")+"quantization dtype ".concat(i.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==r)throw new Error("Weight ".concat(e.name," is quantized with ").concat(i.dtype," ")+"which only supports weights of type float32 not ".concat(r,"."))}const l=gB[i.dtype],c="uint8"===i.dtype?new Uint8Array(t):new Uint16Array(t);if("float32"===r)if("uint8"===i.dtype||"uint16"===i.dtype){s=new Float32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];s[e]=t*i.scale+i.min}}else{if("float16"!==i.dtype)throw new Error("Unsupported quantization type ".concat(i.dtype," ")+"for weight type float32.");{const e=function(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0===(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const i=new ArrayBuffer(4*r.length),a=new Uint32Array(i);for(let s=0;s<r.length;s++){const i=r[s],o=e[n[i>>10]+(1023&i)]+t[i>>10];a[s]=o}return new Float32Array(i)}}();s=e(c)}}else{if("int32"!==r)throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(r));if("uint8"!==i.dtype&&"uint16"!==i.dtype)throw new Error("Unsupported quantization type ".concat(i.dtype," ")+"for weight type int32.");s=new Int32Array(c.length);for(let e=0;e<c.length;e++){const t=c[e];s[e]=Math.round(t*i.scale+i.min)}}o+=a*l}else if("string"===r){const n=YC(e.shape);s=[];for(let e=0;e<n;e++){const e=new Uint32Array(t.slice(o,o+EB))[0];o+=EB;const n=new Uint8Array(t.slice(o,o+e));s.push(n),o+=e}}else{const e=gB[r];if("float32"===r)s=new Float32Array(t);else if("int32"===r)s=new Int32Array(t);else{if("bool"!==r){if("complex64"===r){s=new Float32Array(t);const e=new Float32Array(s.length/2),n=new Float32Array(s.length/2);for(let t=0;t<e.length;t++)e[t]=s[2*t],n[t]=s[2*t+1];const r=fB(e,i,"float32"),a=fB(n,i,"float32"),o=AB(r,a);return r.dispose(),a.dispose(),o}throw new Error("Unsupported dtype in weight '".concat(n,"': ").concat(r))}s=new Uint8Array(t)}o+=a*e}return fB(s,i,r)}async function MB(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){const{done:t,value:i}=await e.read();if(t&&null==i){const e=n-r.byteLength;throw new Error("Reader is done but ".concat(e," bytes are still expected"))}const a=new Uint8Array(r.length+i.byteLength);a.set(r,0),a.set(new Uint8Array(i),r.length),r=a}return r.buffer}async function FB(e,t){const n={},r=e.getReader();let i=new ArrayBuffer(0);for(const a of t){const e=await TB(a,async(e,t)=>(i=await MB(r,i,t),i.slice(e,t)));i=await MB(r,i,e);const t=i.slice(0,e);i=i.slice(e);const s=BB(a,t);if(n[a.name]=s,"webgpu"===_B()){const e=CB();"uploadToGPU"in e&&YC(s.shape)>=NE().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&e.uploadToGPU(s.dataId)}}return n}function RB(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))});const r=new Uint8Array(t);let i=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),i),i+=e.byteLength}),r.buffer}const LB="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function PB(e){return LB?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function UB(e){return mB.join(e)}function DB(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function OB(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function jB(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function zB(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),jB(e,n,r)}function HB(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:PB(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:PB(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new mB(e.weightData).byteLength}}function QB(e){const t=[];for(const n of e)t.push(...n.weights);return t}class VB{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==VB.instance&&(VB.instance=new VB),VB.instance}static registerSaveRouter(e){VB.getInstance().saveRouters.push(e)}static registerLoadRouter(e){VB.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return VB.getHandlers(e,"save")}static getLoadHandlers(e,t){return VB.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?VB.getInstance().loadRouters:VB.getInstance().saveRouters).forEach(t=>{const i=t(e,n);null!==i&&r.push(i)}),r}}const GB=e=>VB.registerSaveRouter(e),WB=e=>VB.registerLoadRouter(e),qB=e=>VB.getSaveHandlers(e),KB=(e,t)=>VB.getLoadHandlers(e,t),XB="tensorflowjs",YB="models_store",JB="model_info_store";function ZB(){if(!NE().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function $B(e){const t=e.result;t.createObjectStore(YB,{keyPath:"modelPath"}),t.createObjectStore(JB,{keyPath:"modelPath"})}class eM{constructor(e){if(this.indexedDB=ZB(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{const r=this.indexedDB.open(XB,1);r.onupgradeneeded=()=>$B(r),r.onsuccess=()=>{const i=r.result;if(null==t){const t=i.transaction(YB,"readonly"),r=t.objectStore(YB).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{t.weightData=mB.join(t.weightData);const r=HB(t),a=i.transaction(JB,"readwrite");let s,o,l=a.objectStore(JB);try{s=l.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(SS){return n(SS)}s.onsuccess=()=>{o=i.transaction(YB,"readwrite");const s=o.objectStore(YB);let c;try{c=s.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r})}catch(SS){return n(SS)}c.onsuccess=()=>e({modelArtifactsInfo:r}),c.onerror=e=>{l=a.objectStore(JB);const t=l.delete(this.modelPath);t.onsuccess=()=>(i.close(),n(c.error)),t.onerror=e=>(i.close(),n(c.error))}},s.onerror=e=>(i.close(),n(s.error)),a.oncomplete=()=>{null==o?i.close():o.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)})}}eM.URL_SCHEME="indexeddb://";const tM=e=>{return NE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(eM.URL_SCHEME)?(t=e.slice(eM.URL_SCHEME.length),new eM(t)):null;var t};VB.registerSaveRouter(tM),VB.registerLoadRouter(tM);class nM{constructor(){this.indexedDB=ZB()}async listModels(){return new Promise((e,t)=>{const n=this.indexedDB.open(XB,1);n.onupgradeneeded=()=>$B(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(JB,"readonly"),a=i.objectStore(JB).getAll();a.onsuccess=()=>{const t={};for(const e of a.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},a.onerror=e=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){var t;return e=(t=e).startsWith(eM.URL_SCHEME)?t.slice(eM.URL_SCHEME.length):t,new Promise((t,n)=>{const r=this.indexedDB.open(XB,1);r.onupgradeneeded=()=>$B(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(JB,"readwrite"),s=a.objectStore(JB),o=s.get(e);let l;o.onsuccess=()=>{if(null==o.result)return i.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const r=s.delete(e),a=()=>{l=i.transaction(YB,"readwrite");const r=l.objectStore(YB).delete(e);r.onsuccess=()=>t(o.result.modelArtifactsInfo),r.onerror=e=>n(o.error)};r.onsuccess=a,r.onerror=e=>(a(),i.close(),n(o.error))}},o.onerror=e=>(i.close(),n(o.error)),a.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=e=>n(r.error)})}}const rM="/",iM="tensorflowjs_models",aM="info",sM="model_topology",oM="weight_specs",lM="weight_data",cM="model_metadata";function uM(e){return{info:[iM,e,aM].join(rM),topology:[iM,e,sM].join(rM),weightSpecs:[iM,e,oM].join(rM),weightData:[iM,e,lM].join(rM),modelMetadata:[iM,e,cM].join(rM)}}function hM(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function dM(e){const t=e.split(rM);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(rM)}class AM{constructor(e){if(!NE().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=uM(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=HB(e),a=mB.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(LB)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(a));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:i}}catch(t){throw hM(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(i.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(i.weightSpecsBytes,", ")+"weightDataBytes=".concat(i.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const e=JSON.parse(i);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(LB){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(a),t}}AM.URL_SCHEME="localstorage://";const pM=e=>{return NE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(AM.URL_SCHEME)?(t=e.slice(AM.URL_SCHEME.length),new AM(t)):null;var t};VB.registerSaveRouter(pM),VB.registerLoadRouter(pM);class fM{constructor(){qC(NE().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),qC("undefined"===typeof window||"undefined"!==typeof window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=iM+rM,n=rM+aM;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(n)){e[dM(i)]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){var t;const n=uM(e=(t=e).startsWith(AM.URL_SCHEME)?t.slice(AM.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const r=JSON.parse(this.LS.getItem(n.info));return hM(n),r}}const gM="://";class mM{constructor(){this.managers={}}static getInstance(){return null==mM.instance&&(mM.instance=new mM),mM.instance}static registerManager(e,t){qC(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(gM)&&(e=e.slice(0,e.indexOf(gM))),qC(e.length>0,()=>"scheme must not be an empty string.");const n=mM.getInstance();qC(null==n.managers[e],()=>"A model store manager is already registered for scheme '".concat(e,"'.")),n.managers[e]=t}static getManager(e){const t=mM.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(mM.getInstance().managers)}}function yM(e){if(-1===e.indexOf(gM))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(mM.getSchemes().join(",")));return{scheme:e.split(gM)[0],path:e.split(gM)[1]}}async function vM(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];qC(e!==t,()=>"Old path and new path are the same: '".concat(e,"'"));const r=VB.getLoadHandlers(e);qC(r.length>0,()=>"Copying failed because no load handler is found for source URL ".concat(e,".")),qC(r.length<2,()=>"Copying failed because more than one (".concat(r.length,") ")+"load handlers for source URL ".concat(e,"."));const i=r[0],a=VB.getSaveHandlers(t);qC(a.length>0,()=>"Copying failed because no save handler is found for destination "+"URL ".concat(t,".")),qC(a.length<2,()=>"Copying failed because more than one (".concat(r.length,") ")+"save handlers for destination URL ".concat(t,"."));const s=a[0],o=yM(e).scheme,l=yM(e).path,c=o===yM(e).scheme,u=await i.load();n&&c&&await mM.getManager(o).removeModel(l);const h=await s.save(u);return n&&!c&&await mM.getManager(o).removeModel(l),h.modelArtifactsInfo}async function bM(){const e=mM.getSchemes(),t={};for(const n of e){const e=await mM.getManager(n).listModels();for(const r in e){t[n+gM+r]=e[r]}}return t}async function xM(e){const t=yM(e);return mM.getManager(t.scheme).removeModel(t.path)}async function wM(e,t){return vM(e,t,!1)}async function _M(e,t){return vM(e,t,!0)}class SM{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){"undefined"!==typeof window&&NE().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{if(e.source===window&&e.data.name===this.messageName){e.stopPropagation();(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))):setTimeout(e,t)}isTypedArray(e){return $I(e)}}if(NE().get("IS_BROWSER")){NE().setPlatform("browser",new SM);try{mM.registerManager(AM.URL_SCHEME,new fM)}catch(kAe){}try{mM.registerManager(eM.URL_SCHEME,new nM)}catch(kAe){}}const CM=()=>n(5817);let EM;class NM{constructor(){this.util=n(8590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=NE().global.fetch?NE().global.fetch(e,t):(null==EM&&(EM=CM()),EM(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function kM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",bE(e),new IT(e,t,n)}NE().get("IS_NODE")&&!NE().get("IS_BROWSER")&&NE().setPlatform("node",new NM);const IM=dB({cast_:function(e,t){const n=cB(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:t};return eB.runKernel(tN,r,i)}});const TM=dB({clone_:function(e){const t={x:cB(e,"x","clone","string_or_numeric")};return eB.runKernel(qN,t)}});function BM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}$T();BT={buffer:kM,cast:IM,clone:TM,print:BM};const MM=dB({add_:function(e,t){let n=cB(e,"a","add"),r=cB(t,"b","add");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(LE,i)}});const FM=dB({floorDiv_:function(e,t){let n=cB(e,"a","floorDiv"),r=cB(t,"b","floorDiv");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(zN,i)}});const RM=dB({div_:function(e,t){let n=cB(e,"a","div"),r=cB(t,"b","div");if([n,r]=WT(n,r),"int32"===n.dtype&&"int32"===r.dtype)return FM(n,r);const i={a:n,b:r};return eB.runKernel(kN,i,{})}});const LM=dB({mul_:function(e,t){let n=cB(e,"a","mul"),r=cB(t,"b","mul");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(_k,i)}});const PM=dB({sqrt_:function(e){const t={x:cB(e,"x","sqrt","float32")};return eB.runKernel(cI,t)}});const UM=dB({square_:function(e){const t=cB(e,"x","square");return eB.runKernel("Square",{x:t},{})}});const DM=dB({zerosLike_:function(e){const t={x:cB(e,"x","zerosLike")};return eB.runKernel(PI,t)}});function OM(e){return eB.customGrad(e)}function jM(e,t){if((vT(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&vT(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return pB(e,[],[],t)}const zM=new Map,HM=new Map;class QM{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class VM{constructor(){this.classNameMap={}}static getMap(){return null==VM.instance&&(VM.instance=new VM),VM.instance}static register(e){VM.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function GM(e,t,n){qC(null!=e.className,()=>"Class being registered does not have the static className property defined."),qC("string"===typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),qC(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),"undefined"===typeof t&&(t="Custom"),"undefined"===typeof n&&(n=e.className);const r=t+">"+n;return VM.register(e),zM.set(r,e),HM.set(e,r),e}class WM extends QM{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:r,grads:i}=this.computeGradients(e,n);if(null!=n){const e=n.map(e=>({name:e.name,tensor:i[e.name]}));this.applyGradients(e)}else this.applyGradients(i);return xB(i),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){qC(dE(e),()=>"The f passed in variableGrads(f) must be a function"),qC(null==t||Array.isArray(t)&&t.every(e=>e instanceof LT),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=t;if(!n){t=[];for(const e in eB.registeredVariables)t.push(eB.registeredVariables[e])}const r=n?t.filter(e=>!e.trainable):null,i=t.length;t=t.filter(e=>e.trainable),qC(t.length>0,()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable.");const{value:a,grads:s}=eB.gradients(e,t,null,!0);qC(s.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),qC(0===a.rank,()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(a.rank," tensor"));const o={};return t.forEach((e,t)=>{null!=s[t]&&(o[e.name]=s[t])}),null!=r&&r.forEach(e=>o[e.name]=null),{value:a,grads:o}}(e,t)}dispose(){null!=this.iterations_&&xB(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:jM(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(WM,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class qM extends WM{static get className(){return"Adadelta"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=eB.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=eB.registeredVariables[t],i=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:bB(()=>DM(r).variable(i))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:bB(()=>DM(r).variable(i))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;bB(()=>{const e=MM(LM(s,this.rho),LM(UM(a),1-this.rho)),t=LM(RM(PM(MM(o,this.epsilon)),PM(MM(s,this.epsilon))),a),n=MM(LM(o,this.rho),LM(UM(t),1-this.rho));s.assign(e),o.assign(n);const i=MM(LM(t,-this.learningRate),r);r.assign(i)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(xB(this.accumulatedGrads.map(e=>e.variable)),xB(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function KM(e,t,n){bE(e);const r={shape:e,value:t,dtype:n=n||hE(t)};return eB.runKernel(DN,{},r)}class XM extends WM{static get className(){return"Adagrad"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=eB.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:bB(()=>KM(r.shape,this.initialAccumulatorValue).variable(e))}}const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable;bB(()=>{const e=MM(a,UM(i));a.assign(e);const t=MM(LM(RM(i,PM(MM(e,eB.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&xB(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}const YM=dB({pow_:function(e,t){let n=cB(e,"base","pow"),r=cB(t,"exp","pow");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(Fk,i)}});const JM=dB({sub_:function(e,t){let n=cB(e,"a","sub"),r=cB(t,"b","sub");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(EI,i)}});class ZM extends WM{static get className(){return"Adam"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],bB(()=>{this.accBeta1=jM(t).variable(),this.accBeta2=jM(n).variable()}),null==r&&(this.epsilon=eB.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);bB(()=>{const n=JM(1,this.accBeta1),r=JM(1,this.accBeta2);t.forEach((t,i)=>{const a=eB.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:"".concat(t,"/m"),variable:bB(()=>DM(a).variable(s))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:"".concat(t,"/v"),variable:bB(()=>DM(a).variable(s))});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[i].variable,c=this.accumulatedSecondMoment[i].variable,u=MM(LM(l,this.beta1),LM(o,1-this.beta1)),h=MM(LM(c,this.beta2),LM(UM(o),1-this.beta2)),d=RM(u,n),A=RM(h,r);l.assign(u),c.assign(h);const p=MM(LM(RM(d,MM(PM(A),this.epsilon)),-this.learningRate),a);a.assign(p)}),this.accBeta1.assign(LM(this.accBeta1,this.beta1)),this.accBeta2.assign(LM(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&xB(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&xB(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),bB(()=>{this.accBeta1.assign(YM(this.beta1,this.iterations_+1)),this.accBeta2.assign(YM(this.beta2,this.iterations_+1))});const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}const $M=dB({abs_:function(e){const t=cB(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return eB.runKernel(aN,e)}{const e={x:t};return eB.runKernel(ME,e)}}});function eF(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const a=n-1-i,s=e[a]||1;(t[t.length-1-i]||1)>1&&1===s&&r.unshift(a)}return r}function tF(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],a=t.length-r-1,s=t[a];(null==i||1===i&&s>1)&&n.unshift(a)}return n}function nF(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let i=0;i<n;i++){let a=e[e.length-i-1];null==a&&(a=1);let s=t[t.length-i-1];if(null==s&&(s=1),1===a)r[n-i-1]=s;else if(1===s)r[n-i-1]=a;else{if(a!==s){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}r[n-i-1]=a}}return r}const rF=dB({maximum_:function(e,t){let n=cB(e,"a","maximum"),r=cB(t,"b","maximum");[n,r]=WT(n,r),"bool"===n.dtype&&(n=IM(n,"int32"),r=IM(r,"int32")),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(hk,i)}});class iF extends WM{static get className(){return"Adamax"}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],bB(()=>{this.iteration=jM(0).variable(),this.accBeta1=jM(t).variable()}),null==r&&(this.epsilon=eB.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);bB(()=>{const n=JM(1,this.accBeta1),r=RM(-this.learningRate,MM(LM(this.iteration,this.decay),1));t.forEach((t,i)=>{const a=eB.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:"".concat(t,"/m"),variable:DM(a).variable(s)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:"".concat(t,"/v"),variable:DM(a).variable(s)});const o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;const l=this.accumulatedFirstMoment[i].variable,c=this.accumulatedWeightedInfNorm[i].variable,u=MM(LM(l,this.beta1),LM(o,1-this.beta1)),h=LM(c,this.beta2),d=$M(o),A=rF(h,d);l.assign(u),c.assign(A);const p=MM(LM(RM(r,n),RM(u,MM(A,this.epsilon))),a);a.assign(p)}),this.iteration.assign(MM(this.iteration,1)),this.accBeta1.assign(LM(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&xB(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&xB(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class aF extends WM{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){const t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);t.forEach((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const i=eB.registeredVariables[t];bB(()=>{const e=MM(LM(this.c,r),i);i.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=wB(jM(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class sF extends aF{static get className(){return"Momentum"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=jM(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=eB.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:bB(()=>DM(r).variable(e))}}const i=this.accumulations[n].variable,a=Array.isArray(e)?e[n].tensor:e[t];null!=a&&bB(()=>{let e;const t=MM(LM(this.m,i),a);e=this.useNesterov?MM(LM(this.c,MM(a,LM(t,this.m))),r):MM(LM(this.c,t),r),i.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&xB(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(false)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class oF extends WM{static get className(){return"RMSProp"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=eB.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{const r=eB.registeredVariables[t],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:bB(()=>DM(r).variable(i))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:bB(()=>DM(r).variable(i))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:bB(()=>DM(r).variable(i))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;bB(()=>{const e=MM(LM(s,this.decay),LM(UM(a),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,i=MM(LM(t,this.decay),LM(a,1-this.decay)),l=RM(LM(a,this.learningRate),PM(JM(e,MM(UM(i),this.epsilon)))),c=MM(LM(o,this.momentum),l);s.assign(e),t.assign(i),o.assign(c);const u=JM(r,c);r.assign(u)}else{const e=MM(LM(s,this.decay),LM(UM(a),1-this.decay)),t=MM(LM(o,this.momentum),RM(LM(a,this.learningRate),PM(MM(e,this.epsilon))));s.assign(e),o.assign(t);const n=JM(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&xB(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&xB(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&xB(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const lF=[qM,XM,ZM,iF,sF,oF,aF];function cF(e){return new Promise(e=>setTimeout(e)).then(e)}class uF{constructor(e){if(!NE().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(uF.URL_SCHEME)&&(e=e.slice(uF.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=mB.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const t=OB(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await cF(()=>i.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await cF(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:HB(e)}}}}uF.URL_SCHEME="downloads://";class hF{constructor(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),i=r.modelTopology;if(null==i)return void t(new Error("modelTopology field is missing from file ".concat(this.jsonFile.name)));if(null==r.weightsManifest)return void t(new Error("weightManifest field is missing from file ".concat(this.jsonFile.name)));if(0===this.weightsFiles.length)return void e({modelTopology:i});const a=zB(r,e=>this.loadWeights(e));e(a)},n.onerror=e=>t("Failed to read model topology and weights manifest JSON "+"from file '".concat(this.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only."),n.readAsText(this.jsonFile)})}loadWeights(e){const t=[],n=[];for(const a of e)t.push(...a.weights),n.push(...a.paths);const r=this.checkManifestAndWeightFiles(e),i=n.map(e=>this.loadWeightsFile(e,r[e]));return Promise.all(i).then(e=>[t,e])}loadWeightsFile(e,t){return new Promise((n,r)=>{const i=new FileReader;i.onload=e=>{const t=e.target.result;n(t)},i.onerror=t=>r("Failed to weights data from file of path '".concat(e,"'.")),i.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],n=this.weightsFiles.map(e=>DB(e.name)),r={};for(const i of e)i.paths.forEach(e=>{const i=DB(e);if(-1!==t.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(i,"'"));if(t.push(i),-1===n.indexOf(i))throw new Error("Weight file with basename '".concat(i,"' is not provided."));r[e]=this.weightsFiles[n.indexOf(i)]});if(t.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(t.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return r}}function dF(e){return new hF(e)}function AF(e,t,n,r){!function(e){qC(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}(e),function(e,t){qC(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)),qC(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)),qC(t>=e,()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(e.map(a=>(a.then(a=>{const s=n+ ++i/e.length*(r-n);return t(s),a}),a)))}async function pF(e,t){null==t&&(t={});const n=null==t.fetchFunc?NE().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),i=(null==t.onProgress?await Promise.all(r):await AF(r,t.onProgress,0,.5)).map(e=>e.arrayBuffer());return null==t.onProgress?await Promise.all(i):await AF(i,t.onProgress,.5,1)}async function fF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return gF(e=>pF(e,{requestInit:r}))(e,t,n)}function gF(e){return async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;const i=t.map(()=>!1),a={},s=null!=r?r.map(()=>!1):[],o=[];if(t.forEach((e,t)=>{let n=0;e.weights.forEach(e=>{const l="quantization"in e?e.quantization.dtype:e.dtype,c=gB[l]*YC(e.shape),u=()=>{i[t]=!0,null==a[t]&&(a[t]=[]),a[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=r?r.forEach((t,n)=>{t===e.name&&(u(),s[n]=!0)}):u(),o.push(e.name),n+=c})}),!s.every(e=>e)){const e=r.filter((e,t)=>!s[t]);throw new Error("Could not find weights in manifest with names: "+"".concat(e.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(o.join(", "),"."))}const l=i.reduce((e,t,n)=>(t&&e.push(n),e),[]),c=[];l.forEach(e=>{t[e].paths.forEach(e=>{const t=n+(n.endsWith("/")?"":"/")+e;c.push(t)})});const u=await e(c),h={};let d=0;return l.forEach(e=>{const n=t[e].paths.length,r=new mB(u.slice(d,d+n));a[e].forEach(e=>{const t=kB(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)h[n]=t[n]}),d+=n}),h}}VB.registerSaveRouter(e=>NE().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(uF.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new uF(e)}(e.slice(uF.URL_SCHEME.length)):null);class mF{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(qC("function"===typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=NE().platform.fetch,qC(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&qC(2===e.length,()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=OB(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);if(t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData){const n=mB.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:HB(e),responses:[r]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(r.status,"."))}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch(i){let e="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();return zB(await this.loadModelJSON(),e=>this.loadWeights(e))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=QB(e.weightsManifest);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:()=>function(e,t){var n;const r=null==t.fetchFunc?NE().platform.fetch:t.fetchFunc;let i,a=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var s;a<e.length;){if(!i){const n=(await r(e[a],t.requestInit,{isBinary:!0})).body;i=n.getReader()}const{done:o,value:l}=await i.read();if(!o)return void n.enqueue(l);a++,i=void 0,null===(s=t.onProgress)||void 0===s||s.call(t,a/e.length)}n.close()}})}(t,this.loadOptions)})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),i=n>t?e.substring(n):"";return[r+"/",i]}(t),i=this.weightPathPrefix||n,a=[],s=[];for(const o of e)for(const e of o.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(e)):a.push(i+e+r);return this.weightUrlConverter&&a.push(...await Promise.all(s)),a}async loadWeights(e){const t=await this.getWeightUrls(e);return[QB(e),await pF(t,this.loadOptions)]}}function yF(e){return null!=e.match(mF.URL_SCHEME_REGEX)}mF.URL_SCHEME_REGEX=/^https?:\/\//;const vF=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every(e=>yF(e)):yF(e),n)return bF(e,t)}return null};function bF(e,t){return new mF(e,t)}function xF(e,t){return bF(e,t)}VB.registerSaveRouter(vF),VB.registerLoadRouter(vF);class wF{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class _F{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class SF{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function CF(e,t,n,r){return new SF(EF(...arguments))}function EF(e,t,n,r){if(1===arguments.length){return null!=e.modelTopology||null!=e.weightSpecs?new wF(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wF({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wF({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function NF(e){return new _F(e)}function kF(e){return new _F(e)}function IF(e,t,n){if(XC(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=sB(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return pB(e,t,r,n)}let TF;function BF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,a=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));o=!0}if(null!=qI(DI,eB.backendName)){const n={pixels:e},r={numChannels:t};return eB.runKernel(DI,n,r)}const[l,c]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let u,h;if(s)u=e.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)u=e.data;else if(a||i||o){if(null==TF)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");TF=new OffscreenCanvas(1,1).getContext("2d")}else TF=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});TF.canvas.width=l,TF.canvas.height=c,TF.drawImage(e,0,0,l,c),u=TF.getImageData(0,0,l,c).data}if(4===t)h=new Int32Array(u);else{const e=l*c;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=u[4*n+e]}return IF(h,[c,l,t],"int32")}const MF=dB({fromPixels_:BF}),FF=-2,RF=-1;function LF(e,t,n){const r=e.shape.length;qC(r===t.length,()=>"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")),qC(r===n.length,()=>"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,")."));for(let i=0;i<r;++i)qC(t[i]+n[i]<=e.shape[i],()=>"Error in slice".concat(r,"D: begin[").concat(i,"] + size[").concat(i,"] ")+"(".concat(t[i]+n[i],") would overflow input.shape[").concat(i,"] (").concat(e.shape[i],")"))}function PF(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function UF(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function DF(e,t,n,r){const i=[...e];for(let a=i.length;a<r.length;a++)i.push(1);for(let a=0;a<n;a++)0===a?i[t]=1:(i.splice(t,0,1),i.pop());return i}function OF(e,t,n){return n<=e?n:n-(t-1)}function jF(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function zF(e,t,n,r,i,a,s,o,l){const c=e.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;u=HF(s,l,c,r,e),h=QF(o,l,c,i,e),d=DF(a,l,c,e)}else for(let A=0;A<c;A++)u[A]=GF(s,r,a,e,A,l),h[A]=WF(o,i,a,e,A,l),d[A]=VF(a,A,l);return{begin:u,end:h,strides:d}}function HF(e,t,n,r,i){const a=[...i],s=jF(n,t);for(let o=0;o<a.length;o++)if(s.indexOf(o)>-1)a[o]=0;else{const i=OF(t,n,o);let s=r[i];e&1<<i&&(s=0),a[o]=s}return a}function QF(e,t,n,r,i){const a=[...i],s=jF(n,t);for(let o=0;o<a.length;o++)if(s.indexOf(o)>-1)a[o]=Number.MAX_SAFE_INTEGER;else{const i=OF(t,n,o);let s=r[i];e&1<<i&&(s=Number.MAX_SAFE_INTEGER),a[o]=s}for(let o=0;o<a.length;o++){const e=i[o];a[o]<0&&(a[o]+=e),a[o]=VC(0,a[o],i[o])}return a}function VF(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function GF(e,t,n,r,i,a){let s=t[i];const o=n[i]||1;(e&1<<i||a&1<<i||null==s)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=r[i];return s<0&&(s+=l),s=VC(0,s,l-1),s}function WF(e,t,n,r,i,a){let s=t[i];const o=n[i]||1;(e&1<<i||a&1<<i||null==s)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[i];return s<0&&(s+=l),s=o>0?VC(0,s,l):VC(-1,s,l-1),s}function qF(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function KF(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function XF(e,t,n){let r;const i=e.shape.length;let a;return r="number"===typeof t?[t,...new Array(i-1).fill(0)]:t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice(),r.forEach(e=>{qC(-1!==e,()=>"slice() does not support negative begin indexing.")}),a=null==n?new Array(i).fill(-1):"number"===typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,a=a.map((t,n)=>t>=0?t:(qC(-1===t,()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")),e.shape[n]-r[n])),[r,a]}function YF(e,t,n,r,i,a,s,o,l){let c;if(null==r?(c=new Array(t.length),c.fill(1)):c=r,null!=s&&0!==(s&s-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:i,endMask:a,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)u&&0!==(1<<v&o)&&h.numAddAxisAfterEllipsis++,1<<v&s&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(FF),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(RF),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);let A=!0,p=!0,f=!0;const g=[],m=[];for(let v=0;v<e.length;++v){if(0===d.strides[v])throw Error("strides[".concat(v,"] must be non-zero"));const t=!!(d.shrinkAxisMask&1<<v),n=e[v];if(-1===n){g.push(t?1:-1);continue}const r=[d.beginMask&1<<v,d.endMask&1<<v],i=[d.strides[v]>0?0:-1,d.strides[v]>0?n:n-1];if(t&&d.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");f=f&&1===d.strides[v];const a=!!(d.beginMask&1<<v&&d.endMask&1<<v);if(d.beginValid&&d.endValid){if(t){const e=d.begin[v]<0?n+d.begin[v]:d.begin[v];if(d.begin[v]=e,d.end[v]=d.begin[v]+1,e<0||e>=n)throw Error("slice index ".concat(d.begin[v]," of dimension ").concat(v," out of bounds."))}else d.begin[v]=JF(d.begin[v],0,d.strides[v],n,r,i),d.end[v]=JF(d.end[v],1,d.strides[v],n,r,i);const e=1===d.strides[v]&&0===d.begin[v]&&d.end[v]===n;A=A&&e,p=p&&(0===v&&1===d.strides[v]||e)}else A=A&&1===d.strides[v]&&a,p=p&&(0===v&&1===d.strides[v]||a);let s,o=!1;if(d.beginValid&&d.endValid?(s=d.end[v]-d.begin[v],o=!0):t?(s=1,o=!0):a&&n>=0&&(s=d.strides[v]<0?-n:n,o=!0),o){let e;e=0===s||s<0!==d.strides[v]<0?0:Math.trunc(s/d.strides[v])+(s%d.strides[v]!==0?1:0),g.push(e)}else g.push(-1)}for(let v=0;v<d.finalShapeGatherIndices.length;++v){const e=d.finalShapeGatherIndices[v];e>=0?m.push(g[e]):e===FF&&m.push(1)}const y=m.filter((e,t)=>d.finalShapeGatherIndices[t]!==FF);return{finalShapeSparse:y,finalShape:m,isIdentity:A,sliceDim0:p,isSimpleSlice:f,begin:d.begin,end:d.end,strides:d.strides}}function JF(e,t,n,r,i,a){if(i[t])return n>0?a[t]:a[t+1&1];{const t=e<0?r+e:e;return t<a[0]?a[0]:t>a[1]?a[1]:t}}const ZF=dB({acos_:function(e){const t={x:cB(e,"x","acos")};return eB.runKernel(FE,t)}});const $F=dB({acosh_:function(e){const t={x:cB(e,"x","acosh")};return eB.runKernel(RE,t)}});const eR=dB({addN_:function(e){qC(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),qC(e.length>=1,()=>"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length));const t=e.map((e,t)=>cB(e,"tensors".concat(t),"addN")),n=t[0];t.forEach(e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(e=>{if(!JC(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=t;return eB.runKernel(PE,r)}});const tR=dB({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:cB(e,"x","all","bool")},i={axis:t,keepDims:n};return eB.runKernel(UE,r,i)}});const nR=dB({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:cB(e,"x","any","bool")},i={axis:t,keepDims:n};return eB.runKernel(DE,r,i)}});const rR=dB({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:cB(e,"x","argMax")},r={axis:t};return eB.runKernel(OE,n,r)}});const iR=dB({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:cB(e,"x","argMin")},r={axis:t};return eB.runKernel(jE,n,r)}});const aR=dB({asin_:function(e){const t={x:cB(e,"x","asin")};return eB.runKernel(zE,t)}});const sR=dB({asinh_:function(e){const t={x:cB(e,"x","asinh")};return eB.runKernel(HE,t)}});const oR=dB({atan_:function(e){const t={x:cB(e,"x","atan")};return eB.runKernel(QE,t)}});const lR=dB({atan2_:function(e,t){let n=cB(e,"a","atan2"),r=cB(t,"b","atan2");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(GE,i)}});const cR=dB({atanh_:function(e){const t={x:cB(e,"x","atanh")};return eB.runKernel(VE,t)}});function uR(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5?arguments[5]:void 0;return AR(e,[...t,e[3]],n,a,r,null,null,_R(i))}function hR(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[o,l]=gR(t);let c;if("channelsLast"===s)c=[o,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));c=[o,l,e[1],e[1]]}return AR(e,c,n,r,i,a,!1,s)}function dR(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[o,l,c]=mR(t);let u,h;if("NDHWC"===s)h="channelsLast",u=[o,l,c,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat ".concat(s));h="channelsFirst",u=[o,l,c,e[1],e[1]]}return pR(e,u,n,r,i,!1,h,a)}function AR(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[l,c,u,h]=[-1,-1,-1,-1];if("channelsLast"===o)[l,c,u,h]=e;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));[l,h,c,u]=e}const[d,A,,p]=t,[f,g]=gR(n),[m,y]=gR(r),v=yR(d,m),b=yR(A,y),{padInfo:x,outHeight:w,outWidth:_}=function(e,t,n,r,i,a,s,o,l){let c,u,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const i=function(e,t,n,r,i){null==r&&(r=fR(e,t,n));const a=e[0],s=e[1],o=vR((a-t+2*r)/n+1,i),l=vR((s-t+2*r)/n+1,i);return[o,l]}([t,n],a,r,e,o);u=i[0],h=i[1]}else if("same"===e){u=Math.ceil(t/r),h=Math.ceil(n/i);const e=Math.max(0,(u-1)*r+a-t),o=Math.max(0,(h-1)*i+s-n),l=Math.floor(e/2),d=e-l,A=Math.floor(o/2);c={top:l,bottom:d,left:A,right:o-A,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-a+1)/r),h=Math.ceil((n-s+1)/i);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===l?e[1][0]:e[2][0],A="channelsLast"===l?e[1][1]:e[2][1],p="channelsLast"===l?e[2][0]:e[3][0],f="channelsLast"===l?e[2][1]:e[3][1];c={top:d,bottom:A,left:p,right:f,type:0===d&&0===A&&0===p&&0===f?"VALID":"EXPLICIT"},u=vR((t-a+d+A)/r+1,o),h=vR((n-s+p+f)/i+1,o)}}return{padInfo:c,outHeight:u,outWidth:h}}(i,c,u,f,g,v,b,a,o),S=s?p*h:p;let C;return"channelsFirst"===o?C=[l,S,w,_]:"channelsLast"===o&&(C=[l,w,_,S]),{batchSize:l,dataFormat:o,inHeight:c,inWidth:u,inChannels:h,outHeight:w,outWidth:_,outChannels:S,padInfo:x,strideHeight:f,strideWidth:g,filterHeight:d,filterWidth:A,effectiveFilterHeight:v,effectiveFilterWidth:b,dilationHeight:m,dilationWidth:y,inShape:e,outShape:C,filterShape:t}}function pR(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",o=arguments.length>7?arguments[7]:void 0,[l,c,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[l,c,u,h,d]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[l,d,c,u,h]=e}const[A,p,f,,g]=t,[m,y,v]=mR(n),[b,x,w]=mR(r),_=yR(A,b),S=yR(p,x),C=yR(f,w),{padInfo:E,outDepth:N,outHeight:k,outWidth:I}=function(e,t,n,r,i,a,s,o,l,c,u){let h,d,A,p;"valid"===e&&(e=0);if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const f=function(e,t,n,r,i,a){null==i&&(i=fR(e,t[0],r[0]));const s=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*i>=t[o]&&(s[o]=vR((e[o]-t[o]+2*i)/r[o]+1,a));return s}([t,n,r,1],[o,l,c],1,[i,a,s],e,u);d=f[0],A=f[1],p=f[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/i),A=Math.ceil(n/a),p=Math.ceil(r/s);const e=(d-1)*i+o-t,u=(A-1)*a+l-n,f=(p-1)*s+c-r,g=Math.floor(e/2),m=e-g,y=Math.floor(u/2),v=u-y,b=Math.floor(f/2);h={top:y,bottom:v,left:b,right:f-b,front:g,back:m,type:"SAME"}}}return{padInfo:h,outDepth:d,outHeight:A,outWidth:p}}(i,c,u,h,m,y,v,_,S,C,o),T=a?g*d:g;let B;return"channelsFirst"===s?B=[l,T,N,k,I]:"channelsLast"===s&&(B=[l,N,k,I,T]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:N,outHeight:k,outWidth:I,outChannels:T,padInfo:E,strideDepth:m,strideHeight:y,strideWidth:v,filterDepth:A,filterHeight:p,filterWidth:f,effectiveFilterDepth:_,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationDepth:b,dilationHeight:x,dilationWidth:w,inShape:e,outShape:B,filterShape:t}}function fR(e,t,n){const r=yR(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function gR(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function mR(e){return"number"===typeof e?[e,e,e]:e}function yR(e,t){return t<=1?e:e+(e-1)*(t-1)}function vR(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function bR(e){const[t,n,r]=gR(e);return 1===t&&1===n&&1===r}function xR(e,t){return bR(e)||bR(t)}function wR(e){return gR(e).every(e=>e>0)}function _R(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function SR(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)qC(ZC(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach(t=>{t.forEach(t=>{qC(ZC(t),()=>"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."))})})}}}const CR=dB({reshape_:function(e,t){const n={x:cB(e,"x","reshape","string_or_numeric")},r={shape:t};return eB.runKernel(Qk,n,r)}});const ER=dB({avgPool_:function(e,t,n,r,i){const a=cB(e,"x","avgPool","float32");qC(xR(n,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"));let s=a,o=!1;3===a.rank&&(o=!0,s=CR(a,[1,a.shape[0],a.shape[1],a.shape[2]])),qC(4===s.rank,()=>"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")),SR("avgPool",r,i);const l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i};let u=eB.runKernel(WE,l,c);return u=IM(u,a.dtype),o?CR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const NR=dB({avgPool3d_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const s=cB(e,"x","avgPool3d","float32");let o=s,l=!1;4===s.rank&&(l=!0,o=CR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),qC(5===o.rank,()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),qC("NDHWC"===a,()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(a)),qC("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")),SR("avgPool3d",r,i);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a};let h=eB.runKernel(KE,c,u);return h=IM(h,o.dtype),l?CR(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const kR=dB({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;qC(e.length>=1,()=>"Pass at least one tensor to concat");const n=uB(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}),1===n.length)return TM(n[0]);const r=n,i={axis:t};return eB.runKernel(sN,r,i)}});const IR=dB({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=cB(e,"a","matMul"),a=cB(t,"b","matMul");[i,a]=WT(i,a);const s={a:i,b:a},o={transposeA:n,transposeB:r};return eB.runKernel(YE,s,o)}});const TR=dB({sigmoid_:function(e){const t={x:cB(e,"x","sigmoid","float32")};return eB.runKernel(oI,t)}});const BR=dB({slice_:function(e,t,n){const r=cB(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const i={x:r},a={begin:t,size:n};return eB.runKernel(rI,i,a)}});const MR=dB({tanh_:function(e){const t={x:cB(e,"x","tanh","float32")};return eB.runKernel(kI,t)}});const FR=dB({basicLSTMCell_:function(e,t,n,r,i,a){const s=cB(e,"forgetBias","basicLSTMCell"),o=cB(t,"lstmKernel","basicLSTMCell"),l=cB(n,"lstmBias","basicLSTMCell"),c=cB(r,"data","basicLSTMCell"),u=cB(i,"c","basicLSTMCell"),h=cB(a,"h","basicLSTMCell"),d=kR([c,h],1),A=IR(d,o),p=MM(A,l),f=p.shape[0],g=p.shape[1]/4,m=[f,g],y=BR(p,[0,0],m),v=BR(p,[0,g],m),b=BR(p,[0,2*g],m),x=BR(p,[0,3*g],m),w=MM(LM(TR(y),MR(v)),LM(u,TR(MM(s,b))));return[w,LM(MR(w),TR(x))]}});const RR=dB({batchToSpaceND_:function(e,t,n){const r=cB(e,"x","batchToSpaceND"),i=t.reduce((e,t)=>e*t);qC(r.rank>=1+t.length,()=>"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)),qC(n.length===t.length,()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)),qC(r.shape[0]%i===0,()=>"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(i));const a={x:r},s={blockShape:t,crops:n};return eB.runKernel(JE,a,s)}});const LR=dB({batchNorm_:function(e,t,n,r,i,a){null==a&&(a=.001);const s=cB(e,"x","batchNorm"),o=cB(t,"mean","batchNorm"),l=cB(n,"variance","batchNorm");let c,u;null!=i&&(c=cB(i,"scale","batchNorm")),null!=r&&(u=cB(r,"offset","batchNorm")),qC(o.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),qC(null==u||o.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),qC(null==c||o.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h=function(e){let t;return t=0===e.rank||1===e.rank?CR(e,[1,1,1,e.size]):2===e.rank?CR(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?CR(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(s),d={x:h,scale:c,offset:u,mean:o,variance:l},A={varianceEpsilon:a},p=eB.runKernel(HN,d,A);return CR(p,s.shape)}});const PR=dB({batchNorm2d_:function(e,t,n,r,i,a){const s=cB(e,"x","batchNorm"),o=cB(t,"mean","batchNorm"),l=cB(n,"variance","batchNorm");let c,u;return null!=i&&(c=cB(i,"scale","batchNorm")),null!=r&&(u=cB(r,"offset","batchNorm")),qC(2===s.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(s.rank,".")),qC(2===o.rank||1===o.rank,()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(o.rank,".")),qC(2===l.rank||1===l.rank,()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&qC(2===c.rank||1===c.rank,()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&qC(2===u.rank||1===u.rank,()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")),LR(s,o,l,u,c,a)}});const UR=dB({batchNorm3d_:function(e,t,n,r,i,a){const s=cB(e,"x","batchNorm"),o=cB(t,"mean","batchNorm"),l=cB(n,"variance","batchNorm");let c,u;return null!=i&&(c=cB(i,"scale","batchNorm")),null!=r&&(u=cB(r,"offset","batchNorm")),qC(3===s.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(s.rank,".")),qC(3===o.rank||1===o.rank,()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(o.rank,".")),qC(3===l.rank||1===l.rank,()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&qC(3===c.rank||1===c.rank,()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&qC(3===u.rank||1===u.rank,()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")),LR(s,o,l,u,c,a)}});const DR=dB({batchNorm4d_:function(e,t,n,r,i,a){const s=cB(e,"x","batchNorm"),o=cB(t,"mean","batchNorm"),l=cB(n,"variance","batchNorm");let c,u;return null!=i&&(c=cB(i,"scale","batchNorm")),null!=r&&(u=cB(r,"offset","batchNorm")),qC(4===s.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(s.rank,".")),qC(4===o.rank||1===o.rank,()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(o.rank,".")),qC(4===l.rank||1===l.rank,()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")),null!=c&&qC(4===c.rank||1===c.rank,()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")),null!=u&&qC(4===u.rank||1===u.rank,()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")),LR(s,o,l,u,c,a)}});const OR=dB({bincount_:function(e,t,n){const r=cB(e,"x","bincount"),i=cB(t,"weights","bincount");qC("int32"===r.dtype,()=>"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)),qC(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),qC(i.size===r.size||0===i.size,()=>"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(i.shape,"."));const a={x:r,weights:i},s={size:n};return eB.runKernel(ZE,a,s)}});const jR=dB({bitwiseAnd_:function(e,t){const n=cB(e,"x","bitwiseAnd"),r=cB(t,"y","bitwiseAnd");if(!JC(n.shape,r.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(r.shape));if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(r.dtype));const i={a:n,b:r};return eB.runKernel($E,i)}});const zR=dB({broadcastArgs_:function(e,t){const n=cB(e,"s0","broadcastArgs","int32"),r=cB(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));const i={s0:n,s1:r};return eB.runKernel(eN,i)}});const HR=dB({broadcastTo_:function(e,t){let n=cB(e,"broadcastTo","x");const r=n.shape;if(bE(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=CR(n,e)}const i=n.shape,a=Array.from(t);for(let c=t.length-1;c>=0;c--)if(i[c]===t[c])a[c]=1;else if(1!==n.shape[c])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));const s=a.map((e,t)=>e>1?t:-1).filter(e=>e>=0);if(0===s.length)return TM(n);const o={x:n},l={reps:a};return eB.runKernel(II,o,l)}});const QR=dB({ceil_:function(e){const t={x:cB(e,"x","ceil","float32")};return eB.runKernel(nN,t)}});const VR=dB({clipByValue_:function(e,t,n){const r=cB(e,"x","clipByValue");if(qC(t<=n,()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")),t===n)return KM(r.shape,t,r.dtype);const i={x:r},a={clipValueMin:t,clipValueMax:n};return eB.runKernel(rN,i,a)}});const GR=dB({concat1d_:function(e){return kR(e,0)}});const WR=dB({concat2d_:function(e,t){return kR(e,t)}});const qR=dB({concat3d_:function(e,t){return kR(e,t)}});const KR=dB({concat4d_:function(e,t){return kR(e,t)}});const XR=dB({conv2d_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const o=cB(e,"x","conv2d","float32"),l=cB(t,"filter","conv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=CR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),qC(4===c.rank,()=>"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")),qC(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(l.rank,".")),SR("conv2d",r,s);const h="NHWC"===i?c.shape[3]:c.shape[1];qC(h===l.shape[2],()=>"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(l.shape[2],".")),qC(xR(n,a),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(a,"'")),qC(wR(a),()=>"Error in conv2D: Dilated rates should be larger than 0."),qC(wR(n),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:c,filter:l},A={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:s},p=eB.runKernel(oN,d,A);return u?CR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const YR=dB({conv1d_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;const o=cB(e,"x","conv1d"),l=cB(t,"filter","conv1d");let c=o,u=!1;2===o.rank&&(u=!0,c=CR(o,[1,o.shape[0],o.shape[1]])),qC(3===c.rank,()=>"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")),qC(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(l.rank,".")),SR("conv1d",r,s),qC(c.shape[2]===l.shape[1],()=>"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(l.shape[1],".")),qC(xR(n,a),()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(a,"'")),qC(wR(a),()=>"Error in conv1D: Dilated rates should be larger than 0."),qC(wR(n),()=>"Error in conv1D: Stride should be larger than 0."),qC("NWC"===i,()=>"Error in conv1d: got dataFormat of ".concat(i," but only NWC is currently supported."));const h=CR(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=CR(c,[c.shape[0],1,c.shape[1],c.shape[2]]),A=XR(d,h,[1,n],r,"NHWC",[1,a],s);return CR(A,u?[A.shape[2],A.shape[3]]:[A.shape[0],A.shape[2],A.shape[3]])}});const JR=dB({conv2DBackpropInput_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0;qC(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let o=e,l=t,c=!1;3===t.rank&&(c=!0,l=CR(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),qC(4===o.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(o.length,".")),qC(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(l.rank)),qC(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank));const u="NHWC"===a?o[3]:o[1],h="NHWC"===a?l.shape[3]:l.shape[1];qC(u===n.shape[2],()=>"Error in conv2dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[2],".")),qC(h===n.shape[3],()=>"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")),SR("conv2dDerInput",i,s);const d={dy:l,filter:n},A={strides:r,pad:i,dataFormat:a,dimRoundingMode:s,inputShape:o},p=eB.runKernel(cN,d,A);return c?CR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const ZR=dB({conv2dTranspose_:function(e,t,n,r,i,a){const s=cB(e,"x","conv2dTranspose"),o=cB(t,"filter","conv2dTranspose");return JR(n,s,o,r,i,"NHWC",a)}});const $R=dB({conv3d_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const s=cB(e,"x","conv3d"),o=cB(t,"filter","conv3d");let l=s,c=!1;4===s.rank&&(c=!0,l=CR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),qC(5===l.rank,()=>"Error in conv3d: input must be rank 5, but got rank ".concat(l.rank,".")),qC(5===o.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(o.rank,".")),qC(l.shape[4]===o.shape[3],()=>"Error in conv3d: depth of input (".concat(l.shape[4],") must match ")+"input depth for filter ".concat(o.shape[3],".")),qC(xR(n,a),()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(a,"'")),qC("NDHWC"===i,()=>"Error in conv3d: got dataFormat of ".concat(i," but only NDHWC is currently supported.")),qC(wR(a),()=>"Error in conv3D: Dilated rates should be larger than 0."),qC(wR(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:o},h={strides:n,pad:r,dataFormat:i,dilations:a},d=eB.runKernel(uN,u,h);return c?CR(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const eL=dB({conv3DBackpropInput_:function(e,t,n,r,i){qC(e.length===t.rank,()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match"));let a=e,s=t,o=!1;4===t.rank&&(o=!0,s=CR(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);const l=a[4],c=s.shape[4];qC(5===a.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(a.length,".")),qC(5===s.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(s.rank)),qC(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)),qC(l===n.shape[3],()=>"Error in conv3dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[3],".")),qC(c===n.shape[4],()=>"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],"."));const u={dy:s,filter:n},h={pad:i,strides:r,inputShape:a},d=eB.runKernel(dN,u,h);return o?CR(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const tL=dB({conv3dTranspose_:function(e,t,n,r,i){const a=cB(e,"x","conv3dTranspose"),s=cB(t,"filter","conv3dTranspose");return eL(n,a,s,r,i)}});const nL=dB({cos_:function(e){const t={x:cB(e,"x","cos","float32")};return eB.runKernel(AN,t)}});const rL=dB({cosh_:function(e){const t={x:cB(e,"x","cosh","float32")};return eB.runKernel(pN,t)}});const iL=dB({cumprod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i={x:cB(e,"x","cumprod")},a={axis:t,exclusive:n,reverse:r};return eB.runKernel(fN,i,a)}});const aL=dB({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i={x:cB(e,"x","cumsum")},a={axis:t,exclusive:n,reverse:r};return eB.runKernel(gN,i,a)}});const sL=dB({denseBincount_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=cB(e,"x","denseBincount"),a=cB(t,"weights","denseBincount");qC("int32"===i.dtype,()=>"Error in denseBincount: input "+"dtype must be int32, but got ".concat(i.dtype)),qC(i.rank<=2,()=>"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(i.rank,".")),qC(n>=0,()=>"size must be non-negative, but got ".concat(n,".")),qC(a.size===i.size||0===a.size,()=>"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(i.shape,", weights shape: ")+"".concat(a.shape,"."));const s={x:i,weights:a},o={size:n,binaryOutput:r};return eB.runKernel(yN,s,o)}});const oL=dB({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const r=cB(e,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];qC(t>1,()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(t)),qC(i*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)),qC(a*t>=0,()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)),qC(s%(t*t)===0,()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(s," for depthToSpace with input shape ").concat(r.shape));const o={x:r},l={blockSize:t,dataFormat:n};return eB.runKernel(vN,o,l)}});const lL=dB({depthwiseConv2d_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const o=cB(e,"x","depthwiseConv2d","float32"),l=cB(t,"filter","depthwiseConv2d","float32");let c=o,u=!1;3===o.rank&&(u=!0,c=CR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),qC(4===c.rank,()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")),qC(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(l.rank,"."));const h="NHWC"===i?c.shape[3]:c.shape[1];qC(h===l.shape[2],()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(l.shape[2],".")),SR("depthwiseConv2d",r,s);const d={x:c,filter:l},A={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:s},p=eB.runKernel(bN,d,A);return u?CR(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const cL=dB({diag_:function(e){const t={x:cB(e,"x","diag")};return eB.runKernel(_N,t)}});const uL=dB({dilation2d_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const s=cB(e,"x","dilation2d"),o=cB(t,"filter","dilation2d");qC(3===s.rank||4===s.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(s.rank,".")),qC(3===o.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(o.rank,".")),qC("NHWC"===a,()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(a));let l=s,c=!1;3===s.rank&&(l=CR(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0),qC(l.shape[3]===o.shape[2],()=>"Error in dilation2d:  input and filter must have the same depth: ".concat(l.shape[3]," vs ").concat(o.shape[2]));const u={x:l,filter:o},h={strides:n,pad:r,dilations:i},d=eB.runKernel(SN,u,h);return c?CR(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const hL=dB({equal_:function(e,t){let n=cB(e,"a","equal","string_or_numeric"),r=cB(t,"b","equal","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(FN,i)}});const dL=dB({where_:function(e,t,n){const r=cB(t,"a","where"),i=cB(n,"b","where"),a=cB(e,"condition","where","bool"),s=nF(nF(a.shape,r.shape),i.shape),o={condition:HR(a,s),t:HR(r,s),e:HR(i,s)};return eB.runKernel(tI,o)}});const AL=dB({divNoNan_:function(e,t){let n=cB(e,"a","div"),r=cB(t,"b","div");[n,r]=WT(n,r);const i=RM(n,r),a=DM(i),s=hL(r,a);return dL(s,a,i)}});const pL=dB({dot_:function(e,t){const n=cB(e,"t1","dot"),r=cB(t,"t2","dot");qC((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,"."));const i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];if(qC(i===a,()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(i," and ").concat(a,".")),1===n.rank&&1===r.rank){const e=CR(n,[1,-1]),t=CR(r,[-1,1]),i=IR(e,t);return CR(i,[])}if(1===n.rank&&2===r.rank){const e=CR(n,[1,-1]),t=CR(r,[r.shape[0],r.shape[1]]),i=IR(e,t);return CR(i,[i.size])}if(2===n.rank&&1===r.rank){const e=CR(r,[-1,1]),t=IR(n,e);return CR(t,[t.size])}{const e=CR(r,[r.shape[0],r.shape[1]]);return IR(n,e)}}});const fL=dB({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map((e,t)=>cB(e,"tensors".concat(t),"einsum")),a={equation:e};return eB.runKernel(IN,i,a)}});const gL=dB({elu_:function(e){const t={x:cB(e,"x","elu","float32")};return eB.runKernel(TN,t)}});const mL=dB({ensureShape_:function(e,t){const n=cB(e,"x","ensureShape","string_or_numeric");if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});const yL=dB({erf_:function(e){let t=cB(e,"x","erf");qC("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=IM(t,"float32"));const n={x:t};return eB.runKernel(MN,n)}});function vL(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function bL(e,t,n){const r=e.length+t.length,i=[];let a=0,s=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?i.push(e[a++]):i.push(t[s++]);return i}function xL(e,t){const n=[],r=e.length;for(let i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map(t=>e[t])]}function wL(e,t){return bL(e,t.map(e=>1),t)}function _L(e,t,n){qC(vL(t,n),()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input."))}function SL(e,t){if(vL(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function CL(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function EL(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const NL=dB({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:cB(e,"x","max")},i={reductionIndices:t,keepDims:n};return eB.runKernel(uk,r,i)}});const kL=dB({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:cB(e,"x","min")},i={axis:t,keepDims:n};return eB.runKernel(yk,r,i)}});const IL=dB({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=cB(e,"x","sum");"bool"===r.dtype&&(r=IM(r,"int32"));const i={x:r},a={axis:t,keepDims:n};return eB.runKernel(uI,i,a)}});function TL(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return $M(e);if(1!==e.rank&&null===n)return TL(CR(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return IL($M(e),n);if(t===1/0)return NL($M(e),n);if(t===-1/0)return kL($M(e),n);if("euclidean"===t||2===t)return PM(IL(YM($M(e),jM(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return NL(IL($M(e),n[0]),n[1]-1);if(t===1/0)return NL(IL($M(e),n[1]),n[0]);if(t===-1/0)return kL(IL($M(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return PM(IL(UM(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const BL=dB({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=TL(e=cB(e,"x","norm"),t,n);let a=i.shape;if(r){const t=rE(n,e.shape);a=wL(i.shape,t)}return CR(i,a)}});const ML=dB({euclideanNorm_:function(e){return BL(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});const FL=dB({exp_:function(e){const t={x:cB(e,"x","exp")};return eB.runKernel(RN,t)}});const RL=dB({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=cB(e,"x","expandDims","string_or_numeric");qC(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:t};return eB.runKernel(LN,r,i)}});const LL=dB({expm1_:function(e){const t={x:cB(e,"x","expm1")};return eB.runKernel(PN,t)}});const PL=dB({tile_:function(e,t){const n=cB(e,"x","tile","string_or_numeric");qC(n.rank===t.length,()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,"."));const r={x:n},i={reps:t};return eB.runKernel(II,r,i)}});const UL=dB({eye_:function(e,t,n){null==t&&(t=e);const r=kM([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),i=e<=t?e:t;for(let s=0;s<i;++s)r.set(1,s,s);const a=CR(r.toTensor(),[e,t]);if(null==n)return a;if(1===n.length)return PL(RL(a,0),[n[0],1,1]);if(2===n.length)return PL(RL(RL(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return PL(RL(RL(RL(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});const DL=dB({floor_:function(e){const t={x:cB(e,"x","floor","float32")};return eB.runKernel(jN,t)}});const OL=dB({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i={x:cB(e,"x","gather"),indices:cB(t,"indices","gather","int32")},a={axis:n,batchDims:r};return eB.runKernel(QN,i,a)}});const jL=dB({greater_:function(e,t){let n=cB(e,"a","greater","string_or_numeric"),r=cB(t,"b","greater","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(GN,i)}});const zL=dB({greaterEqual_:function(e,t){let n=cB(e,"a","greaterEqual","string_or_numeric"),r=cB(t,"b","greaterEqual","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(WN,i)}});const HL=dB({imag_:function(e){const t={input:cB(e,"input","imag")};return eB.runKernel(XN,t)}});const QL=dB({isFinite_:function(e){const t={x:cB(e,"x","isFinite")};return eB.runKernel(YN,t)}});const VL=dB({isInf_:function(e){const t={x:cB(e,"x","isInf")};return eB.runKernel(JN,t)}});const GL=dB({isNaN_:function(e){const t={x:cB(e,"x","isNaN")};return eB.runKernel(ZN,t)}});const WL=dB({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:cB(e,"x","leakyRelu")},r={alpha:t};return eB.runKernel($N,n,r)}});const qL=dB({less_:function(e,t){let n=cB(e,"a","less","string_or_numeric"),r=cB(t,"b","less","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(ek,i)}});const KL=dB({lessEqual_:function(e,t){let n=cB(e,"a","lessEqual","string_or_numeric"),r=cB(t,"b","lessEqual","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(tk,i)}});function XL(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return eB.runKernel(nk,{},r)}const YL=dB({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const a=cB(e,"x","localResponseNormalization");qC(4===a.rank||3===a.rank,()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(a.rank,".")),qC(ZC(t),()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,"."));let s=a,o=!1;3===a.rank&&(o=!0,s=CR(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const l={x:s},c={depthRadius:t,bias:n,alpha:r,beta:i},u=eB.runKernel(lk,l,c);return o?CR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const JL=dB({log_:function(e){const t={x:cB(e,"x","log","float32")};return eB.runKernel(rk,t)}});const ZL=dB({log1p_:function(e){const t={x:cB(e,"x","log1p")};return eB.runKernel(ik,t)}});const $L=dB({neg_:function(e){const t={x:cB(e,"x","neg")};return eB.runKernel(Sk,t)}});const eP=dB({softplus_:function(e){const t={x:cB(e,"x","softplus")};return eB.runKernel(lI,t)}});const tP=dB({logSigmoid_:function(e){const t=cB(e,"x","logSigmoid"),n=OM(e=>({value:$L(eP($L(e))),gradFunc:t=>LM(t,TR($L(e)))}));return n(t)}});const nP=dB({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=cB(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const r=OM((e,n)=>{const r=NL(e,t,!0),i=JM(e,r),a=JM(IM(i,"float32"),JL(IL(FL(i),t,!0)));n([a]);return{value:a,gradFunc:(e,n)=>{const[r]=n,i=FL(r);return JM(e,LM(IL(e,t,!0),i))}}});return r(n)}});const rP=dB({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=cB(e,"x","logSumExp"),i=rE(t,r.shape),a=NL(r,i,!0),s=JM(r,a),o=FL(s),l=IL(o,i),c=JL(l),u=MM(CR(a,c.shape),c);if(n){const e=wL(u.shape,i);return CR(u,e)}return u}});const iP=dB({logicalAnd_:function(e,t){const n=cB(e,"a","logicalAnd","bool"),r=cB(t,"b","logicalAnd","bool");nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(ak,i)}});const aP=dB({logicalNot_:function(e){const t={x:cB(e,"x","logicalNot","bool")};return eB.runKernel(sk,t)}});const sP=dB({logicalOr_:function(e,t){const n=cB(e,"a","logicalOr","bool"),r=cB(t,"b","logicalOr","bool");nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(ok,i)}});const oP=dB({logicalXor_:function(e,t){const n=cB(e,"a","logicalXor","bool"),r=cB(t,"b","logicalXor","bool");return nF(n.shape,r.shape),iP(sP(e,t),aP(iP(e,t)))}}),lP=2147483648;const cP=dB({searchSorted_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left";const r=cB(e,"sortedSequence","searchSorted"),i=cB(t,"values","searchSorted"),a=r.shape[r.shape.length-1],s=i.shape[i.shape.length-1],o=CR(r,[-1,a]),l=CR(i,[-1,s]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(YC(l.shape)>=lP)throw new Error("values tensor size must less than ".concat(lP));if(o.shape[1]>=lP)throw new Error("trailing dim_size must less than ".concat(lP," for int32 output type, was ").concat(o.shape[1]));const c={sortedSequence:o,values:l},u={side:n};return eB.runKernel(eI,c,u)}});function uP(e,t){return cP(e,t,"left")}const hP=dB({maxPool_:function(e,t,n,r,i){const a=cB(e,"x","maxPool");let s=a,o=!1;3===a.rank&&(o=!0,s=CR(a,[1,a.shape[0],a.shape[1],a.shape[2]])),qC(4===s.rank,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")),qC(xR(n,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")),SR("maxPool",r,i);const l={x:s},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},u=eB.runKernel(dk,l,c);return o?CR(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const dP=dB({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC";const s=cB(e,"x","maxPool3d");let o=s,l=!1;4===s.rank&&(l=!0,o=CR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),qC(5===o.rank,()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(o.rank,".")),qC("NDHWC"===a,()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(a)),SR("maxPool3d",r,i);const c={x:o},u={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a},h=eB.runKernel(pk,c,u);return l?CR(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});const AP=dB({maxPoolWithArgmax_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a={x:cB(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},o=eB.runKernel(gk,a,s);return{result:o[0],indexes:o[1]}}});const pP=dB({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:cB(e,"x","mean")},i={axis:t,keepDims:n};return eB.runKernel(mk,r,i)}});function fP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(bE(e),"complex64"===t){const t=fP(e,"float32"),n=fP(e,"float32");return AB(t,n)}const n=yE(YC(e),t);return eB.makeTensor(n,e,t)}function gP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(bE(e),"complex64"===t){const t=gP(e,"float32"),n=fP(e,"float32");return AB(t,n)}const n=mE(YC(e),t);return eB.makeTensor(n,e,t)}function mP(e,t){let{indexing:n="xy"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("xy"!==n&&"ij"!==n)throw new TypeError("".concat(n," is not a valid third argument to meshgrid"));if(void 0===e)return[];let r=cB(e,"x","meshgrid",e instanceof FT?e.dtype:"float32");if(void 0===t)return[r];let i=cB(t,"y","meshgrid",t instanceof FT?t.dtype:"float32");const a=YC(r.shape),s=YC(i.shape);return"xy"===n?(r=CR(r,[1,-1]),i=CR(i,[-1,1]),[IR(gP([s,1],r.dtype),r),IR(i,gP([1,a],i.dtype))]):(r=CR(r,[-1,1]),i=CR(i,[1,-1]),[IR(r,gP([1,s],r.dtype)),IR(gP([a,1],i.dtype),i)])}const yP=dB({minimum_:function(e,t){let n=cB(e,"a","minimum"),r=cB(t,"b","minimum");[n,r]=WT(n,r),"bool"===n.dtype&&(n=IM(n,"int32"),r=IM(r,"int32")),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(vk,i)}});const vP=dB({mirrorPad_:function(e,t,n){qC("reflect"===n||"symmetric"===n,()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,"."));const r=cB(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");qC(t.length===r.rank,()=>"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,"."));const i="reflect"===n?1:0;for(let o=0;o<r.rank;o++)qC(2===t[o].length,()=>"Invalid number of paddings. Must be length of 2 each."),qC(t[o][0]>=0&&t[o][0]<=r.shape[o]-i&&t[o][1]>=0&&t[o][1]<=r.shape[o]-i,()=>"Padding in dimension ".concat(o," cannot be greater than or equal ")+"to ".concat(r.shape[o]-i," or less than 0 for input of ")+"shape ".concat(r.shape));const a={paddings:t,mode:n},s={x:r};return eB.runKernel(bk,s,a)}});const bP=dB({mod_:function(e,t){let n=cB(e,"a","mod"),r=cB(t,"b","mod");[n,r]=WT(n,r);const i={a:n,b:r};return eB.runKernel(xk,i)}});const xP=dB({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=rE(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=cB(e,"x","moments")).shape),r=pP(e,n,t);let i=r.shape;t||(i=wL(r.shape,n));const a=UM(JM(IM(e,"float32"),CR(r,i)));return{mean:r,variance:pP(a,n,t)}}});const wP=dB({multiRNNCell_:function(e,t,n,r){const i=cB(t,"data","multiRNNCell"),a=uB(n,"c","multiRNNCell"),s=uB(r,"h","multiRNNCell");let o=i;const l=[];for(let h=0;h<e.length;h++){const t=e[h](o,a[h],s[h]);l.push(t[0]),l.push(t[1]),o=t[1]}const c=[],u=[];for(let h=0;h<l.length;h+=2)c.push(l[h]),u.push(l[h+1]);return[c,u]}});const _P=dB({multinomial_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=cB(e,"logits","multinomial"),a=i.size,s=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(a,"."));if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(s));n=n||Math.random();const o={logits:1===s?CR(i,[1,-1]):i},l={numSamples:t,seed:n,normalized:r},c=eB.runKernel(wk,o,l);return 1===s?CR(c,[c.size]):c}});const SP=dB({notEqual_:function(e,t){let n=cB(e,"a","notEqual","string_or_numeric"),r=cB(t,"b","notEqual","string_or_numeric");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(Ck,i)}});const CP=dB({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const a={indices:cB(e,"indices","oneHot","int32")},s={dtype:i,depth:t,onValue:n,offValue:r};return eB.runKernel(Tk,a,s)}});const EP=dB({onesLike_:function(e){const t={x:cB(e,"x","onesLike")};return eB.runKernel(Ik,t)}});const NP=dB({outerProduct_:function(e,t){const n=cB(e,"v1","outerProduct"),r=cB(t,"v2","outerProduct");qC(1===n.rank&&1===r.rank,()=>"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,"."));const i=CR(n,[-1,1]),a=CR(r,[1,-1]);return IR(i,a)}});const kP=dB({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=cB(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:n},a={x:r};return eB.runKernel(Mk,a,i)}});const IP=dB({pad1d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return qC(2===t.length,()=>"Invalid number of paddings. Must be length of 2."),kP(e,[t],n)}});const TP=dB({pad2d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return qC(2===t.length&&2===t[0].length&&2===t[1].length,()=>"Invalid number of paddings. Must be length of 2 each."),kP(e,t,n)}});const BP=dB({pad3d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return qC(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,()=>"Invalid number of paddings. Must be length of 2 each."),kP(e,t,n)}});const MP=dB({pad4d_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return qC(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,()=>"Invalid number of paddings. Must be length of 2 each."),kP(e,t,n)}});const FP=dB({spaceToBatchND_:function(e,t,n){const r=cB(e,"x","spaceToBatchND");qC(r.rank>=1+t.length,()=>"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)),qC(n.length===t.length,()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)),qC(r.shape.reduce((e,r,i)=>i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]===0:e,!0),()=>"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString()));const i={x:r},a={blockShape:t,paddings:n};return eB.runKernel(hI,i,a)}});const RP=dB({pool_:function(e,t,n,r,i,a,s){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");const o=cB(e,"x","maxPool");let l=o,c=!1;3===o.rank&&(c=!0,l=CR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),qC(xR(a,i),()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(i,"'"));const u=hR(l.shape,t,a,i,r),h=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(e,t){const n=e.map((e,n)=>e+(e-1)*(t[n]-1)),r=n.map(e=>e-1),i=r.map(e=>Math.floor(e/2)),a=r.map((e,t)=>e-i[t]);return r.map((e,t)=>[i[t],a[t]])}([u.filterHeight,u.filterWidth],h):[[0,0],[0,0]];const A=1===h[0]&&1===h[1],[p,f]=function(e,t,n){const r=n.map(e=>e[0]),i=n.map(e=>e[1]),a=e.concat(r,i),s=t.map((e,t)=>(e-a[t]%e)%e),o=i.map((e,t)=>e+s[t]),l=t.map((e,t)=>[r[t],o[t]]),c=t.map((e,t)=>[0,s[t]]);return[l,c]}([u.inHeight,u.inWidth],h,d),g=A?r:"valid",m=A?l:FP(l,h,p),y=("avg"===n?()=>ER(m,t,a,g,s):()=>hP(m,t,a,g,s))(),v=A?y:RR(y,h,f);return c?CR(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});const LP=dB({prelu_:function(e,t){const n={x:cB(e,"x","prelu"),alpha:cB(t,"alpha","prelu")};return eB.runKernel(Rk,n)}});const PP=dB({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=cB(e,"x","prod");"bool"===r.dtype&&(r=IM(r,"int32"));const i={x:r},a={axis:t,keepDims:n};return eB.runKernel(Lk,i,a)}});const UP=dB({raggedGather_:function(e,t,n,r){const i=e.map((e,t)=>cB(e,"tensors".concat(t),"raggedGather","int32")),a={paramsNestedSplits:i,paramsDenseValues:cB(t,"paramsDenseValues","raggedGather"),indices:cB(n,"indices","raggedGather","int32")},s={outputRaggedRank:r},o=eB.runKernel(Pk,a,s);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});const DP=dB({raggedRange_:function(e,t,n){const r=cB(e,"starts","raggedRange"),i={starts:r,limits:cB(t,"limits","raggedRange",r.dtype),deltas:cB(n,"deltas","raggedRange",r.dtype)},a=eB.runKernel(Uk,i);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}});const OP=dB({raggedTensorToTensor_:function(e,t,n,r,i){const a=cB(e,"shape","raggedTensorToTensor","int32"),s=cB(t,"values","raggedTensorToTensor"),o=cB(n,"defaultValue","raggedTensorToTensor",s.dtype),l=r.map((e,t)=>cB(e,"tensors".concat(t),"raggedTensorToTensor","int32")),c={shape:a,values:s,defaultValue:o,rowPartitionTensors:l},u={rowPartitionTypes:i};return eB.runKernel(Dk,c,u)}});const jP=dB({rand_:function(e,t,n){bE(e);const r=YC(e);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));i=new Uint8Array(r)}for(let a=0;a<r;a++)i[a]=t();return eB.makeTensor(i,e,n)}});var zP=n(4334);class HP{constructor(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const a=i||Math.random();this.random=zP.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,i,a;do{r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i}while(a>=1||0===a);const s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class QP{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const i=r||Math.random();this.randu=zP.alea(i.toString()),this.randn=new HP(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,i,a;for(;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-a+Math.log(a)),i=this.randu(),i<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class VP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"===typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=zP.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const GP=dB({randomGamma_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",i=arguments.length>4?arguments[4]:void 0;if(bE(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));const a=new QP(t,n,r,i),s=kM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=a.nextValue();return s.toTensor()}});const WP=dB({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(bE(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));const a=new HP(t,n,r,!1,i),s=kM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=a.nextValue();return s.toTensor()}});const qP=dB({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return WP(e,0,1,t,n)}});const KP=dB({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",i=arguments.length>4?arguments[4]:void 0;bE(e);const a=kM(e,r),s=new VP(t,n,null,i);for(let o=0;o<a.values.length;o++)a.values[o]=s.nextValue();return a.toTensor()}});const XP=dB({randomUniformInt_:function(e,t,n,r){return KP(e,t,n,"int32",r)}});function YP(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:r};return eB.runKernel(Ok,{},i)}const JP=dB({real_:function(e){const t={input:cB(e,"input","real")};return eB.runKernel(jk,t)}});const ZP=dB({reciprocal_:function(e){const t={x:cB(e,"x","reciprocal")};return eB.runKernel(zk,t)}});const $P=dB({relu_:function(e){const t={x:cB(e,"x","relu")};return eB.runKernel(Hk,t)}});const eU=dB({relu6_:function(e){const t={x:cB(e,"x","relu6")};return eB.runKernel(Kk,t)}});const tU=dB({reverse_:function(e,t){const n={x:cB(e,"x","reverse")},r={dims:t};return eB.runKernel(Xk,n,r)}});const nU=dB({reverse1d_:function(e){const t=cB(e,"x","reverse");return qC(1===t.rank,()=>"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")),tU(t,0)}});const rU=dB({reverse2d_:function(e,t){const n=cB(e,"x","reverse");return qC(2===n.rank,()=>"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")),tU(n,t)}});const iU=dB({reverse3d_:function(e,t){const n=cB(e,"x","reverse");return qC(3===n.rank,()=>"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")),tU(n,t)}});const aU=dB({reverse4d_:function(e,t){const n=cB(e,"x","reverse");return qC(4===n.rank,()=>"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")),tU(n,t)}});const sU=dB({round_:function(e){const t={x:cB(e,"x","round")};return eB.runKernel(Yk,t)}});const oU=dB({rsqrt_:function(e){const t={x:cB(e,"x","rsqrt","float32")};return eB.runKernel(Jk,t)}});const lU=dB({selu_:function(e){const t={x:cB(e,"x","selu")};return eB.runKernel(nI,t)}});const cU=dB({separableConv2d_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const o=cB(e,"x","separableConv2d"),l=cB(t,"depthwiseFilter","separableConv2d"),c=cB(n,"pointwiseFilter","separableConv2d");let u=o,h=!1;if(3===o.rank&&(h=!0,u=CR(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");qC(4===u.rank,()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,".")),qC(4===l.rank,()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),qC(4===c.rank,()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(l.rank,".")),qC(1===c.shape[0],()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")),qC(1===c.shape[1],()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],"."));const d=l.shape[2],A=l.shape[3];qC(c.shape[2]===d*A,()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*A,", ")+"but got ".concat(c.shape[2],"."));const p=lL(u,l,r,i,s,a),f=XR(p,c,1,"valid",s);return h?CR(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const uU=async function(e,t){const n=cB(e,"x","setdiff1d"),r=cB(t,"y","setdiff1d");qC(n.dtype===r.dtype,()=>"x and y should have the same dtype, but got x (".concat(n.dtype,") and y (").concat(r.dtype,").")),qC(1===n.rank,()=>"x should be 1D tensor, but got x (".concat(n.shape,").")),qC(1===r.rank,()=>"y should be 1D tensor, but got y (".concat(r.shape,")."));const i=await n.data(),a=await r.data(),s=new Set(a);let o=0;for(let u=0;u<i.length;u++)s.has(i[u])||o++;const l=new IT([o],n.dtype),c=new IT([o],"int32");for(let u=0,h=0;u<i.length;u++)s.has(i[u])||(l.values[h]=i[u],c.values[h]=u,h++);return[l.toTensor(),c.toTensor()]};const hU=dB({sign_:function(e){const t={x:cB(e,"x","sign")};return eB.runKernel(sI,t)}});const dU=dB({sin_:function(e){const t={x:cB(e,"x","sin","float32")};return eB.runKernel(iI,t)}});const AU=dB({sinh_:function(e){const t={x:cB(e,"x","sinh")};return eB.runKernel(aI,t)}});const pU=dB({slice1d_:function(e,t,n){const r=cB(e,"x","slice1d");return qC(1===r.rank,()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")),BR(r,[t],[n])}});const fU=dB({slice2d_:function(e,t,n){const r=cB(e,"x","slice2d");return qC(2===r.rank,()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")),BR(r,t,n)}});const gU=dB({slice3d_:function(e,t,n){const r=cB(e,"x","slice3d");return qC(3===r.rank,()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")),BR(r,t,n)}});const mU=dB({slice4d_:function(e,t,n){const r=cB(e,"x","slice4d");return qC(4===r.rank,()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")),BR(r,t,n)}});const yU=dB({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=cB(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const r={logits:n},i={dim:t};return eB.runKernel(AI,r,i)}});const vU=dB({fft_:function(e){qC("complex64"===e.dtype,()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return eB.runKernel(UN,t)}});const bU=dB({ifft_:function(e){qC("complex64"===e.dtype,()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,"."));const t={input:e};return eB.runKernel(KN,t)}});const xU=dB({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=CR(e,[n,t]);r=bU(i)}else{const i=[n,2*(t-1)],a=CR(JP(e),[n,t]),s=CR(HL(e),[n,t]),o=tU(BR(a,[0,1],[n,t-2]),1),l=LM(tU(BR(s,[0,1],[n,t-2]),1),jM(-1)),c=kR([a,o],1),u=kR([s,l],1),h=CR(AB(c,u),[i[0],i[1]]);r=bU(h)}if(r=JP(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=CR(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});const wU=dB({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={x:cB(e,"x","split")},i={numOrSizeSplits:t,axis:n};return eB.runKernel(dI,r,i)}});const _U=dB({rfft_:function(e,t){qC("float32"===e.dtype,()=>"The dtype for rfft() must be real value but got ".concat(e.dtype));let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(null!=t&&t<n){const r=e.shape.map(e=>0),a=e.shape.map(e=>e);a[e.shape.length-1]=t,i=BR(e,r,a),n=t}else if(null!=t&&t>n){const r=e.shape.map(e=>e);r[e.shape.length-1]=t-n,i=kR([e,fP(r)],e.shape.length-1),n=t}else i=e;const a=DM(i),s=CR(AB(i,a),[r,n]),o=vU(s),l=Math.floor(n/2)+1,c=JP(o),u=HL(o),h=wU(c,[l,n-l],c.shape.length-1),d=wU(u,[l,n-l],u.shape.length-1),A=i.shape.slice();return A[i.shape.length-1]=l,CR(AB(h[0],d[0]),A)}});const SU=dB({squaredDifference_:function(e,t){let n=cB(e,"a","squaredDifference"),r=cB(t,"b","squaredDifference");[n,r]=WT(n,r),nF(n.shape,r.shape);const i={a:n,b:r};return eB.runKernel(vI,i,{})}});const CU=dB({squeeze_:function(e,t){const n=cB(e,"x","squeeze","string_or_numeric");return CR(n,iE(n.shape,t).newShape)}});const EU=dB({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=uB(e,"tensors","stack","string_or_numeric");qC(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&qC(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:t};return eB.runKernel(Bk,r,i)}});const NU=dB({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:cB(e,"x","step")},r={alpha:t};return eB.runKernel(UI,n,r)}});const kU=dB({stridedSlice_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const c={x:cB(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:r,beginMask:i,endMask:a,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:l};return eB.runKernel(wI,c,u)}});const IU=dB({tan_:function(e){const t={x:cB(e,"x","tan","float32")};return eB.runKernel(NI,t)}});function TU(e,t){XC(e);const n=sB(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pB(e,null,n,t)}function BU(e,t,n){if(XC(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=sB(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pB(e,t,r,n)}function MU(e,t,n){if(XC(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=sB(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return pB(e,t,r,n)}function FU(e,t,n){if(XC(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=sB(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return pB(e,t,r,n)}function RU(e,t,n){if(XC(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=sB(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return pB(e,t=t||r,r,n)}function LU(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(i,".");if(n.rank<i)throw new Error(a+" update.rank < ".concat(i,". "));if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < ".concat(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != ".concat(i+e.length-r));for(let s=0;s<i;++s)if(n.shape[s]!==t.shape[s])throw new Error(a+" updates.shape[".concat(s,"] (").concat(n.shape[s],") != indices.shape[").concat(s,"] (").concat(t.shape[s],")."));for(let s=0;s<n.rank-i;++s)if(n.shape[s+i]!==e[s+r])throw new Error(a+" updates.shape[".concat(s+i,"] (").concat(n.shape[s+i],") != shape[").concat(s+i,"] (").concat(e[s+i],")"))}function PU(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}LU(n,t,e)}function UU(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length;let s=1;for(let l=i;l<a;++l)s*=n[l];const o=i<1?1:i;return{sliceRank:i,numUpdates:YC(t.shape)/o,sliceSize:s,strides:[...pE(n.slice(0,i)),1],outputSize:YC(n)}}const DU=dB({tensorScatterUpdate_:function(e,t,n){const r=cB(e,"tensor","tensorScatterupdate"),i=cB(t,"indices","tensorScatterupdate","int32"),a=cB(n,"updates","tensorScatterupdate");if(PU(a,i,r.shape),r.dtype!==a.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(r.dtype," and ").concat(a.dtype,"."));const s={tensor:r,indices:i,updates:a};return eB.runKernel($k,s,{})}});const OU=dB({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=cB(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(i,") ")+"but got ".concat(t));const a={x:r},s={k:t,sorted:n},[o,l]=eB.runKernel(TI,a,s);return{values:o,indices:l}}});const jU=dB({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(bE(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const a=new HP(t,n,r,!0,i),s=kM(e,r);for(let o=0;o<s.values.length;o++)s.values[o]=a.nextValue();return s.toTensor()}});const zU=dB({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=cB(e,"x","unique","string_or_numeric");qC(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[a,s]=eB.runKernel(FI,r,i);return{values:a,indices:s}}});const HU=dB({unsortedSegmentSum_:function(e,t,n){const r=cB(e,"x","unsortedSegmentSum"),i=cB(t,"segmentIds","unsortedSegmentSum","int32");qC(ZC(n),()=>"numSegments must be of dtype int");const a={x:r,segmentIds:i},s={numSegments:n};return eB.runKernel(LI,a,s)}});const QU=dB({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=cB(e,"x","unstack","string_or_numeric");qC(t>=-n.shape.length&&t<n.shape.length,()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")"));const r={value:n},i={axis:t};return eB.runKernel(RI,r,i)}});function VU(e,t){return cP(e,t,"right")}function GU(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return eB.makeVariable(e,t,n,r)}function WU(e,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const r=kM(e,"int32"),i=kM([n.length,e.length],"int32");for(let a=0;a<n.length;a++){const t=r.indexToLoc(n[a]),s=a*e.length;i.values.set(t,s)}return i.toTensor()}const qU=async function(e){const t=cB(e,"condition","whereAsync","bool"),n=await t.data(),r=WU(t.shape,n);return e!==t&&t.dispose(),r};const KU=async function(e,t,n){const r=cB(e,"tensor","boolMask"),i=cB(t,"mask","boolMask","bool"),a=null==n?0:n,s=i.rank,o=r.shape;qC(s>0,()=>"mask cannot be scalar"),KC(o.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let f=a;f<a+s;f++)l*=o[f];const c=o.slice(0,a).concat([l],o.slice(a+s)),u=CR(r,c),h=CR(i,[-1]),d=await qU(h),A=CU(d,[1]),p=OL(u,A,a);return e!==r&&r.dispose(),t!==i&&i.dispose(),A.dispose(),u.dispose(),h.dispose(),d.dispose(),p};const XU=dB({transpose_:function(e,t,n){const r=cB(e,"x","transpose");if(null==t&&(t=r.shape.map((e,t)=>t).reverse()),qC(r.rank===t.length,()=>"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")),t.forEach(e=>{qC(e>=0&&e<r.rank,()=>"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t))}),r.rank<=1)return r.clone();const i={x:r},a={perm:t};return"complex64"===r.dtype?bB(()=>{let e=JP(r),t=HL(r);return e=eB.runKernel(MI,{x:e},a),t=eB.runKernel(MI,{x:t},a),n&&(t=$L(t)),AB(e,t)}):eB.runKernel(MI,i,a)}});const YU=dB({movingAverage_:function(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=cB(e,"v","movingAverage"),s=cB(t,"x","movingAverage"),o=cB(n,"decay","movingAverage");!function(e,t){qC(e.dtype===t.dtype,()=>"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match"))}(a,s),qC(JC(a.shape,s.shape),()=>"Shape mismatch in v and x");const l=jM(1),c=JM(l,o);let u=LM(JM(s,a),c);if(i){qC(null!=r,()=>"When using zeroDebias: true, step is required.");const e=cB(r,"step","movingAverage");u=RM(u,JM(l,YM(o,e)))}return MM(a,u)}});const JU=dB({scatterND_:function(e,t,n){bE(n);const r=cB(e,"indices","scatterND","int32"),i=cB(t,"updates","scatterND");PU(i,r,n);const a={indices:r,updates:i},s={shape:n};return eB.runKernel(Zk,a,s)}});const ZU=dB({sparseToDense_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;bE(n);const i=cB(e,"sparseIndices","sparseToDense","int32"),a=cB(t,"sparseValues","sparseToDense","string_or_numeric"),s=cB(r,"defaultValue","sparseToDense",a.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));const i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(a,"."));const s=t.size;if(0!==t.rank&&(1!==t.rank||s!==i))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(i,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,s);const o={sparseIndices:i,sparseValues:a,defaultValue:s},l={outputShape:n};return eB.runKernel(yI,o,l)}});const $U=dB({gatherND_:function(e,t){const n=cB(t,"indices","gatherND","int32"),r={params:cB(e,"x","gatherND","string_or_numeric"),indices:n};return eB.runKernel(VN,r)}});const eD=dB({dropout_:function(e,t,n,r){const i=cB(e,"x","dropout");if(qC("float32"===i.dtype,()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(i.dtype," tensor instead.")),qC(t>=0&&t<1,()=>"rate must be a float in the range [0, 1), but got ".concat(t,".")),0===t)return e instanceof FT?i.clone():i;const a=function(e,t){if(null==t)return e.shape.slice();if(JC(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),s=1-t,o=RM(DL(MM(KP(a,0,1,"float32",r),s)),s);return LM(i,o)}});function tD(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function nD(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let a=0;a<e;++a){const s=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(s)}return TU(i,"float32")}const rD=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=cB(e,"predictions","inTopK"),i=cB(t,"targets","inTopK");qC(r.rank>1,()=>"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)),qC(r.rank-1===i.rank,()=>"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(i.rank)),KC(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=r.shape[r.shape.length-1];qC(n>0&&n<=a,()=>"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(a,"), but got ").concat(n));const s=await r.data(),o=await i.data(),[l,c]=[s.length/a,a],u=aE("bool",l);for(let h=0;h<l;h++){const e=h*c,t=s.subarray(e,e+c),r=[];for(let n=0;n<t.length;n++)r.push({value:t[n],index:n});r.sort((e,t)=>t.value-e.value),u[h]=0;for(let i=0;i<n;i++)if(r[i].index===o[h]){u[h]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),fB(u,i.shape,"bool")};const iD=dB({conv2DBackpropFilter_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=CR(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=CR(t,[1,t.shape[0],t.shape[1],t.shape[2]])),qC(4===o.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(o.shape,".")),qC(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(l.shape,".")),qC(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,"."));const c="NHWC"===a?o.shape[3]:o.shape[1],u="NHWC"===a?l.shape[3]:l.shape[1];qC(c===n[2],()=>"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")),qC(u===n[3],()=>"Error in conv2dDerFilter: depth of dy (".concat(u,") must ")+"match output depth for filter (".concat(n[3],").")),SR("conv2dDerFilter",i,s);const h={x:o,dy:l},d={strides:r,pad:i,dataFormat:a,dimRoundingMode:s,filterShape:n};return eB.runKernel(lN,h,d)}});function aD(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return LM(e,NU(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function sD(e,t){let n=t;const r=tF(e.shape,t.shape);return r.length>0&&(n=IL(n,r)),CR(n,e.shape)}function oD(e,t,n,r){if("linear"===t)return e;if("relu"===t)return $P(e);if("elu"===t)return gL(e);if("relu6"===t)return eU(e);if("prelu"===t)return LP(e,n);if("leakyrelu"===t)return WL(e,r);if("sigmoid"===t)return TR(e);throw new Error("Unknown fused activation ".concat(t,"."))}const lD=(e,t)=>!(e>0)||"linear"===t;const cD=dB({fusedConv2d_:function(e){let{x:t,filter:n,strides:r,pad:i,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(c=c||"linear",!1===lD(eB.state.gradientDepth,c)){qC("NHWC"===a,()=>"Error in fused conv2d: got dataFormat of ".concat(a," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.");let e=XR(t,n,r,i,a,s,o);return null!=l&&(e=MM(e,l)),oD(e,c,u,h)}const d=cB(t,"x","conv2d","float32"),A=cB(n,"filter","conv2d","float32");let p=d,f=!1;3===d.rank&&(f=!0,p=CR(d,[1,d.shape[0],d.shape[1],d.shape[2]])),qC(4===p.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(p.rank,".")),qC(4===A.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(A.rank,".")),SR("fused conv2d",i,o);const g="NHWC"===a?p.shape[3]:p.shape[1];qC(A.shape[2]===g,()=>"Error in conv2d: depth of input (".concat(g,") must match ")+"input depth for filter ".concat(A.shape[2],".")),qC(xR(r,s),()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(s,"'"));const m=AR(p.shape,A.shape,r,s,i,o);let y,v;if(null!=l&&(y=cB(l,"bias","fused conv2d"),[y]=WT(y,d),"NHWC"===a?nF(m.outShape,y.shape):(qC(y.shape.length<=1,()=>"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(y.shape.length,".")),qC(0===y.shape.length||y.shape[0]===m.outChannels||1===y.shape[0],()=>"Error in fused conv2d: bias shape (".concat(y.shape,") is not ")+"compatible with the number of output channels "+"(".concat(m.outChannels,")")))),null!=u){const e=u.shape;if(qC(e.length<=1||3===e.length,()=>"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(e.length,".")),1===e.length)qC(1===e[0]||e[0]===m.outChannels,()=>"Error in fused conv2d: PReLU activation weights "+"(".concat(e,") is not compatible with the number of output ")+"channels (".concat(m.outChannels,")."));else if(3===e.length)try{nF(e,m.outShape)}catch(_){const t="Error in fused conv2d: PReLU activation weights (".concat(e,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(m.outShape,").");throw Error(t)}v=cB(u,"prelu weights","fused conv2d")}const b=(e,t)=>{qC("NHWC"===a,()=>"Error in gradient of fused conv2D: got dataFormat of ".concat(a," but only NHWC is currently supported."));const[n,o,l,u]=t,h=aD(e,l,c);qC(bR(s),()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(s,"'"));const d=[JR(o.shape,h,n,r,i),iD(o,h,n.shape,r,i)];if(null!=u){const e=sD(u,h);d.push(e)}return d},x={x:p,filter:A,bias:y,preluActivationWeights:v},w={strides:r,pad:i,dataFormat:a,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:h};if(null==l){const e=OM((e,t,n)=>{let r=eB.runKernel(zI,x,w);return n([t,e,r]),f&&(r=CR(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}});return e(p,A)}{const e=OM((e,t,n,r)=>{let i=eB.runKernel(zI,x,w);return r([t,e,i,n]),f&&(i=CR(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}});return e(p,A,y)}}});const uD=dB({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,o=e;3===e.rank&&(o=CR(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=CR(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={x:o,dy:l},u={strides:r,pad:i,dimRoundingMode:s,dilations:a,filterShape:n};return eB.runKernel(xN,c,u)}});const hD=dB({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,o=t,l=!1;3===t.rank&&(l=!0,o=CR(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const c={dy:o,filter:n},u={strides:r,pad:i,dimRoundingMode:s,dilations:a,inputShape:e},h=eB.runKernel(wN,c,u);return l?CR(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const dD=dB({fusedDepthwiseConv2d_:function(e){let{x:t,filter:n,strides:r,pad:i,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(!1===lD(eB.state.gradientDepth,c)){let e=lL(t,n,r,i,a,s,o);return null!=l&&(e=MM(e,l)),oD(e,c,u,h)}const d=cB(t,"x","depthwiseConv2d","float32"),A=cB(n,"filter","depthwiseConv2d","float32");let p=d,f=!1;3===d.rank&&(f=!0,p=CR(d,[1,d.shape[0],d.shape[1],d.shape[2]])),qC(4===p.rank,()=>"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(p.rank,".")),qC(4===A.rank,()=>"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(A.rank,".")),qC(p.shape[3]===A.shape[2],()=>"Error in fused depthwiseConv2d: number of input channels "+"(".concat(p.shape[3],") must match the inChannels dimension in ")+"filter ".concat(A.shape[2],".")),null==s&&(s=[1,1]),qC(xR(r,s),()=>"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(s,"'")),SR("fused depthwiseConv2d",i,o);const g=AR(p.shape,A.shape,r,s,i,o,!0);let m,y;null!=l&&(m=cB(l,"bias","fused conv2d"),[m]=WT(m,d),nF(g.outShape,m.shape)),null!=u&&(y=cB(u,"prelu weights","fused depthwiseConv2d"));const v=(e,t)=>{qC(bR(s),()=>"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'"));const[n,a,l,u]=t,h=aD(e,l,c),d=hD(a.shape,h,n,r,i,s,o),A=uD(a,h,n.shape,r,i,s,o);if(null!=u){return[d,A,sD(m,h)]}return[d,A]},b={x:p,filter:A,bias:m,preluActivationWeights:y},x={strides:r,pad:i,dataFormat:a,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:h};if(null==l){const e=OM((e,t,n)=>{let r=eB.runKernel(HI,b,x);return n([t,e,r]),f&&(r=CR(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}});return e(p,A)}{const e=OM((e,t,n,r)=>{let i=eB.runKernel(HI,b,x);return r([t,e,i,n]),f&&(i=CR(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}});return e(p,A,m)}}});const AD=dB({fusedMatMul_:function(e){let{a:t,b:n,transposeA:r=!1,transposeB:i=!1,bias:a,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}=e;if(!1===lD(eB.state.gradientDepth,s)){let e=IR(t,n,r,i);return null!=a&&(e=MM(e,a)),oD(e,s,o,l)}let c=cB(t,"a","fused matMul"),u=cB(n,"b","fused matMul");[c,u]=WT(c,u);const h=r?c.shape[c.rank-2]:c.shape[c.rank-1],d=i?u.shape[u.rank-1]:u.shape[u.rank-2],A=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=i?u.shape[u.rank-2]:u.shape[u.rank-1],f=c.shape.slice(0,-2),g=u.shape.slice(0,-2),m=YC(f),y=YC(g);qC(h===d,()=>"Error in fused matMul: inner shapes (".concat(h,") and (")+"".concat(d,") of Tensors with shapes ").concat(c.shape," and ")+"".concat(u.shape," and transposeA=").concat(r)+" and transposeB=".concat(i," must match."));const v=nF(c.shape.slice(0,-2),u.shape.slice(0,-2)).concat([A,p]),b=CR(c,r?[m,h,A]:[m,A,h]),x=CR(u,i?[y,p,d]:[y,d,p]);let w,_;null!=a&&(w=cB(a,"bias","fused matMul"),[w]=WT(w,c),nF(v,w.shape)),null!=o&&(_=cB(o,"prelu weights","fused matMul"));const S=(e,t)=>{const[n,o,l,c]=t,u=aD(CR(e,l.shape),l,s);let h,d;if(r||i?!r&&i?(h=IR(u,o,!1,!1),d=IR(u,n,!0,!1)):r&&!i?(h=IR(o,u,!1,!0),d=IR(n,u,!1,!1)):(h=IR(o,u,!0,!0),d=IR(u,n,!0,!0)):(h=IR(u,o,!1,!0),d=IR(n,u,!0,!1)),null!=a){return[h,d,sD(c,u)]}return[h,d]},C={a:b,b:x,bias:w,preluActivationWeights:_},E={transposeA:r,transposeB:i,activation:s,leakyreluAlpha:l};if(null==a){const e=OM((e,t,n)=>{const r=eB.runKernel(jI,C,E);return n([e,t,r]),{value:CR(r,v),gradFunc:S}});return e(b,x)}{const e=OM((e,t,n,r)=>{const i=eB.runKernel(jI,C,E);return r([e,t,i,n]),{value:CR(i,v),gradFunc:S}});return e(b,x,w)}}});const pD=dB({hammingWindow_:function(e){return nD(e,.54,.46)}});const fD=dB({hannWindow_:function(e){return nD(e,.5,.5)}});const gD=dB({frame_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=0;const s=[];for(;a+t<=e.size;)s.push(BR(e,a,t)),a+=n;if(r)for(;a<e.size;){const r=a+t-e.size,o=kR([BR(e,a,t-r),KM([r],i)]);s.push(o),a+=n}return 0===s.length?BU([],[0,t]):CR(kR(s),[s.length,t])}});const mD=dB({stft_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:fD;null==r&&(r=tD(t));const a=gD(e,t,n),s=LM(a,i(t));return _U(s,r)}});const yD=dB({cropAndResize_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=cB(e,"image","cropAndResize"),o=cB(t,"boxes","cropAndResize","float32"),l=cB(n,"boxInd","cropAndResize","int32"),c=o.shape[0];qC(4===s.rank,()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(s.rank,".")),qC(2===o.rank&&4===o.shape[1],()=>"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(o.shape,".")),qC(1===l.rank&&l.shape[0]===c,()=>"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(o.shape,".")),qC(2===r.length,()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")),qC(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was ".concat(r)),qC("bilinear"===i||"nearest"===i,()=>"method must be bilinear or nearest, but was ".concat(i));const u={image:s,boxes:o,boxInd:l},h={method:i,extrapolationValue:a,cropSize:r};return eB.runKernel(mN,u,h)}});const vD=dB({flipLeftRight_:function(e){const t=cB(e,"image","flipLeftRight","float32");qC(4===t.rank,()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,"."));const n={image:t};return eB.runKernel(ON,n,{})}});const bD=dB({grayscaleToRGB_:function(e){const t=cB(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];qC(t.rank>=2,()=>"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),qC(1===r,()=>"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,"."));const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,PL(t,i)}});const xD=dB({rgbToGrayscale_:function(e){const t=cB(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];qC(t.rank>=2,()=>"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")),qC(3===r,()=>"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(r,"."));const i=t.dtype,a=IM(t,"float32"),s=TU([.2989,.587,.114]);let o;switch(t.rank){case 2:o=fL("ij,j->i",a,s);break;case 3:o=fL("ijk,k->ij",a,s);break;case 4:o=fL("ijkl,l->ijk",a,s);break;case 5:o=fL("ijklm,m->ijkl",a,s);break;case 6:o=fL("ijklmn,n->ijklm",a,s);break;default:throw new Error("Not a valid tensor rank.")}return o=RL(o,-1),IM(o,i)}});const wD=dB({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const i=cB(e,"image","rotateWithOffset","float32");qC(4===i.rank,()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(i.rank,"."));const a={image:i},s={radians:t,fillValue:n,center:r};return eB.runKernel(OI,a,s)}});function _D(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);const s=e.shape[0];return n=Math.min(n,s),qC(0<=r&&r<=1,()=>"iouThreshold must be in [0, 1], but was '".concat(r,"'")),qC(2===e.rank,()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")),qC(4===e.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])),qC(1===t.rank,()=>"scores must be a 1D tensor"),qC(t.shape[0]===s,()=>"scores has incompatible shape with boxes. Expected ".concat(s,", ")+"but was ".concat(t.shape[0])),qC(0<=a&&a<=1,()=>"softNmsSigma must be in [0, 1], but was '".concat(a,"'")),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}const SD=dB({nonMaxSuppression_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const a=cB(e,"boxes","nonMaxSuppression","float32"),s=cB(t,"scores","nonMaxSuppression","float32"),o=_D(a,s,n,r,i);n=o.maxOutputSize,r=o.iouThreshold,i=o.scoreThreshold;const l={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return eB.runKernel(Ek,{boxes:a,scores:s},l)}});function CD(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,i=e.length,a=0,s=!1;for(;r<i;){a=r+(i-r>>>1);const o=n(t,e[a]);o>0?r=a+1:(i=a,s=!o)}return s?r:-r-1}(e,t,n||ED)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function ED(e,t){return e>t?1:e<t?-1:0}function ND(e,t,n,r,i){return TD(e,t,n,r,i,0)}function kD(e,t,n,r,i,a){return TD(e,t,n,r,i,0,!1,a,!0)}function ID(e,t,n,r,i,a){return TD(e,t,n,r,i,a,!0)}function TD(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const c=[];for(let g=0;g<t.length;g++)t[g]>i&&c.push({score:t[g],boxIndex:g,suppressBeginIndex:0});c.sort(FD);const u=a>0?-.5/a:0,h=[],d=[];for(;h.length<n&&c.length>0;){const t=c.pop(),{score:n,boxIndex:a,suppressBeginIndex:s}=t;if(n<i)break;let o=!1;for(let l=h.length-1;l>=s;--l){const n=BD(e,a,h[l]);if(n>=r){o=!0;break}if(t.score=t.score*MD(r,u,n),t.score<=i)break}t.suppressBeginIndex=h.length,o||(t.score===n?(h.push(a),d.push(t.score)):t.score>i&&CD(c,t,FD))}const A=h.length,p=n-A;o&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const f={selectedIndices:h};return s&&(f.selectedScores=d),l&&(f.validOutputs=A),f}function BD(e,t,n){const r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),A=(o-a)*(l-s),p=(h-c)*(d-u);if(A<=0||p<=0)return 0;const f=Math.max(a,c),g=Math.max(s,u),m=Math.min(o,h),y=Math.min(l,d),v=Math.max(m-f,0)*Math.max(y-g,0);return v/(A+p-v)}function MD(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function FD(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const RD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const a=cB(e,"boxes","nonMaxSuppressionAsync"),s=cB(t,"scores","nonMaxSuppressionAsync"),o=_D(a,s,n,r,i);n=o.maxOutputSize,r=o.iouThreshold,i=o.scoreThreshold;const l=await Promise.all([a.data(),s.data()]),c=l[0],u=l[1],{selectedIndices:h}=ND(c,u,n,r,i);return a!==e&&a.dispose(),s!==t&&s.dispose(),TU(h,"int32")};const LD=dB({nonMaxSuppressionWithScore_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=cB(e,"boxes","nonMaxSuppression"),o=cB(t,"scores","nonMaxSuppression"),l=_D(s,o,n,r,i,a);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,a=l.softNmsSigma;const c={boxes:s,scores:o},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a},h=eB.runKernel(kk,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}});const PD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=cB(e,"boxes","nonMaxSuppressionAsync"),o=cB(t,"scores","nonMaxSuppressionAsync"),l=_D(s,o,n,r,i,a);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,a=l.softNmsSigma;const c=await Promise.all([s.data(),o.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:A}=ID(u,h,n,r,i,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:TU(d,"int32"),selectedScores:TU(A)}};const UD=dB({nonMaxSuppressionPadded_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=cB(e,"boxes","nonMaxSuppression"),o=cB(t,"scores","nonMaxSuppression"),l=_D(s,o,n,r,i,null),c={boxes:s,scores:o},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:a},h=eB.runKernel(Nk,c,u);return{selectedIndices:h[0],validOutputs:h[1]}}});const DD=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=cB(e,"boxes","nonMaxSuppressionAsync"),o=cB(t,"scores","nonMaxSuppressionAsync"),l=_D(s,o,n,r,i,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,A]=await Promise.all([s.data(),o.data()]),{selectedIndices:p,validOutputs:f}=kD(d,A,c,u,h,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:TU(p,"int32"),validOutputs:jM(f,"int32")}};const OD=dB({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=cB(e,"images","resizeBilinear");qC(3===i.rank||4===i.rank,()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(i.rank,".")),qC(2===t.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")),qC(!1===r||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=i,s=!1;3===i.rank&&(s=!0,a=CR(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=t,o={images:a},l={alignCorners:n,halfPixelCenters:r,size:t},c=eB.runKernel(Wk,o,l);return s?CR(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const jD=dB({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=cB(e,"images","resizeNearestNeighbor");qC(3===i.rank||4===i.rank,()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(i.rank,".")),qC(2===t.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")),qC("float32"===i.dtype||"int32"===i.dtype,()=>"`images` must have `int32` or `float32` as dtype"),qC(!1===r||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=i,s=!1;3===i.rank&&(s=!0,a=CR(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=t,o={images:a},l={alignCorners:n,halfPixelCenters:r,size:t},c=eB.runKernel(Vk,o,l);return s?CR(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const zD=dB({threshold_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const i=cB(e,"image","threshold"),a=i.shape[0]*i.shape[1];let s,o,l,c,u=LM(TU([r]),255);if(qC(3===i.rank,()=>"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")),qC(3===i.shape[2]||1===i.shape[2],()=>"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")),qC("int32"===i.dtype||"float32"===i.dtype,()=>"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")),qC("otsu"===t||"binary"===t,()=>"Method must be binary or otsu, but was ".concat(t)),3===i.shape[2]){[s,o,l]=wU(i,[1,1,1],-1);const e=LM(s,.2989),t=LM(o,.587),n=LM(l,.114);c=MM(MM(e,t),n)}else c=e;if("otsu"===t){u=function(e,t){let n,r,i,a,s,o,l=TU([-1]),c=TU([0]),u=TU([0]);for(let h=0;h<e.size-1;h++){n=BR(e,0,h+1),r=BR(e,h+1),s=RM(IL(n),t),o=RM(IL(r),t);const d=IL(LM(n,YP(0,n.size)));i=RM(d,IL(n));const A=KM(r.shape,n.size),p=MM(YP(0,r.size),A),f=LM(r,p);a=RM(IL(f),IL(r));const g=JM(i,a),m=JM(i,a),y=LM(s,o);u=LM(LM(y,g),m);const v=jL(u,c);c=dL(v,u,c),l=dL(v,TU([h]),l)}return l}(OR(IM(sU(c),"int32"),fB([]),256),a)}const h=n?KL(c,u):jL(c,u);return IM(LM(h,255),"int32")}});const HD=dB({transform_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;const s=cB(e,"image","transform","float32"),o=cB(t,"transforms","transform","float32");qC(4===s.rank,()=>"Error in transform: image must be rank 4,"+"but got rank ".concat(s.rank,".")),qC(2===o.rank&&(o.shape[0]===s.shape[0]||1===o.shape[0])&&8===o.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),qC(null==a||2===a.length,()=>"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(a,"."));const l={image:s,transforms:o},c={interpolation:n,fillMode:r,fillValue:i,outputShape:a};return eB.runKernel(BI,l,c)}});const QD=dB({bandPart_:function(e,t,n){const r=cB(e,"a","bandPart");qC(r.rank>=2,()=>"bandPart(): Rank must be at least 2, got ".concat(r.rank,"."));const i=r.shape,[a,s]=r.shape.slice(-2);let o,l;"number"===typeof t?(qC(t%1===0,()=>"bandPart(): numLower must be an integer, got ".concat(t,".")),qC(t<=a,()=>"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(a,").")),o=cB(t<0?a:t,"numLower","bandPart")):(qC("int32"===t.dtype,()=>"bandPart(): numLower's dtype must be an int32."),o=dL(qL(t,0),a,yP(t,a))),"number"===typeof n?(qC(n%1===0,()=>"bandPart(): numUpper must be an integer, got ".concat(n,".")),qC(n<=s,()=>"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,").")),l=cB(n<0?s:n,"numUpper","bandPart")):(qC("int32"===n.dtype,()=>"bandPart(): numUpper's dtype must be an int32."),l=dL(qL(n,0),s,yP(n,s)));const c=CR(YP(0,a,1,"int32"),[-1,1]),u=YP(0,s,1,"int32"),h=JM(c,u),d=iP(KL(h,o),zL(h,$L(l))),A=fP([a,s],r.dtype);return CR(EU(QU(CR(r,[-1,a,s])).map(e=>dL(d,e,A))),i)}});const VD=dB({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,qC(null!=e&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=e[0].shape[0];for(let t=1;t<e.length;++t)qC(e[t].shape[0]===n,()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")"))}else t=!0,e=wU(e,e.shape[0],0).map(e=>CU(e,[0]));qC(e.length<=e[0].shape[0],()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],")."));const n=[],r=e;for(let i=0;i<e.length;++i)n.push(eB.tidy(()=>{let e=r[i];if(i>0)for(let t=0;t<i;++t){const r=LM(IL(LM(n[t],e)),n[t]);e=JM(e,r)}return RM(e,BL(e,"euclidean"))}));return t?EU(n,0):n}});function GD(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return eB.tidy(()=>{qC(2===e.shape.length,()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor."));const n=e.shape[0],r=e.shape[1];let i=UL(n),a=TM(e);const s=BU([[1]],[1,1]);let o=TM(s);const l=n>=r?r:n;for(let e=0;e<l;++e){const t=a,l=o,c=i;[o,a,i]=eB.tidy(()=>{const t=BR(a,[e,e],[n-e,1]),l=BL(t),c=BR(a,[e,e],[1,1]),u=dL(jL(c,0),BU([[-1]]),BU([[1]])),h=JM(c,LM(u,l)),d=RM(t,h);o=1===d.shape[0]?TM(s):kR([s,BR(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const A=$L(RM(IR(u,h),l)),p=BR(a,[e,0],[n-e,r]),f=LM(A,o),g=XU(o);if(0===e)a=JM(p,IR(f,IR(g,p)));else{const t=JM(p,IR(f,IR(g,p)));a=kR([BR(a,[0,0],[e,r]),t],0)}const m=XU(f),y=BR(i,[0,e],[n,i.shape[1]-e]);if(0===e)i=JM(y,IR(IR(y,o),m));else{const t=JM(y,IR(IR(y,o),m));i=kR([BR(i,[0,0],[n,e]),t],1)}return[o,a,i]}),xB([t,l,c])}return!t&&n>r&&(i=BR(i,[0,0],[n,r]),a=BR(a,[0,0],[r,r])),[i,a]})}const WD=dB({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(qC(e.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)),2===e.rank)return GD(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=QU(CR(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];r.forEach(e=>{const[n,r]=GD(e,t);i.push(n),a.push(r)});return[CR(EU(i,0),e.shape),CR(EU(a,0),e.shape)]}}});var qD;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(qD||(qD={}));const KD=dB({computeWeightedLoss_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qD.SUM_BY_NONZERO_WEIGHTS;const r=cB(e,"losses","computeWeightedLoss");let i=null;null!=t&&(i=cB(t,"weights","computeWeightedLoss"));const a=null==i?r:LM(r,i);if(n===qD.NONE)return a;if(n===qD.SUM)return IL(a);if(n===qD.MEAN){if(null==i)return pP(a);{const e=r.size/i.size,t=RM(IL(a),IL(i));return e>1?RM(t,jM(e)):t}}if(n===qD.SUM_BY_NONZERO_WEIGHTS){if(null==i)return RM(IL(a),jM(r.size));{const e=LM(i,gP(r.shape)),t=IM(IL(SP(e,jM(0))),"float32");return RM(IL(a),t)}}throw Error("Unknown reduction: ".concat(n))}});const XD=dB({absoluteDifference_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qD.SUM_BY_NONZERO_WEIGHTS;const i=cB(e,"labels","absoluteDifference"),a=cB(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=cB(n,"weights","absoluteDifference")),KC(i.shape,a.shape,"Error in absoluteDifference: ");const o=$M(JM(i,a));return KD(o,s,r)}});const YD=dB({cosineDistance_:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qD.SUM_BY_NONZERO_WEIGHTS;const a=cB(e,"labels","cosineDistance"),s=cB(t,"predictions","cosineDistance");let o=null;null!=r&&(o=cB(r,"weights","cosineDistance")),KC(a.shape,s.shape,"Error in cosineDistance: ");const l=jM(1),c=JM(l,IL(LM(a,s),n,!0));return KD(c,o,i)}});const JD=dB({hingeLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qD.SUM_BY_NONZERO_WEIGHTS,i=cB(e,"labels","hingeLoss");const a=cB(t,"predictions","hingeLoss");let s=null;null!=n&&(s=cB(n,"weights","hingeLoss")),KC(i.shape,a.shape,"Error in hingeLoss: ");const o=jM(1);i=JM(LM(jM(2),i),o);const l=$P(JM(o,LM(i,a)));return KD(l,s,r)}});const ZD=dB({huberLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qD.SUM_BY_NONZERO_WEIGHTS;const a=cB(e,"labels","huberLoss"),s=cB(t,"predictions","huberLoss");let o=null;null!=n&&(o=cB(n,"weights","huberLoss")),KC(a.shape,s.shape,"Error in huberLoss: ");const l=jM(r),c=$M(JM(s,a)),u=yP(c,l),h=JM(c,u),d=MM(LM(jM(.5),UM(u)),LM(l,h));return KD(d,o,i)}});const $D=dB({logLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qD.SUM_BY_NONZERO_WEIGHTS;const a=cB(e,"labels","logLoss"),s=cB(t,"predictions","logLoss");let o=null;null!=n&&(o=cB(n,"weights","logLoss")),KC(a.shape,s.shape,"Error in logLoss: ");const l=jM(1),c=jM(r),u=$L(LM(a,JL(MM(s,c)))),h=LM(JM(l,a),JL(MM(JM(l,s),c))),d=JM(u,h);return KD(d,o,i)}});const eO=dB({meanSquaredError_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qD.SUM_BY_NONZERO_WEIGHTS;const i=cB(e,"labels","meanSquaredError"),a=cB(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=cB(n,"weights","meanSquaredError")),KC(i.shape,a.shape,"Error in meanSquaredError: ");const o=SU(i,a);return KD(o,s,r)}});const tO=dB({sigmoidCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qD.SUM_BY_NONZERO_WEIGHTS,a=cB(e,"multiClassLabels","sigmoidCrossEntropy");const s=cB(t,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=cB(n,"weights","sigmoidCrossEntropy")),KC(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=jM(r),t=jM(1),n=jM(.5);a=MM(LM(a,JM(t,e)),LM(n,e))}const l=function(e,t){const n=cB(e,"labels","sigmoidCrossEntropyWithLogits"),r=cB(t,"logits","sigmoidCrossEntropyWithLogits");KC(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=$P(r),a=LM(r,n),s=ZL(FL($L($M(r))));return MM(JM(i,a),s)}(a,s);return KD(l,o,i)}});const nO=dB({softmaxCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qD.SUM_BY_NONZERO_WEIGHTS,a=cB(e,"onehotLabels","softmaxCrossEntropy");const s=cB(t,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=cB(n,"weights","softmaxCrossEntropy")),KC(a.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=jM(r),t=jM(1),n=jM(a.shape[1]);a=MM(LM(a,JM(t,e)),RM(e,n))}const l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));const r=OM((e,t,r)=>{const i=rP(t,[n],!0),a=JM(IM(t,"float32"),i);r([e,a]);const s=$L(LM(a,e));return{value:IL(s,[n]),gradFunc:(e,t)=>{const[r,i]=t,a=wL(e.shape,[n]);return[LM(CR(e,a),JM(IM(r,"float32"),FL(i))),LM(CR(e,a),JM(FL(i),IM(r,"float32")))]}}});return r(e,t)}(a,s);return KD(l,o,i)}});const rO=dB({sparseFillEmptyRows_:function(e,t,n,r){const i=cB(e,"indices","sparseFillEmptyRows","int32"),a=cB(t,"values","sparseFillEmptyRows"),s=cB(n,"denseShape","sparseFillEmptyRows","int32"),o=cB(r,"defaultValue","sparseFillEmptyRows",a.dtype);if(2!==i.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(i.shape));if(1!==a.rank)throw new Error("Values should be Tensor1D but received shape ".concat(a.shape));if(1!==s.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(s.shape));if(0!==o.rank)throw new Error("Default value should be a scalar but received shape ".concat(o.shape));const l={indices:i,values:a,denseShape:s,defaultValue:o},c=eB.runKernel(pI,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});const iO=dB({sparseReshape_:function(e,t,n){const r=cB(e,"inputIndices","sparseReshape","int32"),i=cB(t,"inputShape","sparseReshape","int32"),a=cB(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==i.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(i.shape));if(1!==a.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(a.shape));const s={inputIndices:r,inputShape:i,newShape:a},o=eB.runKernel(fI,s);return{outputIndices:o[0],outputShape:o[1]}}});const aO=dB({sparseSegmentMean_:function(e,t,n){const r=cB(e,"data","sparseSegmentMean"),i=cB(t,"indices","sparseSegmentMean","int32"),a=cB(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(i.shape));if(1!==a.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(a.shape));const s={data:r,indices:i,segmentIds:a};return eB.runKernel(gI,s)}});const sO=dB({sparseSegmentSum_:function(e,t,n){const r=cB(e,"data","sparseSegmentSum"),i=cB(t,"indices","sparseSegmentSum","int32"),a=cB(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(i.shape));if(1!==a.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(a.shape));const s={data:r,indices:i,segmentIds:a};return eB.runKernel(mI,s)}});const oO=dB({stringNGrams_:function(e,t,n,r,i,a,s,o){const l=cB(e,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error("Data must be a vector, saw: ".concat(l.shape));const c=cB(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:i,rightPad:a,padWidth:s,preserveShortSequences:o},h={data:l,dataSplits:c},d=eB.runKernel(_I,h,u);return{nGrams:d[0],nGramsSplits:d[1]}}});const lO=dB({stringSplit_:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=cB(e,"input","stringSplit","string"),i=cB(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==i.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(i.shape));const a={skipEmpty:n},s={input:r,delimiter:i},o=eB.runKernel(SI,s,a);return{indices:o[0],values:o[1],shape:o[2]}}});const cO=dB({stringToHashBucketFast_:function(e,t){const n=cB(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return eB.runKernel(CI,i,r)}});const uO=dB({staticRegexReplace_:function(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=cB(e,"input","staticRegexReplace","string"),a={pattern:t,rewrite:n,replaceGlobal:r};return eB.runKernel(xI,{x:i},a)}}),hO={fft:vU,ifft:bU,rfft:_U,irfft:xU},dO={hammingWindow:pD,hannWindow:fD,frame:gD,stft:mD},AO={flipLeftRight:vD,grayscaleToRGB:bD,resizeNearestNeighbor:jD,resizeBilinear:OD,rgbToGrayscale:xD,rotateWithOffset:wD,cropAndResize:yD,nonMaxSuppression:SD,nonMaxSuppressionAsync:RD,nonMaxSuppressionWithScore:LD,nonMaxSuppressionWithScoreAsync:PD,nonMaxSuppressionPadded:UD,nonMaxSuppressionPaddedAsync:DD,threshold:zD,transform:HD},pO={bandPart:QD,gramSchmidt:VD,qr:WD},fO={absoluteDifference:XD,computeWeightedLoss:KD,cosineDistance:YD,hingeLoss:JD,huberLoss:ZD,logLoss:$D,meanSquaredError:eO,sigmoidCrossEntropy:tO,softmaxCrossEntropy:nO},gO={sparseFillEmptyRows:rO,sparseReshape:iO,sparseSegmentMean:aO,sparseSegmentSum:sO},mO={stringNGrams:oO,stringSplit:lO,stringToHashBucketFast:cO,staticRegexReplace:uO};const yO=class{static sgd(e){return new aF(e)}static momentum(e,t){return new sF(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new oF(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new ZM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new qM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new iF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new XM(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}},vO="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function bO(){return new Promise(e=>vO(()=>e()))}function xO(e,t){const n=e[0].length;e.forEach((e,t)=>{qC(e.length===n,()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")"))}),qC(t>=0&&t<n,()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,"."));const r=e[0];e.forEach((e,i)=>{for(let a=0;a<n;a++)qC(a===t||e[a]===r[a],()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(i,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(i,"."))})}function wO(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var _O;function SO(e,t,n){let r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(let i=1;i<n.length;++i){const a=n[i],s=r[r.length-n.length+i],o=r[s];if(a>=0)if(o>=0){if(o!==a)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(i+e,"] = ").concat(a," but shape[").concat(i+e,"] = ").concat(o))}else r[s]=a}return r}function CO(e){const t={FIRST_DIM_SIZE:_O.FIRST_DIM_SIZE,VALUE_ROWIDS:_O.VALUE_ROWIDS,ROW_LENGTHS:_O.ROW_LENGTHS,ROW_SPLITS:_O.ROW_SPLITS,ROW_LIMITS:_O.ROW_LIMITS,ROW_STARTS:_O.ROW_STARTS},n=[];for(const r of e){if(!(r in t))break;n.push(t[r])}return n}function EO(e){return 0===e.length?0:e[0]===_O.FIRST_DIM_SIZE?e.length-1:e.length}function NO(e,t){if(null==e||null==t)return;const n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(let i=0;i<Math.min(n,r-1);++i){const n=e[i],r=t[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(i-e.length,"] = ").concat(n," but ragged tensor input.flatValues.shape[").concat(i-e.length,"] = ").concat(r))}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(_O||(_O={}));const kO=30;function IO(e){return e<=kO?e:AE(e,Math.floor(Math.sqrt(e)))}function TO(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function BO(e,t,n){let r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let i=0;i<n;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(n+1))}return r}function MO(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{const r=[],i=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?i.push(n):r.push(n);n.push(...r),n.push(0),n.push(...i)}return n}function FO(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function RO(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function LO(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function PO(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===YC(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const i=t.shape,a=i[i.length-1];let s=1;for(let h=0;h<i.length-1;++h)s*=i[h];const o=e.shape,l=i.slice();l.pop();let c=1;for(let h=a;h<n;++h)c*=o[h],l.push(o[h]);const u=[...pE(e.shape).map(e=>e/c),1].slice(0,a);return[l,s,c,u]}const UO=1.7580993408473768,DO=1.0507009873554805,OO=.3275911,jO=.254829592,zO=-.284496736,HO=1.421413741,QO=-1.453152027,VO=1.061405429;function GO(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function WO(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function qO(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function KO(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function XO(e,t){return{real:e[2*t],imag:e[2*t+1]}}function YO(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function JO(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}function ZO(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}const $O="->",ej=/->/g,tj=",",nj="...";function rj(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(ej,"").length)/$O.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat($O,'").'));const[r,i]=e.split($O);qC(-1===r.indexOf(nj),()=>'The ellipsis notation ("'.concat(nj,'") is not supported yet.'));const a=r.split(tj),s=a.length;if(t!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(t));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let h=0;h<i.length;++h){const e=i[h];if(!a.some(t=>-1!==t.indexOf(e)))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===o.indexOf(e)&&o.push(e)}for(let h=0;h<r.length;++h){const e=r[h];-1===o.indexOf(e)&&e!==tj&&o.push(e)}const l=new Array(a.length);for(let h=0;h<s;++h){if(new Set(a[h].split("")).size!==a[h].length)throw new Error("Found duplicate axes in input component ".concat(a[h],". ")+"Support for duplicate axes in input is not implemented yet.");l[h]=[];for(let e=0;e<a[h].length;++e)l[h].push(o.indexOf(a[h][e]))}const c=o.length,u=[];for(let h=i.length;h<c;++h)u.push(h);return{allDims:o,summedDims:u,idDims:l}}function ij(e,t){let n=new Array(e);n.fill(-1);for(let i=0;i<t.length;++i)n[t[i]]=i;const r=[];for(let i=0;i<e;++i)-1===n[i]&&r.push(i);return n=n.filter(e=>-1!==e),{permutationIndices:n,expandDims:r}}function aj(e,t,n){const r=new Array(e);for(let i=0;i<n.length;++i){const e=n[i].shape;for(let n=0;n<t[i].length;++n)void 0===r[t[i][n]]?r[t[i][n]]=e[n]:qC(r[t[i][n]]===e[n],()=>"Expected dimension ".concat(r[t[i][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(e),", ")+"but got dimension ".concat(e[n]))}}function sj(e,t){const n=e,r=[];let i=0;0===e.length&&n.push(-1),i=e.length+1;for(let s=0;s<i;++s)r.push([]);const a=[];for(let s=0;s<n.length;++s){const e=lj(t,n[s]);for(const t of e)-1===a.indexOf(t)&&(r[s].push(t),a.push(t))}return{path:n,steps:r}}function oj(e){return e.every((e,t)=>e===t)}function lj(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function cj(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)qC(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce((e,t)=>(-1===t&&(e+=1),e),0);qC(i<=1,()=>"There should be only one negative value in split array.");const a=t.indexOf(-1);if(-1!==a){const r=t.reduce((e,t)=>t>0?e+t:e);t[a]=e.shape[n]-r}qC(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function uj(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function hj(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function dj(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Aj(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function pj(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function fj(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function gj(e,t){const n=YC(e),r=YC(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function mj(e,t){const n=YC(e),r=YC(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function yj(){return"segment ids must be >= 0"}function vj(){return"segment ids are not increasing"}function bj(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function xj(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function wj(e,t){let n,r=!1;for(e<=kO?(n=e,r=!0):n=AE(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=AE(e,n+1);return n}function _j(e,t,n){const r=[],i=e.length;for(let a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}function Sj(e,t,n,r){const i=t.shape.length,a=e.shape.length;if(0!==r&&(r<-i||r>i))throw new Error("Expect batchDims in the range of [-".concat(i,", ").concat(i,"], but got ").concat(r));if(r<0&&(r+=i),r>a)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(a,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error("x.shape[".concat(h,"]: ").concat(e.shape[h]," should be equal to indices.shape[").concat(h,"]: ").concat(t.shape[h],"."));const s=e.shape[n],o=[];let l=1,c=1,u=1;for(let h=0;h<r;++h)o.push(e.shape[h]),l*=e.shape[h];for(let h=r;h<n;h++)o.push(e.shape[h]),c*=e.shape[h];for(let h=r;h<i;h++)o.push(t.shape[h]);for(let h=n+1;h<a;h++)o.push(e.shape[h]),u*=e.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:o}}function Cj(e){try{return e.map(e=>yT(e))}catch(kAe){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(kAe))}}function Ej(e){return e.map(e=>mT(e))}!function(){for(const e of lF)GM(e)}();const Nj={kernelName:ME,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,NU(IM(n,"float32"),-1))}}},kj={kernelName:FE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=UM(IM(n,"float32")),r=PM(JM(jM(1),t));return $L(RM(e,r))}}}},Ij={kernelName:RE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=PM(JM(UM(IM(n,"float32")),1));return RM(e,t)}}}},Tj={kernelName:LE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{let t=e;const r=tF(n.shape,i);return r.length>0&&(t=IL(t,r)),CR(t,n.shape)},b:()=>{let t=e;const n=tF(r.shape,i);return n.length>0&&(t=IL(t,n)),CR(t,r.shape)}}}},Bj={kernelName:PE,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},Mj={kernelName:OE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DM(n)}}},Fj={kernelName:jE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>DM(n)}}},Rj={kernelName:zE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,PM(JM(jM(1),UM(IM(n,"float32")))))}}},Lj={kernelName:HE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=PM(MM(jM(1),UM(IM(n,"float32"))));return RM(e,t)}}}},Pj={kernelName:GE,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{const t=MM(UM(n),UM(r));let a=LM(e,RM(r,t));const s=tF(n.shape,i);return s.length>0&&(a=IL(a,s)),CR(a,n.shape)},b:()=>{const t=MM(UM(n),UM(r));let a=$L(LM(e,RM(n,t)));const s=tF(r.shape,i);return s.length>0&&(a=IL(a,s)),CR(a,r.shape)}}}},Uj={kernelName:QE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,MM(UM(IM(n,"float32")),1))}}},Dj={kernelName:VE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,JM(jM(1),UM(IM(n,"float32"))))}}};const Oj=dB({avgPool3dGrad_:function(e,t,n,r,i,a){const s=cB(e,"dy","avgPool3dGrad"),o=cB(t,"input","avgPool3dGrad");let l=s,c=o,u=!1;4===o.rank&&(u=!0,l=CR(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=CR(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),qC(5===l.rank,()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")),qC(5===c.rank,()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")),SR("avgPool3dGrad",i,a);const h={dy:l,input:c},d={filterSize:n,strides:r,pad:i,dimRoundingMode:a},A=eB.runKernel(XE,h,d);return u?CR(A,[A.shape[1],A.shape[2],A.shape[3],A.shape[4]]):A}}),jj={kernelName:KE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:s,dimRoundingMode:o}=n;return{x:()=>Oj(e,r,i,a,s,o)}}};const zj=dB({avgPoolGrad_:function(e,t,n,r,i){const a=cB(e,"dy","avgPoolGrad"),s=cB(t,"input","avgPoolGrad");qC(s.rank===a.rank,()=>"Rank of input (".concat(s.rank,") does not match rank of dy (").concat(a.rank,")"));let o=s,l=a,c=!1;3===s.rank&&(c=!0,o=CR(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=CR(a,[1,a.shape[0],a.shape[1],a.shape[2]])),qC(4===l.rank,()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(l.rank,".")),qC(4===o.rank,()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(o.rank,"."));const u={dy:l,input:o},h={filterSize:n,strides:r,pad:i},d=eB.runKernel(qE,u,h);return c?CR(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Hj={kernelName:WE,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:s}=n;return{x:()=>zj(e,r,i,a,s)}}},Qj={kernelName:YE,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:a,transposeB:s}=n;return a||s?!a&&s?{a:()=>IR(e,i,!1,!1),b:()=>IR(e,r,!0,!1)}:a&&!s?{a:()=>IR(i,e,!1,!0),b:()=>IR(r,e,!1,!1)}:{a:()=>IR(i,e,!0,!0),b:()=>IR(e,r,!0,!0)}:{a:()=>IR(e,i,!1,!0),b:()=>IR(r,e,!0,!1)}}},Vj={kernelName:JE,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>FP(e,r,i)}}},Gj={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const r=n,i=r.inputShape,a=r.shape,s=Array.from(a);for(let l=i.length-1;l>=0;l--)if(i[l]===a[l])s[l]=1;else if(1!==i[l])throw new Error("broadcastTo(): [".concat(i,"] cannot be broadcast to [").concat(a,"]."));const o=[];for(let l=0;l<s.length;l++)s[l]>1&&o.push(l);return{x:()=>IL(e,o,!0)}}},Wj={kernelName:tN,gradFunc:e=>({x:()=>e.clone()})},qj={kernelName:nN,gradFunc:e=>({x:()=>DM(e)})},Kj={kernelName:rN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:a}=n;return{x:()=>dL(iP(zL(r,i),KL(r,a)),e,DM(e))}}},Xj={kernelName:aN,inputsToSave:["x"],gradFunc:Nj.gradFunc},Yj={kernelName:sN,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(e=>e.shape),{axis:i}=n,a=rE(i,t[0].shape)[0],s=r.map(e=>e[a]);return wU(e,s,a).map(e=>()=>e)}},Jj={kernelName:oN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:a,strides:s,pad:o,dataFormat:l}=n;return qC(bR(a),()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(a,"'")),{x:()=>JR(r.shape,e,i,s,o,l),filter:()=>iD(r,e,i.shape,s,o,l)}}},Zj={kernelName:cN,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:a,pad:s,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>XR(e,i,a,s,o,1,l),filter:()=>iD(e,r,i.shape,a,s,o,l)}}};const $j=dB({conv3DBackpropFilter_:function(e,t,n,r,i){let a=e;4===e.rank&&(a=CR(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let s=t;4===s.rank&&(s=CR(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),qC(5===a.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(a.shape,".")),qC(5===s.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(s.shape,".")),qC(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")),qC(a.shape[4]===n[3],()=>"Error in conv3dDerFilter: depth of input ".concat(a.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")),qC(s.shape[4]===n[4],()=>"Error in conv3dDerFilter: depth of dy (".concat(s.shape[4],") must ")+"match output depth for filter (".concat(n[4],")."));const o={x:a,dy:s},l={strides:r,pad:i,filterShape:n};return eB.runKernel(hN,o,l)}}),ez={kernelName:uN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a}=n;qC(bR(r),()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'"));const[s,o]=t;return{x:()=>eL(s.shape,e,o,i,a),filter:()=>$j(s,e,o.shape,i,a)}}},tz={kernelName:AN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM($L(dU(IM(n,"float32"))),e)}}},nz={kernelName:pN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(AU(IM(n,"float32")),e)}}},rz={kernelName:gN,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:a,reverse:s}=n;return{x:()=>{const t=SL([i],r.rank);let n=aL(e,i,a,!s);return null!=t&&(n=XU(n,t)),n}}}},iz={kernelName:bN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a,dimRoundingMode:s}=n,o=null==r?[1,1]:r;qC(bR(o),()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(o,"'"));const[l,c]=t;return qC(4===l.rank,()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(l.rank,".")),qC(4===c.rank,()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(c.rank,".")),qC(l.shape[3]===c.shape[2],()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(l.shape[3],") must match the inChannels dimension ")+"in filter ".concat(c.shape[2],".")),qC(xR(i,o),()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(i," and dilations ")+"'".concat(o,"'.")),SR("depthwiseConv2d",a,s),{x:()=>hD(l.shape,e,c,i,a,o,s),filter:()=>uD(l,e,c.shape,i,a,o,s)}}},az={kernelName:SN,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,a={x:r,filter:i,dy:e},s={x:r,filter:i,dy:e};return{x:()=>eB.runKernel(CN,a,n),filter:()=>eB.runKernel(EN,s,n)}}},sz={kernelName:TN,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>eB.runKernel(BN,r)}}},oz={kernelName:MN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=LM(FL($L(UM(n))),2/Math.sqrt(Math.PI));return{x:()=>LM(e,r)}}},lz={kernelName:RN,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,n)}}},cz={kernelName:LN,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>CR(e,n.shape)}}},uz={kernelName:PN,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,FL(n))}}},hz={kernelName:jN,gradFunc:e=>({x:()=>DM(e)})},dz={kernelName:zN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{const t=RM(e,IM(r,"float32")),a=tF(n.shape,i);return a.length>0?CR(IL(t,a),n.shape):t},b:()=>{let t=LM(e,IM(n,"float32"));const a=tF(r.shape,i);a.length>0&&(t=CR(IL(t,a),r.shape));const s=UM(r);return $L(RM(t,IM(s,"float32")))}}}},Az={kernelName:HN,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,a,s,o]=t,l=null==o?jM(1):o,c=tF(a.shape,i.shape),u=[];if(1===a.rank){for(let e=0;e<i.shape.length-1;++e)u.push(i.shape[e]);u.push(1)}const h=JM(i,a),d=LM(e,l),A=oU(MM(s,jM(r))),p=LM(LM(LM(A,A),A),jM(-.5));return{x:()=>1===a.rank?CR(LM(LM(e,PL(CR(A,[1,1,1,a.shape[0]]),u)),l),i.shape):CR(LM(LM(e,A),l),i.shape),mean:()=>{let e=LM(LM(A,jM(-1)),d);return 1===a.rank&&(e=IL(e,c)),CR(e,a.shape)},variance:()=>{let e=LM(LM(p,h),d);return 1===a.rank&&(e=IL(e,c)),CR(e,a.shape)},scale:()=>{const t=LM(h,A);let n=LM(e,t);return 1===a.rank&&(n=IL(n,c)),CR(n,a.shape)},offset:()=>{let t=e;return 1===a.rank&&(t=IL(t,c)),CR(t,a.shape)}}}},pz={kernelName:QN,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:a,batchDims:s}=n,o=rE(a,r.shape)[0],l=(e,t,n)=>()=>{const r=e.shape,i=t.size,s=r.slice(0,o),l=s.length,c=r.slice(a,r.length).slice(1),u=c.length,h=fz(0,l),d=fz(l+1,l+1+u),A=gz([s,[i],c]),p=CR(n,A),f=CR(t,[i]),g=gz([[l],h,d]),m=XU(p,g);let y=HU(m,f,e.shape[o]);const v=CL(g);return y=XU(y,v),y};if(1===s){const t=r.shape[0],n=r.split(t,0),a=()=>{const t=EU(n.map((t,n)=>l(t,i.slice(n,1),e.slice(n,1))()));return t.reshape(r.shape)};return{x:a,indices:()=>i}}return{x:l(r,i,e),indices:()=>i}}};function fz(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function gz(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const mz={kernelName:WN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>DM(n),b:()=>DM(r)}}},yz={kernelName:qN,gradFunc:e=>({x:()=>IM(e,"float32")})},vz={kernelName:YN,gradFunc:e=>({x:()=>DM(e)})},bz={kernelName:JN,gradFunc:e=>({x:()=>DM(e)})},xz={kernelName:ZN,gradFunc:e=>({x:()=>DM(e)})},wz={kernelName:$N,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,a=jL(r,0);return{x:()=>dL(a,e,LM(e,i))}}},_z={kernelName:ik,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,MM(n,1))}}},Sz={kernelName:rk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,IM(n,"float32"))}}},Cz={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const t=FL(r);return JM(e,LM(IL(e,i,!0),t))}}}};const Ez=dB({localResponseNormalizationBackprop_:function(e,t,n){const r={x:e,y:t,dy:n},i={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return eB.runKernel(ck,r,i)}}),Nz={kernelName:lk,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:a,bias:s,alpha:o,beta:l}=n;return{x:()=>Ez(r,i,e,a,s,o,l)}}};function kz(e,t,n,r){return t.rank<n.rank&&(t=CR(t,wL(t.shape,r))),e.rank<n.rank&&(e=CR(e,wL(e.shape,r))),{x:()=>LM(e,IM(hL(n,t),e.dtype))}}const Iz={kernelName:uk,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,a=t[0],s=kz(e,t[1],a,rE(i,a.shape));return{x:()=>s.x()}}},Tz={kernelName:hk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>LM(e,IM(zL(n,r),"float32")),b:()=>LM(e,IM(qL(n,r),"float32"))}}};const Bz=dB({maxPool3dGrad_:function(e,t,n,r,i,a,s){const o=cB(e,"dy","maxPool3dGrad"),l=cB(t,"input","maxPool3dGrad"),c=cB(n,"output","maxPool3dGrad");let u=o,h=l,d=c,A=!1;4===l.rank&&(A=!0,u=CR(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=CR(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=CR(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),qC(5===u.rank,()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")),qC(5===h.rank,()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")),qC(5===d.rank,()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")),SR("maxPool3dGrad",a,s);const p={dy:u,input:h,output:d},f={filterSize:r,strides:i,pad:a,dimRoundingMode:s},g=eB.runKernel(fk,p,f);return A?CR(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),Mz={kernelName:pk,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=n;return{x:()=>Bz(e,r,i,a,s,o,l)}}};const Fz=dB({maxPoolGrad_:function(e,t,n,r,i,a,s){const o=cB(e,"dy","maxPoolGrad"),l=cB(t,"input","maxPoolGrad"),c=cB(n,"output","maxPoolGrad");qC(l.rank===o.rank,()=>"Rank of input (".concat(l.rank,") does not match rank of dy ")+"(".concat(o.rank,")")),qC(4===o.rank,()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(o.rank,".")),qC(4===l.rank,()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(l.rank,".")),SR("maxPoolGrad",a,s);const u={dy:o,input:l,output:c},h={filterSize:r,strides:i,pad:a,dimRoundingMode:s};return eB.runKernel(Ak,u,h)}}),Rz={kernelName:dk,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:s,pad:o}=n;return{x:()=>Fz(e,r,i,a,s,o)}}},Lz={kernelName:mk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,a=rE(i,r.shape),s=YC(xL(r.shape,a)[1]);return{x:()=>{const t=r.shape.slice();a.forEach(e=>{t[e]=1});const n=CR(e,t);return RM(LM(n,gP(r.shape,"float32")),s)}}}},Pz={kernelName:yk,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[a,s]=t,o=kz(e,s,a,rE(i,a.shape));return{x:()=>o.x()}}},Uz={kernelName:vk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>LM(e,IM(KL(n,r),"float32")),b:()=>LM(e,IM(jL(n,r),"float32"))}}},Dz={kernelName:bk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>BR(e,a,r.shape)}}},Oz={kernelName:xk,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{const t=tF(n.shape,i);return t.length>0?CR(IL(e,t),n.shape):e},b:()=>{const t=LM(e,$L(DL(RM(n,r)))),a=tF(r.shape,i);return a.length>0?CR(IL(t,a),r.shape):t}}}},jz={kernelName:_k,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{const t=LM(e,IM(r,"float32")),a=tF(n.shape,i);return a.length>0?CR(IL(t,a),n.shape):t},b:()=>{const t=LM(e,IM(n,"float32")),a=tF(r.shape,i);return a.length>0?CR(IL(t,a),r.shape):t}}}},zz={kernelName:Bk,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return QU(e,r).map(e=>()=>e)}},Hz={kernelName:Mk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map(e=>e[0]);return{x:()=>BR(e,a,r.shape)}}},Qz={kernelName:Fk,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,a=n,s=r,o=nF(a.shape,s.shape);return{a:()=>{const t=IM(s,"float32");let n=LM(e,LM(t,YM(a,JM(t,jM(1)))));const r=tF(a.shape,o);return r.length>0&&(n=IL(n,r)),CR(n,a.shape)},b:()=>{const t=jL(a,0),n=dL(t,JL(a),DM(a));let r=LM(e,LM(i,n));const l=tF(s.shape,o);return l.length>0&&(r=IL(r,l)),CR(r,s.shape)}}}},Vz={kernelName:Rk,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=jL(n,0);return{x:()=>dL(i,e,LM(e,r)),alpha:()=>{let t=dL(i,DM(e),LM(e,n));const a=tF(r.shape,e.shape);return a.length>0&&(t=IL(t,a)),CR(t,r.shape)}}}};function Gz(e,t,n){const r=e.shape.length,i=r-n.length,a=SL(n,r);let s=e;null!=a&&(s=XU(e,a));const o=s.shape.slice(),l=o.splice(r-n.length,n.length).reduce((e,t)=>e*t,1);o.push(l);let c=function(e,t,n){const r=e.shape.slice();r[n]=1;const i=CR(t,r),a=iL(e,n,!0,!1),s=iL(e,n,!0,!0),o=LM(a,s);return LM(i,o)}(s.reshape(o),t,i);if(c=c.reshape(s.shape),null!=a){const e=CL(a);c=XU(c,e)}return c}const Wz={kernelName:Lk,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;let a=[];return a=void 0===i||null===i?r.shape.map((e,t)=>t):"number"===typeof i?[i]:i,{x:()=>Gz(r,e,a)}}},qz={kernelName:kN,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{const t=RM(e,IM(r,"float32")),a=tF(n.shape,i);return a.length>0?CR(IL(t,a),n.shape):t},b:()=>{let t=LM(e,IM(n,"float32"));const a=tF(r.shape,i);a.length>0&&(t=CR(IL(t,a),r.shape));const s=UM(r);return $L(RM(t,IM(s,"float32")))}}}},Kz={kernelName:zk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,$L(UM(n)))}}},Xz={kernelName:Kk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=LM(KL(n,6),NU(n));return{x:()=>LM(e,IM(r,"float32"))}}},Yz={kernelName:Hk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,IM(NU(n),"float32"))}}},Jz={kernelName:Qk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>CR(e,n.shape)}}},Zz={kernelName:Jk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>$L(RM(e,LM(YM(n,1.5),2)))}}},$z={kernelName:nI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=jL(n,jM(0)),r=jM(UO),i=jM(DO),a=LM(e,i),s=LM(LM(e,r),FL(IM(n,"float32")));return dL(t,a,s)}}}},eH={kernelName:oI,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,LM(n,JM(jM(1),n)))}}},tH={kernelName:iI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(nL(IM(n,"float32")),e)}}},nH={kernelName:aI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(rL(IM(n,"float32")),e)}}},rH={kernelName:rI,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:a}=n,s=r.shape,[o,l]=XF(r,i,a),c=[];for(let u=0;u<e.rank;u++)c.push([o[u],s[u]-o[u]-l[u]]);return{x:()=>kP(e,c)}}},iH={kernelName:AI,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,a=LM(e,r);return{logits:()=>JM(a,LM(IL(a,[i],true),r))}}},aH={kernelName:lI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,TR(n))}}},sH={kernelName:hI,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>RR(e,r,i)}}},oH={kernelName:dI,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>kR(e,r)}}},lH={kernelName:cI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,LM(PM(IM(n,"float32")),2))}}},cH={kernelName:bI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(e,LM(IM(n,"float32"),2))}}},uH={kernelName:vI,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=jM(2);return{a:()=>LM(e,LM(i,JM(n,r))),b:()=>LM(e,LM(i,JM(r,n)))}}},hH={kernelName:EI,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=nF(n.shape,r.shape);return{a:()=>{let t=e;const r=tF(n.shape,i);return r.length>0&&(t=IL(t,r)),CR(t,n.shape)},b:()=>{let t=e;const n=tF(r.shape,i);return n.length>0&&(t=IL(t,n)),CR($L(t),r.shape)}}}},dH={kernelName:uI,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:a}=n;rE(a,r.shape).forEach(e=>{i[e]=1});const s=CR(e,i),o=LM(s,gP(r.shape,"float32"));return{x:()=>o}}},AH={kernelName:NI,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>RM(e,UM(nL(n)))}}},pH={kernelName:kI,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>LM(JM(jM(1),UM(n)),e)}}},fH={kernelName:II,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let t=DM(r);if(1===r.rank)for(let n=0;n<i[0];++n)t=MM(t,BR(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)t=MM(t,BR(e,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let s=0;s<i[2];++s)t=MM(t,BR(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let s=0;s<i[2];++s)for(let o=0;o<i[3];++o)t=MM(t,BR(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},gH={kernelName:LI,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=rF(t,DM(t)),r=OL(e,n);let i=zL(t,jM(0,"int32"));const a=r.rank-i.rank;for(let o=0;o<a;++o)i=RL(i,o+1);i=iP(i,gP(r.shape,"bool"));const s=DM(r);return dL(i,r,s)}(e,n)}}};const mH=[Nj,kj,Ij,Tj,Bj,Mj,Fj,Rj,Lj,Pj,Uj,Dj,jj,Hj,Qj,Vj,Gj,Wj,qj,Kj,Xj,Yj,Zj,Jj,ez,tz,nz,rz,iz,az,qz,sz,oz,lz,cz,uz,dz,hz,Az,pz,mz,yz,vz,bz,xz,wz,_z,Sz,Cz,Nz,Iz,Iz,Tz,Mz,Rz,Lz,Pz,Uz,Dz,Oz,jz,{kernelName:Sk,gradFunc:e=>({x:()=>$L(e)})},{kernelName:Tk,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>fP(n.shape,"float32")}}},{kernelName:Ik,gradFunc:e=>({x:()=>DM(e)})},zz,Hz,Hz,Qz,Vz,Wz,Kz,Xz,Yz,Jz,{kernelName:Wk,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>eB.runKernel(qk,i,n)}}},{kernelName:Vk,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>eB.runKernel(Gk,i,n)}}},{kernelName:Xk,gradFunc:(e,t,n)=>{const{dims:r}=n,i=rE(r,e.shape);return{x:()=>tU(e,i)}}},{kernelName:Yk,gradFunc:e=>({x:()=>DM(e)})},Zz,{kernelName:tI,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>IM(DM(n),"float32"),t:()=>LM(e,IM(n,e.dtype)),e:()=>LM(e,IM(aP(n),e.dtype))}}},$z,eH,{kernelName:sI,gradFunc:e=>({x:()=>DM(e)})},tH,nH,rH,iH,aH,sH,sH,oH,oH,lH,uH,cH,{kernelName:UI,gradFunc:e=>({x:()=>DM(e)})},hH,dH,AH,pH,fH,{kernelName:MI,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,a=CL(i);return{x:()=>XU(e,a)}}},{kernelName:RI,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>EU(e,i)}}},gH,{kernelName:PI,gradFunc:e=>({x:()=>DM(e)})}];for(const n of mH)JI(n);RT().prototype.abs=function(){return this.throwIfDisposed(),$M(this)},RT().prototype.acos=function(){return this.throwIfDisposed(),ZF(this)},RT().prototype.acosh=function(){return this.throwIfDisposed(),$F(this)},RT().prototype.add=function(e){return this.throwIfDisposed(),MM(this,e)},RT().prototype.all=function(e,t){return this.throwIfDisposed(),tR(this,e,t)},RT().prototype.any=function(e,t){return this.throwIfDisposed(),nR(this,e,t)},RT().prototype.argMax=function(e){return this.throwIfDisposed(),rR(this,e)},RT().prototype.argMin=function(e){return this.throwIfDisposed(),iR(this,e)},RT().prototype.asScalar=function(){return this.throwIfDisposed(),qC(1===this.size,()=>"The array must have only 1 element."),CR(this,[])},RT().prototype.asType=function(e){return this.throwIfDisposed(),IM(this,e)},RT().prototype.as1D=function(){return this.throwIfDisposed(),CR(this,[this.size])},RT().prototype.as2D=function(e,t){return this.throwIfDisposed(),CR(this,[e,t])},RT().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),CR(this,[e,t,n])},RT().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),CR(this,[e,t,n,r])},RT().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),CR(this,[e,t,n,r,i])},RT().prototype.asin=function(){return this.throwIfDisposed(),aR(this)},RT().prototype.asinh=function(){return this.throwIfDisposed(),sR(this)},RT().prototype.atan=function(){return this.throwIfDisposed(),oR(this)},RT().prototype.atan2=function(e){return this.throwIfDisposed(),lR(this,e)},RT().prototype.atanh=function(){return this.throwIfDisposed(),cR(this)},RT().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ER(this,e,t,n,r)},RT().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),RR(this,e,t)},RT().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),LR(this,e,t,n,r,i)},RT().prototype.broadcastTo=function(e){return this.throwIfDisposed(),HR(this,e)},RT().prototype.cast=function(e){return this.throwIfDisposed(),IM(this,e)},RT().prototype.ceil=function(){return this.throwIfDisposed(),QR(this)},RT().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),VR(this,e,t)},RT().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof FT&&(e=[e]),kR([this,...e],t)},RT().prototype.conv1d=function(e,t,n,r,i,a){return this.throwIfDisposed(),YR(this,e,t,n,r,i,a)},RT().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),ZR(this,e,t,n,r,i)},RT().prototype.conv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),XR(this,e,t,n,r,i,a)},RT().prototype.cos=function(){return this.throwIfDisposed(),nL(this)},RT().prototype.cosh=function(){return this.throwIfDisposed(),rL(this)},RT().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),iL(this,e,t,n)},RT().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),aL(this,e,t,n)},RT().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),oL(this,e,t)},RT().prototype.depthwiseConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),lL(this,e,t,n,r,i,a)},RT().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),uL(this,e,t,n,r,i)},RT().prototype.divNoNan=function(e){return this.throwIfDisposed(),AL(this,e)},RT().prototype.div=function(e){return this.throwIfDisposed(),RM(this,e)},RT().prototype.dot=function(e){return this.throwIfDisposed(),pL(this,e)},RT().prototype.elu=function(){return this.throwIfDisposed(),gL(this)},RT().prototype.equal=function(e){return this.throwIfDisposed(),hL(this,e)},RT().prototype.erf=function(){return this.throwIfDisposed(),yL(this)},RT().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),ML(this,e,t)},RT().prototype.exp=function(){return this.throwIfDisposed(),FL(this)},RT().prototype.expandDims=function(e){return this.throwIfDisposed(),RL(this,e)},RT().prototype.expm1=function(){return this.throwIfDisposed(),LL(this)},RT().prototype.fft=function(){return this.throwIfDisposed(),vU(this)},RT().prototype.flatten=function(){return this.throwIfDisposed(),CR(this,[this.size])},RT().prototype.floor=function(){return this.throwIfDisposed(),DL(this)},RT().prototype.floorDiv=function(e){return this.throwIfDisposed(),FM(this,e)},RT().prototype.gather=function(e,t,n){return this.throwIfDisposed(),OL(this,e,t,n)},RT().prototype.greaterEqual=function(e){return this.throwIfDisposed(),zL(this,e)},RT().prototype.greater=function(e){return this.throwIfDisposed(),jL(this,e)},RT().prototype.ifft=function(){return this.throwIfDisposed(),bU(this)},RT().prototype.irfft=function(){return this.throwIfDisposed(),xU(this)},RT().prototype.isFinite=function(){return this.throwIfDisposed(),QL(this)},RT().prototype.isInf=function(){return this.throwIfDisposed(),VL(this)},RT().prototype.isNaN=function(){return this.throwIfDisposed(),GL(this)},RT().prototype.leakyRelu=function(e){return this.throwIfDisposed(),WL(this,e)},RT().prototype.lessEqual=function(e){return this.throwIfDisposed(),KL(this,e)},RT().prototype.less=function(e){return this.throwIfDisposed(),qL(this,e)},RT().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),YL(this,e,t,n,r)},RT().prototype.logSigmoid=function(){return this.throwIfDisposed(),tP(this)},RT().prototype.logSoftmax=function(e){return this.throwIfDisposed(),nP(this,e)},RT().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),rP(this,e,t)},RT().prototype.log=function(){return this.throwIfDisposed(),JL(this)},RT().prototype.log1p=function(){return this.throwIfDisposed(),ZL(this)},RT().prototype.logicalAnd=function(e){return this.throwIfDisposed(),iP(this,e)},RT().prototype.logicalNot=function(){return this.throwIfDisposed(),aP(this)},RT().prototype.logicalOr=function(e){return this.throwIfDisposed(),sP(this,e)},RT().prototype.logicalXor=function(e){return this.throwIfDisposed(),oP(this,e)},RT().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),IR(this,e,t,n)},RT().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),hP(this,e,t,n,r)},RT().prototype.max=function(e,t){return this.throwIfDisposed(),NL(this,e,t)},RT().prototype.maximum=function(e){return this.throwIfDisposed(),rF(this,e)},RT().prototype.mean=function(e,t){return this.throwIfDisposed(),pP(this,e,t)},RT().prototype.min=function(e,t){return this.throwIfDisposed(),kL(this,e,t)},RT().prototype.minimum=function(e){return this.throwIfDisposed(),yP(this,e)},RT().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),vP(this,e,t)},RT().prototype.mod=function(e){return this.throwIfDisposed(),bP(this,e)},RT().prototype.mul=function(e){return this.throwIfDisposed(),LM(this,e)},RT().prototype.neg=function(){return this.throwIfDisposed(),$L(this)},RT().prototype.norm=function(e,t,n){return this.throwIfDisposed(),BL(this,e,t,n)},RT().prototype.notEqual=function(e){return this.throwIfDisposed(),SP(this,e)},RT().prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),CP(this,e,t,n)},RT().prototype.onesLike=function(){return this.throwIfDisposed(),EP(this)},RT().prototype.pad=function(e,t){return this.throwIfDisposed(),kP(this,e,t)},RT().prototype.pool=function(e,t,n,r,i,a){return this.throwIfDisposed(),RP(this,e,t,n,r,i,a)},RT().prototype.pow=function(e){return this.throwIfDisposed(),YM(this,e)},RT().prototype.prelu=function(e){return this.throwIfDisposed(),LP(this,e)},RT().prototype.prod=function(e,t){return this.throwIfDisposed(),PP(this,e,t)},RT().prototype.reciprocal=function(){return this.throwIfDisposed(),ZP(this)},RT().prototype.relu=function(){return this.throwIfDisposed(),$P(this)},RT().prototype.relu6=function(){return this.throwIfDisposed(),eU(this)},RT().prototype.reshapeAs=function(e){return this.throwIfDisposed(),CR(this,e.shape)},RT().prototype.reshape=function(e){return this.throwIfDisposed(),CR(this,e)},RT().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),OD(this,e,t,n)},RT().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),jD(this,e,t,n)},RT().prototype.reverse=function(e){return this.throwIfDisposed(),tU(this,e)},RT().prototype.rfft=function(){return this.throwIfDisposed(),_U(this)},RT().prototype.round=function(){return this.throwIfDisposed(),sU(this)},RT().prototype.rsqrt=function(){return this.throwIfDisposed(),oU(this)},RT().prototype.selu=function(){return this.throwIfDisposed(),lU(this)},RT().prototype.separableConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),cU(this,e,t,n,r,i,a)},RT().prototype.sigmoid=function(){return this.throwIfDisposed(),TR(this)},RT().prototype.sign=function(){return this.throwIfDisposed(),hU(this)},RT().prototype.sin=function(){return this.throwIfDisposed(),dU(this)},RT().prototype.sinh=function(){return this.throwIfDisposed(),AU(this)},RT().prototype.slice=function(e,t){return this.throwIfDisposed(),BR(this,e,t)},RT().prototype.softmax=function(e){return this.throwIfDisposed(),yU(this,e)},RT().prototype.softplus=function(){return this.throwIfDisposed(),eP(this)},RT().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),FP(this,e,t)},RT().prototype.split=function(e,t){return this.throwIfDisposed(),wU(this,e,t)},RT().prototype.sqrt=function(){return this.throwIfDisposed(),PM(this)},RT().prototype.square=function(){return this.throwIfDisposed(),UM(this)},RT().prototype.squaredDifference=function(e){return this.throwIfDisposed(),SU(this,e)},RT().prototype.squeeze=function(e){return this.throwIfDisposed(),CU(this,e)},RT().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof FT?[this,e]:[this,...e];return EU(n,t)},RT().prototype.step=function(e){return this.throwIfDisposed(),NU(this,e)},RT().prototype.stridedSlice=function(e,t,n,r,i,a,s,o){return this.throwIfDisposed(),kU(this,e,t,n,r,i,a,s,o)},RT().prototype.sub=function(e){return this.throwIfDisposed(),JM(this,e)},RT().prototype.sum=function(e,t){return this.throwIfDisposed(),IL(this,e,t)},RT().prototype.tan=function(){return this.throwIfDisposed(),IU(this)},RT().prototype.tanh=function(){return this.throwIfDisposed(),MR(this)},RT().prototype.tile=function(e){return this.throwIfDisposed(),PL(this,e)},RT().prototype.toBool=function(){return this.throwIfDisposed(),IM(this,"bool")},RT().prototype.toFloat=function(){return this.throwIfDisposed(),IM(this,"float32")},RT().prototype.toInt=function(){return this.throwIfDisposed(),IM(this,"int32")},RT().prototype.topk=function(e,t){return this.throwIfDisposed(),OU(this,e,t)},RT().prototype.transpose=function(e){return this.throwIfDisposed(),XU(this,e)},RT().prototype.unique=function(e){return this.throwIfDisposed(),zU(this,e)},RT().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),HU(this,e,t)},RT().prototype.unstack=function(e){return this.throwIfDisposed(),QU(this,e)},RT().prototype.where=function(e,t){return this.throwIfDisposed(),dL(e,this,t)},RT().prototype.zerosLike=function(){return this.throwIfDisposed(),DM(this)};class yH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yH.prototype)}}class vH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vH.prototype)}}class bH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bH.prototype)}}class xH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,xH.prototype)}}class wH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,wH.prototype)}}Error;class _H{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function SH(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function CH(e,t){if(!e)throw new wH(t)}function EH(e,t){let n=0;for(const r of e)r===t&&n++;return n}function NH(e){return 1===e.length?e[0]:e}function kH(e){return Array.isArray(e)?e:[e]}function IH(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function TH(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let BH={};function MH(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function FH(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach(e=>FH(e));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?FH(t):e[n]=t.value)}}}function RH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const i=e;let a;if(i in n)a=n[i];else if(i in BH)a=BH[i];else if(a=t[i],null==a)throw new bH("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return a}{const a=e;if(null==a.className||null==a.config)throw new bH("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(a),".\n")+"'className' and 'config' must set.");const s=a.className;let o,l;if(s in n?[o,l]=n[s]:s in BH?[o,l]=BH.className:s in t&&([o,l]=t[s]),null==o)throw new bH("Unknown ".concat(r,": ").concat(s,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){const e={};for(const n of Object.keys(BH))e[n]=BH[n];for(const i of Object.keys(n))e[i]=n[i];a.config.customObjects=e;const t=Object.assign({},BH);for(const i of Object.keys(n))BH[i]=n[i];FH(a.config);const r=l(o,a.config,n,i);return BH=Object.assign({},t),r}{const e=Object.assign({},BH);for(const r of Object.keys(n))BH[r]=n[r];const t=new o(a.config);return BH=Object.assign({},e),t}}}function LH(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function PH(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function UH(e){if(null==e)throw new bH("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function DH(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new bH("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function OH(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return CH(n>=0),CH(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function jH(e,t){Array.isArray(e)?(qC(e.length>0,()=>"".concat(t," is unexpectedly an empty array.")),e.forEach((e,n)=>jH(e,"element ".concat(n+1," of ").concat(t)))):qC(Number.isInteger(e)&&e>0,()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(zH(e),"."))}function zH(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>zH(e)).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function HH(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let QH=0;function VH(){return QH++}const GH={};function WH(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in GH||(GH[e]=0),GH[e]+=1,e+GH[e].toString()}const qH=["channelsFirst","channelsLast"],KH=["nearest","bilinear"],XH=["valid","same","causal"],YH=["max","avg"],JH=["sum","mul","concat","ave"],ZH=new Map;function $H(e){DH(qH,"DataFormat",e)}function eQ(e){DH(XH,"PaddingMode",e)}function tQ(e){DH(YH,"PoolMode",e)}const nQ=[];function rQ(e,t){nQ.push(e);try{const e=t();return nQ.pop(),e}catch(n){throw nQ.pop(),n}}function iQ(e){if(!oQ(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===nQ.length?"":nQ.join("/")+"/")+e}function aQ(e){if(!oQ(e))throw new Error("Not a valid tensor name: '"+e+"'");ZH.has(e)||ZH.set(e,0);const t=ZH.get(e);if(ZH.set(e,ZH.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return ZH.set(n,1),n}return e}const sQ=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function oQ(e){return!!e.match(sQ)}function lQ(e){return e===parseInt(e.toString(),10)}function cQ(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function uQ(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function hQ(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function dQ(e,t){if(t<e)throw new bH("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let r=e;r<t;++r)n.push(r);return n}let AQ;function pQ(){return null==AQ&&(AQ=CB().epsilon()),AQ}function fQ(e,t){return IM(e,t)}function gQ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),CR(e,n)}function mQ(e,t,n){return bB(()=>{switch(e.rank){case 1:return pU(e,t,n);case 2:return fU(e,[t,0],[n,e.shape[1]]);case 3:return gU(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return mU(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return BR(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return BR(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new bH("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function yQ(e,t,n){return bB(()=>{switch(e.rank){case 1:return pU(e,t,n);case 2:return fU(e,[0,t],[e.shape[0],n]);case 3:return gU(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return mU(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new bH("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function vQ(e,t,n,r){return bB(()=>{switch(e.rank){case 1:return pU(e,t,n);case 2:switch(r){case 1:return mQ(e,t,n);case 2:return yQ(e,t,n);default:throw new bH("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return mQ(e,t,n);case 2:return gU(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return yQ(e,t,n);default:throw new bH("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return mQ(e,t,n);case 2:return mU(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return mU(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return yQ(e,t,n);default:throw new bH("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new bH("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}})}function bQ(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),kR(e,n)}function xQ(e,t){switch(e.rank){case 1:return GR([e,t]);case 2:return WR([e,t],0);case 3:return qR([e,t],0);case 4:return KR([e,t],0);default:throw new bH("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function wQ(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new bH("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return PL(e,t)}function _Q(e){return WP(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function SQ(e,t,n,r){if(e.rank<2||t.rank<2)throw new xH("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new xH("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return AD({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?NQ(e.rank,r,"channelsLast"):null,activation:n})}{const i=e.shape.slice(),a=i.pop();e=CR(e,[-1,a]);const s=t.shape.slice(),o=s.pop(),l=s.pop(),c=[...s,o],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=CR(XU(t,u),[l,-1]);const h=[...i,...c];return CR(AD({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?NQ(e.rank,r,"channelsLast"):null,activation:n}),h)}}function CQ(e,t,n){return bB(()=>(t=Array.isArray(t)?TU(t,"int32"):IM(t,"int32"),OL(e,t,n)))}function EQ(e){return LM(e,e)}function NQ(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new bH("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?CR(t,[1,r[0],1,1,1]):CR(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?CR(t,[1,1,1,1,r[0]]):CR(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?CR(t,[1,r[0],1,1]):CR(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?CR(t,[1,1,1,r[0]]):CR(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?CR(t,[1,r[0],1]):CR(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?CR(t,[1,1,r[0]]):CR(t,[1].concat(r))}else if(e<3)return t;throw new bH("Unsupported input rank by biasAdd: ".concat(t.rank))}function kQ(e,t,n){return bB(()=>(null==n&&(n="channelsLast"),$H(n),MM(e,NQ(e.rank,t,n))))}function IQ(e,t,n,r){return bB(()=>eD(e,t,n,r))}function TQ(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const BQ=["fanIn","fanOut","fanAvg"],MQ=["normal","uniform","truncatedNormal"];class FQ extends QM{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class RQ extends FQ{apply(e,t){return fP(e,t)}}RQ.className="Zeros",GM(RQ);class LQ extends FQ{apply(e,t){return gP(e,t)}}LQ.className="Ones",GM(LQ);class PQ extends FQ{constructor(e){if(super(),"object"!==typeof e)throw new bH("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new bH("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return bB(()=>LM(jM(this.value),gP(e,t)))}getConfig(){return{value:this.value}}}PQ.className="Constant",GM(PQ);class UQ extends FQ{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return KP(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}UQ.className="RandomUniform",GM(UQ);class DQ extends FQ{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new xH("randomNormal does not support dType ".concat(t,"."));return _Q(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}DQ.className="RandomNormal",GM(DQ);class OQ extends FQ{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new xH("truncatedNormal does not support dType ".concat(t,"."));return jU(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}OQ.className="TruncatedNormal",GM(OQ);class jQ extends FQ{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return bB(()=>{if(2!==e.length||e[0]!==e[1])throw new bH("Identity matrix initializer can only be used for 2D square matrices.");return LM(this.gain,UL(e[0]))})}getConfig(){return{gain:this.gain}}}jQ.className="Identity",GM(jQ);class zQ extends FQ{constructor(e){if(super(),e.scale<0)throw new bH("scale must be a positive float. Got: ".concat(e.scale));var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,DH(BQ,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){DH(MQ,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if($H(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){const r=cQ(e,2);t=e[1]*r,n=e[0]*r}else if("channelsLast"===r){const r=cQ(e,0,e.length-2);t=e[e.length-2]*r,n=e[e.length-1]*r}}else{const r=cQ(e);t=Math.sqrt(r),n=Math.sqrt(r)}return[t,n]}(e),r=n[0],i=n[1];let a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,r):"fanOut"===this.mode?a/=Math.max(1,i):a/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new xH("".concat(this.getClassName()," does not support dType ").concat(t,"."));return jU(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return KP(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}zQ.className="VarianceScaling",GM(zQ);class HQ extends zQ{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}HQ.className="GlorotUniform",GM(HQ);class QQ extends zQ{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}QQ.className="GlorotNormal",GM(QQ);class VQ extends zQ{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}VQ.className="HeNormal",GM(VQ);class GQ extends zQ{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}GQ.className="HeUniform",GM(GQ);class WQ extends zQ{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}WQ.className="LeCunNormal",GM(WQ);class qQ extends zQ{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return zQ.className}}qQ.className="LeCunUniform",GM(qQ);class KQ extends FQ{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return bB(()=>{if(e.length<2)throw new xH("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));const n=YC(e.slice(0,-1)),r=e[e.length-1],i=n*r;i>this.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(this.ELEMENTS_WARN_SLOW," (").concat(i,") elements: ")+"Slowness may result.");const a=_Q([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),s=pO.qr(a,!1);let o=s[0];const l=s[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return o=LM(o,l.sign()),n<r&&(o=o.transpose()),LM(jM(this.gain),o.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}KQ.className="Orthogonal",GM(KQ);const XQ={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function YQ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return RH(e,VM.getMap().classNameMap,t,"initializer")}function JQ(e){return MH(e)}function ZQ(e){if("string"===typeof e){const t=e in XQ?XQ[e]:e;if("GlorotNormal"===t)return new QQ;if("GlorotUniform"===t)return new HQ;if("HeNormal"===t)return new VQ;if("HeUniform"===t)return new GQ;if("LeCunNormal"===t)return new WQ;if("LeCunUniform"===t)return new qQ;{const e={};return e.className=t,e.config={},YQ(e)}}return e instanceof FQ?e:YQ(e)}function $Q(e){return Array.isArray(e)&&Array.isArray(e[0])}function eV(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function tV(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new bH("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function nV(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new bH("Expected exactly 1 Shape; got ".concat(e.length))}return e}function rV(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}const iV="Variable";class aV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:iV,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=VH(),n=null==n?iV:n,this.originalName=iQ(n),this.name=aQ(this.originalName),this.trainable_=r,this.constraint=i,this.val=GU(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function sV(e){return e.map(e=>e.read())}function oV(e){e.forEach(e=>{e[0].write(e[1])})}class lV{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class cV{constructor(e,t,n,r,i,a,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=s,this.id=VH(),null!=a&&(this.originalName=iQ(a),this.name=aQ(this.originalName)),this.rank=t.length}}let uV=0;class hV{constructor(e,t){this.callArgs=t,this.id=uV++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let dV=0;class AV extends QM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=dV++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=IH(e)+"_"+WH(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new vH("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new bH("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return NH(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return NH(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new yH("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new yH("Layer ".concat(this.name)+" is not connected, no input to return.");return NH(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new yH("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new yH("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return NH(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=kH(e);if(null==this.inputSpec||0===this.inputSpec.length)return;const n=kH(this.inputSpec);if(t.length!==n.length)throw new bH("Layer ".concat(this.name," expects ").concat(n.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(e));for(let r=0;r<t.length;r++){const e=t[r],i=n[r];if(null==i)continue;const a=e.rank;if(null!=i.ndim&&a!==i.ndim)throw new bH("Input ".concat(r," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(i.ndim,", found ndim=").concat(a));if(null!=i.maxNDim&&a>i.maxNDim)throw new bH("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(i.maxNDim,", found ndim=").concat(a));if(null!=i.minNDim&&a<i.minNDim)throw new bH("Input ".concat(r," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(i.minNDim,", found ndim=").concat(a,"."));if(null!=i.dtype&&e.dtype!==i.dtype)throw new bH("Input ".concat(r," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(i.dtype,", found dtype=").concat(e.dtype,"."));if(i.axes){const t=e.shape;for(const e in i.axes){const n=Number(e),a=i.axes[e],s=n>=0?t[n]:t[t.length+n];if(null!=a&&-1===[a,null].indexOf(s))throw new bH("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(n," of input shape to ")+"have value ".concat(a," but got shape ").concat(t,"."))}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const n=i.shape[t],a=e.shape[t];if(null!=n&&null!=a&&n!==a)throw new bH("Input ".concat(r," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(i.shape,", ")+"found shape=".concat(e.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=kH(e),r=function(e){let t=!0;for(const n of kH(e))if(!(n instanceof cV)){t=!1;break}return t}(e),i=function(e){let t=!0;for(const n of kH(e))if(n instanceof cV){t=!1;break}return t}(e);if(r===i)throw new bH("Arguments to apply() must be all SymbolicTensors or all Tensors");return rQ(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of kH(e))t.push(n.shape);this.build(NH(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);const i=kH(r),a=[];for(let e of i)-1!==n.indexOf(e)&&(e=e.clone()),a.push(e);if(r=NH(a),null!=this.activityRegularizer)throw new xH("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=kH(e);const t=[];for(const n of e)t.push(n.shape);return NH(t)}(e),r=this.computeOutputShape(n);let i;const a="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new cV(a,n,this,kH(e),t,this.name,r)):new cV(a,r,this,kH(e),t,this.name),this.addInboundNode(e,i,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new xH("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new yH("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new yH("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new vH("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return rV(this.weights)}build(e){this.built=!0}getWeights(){return sV(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){bB(()=>{const t=this.weights;if(t.length!==e.length)throw new bH('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],r=sV(t);for(let i=0;i<r.length;++i){const a=r[i],s=t[i],o=e[i];if(!JC(a.shape,o.shape))throw new bH("Layer weight shape ".concat(a.shape," ")+"not compatible with provided weight shape ".concat(o.shape));n.push([s,o])}oV(n)})}addWeight(e,t,n,r,i,a,s,o){if(-1!==this._addedWeightNames.indexOf(e))throw new bH("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():ZQ("zeros"));const l=r.apply(t,n),c=new aV(l,n,e,a,s);return l.dispose(),null!=i&&this.addLoss(()=>i.apply(c.read())),null==a&&(a=!0),a?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=kH(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach(e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")})}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),i=kH(t),a=kH(r);if(i.length!==a.length)throw new Error("".concat(this.name," outputs ").concat(i.length," tensors ")+"but ".concat(i.length," masks for those tensors"));for(let s=0;s<i.length;s++)i[s].kerasMask=a[s]}addInboundNode(e,t,n,r,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const o=kH(e);t=kH(t),n=kH(n),r=kH(r),i=eV(i),a=eV(a);const l=[],c=[],u=[];for(const h of o)l.push(h.sourceLayer),c.push(h.nodeIndex),u.push(h.tensorIndex);new hV({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:u,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},s);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function pV(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=pV(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class fV extends AV{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:WH("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new bH("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new bH("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new bH("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new cV(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new hV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new bH("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}fV.className="InputLayer",GM(fV);class gV{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof gV)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new bH("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return IM(t,e.dtype)}catch(kAe){throw new bH("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof cV){if(null==this.id2Value[e.id])throw new bH("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new bH("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof cV){if(null==this.id2Value[e.id])throw new bH("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new bH("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&xB(this.id2Mask)}}const mV=new _H,yV=new _H;function vV(e,t,n,r){const i=null!=n&&n.training,a=Array.isArray(e),s=a?e:[e],o=s.map(e=>e.name),l=[],c=t.names();for(const p of o)-1!==c.indexOf(p)?l.push(t.getValue(p)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=o.join(",")+"|"+t.names().sort().join(",");let h,d=mV.get(u);if(null==d){const e=function(e,t){qC(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(1===e.length){const i=xV(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const a of e){const{sorted:e,recipientMap:s}=xV(a,t);for(const t of e)i.has(t.name)||(n.push(t),i.add(t.name));for(const t in s)null==r[t]&&(r[t]=new Set),s[t].forEach(e=>r[t].add(e))}}return{sorted:n,recipientCounts:bV(r)}}(s,t);d=e.sorted,h=e.recipientCounts,mV.put(u,d),yV.put(u,h)}h={},i||Object.assign(h,yV.get(u));const A=new gV(t);for(let p=0;p<d.length;++p){if(null!=r){const e=vB().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=d[p],a=e.sourceLayer;if(a instanceof fV)continue;const s=[],c=[],u=[];let f=!1;for(const n of e.inputs){const e=A.getValue(n),r=A.getMask(n);s.push(e),c.push(r),null!=r&&(f=!0),i||(h[n.name]--,0!==h[n.name]||t.hasKey(n)||-1!==o.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}f&&((n=n||{}).mask=c[0]);const g=kH(a.apply(s,n));let m=null;a.supportsMasking&&(m=a.computeMask(s,c));const y=wV(e),v=Array.isArray(y)?y:[y];for(let t=0;t<v.length;++t){A.hasKey(v[t])||A.add(v[t],g[t],Array.isArray(m)?m[0]:m);const e=o.indexOf(v[t].name);-1!==e&&(l[e]=g[t])}i||xB(u)}return A.disposeMasks(),a?l:l[0]}function bV(e){const t={};for(const n in e)t[n]=e[n].size;return t}function xV(e,t){const n=new Set,r=[],i={};for(const o of t.names())n.add(o);const a=[],s=[];for(a.push(e);a.length>0;){const e=a[a.length-1];if(n.has(e.name)){a.pop();continue}const t=s[s.length-1]===a.length-1;if(0===e.inputs.length||t)a.pop(),r.push(e),n.add(e.name),t&&s.pop();else{s.push(a.length-1);for(const t of e.inputs)null==i[t.name]&&(i[t.name]=new Set),i[t.name].add(e.name),n.has(t.name)||a.push(t)}}return{sorted:r,recipientMap:i}}function wV(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function _V(e,t){return bB(()=>PM(IL(LM(e,e),t,!0)))}NE().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,function(e){null!=mV&&mV.setMaxEntries(e),null!=yV&&yV.setMaxEntries(e)});class SV extends QM{getConfig(){return{}}}class CV extends SV{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return bB(()=>{const t=_V(e,this.axis),n=VR(t,0,this.maxValue);return LM(e,RM(n,MM(pQ(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}CV.className="MaxNorm",GM(CV);class EV extends SV{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return bB(()=>RM(e,MM(pQ(),_V(e,this.axis))))}getConfig(){return{axis:this.axis}}}EV.className="UnitNorm",GM(EV);class NV extends SV{apply(e){return $P(e)}}NV.className="NonNeg",GM(NV);class kV extends SV{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return bB(()=>{const t=_V(e,this.axis),n=MM(LM(this.rate,VR(t,this.minValue,this.maxValue)),LM(1-this.rate,t));return LM(e,RM(n,MM(pQ(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}kV.className="MinMaxNorm",GM(kV);const IV={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function TV(e){return MH(e)}function BV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return RH(e,VM.getMap().classNameMap,t,"constraint")}function MV(e){if(null==e)return null;if("string"===typeof e){return BV({className:e in IV?IV[e]:e,config:{}})}return e instanceof SV?e:BV(e)}async function FV(e){if(null==e)return;const t=[],n=[],r=[];for(const i in e){const a=e[i];if("number"!==typeof a){const e=a;t.push(e.data()),n.push(i),r.push(e)}}if(t.length>0){const i=await Promise.all(t);for(let t=0;t<i.length;++t)e[n[t]]=i[t][0];xB(r)}}function RV(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var LV;!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(LV||(LV={}));class PV{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class UV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class DV extends PV{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"===typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const i=bB(()=>MM(this.totals[r],LM(e,n)));this.totals[r]=i,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:bB(()=>{const e=LM(RM(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),wB(t[n])}))}}class OV extends PV{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const i in this.history){const r=this.history[i];for(let a=0;a<r.length;++a)if("number"!==typeof r[a]){const s=r[a];e.push(s.data()),t.push(i),n.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i){this.history[t[i]][n[i]].dispose(),this.history[t[i]][n[i]]=r[i][0]}}}class jV extends PV{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||bO,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");uE(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let r,i=null!=n?n():gT();return function(){const a=null!=n?n():gT();return a-i<t||(i=a,r=e(...arguments)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await FV(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await FV(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await FV(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await FV(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await FV(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):uE(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await FV(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await FV(e),await this.trainEnd(e))}}function zV(e,t){if(null==e&&(e={}),e instanceof PV)return[e];if(Array.isArray(e)&&e[0]instanceof PV)return e;return kH(e).map(e=>new jV(e,t))}class HV{constructor(){}static registerCallbackConstructor(e,t){qC(e>=0&&Number.isInteger(e),()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)),HV.checkForDuplicate(t),null==HV.constructors[e]&&(HV.constructors[e]=[]),HV.constructors[e].push(t)}static checkForDuplicate(e){for(const t in HV.constructors){HV.constructors[+t].forEach(t=>{if(t===e)throw new bH("Duplicate callback constructor.")})}}static clear(){HV.constructors={}}static createCallbacks(e){const t=[];for(const n in HV.constructors){const r=+n;e>=r&&t.push(...HV.constructors[r])}return t.map(e=>new e)}}function QV(e,t,n,r,i,a,s,o,l){const c=new OV,u=[new DV,...HV.createCallbacks(t)];null!=e&&u.push(...e),u.push(c);const h=new UV(u);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:s,verbose:t,doValidation:o,metrics:l}),{callbackList:h,history:c}}function VV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return RH(e,VM.getMap().classNameMap,t,"layer",n)}function GV(e,t){return bB(()=>{"float32"!==e.dtype&&(e=IM(e,"float32"));const n=IL(EQ(e),t,!0),r=KM(n.shape,pQ()),i=PM(rF(n,r));return RM(e,i)})}function WV(e,t){return bB(()=>pP(EQ(JM(t,e)),-1))}function qV(e,t){return bB(()=>pP($M(JM(t,e)),-1))}function KV(e,t){return bB(()=>{const n=JM(e,t),r=VR($M(e),pQ(),Number.MAX_VALUE),i=$M(RM(n,r));return LM(100,pP(i,-1))})}function XV(e,t){return bB(()=>{const n=VR(t,pQ(),Number.MAX_VALUE),r=JL(MM(1,n)),i=VR(e,pQ(),Number.MAX_VALUE),a=JL(MM(1,i));return pP(EQ(JM(r,a)),-1)})}function YV(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bB(()=>{if(n)t=yU(t);else{const e=IL(t,t.shape.length-1,!0);t=RM(t,e)}return t=VR(t,pQ(),1-pQ()),$L(IL(LM(IM(e,"float32"),JL(t)),t.shape.length-1))})}function JV(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bB(()=>{const r=IM(DL(function(e){const t=[cQ(e.shape)];return CR(e,t)}(e)),"int32"),i=(t=VR(t,pQ(),1-pQ())).shape;return YV(CR(CP(r,i[i.length-1]),i),t,n)})}function ZV(e,t){return bB(()=>{let n;return n=VR(t,pQ(),1-pQ()),n=JL(RM(n,JM(1,n))),pP(function(e,t){if(!JC(e.shape,t.shape))throw new bH("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return bB(()=>{const n=$P(t),r=$L($M(t));return MM(JM(n,LM(t,e)),ZL(FL(r)))})}(e,n),-1)})}function $V(e,t){return bB(()=>{const n=VR(e,pQ(),1),r=VR(t,pQ(),1);return IL(LM(e,JL(RM(n,r))),-1)})}function eG(e,t){return bB(()=>{const n=GV(e,-1),r=GV(t,-1),i=LM(n,r);return $L(IL(i,-1))})}HV.constructors={};const tG={meanSquaredError:WV,meanAbsoluteError:qV,meanAbsolutePercentageError:KV,meanSquaredLogarithmicError:XV,squaredHinge:function(e,t){return bB(()=>{const n=rF(0,JM(1,LM(e,t)));return pP(EQ(n),-1)})},hinge:function(e,t){return bB(()=>{const n=rF(0,JM(1,LM(e,t)));return pP(n,-1)})},categoricalHinge:function(e,t){return bB(()=>{const n=IL(LM(e,t),-1),r=NL(LM(JM(1,e),t),-1);return rF(0,MM(1,JM(r,n)))})},logcosh:function(e,t){return bB(()=>{const n=Math.log(2),r=JM(t,e),i=JM(MM(r,eP(LM(-2,r))),n);return pP(i,-1)})},categoricalCrossentropy:YV,sparseCategoricalCrossentropy:JV,binaryCrossentropy:ZV,kullbackLeiblerDivergence:$V,poisson:function(e,t){return bB(()=>{const n=JL(MM(pQ(),t));return pP(JM(t,LM(e,n)),-1)})},cosineProximity:eG};function nG(e){if("string"===typeof e){if(e in tG)return tG[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new bH(t)}return e}function rG(e,t){return bB(()=>{const n=LM(.5,EP(t)),r=fQ(jL(t,n),e.dtype);return pP(hL(e,r),-1)})}function iG(e,t){return bB(()=>fQ(hL(rR(e,-1),rR(t,-1)),"float32"))}function aG(e,t){return bB(()=>IM(IL(iP(hL(e,1),hL(t,1))),"float32"))}function sG(e,t){return ZV(e,t)}function oG(e,t){return e.rank===t.rank&&(e=CU(e,[e.rank-1])),(t=rR(t,-1)).dtype!==e.dtype&&(t=IM(t,e.dtype)),IM(hL(e,t),"float32")}const lG=YV,cG=JV,uG={binaryAccuracy:rG,categoricalAccuracy:iG,precision:function(e,t){return bB(()=>{const n=aG(e,t),r=function(e,t){return bB(()=>IM(IL(iP(hL(e,0),hL(t,1))),"float32"))}(e,t),i=MM(n,r);return IM(dL(jL(i,0),RM(n,i),0),"float32")})},categoricalCrossentropy:lG,sparseCategoricalCrossentropy:cG,mse:WV,MSE:WV,mae:qV,MAE:qV,mape:KV,MAPE:KV,cosine:eG};function hG(e){if("string"===typeof e&&e in uG)return uG[e];if("string"!==typeof e&&null!=e)return e;throw new bH("Unknown metric ".concat(e))}function dG(e){if(CH(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(tG))if(tG[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(uG))if(uG[n]===e){t=n;break}return void 0!==t?t:e.name}}const AG=1048576;function pG(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!fG(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>AG&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(AG,"."))}}function fG(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!fG(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!fG(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function gG(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const i=function(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let e=!1;for(const n of i.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),a=["Layer (type)","Input Shape","Output shape","Param #"];let s;if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!i){a.push("Receives inputs"),s=[];for(const t in e.nodesByDepth)s.push(...e.nodesByDepth[t])}r("_".repeat(t)),mG(a,n,r),r("=".repeat(t));const o=e.layers;for(let u=0;u<o.length;++u)i?yG(o[u],n,r):vG(o[u],n,s,r),r((u===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const l=function(e){let t;t=null!=e.collectedTrainableWeights?rV(e.collectedTrainableWeights):rV(e.trainableWeights);return t}(e),c=rV(e.nonTrainableWeights);r("Total params: ".concat(l+c)),r("Trainable params: ".concat(l)),r("Non-trainable params: ".concat(c)),r("_".repeat(t))}function mG(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function yG(e,t,n){let r,i;try{i=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(kAe){i="multiple"}try{r=JSON.stringify(e.outputShape)}catch(kAe){r="multiple"}const a=e.name,s=e.getClassName();mG(["".concat(a," (").concat(s,")"),i,r,e.countParams().toString()],t,n)}function vG(e,t,n,r){let i,a;try{a=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(kAe){a="multiple"}try{i=JSON.stringify(e.outputShape)}catch(kAe){i="multiple"}const s=[];for(const u of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let e=0;e<u.inboundLayers.length;++e){const t=u.inboundLayers[e].name,n=u.nodeIndices[e],r=u.tensorIndices[e];s.push("".concat(t,"[").concat(n,"][").concat(r,"]"))}const o=e.name,l=e.getClassName(),c=0===s.length?"":s[0];mG(["".concat(o," (").concat(l,")"),a,i,e.countParams().toString(),c],t,r);for(let u=1;u<s.length;++u)mG(["","","","",s[u]],t,r)}function bG(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function xG(e,t){if(null===e)return null;if("string"===typeof e)return TH(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];bG(t,i,r)?n.push(r):n.push(xG(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"===typeof r)t[n]=r;else{const e=TH(n);t[e]=xG(r,e)}}return t}}function wG(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return IH(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];bG(t,i,r)?n.push(r):n.push(wG(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],i=IH(n);t[i]="name"!==n&&"className"!==n||"string"!==typeof r?wG(r,n):r}return t}}const _G="4.22.0";class SG extends AV{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=WH(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],PH(this.inputs).length!==this.inputs.length)throw new bH("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map(e=>e.name)));PH(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map(e=>e.name))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const m of this.outputs){const e=m.sourceLayer,t=m.nodeIndex,n=m.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const m of this.inputs){const e=m.sourceLayer,t=m.nodeIndex,n=m.tensorIndex;CH(0===t,"input layer has >1 nodes"),CH(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let m=0;m<this.inputLayers.length;m++){const t=this.inputLayers[m];if(!(t instanceof fV))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(m," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const m of this.outputLayers)this.outputNames.push(m.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);const t={},n={},r={},i={},a={},s=[],o=(e,t,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=e.sourceLayer,i=e.nodeIndex,l=e.tensorIndex);const c=r.inboundNodes[i];if(-1!==n.indexOf(c))throw new vH("The tensor ".concat(e.name,' at layer "').concat(r.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(c))return;this.containerNodes.add(SG.nodeKey(r,i)),r.id in a||(a[r.id]=Object.keys(a).length),-1===n.indexOf(c)&&n.push(c);const u=c.inboundLayers.length;for(let a=0;a<u;a++){const e=c.inputTensors[a],r=c.inboundLayers[a],i=c.nodeIndices[a],s=c.tensorIndices[a];o(e,t,n,r,i,s)}for(t.push(c);n.indexOf(c)>=0;)n.splice(n.indexOf(c),1);s.push(c)},l=[],c=[];for(const m of this.outputs)o(m,l,c);const u=s.slice().reverse();for(const m of u){n[m.id]=m,m.id in t||(t[m.id]=0);let e=t[m.id];const a=null==r[m.outboundLayer.id]?0:r[m.outboundLayer.id];e=Math.max(e,a),r[m.outboundLayer.id]=e,i[m.outboundLayer.id]=m.outboundLayer,t[m.id]=e;for(let r=0;r<m.inboundLayers.length;r++){const i=m.inboundLayers[r],a=m.nodeIndices[r],s=i.inboundNodes[a],o=null==t[s.id]?0:t[s.id];t[s.id]=Math.max(e+1,o),n[s.id]=s}}const h={};for(const m in t){const e=t[m];e in h||(h[e]=[]),h[e].push(n[m])}const d={};for(const m in r){const e=r[m];e in d||(d[e]=[]),d[e].push(i[m])}let A=Object.keys(d).map(e=>parseInt(e,10)).sort(LH);this.layers=[];for(const m of A){const e=d[m];e.sort((e,t)=>{const n=a[e.id],r=a[t.id];return n<r?-1:n>r?1:0});for(const t of e)t instanceof SG&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,A=Object.keys(h).map(e=>parseInt(e,10)).sort(LH);const p=this.inputs.slice(),f=[];for(const m of A)for(const e of h[m]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===p.indexOf(n))throw new vH("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(f));for(const t of e.outputTensors)p.push(t);f.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map(e=>e.name);for(const m of g){const e=g.filter(e=>e===m).length;if(1!==e)throw new vH('The name "'.concat(m,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new hV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new bH("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let r=0;const i=(e=>{const t=Object.keys(e);if(0===t.length)return!1;const n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))})(e);i&&this.parseWeights(e);for(const s of this.layers)for(const[e,t]of s.weights.entries()){const a=i?"".concat(t.name.split("/").slice(0,-1).join("/")+"/").concat(e):t.originalName;if(null!=n[a])throw new bH("Duplicate weight name: ".concat(a));n[a]=t,r++}const a=[];for(const s in e){let r=s;if(null==n[s]){const e=s.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])a.push([n[r],e[s]]);else if(t)throw new bH("Provided weight data has no target variable: ".concat(s));delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new bH("".concat(e.length," of ").concat(r," weights are not set: ")+"".concat(e))}oV(a)}parseWeights(e){for(const t in Object.keys(e)){const n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=n.map(e=>e.startsWith("_")?e.slice(1):e).filter(e=>!r.includes(e)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(_G),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=wG(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return bB(()=>{e=kH(e);const n=new gV;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return vV(this.outputs,n,t)})}computeMask(e,t){return bB(()=>{let n;return e=kH(e),n=null==t?SH(null,e.length):kH(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const t=eV(e);if(t.length!==this.inputLayers.length)throw new bH("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let s=0;s<t.length;s++){const e=this.inputLayers[s],r=t[s];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(LH);if(r.length>1)for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;const r=[];for(let s=0;s<t.inboundLayers.length;s++){const e=t.inboundLayers[s],i=t.nodeIndices[s],a=t.tensorIndices[s],o=n["".concat(e.name,"_").concat(i,"_").concat(a)];r.push(o)}const i=eV(e.computeOutputShape(NH(r))),a=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++){n["".concat(e.name,"_").concat(a,"_").concat(t)]=i[t]}}}const i=[],a=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],t=this.outputLayersNodeIndices[s],n=this.outputLayersTensorIndices[s],r="".concat(e.name,"_").concat(t,"_").concat(n);a.push(r)}for(let s=0;s<a.length;s++){const e=a[s];CH(e in n),i.push(n[e])}return NH(i)}runInternalGraph(e,t){null==t&&(t=SH(null,e.length));const n={};for(let o=0;o<this.inputs.length;++o){const r=this.inputs[o],i=e[o],a=t[o];n[r.id]=[i,a]}const r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(LH);for(const o of r){const e=this.nodesByDepth[o];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,a=new Array;for(const t of r)t.id in n&&a.push(n[t.id]);if(a.length===r.length){let r,s,o,l,c={};if(null!=t.callArgs&&(c=t.callArgs),1===a.length){const[t,n]=a[0];null==c.mask&&(c.mask=n),o=kH(e.call(t,c)),l=kH(e.computeMask(t,n)),r=[t],s=[n]}else r=a.map(e=>e[0]),s=a.map(e=>e[1]),null==c.mask&&(c.mask=s),o=kH(e.call(r,c)),l=kH(e.computeMask(r,s));if(e.activityRegularizer)throw new xH("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<i.length;++e){const t=i[e],r=o[e],a=l[e];n[t.id]=[r,a]}}}}const i=[],a=[],s=[];for(const o of this.outputs){CH(o.id in n,"Could not compute output ".concat(o.name," : ").concat(o.id));const[e,t]=n[o.id];s.push(e.shape),i.push(e),a.push(t)}return[i,a,s]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof SG?1:0;for(let e=0;e<r.inboundNodes.length;e++){const i=SG.nodeKey(r,e);this.containerNodes.has(i)&&(t[i]=n,n+=1)}}return t}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new bH("Provide either a layer name or layer index");if("number"===typeof e)return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new bH("No such layer: ".concat(e))}findLayer(e){if(this.layers.length<=e)throw new bH("Was asked to retrieve layer at index ".concat(e,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[e]}calculateLosses(){return bB(()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=SG.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const a of this.layers){const e=a.getClassName(),r=a.getConfig(),i=[];for(let n=0;n<a.inboundNodes.length;n++){const e=a.inboundNodes[n],r=SG.nodeKey(a,n);let s={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),s=e.callArgs}catch(kAe){console.warn("Layer ".concat(a.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),s={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const i=e.inboundLayers[r],a=e.nodeIndices[r],o=e.tensorIndices[r];let l=t[SG.nodeKey(i,a)];null==l&&(l=0),n.push([i.name,l,o,s])}i.push(n)}}}const s={};s.name=a.name,s.className=e,s.config=r,s.inboundNodes=i,n.push(s)}e.layers=n;const r=[];for(let a=0;a<this.inputLayers.length;a++){const e=this.inputLayers[a],n=this.inputLayersNodeIndices[a],i=SG.nodeKey(e,n);if(!this.containerNodes.has(i))continue;let s=t[i];null!==s&&void 0!==s||(s=0);const o=this.inputLayersTensorIndices[a];r.push([e.name,s,o])}e.inputLayers=r;const i=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],n=this.outputLayersNodeIndices[a],r=SG.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let s=t[r];null!==s&&void 0!==s||(s=0);const o=this.outputLayersTensorIndices[a];i.push([e.name,s,o])}return e.outputLayers=i,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={},i={};function a(e,t){e.name in i?i[e.name].push(t):i[e.name]=[t]}function s(e,t){const n=[];let i;for(const s of t){const o=s[0],l=s[1],c=s[2];if(i=null==s[3]?{}:s[3],!(o in r))return void a(e,t);const u=r[o];if(u.inboundNodes.length<=l)return void a(e,t);const h=u.inboundNodes[l];n.push(h.outputTensors[c])}n.length>0&&e.apply(NH(n),i)}function o(e){const i=e.name,s=VV(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(n),r[i]=s;e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new bH("Corrupted configuration, expected array for nodeData: ".concat(e));a(s,e)})}const l=t.name,c=t.layers;for(const p of c)o(p);for(;!UH(i);)for(const e of c){const t=r[e.name];if(t.name in i){const e=i[t.name];delete i[t.name];for(const n of e)s(t,n)}}const u=[],h=[],d=t.inputLayers;for(const p of d){const e=p[0],t=p[1],n=p[2];CH(e in r);const i=r[e].inboundNodes[t].outputTensors;u.push(i[n])}const A=t.outputLayers;for(const p of A){const e=p[0],t=p[1],n=p[2];CH(e in r);const i=r[e].inboundNodes[t].outputTensors;h.push(i[n])}return new e({inputs:u,outputs:h,name:l})}get stateful(){if(this._stateful)throw new bH("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){bB(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function CG(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function EG(e,t){return CG(e,t,"classWeight")}async function NG(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=bB(()=>{if(1===e.shape.length)return TM(e);if(2===e.shape.length){if(e.shape[1]>1){return rR(e,1)}if(1===e.shape[1])return CR(e,[e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),r=Array.from(await t.data());xB(t);const i=[];return r.forEach(e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");i.push(n[e])}),TU(i,"float32")}return null}function kG(e,t){return LM(e,t)}function IG(e,t){let n,r;const i=t;n=i.xs,r=i.ys,qC(null!=n&&null!=r,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t));const a=TG("input",e.inputNames,n),s=TG("output",e.outputNames,r),o=a[0].shape[0];qC(a.length===e.inputs.length,()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(a.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")),qC(s.length===e.outputs.length,()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(s.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")"));for(let l=0;l<a.length;l++)qC(a[l].shape[0]===o,()=>"Batch size mismatch: input "+"".concat(e.inputNames[l]," has ").concat(a[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));for(let l=0;l<s.length;l++)qC(s[l].shape[0]===o,()=>"Batch size mismatch: output "+"".concat(e.outputNames[l]," has ").concat(s[l].shape[0],"; ")+"expected  ".concat(o," based on input ").concat(e.inputNames[0],"."));return{xs:a,ys:s}}function TG(e,t,n){if(n instanceof FT)return[n];if(Array.isArray(n))return qC(n.length===t.length,()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")),n;{const r=[];for(const i of t){if(null==n[i])throw new bH("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(i,"'."));r.push(n[i])}return r}}async function BG(e,t,n){const r=null!=n.batchesPerEpoch;if(qC(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),qC(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),qC(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs)),qC(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch)),qC(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=null!=n.validationData;let a,s;if(i)if(MG(n.validationData))qC(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches));else{const e=function(e){if(3===e.length)throw new xH("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);a=e.xs,s=e.ys}const o=e.makeTrainFunction(),l=e.getDedupedMetricsNames();let c;c=i?l.slice().concat(l.map(e=>"val_"+e)):l.slice();const u=zV(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:A}=QV(u,h,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,i,c);d.setModel(e),e.history=A,await d.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,f=await t.iterator();for(;p<n.epochs;){const c={};await d.onEpochBegin(p);let u=0,h=0;for(r||(f=await t.iterator());!r||u<n.batchesPerEpoch;){const t=await f.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(u," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:i}=IG(e,t.value),a={};a.batch=h,a.size=r[0].shape[0],await d.onBatchBegin(h,a);const s=[];if(null!=n.classWeight){const t=EG(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)s.push(await NG(i[e],null,t[e]))}const c=r.concat(i).concat(s),A=o(c);xB(c);for(let e=0;e<l.length;++e){const t=l[e],n=A[e];a[t]=n,wB(n)}await d.onBatchEnd(h,a),RV(a),h++,u++}if(r?u>=n.batchesPerEpoch:t.done){if(i){let t;t=MG(n.validationData)?kH(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):kH(e.evaluate(a,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)c["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(p,c),p++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function MG(e){return"function"===typeof e.iterator}function FG(e){qC(e>0&&Number.isInteger(e),()=>"batchSize is required to be a positive integer, but got ".concat(e))}function RG(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>mQ(e,t,n-t)):mQ(e,t,n-t)}function LG(e,t){return bB(()=>null==e?null:Array.isArray(e)?e.map(e=>LG(e,t)):CQ(e,"int32"===t.dtype?t:IM(t,"int32")))}function PG(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function UG(e){const t=[];e instanceof FT&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(gQ(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function DG(e,t){if(null==e)return;const n=[];if(t instanceof FT)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(const i in t){const e=t[i];n.push(e.id)}const r=[];if(e instanceof FT)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(const i in e){const t=e[i];-1===n.indexOf(t.id)&&r.push(t)}r.forEach(e=>{e.isDisposed||e.dispose()})}function OG(e){return Array.isArray(e)}function jG(e){return!function(e){return e instanceof FT}(e)&&!OG(e)}function zG(e,t,n){let r,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(OG(e)&&e.length>0)t=!0;else if(jG(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new bH("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map(e=>null);if(jG(e)){r=[];for(const n of t){if(null==e[n])throw new bH('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));r.push(e[n])}}else if(OG(e)){if(e.length!==t.length)throw new bH("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new bH("The model ".concat(a," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=UG(r),null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new bH("Error when checking ".concat(a,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let t=0;t<n[s].length;++t){if(0===t&&!i)continue;const r=e.shape[t],o=n[s][t];if(null!=o&&o>=0&&r!==o)throw new bH("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(n[s].slice(1,n[s].length),"] ")+"(i.e.,tensor shape [*,".concat(n[s].slice(1,n[s].length),"])")+" but the ".concat(a," received an input with ").concat(e.shape[0])+" examples, each with shape [".concat(e.shape.slice(1,e.shape.length),"]")+" (tensor shape [".concat(e.shape,"])"))}}return r}function HG(e,t,n){let r,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new bH("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new bH("The model expects ".concat(t.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new bH("Error when checking ".concat(a,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let r=0;r<n[s].length;++r){if(0===r&&!i)continue;const o=e.shape[r],l=n[s][r];if(null!=l&&l!==o)throw new bH("Error when checking ".concat(a,": expected ")+"".concat(t[s]," to have shape ").concat(JSON.stringify(n[s])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class QG extends SG{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new bH("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");gG(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>yO.adagrad(.01),Adadelta:()=>yO.adadelta(1,.95,pQ()),Adam:()=>yO.adam(.001,.9,.999,pQ()),Adamax:()=>yO.adamax(.002,.9,.999,pQ(),0),RMSProp:()=>yO.rmsprop(.001,.9,0,pQ()),SGD:()=>yO.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new bH("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof WM))throw new bH("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new bH("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map(e=>nG(e))}else{const n=nG(e.loss);this.outputs.forEach(e=>{t.push(n)})}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new bH('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(nG(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const e=this.internalOutputShapes[a],t=this.outputNames[a];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[a])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],rQ("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map(e=>n);{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),i=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};rQ("metric",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,a;for(const s of t){if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){const t=this.internalOutputShapes[e];let i;1===t[t.length-1]||this.lossFunctions[e]===ZV?-1!==["accuracy","acc"].indexOf(s)?r=rG:-1!==["crossentropy","ce"].indexOf(s)&&(r=sG):this.lossFunctions[e]===JV?-1!==["accuracy","acc"].indexOf(s)?r=oG:-1!==["crossentropy","ce"].indexOf(s)&&(r=cG):-1!==["accuracy","acc"].indexOf(s)?r=iG:-1!==["crossentropy","ce"].indexOf(s)&&(r=lG),-1!==["accuracy","acc"].indexOf(s)?i="acc":-1!==["crossentropy","ce"].indexOf(s)&&(i="ce"),a=r,n=""+i}else{const e=hG(s);a=e,n=""+dG(s)}let t;rQ(n,()=>{t=a}),i(e,n,t)}})(r[e])}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null==n.batchSize?32:n.batchSize;FG(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const e=i[0].concat(i[1]);this.makeTestFunction();const t=this.testFunction;return NH(this.testLoop(t,e,r,n.verbose,n.steps))}finally{DG(i[0],e),DG(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,i=e.testFunction;let a=[];if(n.verbose>0)throw new xH("Verbose mode is not implemented yet.");qC(!r||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches)));const s="function"===typeof t.next?t:await t.iterator();let o=0,l=0;for(;!r||l<n.batches;){const t=await s.next();if(a=bB(()=>{if(t.value){const{xs:n,ys:r}=IG(e,t.value),s=n.concat(r),c=bB(()=>i(s));if(xB(s),0===l)for(let e=0;e<c.length;++e)a.push(jM(0));const u=s[0].shape[0];for(let e=0;e<c.length;++e){const t=c[e],n=a[e];a[e]=bB(()=>MM(a[e],LM(u,t))),l>0&&xB(n)}xB(c),o+=u,++l}return a}),t.done){r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let c=0;c<a.length;++c){const e=a[c];a[c]=RM(a[c],o),xB(e)}return NH(a)}(this,e,t)}checkNumSamples(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new bH("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new bH("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new bH("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),a=new gV;if(e instanceof FT&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new bH("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)a.add(this.inputs[t],e[t])}else for(const o of this.inputs){const t=e[o.name];if(null==t)throw new bH("No value is provided for the model's input ".concat(o.name));a.add(o,t)}const s=vV(i,a);return n?s:s[0]}retrieveSymbolicTensors(e){const t=SH(null,e.length);let n=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],a=i.map(e=>e.name);for(let r=0;r<e.length;++r){const s=a.indexOf(e[r]);if(-1!==s&&(t[r]=i[s],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new bH("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bB(()=>{const r=this.checkNumSamples(e);if(n)throw new xH("Verbose predictLoop() is not implemented yet.");const i=PG(r,t),a=this.outputs.map(e=>[]);for(let t=0;t<i.length;++t){const n=bB(()=>{const n=i[t][0],r=i[t][1],a=RG(e,n,r),s=[];if(Array.isArray(a))for(let e=0;e<a.length;++e)s.push({key:this.inputs[e],value:a[e]});else s.push({key:this.inputs[0],value:a});const o=new gV(s);return vV(this.outputs,o)});n.forEach((e,t)=>a[t].push(e))}return NH(a.map(e=>kR(e,0)))})}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=UG(e);HG(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return FG(e),this.predictLoop(n,e)}finally{DG(n,e)}}predictOnBatch(e){HG(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new vH("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let i=0;i<this.feedOutputShapes.length;++i){const e=this.feedOutputShapes[i];this.feedLossFns[i]===JV?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=PH(e.map(e=>e.shape[0]));n.sort();const r=PH(t.map(e=>e.shape[0]));if(r.sort(),n.length>1)throw new bH("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(e=>e.shape))));if(r.length>1)throw new bH("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map(e=>e.shape))));if(n.length>0&&r.length>0&&!JC(n,r))throw new bH("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(r[0]," target ")+"sample(s).")}(e=zG(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=zG(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const r=[WV,ZV,YV];for(let i=0;i<e.length;++i){const a=e[i],s=t[i],o=n[i];if(null!=s){if(s===YV&&1===a.shape[a.shape.length-1])throw new bH("You are passing a target array of shape ".concat(a.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(s)){const e=a.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const r=e[n],i=t[n];if(null!=i&&r!==i)throw new bH("A target Tensor with shape ".concat(a.shape," was passed for an ")+"output of shape ".concat(o,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new bH("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5?arguments[5]:void 0;const[s,o]=this.standardizeUserDataXY(e,t,i,a);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const e=EG(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await NG(o[t],null,e[t]))}return[s,o,l]}testLoop(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return bB(()=>{const a=this.checkNumSamples(t,n,i,"steps"),s=[];if(r>0)throw new xH("Verbose mode is not implemented yet.");if(null!=i)throw new xH("steps mode in testLoop() is not implemented yet");{const r=PG(a,n),i=TU(dQ(0,a));for(let n=0;n<r.length;++n){const a=r[n][0],o=r[n][1],l=mQ(i,a,o-a),c=LG(t,l),u=e(c);if(0===n)for(let e=0;e<u.length;++e)s.push(jM(0));for(let e=0;e<u.length;++e){const t=u[e];s[e]=MM(s[e],LM(o-a,t))}}for(let e=0;e<s.length;++e)s[e]=RM(s[e],a)}return s})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let i=r;if(EH(e,r)>1){const t=EH(e.slice(0,n),r);i+="_".concat(t)}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],s=this.collectedTrainableWeights.map(e=>e.read()),o=this.optimizer_.minimize(()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const s=new gV(e),o=vV(this.outputs,s,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],o[n]);null!=i[n]&&(e=kG(e,i[n]));const a=pP(e);t.push(a),l=0===n?e:MM(l,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],i=this.metricsTensors[n][1];e=pP(t(r[i],o[i]))}wB(e),a.push(e)}return l=pP(l),this.calculateLosses().forEach(e=>{l=MM(l,e)}),l},!0,s);return[o].concat(a)}}makeTestFunction(){this.testFunction=e=>bB(()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:r[e]});const s=new gV(a),o=vV(this.outputs,s);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],a=pP(r(i[e],o[e]));n=0===e?a:MM(n,a),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],a=pP(n(i[r],o[r]));t.push(a)}return t})}async fit(e,t){let n,r,i,a,s,o,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{const d=null==h.batchSize?32:h.batchSize;FG(d);const A=!1,p=await this.standardizeUserData(e,t,h.sampleWeight,h.classWeight,A,d);n=p[0],r=p[1],u=p[2];let f,g=!1;if(null!=h.validationData&&h.validationData.length>0){if(g=!0,2!==h.validationData.length)throw 3===h.validationData.length?new xH("validationData including sample weights is not supported yet."):new bH("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(h.validationData," is invalid."));s=h.validationData[0],o=h.validationData[1];const e=!0,t=await this.standardizeUserData(s,o,null,null,e,d);l=t[0],c=t[1],f=l.concat(c)}else if(null!=h.validationSplit&&h.validationSplit>0&&h.validationSplit<1){g=!0;const e=Math.floor(n[0].shape[0]*(1-h.validationSplit)),t=n[0].shape[0];l=RG(n,e,t),i=n,n=RG(n,0,e),c=RG(r,e,t),a=r,r=RG(r,0,e),f=l.concat(c)}else null!=h.validationSteps&&(g=!0);const m=n.concat(r).concat(u);this.checkTrainableWeightsConsistency();const y=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let b,x;g?(this.makeTestFunction(),b=this.testFunction,x=v.slice().concat(v.map(e=>"val_"+e))):(b=null,f=[],x=v.slice());const w=zV(h.callbacks,h.yieldEvery);return await this.fitLoop(y,m,v,d,h.epochs,h.verbose,w,b,f,h.shuffle,x,h.initialEpoch,null,null)}finally{this.isTraining=!1,DG(n,e),DG(r,t),DG(i,e),DG(a,t),DG(l,s),DG(c,o),null!=u&&xB(u)}}async fitLoop(e,t,n,r,i,a,s,o,l,c,u,h,d,A){null==r&&(r=32),null==i&&(i=1),null==c&&(c=!0),null==h&&(h=0);let p=!1;if(null!=o&&null!=l&&(p=!0),null!=A&&(p=!0,null==d))throw new bH("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const f=this.checkNumSamples(t,r,d,"steps_per_epoch");let g;null!=f&&(g=dQ(0,f)),null==a&&(a=1);const{callbackList:m,history:y}=QV(s,a,i,h,f,d,r,p,u);m.setModel(this),this.history=y,await m.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<i;++v){await m.onEpochBegin(v);const i={};if(null!=d)throw new xH("stepsPerEpoch mode is not implemented yet.");{if("batch"===c)throw new xH("batch shuffling is not implemneted yet");c&&QC(g);const a=TU(g),s=PG(f,r);for(let c=0;c<s.length;++c){const u={};if(await m.onBatchBegin(c,u),bB(()=>{const h=s[c][0],d=s[c][1],A=mQ(a,h,d-h);u.batch=c,u.size=d-h;const f=LG(t,A),g=e(f);for(let e=0;e<n.length;++e){const t=n[e],r=g[e];u[t]=r,wB(r)}if(c===s.length-1&&p){const e=this.testLoop(o,l,r);for(let t=0;t<n.length;++t){const r=n[t],a=e[t];wB(a),i["val_"+r]=a}}}),await m.onBatchEnd(c,u),RV(u),this.stopTraining_)break}a.dispose()}if(await m.onEpochEnd(v,i),this.stopTraining_)break}return await m.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return BG(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],i=n[1],a=this.makeTrainFunction()(r.concat(i)),s=[];for(const o of a){const e=await o.data();s.push(e[0])}return xB(a),DG(n[0],e),DG(n[1],t),NH(s)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:i[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=vB().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-vB().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=IH(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>IH(e))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!==typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=IH(n[r])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[IH(dG(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>IH(dG(e)));{const e={};for(const t in this.metrics)e[t]=IH(dG(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=VV(xG(e.optimizer_config));let n,r;if("string"===typeof e.loss)n=TH(e.loss);else if(Array.isArray(e.loss))n=e.loss.map(e=>TH(e));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=TH(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map(e=>TH(e));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=TH(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"===typeof e){const t=qB(e);if(0===t.length)throw new bH("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new bH("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new bH("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await NB(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(_G),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await NB(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=UB([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;pG(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){pG(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}QG.className="Model",GM(QG);class VG extends QG{}VG.className="Functional",GM(VG);class GG extends QG{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:WH("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new bH("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof GG||e instanceof QG;let n;if(t){if(n=e,1!==n.outputs.length)throw new bH("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new bH("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new bH("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new bH("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new fV({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new bH("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new bH("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=pV(this.outputs[0])}this.inboundNodes=[],new hV({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:SH(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(nV(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new QG({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new vH("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new vH("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new vH("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new vH("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new bH("Legacy serialization format not supported yet.");n=t}else qC(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),n=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof GG))throw new xH("Sequential.fromConfig called on non-Sequential input: ".concat(a));for(const s of n){const e=VV(s,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(e){if(null==this.model)throw new bH("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new bH("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}GG.className="Sequential",GM(GG);class WG extends QM{getConfig(){return{}}}class qG extends WG{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new xH("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return gL(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}qG.className="elu",GM(qG);class KG extends WG{apply(e){return lU(e)}}KG.className="selu",GM(KG);class XG extends WG{apply(e){return $P(e)}}XG.className="relu",GM(XG);class YG extends WG{apply(e){return bB(()=>yP(6,$P(e)))}}YG.className="relu6",GM(YG);class JG extends WG{apply(e){return e}}JG.className="linear",GM(JG);class ZG extends WG{apply(e){return TR(e)}}ZG.className="sigmoid",GM(ZG);class $G extends WG{apply(e){return function(e){return bB(()=>{const t=MM(.5,LM(.2,e));return VR(t,0,1)})}(e)}}$G.className="hardSigmoid",GM($G);class eW extends WG{apply(e){return eP(e)}}eW.className="softplus",GM(eW);class tW extends WG{apply(e){return function(e){return bB(()=>RM(e,MM($M(e),1)))}(e)}}tW.className="softsign",GM(tW);class nW extends WG{apply(e){return MR(e)}}nW.className="tanh",GM(nW);class rW extends WG{apply(e){return yU(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}rW.className="softmax",GM(rW);class iW extends WG{apply(e){return nP(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}iW.className="logSoftmax",GM(iW);class aW extends WG{apply(e){return bB(()=>bB(()=>{const t=Math.sqrt(2),n=LM(.5,MM(1,yL(RM(e,t))));return LM(e,n)}))}}aW.className="gelu",GM(aW);class sW extends WG{apply(e){return bB(()=>LM(.5,LM(e,MM(1,MR(LM(PM(RM(2,Math.PI)),MM(e,LM(.044715,YM(e,3)))))))))}}sW.className="gelu_new",GM(sW);class oW extends WG{apply(e){return bB(()=>LM(e,MR(eP(e))))}}oW.className="mish",GM(oW);class lW extends WG{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return bB(()=>LM(TR(LM(e,t)),e))}}function cW(e){return e.getClassName()}function uW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return RH(e,VM.getMap().classNameMap,t,"activation")}function hW(e){if(null==e){const e={className:"linear",config:{}};return uW(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},uW(t)}return e instanceof WG?e:uW(e)}function dW(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}lW.className="swish",GM(lW);class AW extends QM{}class pW extends AW{constructor(e){super(),dW(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return bB(()=>{let t=fP([1]);return this.hasL1&&(t=MM(t,IL(LM(this.l1,$M(e))))),this.hasL2&&(t=MM(t,IL(LM(this.l2,EQ(e))))),CR(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}pW.className="L1L2",GM(pW);const fW={l1l2:"L1L2"};function gW(e){return MH(e)}function mW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return RH(e,VM.getMap().classNameMap,t,"regularizer")}function yW(e){if(null==e)return null;if("string"===typeof e){return mW({className:e in fW?fW[e]:e,config:{}})}return e instanceof AW?e:mW(e)}class vW extends AV{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=tV(e);let n=$P(e);return null!=this.maxValue&&(n=VR(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}vW.className="ReLU",GM(vW);class bW extends AV{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=tV(e);return WL(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}bW.className="LeakyReLU",GM(bW);class xW extends AV{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=ZQ(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=yW(e.alphaRegularizer),this.alphaConstraint=MV(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new bH("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=nV(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new lV({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=tV(e),LP(e,this.alpha.read())}getConfig(){const e={alphaInitializer:JQ(this.alphaInitializer),alphaRegularizer:gW(this.alphaRegularizer),alphaConstraint:TV(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}xW.className="PReLU",GM(xW);class wW extends AV{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new xH("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=tV(e);return gL(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}wW.className="ELU",GM(wW);class _W extends AV{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=tV(e);return LM(n,IM(jL(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}_W.className="ThresholdedReLU",GM(_W);class SW extends AV{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new rW).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return bB(()=>{let n=tV(e);const r=t.mask;if(null!=r){const e=LM(JM(gP(n.shape),IM(r,n.dtype)),jM(-1e9));n=MM(n,e)}return this.axis instanceof Array?this.axis.length>1?FL(JM(n,rP(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function CW(e,t,n){if("number"===typeof e)return SH(e,t);if(e.length!==t)throw new bH("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let r=0;r<t;++r){const i=e[r];if(!lQ(i))throw new bH("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(i))}return e}function EW(e,t,n,r){if(null==e)return e;let i;return i="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((i+r-1)/r)}function NW(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+hQ([n-t,0]);else{if("same"!==r)throw new bH("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function kW(e,t){return bB(()=>($H(t),"channelsFirst"===t?XU(e,[0,2,3,1]):e))}function IW(e,t){return bB(()=>($H(t),"channelsFirst"===t?XU(e,[0,2,3,4,1]):e))}function TW(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return bB(()=>{if(null==a&&(a="channelsLast"),$H(a),3!==e.shape.length)throw new bH("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new bH("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new bH("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(n.shape.length," instead"));if("channelsFirst"===a&&(e=XU(e,[0,2,1])),"causal"===i)throw new xH("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=YR(e,t,r,"same"===i?"same":"valid","NWC",s);return null!=n&&(o=kQ(o,n)),o})}function BW(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return bB(()=>{if(null==a&&(a="channelsLast"),$H(a),3!==e.rank&&4!==e.rank)throw new bH("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new bH("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let l=kW(e,a);if("causal"===i)throw new xH("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=cD({x:l,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===a&&(l=XU(l,[0,3,1,2])),l})}function MW(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;return bB(()=>{if(null==a&&(a="channelsLast"),$H(a),4!==e.rank&&5!==e.rank)throw new bH("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new bH("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let o=IW(e,a);if("causal"===i)throw new xH("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=$R(o,t,r,"same"===i?"same":"valid","NDHWC",s),null!=n&&(o=kQ(o,n)),"channelsFirst"===a&&(o=XU(o,[0,4,1,2,3])),o})}SW.className="Softmax",GM(SW);class FW extends AV{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",FW.verifyArgs(t),this.rank=e,jH(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new xH("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=CW(t.kernelSize,e,"kernelSize"),this.strides=CW(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,eQ(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,$H(this.dataFormat),this.activation=hW(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=ZQ(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=MV(t.biasConstraint),this.biasRegularizer=yW(t.biasRegularizer),this.activityRegularizer=yW(t.activityRegularizer),this.dilationRate=CW(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new bH("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new bH("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new bH("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(CH("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!OH(e.kernelSize,"number",1,3))throw new bH("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:cW(this.activation),useBias:this.useBias,biasInitializer:JQ(this.biasInitializer),biasRegularizer:gW(this.biasRegularizer),activityRegularizer:gW(this.activityRegularizer),biasConstraint:TV(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class RW extends FW{constructor(e,t){super(e,t),this.kernel=null,RW.verifyArgs(t),this.filters=t.filters,jH(this.filters,"filters"),this.kernelInitializer=ZQ(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=MV(t.kernelConstraint),this.kernelRegularizer=yW(t.kernelRegularizer)}build(e){e=nV(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new bH("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return bB(()=>{let t;e=tV(e);const n=null==this.bias?null:this.bias.read(),r=HH(this.activation.getClassName());if(null!=r&&2===this.rank)t=BW(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=TW(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=BW(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new xH("convolutions greater than 3D are not implemented yet.");t=MW(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=nV(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<n.length;++i){const e=EW(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:JQ(this.kernelInitializer),kernelRegularizer:gW(this.kernelRegularizer),kernelConstraint:TV(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new bH("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class LW extends RW{constructor(e){super(2,e),LW.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!OH(e.kernelSize,"number",1,2))throw new bH("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}LW.className="Conv2D",GM(LW);class PW extends RW{constructor(e){super(3,e),PW.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new bH("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}PW.className="Conv3D",GM(PW);class UW extends LW{constructor(e){if(super(e),this.inputSpec=[new lV({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new bH("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=nV(e)).length)throw new bH("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new bH("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new lV({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return bB(()=>{let t=tV(e);if(4!==t.shape.length)throw new bH("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let i,a;"channelsFirst"===this.dataFormat?(i=2,a=3):(i=1,a=2);const s=n[i],o=n[a],l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,NW(s,u,l,this.padding),NW(o,h,c,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=XU(t,[0,2,3,1]));let A=ZR(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(A=XU(A,[0,3,1,2])),null!=this.bias&&(A=kQ(A,this.bias.read(),this.dataFormat)),null!=this.activation&&(A=this.activation.apply(A)),A})}computeOutputShape(e){const t=(e=nV(e)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const a=this.kernelSize[0],s=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return t[n]=this.filters,t[r]=NW(t[r],o,a,this.padding),t[i]=NW(t[i],l,s,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}UW.className="Conv2DTranspose",GM(UW);class DW extends PW{constructor(e){if(super(e),this.inputSpec=[new lV({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new bH("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(5!==(e=nV(e)).length)throw new bH("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new bH("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new lV({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return bB(()=>{let t=tV(e);if(5!==t.shape.length)throw new bH("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let i,a,s;"channelsFirst"===this.dataFormat?(s=2,i=3,a=4):(s=1,i=2,a=3);const o=n[s],l=n[i],c=n[a],u=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],A=this.strides[0],p=this.strides[1],f=this.strides[2],g=[r,NW(o,A,u,this.padding),NW(l,p,h,this.padding),NW(c,f,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=XU(t,[0,2,3,4,1]));let m=tL(t,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(m=XU(m,[0,4,1,2,3])),null!==this.bias&&(m=kQ(m,this.bias.read(),this.dataFormat)),null!==this.activation&&(m=this.activation.apply(m)),m})}computeOutputShape(e){const t=(e=nV(e)).slice();let n,r,i,a;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,a=4):(n=4,r=1,i=2,a=3);const s=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],u=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=NW(t[r],c,s,this.padding),t[i]=NW(t[i],u,o,this.padding),t[a]=NW(t[a],h,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}DW.className="Conv3DTranspose",GM(DW);class OW extends RW{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new bH("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new bH("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new bH("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=ZQ(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=yW(t.depthwiseRegularizer),this.depthwiseConstraint=MV(t.depthwiseConstraint),this.pointwiseInitializer=ZQ(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=yW(t.pointwiseRegularizer),this.pointwiseConstraint=MV(t.pointwiseConstraint)}build(e){if((e=nV(e)).length<this.rank+2)throw new bH("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new bH("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let s=0;s<this.rank;++s)i.push(1);i.push(n*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new lV({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return bB(()=>{let t;if(e=tV(e),1===this.rank)throw new xH("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=XU(e,[0,2,3,1])),t=cU(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=kQ(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=XU(t,[0,3,1,2])),t})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=JQ(this.depthwiseInitializer),e.pointwiseInitializer=JQ(this.pointwiseInitializer),e.depthwiseRegularizer=gW(this.depthwiseRegularizer),e.pointwiseRegularizer=gW(this.pointwiseRegularizer),e.depthwiseConstraint=TV(this.depthwiseConstraint),e.pointwiseConstraint=TV(this.pointwiseConstraint),e}}OW.className="SeparableConv";class jW extends OW{constructor(e){super(2,e)}}jW.className="SeparableConv2D",GM(jW);class zW extends RW{constructor(e){super(1,e),zW.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!OH(e.kernelSize,"number",1,1))throw new bH("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}zW.className="Conv1D",GM(zW);class HW extends AV{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return bB(()=>{if(e=tV(e),"channelsLast"===this.dataFormat){const t=vQ(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return vQ(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=vQ(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return vQ(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}HW.className="Cropping2D",GM(HW);class QW extends AV{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,$H(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,DH(KH,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return bB(()=>{let t=tV(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=XU(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?AO.resizeNearestNeighbor(t,[e,r]):AO.resizeBilinear(t,[e,r]);return XU(i,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?AO.resizeNearestNeighbor(t,[e,r]):AO.resizeBilinear(t,[e,r])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}QW.className="UpSampling2D",GM(QW);class VW extends FW{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=ZQ(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=MV(e.depthwiseConstraint),this.depthwiseRegularizer=yW(e.depthwiseRegularizer)}build(e){if((e=nV(e)).length<4)throw new bH("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new bH("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return bB(()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return bB(()=>{null==i&&(i="channelsLast"),$H(i);let s=kW(e,i);if(4!==e.rank)throw new bH("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new bH("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return s=lL(s,t,n,"same"===r?"same":"valid","NHWC",a),"channelsFirst"===i&&(s=XU(s,[0,3,1,2])),s})}(e=tV(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=kQ(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=nV(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=EW(t,this.kernelSize[0],this.padding,this.strides[0]),a=EW(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,a]:[e[0],i,a,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=JQ(this.depthwiseInitializer),e.depthwiseRegularizer=gW(this.depthwiseRegularizer),e.depthwiseConstraint=TV(this.depthwiseRegularizer),e}}function GW(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new bH("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function WW(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return bB(()=>{const l=t.shape.length;if(l<3)throw new bH("Input should be at least 3D, but is ".concat(l,"D."));const c=[1,0].concat(dQ(2,l));if(t=XU(t,c),null!=a)throw new xH("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&(i=IM(IM(i,"bool"),"float32"),i.rank===l-1&&(i=RL(i,-1)),i=XU(i,c)),r&&(t=tU(t,0),null!=i&&(i=tU(i,0)));const u=[];let h,d=n;const A=t.shape[0],p=QU(t);let f,g;null!=i&&(f=QU(i));for(let t=0;t<A;++t){const n=p[t],r=bB(()=>e(n,d));if(null==i)h=r[0],d=r[1];else{const e=bB(()=>{const e=f[t],n=JM(EP(e),e),i=MM(LM(r[0],e),LM(d[0],n)),a=d.map((t,i)=>MM(LM(r[1][i],e),LM(t,n)));return{output:i,newStates:a}});h=e.output,d=e.newStates}o&&u.push(h)}if(o){g=EU(u,1)}return[h,g,d]})}VW.className="DepthwiseConv2D",GM(VW);class qW extends AV{constructor(e){let t;if(super(e),null==e.cell)throw new bH("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new tq({cells:e.cell}):e.cell,null==t.stateSize)throw new bH("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new lV({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return dQ(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null)}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){$Q(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return bB(()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map(e=>null);return[e].concat(t)}return e})}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new xH("Constants support is not implemented in RNN yet.");$Q(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new lV({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!JC(this.stateSpec.map(e=>e.shape[e.shape.length-1]),i))throw new bH("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=i.map(e=>new lV({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];bB(()=>{if(!this.stateful)throw new yH("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new bH("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>fP([n,e])):this.states_=[fP([n,this.cell.stateSize])];else if(null==e)xB(this.states_),null!=this.keptStates&&(xB(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>fP([n,e])):this.states_[0]=fP([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new bH("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):xB(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,a=[n,i];if(!JC(r.shape,a))throw new bH("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(a,", received shape=").concat(r.shape));this.states_[t]=r}}this.states_=this.states_.map(e=>wB(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=GW(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let a=[],s=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new lV({shape:e.shape}));s=s.concat(this.stateSpec)}null!=r&&(t.constants=r,a=a.concat(r),this.numConstants=r.length);if(a[0]instanceof cV){const n=[e].concat(a),r=this.inputSpec.concat(s),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=i,o}return super.apply(e,t)}call(e,t){return bB(()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let i=null==t?null:t.initialState;e=tV(e),null==i&&(i=this.stateful?this.states_:this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new bH("RNN Layer has ".concat(a," state(s) but was passed ")+"".concat(i.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:r},o=WW((e,t)=>{const n=this.cell.call([e].concat(t),s);return[n[0],n.slice(1)]},e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],c=o[1],u=o[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?c:l;return this.returnState?[h].concat(u):h})}getInitialState(e){return bB(()=>{let t=fP(e.shape);return t=IL(t,[1,2]),t=gQ(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(e=>e>1?wQ(t,[1,e]):t):this.cell.stateSize>1?[wQ(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===qW.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=VV(t.cell,n);return new e(Object.assign(t,{cell:r}))}}qW.className="RNN",GM(qW);class KW extends AV{}class XW extends KW{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,jH(this.units,"units"),this.activation=hW(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=ZQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ZQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ZQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=yW(e.kernelRegularizer),this.recurrentRegularizer=yW(e.recurrentRegularizer),this.biasRegularizer=yW(e.biasRegularizer),this.kernelConstraint=MV(e.kernelConstraint),this.recurrentConstraint=MV(e.recurrentConstraint),this.biasConstraint=MV(e.biasConstraint),this.dropout=uQ([1,hQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=uQ([1,hQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=nV(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return bB(()=>{if(2!==e.length)throw new bH("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const r=null!=t.training&&t.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=nq({ones:()=>EP(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=nq({ones:()=>EP(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,s=this.recurrentDropoutMask;i=SQ(null!=a?LM(e,a):e,this.kernel.read()),null!=this.bias&&(i=kQ(i,this.bias.read())),null!=s&&(n=LM(n,s));let o=MM(i,SQ(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:cW(this.activation),useBias:this.useBias,kernelInitializer:JQ(this.kernelInitializer),recurrentInitializer:JQ(this.recurrentInitializer),biasInitializer:JQ(this.biasInitializer),kernelRegularizer:gW(this.kernelRegularizer),recurrentRegularizer:gW(this.recurrentRegularizer),biasRegularizer:gW(this.biasRegularizer),activityRegularizer:gW(this.activityRegularizer),kernelConstraint:TV(this.kernelConstraint),recurrentConstraint:TV(this.recurrentConstraint),biasConstraint:TV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}XW.className="SimpleRNNCell",GM(XW);class YW extends qW{constructor(e){e.cell=new XW(e),super(e)}call(e,t){return bB(()=>{null!=this.cell.dropoutMask&&(xB(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(xB(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}YW.className="SimpleRNN",GM(YW);class JW extends KW{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new bH("GRUCell does not support reset_after parameter set to true.");this.units=e.units,jH(this.units,"units"),this.activation=hW(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=hW(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=ZQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ZQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ZQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=yW(e.kernelRegularizer),this.recurrentRegularizer=yW(e.recurrentRegularizer),this.biasRegularizer=yW(e.biasRegularizer),this.kernelConstraint=MV(e.kernelConstraint),this.recurrentConstraint=MV(e.recurrentConstraint),this.biasConstraint=MV(e.biasConstraint),this.dropout=uQ([1,hQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=uQ([1,hQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=nV(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return bB(()=>{if(2!==e.length)throw new bH("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=nq({ones:()=>EP(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=nq({ones:()=>EP(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let s,o,l;0<this.dropout&&this.dropout<1&&(e=LM(e,i[0]));let c=SQ(e,this.kernel.read());this.useBias&&(c=kQ(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=LM(r,a[0]));const u=this.recurrentKernel.read(),[h,d]=wU(u,[2*this.units,this.units],u.rank-1),A=SQ(r,h),[p,f,g]=wU(c,3,c.rank-1),[m,y]=wU(A,2,A.rank-1);s=this.recurrentActivation.apply(MM(p,m)),o=this.recurrentActivation.apply(MM(f,y));const v=SQ(LM(o,r),d);l=this.activation.apply(MM(g,v));const b=MM(LM(s,r),LM(MM(1,$L(s)),l));return[b,b]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:cW(this.activation),recurrentActivation:cW(this.recurrentActivation),useBias:this.useBias,kernelInitializer:JQ(this.kernelInitializer),recurrentInitializer:JQ(this.recurrentInitializer),biasInitializer:JQ(this.biasInitializer),kernelRegularizer:gW(this.kernelRegularizer),recurrentRegularizer:gW(this.recurrentRegularizer),biasRegularizer:gW(this.biasRegularizer),activityRegularizer:gW(this.activityRegularizer),kernelConstraint:TV(this.kernelConstraint),recurrentConstraint:TV(this.recurrentConstraint),biasConstraint:TV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}JW.className="GRUCell",GM(JW);class ZW extends qW{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new JW(e),super(e)}call(e,t){return bB(()=>{null!=this.cell.dropoutMask&&(xB(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(xB(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}ZW.className="GRU",GM(ZW);class $W extends KW{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,jH(this.units,"units"),this.activation=hW(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=hW(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=ZQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=ZQ(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=ZQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=yW(e.kernelRegularizer),this.recurrentRegularizer=yW(e.recurrentRegularizer),this.biasRegularizer=yW(e.biasRegularizer),this.kernelConstraint=MV(e.kernelConstraint),this.recurrentConstraint=MV(e.recurrentConstraint),this.biasConstraint=MV(e.biasConstraint),this.dropout=uQ([1,hQ([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=uQ([1,hQ([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=nV(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends FQ{apply(t,r){const i=e.apply([n]),a=(new LQ).apply([n]),s=e.apply([2*n]);return xQ(xQ(i,a),s)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return bB(()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new bH("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=nq({ones:()=>EP(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=nq({ones:()=>EP(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,s=this.recurrentDropoutMask;let o,l,c,u;0<this.dropout&&this.dropout<1&&(e=LM(e,a[0]));let h=SQ(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=LM(r,s[0])),h=MM(h,SQ(r,this.recurrentKernel.read())),this.useBias&&(h=kQ(h,this.bias.read()));const[d,A,p,f]=wU(h,4,h.rank-1);o=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(A),c=MM(LM(l,i),LM(o,this.activation.apply(p))),u=this.recurrentActivation.apply(f);const g=LM(u,this.activation.apply(c));return[g,g,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:cW(this.activation),recurrentActivation:cW(this.recurrentActivation),useBias:this.useBias,kernelInitializer:JQ(this.kernelInitializer),recurrentInitializer:JQ(this.recurrentInitializer),biasInitializer:JQ(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:gW(this.kernelRegularizer),recurrentRegularizer:gW(this.recurrentRegularizer),biasRegularizer:gW(this.biasRegularizer),activityRegularizer:gW(this.activityRegularizer),kernelConstraint:TV(this.kernelConstraint),recurrentConstraint:TV(this.recurrentConstraint),biasConstraint:TV(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}$W.className="LSTMCell",GM($W);class eq extends qW{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new $W(e),super(e)}call(e,t){return bB(()=>{null!=this.cell.dropoutMask&&(xB(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(xB(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}eq.className="LSTM",GM(eq);class tq extends KW{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return bB(()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let a;for(let s=0;s<this.cells.length;++s){const o=this.cells[s];n=r[s],a=0===s?[e[0]].concat(n):[a[0]].concat(n),a=o.call(a,t),i.push(a.slice(1))}n=[];for(const e of i.slice().reverse())n.push(...e);return[a[0]].concat(n)})}build(e){let t;$Q(e)&&(e=e[0]),this.cells.forEach((n,r)=>{rQ("RNNCell_".concat(r),()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map(e=>({className:e.getClassName(),config:e.getConfig()}))};return Object.assign(Object.assign({},e),t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[];for(const i of t.cells)r.push(VV(i,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return sV(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,i=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],i[e]])}oV(t)}}function nq(e){const{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:a}=e,s=()=>null!=a?a(t(),n):IQ(t(),n),o=()=>TQ(s,t,r);if(!i||i<=1)return wB(o().clone());return Array(i).fill(void 0).map(o).map(e=>wB(e.clone()))}tq.className="StackedRNNCells",GM(tq);var rq=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class iq extends qW{constructor(e){if(e.unroll)throw new xH("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new xH("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new lV({ndim:5})]}call(e,t){return bB(()=>{if(null!=this.cell.dropoutMask&&(xB(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(xB(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new bH("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return bB(()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),i=fP([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];bB(()=>{if(!this.stateful)throw new yH("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new bH("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>fP(i)):this.states_=[fP(i)];else if(null==e)xB(this.states_),null!=this.keptStates&&(xB(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>fP(i)):this.states_[0]=fP(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new bH("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):xB(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=i;if(!JC(n.shape,r))throw new bH("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(r,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map(e=>wB(e.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:i,strides:a,dilationRate:s}=this.cell,o="channelsFirst"===t,l=e[o?3:2],c=e[o?4:3],u=EW(l,r[0],i,a[0],s[0]),h=EW(c,r[1],i,a[1],s[1]);return[...e.slice(0,2),...o?[n,u,h]:[u,h,n]]}}iq.className="ConvRNN2D";class aq extends $W{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:i,dataFormat:a,dilationRate:s}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,jH(this.filters,"filters"),this.kernelSize=CW(n,2,"kernelSize"),this.kernelSize.forEach(e=>jH(e,"kernelSize")),this.strides=CW(r||1,2,"strides"),this.strides.forEach(e=>jH(e,"strides")),this.padding=i||"valid",eQ(this.padding),this.dataFormat=a||"channelsLast",$H(this.dataFormat),this.dilationRate=CW(s||1,2,"dilationRate"),this.dilationRate.forEach(e=>jH(e,"dilationRate"))}build(e){var t;e=nV(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new bH("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const r=e[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends FQ{apply(e,t){return bQ([n.apply([r]),gP([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return bB(()=>{if(3!==e.length)throw new bH("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,r=e[0],i=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=nq({ones:()=>EP(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=(e,t,n)=>t&&t[n]?LM(t[n],e):e;let l=o(r,s,0),c=o(r,s,1),u=o(r,s,2),h=o(r,s,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=nq({ones:()=>EP(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let A=o(i,d,0),p=o(i,d,1),f=o(i,d,2),g=o(i,d,3);const[m,y,v,b]=wU(this.kernel.read(),4,3),[x,w,_,S]=this.useBias?wU(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,m,x,this.padding),c=this.inputConv(c,y,w,this.padding),u=this.inputConv(u,v,_,this.padding),h=this.inputConv(h,b,S,this.padding);const[C,E,N,k]=wU(this.recurrentKernel.read(),4,3);A=this.recurrentConv(A,C),p=this.recurrentConv(p,E),f=this.recurrentConv(f,N),g=this.recurrentConv(g,k);const I=this.recurrentActivation.apply(MM(l,A)),T=this.recurrentActivation.apply(MM(c,p)),B=MM(LM(T,a),LM(I,this.activation.apply(MM(u,f)))),M=LM(this.recurrentActivation.apply(MM(h,g)),this.activation.apply(B));return[M,M,B]})}getConfig(){const e=super.getConfig(),{units:t}=e,n=rq(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){const i=XR(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?kQ(i,n,this.dataFormat):i}recurrentConv(e,t){return XR(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}aq.className="ConvLSTM2DCell",GM(aq);class sq extends iq{constructor(e){const t=new aq(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}sq.className="ConvLSTM2D",GM(sq);class oq extends AV{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return TQ(()=>IQ(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}oq.className="Dropout",GM(oq);class lq extends oq{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}lq.className="SpatialDropout1D",GM(lq);class cq extends AV{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,jH(this.units,"units"),this.activation=hW(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=ZQ(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=ZQ(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=MV(e.kernelConstraint),this.biasConstraint=MV(e.biasConstraint),this.kernelRegularizer=yW(e.kernelRegularizer),this.biasRegularizer=yW(e.biasRegularizer),this.activityRegularizer=yW(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=nV(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=nV(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e),r=HH(this.activation.getClassName());let i;return null!=r?i=SQ(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=SQ(n,this.kernel.read()),null!=this.bias&&(i=kQ(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:cW(this.activation),useBias:this.useBias,kernelInitializer:JQ(this.kernelInitializer),biasInitializer:JQ(this.biasInitializer),kernelRegularizer:gW(this.kernelRegularizer),biasRegularizer:gW(this.biasRegularizer),activityRegularizer:gW(this.activityRegularizer),kernelConstraint:TV(this.kernelConstraint),biasConstraint:TV(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}cq.className="Dense",GM(cq);class uq extends AV{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=nV(e);for(const t of e.slice(1))if(null==t)throw new bH('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],cQ(e,1)]}call(e,t){return bB(()=>{this.invokeCallHook(e,t);let n=tV(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=XU(n,e)}return function(e){if(e.rank<=1)throw new bH("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],cQ(e.shape,1)];return CR(e,t)}(n)})}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}uq.className="Flatten",GM(uq);class hq extends AV{constructor(e){super(e),this.supportsMasking=!0,this.activation=hW(e.activation)}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e);return this.activation.apply(n)})}getConfig(){const e={activation:cW(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}hq.className="Activation",GM(hq);class dq extends AV{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return bB(()=>function(e,t){return bB(()=>{if(2!==e.shape.length)throw new bH("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return wQ(gQ(e,1),[1,t,1])})}(e=tV(e),this.n))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}dq.className="RepeatVector",GM(dq);class Aq extends AV{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let i=1,a=null;for(let o=0;o<r.length;++o){const e=r[o];if(this.isUnknown(e)){if(null!==a)throw new bH("Can only specifiy one unknown dimension.");a=o}else i*=e}const s=cQ(e);if(null!==a){if(0===i||s%i!==0)throw new bH(n);r[a]=s/i}else if(s!==i)throw new bH(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return CR(n,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Aq.className="Reshape",GM(Aq);class pq extends AV{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=dQ(1,e.dims.length+1);if(!JC(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new lV({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=nV(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return XU(tV(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}pq.className="Permute",GM(pq);class fq extends AV{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=tV(e);return nR(SP(n,this.maskValue),-1)}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e),r=nR(SP(n,this.maskValue),-1,!0);return LM(n,IM(r,n.dtype))})}}fq.className="Masking",GM(fq);class gq extends AV{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(kH(e.inputLength))}this.inputDim=e.inputDim,jH(this.inputDim,"inputDim"),this.outputDim=e.outputDim,jH(this.outputDim,"outputDim"),this.embeddingsInitializer=ZQ(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=yW(e.embeddingsRegularizer),this.activityRegularizer=yW(e.activityRegularizer),this.embeddingsConstraint=MV(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return bB(()=>this.maskZero?(e=tV(e),SP(e,DM(e))):null)}computeOutputShape(e){if(e=nV(e),null==this.inputLength)return[...e,this.outputDim];const t=kH(this.inputLength);if(t.length!==e.length-1)throw new bH('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let r=0;r<t.length;++r){const i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new bH('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==i&&(t[n]=a),n++}}return[e[0],...t,this.outputDim]}call(e,t){return bB(()=>{this.invokeCallHook(e,t);let n=tV(e);"int32"!==n.dtype&&(n=fQ(n,"int32"));const r=CQ(this.embeddings.read(),CR(n,[n.size]));return CR(r,nV(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:JQ(this.embeddingsInitializer),embeddingsRegularizer:gW(this.embeddingsRegularizer),activityRegularizer:gW(this.activityRegularizer),embeddingsConstraint:TV(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}gq.className="Embedding",GM(gq);class mq extends AV{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new xH}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new bH("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[nV(e)]),e.length<2)throw new bH("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const i of e)null!=i&&null!==i[0]&&t.push(i[0]);if(t=PH(t),t.length>1)throw new bH("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let i=1;i<e.length;++i){const t=null==e[i]?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map(e=>e.length);-1===e.indexOf(null)&&1===PH(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return bB(()=>{if(this.reshapeRequired){const t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){const r=hQ(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=gQ(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const a of e){const e=a.rank;if(null==e){const e=a.shape,r=e[0],i=e.slice(1).concat([r]);let s=CR(a,[r].concat(cQ(e.slice(1))));s=XU(s,[1,0]),s=CR(s,i),t.push(s),n=!0}else if(e>1){const r=dQ(1,e).concat([0]);t.push(XU(a,r)),n=!0}else t.push(a)}let r=this.mergeFunction(t);const i=r.rank;if(n)if(null==i){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=CR(XU(CR(r,[-1,t]),[1,0]),n)}else if(i>1){const e=[i-1].concat(dQ(0,i-1));r=XU(r,e)}return r}}return this.mergeFunction(e)})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=PH(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return bB(()=>{if(null==t)return null;if(!Array.isArray(t))throw new bH("`mask` should be an Array");if(!Array.isArray(e))throw new bH("`inputs` should be an Array");if(t.length!==e.length)throw new bH("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every(e=>null==e))return null;t=t.map(e=>null==e?e:RL(e,0));let n=t[0];for(let e=1;e<t.length-1;++e)n=iP(n,t[e]);return n})}}class yq extends mq{constructor(e){super(e)}mergeFunction(e){return bB(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=MM(t,e[n]);return t})}}yq.className="Add",GM(yq);class vq extends mq{constructor(e){super(e)}mergeFunction(e){return bB(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=LM(t,e[n]);return t})}}vq.className="Multiply",GM(vq);class bq extends mq{constructor(e){super(e)}mergeFunction(e){return bB(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=MM(t,e[n]);return LM(1/e.length,t)})}}bq.className="Average",GM(bq);class xq extends mq{constructor(e){super(e)}mergeFunction(e){return bB(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=rF(t,e[n]);return t})}}xq.className="Maximum",GM(xq);class wq extends mq{constructor(e){super(e)}mergeFunction(e){return bB(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=yP(t,e[n]);return t})}}wq.className="Minimum",GM(wq);class _q extends mq{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new bH("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let i=!1;for(const e of n)if(JC(e,t)){i=!0;break}i||n.push(t)}if(n.length>1)throw new bH("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return bB(()=>bQ(e,this.axis))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new bH("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of t.slice(1)){if(null==n[r]||null==i[r]){n[r]=null;break}n[r]+=i[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new bH("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new bH("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new bH("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return bB(()=>{let n=!0;if(t.forEach(e=>{null==e||(n=!1)}),n)return null;const r=[];for(let a=0;a<e.length;++a)null==t[a]?r.push(IM(EP(e[a]),"bool")):t[a].rank<e[a].rank?r.push(RL(t[a],-1)):r.push(t[a]);const i=kR(r,this.axis);return tR(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function Sq(e,t){for(;e<0;)e+=t;return e}_q.className="Concatenate",GM(_q);class Cq extends mq{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){qC(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new xH("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new bH("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}mergeFunction(e){if(2!==e.length)throw new bH("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>Sq(t,e[n].shape.length)):[Sq(this.axes,n.shape.length),Sq(this.axes,r.shape.length)],this.normalize&&(n=GV(n,t[0]),r=GV(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new xH("batchDot is not implemented for tensors of 4D or higher rank yet");if(qC(e.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)),qC(e.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new xH("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);const a=n;return bB(()=>{let n,s;if(r>i){n=r-i;const e=[];for(let t=0;t<n;++t)e.push(1);t=CR(t,t.shape.concat(e))}else if(i>r){n=i-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=CR(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=a[0]===a[1]?IL(LM(e,t),a[0]):IL(LM(XU(e,[1,0]),t),a[1]);else{const n=a[0]!==e.shape.length-1,r=a[1]===t.shape.length-1;s=IR(e,t,n,r)}if(n>0){let e;e=r>i?r+i-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);s=CU(s,t)}return 1===s.shape.length&&(s=RL(s,1)),s})}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[Sq(this.axes,e.length),Sq(this.axes,t.length)],n}computeOutputShape(e){qC(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new xH("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=t.concat(n);return 1===i.length&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Cq.className="Dot",GM(Cq);class Eq extends AV{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e);return TQ(()=>MM(_Q(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}Eq.className="GaussianNoise",GM(Eq);class Nq extends AV{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return bB(()=>{this.invokeCallHook(e,t);const n=tV(e);if(this.rate>0&&this.rate<1){return TQ(()=>{const e=Math.sqrt(this.rate/(1-this.rate));return LM(n,_Q(n.shape,1,e))},()=>n,t.training||!1)}return n})}}Nq.className="GaussianDropout",GM(Nq);class kq extends AV{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||tV(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return bB(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),r=()=>{const t=tV(e),r=-1.7580993408473766;let i=zL(KP(n),this.rate);i=fQ(i,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,s=-a*r*this.rate,o=MM(LM(t,i),LM(MM(i,-1),r));return MM(LM(o,a),s)};return TQ(r,()=>tV(e),t.training||!1)}return e})}}function Iq(e,t,n,r,i){let a,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)a=PR(e,t,n,r,i,s);else if(3===e.rank)a=UR(e,t,n,r,i,s);else{if(4!==e.rank)throw new xH("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");a=DR(e,t,n,r,i,s)}return a}function Tq(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return JC(r.slice().sort(),dQ(0,e.rank-1))?function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return bB(()=>{const a=xP(e,r),s=a.mean,o=a.variance;return[Iq(e,s,o,n,t,i),s,o]})}(e,t,n,r,i):function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return bB(()=>{const a=xP(e,r),s=a.mean,o=a.variance,l=[];for(const t of dQ(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);const c=CR(s,l),u=CR(o,l),h=null==t?null:CR(t,l),d=null==n?null:CR(n,l);return[Iq(e,c,u,d,h,i),s,o]})}(e,t,n,r,i)}kq.className="AlphaDropout",GM(kq);class Bq extends AV{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=ZQ(e.betaInitializer||"zeros"),this.gammaInitializer=ZQ(e.gammaInitializer||"ones"),this.movingMeanInitializer=ZQ(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=ZQ(e.movingVarianceInitializer||"ones"),this.betaConstraint=MV(e.betaConstraint),this.gammaConstraint=MV(e.gammaConstraint),this.betaRegularizer=yW(e.betaRegularizer),this.gammaRegularizer=yW(e.gammaRegularizer)}build(e){e=nV(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new bH("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new lV({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return bB(()=>{const n=null!=t.training&&t.training,r=tV(e),i=r.shape,a=i.length,s=dQ(0,a),o=this.axis>=0?this.axis:this.axis+a;s.splice(o,1);const l=SH(1,a);l[o]=i[o];const c=s.slice();c.sort();const u=!JC(c,dQ(0,a).slice(0,a-1));if(!n)return(()=>{if(u){const e=CR(this.movingMean.read(),l),t=CR(this.movingVariance.read(),l),n=this.center?CR(this.beta.read(),l):null,i=this.scale?CR(this.gamma.read(),l):null;return Iq(r,e,t,n,i,this.epsilon)}return Iq(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,A]=Tq(r,this.gamma.read(),this.beta.read(),s,this.epsilon),p=(e,t,n)=>{bB(()=>{const r=1-n,i=e.read(),a=LM(JM(i,t),r);e.write(JM(i,a))})};return(()=>{p(this.movingMean,d,this.momentum),p(this.movingVariance,A,this.momentum)})(),h})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:JQ(this.betaInitializer),gammaInitializer:JQ(this.gammaInitializer),movingMeanInitializer:JQ(this.movingMeanInitializer),movingVarianceInitializer:JQ(this.movingVarianceInitializer),betaRegularizer:gW(this.betaRegularizer),gammaRegularizer:gW(this.gammaRegularizer),betaConstraint:TV(this.betaConstraint),gammaConstraint:TV(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Bq.className="BatchNormalization",GM(Bq);class Mq extends AV{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=ZQ(e.betaInitializer||"zeros"),this.gammaInitializer=ZQ(e.gammaInitializer||"ones"),this.betaRegularizer=yW(e.betaRegularizer),this.gammaRegularizer=yW(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=nV(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i));if(this.axis.length!==PH(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map(t=>e[t]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const n=tV(e),r=n.shape,i=r.length;return bB(()=>{let{mean:e,variance:t}=xP(n,this.axis,!0);const a=SH(1,i);for(const n of this.axis)a[n]=r[n];const s=e=>null!=e&&e.shape.length!==i?CR(e,a):e;let o=this.scale?s(this.gamma.read()):null,l=this.center?s(this.beta.read()):null;const c=[],u=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(c.push(r[n]),u.push(1)):(c.push(1),u.push(r[n]));return e=PL(e,c),t=PL(t,c),null!=o&&(o=PL(o,u)),null!=l&&(l=PL(l,u)),Iq(n,e,t,l,o,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:JQ(this.betaInitializer),gammaInitializer:JQ(this.gammaInitializer),betaRegularizer:gW(this.betaRegularizer),gammaRegularizer:gW(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}Mq.className="LayerNormalization",GM(Mq);class Fq extends AV{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new bH("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new bH("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new bH("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new lV({ndim:4})]}computeOutputShape(e){let t,n;return e=nV(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return bB(()=>function(e,t,n){return bB(()=>{if(4!==e.rank)throw new bH("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new bH("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new bH("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],kP(e,r)})}(tV(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function Rq(e,t,n,r,i,a){return bB(()=>{let s;$H(i),tQ(a),eQ(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=kW(e,i);const o="same"===r?"same":"valid";return s="max"===a?hP(e,t,n,o):ER(e,t,n,o),"channelsFirst"===i&&(s=XU(s,[0,3,1,2])),s})}function Lq(e,t,n,r,i,a){return bB(()=>{let s;$H(i),tQ(a),eQ(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=IW(e,i);const o="same"===r?"same":"valid";return s="max"===a?dP(e,t,n,o):NR(e,t,n,o),"channelsFirst"===i&&(s=XU(s,[0,4,1,2,3])),s})}Fq.className="ZeroPadding2D",GM(Fq);class Pq extends AV{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new bH("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(jH(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new bH("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}jH(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,eQ(this.padding),this.inputSpec=[new lV({ndim:3})]}computeOutputShape(e){const t=EW((e=nV(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return bB(()=>{this.invokeCallHook(e,t),e=gQ(tV(e),2);const n=this.poolingFunction(tV(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return CU(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class Uq extends Pq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Rq(e,t,n,r,i,"max")}}Uq.className="MaxPooling1D",GM(Uq);class Dq extends Pq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Rq(e,t,n,r,i,"avg")}}Dq.className="AveragePooling1D",GM(Dq);class Oq extends AV{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new bH("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];jH(this.poolSize,"poolSize"),jH(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,$H(this.dataFormat),eQ(this.padding),this.inputSpec=[new lV({ndim:4})]}computeOutputShape(e){e=nV(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=EW(t,this.poolSize[0],this.padding,this.strides[0]),n=EW(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return bB(()=>(this.invokeCallHook(e,t),this.poolingFunction(tV(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class jq extends Oq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Rq(e,t,n,r,i,"max")}}jq.className="MaxPooling2D",GM(jq);class zq extends Oq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Rq(e,t,n,r,i,"avg")}}zq.className="AveragePooling2D",GM(zq);class Hq extends AV{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new bH("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];jH(this.poolSize,"poolSize"),jH(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,$H(this.dataFormat),eQ(this.padding),this.inputSpec=[new lV({ndim:5})]}computeOutputShape(e){e=nV(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=EW(t,this.poolSize[0],this.padding,this.strides[0]),n=EW(n,this.poolSize[1],this.padding,this.strides[1]),r=EW(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return bB(()=>(this.invokeCallHook(e,t),this.poolingFunction(tV(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Qq extends Hq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Lq(e,t,n,r,i,"max")}}Qq.className="MaxPooling3D",GM(Qq);class Vq extends Hq{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return $H(i),eQ(r),Lq(e,t,n,r,i,"avg")}}Vq.className="AveragePooling3D",GM(Vq);class Gq extends AV{constructor(e){super(e),this.inputSpec=[new lV({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new xH}}class Wq extends Gq{constructor(e){super(e||{})}call(e,t){return bB(()=>{const t=tV(e);return pP(t,1)})}}Wq.className="GlobalAveragePooling1D",GM(Wq);class qq extends Gq{constructor(e){super(e||{})}call(e,t){return bB(()=>{const t=tV(e);return NL(t,1)})}}qq.className="GlobalMaxPooling1D",GM(qq);class Kq extends AV{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,$H(this.dataFormat),this.inputSpec=[new lV({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new xH}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class Xq extends Kq{call(e,t){return bB(()=>{const t=tV(e);return"channelsLast"===this.dataFormat?pP(t,[1,2]):pP(t,[2,3])})}}Xq.className="GlobalAveragePooling2D",GM(Xq);class Yq extends Kq{call(e,t){return bB(()=>{const t=tV(e);return"channelsLast"===this.dataFormat?NL(t,[1,2]):NL(t,[2,3])})}}Yq.className="GlobalMaxPooling2D",GM(Yq);class Jq extends AV{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=VV(t.layer,n);delete t.layer;const i={layer:r};return Object.assign(i,t),new e(i)}}class Zq extends Jq{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=nV(e)).length<3)throw new bH("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=nV(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return bB(()=>WW((e,n)=>[tV(this.layer.call(e,t)),[]],e=tV(e),[],!1,null,null,!1,!0)[1])}}Zq.className="TimeDistributed",GM(Zq);class $q extends Jq{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=VV(n),t.goBackwards=!0!==t.goBackwards;const r={};var i;if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=VV(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,i=this.mergeMode,DH(JH,"BidirectionalMergeMode",i),e.weights)throw new xH("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(r=i.slice(1),t=i[0]):t=i[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):NH(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=GW(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const a=[],s=[];if(null!=n){const e=n.length;if(e%2>0)throw new bH("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,a.push(...n);const r=n.map(e=>new lV({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),s.push(...r)}if(null!=r)throw new xH("Support for constants in Bidirectional layers is not implemented yet.");const o=a[0]instanceof cV;for(const l of a)if(l instanceof cV!==o)throw new bH("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(a),r=this.inputSpec.concat(s),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=i,o}return super.apply(e,t)}call(e,t){return bB(()=>{const n=t.initialState;let r,i,a,s;if(null==n)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const a=n.slice(0,n.length/2),s=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:a})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=tU(i,1)),"concat"===this.mergeMode?s=bQ([r,i]):"sum"===this.mergeMode?s=MM(r,i):"ave"===this.mergeMode?s=LM(.5,MM(r,i)):"mul"===this.mergeMode?s=LM(r,i):null==this.mergeMode&&(s=[r,i]),this.returnState?null==this.mergeMode?s.concat(a):[s].concat(a):s})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){rQ(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),rQ(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=VV(t.layer);if(delete t.layer,null!=t.numConstants)throw new xH("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}$q.className="Bidirectional",GM($q);class eK extends AV{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return bB(()=>("float32"!==(e=tV(e)).dtype&&(e=fQ(e,"float32")),MM(LM(e,this.scale),this.offset)))}}eK.className="Rescaling",GM(eK);const{resizeBilinear:tK,cropAndResize:nK}=AO;class rK extends AV{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,i,a,s,o){return bB(()=>{let l,c=!1;const u=[t/a,n/s,(r+t)/a,(i+n)/s],h=[];3===e.rank?(c=!0,l=EU([e])):l=e;for(let e=0;e<l.shape[0];e++)h.push(u);const d=fB(h,[h.length,4]),A=YP(0,h.length,1,"int32"),p=nK(l,d,A,[r,i],"nearest");return fQ(c?tV(QU(p)):p,o)})}upsize(e,t,n,r){return bB(()=>fQ(tK(e,[t,n]),r))}call(e,t){return bB(()=>{const t=tV(e),n=t.dtype,r=t.shape,i=r[r.length-3],a=r[r.length-2];let s=0;i!==this.height&&(s=Math.floor((i-this.height)/2));let o=0;return a!==this.width&&(o=Math.floor((a-this.width)/2),0===o&&(o=1)),s>=0&&o>=0?this.centerCrop(t,s,o,this.height,this.width,i,a,n):this.upsize(e,this.height,this.width,n)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=nV(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}rK.className="CenterCrop",GM(rK);class iK extends AV{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return null==(e=nV(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return bB(()=>{let n;if("int32"!==(e=tV(e)).dtype&&(e=fQ(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==this.outputMode)throw new bH("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));n=tV(t.countWeights)}const r=NL(e),i=kL(e),a=jL(this.numTokens,r).bufferSync().get(0),s=zL(i,0).bufferSync().get(0);if(!a||!s)throw new bH("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(this.numTokens));return function(e,t,n,r){let i=tV(e);if("int32"!==i.dtype&&(i=fQ(i,"int32")),"int"===t)return i;const a=i.shape;if(0===i.rank&&(i=RL(i,-1)),"oneHot"===t&&1!==i.shape[i.shape.length-1]&&(i=RL(i,-1)),i.rank>2)throw new bH("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(a)+" which would result in output rank ".concat(i.rank,"."));const s=["multiHot","oneHot"].includes(t),o=i;let l;if(l=sL(o,"undefined"!==typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return l;if(r)return LM(l,r);throw new bH("When outputMode is 'tfIdf', weights must be provided.")}(e,this.outputMode,this.numTokens,n)})}}iK.className="CategoryEncoding",GM(iK);const aK=new Set(["bilinear","nearest"]);class sK extends AV{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(!aK.has(e.interpolation))throw new bH("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));this.interpolation=e.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){const t=(e=nV(e))[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return bB(()=>{const t=[this.height,this.width];if("bilinear"===this.interpolation)return AO.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return AO.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw new Error("Interpolation is ".concat(this.interpolation," but only ").concat([...aK]," are supported"))})}}sK.className="Resizing",GM(sK);class oK{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}oK.className="RandomSeed";class lK extends AV{constructor(e){super(e),this.randomGenerator=new oK(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}lK.className="BaseRandomLayer";const cK=new Set(["bilinear","nearest"]);class uK extends lK{constructor(e){super(e);const{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new bH("Invalid factor: ".concat(this.factor,". Must be positive number or tuple of 2 numbers"));this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new bH("factor must have values larger than -1. Got: ".concat(this.factor));if(this.widthUpper<this.widthLower)throw new bH("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(this.widthUpper,".\n        Got lower bound: ").concat(this.widthLower,"\n      "));if(n){if(!cK.has(n))throw new bH("Invalid interpolation parameter: ".concat(n," is not implemented"));this.interpolation=n}}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){const t=(e=nV(e))[2];return[this.imgHeight,-1,t]}call(e,t){return bB(()=>{const t=tV(e);this.imgHeight=t.shape[t.shape.length-3];const n=t.shape[t.shape.length-2];this.widthFactor=KP([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return AO.resizeBilinear(e,i);case"nearest":return AO.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(this.interpolation,"\n          but only ").concat([...cK]," are supported"))}})}}uK.className="RandomWidth",GM(uK);var hK,dK;NE().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(hK||(hK={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(dK||(dK={}));const AK={};function pK(e){return AK[e]}function fK(e,t,n,r,i){const a=t.inputParams[e];if(a&&void 0!==a.inputIndexStart){const e=a.inputIndexStart,s=0===a.inputIndexEnd?void 0:void 0===a.inputIndexEnd?e+1:a.inputIndexEnd,o=e<0?t.inputNames.length+e:e;if("tensor"===a.type)return gK(t.inputNames[o],n,r,i);if("tensors"===a.type){const a=t.inputs.slice(e,s),o=t.inputNames.slice(e,s).filter((e,t)=>{var n;return"NoOp"!==(null===(n=a[t])||void 0===n?void 0:n.op)});return o.map(e=>gK(e,n,r,i))}const l=gK(t.inputNames[o],n,r,i),c=l.dataSync();return"number"===a.type?c[0]:gE(l.shape,c)}const s=t.attrParams[e];return s&&s.value}function gK(e,t,n,r){const[i,a]=bK(e,n);if(null!=r){const e=r.getHashTableHandleByName(i);if(null!=e)return e}const s=n.currentContextIds.find(e=>!!t[vK(i,e)]);return void 0!==s?t[vK(i,s)][a]:void 0}function mK(e,t,n){return t[vK(e,n.currentContextId)]}function yK(e,t){const[n,r,i]=bK(e,t);return[vK(n,t&&t.currentContextId),r,i]}function vK(e,t){return t?"".concat(e,"-").concat(t):e}function bK(e,t){if(""===e)return["",0,void 0];const n=null!=t&&null!=t.parseNodeNameCache;if(n){const n=t.parseNodeNameCache.get(e);if(null!=n)return n}const r=e.split(":");let i;if(1===r.length)i=[e,0,void 0];else{const e=r[0],t=3===r.length?r[1]:void 0;i=[e,Number(r[r.length-1]),t]}return n&&t.parseNodeNameCache.set(e,i),i}function xK(e,t,n){let r=fK("pad",e,t,n);if("explicit"===r){r=fK("explicitPaddings",e,t,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let e=0;e<4;e++)i[e][0]=r[2*e],i[e][1]=r[2*e+1];return i}return r}function wK(e){return e.kept?e:TM(e)}const _K=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],SK=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],CK=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],EK=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],NK=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],kK=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],IK=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],TK=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],BK=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],MK=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],FK=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],RK=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],LK=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],PK=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],UK=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],DK=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],OK=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],jK=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],zK=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];class HK{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[].concat(...[o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S,C].map(e=>e.json));this.opMappers=e.reduce((e,t)=>(e[t.tfOpName]=t,e),{})}transformGraph(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.node,r=[],i=[],a=[],s=n.reduce((e,t)=>(e[t.name]=this.mapNode(t),t.op.startsWith("Placeholder")?r.push(e[t.name]):"Const"===t.op?i.push(e[t.name]):null!=t.input&&0!==t.input.length||a.push(e[t.name]),e),{});let o=[];const l=[];let c={},u={};null!=t&&(c=this.mapSignatureEntries(t.inputs),u=this.mapSignatureEntries(t.outputs));const h=Object.keys(s);h.forEach(e=>{const t=s[e];t.inputNames.forEach((e,n)=>{const[r,,i]=yK(e),a=s[r];if(null!=a.outputs){const e=a.outputs.indexOf(i);if(-1!==e){const i="".concat(r,":").concat(e);t.inputNames[n]=i}}t.inputs.push(a),a.children.push(t)})}),0===Object.keys(u).length?h.forEach(e=>{const t=s[e];0===t.children.length&&l.push(t)}):Object.keys(u).forEach(e=>{const[t]=yK(e),n=s[t];null!=n&&(n.signatureKey=u[e],l.push(n))}),Object.keys(c).length>0?Object.keys(c).forEach(e=>{const[t]=yK(e),n=s[t];n&&(n.signatureKey=c[e],o.push(n))}):o=r;let d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((e,t)=>(e[t.signature.name]=this.mapFunction(t),e),{}));const A={nodes:s,inputs:o,outputs:l,weights:i,placeholders:r,signature:t,functions:d};return a.length>0&&(A.initNodes=a),A}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){const t=pK(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});const n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(e=>e.startsWith("^")?e.slice(1):e),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((e,t)=>(e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((t,n)=>{const r=n.type;let i;switch(n.type){case"string":i=VK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=VK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=eX(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=eX(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=WK(e.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=WK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=$K(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=$K(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=GK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=GK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=nX(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=nX(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=ZK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=ZK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=tX(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=tX(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=XK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=XK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=YK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=YK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=KK(e.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=KK(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:i,type:r},t},{})),n}mapFunction(e){const t=e.nodeDef,n=[];let r={};null!=t&&(r=t.reduce((e,t)=>(e[t.name]=this.mapNode(t),"Const"===t.op&&n.push(e[t.name]),e),{}));const i=[],a=[];e.signature.inputArg.forEach(e=>{const[t]=yK(e.name),n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:qK(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),r[t]=n});Object.keys(r).forEach(e=>{const t=r[e];t.inputNames.forEach((e,n)=>{const[i,,a]=yK(e),s=r[i];if(null!=s.outputs){const e=s.outputs.indexOf(a);if(-1!==e){const r="".concat(i,":").concat(e);t.inputNames[n]=r}}t.inputs.push(s),s.children.push(t)})});const s=e.ret;e.signature.outputArg.forEach(e=>{const[t,n]=yK(s[e.name]),i=r[t];null!=i&&(i.defaultOutput=n,a.push(i))});const o=this.mapArgsToSignature(e);return{nodes:r,inputs:i,outputs:a,weights:n,placeholders:[],signature:o}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((e,t)=>(e[t.name]=this.mapArgToTensorInfo(t),e),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}function QK(e,t){const n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){const t=NE().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function VK(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e[t];return null!=i?QK(i.s,r):n}function GK(e,t,n){const r=e[t];return r?r.b:n}function WK(e,t,n){const r=e[t]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof i?i:parseInt(i,10)}function qK(e){switch("string"===typeof e&&(e=hK[e]),e){case hK.DT_FLOAT:case hK.DT_HALF:return"float32";case hK.DT_INT32:case hK.DT_INT64:case hK.DT_INT8:case hK.DT_UINT8:return"int32";case hK.DT_BOOL:return"bool";case hK.DT_DOUBLE:return"float32";case hK.DT_STRING:return"string";case hK.DT_COMPLEX64:case hK.DT_COMPLEX128:return"complex64";default:return null}}function KK(e,t,n){const r=e[t];return r&&r.func?r.func.name:n}function XK(e,t,n){const r=e[t];return r&&r.type?qK(r.type):n}function YK(e,t,n){const r=e[t];return r&&r.list&&r.list.type?r.list.type.map(e=>qK(e)):n}function JK(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(e=>"number"===typeof e.size?e.size:parseInt(e.size,10)):[]}function ZK(e,t,n){const r=e[t];return r&&r.shape?JK(r.shape):n}function $K(e,t,n){const r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(e=>"number"===typeof e?e:parseInt(e,10)):n}function eX(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e[t];return i&&i.list&&i.list.s?i.list.s.map(e=>QK(e,r)):n}function tX(e,t,n){const r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(e=>JK(e)):n}function nX(e,t,n){const r=e[t];return r&&r.list&&r.list.b?r.list.b:n}class rX{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(e=>this.getInput(e)),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce((e,t)=>(e[t]=this.getAttr(t),e),{}))}getInput(e){return gK(e,this.tensorMap,this.context)}getAttr(e,t){const n=this.node.rawAttrs[e];if(null!=n.tensor)return gK(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return WK(this.node.rawAttrs,e,t);if(null!=n.s)return VK(this.node.rawAttrs,e,t);if(null!=n.b)return GK(this.node.rawAttrs,e,t);if(null!=n.shape)return ZK(this.node.rawAttrs,e,t);if(null!=n.type)return XK(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return $K(this.node.rawAttrs,e,t);if(null!=n.list.s)return eX(this.node.rawAttrs,e,t);if(null!=n.list.shape)return tX(this.node.rawAttrs,e,t);if(null!=n.list.b)return nX(this.node.rawAttrs,e,t);if(null!=n.list.type)return YK(this.node.rawAttrs,e,t)}return t}}function iX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){qC(e.length===t.length,()=>n+" Shapes ".concat(e," and ").concat(t," must match"));for(let r=0;r<e.length;r++){const i=e[r],a=t[r];qC(i<0||a<0||i===a,()=>n+" Shapes ".concat(e," and ").concat(t," must match"))}}}function aX(e){return"number"!==typeof e&&!e.some(e=>e<0)}function sX(e,t,n){let r=oX(e,n);const i=!aX(r);if(i&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(i&&t.forEach(e=>{r=oX(e.shape,r)}),!aX(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function oX(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));const n=[];for(let r=0;r<e.length;++r){const i=e[r],a=t[r];if(i>=0&&a>=0&&i!==a)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=i>=0?i:a}return n}class lX{constructor(e,t,n,r,i,a,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=jM(0),wB(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.tensor.id)||t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));const t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(e=>this.read(e))}write(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));const n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),iX(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,wB(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((e,n)=>this.write(e,t[n]))}gather(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(let t=0;t<this.size();t++)e.push(t)}if(0===e.length)return fB([],[0].concat(this.elementShape));const n=this.readMany(e);return iX(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),EU(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return fB([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const n=this.readMany(t);return iX(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(n[0].shape,")")),kR(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));const n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,QU(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));let n=0;const r=e.map(e=>(n+=e,n));if(n!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(n,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");const i=0===n?0:t.size/n,a=[];bB(()=>{t=CR(t,[1,n,i]);for(let n=0;n<e.length;++n){const s=[0,0===n?0:r[n-1],0],o=[1,e[n],i];a[n]=CR(BR(t,s,o),this.elementShape)}return a});const s=[];for(let o=0;o<e.length;o++)s[o]=o;this.writeMany(s,a)}}class cX{get id(){return this.idTensor.id}constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach(e=>{if(n!==e.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(e.dtype));iX(t,e.shape,"TensorList shape mismatch: "),wB(e)}),this.idTensor=jM(0),this.maxNumElements=r,wB(this.idTensor)}copy(){return new cX([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==n&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));iX(e,this.elementShape,"TensorList shape mismatch: ");const r=sX(this.elementShape,this.tensors,e);return bB(()=>{const e=this.tensors.map(e=>CR(e,r));return EU(e,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=sX(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,iX(r.shape,e,"TensorList shape mismatch: "),CR(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(iX(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");wB(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));const t=new cX([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));iX(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=sX(this.elementShape,this.tensors,t);return CR(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));iX(this.elementShape,t.shape,"TensorList shape mismatch: "),wB(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));iX(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=sX(this.elementShape,this.tensors,n);return 0===e.length?fB([],[0].concat(r)):bB(()=>{const t=e.map(e=>CR(this.tensors[e],r));return EU(t,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));iX(this.elementShape,t,"TensorList shape mismatch: ");const n=sX(this.elementShape,this.tensors,t);return 0===this.size()?fB([],[0].concat(n)):bB(()=>{const e=this.tensors.map(e=>CR(e,n));return kR(e,0)})}}const uX=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{const r=fK("thenBranch",e,t,n),i=fK("elseBranch",e,t,n),a=fK("cond",e,t,n),s=fK("args",e,t,n);return(await a.data())[0]?n.functionMap[r].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=fK("body",e,t,n),i=fK("cond",e,t,n),a=fK("args",e,t,n),s=await n.functionMap[i].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap),o=a.map(e=>e.id);let l=await s[0].data();s.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||e.dispose()});let c=a;for(;l[0];){const e=c;c=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const t=c.map(e=>e.id);e.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()});const a=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await a[0].data(),a.forEach(e=>{e.kept||-1!==o.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()})}return c}case"LoopCond":return[wK(fK("pred",e,t,n))];case"Switch":{const r=fK("pred",e,t,n);let i=fK("data",e,t,n);return i.kept||(i=wK(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=e.inputNames.find(e=>void 0!==gK(e,t,n));if(r){return[wK(gK(r,t,n))]}return}case"Enter":{const r=fK("frameName",e,t,n),i=fK("tensor",e,t,n);return n.enterFrame(r),[wK(i)]}case"Exit":{const r=fK("tensor",e,t,n);return n.exitFrame(),[wK(r)]}case"NextIteration":{const r=fK("tensor",e,t,n);return n.nextIteration(),[wK(r)]}case"TensorArrayV3":{const r=fK("size",e,t,n),i=fK("dtype",e,t,n),a=fK("elementShape",e,t,n),s=fK("dynamicSize",e,t,n),o=fK("clearAfterRead",e,t,n),l=fK("identicalElementShapes",e,t,n),c=fK("name",e,t,n),u=new lX(c,i,r,a,l,s,o);return n.addTensorArray(u),[u.idTensor,jM(1)]}case"TensorArrayWriteV3":{const r=fK("tensorArrayId",e,t,n),i=fK("index",e,t,n),a=fK("tensor",e,t,n),s=n.getTensorArray(r.id);return s.write(i,a),[s.idTensor]}case"TensorArrayReadV3":{const r=fK("tensorArrayId",e,t,n),i=fK("index",e,t,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=fK("tensorArrayId",e,t,n),i=fK("indices",e,t,n),a=fK("dtype",e,t,n);return[n.getTensorArray(r.id).gather(i,a)]}case"TensorArrayScatterV3":{const r=fK("tensorArrayId",e,t,n),i=fK("indices",e,t,n),a=fK("tensor",e,t,n),s=n.getTensorArray(r.id);return s.scatter(i,a),[s.idTensor]}case"TensorArrayConcatV3":{const r=fK("tensorArrayId",e,t,n),i=n.getTensorArray(r.id),a=fK("dtype",e,t,n);return[i.concat(a)]}case"TensorArraySplitV3":{const r=fK("tensorArrayId",e,t,n),i=fK("tensor",e,t,n),a=fK("lengths",e,t,n),s=n.getTensorArray(r.id);return s.split(a,i),[s.idTensor]}case"TensorArraySizeV3":{const r=fK("tensorArrayId",e,t,n);return[jM(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=fK("tensorArrayId",e,t,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=fK("tensorListId",e,t,n),i=fK("index",e,t,n),a=fK("tensor",e,t,n),s=n.getTensorList(r.id);return s.setItem(i,a),[s.idTensor]}case"TensorListGetItem":{const r=fK("tensorListId",e,t,n),i=fK("index",e,t,n),a=fK("elementShape",e,t,n),s=fK("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(i,a,s)]}case"TensorListScatterV2":case"TensorListScatter":{const r=fK("indices",e,t,n),i=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));const i=Math.max(...t);if(null!=r&&-1!==r&&i>=r)throw new Error("Max index must be < array size (".concat(i,"  vs. ").concat(r,")"));const a=new cX([],n,e.dtype,r),s=QU(e,0);return t.forEach((e,t)=>{a.setItem(e,s[t])}),a}(fK("tensor",e,t,n),r,fK("elementShape",e,t,n),fK("numElements",e,t,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=fK("elementShape",e,t,n),i=fK("elementDType",e,t,n);let a;a="TensorListReserve"===e.op?"numElements":"maxNumElements";const s=fK(a,e,t,n),o=function(e,t,n,r){return new cX([],e,t,r)}(r,i,0,"TensorListReserve"===e.op?-1:s);return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=fK("tensorListId",e,t,n),i=fK("indices",e,t,n),a=fK("elementShape",e,t,n),s=fK("elementDType",e,t,n);return[n.getTensorList(r.id).gather(i,s,a)]}case"TensorListStack":{const r=fK("tensorListId",e,t,n),i=fK("elementShape",e,t,n),a=fK("elementDType",e,t,n),s=fK("numElements",e,t,n);return[n.getTensorList(r.id).stack(i,a,s)]}case"TensorListFromTensor":{const r=function(e,t,n){const r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));iX(e.shape.slice(1),t,"TensorList shape mismatch: ");const i=QU(e);return new cX(i,t,r)}(fK("tensor",e,t,n),fK("elementShape",e,t,n),fK("elementDType",e,t,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=fK("tensorListId",e,t,n),i=n.getTensorList(r.id),a=fK("dtype",e,t,n),s=fK("elementShape",e,t,n);return[i.concat(a,s)]}case"TensorListPushBack":{const r=fK("tensorListId",e,t,n),i=fK("tensor",e,t,n),a=n.getTensorList(r.id);return a.pushBack(i),[a.idTensor]}case"TensorListPopBack":{const r=fK("tensorListId",e,t,n),i=fK("elementShape",e,t,n),a=fK("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(i,a)]}case"TensorListSplit":{const r=fK("tensor",e,t,n),i=fK("elementShape",e,t,n),a=function(e,t,n){let r=0;const i=t.map(e=>(r+=e,r));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));const a=oX(e.shape.slice(1),n),s=0===r?0:e.size/r,o=bB(()=>{const n=[];e=CR(e,[1,r,s]);for(let r=0;r<t.length;++r){const o=[0,0===r?0:i[r-1],0],l=[1,t[r],s];n[r]=CR(BR(e,o,l),a)}return e.dispose(),n}),l=new cX([],n,e.dtype,t.length);for(let c=0;c<o.length;c++)l.setItem(c,o[c]);return l}(r,fK("lengths",e,t,n),i);return n.addTensorList(a),[a.idTensor]}case"TensorListLength":{const r=fK("tensorListId",e,t,n);return[jM(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=fK("tensorListId",e,t,n),i=fK("size",e,t,n),a=n.getTensorList(r.id).resize(i);return n.addTensorList(a),[a.idTensor]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function hX(e,t,n){const[r,i]=fK("fusedOps",e,t,n),a="biasadd"===r,s=!a,o="prelu"===i,l="fusedbatchnorm"===r,c=fK("numArgs",e,t,n);if(a){if(o&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&a&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=fK("strides",e,t,n),h=xK(e,t,n),d=fK("dataFormat",e,t,n).toUpperCase(),A=fK("dilations",e,t,n);let[p,f]=fK("args",e,t,n);s&&(f=p,p=void 0);return{stride:u,pad:h,dataFormat:d,dilations:A,biasArg:p,preluArg:f,activationFunc:i,leakyreluAlpha:fK("leakyreluAlpha",e,t,n)}}function dX(e,t,n){return{boxes:fK("boxes",e,t,n),scores:fK("scores",e,t,n),maxOutputSize:fK("maxOutputSize",e,t,n),iouThreshold:fK("iouThreshold",e,t,n),scoreThreshold:fK("scoreThreshold",e,t,n),softNmsSigma:fK("softNmsSigma",e,t,n)}}class AX{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=jM(0),this.tensorMap=new Map,wB(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return jM(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),bB(()=>{const e=QU(t),r=n.length,i=e.length;qC(r===i,()=>"The number of elements doesn't match, keys has "+"".concat(r," elements, the values has ").concat(i," ")+"elements.");for(let t=0;t<r;t++){const r=n[t],i=e[t];wB(i),this.tensorMap.set(r,i)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const n=await e.data();return bB(()=>{const e=[];for(let r=0;r<n.length;r++){const i=n[r],a=this.findWithDefault(i,t);e.push(a)}return EU(e)})}findWithDefault(e,t){const n=this.tensorMap.get(e);return null!=n?n:t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}function pX(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bB;const a=((e,t,n)=>{switch(e.category){case"arithmetic":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(fK("a",e,t,n),fK("b",e,t,n))];case"AddN":return[r.addN(fK("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(fK("a",e,t,n),fK("b",e,t,n))];case"Mul":return[r.mul(fK("a",e,t,n),fK("b",e,t,n))];case"RealDiv":case"Div":return[r.div(fK("a",e,t,n),fK("b",e,t,n))];case"DivNoNan":return[r.divNoNan(fK("a",e,t,n),fK("b",e,t,n))];case"FloorDiv":return[r.floorDiv(fK("a",e,t,n),fK("b",e,t,n))];case"Sub":return[r.sub(fK("a",e,t,n),fK("b",e,t,n))];case"Minimum":return[r.minimum(fK("a",e,t,n),fK("b",e,t,n))];case"Maximum":return[r.maximum(fK("a",e,t,n),fK("b",e,t,n))];case"Pow":return[r.pow(fK("a",e,t,n),fK("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(fK("a",e,t,n),fK("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"basic_math":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(fK("x",e,t,n))];case"Acos":return[r.acos(fK("x",e,t,n))];case"Acosh":return[r.acosh(fK("x",e,t,n))];case"Asin":return[r.asin(fK("x",e,t,n))];case"Asinh":return[r.asinh(fK("x",e,t,n))];case"Atan":return[r.atan(fK("x",e,t,n))];case"Atan2":return[r.atan2(fK("x",e,t,n),fK("y",e,t,n))];case"Atanh":return[r.atanh(fK("x",e,t,n))];case"Ceil":return[r.ceil(fK("x",e,t,n))];case"Complex":return[r.complex(fK("real",e,t,n),fK("imag",e,t,n))];case"Cos":return[r.cos(fK("x",e,t,n))];case"Cosh":return[r.cosh(fK("x",e,t,n))];case"Elu":return[r.elu(fK("x",e,t,n))];case"Erf":return[r.erf(fK("x",e,t,n))];case"Exp":return[r.exp(fK("x",e,t,n))];case"Expm1":return[r.expm1(fK("x",e,t,n))];case"Floor":return[r.floor(fK("x",e,t,n))];case"Log":return[r.log(fK("x",e,t,n))];case"Log1p":return[r.log1p(fK("x",e,t,n))];case"Imag":return[r.imag(fK("x",e,t,n))];case"Neg":return[r.neg(fK("x",e,t,n))];case"Reciprocal":return[r.reciprocal(fK("x",e,t,n))];case"Real":return[r.real(fK("x",e,t,n))];case"Relu":return[r.relu(fK("x",e,t,n))];case"Round":return[r.round(fK("x",e,t,n))];case"Selu":return[r.selu(fK("x",e,t,n))];case"Sigmoid":return[r.sigmoid(fK("x",e,t,n))];case"Sin":return[r.sin(fK("x",e,t,n))];case"Sign":return[r.sign(fK("x",e,t,n))];case"Sinh":return[r.sinh(fK("x",e,t,n))];case"Softplus":return[r.softplus(fK("x",e,t,n))];case"Sqrt":return[r.sqrt(fK("x",e,t,n))];case"Square":return[r.square(fK("x",e,t,n))];case"Tanh":return[r.tanh(fK("x",e,t,n))];case"Tan":return[r.tan(fK("x",e,t,n))];case"ClipByValue":return[r.clipByValue(fK("x",e,t,n),fK("clipValueMin",e,t,n),fK("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(fK("x",e,t,n))];case"Rsqrt":return[r.rsqrt(gK(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(fK("x",e,t,n),fK("alpha",e,t,n))];case"Prelu":return[r.prelu(fK("x",e,t,n),fK("alpha",e,t,n))];case"IsNan":return[r.isNaN(gK(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(gK(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(gK(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"control":return uX(e,t,n);case"convolution":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Conv1D":{const i=fK("stride",e,t,n),a=fK("pad",e,t,n),s=fK("dataFormat",e,t,n).toUpperCase(),o=fK("dilation",e,t,n);return[r.conv1d(fK("x",e,t,n),fK("filter",e,t,n),i,a,s,o)]}case"Conv2D":{const i=fK("strides",e,t,n),a=xK(e,t,n),s=fK("dataFormat",e,t,n).toUpperCase(),o=fK("dilations",e,t,n);return[r.conv2d(fK("x",e,t,n),fK("filter",e,t,n),[i[1],i[2]],a,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:i,pad:a,dataFormat:s,dilations:o,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=hX(e,t,n);return[r.fused.conv2d({x:fK("x",e,t,n),filter:fK("filter",e,t,n),strides:[i[1],i[2]],pad:a,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:a,dataFormat:s,dilations:o,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=hX(e,t,n);return[r.fused.depthwiseConv2d({x:fK("x",e,t,n),filter:fK("filter",e,t,n),strides:[i[1],i[2]],pad:a,dataFormat:s,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=fK("outputShape",e,t,n),a=fK("strides",e,t,n),s=xK(e,t,n);return[r.conv2dTranspose(fK("x",e,t,n),fK("filter",e,t,n),i,[a[1],a[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=fK("strides",e,t,n),a=xK(e,t,n),s=fK("dilations",e,t,n),o=fK("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(fK("input",e,t,n),fK("filter",e,t,n),[i[1],i[2]],a,o,[s[1],s[2]])]}case"Conv3D":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("dataFormat",e,t,n).toUpperCase(),o=fK("dilations",e,t,n);return[r.conv3d(fK("x",e,t,n),fK("filter",e,t,n),[i[1],i[2],i[3]],a,s,[o[1],o[2],o[3]])]}case"AvgPool":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("kernelSize",e,t,n);return[r.avgPool(fK("x",e,t,n),[s[1],s[2]],[i[1],i[2]],a)]}case"MaxPool":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("kernelSize",e,t,n);return[r.maxPool(fK("x",e,t,n),[s[1],s[2]],[i[1],i[2]],a)]}case"MaxPoolWithArgmax":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("kernelSize",e,t,n),o=fK("includeBatchInIndex",e,t,n),{result:l,indexes:c}=r.maxPoolWithArgmax(fK("x",e,t,n),[s[1],s[2]],[i[1],i[2]],a,o);return[l,c]}case"AvgPool3D":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("kernelSize",e,t,n);return[r.avgPool3d(fK("x",e,t,n),[s[1],s[2],s[3]],[i[1],i[2],i[3]],a)]}case"MaxPool3D":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("kernelSize",e,t,n);return[r.maxPool3d(fK("x",e,t,n),[s[1],s[2],s[3]],[i[1],i[2],i[3]],a)]}case"Dilation2D":{const i=fK("strides",e,t,n),a=fK("pad",e,t,n),s=fK("dilations",e,t,n),o=i[1],l=i[2],c=s[1],u=s[2];return[r.dilation2d(fK("x",e,t,n),fK("filter",e,t,n),[o,l],a,[c,u],"NHWC")]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"creation":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Fill":{const i=fK("shape",e,t,n),a=fK("dtype",e,t,n),s=fK("value",e,t,n);return[r.fill(i,s,a)]}case"LinSpace":{const i=fK("start",e,t,n),a=fK("stop",e,t,n),s=fK("num",e,t,n);return[r.linspace(i,a,s)]}case"Multinomial":{const i=fK("logits",e,t,n),a=fK("numSamples",e,t,n),s=fK("seed",e,t,n);return[r.multinomial(i,a,s)]}case"OneHot":{const i=fK("indices",e,t,n),a=fK("depth",e,t,n),s=fK("onValue",e,t,n),o=fK("offValue",e,t,n),l=fK("dtype",e,t,n);return[r.oneHot(i,a,s,o,l)]}case"Ones":return[r.ones(fK("shape",e,t,n),fK("dtype",e,t,n))];case"OnesLike":return[r.onesLike(fK("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(fK("shape",e,t,n),fK("dtype",e,t,n),fK("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(fK("shape",e,t,n),fK("minval",e,t,n),fK("maxval",e,t,n),fK("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(fK("shape",e,t,n),fK("minval",e,t,n),fK("maxval",e,t,n),fK("seed",e,t,n))];case"Range":{const i=fK("start",e,t,n),a=fK("stop",e,t,n),s=fK("step",e,t,n);return[r.range(i,a,s,fK("dtype",e,t,n))]}case"TruncatedNormal":{const i=fK("shape",e,t,n),a=fK("mean",e,t,n),s=fK("stdDev",e,t,n),o=fK("seed",e,t,n);return[r.truncatedNormal(i,a,s,fK("dtype",e,t,n),o)]}case"Zeros":return[r.zeros(fK("shape",e,t,n),fK("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(fK("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"dynamic":return async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E;switch(e.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=dX(e,t,n),u=await i.image.nonMaxSuppressionWithScoreAsync(r,a,s,o,l,c);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=dX(e,t,n),c=fK("padToMaxOutputSize",e,t,n),u=await i.image.nonMaxSuppressionPaddedAsync(r,a,s,o,l,c);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=dX(e,t,n);return[await i.image.nonMaxSuppressionAsync(r,a,s,o,l)]}case"Where":{const r=i.cast(fK("condition",e,t,n),"bool"),a=[await i.whereAsync(r)];return r.dispose(),a}case"ListDiff":return i.setdiff1dAsync(fK("x",e,t,n),fK("y",e,t,n));default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n);case"evaluation":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"LowerBound":{const i=fK("sortedSequence",e,t,n),a=fK("values",e,t,n);return[r.lowerBound(i,a)]}case"TopKV2":{const i=fK("x",e,t,n),a=fK("k",e,t,n),s=fK("sorted",e,t,n),o=r.topk(i,a,s);return[o.values,o.indices]}case"UpperBound":{const i=fK("sortedSequence",e,t,n),a=fK("values",e,t,n);return[r.upperBound(i,a)]}case"Unique":{const i=fK("x",e,t,n),a=r.unique(i);return[a.values,a.indices]}case"UniqueV2":{const i=fK("x",e,t,n),a=fK("axis",e,t,n),s=r.unique(i,a);return[s.values,s.indices]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"image":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"ResizeBilinear":{const i=fK("images",e,t,n),a=fK("size",e,t,n),s=fK("alignCorners",e,t,n),o=fK("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(i,[a[0],a[1]],s,o)]}case"ResizeNearestNeighbor":{const i=fK("images",e,t,n),a=fK("size",e,t,n),s=fK("alignCorners",e,t,n),o=fK("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(i,[a[0],a[1]],s,o)]}case"CropAndResize":{const i=fK("image",e,t,n),a=fK("boxes",e,t,n),s=fK("boxInd",e,t,n),o=fK("cropSize",e,t,n),l=fK("method",e,t,n),c=fK("extrapolationValue",e,t,n);return[r.image.cropAndResize(i,a,s,o,l,c)]}case"ImageProjectiveTransformV3":{const i=fK("images",e,t,n),a=fK("transforms",e,t,n),s=fK("outputShape",e,t,n),o=fK("fillValue",e,t,n),l=fK("interpolation",e,t,n),c=fK("fillMode",e,t,n);return[r.image.transform(i,a,l.toLowerCase(),c.toLowerCase(),o,s)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"graph":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":const i=fK("default",e,t,n);return[gK(e.name,t,n)||i];case"Placeholder":return[gK(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[wK(fK("x",e,t,n))];case"IdentityN":return fK("x",e,t,n).map(e=>wK(e));case"Shape":return[r.tensor1d(fK("x",e,t,n).shape,"int32")];case"ShapeN":return fK("x",e,t,n).map(e=>r.tensor1d(e.shape));case"Size":return[r.scalar(fK("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(fK("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const a=fK("x",e,t,n),s=fK("data",e,t,n),o=fK("message",e,t,n),l=fK("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let e=0;e<s.length;e++)console.log(Array.prototype.slice.call(s[e].dataSync()).slice(0,l));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"logical":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Equal":return[r.equal(fK("a",e,t,n),fK("b",e,t,n))];case"NotEqual":return[r.notEqual(fK("a",e,t,n),fK("b",e,t,n))];case"Greater":return[r.greater(fK("a",e,t,n),fK("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(fK("a",e,t,n),fK("b",e,t,n))];case"Less":return[r.less(fK("a",e,t,n),fK("b",e,t,n))];case"LessEqual":return[r.lessEqual(fK("a",e,t,n),fK("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(fK("a",e,t,n),fK("b",e,t,n))];case"LogicalNot":return[r.logicalNot(fK("a",e,t,n))];case"LogicalOr":return[r.logicalOr(fK("a",e,t,n),fK("b",e,t,n))];case"Select":case"SelectV2":return[r.where(fK("condition",e,t,n),fK("a",e,t,n),fK("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(fK("a",e,t,n),fK("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"matrices":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(fK("a",e,t,n),fK("b",e,t,n),fK("transposeA",e,t,n),fK("transposeB",e,t,n))];case"Einsum":return[r.einsum(fK("equation",e,t,n),...fK("tensors",e,t,n))];case"Transpose":return[r.transpose(fK("x",e,t,n),fK("perm",e,t,n))];case"_FusedMatMul":const[i,a]=fK("fusedOps",e,t,n),s="biasadd"===i,o="prelu"===a,l=fK("numArgs",e,t,n),c=fK("leakyreluAlpha",e,t,n);if(s){if(o&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,h]=fK("args",e,t,n);return[r.fused.matMul({a:fK("a",e,t,n),b:fK("b",e,t,n),transposeA:fK("transposeA",e,t,n),transposeB:fK("transposeB",e,t,n),bias:u,activation:a,preluActivationWeights:h,leakyreluAlpha:c})];case"MatrixBandPart":return[r.linalg.bandPart(fK("a",e,t,n),fK("numLower",e,t,n),fK("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"normalization":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(fK("x",e,t,n),fK("axis",e,t,n),fK("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(fK("x",e,t,n),fK("mean",e,t,n),fK("variance",e,t,n),fK("offset",e,t,n),fK("scale",e,t,n),fK("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(fK("x",e,t,n),fK("radius",e,t,n),fK("bias",e,t,n),fK("alpha",e,t,n),fK("beta",e,t,n))];case"Softmax":return[r.softmax(fK("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(fK("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"ragged":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"RaggedGather":{const{outputNestedSplits:i,outputDenseValues:a}=r.raggedGather(fK("paramsNestedSplits",e,t,n),fK("paramsDenseValues",e,t,n),fK("indices",e,t,n),fK("outputRaggedRank",e,t,n));return i.concat(a)}case"RaggedRange":{const{rtNestedSplits:i,rtDenseValues:a}=r.raggedRange(fK("starts",e,t,n),fK("limits",e,t,n),fK("splits",e,t,n));return[i,a]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(fK("shape",e,t,n),fK("values",e,t,n),fK("defaultValue",e,t,n),fK("rowPartitionTensors",e,t,n),fK("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"reduction":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Max":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.max(fK("x",e,t,n),i,a)]}case"Mean":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.mean(fK("x",e,t,n),i,a)]}case"Min":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.min(fK("x",e,t,n),i,a)]}case"Sum":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.sum(fK("x",e,t,n),i,a)]}case"All":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.all(fK("x",e,t,n),i,a)]}case"Any":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.any(fK("x",e,t,n),i,a)]}case"ArgMax":{const i=fK("axis",e,t,n);return[r.argMax(fK("x",e,t,n),i)]}case"ArgMin":{const i=fK("axis",e,t,n);return[r.argMin(fK("x",e,t,n),i)]}case"Prod":{const i=fK("axis",e,t,n),a=fK("keepDims",e,t,n);return[r.prod(fK("x",e,t,n),i,a)]}case"Cumprod":{const i=fK("axis",e,t,n),a=fK("exclusive",e,t,n),s=fK("reverse",e,t,n);return[r.cumprod(fK("x",e,t,n),i,a,s)]}case"Cumsum":{const i=fK("axis",e,t,n),a=fK("exclusive",e,t,n),s=fK("reverse",e,t,n);return[r.cumsum(fK("x",e,t,n),i,a,s)]}case"Bincount":const i=fK("x",e,t,n),a=fK("weights",e,t,n),s=fK("size",e,t,n);return[r.bincount(i,a,s)];case"DenseBincount":{const i=fK("x",e,t,n),a=fK("weights",e,t,n),s=fK("size",e,t,n),o=fK("binaryOutput",e,t,n);return[r.denseBincount(i,a,s,o)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"slice_join":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"ConcatV2":case"Concat":{const i=fK("n",e,t,n),a=fK("axis",e,t,n);let s=fK("tensors",e,t,n);return s=s.slice(0,i),[r.concat(s,a)]}case"Gather":{const i=fK("x",e,t,n),a=fK("indices",e,t,n);return[r.gather(i,r.cast(a,"int32"),0)]}case"GatherV2":{const i=fK("axis",e,t,n),a=fK("batchDims",e,t,n),s=fK("x",e,t,n),o=fK("indices",e,t,n);return[r.gather(s,r.cast(o,"int32"),i,a)]}case"Reverse":{const i=fK("dims",e,t,n),a=[];for(let e=0;e<i.length;e++)i[e]&&a.push(e);const s=fK("x",e,t,n);return[r.reverse(s,a)]}case"ReverseV2":{const i=fK("axis",e,t,n),a=fK("x",e,t,n);return[r.reverse(a,i)]}case"Slice":{const i=fK("begin",e,t,n),a=fK("size",e,t,n);return[r.slice(fK("x",e,t,n),i,a)]}case"StridedSlice":{const i=fK("begin",e,t,n),a=fK("end",e,t,n),s=fK("strides",e,t,n),o=fK("beginMask",e,t,n),l=fK("endMask",e,t,n),c=fK("ellipsisMask",e,t,n),u=fK("newAxisMask",e,t,n),h=fK("shrinkAxisMask",e,t,n),d=fK("x",e,t,n);return[r.stridedSlice(d,i,a,s,o,l,c,u,h)]}case"Pack":return bB(()=>{const i=fK("axis",e,t,n),a=fK("tensors",e,t,n),s=a[0].shape,o=r.squeeze(a[0]).shape,l=a.map(e=>{const t=JC(e.shape,s);if(!t&&!JC(r.squeeze(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,s)});return[r.stack(l,i)]});case"Unpack":{const i=fK("axis",e,t,n),a=fK("tensor",e,t,n);return r.unstack(a,i)}case"Tile":{const i=fK("reps",e,t,n);return[r.tile(fK("x",e,t,n),i)]}case"Split":case"SplitV":{const i=fK("axis",e,t,n),a=fK("numOrSizeSplits",e,t,n),s=fK("x",e,t,n);return r.split(s,a,i)}case"ScatterNd":{const i=fK("indices",e,t,n),a=fK("values",e,t,n),s=fK("shape",e,t,n);return[r.scatterND(i,a,s)]}case"GatherNd":{const i=fK("x",e,t,n),a=fK("indices",e,t,n);return[r.gatherND(i,a)]}case"SparseToDense":{const i=fK("sparseIndices",e,t,n),a=fK("outputShape",e,t,n),s=fK("sparseValues",e,t,n),o=fK("defaultValue",e,t,n);return[r.sparseToDense(i,s,a,s.dtype===o.dtype?o:r.cast(o,s.dtype))]}case"TensorScatterUpdate":{const i=fK("indices",e,t,n),a=fK("values",e,t,n),s=fK("tensor",e,t,n);return[r.tensorScatterUpdate(s,i,a)]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"sparse":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:a,emptyRowIndicator:s,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(fK("indices",e,t,n),fK("values",e,t,n),fK("denseShape",e,t,n),fK("defaultValue",e,t,n));return[i,a,s,o]}case"SparseReshape":{const{outputIndices:i,outputShape:a}=r.sparse.sparseReshape(fK("inputIndices",e,t,n),fK("inputShape",e,t,n),fK("newShape",e,t,n));return[i,a]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(fK("data",e,t,n),fK("indices",e,t,n),fK("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(fK("data",e,t,n),fK("indices",e,t,n),fK("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"spectral":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"FFT":return[r.fft(fK("x",e,t,n))];case"IFFT":return[r.ifft(fK("x",e,t,n))];case"RFFT":return[r.rfft(fK("x",e,t,n))];case"IRFFT":return[r.irfft(fK("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"string":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(fK("input",e,t,n),fK("pattern",e,t,n),fK("rewrite",e,t,n),fK("replaceGlobal",e,t,n))];case"StringNGrams":{const{nGrams:i,nGramsSplits:a}=r.string.stringNGrams(fK("data",e,t,n),fK("dataSplits",e,t,n),fK("separator",e,t,n),fK("nGramWidths",e,t,n),fK("leftPad",e,t,n),fK("rightPad",e,t,n),fK("padWidth",e,t,n),fK("preserveShortSequences",e,t,n));return[i,a]}case"StringSplit":{const{indices:i,values:a,shape:s}=r.string.stringSplit(fK("input",e,t,n),fK("delimiter",e,t,n),fK("skipEmpty",e,t,n));return[i,a,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(fK("input",e,t,n),fK("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"transformation":return i(()=>function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;switch(e.op){case"Cast":return[r.cast(fK("x",e,t,n),fK("dtype",e,t,n))];case"ExpandDims":{const i=fK("axis",e,t,n);return[r.expandDims(fK("x",e,t,n),i)]}case"Squeeze":{const i=fK("axis",e,t,n);return[r.squeeze(fK("x",e,t,n),i)]}case"Reshape":return[r.reshape(fK("x",e,t,n),fK("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(fK("x",e,t,n),fK("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(fK("x",e,t,n),fK("padding",e,t,n),fK("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(fK("x",e,t,n),fK("padding",e,t,n),fK("constantValue",e,t,n))];case"SpaceToBatchND":{const i=fK("blockShape",e,t,n),a=fK("paddings",e,t,n);return[r.spaceToBatchND(fK("x",e,t,n),i,a)]}case"BatchToSpaceND":{const i=fK("blockShape",e,t,n),a=fK("crops",e,t,n);return[r.batchToSpaceND(fK("x",e,t,n),i,a)]}case"DepthToSpace":{const i=fK("blockSize",e,t,n),a=fK("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(fK("x",e,t,n),i,a)]}case"BroadcastTo":return[r.broadcastTo(fK("x",e,t,n),fK("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(fK("s0",e,t,n),fK("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n));case"hash_table":return(async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{const i=r.getHashTableHandleByName(e.name);if(null!=i)return[i];{const i=fK("keyDType",e,t,n),a=fK("valueDType",e,t,n),s=new AX(i,a);return r.addHashTable(e.name,s),[s.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const i=fK("tableHandle",e,t,n,r),a=fK("keys",e,t,n),s=fK("values",e,t,n),o=r.getHashTableById(i.id);return[await o.import(a,s)]}case"LookupTableFind":case"LookupTableFindV2":{const i=fK("tableHandle",e,t,n,r),a=fK("keys",e,t,n),s=fK("defaultValue",e,t,n),o=r.getHashTableById(i.id);return[await o.find(a,s)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=fK("tableHandle",e,t,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError("Node type ".concat(e.op," is not implemented"))}})(e,t,n,r);case"custom":const a=pK(e.op);if(a&&a.customExecutor)return a.customExecutor(new rX(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}})(e,t,n);return _E(a)?a.then(e=>[].concat(e)):[].concat(a)}class fX{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0;this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(e=>0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}function gX(e,t,n,r){const i=new Set,a=[];let s=null,o=null;const l=new Set,c=new Set(Object.keys(e).map(e=>bK(e)[0]));r=r||[];const u=new Set(r.map(e=>bK(e.name)[0])),h=[...t];for(;h.length>0;){const e=h.pop();(wX(e)||_X(e)||SX(e))&&null==s&&(s=e,o=s.children.map(e=>e.name).filter(e=>i.has(e))),i.add(e.name),null==n[e.name]&&(c.has(e.name)||u.has(e.name)||(0!==e.inputs.length?e.inputs.forEach(e=>{l.has(e.name)||(l.add(e.name),h.push(e))}):a.push(e.name)))}return{inputs:e,outputs:t,usedNodes:i,missingInputs:a,dynamicNode:s,syncInputs:o}}function mX(e,t){const{usedNodes:n,inputs:r}=t,i=Object.keys(r).map(e=>bK(e)[0]).map(t=>e.nodes[t]),a=e.initNodes||[],s=e=>n.has("string"===typeof e?e:e.name);function o(e){return[...new Map(e.map(e=>[e.name,e])).values()]}const l=o([...i,...e.weights,...a]).filter(s),c=o([...l,...Object.values(e.nodes)]).filter(s),u=new Map(c.map(e=>[e.name,e])),h={};for(const f of c){h[f.name]=h[f.name]||0;for(const e of f.children)s(e)||(h[e.name]=Number.POSITIVE_INFINITY),h[e.name]=(h[e.name]||0)+1}const d=Object.entries(h).filter(e=>{let[,t]=e;return 0===t}).map(e=>{let[t]=e;return t}),A=[...d];for(;d.length>0;){const e=d.pop(),t=u.get(e);for(const n of t.children.filter(s))0===--h[n.name]&&(A.push(n.name),d.push(n.name))}const p=function(e,t){const n=new Map(e.map(e=>[e.name,e])),r=t.map(e=>e.name),i=new Set(r);for(;r.length>0;){const e=r.pop(),t=n.get(e);for(const a of t.children)n.has(a.name)&&!i.has(a.name)&&(i.add(a.name),r.push(a.name))}const a=e.filter(e=>i.has(e.name));return a}(A.map(e=>u.get(e)),l);return function(e,t){const n=new Map(e.map((e,t)=>[e.name,t])),r=new Set(t.map(e=>e.name)),i=e=>r.has("string"===typeof e?e:e.name),a=new Set(e.map(e=>e.name)),s=e=>a.has("string"===typeof e?e:e.name);for(const o of e){for(const e of o.children.filter(s)){if(!n.has(e.name))throw new yX("Child ".concat(e.name," of node ").concat(o.name," is unreachable."));if(n.get(o.name)>n.get(e.name))throw new yX("Node ".concat(o.name," is scheduled to run after its child ").concat(e.name,"."))}if(!i(o))for(const e of o.inputs){if(!n.has(e.name))throw new yX("Input ".concat(e.name," of node ").concat(o.name," is unreachable."));if(n.get(e.name)>n.get(o.name))throw new yX("Node ".concat(o.name," is scheduled to run before its input ").concat(e.name,"."))}}}(p,l),p}class yX extends Error{constructor(e){super("NodesExecutionOrderError: ".concat(e))}}const vX=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),bX=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),xX=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function wX(e){return vX.has(e.op)}function _X(e){return bX.has(e.op)}function SX(e){return xX.has(e.op)}class CX{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(t=>e[t].map(e=>e.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,null!=e.functions&&Object.keys(e.functions).forEach(t=>{this._functionExecutorMap[t]=new CX(e.functions[t],this)})}getCompilationKey(e,t){const n=e.map(e=>e.name).sort(),r=t.map(e=>e.name).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const n=gX(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:a}=n;if(null!=i)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(a,"]"));if(r.length>0){const n=t.map(e=>e.name),i=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(n,"] from the provided inputs ")+"[".concat(i,"]. Missing the following inputs: [").concat(r,"]"))}const s=mX(this.graph,n),o=function(e){const t=new Map(e.map((e,t)=>[e.name,t])),n=Number.MAX_SAFE_INTEGER,r=e.map((e,t)=>wX(e)?n:t),i=e=>{const n=r[t.get(e.name)];return null==n?-1:n},a=e.map((e,t)=>e.children.map(i).reduce((e,t)=>Math.max(e,t),r[t])),s=new Map;for(let o=0;o<e.length;++o){const t=a[o];if(t===n)continue;const r=e[o],i=e[t];s.has(i.name)||s.set(i.name,[]),s.get(i.name).push(r)}return s}(s);return{orderedNodes:s,nodeLiveUntilMap:o}}cloneAndKeepTensor(e){if(null==e)return null;const t=e.clone();return wB(t),t}cloneTensorList(e){if(!e)return null;const t=e.map(e=>this.cloneAndKeepTensor(e));return t}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(e=>{let[t,n]=e;return[t,this.cloneTensorList(n)]}))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=n.map(e=>this.graph.nodes[bK(e)[0]]),i=t.map(e=>bK(e)[0]),a=new Set(i);let s=i.map(e=>this.graph.nodes[e]);0===s.length&&(s=this._outputs);const o=this.getCompilationKey(r,s);let l=this.compiledMap.get(o);null==l&&(l=this.compile(e,s),this.compiledMap.set(o,l));try{this.keepIntermediateTensors=NE().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const c={},u={};return bB(()=>{const n=new fX(this.weightMap,c,u,this.functionExecutorMap,this.parseNodeNameCache),r=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(t=>{const[i,a]=bK(t,n),s=[];s[a]=e[t],r[i]=s,this.keepIntermediateTensors&&(this.clonedTensorsMap[i]=this.cloneTensorList(s))});const i=this.getFrozenTensorIds(r),{orderedNodes:s,nodeLiveUntilMap:o}=l;for(const e of s){if(r[e.name])continue;const t=pX(e,r,n,this._resourceManager);if(_E(t))throw new Error("The execution of the op '".concat(e.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");r[e.name]=t,this.keepIntermediateTensors&&(this.clonedTensorsMap[e.name]=this.cloneTensorList(t)),this.checkTensorForDisposalWithNodeLiveUntilInfo(e,r,n,i,a,o.get(e.name))}return null==this.parent&&n.dispose(i),t.map(e=>gK(e,r,n))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(t=>e[t]).map(e=>e.map(e=>e.id)));return new Set(t)}checkTensorForDisposal(e,t,n,r,i,a,s){if(!wX(t)&&!a.has(e)){for(const r of n[e])null!=r&&(s[r.id]=(s[r.id]||0)+t.children.length);for(const e of t.inputs){if(wX(e))continue;const t=mK(e.name,n,r);if(null!=t)for(const e of t){if(!e||e.kept||i.has(e.id))continue;const t=s[e.id];1===t?(e.dispose(),delete s[e.id]):null!=t&&s[e.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,r,i,a){function s(e){return wX(e)||i.has(e.name)}if(!wX(e)&&null!=a)for(const o of a){if(s(o))continue;const e=mK(o.name,t,n);for(const t of e)!t||t.kept||r.has(t.id)||t.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=NE().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const a=new fX(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const s=await this.executeWithControlFlow(e,a,t,n),o=t.map(e=>gK(e,s,a)),l=o.map(e=>e.id),c=Object.keys(e).map(t=>e[t].id),u=new Set([...l,...c,...this.weightIds]);return Object.values(s).forEach(e=>{e.forEach(e=>{!e||e.isDisposed||u.has(e.id)||e.dispose()})}),null==this.parent&&a.dispose(u),o}async executeFunctionAsync(e,t,n){const r=e.reduce((e,t,n)=>(e[this.inputs[n].name]=t,e),{});return this._executeAsync(r,this.outputNodes,!0,t,n)}async executeWithControlFlow(e,t,n,r){const i=Object.keys(e),a=i.map(e=>this.graph.nodes[bK(e)[0]]),s=n.map(e=>bK(e)[0]),o=new Set(s);let l=s.map(e=>this.graph.nodes[e]);0===l.length&&(l=this._outputs);const{usedNodes:c,missingInputs:u,dynamicNode:h,syncInputs:d}=gX(e,l,this.weightMap,this._initNodes),A=[...a,...this.graph.weights,...this._initNodes||[]].map(e=>({node:e,contexts:t.currentContext})),p=Object.assign({},this.weightMap);Object.keys(e).forEach(t=>{const[n,r]=bK(t),i=[];i[r]=e[t],p[n]=i});const f={},g=this.getFrozenTensorIds(p),m={};for(;A.length>0;){const e=this.processStack(a,A,t,p,m,g,o,f,c);await Promise.all(e)}null!=h||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const y=l.filter(e=>!wX(e)&&!gK(e.name,p,t)).map(e=>e.name);if(y.length>0){let e="";throw null!=h&&(e="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(y,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(u,"]. ").concat(e))}return p}processStack(e,t,n,r,i,a,s,o,l){const c=[];for(;t.length>0;){const e=t.pop();n.currentContext=e.contexts;let u="";if("Enter"===e.node.op&&fK("isConstant",e.node,r,n)&&([u]=yK(e.node.name,n)),null==r[e.node.name]){const h=pX(e.node,r,n,this._resourceManager);u||([u]=yK(e.node.name,n));const d=n.currentContext;_E(h)?c.push(h.then(c=>(r[u]=c,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(c)),n.currentContext=d,this.checkTensorForDisposal(u,e.node,r,n,a,s,o),this.processChildNodes(e.node,t,n,r,i,l),c))):(r[u]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(h)),this.checkTensorForDisposal(u,e.node,r,n,a,s,o),this.processChildNodes(e.node,t,n,r,i,l))}else this.processChildNodes(e.node,t,n,r,i,l)}return c}processChildNodes(e,t,n,r,i,a){e.children.forEach(e=>{const[s]=yK(e.name,n);!i[s]&&a.has(e.name)&&("Merge"===e.op?e.inputNames.some(e=>!!gK(e,r,n))&&(i[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every(e=>!!gK(e,r,n))&&(i[s]=!0,t.push({contexts:n.currentContext,node:e})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(e=>e.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const n=e[t],[r]=bK(t),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const e=i.attrParams.shape.value;qC(e.length===n.shape.length&&n.shape.every((t,n)=>-1===e[n]||e[n]===t),()=>"The shape of dict['".concat(i.name,"'] provided in ")+"model.execute(dict) must be [".concat(e,"], but was ")+"[".concat(n.shape,"]"))}i.attrParams.dtype&&i.attrParams.dtype.value&&qC(n.dtype===i.attrParams.dtype.value,()=>"The dtype of dict['".concat(i.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(i.attrParams.dtype.value,", but was ").concat(n.dtype))})}mapInputs(e){var t,n;const r={};for(const i in e){const a=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[i];null!=a?r[a.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const t=Object.keys(e).filter(e=>{const[t]=bK(e);return null==this.graph.nodes[t]});if(t.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(t,"] that are not part of graph"))}mapOutputs(e){return e.map(e=>{var t,n;const r=null===(n=null===(t=this._signature)||void 0===t?void 0:t.outputs)||void 0===n?void 0:n[e];return null!=r?r.name:e},{})}checkOutputs(e){e.forEach(e=>{const[t]=bK(e);if(!this.graph.nodes[t])throw new Error("The output '".concat(e,"' is not found in the graph"))})}}class EX{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}const NX="?tfjs-format=file",kX="model.json";class IX{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new EX}findIOHandler(){const e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return _E(e)?e.then(e=>null==e.getWeightStream?this.loadSync(e):this.loadStreaming(e)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(null==e.getWeightStream)throw new Error("Model artifacts missing streamWeights function");const t=await FB(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const n=this.artifacts.modelTopology;let r=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const e=this.artifacts.userDefinedMetadata;null!=e.signature&&(r=e.signature),null!=e.structuredOutputKeys&&(this.structuredOutputKeys=e.structuredOutputKeys)}if(this.signature=r,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new CX(HK.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){const t=HK.Instance.transformGraph(e.modelInitializer);this.initializer=new CX(t),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if("string"===typeof e){const t=this.io.getSaveHandlers(e);if(0===t.length)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new Error("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t={};return(e instanceof FT?[e]:e).forEach((e,n)=>t[this.structuredOutputKeys[n]]=e),t}return e}predict(e,t){const n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){const n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof FT)&&!Array.isArray(e)){const n=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=n)for(const t in n){const r=n[t];null!=r.resourceId&&(e[t]=this.resourceIdToCapturedInput[r.resourceId])}return e}e=Array.isArray(e)?e:[e];const n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-n," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));let r=0;return this.inputNodes.reduce((t,n)=>{var i,a,s;const o=null===(s=null===(a=null===(i=this.signature)||void 0===i?void 0:i.inputs)||void 0===a?void 0:a[n])||void 0===s?void 0:s.resourceId;return t[n]=null!=o?this.resourceIdToCapturedInput[o]:e[r++],t},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){const i=t[n[r]];this.resourceIdToCapturedInput[i.resourceId]=e[r]}}}execute(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&xB(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function TX(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==n&&(n={}),n.fromTFHub&&"string"===typeof e&&(e=function(e){e.endsWith("/")||(e+="/");return"".concat(e).concat(kX).concat(NX)}(e));const i=new IX(e,n,r);return await i.load(),i}function BX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(LX(e)){const i=Array.isArray(e)?[]:{};r.add(e);for(const a in e){const s=BX(e[a],t,n,r);i[a]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,i.value),i.value}function MX(e){return FX(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:RX)}function FX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(LX(r)){const i=Array.isArray(r)?[]:{};n.add(r);for(const a in r){const r=e.map(e=>e[a]),s=FX(r,t,n);i[a]=s}return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return i.value}function RX(e){return null===e?null:LX(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function LX(e){let t=!1;if(NE().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:r}=n(551);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof FT)&&!(e instanceof Promise)&&!t)}function PX(e){return function(e,t){return BX(e,t)}(e,UX)}function UX(e){return e instanceof FT?{value:e.clone(),recurse:!1}:LX(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class DX{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class OX extends DX{constructor(){super(OX.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function jX(e){return new VX(e)}function zX(e,t){return new tY(e,t)}OX.INITIAL_CAPACITY=32;class HX{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new JX(this,e)}filter(e){return new XX(this,e)}map(e){return new YX(this,e)}mapAsync(e){return new ZX(this,e)}serialMapAsync(e){return new ZX(this,e).serial()}flatmap(e){return new eY(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e){return new KX(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:RX;return this.rowMajorBatch(e,t).map(e=>MX(e,n))}concatenate(e,t){return new tY(new QX([this,e]),t)}take(e){return e<0||null==e?this:new qX(this,e)}skip(e){return e<0||null==e?this:new WX(this,e)}prefetch(e){return new rY(this,e)}shuffle(e,t){return new iY(this,e,t)}serial(){return new GX(this)}}class QX extends HX{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:PX(e),done:!1}}}class VX extends HX{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message="Error thrown while iterating through a dataset: ".concat(e.message),e}}}class GX extends HX{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class WX extends HX{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;xB(e.value)}return this.upstream.next()}}class qX extends HX{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class KX extends HX{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class XX extends HX{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;xB(e.value)}}}class YX extends HX{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=KT(e.value),n=this.transform(e.value),r=KT(n);for(const i of t)qT(i,r)||i.dispose();return{value:n,done:!1}}}class JX extends HX{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class ZX extends HX{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=KT(e.value),n=await this.transform(e.value),r=KT(n);for(const i of t)qT(i,r)||i.dispose();return{value:n,done:!1}}}class $X extends HX{constructor(){super(),this.outputQueue=new OX,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class eY extends $X{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=KT(e.value),n=this.transform(e.value),r=KT(n);this.outputQueue.pushAll(n);for(const i of t)qT(i,r)||i.dispose();return!0}}class tY extends HX{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var nY;!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(nY||(nY={}));class rY extends HX{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new DX(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class iY extends rY{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=zP.alea(n||gT().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class aY{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let r;return qC(e>0,()=>"batchSize needs to be positive, but it is\n      ".concat(e)),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),sY(async()=>(await n.iterator()).columnMajorBatch(e,t,oY),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,sY(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,sY(async()=>(await t.iterator()).filter(t=>bB(()=>e(t))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return sY(async()=>(await t.iterator()).map(t=>bB(()=>e(t))),this.size)}mapAsync(e){const t=this;return sY(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return sY(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,sY(async()=>zX(jX(async()=>({value:await t.iterator(),done:!1})).take(e)),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,sY(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const r=this,i=zP.alea(t||gT().toString());return sY(async()=>{let t=i.int32();return n&&(t+=i.int32()),(await r.iterator()).shuffle(e,t.toString())},this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,sY(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function sY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends aY{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function oY(e){if(null===e)return null;if(function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof FT||vT(e);var t}(e[0])){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof FT?EU(e):fB(e)}(e),recurse:!1}}return{value:null,recurse:!0}}aY.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function lY(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&qC("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors in the CPU backend."))})}const cY=WU;class uY extends zC{nextDataId(){return uY.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new jC(this,yB())}write(e,t,n){this.firstUse&&(this.firstUse=!1,NE().get("IS_NODE")&&QI("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&cE(n[0])){const i=n.map(e=>mT(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){if(this.data.has(e)){return this.data.get(e).refCount}return 0}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return GO(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>yT(e));return kM(e.shape,e.dtype,n)}catch(dS){throw new Error("Failed to decode encoded string bytes into utf-8")}return kM(e.shape,e.dtype,t)}makeOutput(e,t,n){return yB().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=gT();e();return{kernelMs:gT()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){lY([e],"where");const t=this.readSync(e.dataId);return cY(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}uY.nextDataId=0;function hY(e){return(t,n,r)=>{const i=sE(n,t.length);for(let a=0;a<t.length;++a)i[a]=e(t[a],r);return i}}function dY(e,t,n){return AY(e,hY(t),n)}function AY(e,t,n){return r=>{let{inputs:i,attrs:a,backend:s}=r;const{x:o}=i;lY(o,e);const l=s,c=l.data.get(o.dataId).values;let u;if("string"===o.dtype){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");u=Cj(c)}else u=c;const h=n||o.dtype,d=t(u,h,a);return l.makeTensorInfo(o.shape,h,d)}}SB("cpu",()=>new uY,1);const pY=dY(TN,e=>e>=0?e:Math.exp(e)-1),fY={kernelName:TN,backendName:"cpu",kernelFunc:pY};function gY(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const mY={kernelName:qN,backendName:"cpu",kernelFunc:gY};function yY(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r;lY([i],"leakyRelu");const s=YC(i.shape),o=n.data.get(i.dataId).values,l=aE("float32",s);for(let c=0;c<o.length;c++)l[c]=o[c]<0?a*o[c]:o[c];return n.makeTensorInfo(i.shape,"float32",l)}const vY={kernelName:$N,backendName:"cpu",kernelFunc:yY};function bY(e){return(t,n,r,i,a)=>{const s=nF(t,n),o=s.length,l=pE(s),c=aE(a,YC(s)),u=t.length,h=n.length,d=pE(t),A=pE(n),p=eF(t,s),f=eF(n,s);if(p.length+f.length===0)for(let g=0;g<c.length;++g)c[g]=e(r[g%r.length],i[g%i.length]);else for(let g=0;g<c.length;++g){const t=wE(g,o,l),n=t.slice(-u);p.forEach(e=>n[e]=0);const a=xE(n,u,d),s=t.slice(-h);f.forEach(e=>s[e]=0);const m=xE(s,h,A);c[g]=e(r[a],i[m])}return[c,s]}}const xY=bY((e,t)=>e<0?t*e:e);function wY(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;lY([r,i],"prelu");const a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,[o,l]=xY(r.shape,i.shape,a,s,"float32");return n.makeTensorInfo(l,"float32",o)}const _Y={kernelName:Rk,backendName:"cpu",kernelFunc:wY},SY=dY(Hk,e=>Math.max(0,e)),CY={kernelName:Hk,backendName:"cpu",kernelFunc:SY},EY=dY(Kk,e=>Math.min(Math.max(0,e),6)),NY={kernelName:Kk,backendName:"cpu",kernelFunc:EY},kY=hY(e=>1/(1+Math.exp(-e))),IY=dY(oI,e=>1/(1+Math.exp(-e))),TY={kernelName:oI,backendName:"cpu",kernelFunc:IY};function BY(e,t,n,r,i){if("linear"===n)return gY({inputs:{x:t},backend:e});if("relu"===n)return SY({inputs:{x:t},backend:e});if("elu"===n)return pY({inputs:{x:t},backend:e});if("relu6"===n)return EY({inputs:{x:t},backend:e});if("prelu"===n)return wY({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return yY({inputs:{x:t},backend:e,attrs:{alpha:i}});if("sigmoid"===n)return IY({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function MY(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",a),imag:n.makeTensorInfo(i.shape,"float32",s)},o}const FY={kernelName:iN,backendName:"cpu",kernelFunc:MY};function RY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return MY({inputs:{real:RY(e,t,"float32"),imag:RY(e,t,"float32")},backend:e})}const r=yE(YC(t),n);return e.makeTensorInfo(t,n,r)}function LY(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const PY={kernelName:jk,backendName:"cpu",kernelFunc:LY};function UY(e,t,n,r){if("int32"===r){return[t,"int32",Int32Array.from(e)]}if("bool"===r){const r=fT([0],n),[i,a]=bY((e,t)=>e!==t?1:0)(t,[],e,r,"bool");return[a,"bool",i]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function DY(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:a}=r;if("complex64"===a){if("complex64"===i.dtype)return gY({inputs:{x:i},backend:n});const e=RY(n,i.shape,i.dtype),t=DY({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=MY({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===i.dtype){const e=LY({inputs:{input:i},backend:n}),t=DY({inputs:{x:e},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(e),t}if(!oE(i.dtype,a)){const e=gY({inputs:{x:i},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:a}}const s=n.data.get(i.dataId).values,[o,l,c]=UY(s,i.shape,i.dtype,a);return n.makeTensorInfo(o,l,c)}const OY={kernelName:tN,backendName:"cpu",kernelFunc:DY};function jY(e,t,n,r){return null==n?n=>{let{inputs:i,backend:a}=n;const{a:s,b:o}=i,l=a;lY([s,o],e);const c=l.data.get(s.dataId).values,u=l.data.get(o.dataId).values,h="string"===s.dtype?Cj(c):c,d="string"===s.dtype?Cj(u):u,A=r||s.dtype,[p,f]=t(s.shape,o.shape,h,d,A);return l.makeTensorInfo(f,A,p)}:e=>{let{inputs:i,backend:a}=e;const{a:s,b:o}=i,l=a;if("complex64"===s.dtype||"complex64"===o.dtype){const e=DY({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),t=l.data.get(e.dataId),r=t.complexTensorInfos.real,i=t.complexTensorInfos.imag,a=l.data.get(r.dataId).values,c=l.data.get(i.dataId).values,u=DY({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),d=h.complexTensorInfos.real,A=h.complexTensorInfos.imag,p=l.data.get(d.dataId).values,f=l.data.get(A.dataId).values,[g,m,y]=n(s.shape,o.shape,a,c,p,f),v=l.makeTensorInfo(y,"float32",g),b=l.makeTensorInfo(y,"float32",m),x=MY({inputs:{real:v,imag:b},backend:l});return l.disposeIntermediateTensorInfo(e),l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(b),x}{const e=l.data.get(s.dataId).values,n=l.data.get(o.dataId).values,i=r||s.dtype,[a,c]=t(s.shape,o.shape,e,n,i);return l.makeTensorInfo(c,i,a)}}}function zY(e){return(t,n,r,i,a,s)=>{const o=nF(t,n),l=YC(o),c=o.length,u=pE(o),h=aE("float32",l),d=aE("float32",l),A=eF(t,o),p=eF(n,o),f=GO(r,i),g=GO(a,s),m=t.length,y=pE(t),v=n.length,b=pE(n);if(A.length+p.length===0)for(let x=0;x<h.length;x++){const t=x%f.length,n=x%g.length,r=e(f[2*t],f[2*t+1],g[2*n],g[2*n+1]);h[x]=r.real,d[x]=r.imag}else for(let x=0;x<h.length;x++){const t=wE(x,c,u),n=t.slice(-m);A.forEach(e=>n[e]=0);const r=xE(n,m,y),i=t.slice(-v);p.forEach(e=>i[e]=0);const a=xE(i,v,b),s=e(f[2*r],f[2*r+1],g[2*a],g[2*a+1]);h[x]=s.real,d[x]=s.imag}return[h,d,o]}}const HY=bY((e,t)=>e+t),QY=zY((e,t,n,r)=>({real:e+n,imag:t+r})),VY=jY(LE,HY,QY),GY={kernelName:LE,backendName:"cpu",kernelFunc:VY};function WY(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,s=YC(i.shape),o=nE(a,s),l=YC(o);qC(s===l,()=>"The new shape (".concat(o,") has ").concat(l," elements and the old ")+"shape (".concat(i.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(null!=c.complexTensorInfos){const e=c.complexTensorInfos.real,t=c.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:i.dataId,shape:o,dtype:i.dtype}}const qY={kernelName:Qk,backendName:"cpu",kernelFunc:WY};function KY(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:s,transposeB:o}=r;lY([i,a],"matMul");const l=i.shape.length,c=a.shape.length,u=s?i.shape[l-2]:i.shape[l-1],h=o?a.shape[c-1]:a.shape[c-2],d=s?i.shape[l-1]:i.shape[l-2],A=o?a.shape[c-2]:a.shape[c-1],p=i.shape.slice(0,-2),f=a.shape.slice(0,-2),g=YC(p),m=YC(f),y=nF(i.shape.slice(0,-2),a.shape.slice(0,-2)).concat([d,A]);qC(u===h,()=>"Error in matMul: inner shapes (".concat(u,") and (")+"".concat(h,") of Tensors with shapes ").concat(i.shape," and ")+"".concat(a.shape," and transposeA=").concat(s)+" and transposeB=".concat(o," must match."));const v=o?[m,A,h]:[m,h,A],b=WY({inputs:{x:i},backend:n,attrs:{shape:s?[g,u,d]:[g,d,u]}}),x=WY({inputs:{x:a},backend:n,attrs:{shape:v}}),w=s?b.shape[1]:b.shape[2],_=s?b.shape[2]:b.shape[1],S=o?x.shape[1]:x.shape[2],C=Math.max(g,m),E=n.data.get(b.dataId).values,N=n.data.get(x.dataId).values,k=pE(b.shape),I=pE(x.shape),[T,B,M]=s?[k[0],1,k[1]]:[k[0],k[1],1],[F,R,L]=o?[1,I[1],I[0]]:[I[1],1,I[0]],P=_*S,U=kM([C,_,S],b.dtype),D=U.values,O=n.blockSize;for(let j=0;j<C;j++){const e=j%g,t=j%m;for(let n=0;n<_;n+=O){const r=Math.min(n+O,_);for(let i=0;i<S;i+=O){const a=Math.min(i+O,S);for(let s=0;s<w;s+=O){const o=Math.min(s+O,w);for(let l=n;l<r;l++)for(let n=i;n<a;n++){let r=0;for(let i=s;i<o;i++){r+=E[e*T+l*B+i*M]*N[i*F+n*R+t*L]}D[j*P+(l*S+n)]+=r}}}}}return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(y,U.dtype,U.values)}const XY={kernelName:YE,backendName:"cpu",kernelFunc:KY};const YY={kernelName:jI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;let d,A,p;const f=[];d=KY({inputs:{a:i,b:a},attrs:{transposeA:l,transposeB:c},backend:n}),s&&(A=VY({inputs:{a:d,b:s},backend:n}),f.push(d),d=A),u&&(p=BY(n,d,u,o,h),f.push(d),d=p);for(const g of f)n.disposeIntermediateTensorInfo(g);return d}};function JY(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const ZY={kernelName:ME,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;lY(t,"abs");let r=new Float32Array(YC(t.shape));return r=JY(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},$Y=dY(FE,e=>Math.acos(e)),eJ={kernelName:FE,backendName:"cpu",kernelFunc:$Y},tJ=dY(RE,e=>Math.acosh(e)),nJ={kernelName:RE,backendName:"cpu",kernelFunc:tJ};const rJ={kernelName:PE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;lY(t,"addN");const i=r.map(e=>n.data.get(e.dataId).values),a=kM(r[0].shape,r[0].dtype),s=a.values;for(let o=0;o<r.length;o++){const e=i[o];for(let t=0;t<s.length;t++)s[t]+=e[t]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}};function iJ(e,t,n,r,i){const a=t.length,s=YC(t),o=pE(t),l=pE(i),c=aE(n,YC(i));for(let u=0;u<s;++u){const t=wE(u,a,o),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];c[xE(n,a,l)]=e[u]}return c}function aJ(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:a}=n;lY(i,"transpose");const s=i.shape.length,o=new Array(s);for(let c=0;c<o.length;c++)o[c]=i.shape[a[c]];const l=iJ(r.data.get(i.dataId).values,i.shape,i.dtype,a,o);return{dataId:r.write(l,o,i.dtype),shape:o,dtype:i.dtype}}const sJ={kernelName:MI,backendName:"cpu",kernelFunc:aJ};const oJ={kernelName:UE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;lY(i,"all");const o=rE(a,i.shape);let l=o;const c=SL(l,i.shape.length);let u=i;null!=c&&(u=aJ({inputs:{x:i},backend:n,attrs:{perm:c}}),l=EL(l.length,i.shape.length)),_L("all",l,u.shape.length);const[h,d]=xL(u.shape,l),A=YC(d),p=yE(YC(h),u.dtype),f=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const e=m*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];t=t&&r}p[m]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:g},backend:n,attrs:{shape:wL(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const lJ={kernelName:DE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;lY(i,"any");const o=rE(a,i.shape);let l=o;const c=SL(l,i.shape.length);let u=i;null!=c&&(u=aJ({inputs:{x:i},backend:n,attrs:{perm:c}}),l=EL(l.length,i.shape.length)),_L("any",l,u.shape.length);const[h,d]=xL(u.shape,l),A=YC(d),p=yE(YC(h),u.dtype),f=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const e=m*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];t=t||r}p[m]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:g},backend:n,attrs:{shape:wL(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const cJ={kernelName:OE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;lY(i,"argMax");let s=rE(a,i.shape);const o=SL(s,i.shape.length);let l=i;const c=[];null!=o&&(l=aJ({inputs:{x:i},backend:n,attrs:{perm:o}}),c.push(l),s=EL(s.length,l.shape.length)),s=[s[0]],_L("argMax",s,l.shape.length);const[u,h]=xL(l.shape,s),d=yE(YC(u),"int32"),A=YC(h),p=n.data.get(l.dataId).values;for(let f=0;f<d.length;++f){const e=f*A;let t=p[e],n=0;for(let r=0;r<A;++r){const i=p[e+r];i>t&&(t=i,n=r)}d[f]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}};const uJ={kernelName:jE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;lY(i,"argMin");let s=rE(a,i.shape);const o=SL(s,i.shape.length);let l=i;const c=[];null!=o&&(l=aJ({inputs:{x:i},backend:n,attrs:{perm:o}}),c.push(l),s=EL(s.length,l.shape.length)),s=[s[0]],_L("argMin",s,l.shape.length);const[u,h]=xL(l.shape,s),d=yE(YC(u),"int32"),A=YC(h),p=n.data.get(l.dataId).values;for(let f=0;f<d.length;++f){const e=f*A;let t=p[e],n=0;for(let r=0;r<A;++r){const i=p[e+r];i<t&&(t=i,n=r)}d[f]=n}return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u,"int32",d)}},hJ=dY(zE,e=>Math.asin(e)),dJ={kernelName:zE,backendName:"cpu",kernelFunc:hJ},AJ=dY(HE,e=>Math.asinh(e)),pJ={kernelName:HE,backendName:"cpu",kernelFunc:AJ},fJ=dY(QE,e=>Math.atan(e)),gJ={kernelName:QE,backendName:"cpu",kernelFunc:fJ},mJ=bY((e,t)=>Math.atan2(e,t)),yJ=jY(GE,mJ),vJ={kernelName:GE,backendName:"cpu",kernelFunc:yJ},bJ=dY(VE,e=>Math.atanh(e)),xJ={kernelName:VE,backendName:"cpu",kernelFunc:bJ};function wJ(e,t,n,r,i,a){const s=i.strideHeight,o=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,u=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,A=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=kM(i.outShape,n),g=f.values,m=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let b=0;b<i.batchSize;++b){const t=b*m,n=b*r[0];for(let f=0;f<i.inChannels;++f)for(let m=0;m<i.outHeight;++m){const b=m*s-d,x=Math.max(0,b),w=Math.min(i.inHeight,u+b),_=t+m*y;for(let t=0;t<i.outWidth;++t){const s=t*o-A,u=Math.max(0,s),d=Math.min(i.inWidth,h+s);let m=p,y=0,b=0;for(let t=x;t<w;t+=l){const i=n+t*r[1];for(let t=u;t<d;t+=c){const n=e[i+t*r[2]+f];"max"===a&&n>m?m=n:"avg"===a&&(y+=n,b++)}if(isNaN(m))break}g[_+t*v+f]="avg"===a?y/b:m}}}return f}function _J(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=kM(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,A=r.padInfo.top,p=r.padInfo.left,f=kM(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*o-A;let m=n;for(;m<0;)m+=c;const y=Math.min(r.inHeight,h+n);for(let o=0;o<r.outWidth;++o){const h=o*l-p;let A=h;for(;A<0;)A+=u;const v=Math.min(r.inWidth,d+h);let b=Number.NEGATIVE_INFINITY,x=-1;for(let t=m;t<y;t+=c){const s=t-n;for(let n=A;n<v;n+=u){const o=n-h,l=f.get(g,t,n,e);l>b&&(b=l,x=i?a?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:s*d+o)}}s.set(x,g,t,o,e)}}return s}function SJ(e,t,n,r,i,a){const s=i.strideDepth,o=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,u=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,A=i.effectiveFilterHeight,p=i.effectiveFilterWidth,f=i.padInfo.front,g=i.padInfo.top,m=i.padInfo.left,y="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=kM(i.outShape,n),b=v.values,x=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],w=i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let C=0;C<i.batchSize;++C){const t=C*x,n=C*r[0];for(let v=0;v<i.inChannels;++v)for(let x=0;x<i.outDepth;++x){const C=x*s-f;let E=C;for(;E<0;)E+=c;const N=Math.min(i.inDepth,d+C),k=t+x*w;for(let t=0;t<i.outHeight;++t){const s=t*o-g;let d=s;for(;d<0;)d+=u;const f=Math.min(i.inHeight,A+s),x=k+t*_;for(let t=0;t<i.outWidth;++t){const s=t*l-m;let o=s;for(;o<0;)o+=h;const A=Math.min(i.inWidth,p+s),g=x+t*S;let w=y,_=0,C=0;for(let t=E;t<N;t+=c){const i=n+t*r[1];for(let t=d;t<f;t+=u){const n=i+t*r[2];for(let t=o;t<A;t+=h){const i=e[n+t*r[3]+v];if("max"===a&&i>w?w=i:"avg"===a&&(_+=i,C++),isNaN(w))break}if(isNaN(w))break}if(isNaN(w))break}b[g+v]="avg"===a?_/Math.max(C,1):w}}}}return v}const CJ={kernelName:WE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;lY(i,"avgPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=r;qC(xR(s,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=hR(i.shape,a,s,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&JC(c.inShape,c.outShape))u=gY({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=pE(i.shape),r=wJ(e,i.shape,i.dtype,t,c,"avg");u=n.makeTensorInfo(c.outShape,i.dtype,r.values)}return u}};const EJ={kernelName:KE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r;lY(i,"avgPool3d");const u=dR(i.shape,a,s,1,o,l,c),h=SJ(n.data.get(i.dataId).values,i.shape,i.dtype,pE(i.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};const NJ={kernelName:XE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r;lY([i,a],"avgPool3DGrad");const u=dR(a.shape,s,o,1,l,c),h=u.strideDepth,d=u.strideHeight,A=u.strideWidth,p=u.filterDepth,f=u.filterHeight,g=u.filterWidth,m=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,b=u.effectiveFilterDepth,x=u.effectiveFilterHeight,w=u.effectiveFilterWidth,_=b-1-u.padInfo.front,S=w-1-u.padInfo.left,C=x-1-u.padInfo.top,E=kM(a.shape,"float32"),N=1/(p*f*g),k=n.bufferSync(i);for(let I=0;I<u.batchSize;++I)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const i=t-_,a=n-C,s=r-S;let o=0;for(let t=0;t<b;t+=m){const n=(i+t)/h;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let t=0;t<x;t+=y){const r=(a+t)/d;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let t=0;t<w;t+=v){const i=(s+t)/A;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;o+=k.get(I,n,r,i,e)}}}E.set(o*N,I,t,n,r,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};const kJ={kernelName:qE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a;lY([i,a],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=r,u=hR(s.shape,o,l,1,c),h=u.strideHeight,d=u.strideWidth,A=u.filterHeight,p=u.filterWidth,f=u.dilationHeight,g=u.dilationWidth,m=u.effectiveFilterHeight,y=u.effectiveFilterWidth,v=y-1-u.padInfo.left,b=m-1-u.padInfo.top,x=kM(s.shape,"float32"),w=1/(A*p),_=n.data.get(i.dataId).values,S=kM(i.shape,"float32",_);for(let C=0;C<u.batchSize;++C)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const r=t-b,i=n-v;let a=0;for(let t=0;t<m;t+=f){const n=(r+t)/h;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<y;t+=g){const r=(i+t)/d;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;a+=S.get(C,n,r,e)}}x.set(a*w,C,t,n,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const IJ={kernelName:HN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:a,offset:s,mean:o,variance:l}=t;qC(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),qC(null==s||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),qC(null==a||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),lY([i,o,l,a,s],"batchNorm");let{varianceEpsilon:c}=r;null==c&&(c=.001);const u=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,A=a?n.data.get(a.dataId).values:new Float32Array([1]),p=s?n.data.get(s.dataId).values:new Float32Array([0]),f=new Float32Array(u.length),g=p.length,m=A.length,y=d.length,v=h.length;let b=0,x=0,w=0,_=0;for(let S=0;S<u.length;++S)f[S]=p[b++]+(u[S]-h[x++])*A[w++]/Math.sqrt(d[_++]+c),b>=g&&(b=0),x>=v&&(x=0),w>=m&&(w=0),_>=y&&(_=0);return n.makeTensorInfo(i.shape,i.dtype,f)}};function TJ(e,t,n,r,i){const a=qF(r,t,n),s=YC(n),o=pE(r);if(a){const n=KF(t,o);return"string"===i?e.slice(n,n+s):e.subarray(n,n+s)}const l=kM(r,i,"string"===i?Cj(e):e),c=kM(n,i);for(let u=0;u<c.size;++u){const e=c.indexToLoc(u),n=e.map((e,n)=>e+t[n]);c.set(l.get(...n),...e)}return"string"===i?Ej(c.values):c.values}function BJ(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:s}=r;lY(i,"slice");const[o,l]=XF(i,a,s);LF(i,o,l);const c=TJ(n.data.get(i.dataId).values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,c)}const MJ={kernelName:rI,backendName:"cpu",kernelFunc:BJ};const FJ={kernelName:JE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:s}=r;lY([i],"batchToSpaceND");const o=a.reduce((e,t)=>e*t),l=BO(i.shape,a,o),c=MO(l.length,a.length),u=FO(i.shape,a,o),h=RO(s,a.length),d=LO(u,s,a.length),A=WY({inputs:{x:i},backend:n,attrs:{shape:l}}),p=aJ({inputs:{x:A},backend:n,attrs:{perm:c}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:u}}),g=BJ({inputs:{x:f},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}};function RJ(e,t,n,r,i){const a=YC(r),s=yE(i,n);for(let o=0;o<e.length;o++){const n=e[o];if(n<0)throw new Error("Input x must be non-negative!");n>=i||(s[n]+=a>0?t[o]:1)}return s}function LJ(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e.shape[0],a=e.shape[1],s=kM([i,n],t.dtype);for(let o=0;o<i;o++)for(let i=0;i<a;i++){const a=e.get(o,i);if(a<0)throw new Error("Input x must be non-negative!");a>=n||(r?s.set(1,o,a):t.size>0?s.set(s.get(o,a)+t.get(o,i),o,a):s.set(s.get(o,a)+1,o,a))}return s}const PJ={kernelName:ZE,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s}=r,o=RJ(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,o)}},UJ=bY((e,t)=>e&t),DJ=jY($E,UJ),OJ={kernelName:$E,backendName:"cpu",kernelFunc:DJ};const jJ={kernelName:eN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,o=nF(Array.from(a),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},zJ=hY(e=>Math.ceil(e)),HJ=AY(nN,zJ),QJ={kernelName:nN,backendName:"cpu",kernelFunc:HJ},VJ=dY(rN,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),GJ={kernelName:rN,backendName:"cpu",kernelFunc:VJ},WJ={kernelName:aN,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(YC(t.shape)),i=n.data.get(t.dataId),a=i.complexTensorInfos.real,s=i.complexTensorInfos.imag,o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values;for(let c=0;c<o.length;c++){const e=o[c],t=l[c];r[c]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")}};function qJ(e,t,n,r){const i=sE(n,YC(t));if(r&&"string"!==n){let t=0;e.forEach(e=>{const n=YC(e.shape);i.set(e.vals,t),t+=n})}else{let r=0;e.forEach(e=>{const a="string"===n?Cj(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)i[o+t]=a[s++]}r+=e.shape[1]})}return i}function KJ(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const XJ={kernelName:XN,backendName:"cpu",kernelFunc:KJ};function YJ(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=rE(i,t[0].shape)[0];xO(t.map(e=>e.shape),a);let s=wO(t.map(e=>e.shape),a);if(0===YC(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter(e=>YC(e.shape)>0);if(1===o.length)return gY({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){const e=o.map(e=>LY({inputs:{input:e},backend:n})),t=o.map(e=>KJ({inputs:{input:e},backend:n})),r=YJ({inputs:e,backend:n,attrs:{axis:a}}),i=YJ({inputs:t,backend:n,attrs:{axis:a}}),s=MY({inputs:{real:r,imag:i},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),s}const l=o.map(e=>{const t=YC(e.shape.slice(a));return WY({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}),c=l.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));s=wO(l.map(e=>e.shape),1);const u=1===l[0].shape[0],h=qJ(c,s,t[0].dtype,u),d=wO(o.map(e=>e.shape),a),A=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),A}const JJ={kernelName:sN,backendName:"cpu",kernelFunc:YJ};function ZJ(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=r;lY([i,a],"conv2d");const h=_R(l),d=AR(i.shape,a.shape,s,c,o,u,!1,h),A=d.filterHeight,p=d.filterWidth,f=d.dilationHeight,g=d.dilationWidth,m=d.padInfo.left,y=d.padInfo.top,v="channelsLast"===d.dataFormat,b=new IT(d.outShape,i.dtype),x=pE(i.shape),w=pE(a.shape),_=x[0],S=v?x[1]:x[2],C=v?x[2]:1,E=v?1:x[1],N=b.strides[0],k=v?b.strides[1]:b.strides[2],I=v?b.strides[2]:1,T=v?1:b.strides[1],B=n.data.get(i.dataId).values,M=n.data.get(a.dataId).values,F=b.values;for(let R=0;R<d.batchSize;++R){const e=R*_,t=R*N;for(let n=0;n<d.outHeight;++n){const r=t+n*k,i=n*d.strideHeight-y;for(let t=0;t<A;++t){const n=i+t*f;if(n<0||n>=d.inHeight)continue;const a=t*w[0],s=e+n*S;for(let e=0;e<d.outWidth;++e){const t=r+e*I,n=e*d.strideWidth-m;for(let e=0;e<p;++e){const r=n+e*g;if(r<0||r>=d.inWidth)continue;const i=s+r*C;let o=a+e*w[1];for(let e=0;e<d.inChannels;++e){const n=B[i+e*E];for(let e=0;e<d.outChannels;++e)F[t+e*T]+=n*M[o+e];o+=d.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,F)}const $J={kernelName:oN,backendName:"cpu",kernelFunc:ZJ};const eZ={kernelName:lN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;lY([i,a],"conv2dBackpropFilter");const h=_R(l),d=AR(i.shape,u,s,1,o,c,!1,h),{strideHeight:A,strideWidth:p,filterHeight:f,filterWidth:g}=d,m="channelsLast"===d.dataFormat,y=new IT(d.filterShape,"float32"),v=d.padInfo.left,b=d.padInfo.top,x=n.data.get(i.dataId).values,w=n.data.get(a.dataId).values,_=new IT(i.shape,i.dtype,x),S=new IT(a.shape,a.dtype,w);for(let C=0;C<f;++C){const e=Math.max(0,Math.ceil((b-C)/A)),t=Math.min(d.outHeight,(d.inHeight+b-C)/A);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((v-n)/p)),i=Math.min(d.outWidth,(d.inWidth+v-n)/p);for(let a=0;a<d.inChannels;++a)for(let s=0;s<d.outChannels;++s){let o=0;for(let l=0;l<d.batchSize;++l)for(let c=e;c<t;++c){const e=C+c*A-b;for(let t=r;t<i;++t){const r=n+t*p-v;o+=m?_.get(l,e,r,a)*S.get(l,c,t,s):_.get(l,a,e,r)*S.get(l,s,c,t)}}y.set(o,C,n,a,s)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const tZ={kernelName:cN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:s,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=r;lY([i,a],"conv2dBackpropInput");const h=pE(a.shape),d=pE(i.shape);let A=_R(c);const p=AR(s,a.shape,o,1,l,u,!1,A),f=new IT(p.inShape,"float32"),g=f.values,m=n.data.get(i.dataId).values,y=n.data.get(a.dataId).values,[v,b,x]=h,{batchSize:w,filterHeight:_,filterWidth:S,inChannels:C,inHeight:E,inWidth:N,outChannels:k,outHeight:I,outWidth:T,strideHeight:B,strideWidth:M}=p;A=p.dataFormat;const F=_-1-p.padInfo.top,R=S-1-p.padInfo.left,L="channelsLast"===A,P=f.strides[0],U=L?f.strides[1]:f.strides[2],D=L?f.strides[2]:1,O=L?1:f.strides[1],j=d[0],z=L?d[1]:d[2],H=L?d[2]:1,Q=L?1:d[1];for(let V=0;V<w;++V)for(let e=0;e<C;++e)for(let t=0;t<E;++t){const n=t-F,r=Math.max(0,Math.ceil(n/B)),i=Math.min(I,(_+n)/B);for(let a=0;a<N;++a){const s=a-R,o=Math.max(0,Math.ceil(s/M)),l=Math.min(T,(S+s)/M);let c=0;for(let t=r;t<i;++t){const r=t*B-n;for(let n=o;n<l;++n){const i=j*V+z*t+H*n,a=v*(_-1-r)+b*(S-1-(n*M-s))+x*e;for(let e=0;e<k;++e){c+=m[i+Q*e]*y[a+e]}}}g[P*V+U*t+D*a+O*e]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const nZ={kernelName:uN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:l}=r;lY([i,a],"conv3d");const c=pR(i.shape,a.shape,s,l,o),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:A,dilationHeight:p,dilationWidth:f,padInfo:g}=c,m=g.front,y=g.left,v=g.top,b=new IT(c.outShape,i.dtype),x=n.data.get(i.dataId).values,w=n.data.get(a.dataId).values,_=b.values,S=pE(i.shape),C=pE(a.shape);for(let E=0;E<c.batchSize;++E){const e=E*S[0],t=E*b.strides[0];for(let n=0;n<c.outDepth;++n){const r=t+n*b.strides[1],i=n*c.strideDepth-m;for(let t=0;t<u;++t){const n=i+t*A;if(n<0||n>=c.inDepth)continue;const a=t*C[0],s=e+n*S[1];for(let e=0;e<c.outHeight;++e){const t=r+e*b.strides[2],n=e*c.strideHeight-v;for(let e=0;e<h;++e){const r=n+e*p;if(r<0||r>=c.inHeight)continue;const i=a+e*C[1],o=s+r*S[2];for(let e=0;e<c.outWidth;++e){const n=t+e*c.outChannels,r=e*c.strideWidth-y;for(let e=0;e<d;++e){const t=r+e*f;if(t<0||t>=c.inWidth)continue;const a=i+e*C[2],s=o+t*c.inChannels;let l=a;for(let e=0;e<c.inChannels;++e){const t=x[s+e];for(let e=0;e<c.outChannels;++e)_[n+e]+=t*w[l+e];l+=c.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const rZ={kernelName:hN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,filterShape:l}=r;lY([i,a],"conv3dBackpropFilterV2");const c=pE(i.shape),u=pE(a.shape),h=pR(i.shape,l,s,1,o),d=h.strideDepth,A=h.strideHeight,p=h.strideWidth,f=h.filterDepth,g=h.filterHeight,m=h.filterWidth,y=new IT(h.filterShape,"float32"),v=y.values,[b,x,w,_]=y.strides,S=n.data.get(a.dataId).values,[C,E,N,k]=u,I=n.data.get(i.dataId).values,[T,B,M,F]=c,R=h.padInfo.front,L=h.padInfo.left,P=h.padInfo.top;for(let U=0;U<f;++U){const e=Math.max(0,Math.ceil((R-U)/d)),t=Math.min(h.outDepth,(h.inDepth+R-U)/d),n=U*b;for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((P-r)/A)),a=Math.min(h.outHeight,(h.inHeight+P-r)/A),s=r*x+n;for(let n=0;n<m;++n){const o=Math.max(0,Math.ceil((L-n)/p)),l=Math.min(h.outWidth,(h.inWidth+L-n)/p),c=n*w+s;for(let s=0;s<h.inChannels;++s){const u=s*_+c;for(let c=0;c<h.outChannels;++c){let f=0;for(let u=0;u<h.batchSize;++u){const h=u*T,g=u*C;for(let u=e;u<t;++u){const e=(U+u*d-R)*B+h,t=u*E+g;for(let u=i;u<a;++u){const i=(r+u*A-P)*M+e,a=u*N+t;for(let e=o;e<l;++e){const t=e*k+a;f+=I[(n+e*p-L)*F+i+s]*S[t+c]}}}}v[u+c]=f}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const iZ={kernelName:dN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:s,strides:o,inputShape:l}=r;lY([i],"conv3dBackpropInputV2");const c=pE(i.shape),u=pE(a.shape),h=pR(l,a.shape,o,1,s),d=new IT(h.inShape,"float32"),A=d.values,[p,f,g,m]=d.strides,y=n.data.get(i.dataId).values,[v,b,x,w]=c,_=n.data.get(a.dataId).values,[S,C,E,N]=u,{batchSize:k,filterDepth:I,filterHeight:T,filterWidth:B,inChannels:M,inDepth:F,inHeight:R,inWidth:L,outChannels:P,outDepth:U,outHeight:D,outWidth:O,strideDepth:j,strideHeight:z,strideWidth:H}=h,Q=I-1-h.padInfo.front,V=T-1-h.padInfo.top,G=B-1-h.padInfo.left;for(let W=0;W<k;++W)for(let e=0;e<M;++e)for(let t=0;t<F;++t){const n=t-Q,r=Math.max(0,Math.ceil(n/j)),i=Math.min(U,(I+n)/j);for(let a=0;a<R;++a){const s=a-V,o=Math.max(0,Math.ceil(s/z)),l=Math.min(D,(T+s)/z);for(let c=0;c<L;++c){const u=c-G,h=Math.max(0,Math.ceil(u/H)),d=Math.min(O,(B+u)/H);let k=0;for(let t=r;t<i;++t){const r=t*j-n;for(let n=o;n<l;++n){const i=n*z-s;for(let a=h;a<d;++a){const s=v*W+b*t+x*n+w*a,o=S*(I-1-r)+C*(T-1-i)+E*(B-1-(a*H-u))+N*e;for(let e=0;e<P;++e){k+=y[s+e]*_[o+e]}}}}A[p*W+f*t+g*a+m*c+e]=k}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},aZ=dY(AN,e=>Math.cos(e)),sZ={kernelName:AN,backendName:"cpu",kernelFunc:aZ},oZ=dY(pN,e=>Math.cosh(e)),lZ={kernelName:pN,backendName:"cpu",kernelFunc:oZ};const cZ={kernelName:mN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:c}=r,[u,h,d,A]=i.shape,p=a.shape[0],[f,g]=o,m=kM([p,f,g,A],"float32"),y=n.data.get(a.dataId).values,v=n.data.get(s.dataId).values,b=n.data.get(i.dataId).values,x=pE(i.shape),w=pE(m.shape);for(let _=0;_<p;_++){const e=4*_,t=y[e],n=y[e+1],r=y[e+2],i=y[e+3],a=v[_];if(a>=u)continue;const s=f>1?(r-t)*(h-1)/(f-1):0,o=g>1?(i-n)*(d-1)/(g-1):0;for(let u=0;u<f;u++){const e=f>1?t*(h-1)+u*s:.5*(t+r)*(h-1);if(e<0||e>h-1)for(let t=0;t<g;t++)for(let e=0;e<A;e++){const n=e+t*w[2]+u*w[1]+_*w[0];m.values[n]=c}else if("bilinear"===l){const t=Math.floor(e),r=Math.ceil(e),s=e-t;for(let e=0;e<g;e++){const l=g>1?n*(d-1)+e*o:.5*(n+i)*(d-1);if(l<0||l>d-1){for(let t=0;t<A;t++){const n=t+e*w[2]+u*w[1]+_*w[0];m.values[n]=c}continue}const h=Math.floor(l),p=Math.ceil(l),f=l-h;for(let n=0;n<A;n++){let i=n+h*x[2]+t*x[1]+a*x[0];const o=b[i];i=n+p*x[2]+t*x[1]+a*x[0];const l=b[i];i=n+h*x[2]+r*x[1]+a*x[0];const c=b[i];i=n+p*x[2]+r*x[1]+a*x[0];const d=o+(l-o)*f,A=c+(b[i]-c)*f;i=n+e*w[2]+u*w[1]+_*w[0],m.values[i]=d+(A-d)*s}}}else for(let t=0;t<g;++t){const r=g>1?n*(d-1)+t*o:.5*(n+i)*(d-1);if(r<0||r>d-1){for(let e=0;e<A;e++){const n=e+t*w[2]+u*w[1]+_*w[0];m.values[n]=c}continue}const s=Math.round(r),l=Math.round(e);for(let e=0;e<A;e++){const n=e+s*x[2]+l*x[1]+a*x[0],r=e+t*w[2]+u*w[1]+_*w[0];m.values[r]=b[n]}}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const uZ={kernelName:fN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;lY(i,"cumprod");const l=SL([a],i.shape.length);let c=i;null!=l&&(c=aJ({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=EL(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=HT(c.dtype,"int32"),d=mE(YC(c.shape),h),A=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],f=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let m=0;m<A.length;m+=p)for(let e=0;e<p;e++){const t=f(m,e);if(0===e)d[t]=s?1:A[t];else{const n=f(m,e-1);d[t]=s?A[n]*d[n]:A[t]*d[n]}}const g=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=aJ({inputs:{x:g},backend:n,attrs:{perm:CL(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),e}return g}};const hZ={kernelName:gN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;lY(i,"cumsum");const l=SL([a],i.shape.length);let c=i;null!=l&&(c=aJ({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=EL(1,i.shape.length)[0];if(u!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(u));const h=HT(c.dtype,"int32"),d=yE(YC(c.shape),h),A=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],f=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let m=0;m<A.length;m+=p)for(let e=0;e<p;e++){const t=f(m,e);if(0===e)d[t]=s?0:A[t];else{const n=f(m,e-1);d[t]=s?A[n]+d[n]:A[t]+d[n]}}const g=n.makeTensorInfo(c.shape,h,d);if(null!=l){const e=aJ({inputs:{x:g},backend:n,attrs:{perm:CL(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),e}return g}};const dZ={kernelName:yN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s,binaryOutput:o}=r;if(1===i.shape.length){const e=RJ(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,e)}if(2===i.shape.length){const e=LJ(n.bufferSync(i),n.bufferSync(a),s,o);return n.makeTensorInfo(e.shape,a.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(i.shape.length,"."))}};const AZ={kernelName:vN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:s}=r;qC("NHWC"===s,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s));const o=i.shape[0],l=i.shape[1],c=i.shape[2],u=i.shape[3],h=l*a,d=c*a,A=u/(a*a),p=n.data.get(i.dataId).values,f=new Float32Array(o*h*d*A);let g=0;for(let m=0;m<o;++m)for(let e=0;e<h;++e){const t=Math.floor(e/a),n=e%a;for(let e=0;e<d;++e){const r=Math.floor(e/a),i=(n*a+e%a)*A;for(let e=0;e<A;++e){const n=e+i+u*(r+c*(t+l*m));f[g++]=p[n]}}}return n.makeTensorInfo([o,h,d,A],i.dtype,f)}};function pZ(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:c}=r;lY([i,a],"depthwiseConv2DNative");const u=pE(i.shape),h=pE(a.shape);let d=l;null==d&&(d=[1,1]),qC(xR(s,d),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(d,"'"));const A=AR(i.shape,a.shape,s,d,o,c,!0),{filterHeight:p,filterWidth:f,dilationHeight:g,dilationWidth:m,padInfo:y}=A,v=y.left,b=y.top,x=A.outChannels/A.inChannels,w=new IT(A.outShape,i.dtype),_=n.data.get(i.dataId).values,S=n.data.get(a.dataId).values,C=w.values;for(let E=0;E<A.batchSize;++E){const e=E*u[0],t=E*w.strides[0];for(let n=0;n<A.outHeight;++n){const r=t+n*w.strides[1],i=n*A.strideHeight-b;for(let t=0;t<p;++t){const n=i+t*g;if(n<0||n>=A.inHeight)continue;const a=t*h[0],s=e+n*u[1];for(let e=0;e<A.outWidth;++e){const t=r+e*w.strides[2],n=e*A.strideWidth-v;for(let e=0;e<f;++e){const r=n+e*m;if(r<0||r>=A.inWidth)continue;const i=a+e*h[1],o=s+r*A.inChannels;let l=t,c=i;for(let e=0;e<A.inChannels;++e){const t=_[o+e];for(let e=0;e<x;++e)C[l+e]+=t*S[c+e];l+=x,c+=x}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const fZ={kernelName:bN,backendName:"cpu",kernelFunc:pZ};const gZ={kernelName:xN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=r;lY([i,a],"depthwiseConv2dNativeBackpropFilter");const h=AR(i.shape,u,s,o,l,c,!0),{strideHeight:d,strideWidth:A,filterHeight:p,filterWidth:f}=h,g=new IT(h.filterShape,"float32"),m=h.padInfo.left,y=h.padInfo.top,v=h.outChannels/h.inChannels,b=n.data.get(i.dataId).values,x=new IT(i.shape,i.dtype,b),w=n.data.get(a.dataId).values,_=new IT(a.shape,a.dtype,w);for(let S=0;S<p;++S){const e=Math.max(0,Math.ceil((y-S)/d)),t=Math.min(h.outHeight,(h.inHeight+y-S)/d);for(let n=0;n<f;++n){const r=Math.max(0,Math.ceil((m-n)/A)),i=Math.min(h.outWidth,(h.inWidth+m-n)/A);for(let a=0;a<h.outChannels;++a){const s=Math.trunc(a/v),o=a%v;let l=0;for(let c=0;c<h.batchSize;++c)for(let o=e;o<t;++o){const e=S+o*d-y;for(let t=r;t<i;++t){const r=n+t*A-m;l+=x.get(c,e,r,s)*_.get(c,o,t,a)}}g.set(l,S,n,s,o)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const mZ={kernelName:wN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=r;lY([i,a],"depthwiseConv2DNativeBackpropInput");const h=pE(i.shape),d=pE(a.shape),A=AR(u,a.shape,s,o,l,c,!0),p=new IT(A.inShape,"float32"),f=p.values,[g,m,y]=p.strides,v=n.data.get(i.dataId).values,[b,x,w]=h,_=n.data.get(a.dataId).values,[S,C,E]=d,{batchSize:N,filterHeight:k,filterWidth:I,inChannels:T,inHeight:B,inWidth:M,outChannels:F,outHeight:R,outWidth:L,strideHeight:P,strideWidth:U}=A,D=k-1-A.padInfo.top,O=I-1-A.padInfo.left,j=F/T;for(let z=0;z<N;++z)for(let e=0;e<T;++e)for(let t=0;t<B;++t){const n=t-D,r=Math.max(0,Math.ceil(n/P)),i=Math.min(R,(k+n)/P);for(let a=0;a<M;++a){const s=a-O,o=Math.max(0,Math.ceil(s/U)),l=Math.min(L,(I+s)/U);let c=0;for(let t=r;t<i;++t){const r=t*P-n;for(let n=o;n<l;++n){const i=b*z+x*t+w*n,a=S*(k-1-r)+C*(I-1-(n*U-s))+E*e;for(let t=0;t<j;++t){c+=v[i+(e*j+t)]*_[a+t]}}}f[g*z+m*t+y*a+e]=c}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}};const yZ={kernelName:_N,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=YC(r.shape),a=n.data.get(r.dataId).values,s=kM([i,i],r.dtype),o=s.values;for(let c=0;c<a.length;c++)o[c*i+c]=a[c];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,s.dtype,s.values)}},vZ={kernelName:SN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:i,filter:a}=t,{strides:s,pad:o,dilations:l}=r,c=n,u=c.data.get(i.dataId).values,h=i.shape.length,d=c.data.get(a.dataId).values,A=a.shape.length,{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:v,padInfo:b,strideHeight:x,strideWidth:w,filterHeight:_,filterWidth:S,dilationHeight:C,dilationWidth:E,outShape:N}=uR(i.shape,a.shape,s,o,"NHWC",l),k=YC(N),I=N.length,T=sE(i.dtype,k);for(let B=0;B<p;++B)for(let e=0;e<y;++e){const t=e*x-b.top;for(let n=0;n<v;++n){const r=n*w-b.left;for(let s=0;s<m;++s){let o=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;++e){const n=t+e*C;if(n>=0&&n<f)for(let t=0;t<S;++t){const l=r+t*E;if(l>=0&&l<g){const r=xE([B,n,l,s],h,pE(i.shape)),c=xE([e,t,s],A,pE(a.shape)),p=u[r]+d[c];p>o&&(o=p)}}}T[xE([B,e,n,s],I,pE(N))]=o}}}return{dataId:c.write(fT(T,i.dtype),N,i.dtype),shape:N,dtype:i.dtype}}},bZ={kernelName:EN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:i,filter:a,dy:s}=t,{strides:o,pad:l,dilations:c}=r,u=n,h=gE(i.shape,u.data.get(i.dataId).values),d=gE(a.shape,u.data.get(a.dataId).values),{batchSize:A,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:_,dilationHeight:S,dilationWidth:C,outShape:E}=uR(i.shape,a.shape,o,l,"NHWC",c);qC(s.rank===E.length,()=>"Error in ".concat(EN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(s.rank));const N=gE(E,u.data.get(s.dataId).values),k=vE(a.shape,a.dtype);for(let I=0;I<A;++I)for(let e=0;e<m;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let i=0;i<g;++i){let a=Number.MIN_SAFE_INTEGER,s=0,o=0;for(let e=0;e<w;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*C;if(l>=0&&l<f){const r=h[I][n][l][i]+d[e][t][i];r>a&&(a=r,s=e,o=t)}}}k[s][o][i]+=N[I][e][n][i]}}}return{dataId:u.write(fT(k,i.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},xZ={kernelName:CN,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:i,filter:a,dy:s}=t,{strides:o,pad:l,dilations:c}=r,u=n,h=gE(i.shape,u.data.get(i.dataId).values),d=gE(a.shape,u.data.get(a.dataId).values),{batchSize:A,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:_,dilationHeight:S,dilationWidth:C,outShape:E}=uR(i.shape,a.shape,o,l,"NHWC",c);qC(s.rank===E.length,()=>"Error in ".concat(CN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(s.rank));const N=gE(E,u.data.get(s.dataId).values),k=vE(i.shape,i.dtype);for(let I=0;I<A;++I)for(let e=0;e<m;++e){const t=e*b-v.top;for(let n=0;n<y;++n){const r=n*x-v.left;for(let i=0;i<g;++i){let a=Number.MIN_SAFE_INTEGER,s=t<0?0:t,o=r<0?0:r;for(let e=0;e<w;++e){const n=t+e*S;if(n>=0&&n<p)for(let t=0;t<_;++t){const l=r+t*C;if(l>=0&&l<f){const r=h[I][n][l][i]+d[e][t][i];r>a&&(a=r,s=n,o=l)}}}k[I][s][o][i]+=N[I][e][n][i]}}}return{dataId:u.write(fT(k,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};const wZ={kernelName:NN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{canvas:a,options:s}=r,{contextOptions:o,imageOptions:l}=s||{},c=(null===l||void 0===l?void 0:l.alpha)||1,u=(null===o||void 0===o?void 0:o.contextType)||"2d";if("2d"!==u)throw new Error("Context type ".concat(o.contextType," is not supported by the CPU backend."));const h=a.getContext(u,(null===o||void 0===o?void 0:o.contextAttributes)||{});if(null==h)throw new Error("Could not get the context with ".concat(u," type."));const[d,A]=i.shape.slice(0,2),p=2===i.shape.length?1:i.shape[2],f=n.data.get(i.dataId).values,g="float32"===i.dtype?255:1,m=new Uint8ClampedArray(A*d*4);for(let v=0;v<d*A;++v){const e=[0,0,0,255*c];for(let n=0;n<p;n++){const t=f[v*p+n];if("float32"===i.dtype){if(t<0||t>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(t,"."))}else if("int32"===i.dtype&&(t<0||t>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(t,"."));1===p?(e[0]=t*g,e[1]=t*g,e[2]=t*g):e[n]=t*g}const t=4*v;m[t+0]=Math.round(e[0]),m[t+1]=Math.round(e[1]),m[t+2]=Math.round(e[2]),m[t+3]=Math.round(e[3])}a.width=A,a.height=d;const y=new ImageData(m,A,d);return h.putImageData(y,0,0),i}},_Z=bY((e,t)=>e*t),SZ=zY((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),CZ=jY(_k,_Z,SZ),EZ={kernelName:_k,backendName:"cpu",kernelFunc:CZ};function NZ(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;let o;lY(i,"sum"),o="bool"===i.dtype?DY({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):gY({inputs:{x:i},backend:n});const l=o.shape.length,c=rE(a,o.shape),u=SL(c,l);let h=c,d=o;null!=u&&(d=aJ({inputs:{x:o},backend:n,attrs:{perm:u}}),h=EL(h.length,l)),_L("sum",h,d.shape.length);const[A,p]=xL(d.shape,h);let f=RY(n,A,HT(d.dtype,"int32"));const g=YC(p),m=n.data.get(f.dataId).values,y=n.data.get(d.dataId).values;for(let v=0;v<m.length;++v){const e=v*g;let t=0;for(let n=0;n<g;++n)t+=y[e+n];m[v]=t}if(s){const e=f;f=WY({inputs:{x:f},backend:n,attrs:{shape:wL(f.shape,c)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=u&&n.disposeIntermediateTensorInfo(d),f}const kZ={kernelName:uI,backendName:"cpu",kernelFunc:NZ};const IZ={kernelName:IN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,a=t,{allDims:s,summedDims:o,idDims:l}=rj(i,a.length);aj(s.length,l,a);const{path:c,steps:u}=sj(o,l),h=u.length;let d=null,A=s.length;const p=[];for(let f=0;f<h;++f){for(const e of u[f]){const{permutationIndices:t,expandDims:r}=ij(A,l[e]);let i;oj(t)?i=a[e]:(i=aJ({inputs:{x:a[e]},backend:n,attrs:{perm:t}}),p.push(i));const s=i.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);JC(i.shape,s)||(i=WY({inputs:{x:i},backend:n,attrs:{shape:s}}),p.push(i)),null===d?d=i:(d=CZ({inputs:{a:i,b:d},backend:n}),p.push(d))}f<h-1&&(c[f]>=0&&(d=NZ({inputs:{x:d},backend:n,attrs:{axis:c[f]-(s.length-A),keepDims:!1}}),p.push(d)),A--)}for(const f of p)f!==d&&n.disposeIntermediateTensorInfo(f);return d}};const TZ={kernelName:BN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;lY([r,i],"eluGrad");const a=new Float32Array(YC(i.shape)),s=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values;for(let l=0;l<s.length;++l){const e=s[l];a[l]=e>=0?o[l]:o[l]*(e+1)}return n.makeTensorInfo(i.shape,"float32",a)}},BZ=bY((e,t)=>e===t?1:0),MZ=jY(FN,BZ,null,"bool"),FZ={kernelName:FN,backendName:"cpu",kernelFunc:MZ},RZ=OO,LZ=jO,PZ=zO,UZ=HO,DZ=QO,OZ=VO,jZ=dY(MN,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+RZ*n);return t*(1-((((OZ*r+DZ)*r+UZ)*r+PZ)*r+LZ)*r*Math.exp(-n*n))}),zZ={kernelName:MN,backendName:"cpu",kernelFunc:jZ},HZ=hY(e=>Math.exp(e)),QZ=AY(RN,HZ,"float32"),VZ={kernelName:RN,backendName:"cpu",kernelFunc:QZ};function GZ(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:a}=r,s=i.shape.length,o=i.shape.slice();let l=a;return a<0&&(qC(-(s+1)<=a,()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")),l=s+a+1),o.splice(l,0,1),WY({inputs:{x:i},backend:n,attrs:{shape:o}})}const WZ={kernelName:LN,backendName:"cpu",kernelFunc:GZ},qZ=hY(e=>Math.expm1(e)),KZ=AY(PN,qZ),XZ={kernelName:PN,backendName:"cpu",kernelFunc:KZ},YZ=bY((e,t)=>e/t),JZ=jY(kN,YZ),ZZ={kernelName:kN,backendName:"cpu",kernelFunc:JZ},$Z=bY((e,t)=>e-t),e$=zY((e,t,n,r)=>({real:e-n,imag:t-r})),t$=jY(EI,$Z,e$),n$={kernelName:EI,backendName:"cpu",kernelFunc:t$};function r$(e,t,n){const r=e.shape,i=r[0],a=r[1],s=n.data.get(e.dataId),o=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[i,a],u=YC(c),h=aE("float32",u),d=aE("float32",u);for(let g=0;g<i;g++){const e=BJ({inputs:{x:o},backend:n,attrs:{begin:[g,0],size:[1,a]}}),r=BJ({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,a]}}),i=MY({inputs:{real:e,imag:r},backend:n}),{real:s,imag:c}=i$(i,t,n),u=GO(s,c);for(let t=0;t<a;t++){const e=XO(u,t);h[g*a+t]=e.real,d[g*a+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i)}const A=n.makeTensorInfo(c,"float32",h),p=n.makeTensorInfo(c,"float32",d),f=MY({inputs:{real:A,imag:p},backend:n});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),f}function i$(e,t,n){const r=YC(e.shape),i=n.data.get(e.dataId),a=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0===((o=r)&o-1)){const i=a$(a,s,r,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",i.real),t=n.makeTensorInfo(o,"float32",i.imag),a=n.makeTensorInfo([],"float32",pT(r,"float32")),s=gY({inputs:{x:a},backend:n}),l=ZZ.kernelFunc({inputs:{a:e,b:a},backend:n}),c=ZZ.kernelFunc({inputs:{a:t,b:s},backend:n}),u=n.data.get(l.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),{real:u,imag:h}}return i}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let i=0;i<t;i++){let a=0,s=0;for(let r=0;r<t;r++){const o=ZO(i*r,t,n),l=XO(e,r);a+=l.real*o.real-l.imag*o.imag,s+=l.real*o.imag+l.imag*o.real}n&&(a/=t,s/=t),YO(r,a,s,i)}return r}(GO(a,s),r,t);return WO(e)}var o}function a$(e,t,n,r,i){if(1===n)return{real:e,imag:t};const a=GO(e,t),s=n/2,o=qO(a),l=o.real,c=o.imag,u=[l.length],h=i.makeTensorInfo(u,"float32",l),d=i.makeTensorInfo(u,"float32",c),A=MY({inputs:{real:h,imag:d},backend:i}),p=KO(a),f=p.real,g=p.imag,m=[f.length],y=i.makeTensorInfo(m,"float32",f),v=i.makeTensorInfo(m,"float32",g),b=MY({inputs:{real:y,imag:v},backend:i}),x=a$(l,c,s,r,i),w=x.real,_=x.imag,S=[w.length],C=i.makeTensorInfo(S,"float32",w),E=i.makeTensorInfo(S,"float32",_),N=MY({inputs:{real:C,imag:E},backend:i}),k=a$(f,g,s,r,i),I=k.real,T=k.imag,B=[I.length],M=i.makeTensorInfo(B,"float32",I),F=i.makeTensorInfo(B,"float32",T),R=MY({inputs:{real:M,imag:F},backend:i}),L=JO(n,r),P=[L.real.length],U=i.makeTensorInfo(P,"float32",L.real),D=i.makeTensorInfo(P,"float32",L.imag),O=MY({inputs:{real:U,imag:D},backend:i}),j=CZ({inputs:{a:O,b:R},backend:i}),z=VY({inputs:{a:N,b:j},backend:i}),H=t$({inputs:{a:N,b:j},backend:i}),Q=LY({inputs:{input:z},backend:i}),V=LY({inputs:{input:H},backend:i}),G=KJ({inputs:{input:z},backend:i}),W=KJ({inputs:{input:H},backend:i}),q=YJ({inputs:[Q,V],backend:i,attrs:{axis:0}}),K=YJ({inputs:[G,W],backend:i,attrs:{axis:0}}),X=i.data.get(q.dataId).values,Y=i.data.get(K.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(y),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(Q),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}const s$={kernelName:UN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=YC(r.shape),a=r.shape[r.shape.length-1],s=WY({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),o=r$(s,!1,n),l=WY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}};function o$(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:a}=n,s=a||hE(i),o=sE(s,YC(r));return function(e,t){e.fill(t)}(o,i),t.makeTensorInfo(r,s,o)}const l$={kernelName:DN,backendName:"cpu",kernelFunc:o$};const c$={kernelName:ON,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:i}=t,a=r,s=aE(i.dtype,YC(i.shape)),[o,l,c,u]=i.shape,h=a.data.get(i.dataId).values;for(let d=0;d<o;d++){const e=d*c*l*u;for(let t=0;t<l;t++){const n=t*(c*u);for(let t=0;t<c;t++){const r=t*u;for(let i=0;i<u;i++){const a=Math.round(c-t-1),o=e+n+r+i;let l=h[o];if(a>=0&&a<c){l=h[e+n+a*u+i]}s[o]=l}}}}return{dataId:a.write(s,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},u$=hY(e=>Math.floor(e)),h$=AY(jN,u$),d$={kernelName:jN,backendName:"cpu",kernelFunc:h$},A$=bY((e,t)=>Math.floor(e/t)),p$=jY(zN,A$,null,"int32"),f$={kernelName:zN,backendName:"cpu",kernelFunc:p$};const g$={kernelName:zI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r;let f=ZJ({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=f;if("NCHW"===u&&1===s.shape.length&&1!==s.shape[0]){const e=WY({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});f=VY({inputs:{a:f,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else f=VY({inputs:{a:f,b:s},backend:n});n.disposeIntermediateTensorInfo(e)}if(A){const e=f;if("NCHW"===u&&"prelu"===A&&1===o.shape.length&&1!==o.shape[0]){const e=WY({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});f=BY(n,f,A,e,p),n.disposeIntermediateTensorInfo(e)}else f=BY(n,f,A,o,p);n.disposeIntermediateTensorInfo(e)}return f}};const m$={kernelName:HI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r;let f=pZ({inputs:{x:i,filter:a},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=f;f=VY({inputs:{a:f,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(A){const e=f;f=BY(n,f,A,o,p),n.disposeIntermediateTensorInfo(e)}return f}};function y$(e,t,n,r,i,a,s,o,l){const c=kM([r,a],n);for(let u=0;u<r;u++){const n=[];let r=0;for(let t=0;t<i;t++){const a=e[u*i+t];r+=a*s[t],n.push(a)}if(r<0||r>=l/a)throw new Error("Invalid indices: ".concat(n," does not index into ").concat(o));for(let e=0;e<a;e++)c.values[u*a+e]=t.get(...t.indexToLoc(r*a+e))}return c}const v$={kernelName:VN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=YC(r.shape),s=i.shape,o=s[s.length-1],[l,c,u,h]=PO(r,i);if(0===c)return n.makeTensorInfo(l,r.dtype,[]);const d=y$(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,c,o,u,h,r.shape,a);return n.makeTensorInfo(l,r.dtype,d.values)}};function b$(e,t,n){const r=kM(n,e.dtype);for(let i=0;i<r.size;++i){const n=r.indexToLoc(i).slice(),a=n[0],s=n[2],o=t.locToIndex([a,s]);n[2]=t.values[o];const l=e.locToIndex(n);0<=l&&l<e.values.length&&(r.values[i]=e.values[l])}return r}const x$={kernelName:QN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:s,batchDims:o}=r;lY([i,a],"gatherV2");const l=rE(s,i.shape)[0],c=n.data.get(a.dataId).values,u=i.shape[l];for(let v=0;v<c.length;++v){const e=c[v];qC(e<=u-1&&e>=0,()=>"GatherV2: the index value ".concat(e," is not in [0, ").concat(u-1,"]"))}let h=o;null==o&&(h=0);const d=YC(a.shape),A=Sj(i,a,l,h),p=WY({inputs:{x:i},backend:n,attrs:{shape:[A.batchSize,A.outerSize,A.dimSize,A.sliceSize]}}),f=WY({inputs:{x:a},backend:n,attrs:{shape:[A.batchSize,d/A.batchSize]}}),g=[A.batchSize,A.outerSize,d/A.batchSize,A.sliceSize],m=n.bufferSync(f),y=b$(n.bufferSync(p),m,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(A.outputShape,y.dtype,y.values)}},w$=bY((e,t)=>e>t?1:0),_$=jY(GN,w$,null,"bool"),S$={kernelName:GN,backendName:"cpu",kernelFunc:_$},C$=bY((e,t)=>e>=t?1:0),E$=jY(WN,C$,null,"bool"),N$={kernelName:WN,backendName:"cpu",kernelFunc:E$};const k$={kernelName:KN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=YC(r.shape),a=r.shape[r.shape.length-1],s=WY({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),o=r$(s,!0,n),l=WY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),l}},I$=dY(YN,e=>Number.isFinite(e)?1:0,"bool"),T$={kernelName:YN,backendName:"cpu",kernelFunc:I$},B$=dY(JN,e=>Math.abs(e)===1/0?1:0,"bool"),M$={kernelName:JN,backendName:"cpu",kernelFunc:B$},F$=dY(ZN,e=>Number.isNaN(e)?1:0,"bool"),R$={kernelName:ZN,backendName:"cpu",kernelFunc:F$},L$=bY((e,t)=>e<t?1:0),P$=jY(ek,L$,null,"bool"),U$={kernelName:ek,backendName:"cpu",kernelFunc:P$},D$=bY((e,t)=>e<=t?1:0),O$=jY(tk,D$,null,"bool"),j$={kernelName:tk,backendName:"cpu",kernelFunc:O$};function z$(e,t,n){const r=(t-e)/(n-1),i=yE(n,"float32");i[0]=e;for(let a=1;a<i.length;a++)i[a]=i[a-1]+r;return i}const H$={kernelName:nk,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,s=z$(r,i,a);return t.makeTensorInfo([s.length],"float32",s)}},Q$=hY(e=>Math.log(e)),V$=AY(rk,Q$),G$={kernelName:rk,backendName:"cpu",kernelFunc:V$},W$=dY(ik,e=>Math.log1p(e)),q$={kernelName:ik,backendName:"cpu",kernelFunc:W$},K$=bY((e,t)=>e&&t),X$=jY(ak,K$,null,"bool"),Y$={kernelName:ak,backendName:"cpu",kernelFunc:X$},J$=dY(sk,e=>e?0:1,"bool"),Z$={kernelName:sk,backendName:"cpu",kernelFunc:J$},$$=bY((e,t)=>e||t),e0=jY(ok,$$,null,"bool"),t0={kernelName:ok,backendName:"cpu",kernelFunc:e0};const n0={kernelName:lk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:s,alpha:o,beta:l}=r;lY(i,"LRN");const c=i.shape[3],u=c-1,h=n.data.get(i.dataId).values,d=YC(i.shape),A=new Float32Array(d);function p(e){const t=e%c;let n=e-t+Math.max(0,t-a);const r=e-t+Math.min(t+a,u);let i=0;for(;n<=r;n++){const e=h[n];i+=e*e}return i}for(let f=0;f<d;f++){const e=p(f),t=h[f]*Math.pow(s+o*e,-l);A[f]=t}return n.makeTensorInfo(i.shape,i.dtype,A)}};const r0={kernelName:ck,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:s}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=r;lY(s,"LRNGrad");const h=YC(s.shape),d=s.shape[3],A=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,f=n.data.get(a.dataId).values,g=new Float32Array(h),m=h;for(let y=0;y<m;y++){const e=y%d,t=y-e+Math.max(0,e-o),n=y-e+Math.min(d,e+o+1);let r=0;for(let i=t;i<n;i++)r+=Math.pow(p[i],2);r=c*r+l;for(let i=t;i<n;i++){let e=-2*c*u*p[i]*f[y]/r;y===i&&(e+=Math.pow(r,-u)),e*=A[y],g[i]+=e}}return n.makeTensorInfo(s.shape,i.dtype,g)}};function i0(e,t,n,r){const i=aE(r,YC(n));for(let a=0;a<i.length;++a){const n=a*t;let r=e[n];for(let i=0;i<t;++i){const t=e[n+i];(Number.isNaN(t)||t>r)&&(r=t)}i[a]=r}return i}function a0(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:s}=r,o=n;let l=i.shape;const c=l.length,u=rE(a,l);let h=u;const d=SL(h,c);let A=o.data.get(i.dataId).values;if(null!=d){const e=new Array(c);for(let t=0;t<e.length;t++)e[t]=l[d[t]];A=iJ(A,l,i.dtype,d,e),h=EL(h.length,c),l=e}lY(i,"max"),_L("max",h,c);const[p,f]=xL(l,h),g=i0(A,YC(f),p,i.dtype),m=o.write(g,p,i.dtype);let y=p;if(s){y=wL(p,u)}return{dataId:m,shape:y,dtype:i.dtype}}const s0={kernelName:uk,backendName:"cpu",kernelFunc:a0},o0=bY((e,t)=>Math.max(e,t)),l0=jY(hk,o0),c0={kernelName:hk,backendName:"cpu",kernelFunc:l0};const u0={kernelName:dk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;lY(i,"maxPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=r;qC(xR(s,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=hR(i.shape,a,s,1,o,l);let u;if(1===c.filterWidth&&1===c.filterHeight&&JC(c.inShape,c.outShape))u=gY({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=pE(i.shape),r=wJ(e,i.shape,i.dtype,t,c,"max");u=n.makeTensorInfo(c.outShape,i.dtype,r.values)}return u}};const h0={kernelName:pk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r;lY(i,"maxPool3d");const u=dR(i.shape,a,s,1,o,l,c),h=SJ(n.data.get(i.dataId).values,i.shape,i.dtype,pE(i.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};const d0={kernelName:fk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r;lY([i,a],"maxPool3DGrad");const u=dR(a.shape,s,o,1,l,c),h=function(e,t){const n=kM(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,A=t.padInfo.top,p=t.padInfo.left;for(let f=0;f<t.batchSize;++f)for(let g=0;g<t.inChannels;++g)for(let m=0;m<t.outDepth;++m){const y=m*r-d;let v=y;for(;v<0;)v+=s;const b=Math.min(t.inDepth,c+y);for(let r=0;r<t.outHeight;++r){const c=r*i-A;let d=c;for(;d<0;)d+=o;const x=Math.min(t.inHeight,u+c);for(let i=0;i<t.outWidth;++i){const A=i*a-p;let w=A;for(;w<0;)w+=l;const _=Math.min(t.inWidth,h+A);let S=Number.NEGATIVE_INFINITY,C=-1;for(let t=v;t<b;t+=s){const n=t-y;for(let r=d;r<x;r+=o){const i=r-c;for(let a=w;a<_;a+=l){const s=a-A,o=e.get(f,t,r,a,g);o>=S&&(S=o,C=n*u*h+i*u+s)}}}n.set(C,f,m,r,i,g)}}}return n}(n.bufferSync(a),u),d=u.strideDepth,A=u.strideHeight,p=u.strideWidth,f=u.dilationDepth,g=u.dilationHeight,m=u.dilationWidth,y=u.effectiveFilterDepth,v=u.effectiveFilterHeight,b=u.effectiveFilterWidth,x=y-1-u.padInfo.front,w=b-1-u.padInfo.left,_=v-1-u.padInfo.top,S=kM(a.shape,"float32"),C=n.bufferSync(i);for(let E=0;E<u.batchSize;++E)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inDepth;++t)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const i=t-x,a=n-_,s=r-w;let o=0;for(let t=0;t<y;t+=f){const n=(i+t)/d;if(!(n<0||n>=u.outDepth||Math.floor(n)!==n))for(let r=0;r<v;r+=g){const i=(a+r)/A;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let a=0;a<b;a+=m){const l=(s+a)/p;if(l<0||l>=u.outWidth||Math.floor(l)!==l)continue;const c=y*v*b-1-h.get(E,n,i,l,e)===t*v*b+r*b+a?1:0;if(0===c)continue;o+=C.get(E,n,i,l,e)*c}}}S.set(o,E,t,n,r,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};const A0={kernelName:Ak,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:s}=t,o=a;lY([a,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=hR(o.shape,l,c,1,u,h),A=n.data.get(o.dataId).values,p=kM(d.outShape,o.dtype,_J(A,o.shape,o.dtype,d).values),f=d.strideHeight,g=d.strideWidth,m=d.dilationHeight,y=d.dilationWidth,v=d.effectiveFilterHeight,b=d.effectiveFilterWidth,x=b-1-d.padInfo.left,w=v-1-d.padInfo.top,_=kM(o.shape,"float32"),S=n.data.get(i.dataId).values,C=kM(i.shape,"float32",S);for(let E=0;E<d.batchSize;++E)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-w,i=n-x;let a=0;for(let t=0;t<v;t+=m){const n=(r+t)/f;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<b;r+=y){const s=(i+r)/g;if(s<0||s>=d.outWidth||Math.floor(s)!==s)continue;const o=v*b-1-p.get(E,n,s,e)===t*b+r?1:0;if(0===o)continue;a+=C.get(E,n,s,e)*o}}_.set(a,E,t,n,e)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}};const p0={kernelName:gk,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:i}=t,{filterSize:a,strides:s,pad:o,includeBatchInIndex:l}=n,c=r;lY(i,"MaxPoolWithArgmax");const u=c.data.get(i.dataId).values,h=hR(i.shape,a,s,[1,1],o),[d,A]=function(e,t,n,r,i){const a=wJ(e,0,n,pE(t),i,"max"),s=_J(e,t,n,i,!0,r);return[a.values,s.values]}(u,i.shape,i.dtype,l,h),p=c.write(d,h.outShape,i.dtype),f=c.write(A,h.outShape,i.dtype);return[{dataId:p,shape:h.outShape,dtype:i.dtype},{dataId:f,shape:h.outShape,dtype:"int32"}]}};const f0={kernelName:mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=rE(a,i.shape),l=YC(xL(i.shape,o)[1]),c=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(u);const h=DY({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(h);const d=JZ({inputs:{a:h,b:u},backend:n});c.push(d);const A=NZ({inputs:{x:d},backend:n,attrs:{axis:a,keepDims:s}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),A}};const g0={kernelName:yk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;lY(i,"min");const o=rE(a,i.shape);let l=o;const c=SL(l,i.shape.length);let u=i;null!=c&&(u=aJ({inputs:{x:i},backend:n,attrs:{perm:c}}),l=EL(l.length,i.shape.length)),_L("min",l,u.shape.length);const[h,d]=xL(u.shape,l),A=YC(d),p=yE(YC(h),u.dtype),f=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const e=m*A;let t=f[e];for(let n=0;n<A;++n){const r=f[e+n];(Number.isNaN(r)||r<t)&&(t=r)}p[m]=t}null!=c&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,p);if(s){const e=WY({inputs:{x:g},backend:n,attrs:{shape:wL(h,o)}});return n.disposeIntermediateTensorInfo(g),e}return g}},m0=bY((e,t)=>Math.min(e,t)),y0=jY(vk,m0),v0={kernelName:vk,backendName:"cpu",kernelFunc:y0};const b0={kernelName:bk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,mode:s}=r;lY(i,"mirrorPad");const o=a.map((e,t)=>e[0]+i.shape[t]+e[1]),l=a.map(e=>e[0]),c=a.map((e,t)=>e[0]+i.shape[t]),u="reflect"===s?0:1,h=n.data.get(i.dataId).values,d=i.shape.length,A=pE(i.shape),p=YC(o),f=o.length,g=pE(o),m=aE(i.dtype,p);for(let y=0;y<p;y++){let e=wE(y,f,g);for(let n=0;n<f;n++)e[n]<l[n]?e[n]=2*l[n]-e[n]-u:e[n]>=c[n]&&(e[n]=2*(c[n]-1)-e[n]+u);e=e.map((e,t)=>e-l[t]);const t=xE(e,d,A);m[y]=h[t]}return{dataId:n.write(m,o,i.dtype),shape:o,dtype:i.dtype}}},x0=bY((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),w0=jY(xk,x0),_0={kernelName:xk,backendName:"cpu",kernelFunc:w0};function S0(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,s=i.shape.length;let o=a;if(-1===o&&(o=s-1),o!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(s," and dim was ").concat(o));const l=rE([o],i.shape),c=a0({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=wL(c.shape,l),h=WY({inputs:{x:c},backend:n,attrs:{shape:u}}),d=t$({inputs:{a:i,b:h},backend:n}),A=QZ({inputs:{x:d},backend:n}),p=NZ({inputs:{x:A},backend:n,attrs:{axis:l,keepDims:!1}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:u}}),g=JZ({inputs:{a:A,b:f},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}const C0={kernelName:AI,backendName:"cpu",kernelFunc:S0};const E0={kernelName:wk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:s,normalized:o}=r;lY(i,"multinomial");const l=o?i:S0({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=n.data.get(l.dataId).values,d=[c,a],A=yE(YC(d),"int32");for(let p=0;p<c;++p){const e=p*u,t=new Float32Array(u-1);t[0]=h[e];for(let i=1;i<t.length;++i)t[i]=t[i-1]+h[e+i];const n=zP.alea(s.toString()),r=p*a;for(let i=0;i<a;++i){const e=n();A[r+i]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){A[r+i]=n;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",A)}};function N0(e,t,n){const r=pT(-1,n);return _Z([],t,r,e,n)}const k0={kernelName:Sk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;lY(r,"neg");const i=n.data.get(r.dataId).values,[a,s]=N0(i,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,a)}},I0=ND;const T0={kernelName:Ek,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r;lY(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,{selectedIndices:h}=I0(c,u,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},B0=kD;const M0={kernelName:Nk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=r;lY(i,"NonMaxSuppressionPadded");const u=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,{selectedIndices:d,validOutputs:A}=B0(u,h,s,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([A]))]}},F0=ID;const R0={kernelName:kk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=r;lY(i,"NonMaxSuppressionWithScore");const u=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,d=s,A=o,p=l,f=c,{selectedIndices:g,selectedScores:m}=F0(u,h,d,A,p,f);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}},L0=bY((e,t)=>e!==t?1:0),P0=jY(Ck,L0,null,"bool"),U0={kernelName:Ck,backendName:"cpu",kernelFunc:P0};const D0={kernelName:Tk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:a,depth:s,onValue:o,offValue:l}=r;lY(i,"oneHot");const c=YC(i.shape),u=new Float32Array(c*s);u.fill(l);const h=n.data.get(i.dataId).values;for(let d=0;d<c;++d)h[d]>=0&&h[d]<s&&(u[d*s+h[d]]=o);return n.makeTensorInfo([...i.shape,s],a,u)}};function O0(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=LY({inputs:{input:r},backend:n}),t=O0({inputs:{x:e},backend:n}),i=KJ({inputs:{input:r},backend:n}),a=O0({inputs:{x:i},backend:n}),s=MY({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),s}return o$({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const j0={kernelName:PI,backendName:"cpu",kernelFunc:O0};const z0={kernelName:Ik,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const t=LY({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=KJ({inputs:{input:i},backend:r}),s=O0({inputs:{x:a},backend:r}),o=MY({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}return o$({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};function H0(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return GZ({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,s=t[0].dtype;t.forEach(e=>{KC(a,e.shape,"All tensors passed to stack must have matching shapes"),qC(s===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=YJ({inputs:t.map(e=>{const t=GZ({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t}),backend:n,attrs:{axis:i}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}const Q0={kernelName:Bk,backendName:"cpu",kernelFunc:H0};const V0={kernelName:Mk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:s}=r;lY(i,"pad");const o=a.map((e,t)=>e[0]+i.shape[t]+e[1]),l=a.map(e=>e[0]),c=n.data.get(i.dataId).values,u=YC(i.shape),h=i.shape.length,d=pE(i.shape),A=YC(o),p=o.length,f=pE(o),g=aE(i.dtype,A);0!==s&&g.fill(s);for(let m=0;m<u;m++){const e=wE(m,h,d).map((e,t)=>e+l[t]);g[xE(e,p,f)]=c[m]}return{dataId:n.write(g,o,i.dtype),shape:o,dtype:i.dtype}}},G0=bY((e,t)=>Math.pow(e,t)),W0=jY(Fk,G0),q0={kernelName:Fk,backendName:"cpu",kernelFunc:W0};function K0(e,t,n,r){const[i,a]=xL(e,r),s=HT(t,"int32"),o=yE(YC(i),s),l=YC(a);for(let c=0;c<o.length;++c){const e=c*l;let t=1;for(let r=0;r<l;++r)t*=n[e+r];o[c]=t}return{outVals:o,outShape:i,outDtype:s}}const X0={kernelName:Lk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;lY(i,"prod");const o=i.shape.length,l=rE(a,i.shape),c=SL(l,o);let u=l,h=i;const d=[];null!=c&&(h=aJ({inputs:{x:i},backend:n,attrs:{perm:c}}),d.push(h),u=EL(u.length,o));const A=n.data.get(h.dataId).values,{outVals:p,outShape:f,outDtype:g}=K0(h.shape,h.dtype,A,u);let m=f;return s&&(m=wL(f,l)),d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(m,g,p)}};function Y0(e,t,n,r){const i=[];let a=0;const s=t.length-1+n.length,o=new Array(s).fill(null).map(()=>[0]);!function(e,t){for(let n=0;n<e.length;++n){const r=e[n],i=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];const e=t[c+1];for(let t=1;t<l+1;++t)o[c].push(t*e)}for(let c=0;c<e.length;++c){let r=e[c],s=e[c]+1;for(let e=0;e<n.length;++e){const i=n[e],a=e+t.length-1;if(a>=0){const e=o[a],t=e[e.length-1]-i[r];for(let n=r;n<s;++n)o[a].push(i[n+1]+t)}r=i[r],s=i[s]}s!==r&&(i.push([r,s]),a+=s-r)}return{outSplits:o,valueSlices:i,numValues:a}}function J0(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function Z0(e,t,n,r,i){const a=t.slice();a[0]=i;const s=sE(n,YC(a)),o=e.length;return function(e,t,n,r,i,a){const s=J0(t,2)[1],o=J0(a,2)[1];let l=0;for(const c of n)for(let t=c[0];t<c[1];++t){for(let n=0;n<r;++n)i[l*o+n]=e[t*s+n];++l}}(e,t,r,0===o?0:o/t[0],s,a),[s,a]}function $0(e,t,n,r,i,a,s,o){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((e,r)=>{if(e<0||e>=n){const i=wE(r,t.length,pE(t)).join(",");throw new Error("indices[".concat(i,"] = ").concat(e," is not in [0, ").concat(n,")"))}})}(a,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:u,numValues:h}=Y0(a,s,e,l),d=function(e){const t=[];for(let n=0;n<e.length;++n){const r=sE("int32",e[n].length);t.push(r),e[n].forEach((e,t)=>r[t]=e)}return t}(c),A=Z0(n,r,i,u,h);return[d,A[0],A[1]]}const e1={kernelName:Pk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:a,indices:s}=t,{outputRaggedRank:o}=r,l=i.map(e=>n.data.get(e.dataId).values),c=i.map(e=>e.shape),u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,[d,A,p]=$0(l,c,u,a.shape,a.dtype,h,s.shape),f=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),g=n.makeTensorInfo(p,a.dtype,A);return f.concat([g])}},t1=2147483647;function n1(e,t,n,r,i,a,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const o=0===t.length,l=0===i.length,c=0===s.length,u=[];o||u.push(t[0]),l||u.push(i[0]),c||u.push(s[0]);for(let f=1;f<u.length;++f)if(u[f]!==u[f-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===u.length?1:u[0],d=sE("int32",h+1);d[0]=0;for(let f=0;f<h;++f){const t=o?e[0]:e[f],n=l?r[0]:r[f],i=c?a[0]:a[f];if(0===i)throw new Error("Requires delta != 0");let s;if(i>0&&n<t||i<0&&n>t)s=0;else if(s=Math.ceil(Math.abs((n-t)/i)),s>t1)throw new Error("Requires ((limit - start) / delta) <= ".concat(t1));d[f+1]=d[f]+s}const A=sE(n,d[h]);let p=0;for(let f=0;f<h;++f){const t=d[f+1]-d[f];let n=o?e[0]:e[f];const r=c?a[0]:a[f];for(let e=0;e<t;++e)A[p++]=n,n+=r}return[d,A]}const r1={kernelName:Uk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:a}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,[c,u]=n1(s,r.shape,r.dtype,o,i.shape,l,a.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],r.dtype,u)]}};var i1=_O;class a1{constructor(e,t,n,r,i,a,s,o,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=a,this.defaultValueShape=s,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=CO(c),this.raggedRank=EO(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===i1.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===i1.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case i1.VALUE_ROWIDS:return a1.getMaxWidthValueRowID(t);case i1.ROW_SPLITS:return a1.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(i1[this.getRowPartitionTypeByDimension(e-1)]))}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],i=0;for(let a=1;a<t;++a){const t=e[a];t!==r&&(r=t,i=Math.max(a-n,i),n=a)}return Math.max(t-n,i)}tensorShapeFromTensor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return o1(e,n)}calculateOutputSize(e){const t=this.valuesShape;NO(this.defaultValueShape,t);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=SO(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let i=1;i<=this.raggedRank;++i)r[i]<0&&(r[i]=this.getMaxWidth(i));return r}calculateFirstParentOutputIndex(e,t,n){const r=Math.min(e,n),i=[];let a=0;for(let s=0;s<r;++s,a+=t)i.push(a);for(let s=r;s<e;++s)i.push(-1);return qC(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,n,r){const i=e.length,a=[];for(let s=0;s<i-1;++s){const i=e[s+1]-e[s];let o=Math.min(r,i),l=t[s];-1===l&&(o=0);for(let e=0;e<o;++e)a.push(l),l+=n;for(let e=0;e<i-o;++e)a.push(-1)}if(i>0&&a.length!==e[i-1])throw new Error("Invalid row split size.");return a}calculateOutputIndexValueRowID(e,t,n,r){const i=e.length,a=[];if(0===i)return[];let s=0,o=e[0];if(o>=t.length)throw new Error("Got currentValueRowId=".concat(o,", which is not less than ").concat(t.length));let l=t[o];a.push(l);for(let c=1;c<i;++c){const i=e[c];if(i===o)l>=0&&(++s,s<r?l+=n:l=-1);else{if(s=0,o=i,i>=t.length)throw new Error("Got nextValueRowId=".concat(i," which is not less than ").concat(t.length));l=t[i]}a.push(l)}if(a.length!==e.length)throw new Error("Invalid row ids.");return a}calculateOutputIndex(e,t,n,r){const i=this.getRowPartitionTensor(e),a=this.getRowPartitionTypeByDimension(e);switch(a){case i1.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,r);case i1.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,r);default:throw new Error("Unsupported partition type: ".concat(i1[a]))}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case i1.FIRST_DIM_SIZE:return e[0];case i1.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case i1.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(i1[t]))}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let a=n.length-2;a>=0;--a)n[a]=n[a+1]*t[a+1];const r=o1(t,!1),i=sE(this.valuesDType,YC(r));if(n[0]*t[0]>0){let a=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e){a=this.calculateOutputIndex(e-1,a,n[e],t[e])}this.setOutput(this.raggedRank,a,i,r)}return[r,i]}setOutput(e,t,n,r){if(0===n.length)return;const i=this.values,a=n;let s=r.slice();s=s.slice(e+1);const o=YC(s),l=t.length;let c=this.defaultValue;if(c.length!==o&&1!==c.length){const e=this.defaultValueShape;bB(()=>{const t=CR(c,e),n=HR(t,s);c=n.dataSync()})}let u=0,h=0,d=0;for(let A=0;A<=l;++A){let e=A<l?t[A]:-1;if(e!==d){if(h<d){const e=i.subarray(u*o);s1(a.subarray(h*o),e,(d-h)*o)}if(A>=l){const t=n.length;e=Math.floor(t/o)}if(e>d)if(1===this.defaultValue.length)a.subarray(d*o,e*o).fill(this.defaultValue[0]),d=e;else for(;e>d;){s1(a.slice(d*o),c,o),++d}e<0?(u=A+1,h=d):(u=A,h=d,d=h+1)}else++d}}}function s1(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function o1(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error("Dimension ".concat(r," must be >= 0"));if(r<-1)throw new Error("Dimension ".concat(r," must be >= -1"));r=-1}n.push(r)}return n}function l1(e,t,n,r,i,a,s,o,l,c){return new a1(e,t,n,r,i,a,s,o,l,c).compute()}const c1={kernelName:Dk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:a,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,c=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,d=o.map(e=>n.data.get(e.dataId).values),A=o.map(e=>e.shape),[p,f]=l1(c,i.shape,u,a.shape,a.dtype,h,s.shape,d,A,l);return n.makeTensorInfo(p,a.dtype,f)}};function u1(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return yE(0,r);const i=yE(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(let a=1;a<i.length;a++)i[a]=i[a-1]+n;return i}const h1={kernelName:Ok,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:a,step:s}=n,o=u1(r,i,s,a);return t.makeTensorInfo([o.length],a,o)}},d1=dY(zk,e=>1/e),A1={kernelName:zk,backendName:"cpu",kernelFunc:d1};const p1={kernelName:Wk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r;lY(i,"resizeBilinear");const l=pE(i.shape),[c,u]=o,[h,d,A,p]=i.shape,f=n.data.get(i.dataId).values,g=new Float32Array(YC([h,c,u,p])),m=[a&&c>1?d-1:d,a&&u>1?A-1:A],y=[a&&c>1?c-1:c,a&&u>1?u-1:u];let v=0;const b=m[0]/y[0],x=m[1]/y[1];for(let w=0;w<h;w++)for(let e=0;e<c;e++){let t;t=s?b*(e+.5)-.5:b*e;const n=Math.max(0,Math.floor(t)),r=t-n,i=Math.min(d-1,Math.ceil(t)),a=w*l[0]+n*l[1],o=w*l[0]+i*l[1];for(let e=0;e<u;e++){let t;t=s?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),i=t-n,c=Math.min(A-1,Math.ceil(t)),u=a+n*l[2],h=o+n*l[2],d=a+c*l[2],m=o+c*l[2];for(let e=0;e<p;e++){const t=f[u+e],n=f[h+e],a=t+(f[d+e]-t)*i,s=a+(n+(f[m+e]-n)*i-a)*r;g[v++]=s}}}return n.makeTensorInfo([h,c,u,p],"float32",g)}};const f1={kernelName:qk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r;lY([a,i],"resizeBilinearGrad");const o=pE(i.shape),[l,c,u,h]=i.shape,[,d,A]=a.shape,p=new Float32Array(l*c*u*h),f=[s&&d>1?c-1:c,s&&A>1?u-1:u],g=[s&&d>1?d-1:d,s&&A>1?A-1:A],m=f[0]/g[0],y=f[1]/g[1],v=n.data.get(a.dataId).values;let b=0;for(let x=0;x<l;x++){const e=x*o[0];for(let t=0;t<d;t++){const n=t*m,r=Math.floor(n),i=Math.min(Math.ceil(n),c-1),a=e+r*o[1],s=e+i*o[1],l=n-r,d=1-l;for(let e=0;e<A;e++){const t=e*y,n=Math.floor(t),r=Math.min(Math.ceil(t),u-1),i=t-n,c=1-i,A=a+n*o[2],f=a+r*o[2],g=s+n*o[2],m=s+r*o[2],x=d*c,w=d*i,_=l*c,S=l*i;for(let e=0;e<h;e++){const t=v[b++];p[A+e]+=t*x,p[f+e]+=t*w,p[g+e]+=t*_,p[m+e]+=t*S}}}}return n.makeTensorInfo([l,u,c,h],"float32",p)}};const g1={kernelName:Vk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r;lY(i,"resizeNearestNeighbor");const l=pE(i.shape),[c,u]=o,[h,d,A,p]=i.shape,f=n.data.get(i.dataId).values,g=new Float32Array(h*c*u*p),m=[a&&c>1?d-1:d,a&&u>1?A-1:A],y=[a&&c>1?c-1:c,a&&u>1?u-1:u],v=m[0]/y[0],b=m[1]/y[1];let x=0;for(let w=0;w<h;w++){const e=w*l[0];for(let t=0;t<c;t++){const n=s?v*(t+.5):v*t;let r=Math.min(d-1,a?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));const i=e+r*l[1];for(let e=0;e<u;e++){const t=s?b*(e+.5):b*e;let n=Math.min(A-1,a?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));const r=i+n*l[2];for(let e=0;e<p;e++){const t=f[r+e];g[x++]=t}}}}return n.makeTensorInfo([h,c,u,p],i.dtype,g)}};const m1={kernelName:Gk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r;lY([a,i],"resizeNearestNeighborGrad");const o=pE(i.shape),l=pE(a.shape),[c,u,h,d]=i.shape,[,A,p]=a.shape,f=new Float32Array(c*u*h*d),g=n.data.get(a.dataId).values,m=[s&&A>1?u-1:u,s&&p>1?h-1:h],y=[s&&A>1?A-1:A,s&&p>1?p-1:p],v=m[0]/y[0],b=m[1]/y[1],x=1/v,w=1/b,_=2*Math.ceil(x)+2,S=2*Math.ceil(w)+2;for(let C=0;C<c;C++){const e=C*o[0];for(let t=0;t<u;t++){const n=e+t*o[1],r=Math.floor(t*x),i=Math.floor(r-_/2);for(let a=0;a<h;a++){const r=n+a*o[2],c=Math.floor(a*w),m=Math.floor(c-S/2);for(let n=0;n<d;n++){let o=0;for(let r=0;r<_;r++){const c=r+i;if(c<0||c>=A)continue;const d=e+c*l[1],f=c*v;if(t===Math.min(u-1,s?Math.round(f):Math.floor(f)))for(let e=0;e<S;e++){const t=e+m;if(t<0||t>=p)continue;const r=d+t*l[2],i=t*b;a===Math.min(h-1,s?Math.round(i):Math.floor(i))&&(o+=g[r+n])}}f[r+n]=o}}}}return n.makeTensorInfo(i.shape,i.dtype,f)}};const y1={kernelName:Xk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r;lY(i,"reverse");const s=i.shape.length,o=rE(a,i.shape);if(0===s)return gY({inputs:{x:i},backend:n});const l=new IT(i.shape,i.dtype),c=n.bufferSync(i);for(let u=0;u<l.size;u++){const e=l.indexToLoc(u),t=e.slice();o.forEach(e=>t[e]=i.shape[e]-1-t[e]),l.set(c.get(...t),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},v1={kernelName:OI,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:i}=t,{radians:a,fillValue:s,center:o}=n,l=r,c=aE(i.dtype,YC(i.shape)),[u,h,d,A]=i.shape,[p,f]=TO(o,h,d),g=Math.sin(a),m=Math.cos(a),y=l.data.get(i.dataId).values;for(let v=0;v<u;v++){const e=v*d*h*A;for(let t=0;t<h;t++){const n=t*(d*A);for(let r=0;r<d;r++){const i=r*A;for(let a=0;a<A;a++){const o=[u,t,r,a],l=o[2],v=o[1];let b=(l-p)*m-(v-f)*g,x=(l-p)*g+(v-f)*m;b=Math.round(b+p),x=Math.round(x+f);let w=s;if("number"!==typeof s&&(w=3===a?255:s[a]),b>=0&&b<d&&x>=0&&x<h){w=y[e+x*(d*A)+b*A+a]}c[e+n+i+a]=w}}}}return{dataId:l.write(c,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},b1=dY(Yk,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),x1={kernelName:Yk,backendName:"cpu",kernelFunc:b1},w1=hY(e=>1/Math.sqrt(e)),_1=AY(Jk,w1),S1={kernelName:Jk,backendName:"cpu",kernelFunc:_1};function C1(e,t,n,r,i,a,s,o,l,c){const u=[r/i,i],h=e.values,d=t.values;if(0===r)return kM(n,t.dtype);const A=l instanceof IT?l:kM(u,t.dtype);"string"===typeof l||"number"===typeof l?A.values.fill(l):"boolean"===typeof l&&A.values.fill(+l);for(let p=0;p<a;p++){const e=[];let a=0;for(let t=0;t<s;t++){const n=h[p*s+t];e.push(n),a+=n*o[t]}if(a<0||a>=r/i)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<i;n++)c?A.values[a*i+n]+=d[p*i+n]:A.values[a*i+n]=0===t.rank?d[0]:d[p*i+n]}return A}const E1={kernelName:Zk,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UU(0,i,s),d=C1(n.bufferSync(i),n.bufferSync(a),s,h,c,l,o,u,0,!0);return n.makeTensorInfo(s,d.dtype,d.values)}};function N1(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<t?n=i+1:r=i;return r}function k1(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<=t?n=i+1:r=i;return r}const I1={kernelName:eI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:a}=t,{side:s}=r,o=function(e,t,n,r,i,a){const s=sE("int32",n*i);for(let o=0;o<n;++o){const n=e.slice(o*r,(o+1)*r),l=o*i;for(let e=0;e<i;++e)s[l+e]="left"===a?N1(n,t[e+l]):k1(n,t[e+l])}return s}(n.data.get(i.dataId).values,n.data.get(a.dataId).values,i.shape[0],i.shape[1],a.shape[1],s);return n.makeTensorInfo(a.shape,"int32",o)}};const T1={kernelName:tI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t;lY([r,i,a],"select");const s=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,u=HT(i.dtype,a.dtype),h=yE(YC(i.shape),u);let d=0;const A=0===s||s>1||1===i.shape.length?1:YC(i.shape.slice(1));for(let p=0;p<o.length;p++)for(let e=0;e<A;e++)1===o[p]?h[d++]=l[p]:h[d++]=c[p];return n.makeTensorInfo(i.shape,u,h)}},B1=UO,M1=DO,F1=dY(nI,e=>e>=0?M1*e:B1*(Math.exp(e)-1)),R1={kernelName:nI,backendName:"cpu",kernelFunc:F1},L1=dY(sI,e=>e<0?-1:e>0?1:0),P1={kernelName:sI,backendName:"cpu",kernelFunc:L1},U1=dY(iI,e=>Math.sin(e)),D1={kernelName:iI,backendName:"cpu",kernelFunc:U1},O1=dY(aI,e=>Math.sinh(e)),j1={kernelName:aI,backendName:"cpu",kernelFunc:O1},z1=Math.log(1.1920928955078125e-7)+2,H1=dY(lI,e=>{const t=e>-z1,n=e<z1,r=Math.exp(e);let i;return i=n?r:t?e:Math.log(1+r),i}),Q1={kernelName:lI,backendName:"cpu",kernelFunc:H1};const V1={kernelName:hI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:s}=r;lY([i],"spaceToBatchND");const o=YC(a),l=[[0,0]];l.push(...s);for(let g=1+a.length;g<i.shape.length;++g)l.push([0,0]);const c=V0.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),u=BO(c.shape,a,o,!1),h=MO(u.length,a.length,!1),d=FO(c.shape,a,o,!1),A=WY({inputs:{x:c},backend:n,attrs:{shape:u}}),p=aJ({inputs:{x:A},backend:n,attrs:{perm:h}}),f=WY({inputs:{x:p},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),f}};function G1(e,t,n,r,i,a,s){const o=t[0],l=a[0],c=new Array(l),u=new Array(o),h=t[1];if(0===l){if(0!==o)throw new Error(uj(o));return[sE(n,0),[0,h],sE(i,0),c,u]}let d=!0,A=0;const p=new Array(l).fill(0);for(let g=0;g<o;++g){const t=e[g*h];if(t<0)throw new Error(hj(g,t));if(t>=l)throw new Error(dj(g,t,l));++p[t],d=d&&t>=A,A=t}let f=!0;for(let g=0;g<l;++g){const e=0===p[g];c[g]=e,f=f&&!e,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(f&&d){const t=e,n=r;for(let e=0;e<o;++e)u[e]=e;return[t,[o,h],n,c,u]}{const t=p[l-1],a=sE(n,t*h),d=sE(i,t),A=new Array(l).fill(0);for(let n=0;n<o;++n){const t=e[n*h],i=A[t],s=(0===t?0:p[t-1])+i;A[t]++;for(let r=0;r<h;++r)a[s*h+r]=e[n*h+r];d[s]=r[n],u[n]=s}for(let e=0;e<l;++e){if(0===A[e]){const t=0===e?0:p[e-1];a[t*h+0]=e;for(let e=1;e<h;++e)a[t*h+e]=0;d[t]=s}}return[a,[t,h],d,c,u]}}const W1={kernelName:pI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:a,defaultValue:s}=t;if(1!==a.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(a.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==i.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(i.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));const o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values[0],[h,d,A,p,f]=G1(o,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,A),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}};function q1(e,t,n,r,i){const a=YC(r),s=t[0],o=i.length,l=[];let c=1,u=-1;for(let f=0;f<o;++f){const e=i[f];if(-1===e){if(-1!==u)throw new Error(Aj(u,f));u=f,l.push(1)}else{if(e<0)throw new Error(pj(f,e));c*=e,l.push(e)}}if(-1!==u){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const e=Math.trunc(a/c);if(c*e!==a)throw new Error(gj(r,l));l[u]=e}if(YC(l)!==a)throw new Error(mj(r,l));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}const A=[];if(o>0){A[o-1]=1;for(let e=o-2;e>=0;--e)A[e]=A[e+1]*l[e+1]}const p=sE(n,s*o);for(let f=0;f<s;++f){let t=0;for(let n=0;n<h;++n)t+=e[f*h+n]*d[n];for(let e=0;e<o;++e)p[f*o+e]=Math.trunc(t/A[e]),t%=A[e]}return[p,[s,o],l]}const K1={kernelName:fI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:a}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==i.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(i.shape));if(1!==a.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(a.shape));const s=Array.from(n.data.get(i.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(a.dataId).values),[c,u,h]=q1(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],a.dtype,new Int32Array(h))]}};function X1(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o=r.length,l=[t[0],e.length/t[0]],c=l[1],u=o>0?i[o-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const h=t.slice();h[0]=u;const d=sE(n,h.reduce((e,t)=>e*t,1));if(0===o)return u>0&&d.fill(s),[d,h];if(u<=0)throw new Error("segment ids must be >= 0");let A=0,p=1,f=0,g=i[A];for(;;){let t=0;if(p<o){if(t=i[p],g===t){++p;continue}if(g>=t)throw new Error(vj())}if(g<0||g>=u)throw new Error(bj(g,u));g>f&&d.fill(s,f*c,g*c);for(let n=A;n<p;++n){const t=r[n];if(t<0||t>=l[0])throw new Error(xj(n,r[n],l[0]));for(let n=0;n<c;n++)d[g*c+n]+=e[t*c+n]}if(a)for(let e=0;e<c;e++)d[g*c+e]/=p-A;if(A=p,++p,f=g+1,g=t,p>o)break}return f<u&&d.fill(s,f*c,u*c),[d,h]}const Y1={kernelName:gI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(i.shape));if(1!==a.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(a.shape));if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,[c,u]=X1(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};const J1={kernelName:mI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(i.shape));if(1!==a.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(a.shape));if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,[c,u]=X1(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,c)}};const Z1={kernelName:yI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=UU(0,i,o),A=!1,p=n.bufferSync(i);let f;switch(a.dtype){case"bool":f=C1(p,n.bufferSync(a),o,d,u,c,l,h,Boolean(n.data.get(s.dataId).values[0]),A);break;case"float32":f=C1(p,n.bufferSync(a),o,d,u,c,l,h,n.data.get(s.dataId).values[0],A);break;case"int32":f=C1(p,n.bufferSync(a),o,d,u,c,l,h,n.data.get(s.dataId).values[0],A);break;case"string":f=C1(p,n.bufferSync(a),o,d,u,c,l,h,yT(n.data.get(s.dataId).values[0]),A);break;default:throw new Error("Unsupported type ".concat(a.dtype))}return n.makeTensorInfo(o,f.dtype,f.values)}};const $1={kernelName:dI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:s}=r,o=rE(s,i.shape)[0],l=cj(i,a,o),c=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map(e=>{const t=[...u];t[o]=e;const r=BJ({inputs:{x:i},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r})}},e2=hY(e=>Math.sqrt(e)),t2=dY(cI,e=>Math.sqrt(e)),n2={kernelName:cI,backendName:"cpu",kernelFunc:t2},r2={kernelName:bI,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:r}=t,i=n;lY(r,"square");const a=i.data.get(r.dataId).values,s=new Float32Array(a.length);for(let o=0;o<a.length;++o){const e=a[o];s[o]=e*e}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},i2=bY((e,t)=>{const n=e-t;return n*n}),a2=jY(vI,i2),s2={kernelName:vI,backendName:"cpu",kernelFunc:a2},o2=hY((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=t;return e.replace(new RegExp(n,r?"g":""),i)}),l2=AY(xI,o2),c2={kernelName:xI,backendName:"cpu",kernelFunc:l2},u2=dY(UI,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),h2={kernelName:UI,backendName:"cpu",kernelFunc:u2};function d2(e,t,n,r){const i=kM(e,t.dtype);for(let a=0;a<i.size;a++){const e=i.indexToLoc(a),s=new Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t]*n[t]+r[t];i.set(t.get(...s),...e)}return i}const A2={kernelName:wI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:s,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r;lY(i,"stridedSlice");const{finalShapeSparse:A,finalShape:p,isIdentity:f,sliceDim0:g,isSimpleSlice:m,begin:y,end:v,strides:b}=YF(i.shape,a,s,o,l,c,u,h,d);let x;if(f)x=WY({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||m){qC(i.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(i.shape.length));const e=UF(y,v,b),t=BJ({inputs:{x:i},backend:n,attrs:{begin:y,size:e}});x=WY({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=d2(A,n.bufferSync(i),b,y);x=n.makeTensorInfo(p,e.dtype,e.values)}return x}};class p2{constructor(e,t,n,r,i,a){this.separator=mT(e),this.nGramWidths=t,this.leftPad=mT(n),this.rightPad=mT(r),this.padWidth=i,this.preserveShort=a}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,i,a){for(let s=0;s<i;++s){const o=this.getPadWidth(a),l=Math.max(0,o-s),c=Math.max(0,o-(i-(s+1))),u=a-(l+c),h=t+(l>0?0:s-o);let d=0;d+=l*this.leftPad.length;for(let t=0;t<u;++t)d+=e[h+t].length;d+=c*this.rightPad.length;d+=(l+c+u-1)*this.separator.length,n[r+s]=new Uint8Array(d);const A=n[r+s];let p=0;const f=e=>e.forEach(e=>A[p++]=e);for(let e=0;e<l;++e)f(this.leftPad),f(this.separator);for(let t=0;t<u-1;++t)f(e[h+t]),f(this.separator);if(u>0){f(e[h+u-1]);for(let e=0;e<c;++e)f(this.separator),f(this.rightPad)}else{for(let e=0;e<c-1;++e)f(this.rightPad),f(this.separator);f(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error("First split value must be 0, got ".concat(e));for(let i=1;i<r;++i){let r=t[i]>=e;if(r=r&&t[i]<=n,!r)throw new Error("Invalid split value ".concat(t[i],", must be in [").concat(e,", ").concat(n,"]"));e=t[i]}if(e!==n)throw new Error("Last split value must be data size. Expected ".concat(n,", got ").concat(e))}const i=r-1,a=sE("int32",r);if(0===n||0===r){const e=new Array(n);for(let t=0;t<=i;++t)a[t]=0;return[e,a]}a[0]=0;for(let o=1;o<=i;++o){const e=t[o]-t[o-1];let n=0;this.nGramWidths.forEach(t=>{n+=this.getNumNGrams(e,t)}),this.preserveShort&&e>0&&0===n&&(n=1),a[o]=a[o-1]+n}const s=new Array(a[i]);for(let o=0;o<i;++o){const n=t[o];let r=a[o];if(this.nGramWidths.forEach(i=>{const a=t[o+1]-t[o],l=this.getNumNGrams(a,i);this.createNGrams(e,n,s,r,l,i),r+=l}),this.preserveShort&&r===a[o]){const i=t[o+1]-t[o];if(0===i)continue;const a=i+2*this.padWidth,l=1;this.createNGrams(e,n,s,r,l,a)}}return[s,a]}}function f2(e,t,n,r,i,a,s,o){return new p2(n,r,i,a,s,o).compute(e,t)}const g2={kernelName:_I,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:a,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=t,d=n.data.get(u.dataId).values,A=n.data.get(h.dataId).values,[p,f]=f2(d,A,i,a,s,o,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",f)]}};function m2(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const i=t[0];let a=e.indexOf(i);for(;-1!==a;){const t=e.subarray(0,a);n&&0===t.length||r.push(t),a=(e=e.subarray(a+1)).indexOf(i)}return void(n&&0===e.length||r.push(e))}let i=0;for(let a=0;a<e.length+1;a++)if(a===e.length||-1!==t.indexOf(e[a])){const t=e.subarray(i,a);n&&0===t.length||r.push(t),i=a+1}}function y2(e,t,n){const r=e.length,i=[];let a=0,s=0;const o=new Array(r);for(let d=0;d<r;++d){const r=i.length;m2(e[d],t,n,i);const l=i.length-r;o[d]=l,a+=l,s=Math.max(s,l)}const l=sE("int32",2*a),c=new Array(a),u=[r,s];let h=0;for(let d=0;d<r;++d)for(let e=0;e<o[d];++e)l[2*h]=d,l[2*h+1]=e,c[h]=i[h],++h;return[l,c,u]}const v2={kernelName:SI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:a,delimiter:s}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==s.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(s.shape));const o=n.data.get(a.dataId).values,l=n.data.get(s.dataId).values[0],[c,u,h]=y2(o,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};function b2(e,t){const n=sE("int32",e.length);for(let r=0;r<e.length;++r)n[r]=AT(e[r]).modulo(t).getLowBitsUnsigned();return n}const x2={kernelName:CI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const s=b2(n.data.get(a.dataId).values,i);return n.makeTensorInfo(a.shape,"int32",s)}},w2=dY(NI,e=>Math.tan(e)),_2={kernelName:NI,backendName:"cpu",kernelFunc:w2},S2=dY(kI,e=>Math.tanh(e));const C2={kernelName:$k,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{tensor:r,indices:i,updates:a}=t,{sliceRank:s,numUpdates:o,sliceSize:l,strides:c,outputSize:u}=UU(0,i,r.shape),h=n.bufferSync(i),d=n.bufferSync(a),A=n.bufferSync(r),p=C1(h,d,r.shape,u,l,o,s,c,A,!1);return n.makeTensorInfo(r.shape,p.dtype,p.values)}};function E2(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=kM(n,e.dtype);for(let i=0;i<r.values.length;++i){const t=r.indexToLoc(i),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const a=e.locToIndex(n);r.values[i]=e.values[a]}return r}const N2={kernelName:II,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;lY(i,"tile");const s=E2(n.bufferSync(i),a);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},k2=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function I2(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;for(;r>n;){if(r-n>600){const i=r-n+1,a=t-n+1,s=Math.log(i),o=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*o*(i-o)/i)*Math.sign(a-i/2);I2(e,t,Math.max(n,Math.floor(t-a*o/i+l)),Math.min(r,Math.floor(t+(i-a)*o/i+l)))}const i=e[t];let a=n,s=r;for(WC(e,n,t),k2(e[r],i)>0&&WC(e,n,r);a<s;){for(WC(e,a,s),a++,s--;k2(e[a],i)<0;)a+=1;for(;k2(e[s],i)>0;)s-=1}0===k2(e[n],i)?WC(e,n,s):(s+=1,WC(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function T2(e,t,n,r,i){const a=t[t.length-1],[s,o]=[e.length/a,a],l=aE(n,s*r),c=aE("int32",s*r);for(let h=0;h<s;h++){const t=h*o,n=e.subarray(t,t+o);let a=new Array(n.length);n.forEach((e,t)=>a[t]={value:e,index:t}),r<a.length&&(I2(a,r),a=a.slice(0,r)),i&&a.sort(k2);const s=h*r,u=l.subarray(s,s+r),d=c.subarray(s,s+r);for(let e=0;e<r;e++)u[e]=a[e].value,d[e]=a[e].index}const u=t.slice();return u[u.length-1]=r,[kM(u,n,l),kM(u,"int32",c)]}const B2={kernelName:TI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a,sorted:s}=r;lY(i,"topk");const o=n.data.get(i.dataId).values,[l,c]=T2(o,i.shape,i.dtype,a,s);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};const M2={kernelName:BI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:a}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:c}=n,[u,h,d,A]=i.shape,[p,f]=null!=c?c:[h,d],g=[u,p,f,A],m=pE(i.shape),y=m[0],v=m[1],b=m[2],x=pE(g),w=x[0],_=x[1],S=x[2],C=aE(i.dtype,YC(g));C.fill(l);const E=r.data.get(i.dataId).values,N=r.data.get(a.dataId).values;for(let k=0;k<u;++k){const e=1===a.shape[0]?N:N.subarray(8*k,8*k+8);for(let t=0;t<p;++t)for(let n=0;n<f;++n)for(let r=0;r<A;++r){let i;const a=e[6]*n+e[7]*t+1;if(0===a)continue;const c=(e[0]*n+e[1]*t+e[2])/a,u=(e[3]*n+e[4]*t+e[5])/a,A=F2(c,d,o),p=F2(u,h,o);switch(s){case"nearest":i=L2(E,h,d,y,v,b,k,p,A,r,l);break;case"bilinear":i=P2(E,h,d,y,v,b,k,p,A,r,l);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(s))}C[k*w+t*_+n*S+r]=i}return r.makeTensorInfo(g,i.dtype,C)}return{dataId:r.write(C,g,i.dtype),shape:i.shape,dtype:i.dtype}}};function F2(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return VC(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return VC(0,n,t-1)}(e,t);case"nearest":return function(e,t){return VC(0,e,t-1)}(e,t);default:return function(e){return e}(e)}}function R2(e,t,n,r,i,a,s,o,l,c,u){return 0<=o&&o<t&&0<=l&&l<n?e[s*r+o*i+l*a+c]:u}function L2(e,t,n,r,i,a,s,o,l,c,u){return R2(e,t,n,r,i,a,s,Math.round(o),Math.round(l),c,u)}function P2(e,t,n,r,i,a,s,o,l,c,u){const h=Math.floor(o),d=Math.floor(l),A=h+1,p=d+1;return(A-o)*((p-l)*R2(e,t,n,r,i,a,s,h,d,c,u)+(l-d)*R2(e,t,n,r,i,a,s,h,p,c,u))+(o-h)*((p-l)*R2(e,t,n,r,i,a,s,A,d,c,u)+(l-d)*R2(e,t,n,r,i,a,s,A,p,c,u))}function U2(e,t,n,r){const i=rE(t,n)[0],a=[1,n[0],1];for(let p=0;p<i;p++)a[0]*=n[p];a[1]=n[i];for(let p=i+1;p<n.length;p++)a[2]*=n[p];const s=new Map,o=new Int32Array(n[i]),l=new IT(a,r,e),c=[],u=1===a[0]&&1===a[2];for(let p=0;p<n[i];p++){let t;if(u)t=e[p].toString();else{const e=[];for(let t=0;t<a[0];t++)for(let n=0;n<a[2];n++)e.push(l.get(t,p,n));t=e.join(",")}const n=s.get(t);if(null!=n)o[p]=n;else{const e=s.size;s.set(t,e),o[p]=e,c.push(p)}}const h=a.slice();h[1]=s.size;const d=new IT(h,r);c.forEach((e,t)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)d.set(l.get(n,e,r),n,t,r)});const A=n.slice();return A[i]=h[1],{outputValues:d.values,outputShape:A,indices:o}}const D2={kernelName:FI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;lY(a,"unique");const s=r.data.get(a.dataId).values,{outputValues:o,outputShape:l,indices:c}=U2(s,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,o),r.makeTensorInfo([c.length],"int32",c)]}};const O2={kernelName:RI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const s=i.shape.length,o=i.shape[a],l=new Array(s-1);let c=0;for(let A=0;A<s;A++)A!==a&&(l[c++]=i.shape[A]);const u=new Array(s).fill(0),h=i.shape.slice();h[a]=1;const d=new Array(o);for(let A=0;A<d.length;A++){u[a]=A;const e=BJ({inputs:{x:i},backend:n,attrs:{begin:u,size:h}});d[A]=WY({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};const j2={kernelName:LI,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:s}=r;lY(i,"unsortedSegmentSum");const o=[],l=[],c=i.shape.length-a.shape.length;let u=a;for(let d=0;d<c;++d){const e=GZ({inputs:{input:u},backend:n,attrs:{dim:d+1}});u=e,l.push(e)}for(let d=0;d<s;++d){const e=pT(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=MZ({inputs:{a:t,b:u},backend:n}),a=DY({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),s=CZ({inputs:{a:a,b:i},backend:n}),c=NZ({inputs:{x:s},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(t),l.push(r),l.push(a),l.push(s),l.push(c)}const h=H0({inputs:o,backend:n,attrs:{axis:0}});return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),h}},z2=[YY,ZY,eJ,nJ,GY,rJ,oJ,lJ,cJ,uJ,dJ,pJ,gJ,vJ,xJ,CJ,EJ,NJ,kJ,XY,IJ,FJ,PJ,OJ,jJ,OY,QJ,GJ,FY,WJ,JJ,$J,eZ,tZ,nZ,rZ,iZ,sZ,lZ,cZ,uZ,hZ,dZ,AZ,fZ,gZ,mZ,yZ,vZ,bZ,xZ,wZ,IZ,fY,TZ,FZ,zZ,VZ,WZ,XZ,s$,l$,c$,d$,f$,g$,m$,v$,x$,S$,N$,mY,k$,XJ,T$,M$,R$,vY,U$,j$,H$,G$,q$,Y$,Z$,t0,n0,r0,s0,c0,u0,h0,d0,A0,p0,f0,g0,v0,b0,_0,E0,EZ,k0,T0,M0,R0,U0,D0,z0,Q0,V0,q0,_Y,X0,e1,r1,c1,h1,PY,ZZ,A1,CY,NY,qY,p1,f1,g1,m1,y1,v1,x1,S1,E1,I1,T1,R1,TY,P1,D1,j1,MJ,C0,Q1,V1,W1,K1,Y1,J1,Z1,$1,n2,r2,s2,c2,h2,A2,g2,v2,x2,n$,kZ,_2,{kernelName:kI,backendName:"cpu",kernelFunc:S2},C2,N2,B2,M2,sJ,D2,O2,j2,j0];for(const n of z2)YI(n);const H2={},Q2={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function V2(e,t){if(!(e in H2)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if(NE().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete H2[e]},!1),NE().getBool("SOFTWARE_WEBGL_ENABLED")&&(Q2.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",Q2)||n.getContext("experimental-webgl",Q2);return n.getContext("webgl2",Q2)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;H2[e]=n}const n=H2[e];return null==n||n.isContextLost()?(delete H2[e],V2(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),H2[e])}var G2,W2,q2;function K2(e,t){return[t,e]}function X2(e){const t=YC(e);return $C(Math.ceil(t/4))}function Y2(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function J2(e,t){const n=e;let r,i,a,s,o,l,c,u,h,d;return 2===NE().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,a=n.RGBA16F,s=n.RGBA32F,o=n.RED,c=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=e.RGBA,i=e.RGBA,a=e.RGBA,s=n.RGBA,o=e.RGBA,c=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,l=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}function Z2(e,t){const n=t();return NE().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(G2||(G2={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(W2||(W2={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(q2||(q2={}));function $2(e){return!!(NE().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function e3(e,t){return c3(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}const t3=/ERROR: [0-9]+:([0-9]+):/g;function n3(e,t){const n=t3.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,s=i.map((e,t)=>eE((t+1).toString(),a)+e);let o=0;for(let h=0;h<s.length;h++)o=Math.max(s[h].length,o);const l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(eE(c[0],o)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}function r3(e,t){if(Z2(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function i3(e,t,n,r,i,a,s){const o=e.getAttribLocation(t,n);return-1!==o&&(Z2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),Z2(e,()=>e.vertexAttribPointer(o,i,e.FLOAT,!1,a,s)),Z2(e,()=>e.enableVertexAttribArray(o)),!0)}function a3(e,t,n,r){Z2(e,()=>function(e,t,n){u3(e,n),Z2(e,()=>e.activeTexture(e.TEXTURE0+n)),Z2(e,()=>e.bindTexture(e.TEXTURE_2D,t))}(e,t,r)),Z2(e,()=>e.uniform1i(n,r))}function s3(e,t,n){Z2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),Z2(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function o3(e,t){Z2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),Z2(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function l3(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function c3(e,t,n){const r=Z2(e,()=>t());if(null==r)throw new Error(n);return r}function u3(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function h3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return YC(e.slice(0,e.length-t))}function d3(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function A3(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[h3(e),...d3(e)]),t}function p3(e){return e%2===0}function f3(e,t){if(JC(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(p3(n)&&p3(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&p3(e[0])&&p3(t[0])}let g3,m3;function y3(e,t){return null!=e.getExtension(t)}function v3(e){try{if(null!=V2(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function b3(e){if(0===e)return!1;const t=V2(e);if(1!==e){if(y3(t,"EXT_color_buffer_float"))return x3(t);const e="EXT_color_buffer_half_float";if(y3(t,e)){const n=t.getExtension(e);return function(e,t){const n=J2(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const i=1,a=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,i,a,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),o}(t,n)}return!1}if(!y3(t,"OES_texture_float"))return!1;if(!y3(t,"WEBGL_color_buffer_float"))return!1;return x3(t)}function x3(e){const t=J2(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function w3(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&qC("complex64"!==e.dtype,()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend.")})}const _3=NE();function S3(){let e,t,n,r,i,a,s,o,l,c;return 2===NE().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",s="out vec4 outputColor;",o=NE().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",s="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:s,defineSpecialNaN:o,defineSpecialInf:l,defineRound:c}}function C3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=pE(t);return r.map((t,i)=>{const a="int ".concat(e[i]," = ").concat(n," / ").concat(t),s=i===r.length-1?"int ".concat(e[i+1]," = ").concat(n," - ").concat(e[i]," * ").concat(t):"index -= ".concat(e[i]," * ").concat(t);return"".concat(a,"; ").concat(s,";")}).join("")}function E3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=pE(t);return r.map((t,i)=>{const a="int ".concat(e[i]," = ").concat(n," / outShapeStrides[").concat(i,"]"),s=i===r.length-1?"int ".concat(e[i+1]," = ").concat(n," - ").concat(e[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(e[i]," * outShapeStrides[").concat(i,"]");return"".concat(a,"; ").concat(s,";")}).join("")}function N3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=e.map((e,t)=>t),i=function(e,t){const n=e.length,r=e.map(e=>"".concat(t,"[").concat(e,"]")),i=new Array(n-1);i[n-2]=r[n-1];for(let a=n-3;a>=0;--a)i[a]="(".concat(i[a+1]," * ").concat(r[a+1],")");return i}(r,t);return i.map((t,r)=>{const a="int ".concat(e[r]," = ").concat(n," / ").concat(i[r]),s=r===i.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(i[r]):"index -= ".concat(e[r]," * ").concat(i[r]);return"".concat(a,"; ").concat(s,";")}).join("")}function k3(e){const t=pE(e).map(e=>e.toString());return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}_3.registerFlag("HAS_WEBGL",()=>_3.getNumber("WEBGL_VERSION")>0),_3.registerFlag("WEBGL_VERSION",()=>v3(2)?2:v3(1)?1:0),_3.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),_3.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===_3.get("WEBGL_VERSION")),_3.registerFlag("WEBGL_CPU_FORWARD",()=>!0),_3.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),_3.registerFlag("WEBGL_PACK",()=>_3.getBool("HAS_WEBGL")),_3.registerFlag("WEBGL_PACK_NORMALIZATION",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_CLIP",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_REDUCE",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_LAZILY_UNPACK",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_CONV_IM2COL",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>_3.getBool("WEBGL_PACK")),_3.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(e){if(null==g3){const t=V2(e);g3=t.getParameter(t.MAX_TEXTURE_SIZE)}return g3}(_3.getNumber("WEBGL_VERSION"))),_3.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(e){if(null==m3){const t=V2(e);m3=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,m3)}(_3.getNumber("WEBGL_VERSION"))),_3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=_3.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=V2(e);return t=y3(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:y3(n,"EXT_disjoint_timer_query")?1:0,t}(e)}),_3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>_3.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!rB()),_3.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(e){if(0===e)return!1;const t=V2(e);if(1===e){if(!y3(t,"OES_texture_float"))return!1}else if(!y3(t,"EXT_color_buffer_float"))return!1;return x3(t)}(_3.getNumber("WEBGL_VERSION"))),_3.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!_3.getBool("WEBGL_FORCE_F16_TEXTURES")&&_3.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),_3.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>b3(_3.getNumber("WEBGL_VERSION"))),_3.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(e=_3.getNumber("WEBGL_VERSION"))&&null!=V2(e).fenceSync;var e}),_3.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>_3.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),_3.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}),_3.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>rB()?1:-1,e=>{if("number"!==typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))}),_3.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),_3.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),_3.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),_3.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),_3.registerFlag("WEBGL_EXP_CONV",()=>!1),_3.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>_3.getBool("IS_TEST")),_3.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),_3.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),_3.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),_3.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);const I3="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:T3}=s;function B3(e,t,n){const r=[];if(e.forEach(e=>{const t=YC(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){const{uniformShape:t}=z3(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))});const i=r.join("\n"),a=e.map(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i="";i+=n?F3(e,r):M3(e,r);const a=e.shapeInfo.logicalShape,s=t.logicalShape;a.length<=s.length&&(i+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,o=T3(e.shapeInfo.logicalShape,t.logicalShape),l=j3(s),c=s-a;let u;const h=["x","y","z","w","u","v"];u=0===a?"":s<2&&o.length>=1?"coords = 0;":o.map(e=>"coords.".concat(h[e+c]," = 0;")).join("\n");let d="";d=s<2&&a>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(h[t+c])).join(", ");let A="return outputValue;";const p=1===YC(e.shapeInfo.logicalShape),f=YC(t.logicalShape),g=1===f;if(1!==a||p||g){if(p&&!g)A=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=a-2,t=a-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?A="return vec4(outputValue.x);":o.indexOf(e)>-1?A="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(A="return vec4(outputValue.xx, outputValue.zz);")}}else A="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(u,"\n      vec4 outputValue = get").concat(r,"(").concat(d,");\n      ").concat(A,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===l&&null==e.shapeInfo.flatOffset&&JC(s,a))return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const c=j3(l),u=T3(e.shapeInfo.logicalShape,t.logicalShape),h=l-o;let d;const A=["x","y","z","w","u","v"];d=0===o?"":l<2&&u.length>=1?"coords = 0;":u.map(e=>"coords.".concat(A[e+h]," = 0;")).join("\n");let p="";p=l<2&&o>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>"coords.".concat(A[t+h])).join(", ");return"\n    float ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}(e,t));return i}(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),s=t.texShape,o=S3(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(o);let c,u,h=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(R3,"\n    ").concat(L3,"\n    ").concat(P3,"\n  ");return t}(o);t.isPacked?(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(JC(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");const i=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(i,");\n      int c = imod(index, ").concat(i,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),a=i*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(i,");\n      int c = imod(index, ").concat(i,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),a=i*Math.ceil(e[e.length-2]/2);let s=a,o="",l="b, r, c";for(let c=2;c<e.length-1;c++)s*=e[e.length-c-1],o="\n      int b".concat(c," = index / ").concat(s,";\n      index -= b").concat(c," * ").concat(s,";\n    ")+o,l="b".concat(c,", ")+l;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(i,");\n      int c = imod(index, ").concat(i,") * 2;\n\n      return ivec").concat(e.length,"(").concat(l,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,s,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(o)):(c=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(JC(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){const t=E3(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(t,"\n    return ivec3(r, c, d);\n  }\n")}const r=C3(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){const t=E3(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(t,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}const r=C3(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){const n=C3(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=C3(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,s,n.enableShapeUniforms),u=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(o)),n.packedInputs&&(h+=U3);return[h,l,u,i,c,a,n.userCode].join("\n")}function M3(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");const[i,a]=e.shapeInfo.texShape;if(1===i&&1===a)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const s=D3(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const[o,l]=e.shapeInfo.texShape;return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(O3(e),"\n      }\n    ");const i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");const o=D3(n);if(1===s)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===a)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(s,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(s,", index + ").concat(o,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape;if(null!=a&&JC(n,a)){if(t)return"\n      float ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const e=a[0],n=a[1];return"\n    float ".concat(i,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(n,".0, ").concat(e,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}const{newShape:s,keptDims:o}=iE(n),l=s;if(l.length<n.length){const n=H3(e,l),r=["row","col"];return"\n      ".concat(M3(n,t),"\n      float ").concat(i,"(int row, int col) {\n        return ").concat(i,"(").concat(Q3(r,o),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(O3(e),"\n      }\n    ");const c=a[0],u=a[1],h=D3(r);if(1===u)return t?"\n      float ".concat(i,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(c,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===c)return t?"\n      float ".concat(i,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(u,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(i,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(i,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(c,", ").concat(u,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],s=n[2],{newShape:o,keptDims:l}=iE(n),c=o;if(c.length<n.length){const n=H3(e,c),r=["row","col","depth"];return"\n        ".concat(M3(n,t),"\n        float ").concat(i,"(int row, int col, int depth) {\n          return ").concat(i,"(").concat(Q3(r,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(s,", 1)));\n        ").concat(O3(e),"\n      }\n    ");const u=e.shapeInfo.texShape,h=u[0],d=u[1],A=e.shapeInfo.flatOffset;if(d===a&&null==A)return t?"\n      float ".concat(i,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(i,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(d,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(d===s&&null==A)return t?"\n      float ".concat(i,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(d,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");const p=D3(r);if(t)return"\n    float ".concat(i,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(i,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(s," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],s=n[2]*a,o=n[1]*s,{newShape:l,keptDims:c}=iE(n);if(l.length<n.length){const n=H3(e,l),r=["row","col","depth","depth2"];return"\n      ".concat(M3(n,t),"\n      float ").concat(i,"(int row, int col, int depth, int depth2) {\n        return ").concat(i,"(").concat(Q3(r,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(s,", ").concat(a,", 1)));\n        ").concat(O3(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],A=h[1],p="int stride2 = ".concat(r,"Shape[3];"),f="int stride1 = ".concat(r,"Shape[2] * stride2;"),g="int stride0 = ".concat(r,"Shape[1] * stride1;");if(A===o&&null==u)return t?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        ").concat(p,"\n        ").concat(f,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(A===a&&null==u)return t?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");const m=D3(r);if(t)return"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(p,"\n      ").concat(f,"\n      ").concat(g,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(m,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(s," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(A,", index + ").concat(m,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,s=t[2]*a,o=t[1]*s,{newShape:l,keptDims:c}=iE(t);if(l.length<t.length){const t=H3(e,l),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(M3(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Q3(n,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(o,", ").concat(s,", ").concat(a,", ").concat(i,")) +\n          depth3;\n        ").concat(O3(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],A=h[1];if(A===o&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(a,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(A===i&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(A,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=D3(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(s," + depth * ").concat(a," +\n          depth2 * ").concat(i," + depth3 + ").concat(p,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(A,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:a}=iE(t);if(i.length<t.length){const t=H3(e,i),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(M3(t),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Q3(n,a),");\n      }\n    ")}const s=t[5],o=t[4]*s,l=t[3]*o,c=t[2]*l,u=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(c,", ").concat(l,", ").concat(o,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(O3(e),"\n      }\n    ");const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,A=d[0],p=d[1];if(p===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(c,", ").concat(l,", ").concat(o,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(A,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===s&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(A,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const f=D3(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(c," + depth * ").concat(l," +\n          depth2 * ").concat(o," + depth3 * ").concat(s," + depth4 + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(A,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function F3(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=S3();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=S3();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");const s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(s[0],", ").concat(s[1],", index);\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,s=a[0],o=a[1],l=S3();if(null!=a&&JC(n,a))return t?"\n      vec4 ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(l.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(s,".0);\n\n        return ").concat(l.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(i,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");const c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=Math.ceil(n[1]/2);return"\n    vec4 ".concat(i,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(u,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){const r=[1,2],a=H3(e,n.slice(1)),s=["b","row","col"];return"\n        ".concat(F3(a,t),"\n        vec4 ").concat(i,"(int b, int row, int col) {\n          return ").concat(i,"(").concat(Q3(s,r),");\n        }\n      ")}const o=S3();if(t)return"\n    vec4 ".concat(i,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(o.texture2D,"(").concat(r,", uv);\n    }\n  ");const l=s[0],c=s[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return"\n    vec4 ".concat(i,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(c,", ").concat(h,", ").concat(u,", b, row, col);\n      return ").concat(o.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=S3();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");const a=e.shapeInfo.logicalShape,s=a.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=l[0],u=l[1],h=Math.ceil(a[s-1]/2);let d=h*Math.ceil(a[s-2]/2),A="int b, int row, int col",p="b * ".concat(d," + (row / 2) * ").concat(h," + (col / 2)");for(let f=2;f<s-1;f++)A="int b".concat(f,", ")+A,d*=a[s-f-1],p="b".concat(f," * ").concat(d," + ")+p;return"\n    vec4 ".concat(r,"(").concat(A,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(c,");\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}const R3="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",L3="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",P3="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",U3="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function D3(e){return"offset".concat(e)}function O3(e){const t=e.name,n=YC(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function j3(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function z3(e,t,n){const{newShape:r,keptDims:i}=iE(t),a=t.length,s=e&&3===a&&1===t[0],o=s?t.slice(1):r,l=!e&&a>1&&!JC(t,n)&&r.length<a||s;return{useSqueezeShape:l,uniformShape:l?o:t,keptDims:i}}function H3(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Q3(e,t){return t.map(t=>e[t]).join(", ")}function V3(e,t,n,r){const i=n.map((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),a=i.map(e=>e.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=B3(i,s,t),l=function(e,t){const n=c3(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Z2(e,()=>e.shaderSource(n,t)),Z2(e,()=>e.compileShader(n)),NE().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw n3(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,o),c=e.createProgram(l);return NE().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:a,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:c,inShapeInfos:a,outShapeInfo:s},G3(e,t,c)))}function G3(e,t,n){const r=[],i=[];let a,s,o,l=null,c=null;c=e.getUniformLocation(n,"NAN",!1),1===NE().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const h of t.variableNames){const i={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,"offset".concat(h),u)};t.enableShapeUniforms&&(i.shape=e.getUniformLocation(n,"".concat(h,"Shape"),u),i.texShape=e.getUniformLocation(n,"".concat(h,"TexShape"),u)),r.push(i)}if(t.enableShapeUniforms&&(a=e.getUniformLocation(n,"outShape",u),o=e.getUniformLocation(n,"outShapeStrides",u),s=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(const h of t.customUniforms)i.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:r,customUniformLocations:i,infLoc:l,nanLoc:c,outShapeLocation:a,outShapeStridesLocation:o,outTexShapeLocation:s}}function W3(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((e,n)=>{const r=e.logicalShape,i=t[n],a=i.shape;if(!JC(r,a))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(a," must match"));if(e.isUniform&&i.isUniform)return;const s=e.texShape,o=i.isUniform?null:i.texData.texShape;if(!JC(s,o))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(o," must match"))})}function q3(e){return NE().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class K3{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=G2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=S3();this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?E3(["r","c","d"],e):C3(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class X3{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=G2.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=S3();this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?E3(["r","c","d"],e):C3(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}class Y3{constructor(e){this.variableNames=["A"],this.outTexUsage=W2.DOWNLOAD;const t=S3();this.outputShape=e,this.userCode="\n      ".concat(I3,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class J3{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=W2.DOWNLOAD;const t=S3();this.outputShape=e,this.userCode="\n      ".concat(I3,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}const Z3={R:0,G:1,B:2,A:3};class $3{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=S3();this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let a="";for(let s=0;s<n.length;s++){const e=n[s];a+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(Z3[e],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":k3(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(n.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(n.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(r.texture2D,"(A, uv);\n          ").concat(a,"\n        }\n        ").concat(r.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")}}class e5{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=S3();this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let a=0;a<=1;a++)for(let t=0;t<=1;t++){const i=2*a+t;r+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(t,";\n          if (localCoords[1] + ").concat(a," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(a,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(n.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(i,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(i,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(i,"] = values[2];\n            } else {\n              result[").concat(i,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":k3(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(r,"\n\n          ").concat(n.output," = ").concat(i,";\n        }\n    ")}}function t5(e){const t=S3();return function(e,t){const n=c3(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Z2(e,()=>e.shaderSource(n,t)),Z2(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function n5(e){return function(e,t){const n=c3(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return Z2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),Z2(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function r5(e){return function(e,t){const n=c3(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return Z2(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),Z2(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}(e,new Uint16Array([0,1,2,2,1,3]))}function i5(e,t,n,r,i,a){!function(e,t){const n=NE().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const r="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);const s=function(e){return c3(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}(e),o=e.TEXTURE_2D;return Z2(e,()=>e.bindTexture(o,s)),Z2(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),Z2(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),Z2(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),Z2(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===NE().getNumber("WEBGL_VERSION")?Z2(e,()=>e.texImage2D(o,0,r,t,n,0,i,a,null)):Z2(e,()=>e.texStorage2D(o,1,r,t,n)),Z2(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:s,texShape:[n,t]}}function a5(e){return e.internalFormatFloat}function s5(e){return e.internalFormatHalfFloat}function o5(e){return e.downloadTextureFormat}function l5(e){return e.internalFormatPackedFloat}function c5(e){return e.internalFormatPackedHalfFloat}function u5(e,t,n,r,i,a,s,o){const l=e,c=new Float32Array(function(e,t){const[n,r]=Y2(e,t);return n*r*4}(a,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}class h5{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=NE().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,function(e,t){H2[e]=t}(t,e)):this.gl=V2(t),e=this.gl,2===NE().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>Z2(t,()=>t.createVertexArray()),this.bindVertexArray=e=>Z2(t,()=>t.bindVertexArray(e)),this.deleteVertexArray=e=>Z2(t,()=>t.deleteVertexArray(e)),this.getVertexArray=()=>Z2(t,()=>t.getParameter(t.VERTEX_ARRAY_BINDING))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Z2(e,()=>t.createVertexArrayOES()),this.bindVertexArray=n=>Z2(e,()=>t.bindVertexArrayOES(n)),this.deleteVertexArray=n=>Z2(e,()=>t.deleteVertexArrayOES(n)),this.getVertexArray=()=>Z2(e,()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===NE().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=e3(this.gl,e),y3(this.gl,t))this.textureHalfFloatExtension=e3(this.gl,t);else if(NE().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),y3(this.gl,r))this.colorBufferHalfFloatExtension=e3(this.gl,r);else if(NE().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",y3(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!y3(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=n5(this.gl),this.indexBuffer=r5(this.gl),this.framebuffer=function(e){return c3(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=J2(this.gl,this.textureHalfFloatExtension)}get debug(){return NE().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Z2(e,()=>e.finish()),Z2(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Z2(e,()=>e.deleteFramebuffer(this.framebuffer)),Z2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Z2(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Z2(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=K2(t,n);return i5(e,i,a,a5(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=K2(t,n);return i5(e,i,a,s5(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=K2(t,n);return i5(e,i,a,o5(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){Z2(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===NE().getNumber("WEBGL_VERSION")?Z2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):Z2(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===NE().getNumber("WEBGL_VERSION")?Z2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):Z2(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),Z2(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,i,a){let s,o,l;Z2(e,()=>e.bindTexture(e.TEXTURE_2D,t)),i instanceof Uint8Array?(s=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(n*r*4),o=e.FLOAT,l=a.internalFormatPackedFloat),s.set(i),2===NE().getNumber("WEBGL_VERSION")?Z2(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,s)):Z2(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,s)),Z2(e,()=>e.bindTexture(e.TEXTURE_2D,null))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=Y2(t,n);return i5(e,i,a,c5(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=Y2(t,n);return i5(e,i,a,l5(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(o3(this.gl,this.framebuffer),this.outputTexture=null),Z2(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n,r){const[i,a]=K2(t,n),s=new Uint8Array(t*n*4);return Z2(e,()=>e.readPixels(0,0,i,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)),new Float32Array(s.buffer)}(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,i,a){return u5(this.gl,e,0,0,0,i,a,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n){const r=e.createBuffer();Z2(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r));const i=16*t*n;return Z2(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)),Z2(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),Z2(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(NE().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>function(e,t,n){const r=new Float32Array(t*n*4);return Z2(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}(this.gl,t,n))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=t5(t));const n=function(e){return c3(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}(t);Z2(t,()=>t.attachShader(n,this.vertexShader)),Z2(t,()=>t.attachShader(n,e)),function(e,t){if(Z2(e,()=>e.linkProgram(t)),!NE().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&r3(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Z2(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),function(e,t,n){Z2(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),i3(e,t,"clipSpacePos",n,3,20,0)&&i3(e,t,"uv",n,2,20,12)}(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(Z2(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&r3(this.gl,this.program),Z2(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return c3(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Z2(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),a3(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,i]=Y2(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&r3(this.gl,this.program),l3(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Z2(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Z2(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=e3(this.gl,2===NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await tE(()=>this.disposed||this.isQueryAvailable(e,NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in NE().platform&&(n=NE().platform.setTimeoutCustom.bind(NE().platform)),tE(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),s3(this.gl,e,this.framebuffer),this.debug&&l3(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(s3(this.gl,this.outputTexture,this.framebuffer),this.debug&&l3(this.gl)):o3(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;s3(r,e,this.framebuffer),this.debug&&l3(r),this.outputTexture=e,Z2(r,()=>r.viewport(0,0,t,n)),Z2(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),Z2(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{mx:d5,XI:A5,Nk:p5,f6:f5,ct:g5,YG:m5,hH:y5,z3:v5,sG:b5,uM:x5,vS:w5,qB:_5,GG:S5,rq:C5,lg:E5,WR:N5,cu:k5,GE:I5,px:T5,jC:B5,He:M5,hE:F5,BF:R5,Dk:L5,cl:P5,_B:U5,ub:D5,_f:O5,Ku:j5,qy:z5,Zy:H5,bu:Q5,zv:V5,dH:G5,HS:W5,yH:q5,l3:K5,z9:X5,x6:Y5,_m:J5,eW:Z5,GK:$5,SP:e4,yr:t4,dl:n4,Dw:r4,xT:i4,_X:a4,wz:s4}=N;function o4(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>"".concat(e,".").concat(t))}function l4(e,t){return 1===t?[e]:o4(e,t)}class c4{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=q3(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=l4("rc",this.rank),t=j3(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),i=this.getOutput(e);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(n,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(r,"\n\n            setOutput(vec4(").concat(i,"));\n          }\n        }\n      ")}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1");for(let t=2;t<this.rank;t++)i="".concat(e[e.length-1-t],",")+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);let t="";for(let n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}getOutput(e){const t=this.getSourceCoordsArr(e);if(1===this.rank){const e=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(e," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}class u4{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length);let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2===1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(r,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(r>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){const n=t?N3(["r","c","d"],"inputShape"):C3(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(t,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":k3(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":e[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class h4{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){const r=A4(t,n),i=p4(e,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const a=d4(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const e=this.freeTextures[i].pop();return this.usedTextures[i].push(e),e}let s;return r===q2.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===q2.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===q2.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===q2.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===q2.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(s),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const i=A4(n,r),a=p4(t,i,r);a in this.freeTextures||(this.freeTextures[a]=[]);const s=d4(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=NE().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const l=this.usedTextures[a],c=l&&l.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function d4(e,t,n,r,i){const a=function(e,t){switch(e){case q2.PACKED_2X2_FLOAT32:return l5(t);case q2.PACKED_2X2_FLOAT16:return c5(t);case q2.UNPACKED_FLOAT32:return a5(t);case q2.UNPACKED_FLOAT16:return s5(t);case q2.PACKED_4X1_UNSIGNED_BYTE:return o5(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);let s;if(i){const[t,n]=Y2(e[0],e[1]);s=t*n}else{const[t,n]=K2(e[0],e[1]);s=t*n}const o=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,a);return s*o}function A4(e,t){if(e===W2.UPLOAD)return q2.PACKED_2X2_FLOAT32;if(e===W2.RENDER||null==e)return function(e){return NE().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?q2.PACKED_2X2_FLOAT32:q2.UNPACKED_FLOAT32:e?q2.PACKED_2X2_FLOAT16:q2.UNPACKED_FLOAT16}(t);if(e===W2.DOWNLOAD||e===W2.PIXELS)return q2.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function p4(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class f4{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const g4="if (isnan(x)) return x;",m4="return abs(x);";const y4=g4+"\n  return (x < 0.0) ? 0.0 : x;\n",v4=g4+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",b4="return x;";class x4{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class w4{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length);const t=e.length,n=l4("rc",t),r=j3(t),i=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),s=t<=1?"rc":"vec2(".concat(a.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")}}const _4=WU,S4={};const C4=NE().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class E4 extends zC{nextDataId(){return E4.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!NE().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof h5)t=e;else{const n=V2(NE().getNumber("WEBGL_VERSION"),e);t=new h5(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=V2(NE().getNumber("WEBGL_VERSION"));t=new h5(e),this.binaryCache=((n=NE().getNumber("WEBGL_VERSION"))in S4||(S4[n]={}),S4[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new h4(this.gpgpu),this.numMBBeforeWarning=null==NE().global.screen?1024:NE().global.screen.height*NE().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new jC(this,yB())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,i,a){const s=this.makeTensorInfo(t,n),o=this.texData.get(s.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[r,i]},o.texShape=[r,i];const l=A3(t),c=new $3(l,!1,a),u=this.runWebGLProgram(c,[s],n,[[r,i]]);return u.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(s),u.dataId}write(e,t,n){if((NE().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||NE().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:W2.UPLOAD,refCount:1}),r}refCount(e){if(this.texData.has(e)){return this.texData.get(e).refCount}return 0}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}move(e,t,n,r,i){if(NE().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:W2.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:i,slice:a,shape:s,isPacked:o}=t;if(null!=a){let t;t=o?new x4(s,b4):new f4(s,b4);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const l=null!=this.activeTimers;let c,u;if(l&&(c=gT()),"complex64"===r){u=GO(this.readSync(i.real.dataId),this.readSync(i.imag.dataId))}else u=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=gT()-c),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}const t=this.texData.get(e),{values:n,shape:r,slice:i,dtype:a,complexTensorInfos:s,isPacked:o}=t;if(null!=i){let t;t=o?new x4(r,b4):new f4(r,b4);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:a}],a),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if(NE().getBool("DEBUG")&&!NE().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===NE().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,c,u=null;if("complex64"!==a&&NE().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(e);const t=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(t.texture.texture,...X2(r))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);c=GO(e[0],e[1])}else if(null==u)c=this.getValuesFromTexture(e);else{const e=YC(r);c=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const e=this.gpgpu.gl;Z2(e,()=>e.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,c),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(e=>e(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&yB().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.texData.get(e),{values:r,shape:i,slice:a,dtype:s,isPacked:o,texture:l}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=a){let n;n=o?new x4(i,b4):new f4(i,b4);const r=this.runWebGLProgram(n,[{dataId:e,shape:i,dtype:s}],s),a=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),a}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),u=yB().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:u},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map(e=>yT(e));return kM(e.shape,e.dtype,n)}catch(dS){throw new Error("Failed to decode encoded string bytes into utf-8")}return kM(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!$2(n)){if(NE().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),i=YC(t);if(NE().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),a=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...X2(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),a}const a=NE().getBool("WEBGL_PACK")&&!0===r,s=a?A3(t):t,o=a?new J3(s):new Y3(s),l=this.runWebGLProgram(o,[{shape:s,dtype:n,dataId:e}],"float32"),c=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const i=bT(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),a=bT(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(i);s.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),s.getExtraProfileInfo=()=>e.map((e,t)=>({name:a[t],ms:e})).map(e=>"".concat(e.name,": ").concat(e.ms)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:gT(),endMs:null}}endTimer(e){return NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=gT(),e)}async getQueryTime(e){if(NE().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:i,isPacked:a,slice:s}=this.texData.get(e),o=s&&s.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,a)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C4;return NE().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&YC(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){QI("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return _4(e.shape,t)}packedUnaryOp(e,t,n){const r=new x4(e.shape,t),i=this.compileAndRun(r,[e],n);return yB().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=G5(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(NE().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,m4,e.dtype);const t=new f4(e.shape,m4),n=this.compileAndRun(t,[e]);return yB().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&cE(n[0])){const i=n.map(e=>mT(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return yB().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new w4(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new c4(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[h3(e.shape),...d3(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[h3(t),...d3(t)],a=new u4(i,n),s=[n],o=this.runWebGLProgram(a,[r],e.dtype,s,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:i,dtype:a}=n;if(null!=t){qC(YC(i)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const s=A3(i);let o;o=r?new X3(s):new K3(s);const l=[null!=t?t:X2(s)];return{dtype:a,shape:i,dataId:this.runWebGLProgram(o,[{shape:s,dtype:a,dataId:e}],a,l,!0,t).dataId}}runWebGLProgram(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;const s=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(s.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===G2.DENSE){const t=null!=a?a:X2(e.outputShape);o.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===YC(s.shape))return o.values=aE(s.dtype,0),s;const l=[],c=t.map(t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&YC(t.shape)<=NE().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),l.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!f3(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),l.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(s.dataId);const u={shape:s.shape,texData:o,isUniform:!1},h=function(e,t,n){let r="";t.concat(n).forEach(t=>{const i=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const a=t.texData.texShape,{useSqueezeShape:s,uniformShape:o,keptDims:l}=z3(e.packedInputs,t.shape,a);let c="",u="",h="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];c="".concat(e[0]>1,"_").concat(e[1]>1)}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=pE(o);h="".concat(e[0]===a[1],"_").concat(e[e.length-1]===a[1])}}else u="".concat(o[0]>1,"_").concat(o[1]>1);const d=t.shape.length,A=2===o.length&&JC(t.shape,a),p=1===YC(t.shape),f=eF(t.shape,n.shape),g=!e.packedInputs&&d===n.shape.length&&JC(a,n.texData.texShape),m=e.packedInputs||o.length>2?"":"".concat(a[0]>1,"_").concat(a[1]>1);r+="".concat(d,"_").concat(g,"_").concat(s?l:"","_").concat(o.length,"_").concat(p,"_").concat(f,"_").concat(A,"_").concat(c,"_").concat(u,"_").concat(h,"_").concat(m,"_").concat(i)}else{const e=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(e,"_").concat(i)}});const i=e.userCode;let a=e.constructor.name;return a+="_"+r+"_"+i+"".concat(NE().getNumber("WEBGL_VERSION")),a}(e,c,u),d=this.getAndSaveBinary(h,()=>V3(this.gpgpu,e,c,u)),A=null!=this.activeTimers;let p;A&&(p=this.startTimer()),NE().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,i){t.program.enableShapeUniforms||(W3(t.inShapeInfos,n),W3([t.outShapeInfo],[r]));const a=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a.texture,s[0],s[1]):e.setOutputMatrixTexture(a.texture,s[0],s[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===NE().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<n.length;++l){const r=n[l],{uniform:i,offset:a,shape:s,texShape:o}=t.variablesLocations[l];if(s){const{uniformShape:n}=z3(t.program.packedInputs,r.shape,r.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(s,new Int32Array(n));break;case 2:e.gl.uniform2iv(s,new Int32Array(n));break;case 3:e.gl.uniform3iv(s,new Int32Array(n));break;case 4:e.gl.uniform4iv(s,new Int32Array(n))}}if(o&&e.gl.uniform2i(o,r.texData.texShape[0],r.texData.texShape[1]),null!=i)if(r.isUniform)if(YC(r.shape)<2)e.gl.uniform1f(i,r.uniformValues[0]);else{let t=r.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(i,t)}else null!=r.texData.slice&&null!=a&&e.gl.uniform1i(a,r.texData.slice.flatOffset),e.setInputMatrixTexture(r.texData.texture.texture,i,l)}const o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=pE(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i)for(let l=0;l<t.program.customUniforms.length;++l){const n=t.program.customUniforms[l],r=t.customUniformLocations[l],a=i[l];if("float"===n.type)e.gl.uniform1fv(r,a);else if("vec2"===n.type)e.gl.uniform2fv(r,a);else if("vec3"===n.type)e.gl.uniform3fv(r,a);else if("vec4"===n.type)e.gl.uniform4fv(r,a);else if("int"===n.type)e.gl.uniform1iv(r,a);else if("ivec2"===n.type)e.gl.uniform2iv(r,a);else if("ivec3"===n.type)e.gl.uniform3iv(r,a);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(r,a)}}e.executeProgram()}(this.gpgpu,d,c,u,r),l.forEach(e=>this.disposeIntermediateTensorInfo(e)),A&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const f=NE().getNumber("WEBGL_FLUSH_THRESHOLD");if(f>0){const e=gT();e-this.lastGlFlushTime>f&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!NE().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===i){const e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;return this.runWebGLProgram(e,t,n,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!NE().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=bB(()=>{if(!NE().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=NE().getBool("DEBUG");NE().set("DEBUG",!1);const t=this.abs(jM(1e-8)).dataSync()[0];if(NE().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:i,texture:a,usage:s,isPacked:o}=t;if(null!=a)return;const l=null!=this.activeTimers;let c;l&&(c=gT());let u=t.texShape;if(null==u&&(u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=NE().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=NE().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&NE().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((t,n)=>n>=e.length-2?GC(e[n]):e[n]),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=iE(e);e=t.newShape}let i=YC(e),a=null;e.length<=1&&i<=n?a=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?a=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?a=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?a=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?a=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(a=[e[0],e[1]*e[2]*e[3]]);const s=null!=a&&Math.max(...a)>r&&Math.min(...a)<=(t?2:1)&&Math.min(...a)>0;if(null==a||s)if(t){const t=h3(e);let n=2,r=2;e.length&&([n,r]=d3(e)),i=t*(n/2)*(r/2),a=$C(i).map(e=>2*e)}else a=$C(i);return a}(n,o),t.texShape=u),null!=i){const e=A3(n);let a,s=u[1],h=u[0];const d=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!o&&d||([s,h]=Y2(u[0],u[1])),a=o?new e5(e,d):new $3(e,d);const A=d?[h,s]:u,p=this.makeTensorInfo(A,r),f=this.texData.get(p.dataId);f.usage=d?W2.PIXELS:W2.UPLOAD,f.texShape=A,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),s,h,i);const g=[[h,s]],m=!0,y=this.runWebGLProgram(a,[p],r,g,m),v=this.texData.get(y.dataId);t.texShape=v.texShape,t.isPacked=v.isPacked,t.usage=v.usage,NE().get("ENGINE_COMPILE_ONLY")?this.disposeData(y.dataId):(t.texture=v.texture,t.values=null,this.texData.delete(y.dataId)),this.disposeIntermediateTensorInfo(p),l&&(this.uploadWaitMs+=gT()-c)}else{const e=this.acquireTexture(u,s,r,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*lE(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(SS){throw SS}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await bO(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw n3(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:i,outShapeLocation:a,outShapeStridesLocation:s,outTexShapeLocation:o}=G3(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=a,e.outShapeStridesLocation=s,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:a,channels:s}=e,o=yB().backend;if(!o.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=o.writeTexture(r,t,n,i,a,s);return yB().makeTensorFromDataId(l,t,n,o)}}E4.nextDataId=0;iB()&&SB("webgl",()=>new E4,2);const N4="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class k4{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=nF(t,n),this.enableShapeUniforms=q3(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const I4="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class T4{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=nF(t,n);const i=this.outputShape.length;this.enableShapeUniforms=q3(i);let a="";if(r)if(0===i||1===YC(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=j3(i);if(a="\n          ".concat(e," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?a+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":a+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=l4("coords",i);this.enableShapeUniforms?a+="\n            bool nextRowOutOfBounds =\n              (".concat(e[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(e[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):a+="\n            bool nextRowOutOfBounds =\n              (".concat(e[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")}}function B4(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const M4={kernelName:qN,backendName:"webgl",kernelFunc:B4};function F4(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(a.dataId),o=B4({inputs:{x:r},backend:n}),l=B4({inputs:{x:i},backend:n});return s.complexTensorInfos={real:o,imag:l},a}const R4={kernelName:iN,backendName:"webgl",kernelFunc:F4},L4="return (a < 0.) ? b * a : a;",P4="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const U4={kernelName:$N,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r,s=n.makeTensorInfo([],"float32",pT(a,"float32")),o=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new T4(P4,i.shape,s.shape):new k4(L4,i.shape,s.shape),l=n.runWebGLProgram(o,[i,s],"float32");return n.disposeIntermediateTensorInfo(s),l}},D4="return (a < 0.) ? b * a : a;",O4="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const j4={kernelName:Rk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,a=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new T4(O4,r.shape,i.shape):new k4(D4,r.shape,i.shape);return n.runWebGLProgram(a,[r,i],"float32")}},z4="if (isnan(x)) return x;";function H4(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:r,dtype:i}=e;return e=>{let{inputs:a,backend:s}=e;const{x:o}=a,l=s,c=i||o.dtype;if(l.shouldExecuteOnCPU([o])&&null!=r){const e=l.texData.get(o.dataId),t=r(e.values,c);return l.makeTensorInfo(o.shape,c,t)}let u;return u=NE().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new x4(o.shape,n):new f4(o.shape,t),l.runWebGLProgram(u,[o],c)}}function Q4(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:r=!1,supportsComplex:i=!1,cpuKernelImpl:a,dtype:s}=e;return e=>{let{inputs:o,backend:l}=e;const{a:c,b:u}=o,h=l;if(i&&"complex64"===c.dtype){const e=h.texData.get(c.dataId),n=h.texData.get(u.dataId),[r,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(e=>{const[n,r]=e,i={dataId:n.dataId,dtype:n.dtype,shape:c.shape},a={dataId:r.dataId,dtype:r.dtype,shape:u.shape},s=new k4(t,c.shape,u.shape);return h.runWebGLProgram(s,[i,a],HT(n.dtype,r.dtype))}),a=F4({inputs:{real:r,imag:i},backend:h});return h.disposeIntermediateTensorInfo(r),h.disposeIntermediateTensorInfo(i),a}const d=s||HT(c.dtype,u.dtype);if(("string"===c.dtype||"string"===u.dtype||h.shouldExecuteOnCPU([c,u]))&&null!=a){const e=h.texData.get(c.dataId).values,t=h.texData.get(u.dataId).values,n="string"===c.dtype?Cj(e):e,r="string"===c.dtype?Cj(t):t,[i,s]=a(c.shape,u.shape,n,r,d),o=h.makeTensorInfo(s,d);return h.texData.get(o.dataId).values=i,o}let A;return A=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new T4(n,c.shape,u.shape,r):new k4(t,c.shape,u.shape),h.runWebGLProgram(A,[c,u],d)}}function V4(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":y4;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":v4;if("prelu"===e)return t?O4:D4;if("leakyrelu"===e)return t?P4:L4;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class G4{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=q3(this.outputShape.length);const c=r?e[1]:e[2],u=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",A=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let f="",g="";s&&(f=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):l?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");const m=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let y="rc.x",v="rc.x";e[0]<t[0]?y="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(v="imod(rc.x, ".concat(t[0],")")),this.userCode="\n      ".concat(f,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(y,";\n        int batchB = ").concat(v,";\n        for (int i = 0; i < ").concat(u,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(A[0]," * ").concat(p[0],");\n          result += (").concat(A[1]," * ").concat(p[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(m,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")}}const W4="return areal * breal - aimag * bimag;",q4="return areal * bimag + aimag * breal;";class K4{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=nF(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const X4="return a * b;";function Y4(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,a=HT(r.dtype,i.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),a=new K4(W4,r.shape,i.shape),s=new K4(q4,r.shape,i.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(a,o,"float32"),c=n.runWebGLProgram(s,o,"float32"),u=F4({inputs:{real:l,imag:c},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}if(n.shouldExecuteOnCPU([r,i])){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),[s,o]=R5(r.shape,i.shape,e.values,t.values,a),l=n.makeTensorInfo(o,a);return n.texData.get(l.dataId).values=s,l}let s;return s=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new T4(X4,r.shape,i.shape):new k4(X4,r.shape,i.shape),n.runWebGLProgram(s,[r,i],a)}const J4={kernelName:_k,backendName:"webgl",kernelFunc:Y4};function Z4(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,s=n,o=YC(i.shape),l=nE(a,o),c=YC(l);qC(o===c,()=>"The new shape (".concat(l,") has ").concat(c," elements and the old ")+"shape (".concat(i.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements.");const u=s.texData.get(i.dataId);return!u.isPacked||f3(i.shape,l)||null!==u.texture&&f3(u.shape,l)?(s.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):function(e,t,n){const r=[h3(e.shape),...d3(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},a=[h3(t),...d3(t)],s=new u4(a,r),o=[r],l=n.runWebGLProgram(s,[i],e.dtype,o,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}(i,l,s)}const $4={kernelName:Qk,backendName:"webgl",kernelFunc:Z4};class e6{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];const s=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=t){const e=1/t;l="sumValue += dot(values * ".concat(ZC(e)?e.toPrecision(2):e,", ones);")}let c="";i%n>0&&(c="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(c,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===o,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===o,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class t6{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];let s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");let l="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");const c=4*Math.floor(n/4),u=n%4;let h="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(o,"(values, minMaxValue);\n        if (").concat("min"===t," || ").concat("max"===t,") {\n          minMaxValue = ").concat(o,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let A="";i%n>0&&(A="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(A,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(c,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(c,";\n        if (").concat(1===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(l,");\n      }\n    ")}}function n6(e,t,n,r){const i=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=IO(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let a=e;for(let s=0;s<i.length;s++){const{inSize:o,windowSize:l,outSize:c}=i[s];let u,h;u="mean"===n?0===s?new e6({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},o):new e6({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c}):new t6({windowSize:l,inSize:o,batchSize:e.shape[0],outSize:c},n),h=a,a=r.runWebGLProgram(u,[a],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return a}class r6{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;const r=j3(this.rank),i=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(i,"));\n    }\n    ")}}class i6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[t[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const r=j3(this.rank),i=o4("rc",this.rank),a=new Array(this.rank);for(let c=0;c<t.length;c++)a[t[c]]=i[c];const s="vec2(".concat(a.slice(-2).join(),")"),o="++".concat(i[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(a.join(),"), ").concat(s,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(l,";\n      if(").concat(o,") {\n        result[1] = ").concat(l,";\n      }\n      --").concat(i[this.rank-1],";\n      if(++").concat(i[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(l,";\n        if(").concat(o,") {\n          result[3] = ").concat(l,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function a6(e,t,n){const r=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new i6(e.shape,t):new r6(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function s6(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;return function(e,t,n,r){const i=t,a=e.shape.length,s=rE(i,e.shape);let o=s;const l=SL(o,a),c=null!=l;let u=e;c&&(u=a6(e,l,r),o=EL(o.length,a)),_L("sum",o,a);const[h,d]=xL(u.shape,o);let A=h;n&&(A=wL(h,s));const p=YC(d),f=Z4({inputs:{x:u},attrs:{shape:[YC(e.shape)/p,p]},backend:r}),g=n6(f,QT(e.dtype),"sum",r),m=Z4({inputs:{x:g},attrs:{shape:A},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(g),c&&r.disposeIntermediateTensorInfo(u),m}(i,a,s,n)}const o6={kernelName:uI,backendName:"webgl",kernelFunc:s6};function l6(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:a}=r,s=n,o=i.shape.length,l=new Array(o);for(let u=0;u<l.length;u++)l[u]=i.shape[a[u]];let c;if(s.shouldExecuteOnCPU([i])){const e=s.texData.get(i.dataId).values,t=a4(e,i.shape,i.dtype,a,l);c=s.makeTensorInfo(l,i.dtype);s.texData.get(c.dataId).values=t}else c=a6(i,a,s);return c}const c6={kernelName:MI,backendName:"webgl",kernelFunc:l6};function u6(e){let{a:t,b:n,transposeA:r,transposeB:i,backend:a,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}=e;const u=t.shape.length,h=n.shape.length,d=r?t.shape[u-2]:t.shape[u-1],A=i?n.shape[h-1]:n.shape[h-2],p=r?t.shape[u-1]:t.shape[u-2],f=i?n.shape[h-2]:n.shape[h-1],g=t.shape.slice(0,-2),m=n.shape.slice(0,-2),y=YC(g),v=YC(m),b=nF(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([p,f]);qC(d===A,()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(A,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(i," must match."));const x=r?[y,d,p]:[y,p,d],w=i?[v,f,A]:[v,A,f],_=Z4({inputs:{x:t},backend:a,attrs:{shape:x}}),S=Z4({inputs:{x:n},backend:a,attrs:{shape:w}}),C=[_,S],E=Math.max(y,v),N=r?_.shape[1]:_.shape[2],k=null!=s,I=null!=o,T="leakyrelu"===c,B=null!=c?V4(c,!0):null;let M;if((1===p||1===f)&&N>1e3&&!1===(k||I||T||null!=B)){let e=_,t=S;r&&(e=l6({inputs:{x:_},backend:a,attrs:{perm:[0,2,1]}}),C.push(e)),i&&(t=l6({inputs:{x:S},backend:a,attrs:{perm:[0,2,1]}}),C.push(t));const n=1===f;let s=e;1!==f&&(s=Z4({inputs:{x:e},backend:a,attrs:{shape:[E,N,1]}}),C.push(s));const o=1===f?2:1;let l=t;n&&(l=Z4({inputs:{x:t},backend:a,attrs:{shape:[E,1,N]}}),C.push(l));const c=Y4({inputs:{a:s,b:l},backend:a});M=s6({inputs:{x:c},backend:a,attrs:{axis:o,keepDims:!0}}),C.push(c)}else{const e=HT(t.dtype,n.dtype),c=new G4(x,w,[E,p,f],r,i,k,B,I,T),u=[_,S];if(null!=s&&u.push(s),I&&u.push(o),T){const e=a.makeTensorInfo([],"float32",pT(l,"float32"));u.push(e),C.push(e)}M=a.runWebGLProgram(c,u,e)}const F=Z4({inputs:{x:M},backend:a,attrs:{shape:b}});C.push(M);for(const R of C)a.disposeIntermediateTensorInfo(R);return F}const h6={kernelName:jI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:s,preluActivationWeights:o}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=r;return u6({a:i,b:a,transposeA:l,transposeB:c,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:h,activation:u})}},d6="return abs(x);";const A6={kernelName:ME,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=G5(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let i;return i=NE().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new x4(r.shape,d6):new f4(r.shape,d6),n.runWebGLProgram(i,[r],r.dtype)}},p6=H4({opSnippet:g4+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),f6={kernelName:FE,backendName:"webgl",kernelFunc:p6},g6=H4({opSnippet:g4+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),m6={kernelName:RE,backendName:"webgl",kernelFunc:g6},y6="return a + b;",v6=Q4({opSnippet:y6,packedOpSnippet:y6,supportsComplex:!0,cpuKernelImpl:d5}),b6={kernelName:LE,backendName:"webgl",kernelFunc:v6};class x6{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}class w6{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>"T".concat(t));const n=[];this.variableNames.forEach(e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))});const r=this.variableNames.map(e=>"v".concat(e)).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}const _6={kernelName:PE,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,i=n;if(1===i.length)return B4({inputs:{x:i[0]},backend:r});if(i.length>NE().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(i.length/2),n=e({inputs:i.slice(0,t),backend:r}),a=e({inputs:i.slice(t),backend:r});return e({inputs:[n,a],backend:r})}const a=i.map(e=>e.dtype).reduce((e,t)=>HT(e,t)),s=i.map(e=>e.shape),o=NE().getBool("WEBGL_PACK")?new w6(i[0].shape,s):new x6(i[0].shape,s);return r.runWebGLProgram(o,i,a)}};const S6={kernelName:UE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,l=rE(a,i.shape);let c=l;const u=SL(c,o);let h=i;null!=u&&(h=l6({inputs:{x:i},backend:n,attrs:{perm:u}}),c=EL(c.length,o)),_L("all",c,o);const[d,A]=xL(h.shape,c),p=Z4({inputs:{x:h},backend:n,attrs:{shape:[-1,YC(A)]}}),f=n6(p,p.dtype,"all",n);let g;if(s){g=Z4({inputs:{x:f},backend:n,attrs:{shape:wL(d,l)}})}else g=Z4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),g}};const C6={kernelName:DE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,l=rE(a,i.shape);let c=l;const u=SL(c,o);let h=i;null!=u&&(h=l6({inputs:{x:i},backend:n,attrs:{perm:u}}),c=EL(c.length,o)),_L("any",c,o);const[d,A]=xL(h.shape,c),p=Z4({inputs:{x:h},backend:n,attrs:{shape:[-1,YC(A)]}}),f=n6(p,p.dtype,"any",n);let g;if(s){g=Z4({inputs:{x:f},backend:n,attrs:{shape:wL(d,l)}})}else g=Z4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),g}};class E6{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:a}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];const s="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(o,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class N6{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,qC(e.length>2,()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2."));const i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,o=s.length,l=j3(o),c=l4("coords",o);let u,h;if(1===a){h=o+1;const e=j3(h);u="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(c.join(),", 0);\n        ++").concat(c[o-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(c.join(),", 0);\n        --").concat(c[o-2],";")}else h=o,u="\n        ".concat(l," sourceLocR = coords;\n        ++").concat(c[o-1],";\n        ").concat(l," sourceLocG = coords;\n        ++").concat(c[o-2],";\n        ").concat(l," sourceLocA = coords;\n        --").concat(c[o-1],";\n        ").concat(l," sourceLocB = coords;\n        --").concat(c[o-2],";");const d=["x","y","z","w","u","v"].slice(0,h),A="."+d[h-1],p=d.map(e=>"int "+e),f=l4("sourceLocR",h-1).concat("inIdx.r"),g=l4("sourceLocG",h-1).concat("inIdx.g"),m=l4("sourceLocB",h-1).concat("inIdx.b"),y=l4("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",b=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(f.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),")));"),x="vec4(\n            getAChannel(".concat(f.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(m.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(y.join(),") : 0.)"),w=r?"":"\n      float getBestIndicesAChannel(".concat(p.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(p.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(w,"\n      void main() {\n        ").concat(l," coords = getOutputCoords();\n        bool hasNextCol = ").concat(c[o-1]," < ").concat(s[o-1]-1,";\n        bool hasNextRow = ").concat(c[o-2]," < ").concat(s[o-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(A,", sourceLocG").concat(A,",\n          sourceLocB").concat(A,", sourceLocA").concat(A,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(b,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(v,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function k6(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=t.shape[0],a=t.shape[1];null!=r&&(i=r.shape[0],a=r.shape[1]);const s=IO(a),o={windowSize:s,inSize:a,batchSize:i,outSize:Math.ceil(a/s)},l=new E6(o,n,null==r),c=[t];null!=r&&c.push(r);const u=e.runWebGLProgram(l,c,"int32");if(1===u.shape[1])return u;const h=k6(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function I6(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=null!=r?r.shape:t.shape,a=IO(i[i.length-1]),s=new N6(i,a,n,null==r),o=null==r?[t]:[t,r],l=e.runWebGLProgram(s,o,"int32");if(l.shape.length===t.shape.length){const r=I6(e,t,n,l);return e.disposeIntermediateTensorInfo(l),r}return l}function T6(e,t,n,r){const i=[n];if(_L("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!NE().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],a=e.texData.get(t.dataId);let s=t;null!==a&&a.isPacked&&(s=e.unpackTensor(t),n.push(s));const[o,l]=xL(s.shape,i),c=YC(l),u=Z4({inputs:{x:s},backend:e,attrs:{shape:[-1,c]}});n.push(u);const h=k6(e,u,r);n.push(h);const d=Z4({inputs:{x:h},backend:e,attrs:{shape:o}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),d}return I6(e,t,r)}const B6={kernelName:OE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let s=rE(a,i.shape);const o=SL(s,i.shape.length);let l=i;const c=[];null!=o&&(l=l6({inputs:{x:i},backend:n,attrs:{perm:o}}),c.push(l),s=EL(s.length,l.shape.length)),_L("argMax",[s[0]],l.shape.length);const u=T6(n,l,s[0],"max");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}};const M6={kernelName:jE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let s=rE(a,i.shape);const o=SL(s,i.shape.length);let l=i;const c=[];null!=o&&(l=l6({inputs:{x:i},backend:n,attrs:{perm:o}}),c.push(l),s=EL(s.length,l.shape.length)),_L("argMin",[s[0]],l.shape.length);const u=T6(n,l,s[0],"min");return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}},F6=H4({opSnippet:g4+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),R6={kernelName:zE,backendName:"webgl",kernelFunc:F6},L6=H4({opSnippet:g4+"return log(x + sqrt(x * x + 1.0));"}),P6={kernelName:HE,backendName:"webgl",kernelFunc:L6},U6=H4({opSnippet:g4+"\n  return atan(x);\n"}),D6={kernelName:QE,backendName:"webgl",kernelFunc:U6},O6=Q4({opSnippet:N4+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+I4+"\n  return result;\n"}),j6={kernelName:GE,backendName:"webgl",kernelFunc:O6},z6=H4({opSnippet:g4+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),H6={kernelName:VE,backendName:"webgl",kernelFunc:z6};class Q6{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,A=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,f="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let m="0.0";if(p||(m="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(o,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(A,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(l,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(c,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?i?f:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let y="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / max(count, 1.0)");const v=4*Math.floor(a/4),b=a%4,x="\n      if (".concat(p,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(A,");\n      const float initializationValue = ").concat(m,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(m,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(l,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(c,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              getValue(batch, xR, xC + 3 * ").concat(c,", d)\n            );\n\n            ").concat(x,"\n          }\n\n          int xC = xCCorner + ").concat(v,";\n          if (").concat(1===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(2===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(3===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(c,", d),\n              getValue(batch, xR, xC + 2 * ").concat(c,", d),\n              initializationValue\n            );\n\n            ").concat(x,"\n          }\n        }\n        setOutput(").concat(y,");\n      }\n    ")}}class V6{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,A=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,g=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const y="avg"===t;let v="0.0";if(y||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(o,", ").concat(l,");\n        const ivec3 pads = ivec3(").concat(f,", ").concat(g,", ").concat(m,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(c,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(A,";\n                wR += ").concat(u,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(p,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(A," * ").concat(p," +\n                      wR * ").concat(p," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / max(count, 1.0)");const x=4*Math.floor(a/4),w=a%4,_="\n      if (".concat(y,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(o,", ").concat(l,");\n      const ivec3 pads = ivec3(").concat(f,", ").concat(g,", ").concat(m,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(c,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(A,";\n            wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(x,";\n            if (").concat(1===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===w,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}const G6={kernelName:WE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;w3(i,"avgPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=r;qC(xR(s,1),()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=hR(i.shape,a,s,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&JC(c.inShape,c.outShape))return B4({inputs:{x:i},backend:n});const u=new Q6(c,"avg",!1);return n.runWebGLProgram(u,[i],"float32")}};const W6={kernelName:KE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:l,dataFormat:c}=r,u=dR(i.shape,a,s,[1,1,1],o,l,c),h=new V6(u,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};class q6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.top,u=l-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(c,", ").concat(u,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n            wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(l,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class K6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,A=u-1-e.padInfo.front,p=h-1-e.padInfo.top,f=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(A,", ").concat(p,", ").concat(f,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n            wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(l,") {\n            float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(c,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const X6={kernelName:XE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=r,h=dR(s.shape,o,l,[1,1,1],c,u),d=new K6(h);return n.runWebGLProgram(d,[i],s.dtype)}};const Y6={kernelName:qE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a;w3([i,a],"avgPoolGrad");const{filterSize:o,strides:l,pad:c}=r,u=hR(s.shape,o,l,1,c),h=new q6(u);return n.runWebGLProgram(h,[i],s.dtype)}};const J6={kernelName:YE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:s,transposeB:o}=r;return u6({a:i,b:a,transposeA:s,transposeB:o,backend:n})}};class Z6{constructor(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],nF(e,t),nF(e,n);let s="0.0";null!=r&&(nF(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="1.0";null!=i&&(nF(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(o,";\n        float inv = scale * inversesqrt(variance + float(").concat(a,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class $6{constructor(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],nF(e,t),nF(e,n);let s="vec4(0.0)";null!=r&&(nF(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=i&&(nF(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(o,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(a,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const e8={kernelName:HN,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:i,mean:a,variance:s,offset:o,scale:l}=t;qC(a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),qC(null==o||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),qC(null==l||a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=r;null==c&&(c=.001);const u=[i,a,s];let h=null;null!=o&&(h=o.shape,u.push(o));let d=null;null!=l&&(d=l.shape,u.push(l));const A=NE().getBool("WEBGL_PACK_NORMALIZATION")?new $6(i.shape,a.shape,s.shape,h,d,c):new Z6(i.shape,a.shape,s.shape,h,d,c);return n.runWebGLProgram(A,u,u[0].dtype)}};class t8{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=j3(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return n8.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let r;const i=e.map((e,t)=>"sourceLoc.".concat(n8[t]," = start[").concat(t,"] + coords.").concat(n8[t],";"));r="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(n,"));\n      }\n    ")}}const n8=["x","y","z","w","u","v"];class r8{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=j3(this.rank),n=l4("coords",this.rank),r=l4("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),a="getChannel(getSource(".concat(r.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(a,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(a,";\n        --").concat(r[this.rank-1],";\n      }\n    "),o=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(a,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(a,";\n        }\n      }\n    "),l=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map((e,t)=>"start[".concat(t,"]")).join(),");"):e.map((e,t)=>"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];")).join("\n");this.userCode="\n      void main() {\n        ".concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(l,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(o,"\n        setOutput(result);\n      }\n    ")}}function i8(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:s}=r,[o,l]=XF(i,a,s);if(LF(i,o,l),0===YC(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const e=n.texData.get(i.dataId),t=W5(e.values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,t)}const{isPacked:c}=n.texData.get(i.dataId),u=qF(i.shape,o,l);if(c||!u){const e=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new r8(l):new t8(l),t=[o];return n.runWebGLProgram(e,[i],i.dtype,t)}return n.uploadToGPU(i.dataId),function(e,t,n,r){const i=r.texData.get(e.dataId),a=r.makeTensorInfo(n,e.dtype),s=r.texData.get(a.dataId);Object.assign(s,i),s.refCount=1,s.shape=n,s.dtype=e.dtype;let o=KF(t,pE(e.shape));i.slice&&(o+=i.slice.flatOffset),s.slice={flatOffset:o,origDataId:i.slice&&i.slice.origDataId||e.dataId};const l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),a}(i,o,l,n)}const a8={kernelName:rI,backendName:"webgl",kernelFunc:i8},s8={kernelName:JE,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:s}=r;qC(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const o=a.reduce((e,t)=>e*t),l=BO(i.shape,a,o),c=MO(l.length,a.length),u=FO(i.shape,a,o),h=RO(s,a.length),d=LO(u,s,a.length),A=[],p=Z4({inputs:{x:i},backend:n,attrs:{shape:l}}),f=l6({inputs:{x:p},backend:n,attrs:{perm:c}}),g=Z4({inputs:{x:f},backend:n,attrs:{shape:u}}),m=i8({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return A.push(p),A.push(f),A.push(g),A.forEach(e=>n.disposeIntermediateTensorInfo(e)),m}};const o8={kernelName:ZE,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s}=r,o=n.readSync(i.dataId),l=n.readSync(a.dataId),c=A5(o,l,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,c)}};const l8={kernelName:$E,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,a=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=NE().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||1===s){const e=n.texData.get(r.dataId).values,t=n.texData.get(i.dataId).values,[a,s]=f5(r.shape,i.shape,e,t,r.dtype),o=n.makeTensorInfo(s,r.dtype);return n.texData.get(o.dataId).values=a,o}let o;return o=a?new T4("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",r.shape,i.shape,!1):new k4("\n  return float(int(a.r) & int(b.r));\n",r.shape,i.shape),n.runWebGLProgram(o,[r,i],r.dtype)}};const c8={kernelName:eN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,a=n.readSync(r.dataId),s=n.readSync(i.dataId),o=nF(Array.from(a),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},u8=Q4({opSnippet:"return float(a != b);",cpuKernelImpl:P5,dtype:"bool"}),h8={kernelName:Ck,backendName:"webgl",kernelFunc:u8};function d8(e){const{inputs:t,backend:n}=e,{input:r}=t;return B4({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const A8={kernelName:jk,backendName:"webgl",kernelFunc:d8};const p8={kernelName:tN,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:i}=t,{x:a}=n,{dtype:s}=i;if("complex64"===s){if("complex64"===a.dtype)return B4({inputs:{x:a},backend:r});const t=fP(a.shape),n=e({inputs:{x:a},backend:r,attrs:{dtype:"float32"}}),i=F4({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===a.dtype){const t=d8({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!oE(a.dtype,s)){const e=B4({inputs:{x:a},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if(r.shouldExecuteOnCPU([a])){const e=r.texData.get(a.dataId).values,[t,n,i]=g5(e,a.shape,a.dtype,s);return r.makeTensorInfo(t,n,i)}if("int32"===s)return function(e,t){const n=new f4(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(a,r);if("bool"===s){const e=r.makeTensorInfo([],"bool",aE("bool",1)),t=u8({inputs:{a:a,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(s))}},f8="return ceil(x);",g8=H4({opSnippet:f8,packedOpSnippet:f8,cpuKernelImpl:m5}),m8={kernelName:nN,backendName:"webgl",kernelFunc:g8};class y8{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class v8{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const b8={kernelName:rN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:a,clipValueMax:s}=r;let o;o=NE().getBool("WEBGL_PACK_CLIP")?new v8(i.shape):new y8(i.shape);const l=[[a],[s]];return n.runWebGLProgram(o,[i],i.dtype,l)}};class x8{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function w8(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const _8={kernelName:aN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),a=new x8(r.shape),s=[w8(r,i.complexTensorInfos.real),w8(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(a,s,s[0].dtype)}};class S8{constructor(e){this.outputShape=[],this.outputShape=wO(e,1),this.variableNames=e.map((e,t)=>"T".concat(t));const t=new Array(e.length-1);t[0]=e[0][1];for(let a=1;a<t.length;a++)t[a]=t[a-1]+e[a][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let a=1;a<t.length;a++){const e=t[a-1];n.push("else if (yC < ".concat(t[a],") ")+"setOutput(getT".concat(a,"(yR, yC-").concat(e,"));"))}const r=t.length,i=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(i,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class C8{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=wO(e,t);const n=this.outputShape,r=n.length,i=j3(r),a=l4("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>"T".concat(t));const o=new Array(e.length-1);o[0]=e[0][t];for(let p=1;p<o.length;p++)o[p]=o[p-1]+e[p][t];const l=s[t],c=s.slice(-2),u=s.join();let h="if (".concat(l," < ").concat(o[0],") {\n        return getChannel(\n            getT0(").concat(u,"), vec2(").concat(c.join(),"));\n        }");for(let p=1;p<o.length;p++){const e=o[p-1];h+="\n        if (".concat(l," < ").concat(o[p],"  && ").concat(l," >= ").concat(o[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(E8(s,l,e),"),\n            vec2(").concat(E8(c,l,e),"));\n        }")}const d=o.length,A=o[o.length-1];h+="\n        return getChannel(\n          getT".concat(d,"(").concat(E8(s,l,A),"),\n          vec2(").concat(E8(c,l,A),"));"),this.userCode="\n      float getValue(".concat(s.map(e=>"int "+e),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(a,"), 0., 0., 0.);\n\n        ").concat(a[r-1]," = ").concat(a[r-1]," + 1;\n        if (").concat(a[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(a,");\n        }\n\n        ").concat(a[r-2]," = ").concat(a[r-2]," + 1;\n        if (").concat(a[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(a,");\n        }\n\n        ").concat(a[r-1]," = ").concat(a[r-1]," - 1;\n        if (").concat(a[r-2]," < ").concat(n[r-2]," &&\n            ").concat(a[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(a,");\n        }\n        setOutput(result);\n      }\n    ")}}function E8(e,t,n){const r=e.indexOf(t),i=e.map((e,t)=>t===r?"".concat(e," - ").concat(n):e);return i.join()}function N8(e){const{inputs:t,backend:n}=e,{input:r}=t;return B4({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const k8={kernelName:XN,backendName:"webgl",kernelFunc:N8};function I8(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map(e=>d8({inputs:{input:e},backend:n})),i=e.map(e=>N8({inputs:{input:e},backend:n})),a=I8(r,t,n),s=I8(i,t,n),o=F4({inputs:{real:a,imag:s},backend:n});return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),i.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),o}let i=n.shouldExecuteOnCPU(e);if("string"===r&&(i=!0),i){const i=e.map(e=>{const r=YC(e.shape.slice(t));return Z4({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})}),a=i.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),s=wO(i.map(e=>e.shape),1),o=1===i[0].shape[0],l=y5(a,s,r,o),c=wO(e.map(e=>e.shape),t),u=n.makeTensorInfo(c,r,l);return i.forEach(e=>n.disposeIntermediateTensorInfo(e)),u}const a=e.filter(e=>YC(e.shape)>0),s=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].shape.length>1;if(1===a.length){const t=s?new f4(e[0].shape,b4):new x4(e[0].shape,b4);return n.runWebGLProgram(t,e,r)}const o=NE().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(a.length>o){const e=[];for(let i=0;i<a.length;i+=o){const r=a.slice(i,i+o);e.push(I8(r,t,n))}const r=I8(e,t,n);for(const t of e)n.disposeIntermediateTensorInfo(t);return r}if(s){const e=new C8(a.map(e=>e.shape),t);return n.runWebGLProgram(e,a,r)}const{tensors2D:l,outShape:c}=function(e,t,n){const r=wO(e.map(e=>e.shape),t),i=e.map(e=>Z4({inputs:{x:e},attrs:{shape:[-1,YC(e.shape.slice(t))]},backend:n}));return{tensors2D:i,outShape:r}}(a,t,n),u=new S8(l.map(e=>e.shape)),h=n.runWebGLProgram(u,l,r);l.forEach(e=>n.disposeIntermediateTensorInfo(e));const d=Z4({inputs:{x:h},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(h),d}function T8(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=rE(i,t[0].shape)[0];xO(t.map(e=>e.shape),a);const s=wO(t.map(e=>e.shape),a);if(0===YC(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter(e=>YC(e.shape)>0);return 1===o.length?B4({inputs:{x:o[0]},backend:n}):I8(o,a,n)}const B8={kernelName:sN,backendName:"webgl",kernelFunc:T8};class M8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,A=4*Math.floor(e.inChannels/4),p=e.inChannels%4,f="channelsLast"===e.dataFormat,g=f?1:2,m=f?2:3,y=f?3:1;let v="",b="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),b="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(o,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(a,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(m,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(A,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(f,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(f,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(A,") *\n                    getW(wR, wC, ").concat(A,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(A,", xR, xC) *\n                    getW(wR, wC, ").concat(A,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(A,", d2),\n                getW(wR, wC, ").concat(A," + 1, d2)\n              );\n\n              if (").concat(f,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(A,"),\n                  getX(batch, xR, xC, ").concat(A," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(A,", xR, xC),\n                  getX(batch, ").concat(A," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(A,", d2),\n                getW(wR, wC, ").concat(A," + 1, d2),\n                getW(wR, wC, ").concat(A," + 2, d2)\n              );\n\n              if (").concat(f,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(A,"),\n                  getX(batch, xR, xC, ").concat(A," + 1),\n                  getX(batch, xR, xC, ").concat(A," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(A,", xR, xC),\n                  getX(batch, ").concat(A," + 1, xR, xC),\n                  getX(batch, ").concat(A," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(x,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")}}class F8{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,A=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(a,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(u,"; wF++) {\n          int xF = xFCorner + wF * ").concat(o,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(l,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(c,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(A,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===p,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(A,") *\n                  getW(wF, wR, wC, ").concat(A,", d2);\n              } else if (").concat(2===p,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(A,"),\n                  getX(batch, xF, xR, xC, ").concat(A," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(A,", d2),\n                  getW(wF, wR, wC, ").concat(A," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===p,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(A,"),\n                  getX(batch, xF, xR, xC, ").concat(A," + 1),\n                  getX(batch, xF, xR, xC, ").concat(A," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(A,", d2),\n                  getW(wF, wR, wC, ").concat(A," + 1, d2),\n                  getW(wF, wR, wC, ").concat(A," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class R8{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=q3(this.outputShape.length);const a=e.padInfo.left,s=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,u=c;let h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let f=0;f<c;f++)h+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");h+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(e.inChannels,"; d1 += 2) {\n       ");for(let f=0;f<c;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let f=0;f<(u+1)/2;f++){const t=2*f;if(h+="\n           xC = xCCorner + ".concat(t*o,";\n           "),1===s){if(t<c&&(a%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n               "),h+=1===o&&t>0?"\n                 xC".concat(t," = vec4(xTexelC").concat(t-2,".zw, xTexelC").concat(t,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(t," = vec4(previous.zw, xTexelC").concat(t,".xy);\n                   } else {\n                     xC").concat(t," = vec4(0.0, 0.0, xTexelC").concat(t,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xC").concat(t," = xTexelC").concat(t,";\n                 "),t+1<c)){const e=a%2===0?GC(o):o;o%2===0&&a%2===1||o%2!==0&&a%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(e,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                     xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(t+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(t+1,"Ready = 1;\n                   }\n                   "),h+=o>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(t+1," = vec4(previous.zw, xTexelC").concat(t+1,".xy);\n                     } else {\n                      xC").concat(t+1," = vec4(0.0, 0.0, xTexelC").concat(t+1,".xy);\n                     }\n                     "):"\n                     xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".xy);\n                     ")):h+=1===e?"\n                     xC".concat(t+1," = xTexelC").concat(t,";\n                     "):"\n                     xCOffset = xC + ".concat(e,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                       xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(t+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(t+1,"Ready = 1;\n                     }\n\n                     xC").concat(t+1," = xTexelC").concat(t+1,";\n                     ")}}else t<c&&(a%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n               "),t+1<c&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(t+1," = vec4(xTexelC").concat(t+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(t,"Ready == 0) {\n                   xTexelC").concat(t," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(t,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(t,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(t+1,"Ready == 0) {\n                   xTexelC").concat(t+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(t+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(t+1,"Ready = 1;\n                 }\n\n                 xC").concat(t," = vec4(\n                   xTexelC").concat(t,".xy, xTexelC").concat(t+1,".xy);\n               "),t+1<c&&(h+="\n                   xC".concat(t+1," = vec4(xTexelC").concat(t,".zw, xTexelC").concat(t+1,".zw);\n                 "))));t<c&&(h+="\n             wTexel = getW(r, ".concat(t,", d1, d2);\n             dotProd += xC").concat(t,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(e.inChannels,") {\n               dotProd += xC").concat(t,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),t+1<c&&(h+="\n               wTexel = getW(r, ".concat(t+1,", d1, d2);\n               dotProd += xC").concat(t+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(e.inChannels,") {\n                 dotProd += xC").concat(t+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";let d="",A="";n&&(d=r?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(n,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(n,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(n,"\n         }"),A="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(d,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(p,"\n         ").concat(A,"\n         setOutput(result);\n       }\n     ")}}class L8{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=q3(this.outputShape.length);const{dataFormat:n}=t,r=S3(),i="channelsLast"===n,a=i?1:2,s=i?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {");let l="";for(let c=0;c<=1;c++)for(let e=0;e<=1;e++)l+="\n          blockIndex = rc.z + ".concat(e,";\n          pos = rc.y + ").concat(c,";\n\n          ").concat(o,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(a,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*c+e,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(l,"\n\n        ").concat(r.output," = result;\n      }\n    ")}}function P8(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function U8(e){let{x:t,filter:n,convInfo:r,backend:i,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}=e;const c=t.shape,u=i.texData.get(t.dataId),h=r.inChannels,d=c[0]*c[1]*c[2],A=r.outChannels,p="channelsLast"===r.dataFormat,f=!1;let g;const m=[];if(null!=s){const e=P8(s.shape,p);null!=e&&(s=Z4({inputs:{x:s},backend:i,attrs:{shape:e}}),m.push(s))}if(null!=a){const e=P8(a.shape,p);null!=e&&(a=Z4({inputs:{x:a},backend:i,attrs:{shape:e}}),m.push(a))}if(!((1===d||1===A)&&h>1e3)&&u.isPacked&&p&&null!=u.texture&&c[2]%2!==0&&JC(u.shape.slice(-3),c.slice(-3))){const e=c[0]*c[1]*(c[2]+1),h={dataId:t.dataId,shape:[1,e,r.inChannels],dtype:t.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,qC(f3(u.shape,h.shape),()=>"packed reshape ".concat(u.shape," to ").concat(h.shape," isn't free"));const A=Z4({inputs:{x:n},backend:i,attrs:{shape:[1,r.inChannels,r.outChannels]}});m.push(A);const p=u6({a:h,b:A,backend:i,transposeA:false,transposeB:f,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:o}),y=i.texData.get(p.dataId);qC(y.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=d,y.shape=r.outShape,g=B4({inputs:{x:p},backend:i}),g.shape=r.outShape,m.push(p)}else{const e=r.outHeight*r.outWidth,c=Z4({inputs:{x:t},backend:i,attrs:{shape:p?[r.batchSize,e,r.inChannels]:[r.batchSize,r.inChannels,e]}}),u=Z4({inputs:{x:n},backend:i,attrs:{shape:[1,r.inChannels,r.outChannels]}}),h=u6({a:p?c:u,b:p?u:c,transposeA:!p,transposeB:f,backend:i,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:o});g=Z4({inputs:{x:h},backend:i,attrs:{shape:r.outShape}}),m.push(c),m.push(u),m.push(h)}for(const y of m)i.disposeIntermediateTensorInfo(y);return g}function D8(e){let{x:t,filter:n,convInfo:r,backend:i,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}=e;const{filterWidth:c,filterHeight:u,inChannels:h,outWidth:d,outHeight:A,dataFormat:p}=r,f="channelsLast"===p,g=c*u*h,m=A*d,y=[r.batchSize,g,m],v=[];if(null!=s){const e=P8(s.shape,f);null!=e&&(s=Z4({inputs:{x:s},backend:i,attrs:{shape:e}}),v.push(s))}if(null!=a){const e=P8(a.shape,f);null!=e&&(a=Z4({inputs:{x:a},backend:i,attrs:{shape:e}}),v.push(a))}const b=Z4({inputs:{x:n},backend:i,attrs:{shape:[1,g,YC(n.shape)/g]}});v.push(b);const x=new L8(y,r),w=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],_=i.runWebGLProgram(x,[t],"float32",w),S=Z4({inputs:{x:_},backend:i,attrs:{shape:y}});v.push(_),v.push(S);const C=null!=a,E=null!=s,N="leakyrelu"===l,k=l?V4(l,!0):null,I=new G4(f?S.shape:b.shape,f?b.shape:S.shape,f?[r.batchSize,m,r.outChannels]:[r.batchSize,r.outChannels,m],!0,!1,C,k,E,N),T=f?[S,b]:[b,S];if(a&&T.push(a),E&&T.push(s),N){const e=i.makeTensorInfo([],"float32",pT(o,"float32"));T.push(e),v.push(e)}const B=i.runWebGLProgram(I,T,"float32"),M=Z4({inputs:{x:B},backend:i,attrs:{shape:r.outShape}});v.push(B);for(const F of v)i.disposeIntermediateTensorInfo(F);return M}const O8={kernelName:oN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dataFormat:l,dilations:c,dimRoundingMode:u}=r,h=_R(l),d=AR(i.shape,a.shape,s,c,o,u,!1,h);let A;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&NE().getBool("WEBGL_EXP_CONV")){const e=new R8(d),t=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];A=n.runWebGLProgram(e,[i,a],"float32",t)}else if(NE().getBool("WEBGL_CONV_IM2COL"))A=D8({x:i,filter:a,convInfo:d,backend:n});else{const e=new M8(d);A=n.runWebGLProgram(e,[i,a],"float32")}else A=U8({x:i,filter:a,convInfo:d,backend:n});const p=Z4({inputs:{x:A},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(A),p}};class j8{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              ").concat(a?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class z8{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=a?1:2,c=a?2:3,u=a?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(u,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(l,"], coords[").concat(c,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class H8{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Q8{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(o,", ").concat(l,", ").concat(c,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const V8={kernelName:lN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,h=_R(l),d=AR(i.shape,u,s,1,o,c,!1,h),A=new j8(d);return n.runWebGLProgram(A,[i,a],"float32")}};class G8{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=q3(this.outputShape.length);const t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(r,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(e.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(e.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}}const W8={kernelName:cN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:s,strides:o,pad:l,dataFormat:c,dimRoundingMode:u}=r,h=_R(c),d=AR(s,a.shape,o,1,l,u,!1,h);if(NE().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===h){const e=[[d.strideHeight,d.strideWidth]],t=new G8(d);return n.runWebGLProgram(t,[i,a],"float32",e)}{const e=new z8(d);return n.runWebGLProgram(e,[i,a],"float32")}}};const q8={kernelName:uN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:l}=r,c=pR(i.shape,a.shape,s,l,o),u=new F8(c);return n.runWebGLProgram(u,[i,a],"float32")}};const K8={kernelName:hN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,filterShape:l}=r,c=pR(i.shape,l,s,1,o),u=new H8(c);return n.runWebGLProgram(u,[i,a],"float32")}};const X8={kernelName:dN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:s,strides:o,inputShape:l}=r,c=pR(l,a.shape,o,1,s),u=new Q8(c);return n.runWebGLProgram(u,[i,a],"float32")}},Y8=H4({opSnippet:z4+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(I4,"\n  return result;\n")}),J8={kernelName:AN,backendName:"webgl",kernelFunc:Y8},Z8=H4({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),$8={kernelName:pN,backendName:"webgl",kernelFunc:Z8};class e7{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,s,o,l]=e,[c]=t,[u,h]=n;this.outputShape=[c,u,h,l];const d="bilinear"===r?1:0,[A,p]=["".concat(s-1,".0"),"".concat(o-1,".0")],[f,g,m]=u>1?["".concat((s-1)/(u-1)),"(y2-y1) * height_ratio","y1*".concat(A," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(A)],[y,v,b]=h>1?["".concat((o-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(p," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(p)];this.userCode="\n      const float height_ratio = float(".concat(f,");\n      const float width_ratio = float(").concat(y,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(a,") {\n          return;\n        }\n\n        float height_scale = ").concat(g,";\n        float width_scale = ").concat(v,";\n\n        float in_y = ").concat(m,";\n        if( in_y < 0.0 || in_y > ").concat(A," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(b,";\n        if( in_x < 0.0 || in_x > ").concat(p," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const t7={kernelName:mN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:s}=t,{cropSize:o,method:l,extrapolationValue:c}=r,u=new e7(i.shape,a.shape,o,l,c);return n.runWebGLProgram(u,[i,a,s],"float32")}};var n7;!function(e){e.Prod="*",e.Sum="+"}(n7||(n7={}));class r7{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,a=this.op===n7.Prod?"1.0":"0.0",s=n?a:"getX(".concat(i7(i,"coords",this.op),")"),o=this.outputShape[this.outputShape.length-1];let l="",c="";n?(l=r?"end != ".concat(o-1):"end != 0",c=r?"end + 1":"end - 1"):(l=r?"end + pow2 < ".concat(o):"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(j3(i)," coords = getOutputCoords();\n        int end = ").concat(a7(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(l,") {\n          int idx = ").concat(c,";\n          ").concat(a7(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(i7(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}}function i7(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function a7(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function s7(e,t,n,r,i,a){const s=t.shape.length,o=SL([r],s);let l=t;null!=o&&(l=l6({inputs:{x:t},backend:n,attrs:{perm:o}}));const c=EL(1,s)[0];if(c!==s-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));const u=l.shape[c];let h=B4({inputs:{x:l},backend:n});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const t=new r7(e,l.shape,!1,a),r=[[d]],i=h;h=n.runWebGLProgram(t,[h],h.dtype,r),n.disposeIntermediateTensorInfo(i)}if(i){const t=new r7(e,l.shape,i,a),r=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){const e=l6({inputs:{x:h},backend:n,attrs:{perm:CL(o)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),e}return h}const o7={kernelName:fN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;return s7(n7.Prod,i,n,a,s,o)}};const l7={kernelName:gN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;return s7(n7.Sum,i,n,a,s,o)}};const c7={kernelName:yN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s,binaryOutput:o}=r;if(1===i.shape.length){const e=n.readSync(i.dataId),t=n.readSync(a.dataId),r=A5(e,t,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,r)}if(2===i.shape.length){const e=n.bufferSync(i),t=n.bufferSync(a),r=p5(e,t,s,o);return n.makeTensorInfo(r.shape,a.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(i.shape.length,"."))}};class u7{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const h7={kernelName:vN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:s}=r,o=i.shape[0],l=("NHWC"===s?i.shape[1]:i.shape[2])*a,c=("NHWC"===s?i.shape[2]:i.shape[3])*a,u=("NHWC"===s?i.shape[3]:i.shape[1])/(a*a),h=new u7("NHWC"===s?[o,l,c,u]:[o,u,l,c],a,s);return n.runWebGLProgram(h,[i],i.dtype)}};class d7{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=q3(this.outputShape.length);const a=e.filterHeight,s=e.filterWidth,o=e.outChannels/e.inChannels;let l="",c="";n&&(l=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),c="result = activation(result);");const u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(l,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(a,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(u,"\n        ").concat(c,"\n        setOutput(result);\n      }\n    ")}}class A7{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=q3(this.outputShape.length);const a=e.outChannels/e.inChannels,s=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,h=u;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let g=0;g<u;g++)d+="\n          vec4 xTexelC".concat(2*g,";\n          int xTexelC").concat(2*g,"Ready;\n          vec4 xTexelC").concat(2*g+1,";\n          int xTexelC").concat(2*g+1,"Ready;\n          vec4 xC").concat(g,";");d+="\n    for (int r = 0; r < ".concat(c,"; r++) {\n      ");for(let g=0;g<u;g++)d+="\n          xTexelC".concat(2*g," = vec4(0.0);\n          xTexelC").concat(2*g,"Ready = 0;\n          xTexelC").concat(2*g+1," = vec4(0.0);\n          xTexelC").concat(2*g+1,"Ready = 0;\n          xC").concat(g," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let g=0;g<(h+1)/2;g++){const e=2*g;if(d+="\n          xC = xCCorner + ".concat(e*l,";\n          "),1===o){if(e<u&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n              "),d+=1===l&&e>0?"\n                xC".concat(e," = vec4(xTexelC").concat(e-2,".zw, xTexelC").concat(e,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(e," = vec4(previous.zw, xTexelC").concat(e,".xy);\n                  } else {\n                    xC").concat(e," = vec4(0.0, 0.0, xTexelC").concat(e,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xC").concat(e," = xTexelC").concat(e,";\n                "),e+1<u)){const t=s%2===0?GC(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(t,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                    xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(e+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(e+1,"Ready = 1;\n                  }\n                  "),d+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(e+1," = vec4(previous.zw, xTexelC").concat(e+1,".xy);\n                    } else {\n                     xC").concat(e+1," = vec4(0.0, 0.0, xTexelC").concat(e+1,".xy);\n                    }\n                    "):"\n                    xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".xy);\n                    ")):d+=1===t?"\n                    xC".concat(e+1," = xTexelC").concat(e,";\n                    "):"\n                    xCOffset = xC + ".concat(t,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                      xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(e+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(e+1,"Ready = 1;\n                    }\n\n                    xC").concat(e+1," = xTexelC").concat(e+1,";\n                    ")}}else e<u&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n              "),e+1<u&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(e+1," = vec4(xTexelC").concat(e+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(e,"Ready == 0) {\n                  xTexelC").concat(e," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(e,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(e,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(e+1,"Ready == 0) {\n                  xTexelC").concat(e+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(e+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(e+1,"Ready = 1;\n                }\n\n                xC").concat(e," = vec4(\n                  xTexelC").concat(e,".xy, xTexelC").concat(e+1,".xy);\n              "),e+1<u&&(d+="\n                  xC".concat(e+1," = vec4(xTexelC").concat(e,".zw, xTexelC").concat(e+1,".zw);\n                "))));e<u&&(d+="\n            wTexel = getW(r, ".concat(e,", d1, q);\n            dotProd += xC").concat(e," * vec4(wTexel.xz, wTexel.xz);\n          "),e+1<u&&(d+="\n              wTexel = getW(r, ".concat(e+1,", d1, q);\n              dotProd += xC").concat(e+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";let A="",p="";n&&(A=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),p="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(A,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(a,";\n        int q = d2 - d1 * ").concat(a,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(f,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const p7={kernelName:bN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:l,dimRoundingMode:c}=r;let u=l;null==u&&(u=[1,1]),qC(xR(s,u),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(u,"'"));const h=AR(i.shape,a.shape,s,u,o,c,!0);let d;d=NE().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new A7(h):new d7(h);const A=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(d,[i,a],"float32",A)}};class f7{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(a," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class g7{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(o,"; dm++) {\n              int d2 = d1 * ").concat(o," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const m7={kernelName:xN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,filterShape:u}=r,h=AR(i.shape,u,s,o,l,c,!0),d=new f7(h);return n.runWebGLProgram(d,[i,a],"float32")}};const y7={kernelName:wN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:s,dilations:o,pad:l,dimRoundingMode:c,inputShape:u}=r,h=AR(u,a.shape,s,o,l,c,!0),d=new g7(h);return n.runWebGLProgram(d,[i,a],"float32")}};class v7{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const b7={kernelName:_N,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],a=YC(r.shape),s=Z4({inputs:{x:r},backend:n,attrs:{shape:[a]}}),o=new v7(a),l=n.runWebGLProgram(o,[s],s.dtype),c=Z4({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(l),c}};class x7{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:i,strideWidth:a,filterHeight:s,filterWidth:o,dilationHeight:l,dilationWidth:c}=e,{top:u,left:h}=r;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(a,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(l,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(o,"; w++) {\n              int wIn = wBeg + w * ").concat(c,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const w7={kernelName:SN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:l}=r,c=uR(i.shape,a.shape,s,o,"NHWC",l);let u;const h=new x7(c);u=n.runWebGLProgram(h,[i,a],"float32");const d=Z4({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),d}};const _7={kernelName:IN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,a=t,{allDims:s,summedDims:o,idDims:l}=rj(i,a.length);aj(s.length,l,a);const{path:c,steps:u}=sj(o,l),h=u.length;let d=null,A=s.length;const p=[];for(let f=0;f<h;++f){for(const e of u[f]){const{permutationIndices:t,expandDims:r}=ij(A,l[e]);let i;oj(t)?i=a[e]:(i=l6({inputs:{x:a[e]},backend:n,attrs:{perm:t}}),p.push(i));const s=i.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);JC(i.shape,s)||(i=Z4({inputs:{x:i},backend:n,attrs:{shape:s}}),p.push(i)),null===d?d=i:(d=Y4({inputs:{a:i,b:d},backend:n}),p.push(d))}f<h-1&&(c[f]>=0&&(d=s6({inputs:{x:d},backend:n,attrs:{axis:c[f]-(s.length-A),keepDims:!1}}),p.push(d)),A--)}for(const f of p)f!==d&&n.disposeIntermediateTensorInfo(f);return d}},S7=H4({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),C7={kernelName:TN,backendName:"webgl",kernelFunc:S7},E7={kernelName:BN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,a=NE().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new T4("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new k4("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(a,[r,i],r.dtype)}},N7=Q4({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:v5}),k7={kernelName:FN,backendName:"webgl",kernelFunc:N7},I7=H4({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(OO,";\n  float a1 = ").concat(jO,";\n  float a2 = ").concat(zO,";\n  float a3 = ").concat(HO,";\n  float a4 = ").concat(QO,";\n  float a5 = ").concat(VO,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),T7={kernelName:MN,backendName:"webgl",kernelFunc:I7},B7=H4({opSnippet:z4+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:b5,dtype:"float32"}),M7={kernelName:RN,backendName:"webgl",kernelFunc:B7};function F7(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:a}=t,s=a.shape.length,o=a.shape.slice();let l=i;return i<0&&(qC(-(s+1)<=i,()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")),l=s+i+1),o.splice(l,0,1),Z4({inputs:{x:a},backend:r,attrs:{shape:o}})}const R7={kernelName:LN,backendName:"webgl",kernelFunc:F7},L7="return exp(x) - 1.0;",P7=H4({opSnippet:L7,packedOpSnippet:L7,cpuKernelImpl:x5}),U7={kernelName:PN,backendName:"webgl",kernelFunc:P7};class D7{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),a=n?"".concat(r,".0"):"1.0";let s;if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));s="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(i,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(s,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(a,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function O7(e,t,n){const r=n.texData.get(e.dataId),i=YC(e.shape),a=e.shape[e.shape.length-1],s=Z4({inputs:{x:e},backend:n,attrs:{shape:[i/a,a]}}),o=s.shape,l=new D7("real",o,t),c=new D7("imag",o,t),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(c,u,"float32"),A=F4({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const p=Z4({inputs:{x:A},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(A),p}const j7={kernelName:UN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return O7(r,!1,n)}};class z7{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function H7(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:a}=n;if(a=a||hE(i),"string"===a){const e=sE(a,YC(r));return e.fill(i),t.makeTensorInfo(r,a,e)}{const e=new z7(r,i),n=[[i]];return t.runWebGLProgram(e,[],a,n)}}const Q7={kernelName:DN,backendName:"webgl",kernelFunc:H7};class V7{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const G7={kernelName:ON,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:r}=t,i=n,a=new V7(r.shape);return i.runWebGLProgram(a,[r],r.dtype)}},W7="return floor(x);",q7=H4({opSnippet:W7,packedOpSnippet:W7,cpuKernelImpl:w5}),K7={kernelName:jN,backendName:"webgl",kernelFunc:q7},X7=Q4({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),Y7={kernelName:zN,backendName:"webgl",kernelFunc:X7};class J7{constructor(e){this.variableNames=["A"];const t=S3(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class Z7{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=S3(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const $7={kernelName:DI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:a}=r,s="undefined"!==typeof HTMLVideoElement&&i instanceof HTMLVideoElement,o="undefined"!==typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,c]=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[c,l],h=[c,l,a];if(o||s){const e=NE().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=e9&&e===t9||(t9=e,e9=document.createElement("canvas").getContext("2d",{willReadFrequently:t9})),e9.canvas.width=l,e9.canvas.height=c,e9.drawImage(i,0,0,l,c),i=e9.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=W2.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const A=NE().getBool("WEBGL_PACK")?new Z7(h):new J7(h),p=n.runWebGLProgram(A,[d],"int32");return n.disposeData(d.dataId),p}};let e9,t9=NE().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const n9={kernelName:zI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:A,leakyreluAlpha:p}=r,f=_R(u),g=AR(i.shape,a.shape,l,h,c,d,!1,f);let m;const y=[],v=null!=s,b=null!=o,x="leakyrelu"===A,w=()=>{const e=[i,a],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){const t=Z4({inputs:{x:e},backend:n,attrs:{shape:[e.shape[0],1,1]}});return y.push(t),t}return e};if(v&&e.push(t(s,u)),b&&e.push(t(o,u)),x){const t=n.makeTensorInfo([],"float32",pT(p,"float32"));e.push(t),y.push(t)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===f&&NE().getBool("WEBGL_EXP_CONV")){const e=A?V4(A,!0):null,t=new R8(g,v,e,b,x),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],i=w();m=n.runWebGLProgram(t,i,"float32",r)}else if(NE().getBool("WEBGL_CONV_IM2COL"))m=D8({x:i,filter:a,convInfo:g,backend:n,bias:s,activation:A,preluActivationWeights:o,leakyreluAlpha:p});else{const e=A?V4(A,!1):null,t=new M8(g,v,e,b,x),r=w();m=n.runWebGLProgram(t,r,"float32")}else m=U8({x:i,filter:a,convInfo:g,backend:n,bias:s,activation:A,preluActivationWeights:o,leakyreluAlpha:p});const _=Z4({inputs:{x:m},backend:n,attrs:{shape:g.outShape}});return y.push(m),y.forEach(e=>n.disposeIntermediateTensorInfo(e)),_}};const r9={kernelName:HI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:A}=r,p=[];let f=u;null==f&&(f=[1,1]),qC(xR(l,f),()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(l," and dilations '").concat(f,"'"));const g=AR(i.shape,a.shape,l,f,c,h,!0),m=NE().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=d?V4(d,m):null,v=[i,a],b=null!=s,x=null!=o,w="leakyrelu"===d;if(b&&v.push(s),x&&v.push(o),w){const e=n.makeTensorInfo([],"float32",pT(A,"float32"));v.push(e),p.push(e)}let _;_=m?new A7(g,b,y,x,w):new d7(g,b,y,x,w);const S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],C=n.runWebGLProgram(_,v,"float32",S);return p.forEach(e=>n.disposeIntermediateTensorInfo(e)),C}};class i9{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=j3(n.length);let a="\n    int index;";for(let s=0;s<this.sliceDim;s++)a+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(a,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}}const a9={kernelName:VN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=i.shape,s=a[a.length-1],o=YC(r.shape),[l,c,u,h]=PO(r,i),d=Z4({inputs:{x:i},backend:n,attrs:{shape:[c,s]}}),A=Z4({inputs:{x:r},backend:n,attrs:{shape:[YC(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const e=n.readSync(i.dataId),t=n.bufferSync(r),a=_5(e,t,r.dtype,c,s,u,h,r.shape,o);return n.makeTensorInfo(l,r.dtype,a.values)}const p=new i9(s,h,[c,u],r.shape),f=n.runWebGLProgram(p,[A,d],A.dtype),g=Z4({inputs:{x:f},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(f),g}};class s9{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=j3(this.rank),r=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("index"):n.push("".concat(t[r]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(e[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(r,"));\n      }\n    ")}}function o9(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:s,batchDims:o}=r,l=rE(s,i.shape)[0];if(NE().get("DEBUG")){const e=n.readSync(a.dataId),t=i.shape[l];for(let n=0;n<e.length;++n){const r=e[n];qC(r<=t-1&&r>=0,()=>"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]"))}}const c=Sj(i,a,l,o),u=YC(a.shape),h=[],d=Z4({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),A=Z4({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});h.push(d),h.push(A);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,a])||"string"===i.dtype){const e=n.bufferSync(A),t=n.bufferSync(d),r=S5(t,e,p);return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const f=new s9(d.shape,p),g=n.runWebGLProgram(f,[d,A],d.dtype);h.push(g);const m=Z4({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),m}const l9={kernelName:QN,backendName:"webgl",kernelFunc:o9},c9=Q4({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:C5,dtype:"bool"}),u9={kernelName:GN,backendName:"webgl",kernelFunc:c9},h9=Q4({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:E5}),d9={kernelName:WN,backendName:"webgl",kernelFunc:h9};const A9={kernelName:KN,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return O7(r,!0,n)}},p9=H4({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),f9={kernelName:YN,backendName:"webgl",kernelFunc:p9},g9=H4({opSnippet:"return float(isinf(x));",dtype:"bool"}),m9={kernelName:JN,backendName:"webgl",kernelFunc:g9},y9=H4({opSnippet:"return float(isnan(x));",dtype:"bool"}),v9={kernelName:ZN,backendName:"webgl",kernelFunc:y9},b9=Q4({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:N5,dtype:"bool"}),x9={kernelName:ek,backendName:"webgl",kernelFunc:b9},w9=Q4({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:k5,dtype:"bool"}),_9={kernelName:tk,backendName:"webgl",kernelFunc:w9};const S9={kernelName:nk,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,s=I5(r,i,a);return t.makeTensorInfo([s.length],"float32",s)}},C9=H4({opSnippet:z4+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:T5}),E9={kernelName:rk,backendName:"webgl",kernelFunc:C9},N9=H4({opSnippet:z4+"\n  return log(1.0 + x);\n"}),k9={kernelName:ik,backendName:"webgl",kernelFunc:N9},I9=Q4({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),T9={kernelName:ak,backendName:"webgl",kernelFunc:I9},B9=H4({opSnippet:"return float(!(x >= 1.0));"}),M9={kernelName:sk,backendName:"webgl",kernelFunc:B9},F9=Q4({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),R9={kernelName:ok,backendName:"webgl",kernelFunc:F9};class L9{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];const a=t,s=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(r,") * sum");o=.5===i?"inversesqrt(".concat(l,")"):1===i?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(a,"; j <= ").concat(a,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")}}class P9{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,s=e[3]-1;let o;this.outputShape=e;const l="float(".concat(n,") + float(").concat(r,") * sum");o=.5===i?"inversesqrt(".concat(l,")"):1===i?"1.0/(".concat(l,")"):"exp(log(".concat(l,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(a,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(a,"; j <= ").concat(a,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")}}const U9={kernelName:lk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:s,alpha:o,beta:l}=r,c=NE().getBool("WEBGL_PACK_NORMALIZATION")?new P9(i.shape,a,s,o,l):new L9(i.shape,a,s,o,l);return n.runWebGLProgram(c,[i],i.dtype)}};class D9{constructor(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const O9={kernelName:ck,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:s}=t,{depthRadius:o,bias:l,alpha:c,beta:u}=r,h=new D9(i.shape,o,l,c,u);return n.runWebGLProgram(h,[i,a,s],i.dtype)}};function j9(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:s}=r,o=i.shape.length,l=rE(a,i.shape);let c=l;const u=SL(c,o),h=null!=u,d=n.shouldExecuteOnCPU([i]);let A=i;if(h){if(d){const e=n.texData.get(A.dataId).values,t=new Array(o);for(let n=0;n<t.length;n++)t[n]=i.shape[u[n]];const r=a4(e,i.shape,i.dtype,u,t);A=n.makeTensorInfo(t,i.dtype);n.texData.get(A.dataId).values=r}else A=a6(i,u,n);c=EL(c.length,o)}_L("max",c,o);const[p,f]=xL(A.shape,c);let g,m=p;if(s&&(m=wL(p,l)),d){const e=n.texData.get(A.dataId).values,t=B5(e,YC(f),m,i.dtype);g=n.makeTensorInfo(m,i.dtype);n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const i=YC(t),a=Z4({inputs:{x:e},attrs:{shape:[YC(e.shape)/i,i]},backend:r}),s=n6(a,e.dtype,"max",r),o=Z4({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}(A,f,m,n);return h&&n.disposeIntermediateTensorInfo(A),g}const z9={kernelName:uk,backendName:"webgl",kernelFunc:j9},H9=Q4({opSnippet:N4+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+I4+"\n  return result;\n",cpuKernelImpl:M5}),Q9={kernelName:hk,backendName:"webgl",kernelFunc:H9};const V9={kernelName:dk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;w3(i,"maxPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=r;qC(xR(s,1),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'"));const c=hR(i.shape,a,s,1,o,l);if(1===c.filterWidth&&1===c.filterHeight&&JC(c.inShape,c.outShape))return B4({inputs:{x:i},backend:n});const u=new Q6(c,"max",!1);return n.runWebGLProgram(u,[i],i.dtype)}};const G9={kernelName:pk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dataFormat:l,dimRoundingMode:c}=r,u=dR(i.shape,a,s,[1,1,1],o,c,l),h=new V6(u,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};class W9{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,s=i-1-e.padInfo.top,o=a-1-e.padInfo.left,l=i*a-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(a,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(l," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(a," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class q9{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=c-1-e.padInfo.left,A=o*l*c-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(o,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(l,";\n              wR += ").concat(a,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(c,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(A," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(l," * ").concat(c," +\n                  wR * ").concat(c," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const K9={kernelName:fk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a,{filterSize:o,strides:l,pad:c,dimRoundingMode:u}=r,h=dR(s.shape,o,l,[1,1,1],c,u),d=new V6(h,"max",!0),A=n.runWebGLProgram(d,[s],s.dtype),p=new q9(h),f=n.runWebGLProgram(p,[i,A],s.dtype);return n.disposeIntermediateTensorInfo(A),f}};const X9={kernelName:Ak,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:s}=t,o=a;w3([a,s],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=r,d=hR(o.shape,l,c,1,u,h),A=new Q6(d,"max",!0),p=n.runWebGLProgram(A,[o],o.dtype),f=new W9(d),g=n.runWebGLProgram(f,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}};const Y9={kernelName:gk,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:i}=t,{filterSize:a,strides:s,pad:o,includeBatchInIndex:l}=n,c=r;qC(4===i.shape.length,()=>"Error in maxPool: input must be rank 4 but got rank ".concat(i.shape.length,"."));const u=[1,1];qC(xR(s,u),()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(u,"'"));const h=hR(i.shape,a,s,u,o),[d,A]=function(e,t,n,r){let i=new Q6(n,"max",!1);const a=r.runWebGLProgram(i,[e],"float32");return i=new Q6(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(i,l,h,c);return[d,A]}};const J9={kernelName:mk,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:i}=t,{keepDims:a,axis:s}=n,o=r,l=i.shape.length,c=rE(s,i.shape);let u=c;const h=SL(u,l),d=null!=h,A=o.shouldExecuteOnCPU([i]),p=[];let f=i;if(d){if(A){const e=o.texData.get(f.dataId).values,t=new Array(l);for(let r=0;r<t.length;r++)t[r]=i.shape[h[r]];const n=a4(e,i.shape,i.dtype,h,t);f=o.makeTensorInfo(t,i.dtype);o.texData.get(f.dataId).values=n}else f=a6(i,h,o);p.push(f),u=EL(u.length,l)}_L("sum",u,l);const[g,m]=xL(f.shape,u);let y=g;a&&(y=wL(g,c));const v=function(e,t,n,r){const i=YC(t),a=Z4({inputs:{x:e},attrs:{shape:[YC(e.shape)/i,i]},backend:r}),s=n6(a,"float32","mean",r),o=Z4({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}(f,m,y,o);for(const b of p)o.disposeIntermediateTensorInfo(b);return v}};const Z9={kernelName:yk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,l=rE(a,i.shape);let c=l;const u=SL(c,o);let h=i;null!=u&&(h=l6({inputs:{x:i},backend:n,attrs:{perm:u}}),c=EL(c.length,i.shape.length)),_L("min",c,o);const[d,A]=xL(h.shape,c),p=Z4({inputs:{x:h},backend:n,attrs:{shape:[-1,YC(A)]}}),f=n6(p,p.dtype,"min",n);let g;if(s){g=Z4({inputs:{x:f},backend:n,attrs:{shape:wL(d,l)}})}else g=Z4({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),null!=u&&n.disposeIntermediateTensorInfo(h),g}},$9=Q4({opSnippet:N4+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+I4+"\n  return result;\n",cpuKernelImpl:F5}),eee={kernelName:vk,backendName:"webgl",kernelFunc:$9};class tee{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=j3(r),a=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(i," start = ").concat(i,"(").concat(a,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(l,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(l,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(o,"));\n      }\n    "):"\n        int start = ".concat(a,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(l,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(l,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class nee{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=j3(r),a=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=l4("rc",r),l=l4("source",r),c="".concat(o[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(l.slice(-2).join(),")"),h="reflect"===n?0:1;let d="";if(1===r){const e="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[r-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ")}else{const e="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        ").concat(o[r-1]," += 1;\n        if(").concat(c,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n        rc = outputLoc;\n        ").concat(o[r-2]," += 1;\n        if(").concat(o[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          ").concat(o[r-1]," += 1;\n          if(").concat(c,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(a,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const ree={kernelName:bk,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:i}=t,{paddings:a,mode:s}=r,o=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nee(i.shape,a,s):new tee(i.shape,a,s);return n.runWebGLProgram(o,[i],i.dtype)}},iee=Q4({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+I4+"\n  return result;\n"}),aee={kernelName:xk,backendName:"webgl",kernelFunc:iee};class see{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}}const oee=Q4({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),lee={kernelName:kN,backendName:"webgl",kernelFunc:oee},cee="return a - b;",uee=Q4({opSnippet:cee,packedOpSnippet:cee,supportsComplex:!0,cpuKernelImpl:n4}),hee={kernelName:EI,backendName:"webgl",kernelFunc:uee};function dee(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,s=rE([a],i.shape),o=j9({inputs:{x:i},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),l=wL(o.shape,s),c=Z4({inputs:{x:o},backend:n,attrs:{shape:l}}),u=uee({inputs:{a:i,b:c},backend:n}),h=B7({inputs:{x:u},backend:n}),d=s6({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:!1}}),A=Z4({inputs:{x:d},backend:n,attrs:{shape:l}}),p=oee({inputs:{a:h,b:A},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(A),p}const Aee={kernelName:AI,backendName:"webgl",kernelFunc:dee};const pee={kernelName:wk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:s,normalized:o}=r,l=o?i:dee({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new see(c,u,a),d=[[s]],A=n.runWebGLProgram(h,[l],"int32",d);return o||n.disposeIntermediateTensorInfo(l),A}},fee=g4+"\n  return -x;\n";const gee={kernelName:Sk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,i]=L5(e.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,t)}let i;return i=NE().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new x4(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new f4(r.shape,fee),n.runWebGLProgram(i,[r],r.dtype)}},mee=ND;const yee={kernelName:Ek,backendName:"webgl",kernelFunc:function(e){QI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l}=r,c=n.readSync(i.dataId),u=n.readSync(a.dataId),{selectedIndices:h}=mee(c,u,s,o,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},vee=kD;const bee={kernelName:Nk,backendName:"webgl",kernelFunc:function(e){QI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:c}=r,u=n.readSync(i.dataId),h=n.readSync(a.dataId),{selectedIndices:d,validOutputs:A}=vee(u,h,s,o,l,c);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([A]))]}},xee=ID;const wee={kernelName:kk,backendName:"webgl",kernelFunc:function(e){QI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}=r,u=n.readSync(i.dataId),h=n.readSync(a.dataId),d=s,A=o,p=l,f=c,{selectedIndices:g,selectedScores:m}=xee(u,h,d,A,p,f);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}};class _ee{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const See={kernelName:Tk,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:a,depth:s,onValue:o,offValue:l}=r,c=YC(i.shape),u=new _ee(c,s,o,l),h=Z4({inputs:{x:i},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(u,[h],a);n.disposeIntermediateTensorInfo(h);const A=Z4({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,s]}});return n.disposeIntermediateTensorInfo(d),A}};function Cee(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=d8({inputs:{input:r},backend:n}),t=Cee({inputs:{x:e},backend:n}),i=N8({inputs:{input:r},backend:n}),a=Cee({inputs:{x:i},backend:n}),s=F4({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),s}return H7({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const Eee={kernelName:PI,backendName:"webgl",kernelFunc:Cee};const Nee={kernelName:Ik,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const t=d8({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=N8({inputs:{input:i},backend:r}),s=Cee({inputs:{x:a},backend:r}),o=F4({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}return H7({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}};const kee={kernelName:Bk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return F7({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,s=t[0].dtype;t.forEach(e=>{KC(a,e.shape,"All tensors passed to stack must have matching shapes"),qC(s===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});const o=[],l=T8({inputs:t.map(e=>{const t=F7({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t}),backend:n,attrs:{axis:i}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};class Iee{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=j3(r),a=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(i," start = ").concat(i,"(").concat(a,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(o,"));\n        }\n      }\n    "):"\n        int start = ".concat(a,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class Tee{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);const r=e.length,i=j3(r),a=t.map(e=>e[0]).join(","),s=t.map((t,n)=>t[0]+e[n]).join(","),o=l4("rc",r),l=l4("source",r),c="".concat(o[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(l.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(o[r-1]," += 1;\n       if(").concat(c,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(o[r-2]," += 1;\n       if(").concat(o[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(o[r-1]," += 1;\n         if(").concat(c,") {")],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let A="";for(let p=0,f=1===r?2:4;p<f;p++)A+="\n        ".concat(h[p],"\n        if (").concat(d,") {\n          result[").concat(p,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(p,"] = getChannel(getX(").concat(l.join(),"), ").concat(u,");\n        }\n      ");A+=1===r?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(a,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(A,"\n        setOutput(result);\n      }\n    ")}}const Bee=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:s}=r;if(0===YC(i.shape)){const e=a.map((e,t)=>e[0]+i.shape[t]+e[1]);return H7({backend:n,attrs:{shape:e,value:s,dtype:i.dtype}})}const o=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tee(i.shape,a,s):new Iee(i.shape,a,s),l=[[s]];return n.runWebGLProgram(o,[i],i.dtype,l)},Mee={kernelName:Mk,backendName:"webgl",kernelFunc:Bee},Fee=Q4({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+I4+"\n  return result;\n"}),Ree={kernelName:Fk,backendName:"webgl",kernelFunc:Fee};const Lee={kernelName:Lk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,l=[],c=rE(a,i.shape);let u=c;const h=SL(u,o);let d,A=i;if(null!=h&&(A=l6({inputs:{x:i},backend:n,attrs:{perm:h}}),u=EL(u.length,o),l.push(A)),_L("prod",u,o),n.shouldExecuteOnCPU([A])){const e=n.texData.get(A.dataId).values,{outVals:t,outShape:r,outDtype:i}=U5(A.shape,A.dtype,e,u);d=n.makeTensorInfo(r,i,t)}else{const[e,t]=xL(A.shape,u),r=YC(t),a=Z4({inputs:{x:A},backend:n,attrs:{shape:[-1,r]}}),s=n6(a,QT(i.dtype),"prod",n);d=Z4({inputs:{x:s},backend:n,attrs:{shape:e}}),l.push(a),l.push(s)}if(s){l.push(d);const e=wL(d.shape,c);d=Z4({inputs:{x:d},backend:n,attrs:{shape:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),d}};const Pee={kernelName:Pk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:a,indices:s}=t,{outputRaggedRank:o}=r,l=i.map(e=>n.readSync(e.dataId)),c=i.map(e=>e.shape),u=n.readSync(a.dataId),h=n.readSync(s.dataId),[d,A,p]=D5(l,c,u,a.shape,a.dtype,h,s.shape,o),f=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),g=n.makeTensorInfo(p,a.dtype,A);return f.concat([g])}};const Uee={kernelName:Uk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:a}=t,s=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(a.dataId),[c,u]=O5(s,r.shape,r.dtype,o,i.shape,l,a.shape);return[n.makeTensorInfo([c.length],"int32",c),n.makeTensorInfo([u.length],r.dtype,u)]}};const Dee={kernelName:Dk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:a,defaultValue:s,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,c=n.readSync(i.dataId),u=n.readSync(a.dataId),h=n.readSync(s.dataId),d=o.map(e=>n.readSync(e.dataId)),A=o.map(e=>e.shape),[p,f]=j5(c,i.shape,u,a.shape,a.dtype,h,s.shape,d,A,l);return n.makeTensorInfo(p,a.dtype,f)}},Oee=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:a,dtype:s}=n,o=z5(r,i,a,s);return t.makeTensorInfo([o.length],s,o)},jee={kernelName:Ok,backendName:"webgl",kernelFunc:Oee},zee=H4({opSnippet:"return 1.0 / x;"}),Hee={kernelName:zk,backendName:"webgl",kernelFunc:zee},Qee=H4({opSnippet:g4+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Vee={kernelName:Hk,backendName:"webgl",kernelFunc:Qee},Gee=H4({opSnippet:g4+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Wee={kernelName:Kk,backendName:"webgl",kernelFunc:Gee};class qee{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,s,o,l]=e;this.outputShape=[a,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class Kee{constructor(e,t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,s,o,l]=e;this.outputShape=[a,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const Xee={kernelName:Wk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r,[l,c]=o,u=NE().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kee(i.shape,l,c,a,s):new qee(i.shape,l,c,a,s);return n.runWebGLProgram(u,[i],"float32")}};class Yee{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,s]=e,o=[n&&a>1?r-1:r,n&&s>1?i-1:i],l=[n&&a>1?a-1:a,n&&s>1?s-1:s],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,A=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(A,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(a,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(i-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const Jee={kernelName:qk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r,o=new Yee(a.shape,i.shape,s);return n.runWebGLProgram(o,[a],a.dtype)}};class Zee{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,s,o,l]=e;this.outputShape=[a,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(o,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}class $ee{constructor(e,t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,s,o,l]=e;this.outputShape=[a,t,n,l];const c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(c[0]/u[0],",\n          ").concat(c[1]/u[1],",\n          ").concat(c[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(o,".0,\n                                     ").concat(o,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}}const ete={kernelName:Vk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r,[l,c]=o,u=NE().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $ee(i.shape,l,c,a,s):new Zee(i.shape,l,c,a,s);return n.runWebGLProgram(u,[i],i.dtype)}};class tte{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,s]=e,o=[n&&a>1?r-1:r,n&&s>1?i-1:i],l=[n&&a>1?a-1:a,n&&s>1?s-1:s],c=o[0]/l[0],u=o[1]/l[1],h=1/c,d=1/u,A=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(c,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(A,");\n        const int winWidth = int(").concat(p,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(a,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(o[0],") *\n                (float(dyR) / float(").concat(l[0],"));\n\n            float sourceFracCol =\n                float(").concat(o[1],") *\n                  (float(dyC) / float(").concat(l[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const nte={kernelName:Gk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r,o=new tte(a.shape,i.shape,s);return n.runWebGLProgram(o,[a],a.dtype)}};class rte{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const r=e.map((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(r)).join(","),i=j3(n);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}class ite{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const r=l4("rc",n),i="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),a="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=j3(n);function o(n){const r=e.map((r,i)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(i,n)),i=r.join(","),a=r.slice(-2).join(",");return"getChannel(getX(".concat(i,"), vec2(").concat(a,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return o(e)}(r.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(r.slice()),";\n          }\n          if(").concat(a,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const ate={kernelName:Xk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r,s=i.shape.length,o=rE(a,i.shape);if(0===s)return B4({inputs:{x:i},backend:n});const l=NE().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ite(i.shape,o):new rte(i.shape,o);return n.runWebGLProgram(l,[i],i.dtype)}};class ste{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let i="";i="number"===typeof t?"float outputValue = ".concat(t.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(t.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(r," && coordY >= 0 && coordY < ").concat(n,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const ote={kernelName:OI,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:i}=t,{radians:a,fillValue:s,center:o}=n,l=r,c=new ste(i.shape,s),[u,h]=TO(o,i.shape[1],i.shape[2]),d=[[u,h,Math.sin(a),Math.cos(a)]];return l.runWebGLProgram(c,[i],i.dtype,d)}},lte=H4({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),cte={kernelName:Yk,backendName:"webgl",kernelFunc:lte},ute=H4({opSnippet:"return inversesqrt(x);",cpuKernelImpl:H5}),hte={kernelName:Jk,backendName:"webgl",kernelFunc:ute};class dte{constructor(e,t,n,r,i,a){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const o=j3(i.length),l=j3(a.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let A="";s&&(A="coords[0], coords[1]");const p="getDefaultValue(".concat(A,")"),f=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(i,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(u,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(p,", sum, float(found)));\n        }\n      ")}}class Ate{constructor(e,t,n,r,i,a){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a;const o=j3(i.length),l=j3(a.length);let c="";1===n?c="i":2===n&&(c="i, j");const u="getIndices(".concat(c,")");let h="";1===r?h="i":2===r&&(h="i, coords[1]");const d="getUpdates(".concat(h,")");let A="";s&&(A="coords[0], coords[1]");const p="getDefaultValue(".concat(A,")"),f=t>1?"strides[j]":"strides",g=t>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(o," strides = ").concat(o,"(").concat(i,");\n\n        void main() {\n          ").concat(l," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(e,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(t,"; j+=2) {\n              ivec4 index = round(").concat(u,");\n              flattenedIndex += index.xz * ").concat(f,";\n              if (j + 1 < ").concat(t,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(p,", sum, found));\n        }\n      ")}}const pte={kernelName:Zk,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:s}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UU(0,i,s),d=[h/c,c];if(0===h)return n.makeTensorInfo(s,i.dtype);const A=Z4({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),p=Z4({inputs:{x:a},backend:n,attrs:{shape:[l,c]}}),f=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;g=NE().getBool("WEBGL_PACK")?new Ate(l,o,A.shape.length,p.shape.length,u,d):new dte(l,o,A.shape.length,p.shape.length,u,d);const m=n.runWebGLProgram(g,[p,A,f],p.dtype),y=Z4({inputs:{x:m},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),y}};class fte{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),a=2===NE().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===r?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(a,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}}const gte={kernelName:eI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:a}=t,{side:s}=r,o=new fte(i.shape[0],i.shape[1],a.shape[1],s),l=[[i.shape[1]]];return n.runWebGLProgram(o,[i,a],"int32",l)}};class mte{constructor(e,t,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[];for(let r=0;r<t.length;r++)s.push("".concat(n[r])),r<e&&a.push("".concat(n[r]));r=a.join(),i=s.join()}const a=j3(n);this.userCode="\n      void main() {\n        ".concat(a," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}}const yte={kernelName:tI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t,s=new mte(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(s,[r,i,a],HT(i.dtype,a.dtype))}},vte=H4({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(UO,";\n  float scale = ").concat(DO,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),bte={kernelName:nI,backendName:"webgl",kernelFunc:vte},xte=H4({opSnippet:z4+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:V5}),wte={kernelName:oI,backendName:"webgl",kernelFunc:xte},_te=H4({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),Ste={kernelName:sI,backendName:"webgl",kernelFunc:_te},Cte=H4({opSnippet:z4+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(I4,"\n  return result;\n")}),Ete={kernelName:iI,backendName:"webgl",kernelFunc:Cte},Nte=H4({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),kte={kernelName:aI,backendName:"webgl",kernelFunc:Nte},Ite=H4({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),Tte={kernelName:lI,backendName:"webgl",kernelFunc:Ite},Bte={kernelName:hI,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:s}=r;qC(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const o=a.reduce((e,t)=>e*t),l=[[0,0]];l.push(...s);for(let m=1+a.length;m<i.shape.length;++m)l.push([0,0]);const c=[],u=Bee({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),h=BO(u.shape,a,o,!1),d=MO(h.length,a.length,!1),A=FO(u.shape,a,o,!1),p=Z4({inputs:{x:u},backend:n,attrs:{shape:h}}),f=l6({inputs:{x:p},backend:n,attrs:{perm:d}}),g=Z4({inputs:{x:f},backend:n,attrs:{shape:A}});return c.push(u),c.push(p),c.push(f),c.forEach(e=>n.disposeIntermediateTensorInfo(e)),g}};const Mte={kernelName:pI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:a,defaultValue:s}=t;if(1!==a.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(a.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==i.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(i.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));const o=n.readSync(r.dataId),l=n.readSync(i.dataId),c=n.readSync(a.dataId),u=n.readSync(s.dataId)[0],[h,d,A,p,f]=q5(o,r.shape,r.dtype,l,i.dtype,c,u);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,A),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(e=>Number(e)))),n.makeTensorInfo([f.length],r.dtype,new Int32Array(f))]}};const Fte={kernelName:fI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:a}=t;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==i.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(i.shape));if(1!==a.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(a.shape));const s=Array.from(n.readSync(i.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(a.dataId)),[c,u,h]=K5(o,r.shape,r.dtype,s,l);return[n.makeTensorInfo(u,r.dtype,c),n.makeTensorInfo([h.length],a.dtype,new Int32Array(h))]}};const Rte={kernelName:gI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(i.shape));if(1!==a.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(a.shape));const s=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(a.dataId),[c,u]=X5(s,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,c)}};const Lte={kernelName:mI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(i.shape));if(1!==a.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(a.shape));const s=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(a.dataId),[c,u]=X5(s,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,c)}};const Pte={kernelName:yI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=UU(0,i,o),A=!1;if("string"===a.dtype){const e=n.bufferSync(i),t=n.bufferSync(a),r=yT(n.readSync(s.dataId)[0]),p=Q5(e,t,o,d,u,c,l,h,r,A);return n.makeTensorInfo(o,p.dtype,p.values)}const p=new dte(c,l,i.shape.length,a.shape.length,h,[d,1],A),f=n.runWebGLProgram(p,[a,i,s],a.dtype),g=Z4({inputs:{x:f},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),g}};const Ute={kernelName:dI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:s}=r,o=rE(s,i.shape)[0],l=cj(i,a,o),c=i.shape.length,u=new Array(c).fill(0),h=i.shape.slice();return l.map(e=>{const t=[...h];t[o]=e;const r=i8({inputs:{x:i},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r})}},Dte="return sqrt(x);",Ote=H4({opSnippet:Dte,packedOpSnippet:Dte,cpuKernelImpl:Y5}),jte={kernelName:cI,backendName:"webgl",kernelFunc:Ote},zte={kernelName:bI,backendName:"webgl",kernelFunc:H4({opSnippet:"return x * x;"})},Hte="return (a - b) * (a - b);",Qte=Q4({opSnippet:Hte,packedOpSnippet:Hte}),Vte={kernelName:vI,backendName:"webgl",kernelFunc:Qte};const Gte={kernelName:xI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;if("string"!==i.dtype)throw new Error("Input must be of datatype string");const a=Cj(n.readSync(i.dataId)),s=J5(a,"string",r);return n.makeTensorInfo(i.shape,"string",s)}};const Wte={kernelName:UI,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e;const{x:i}=t,a=g4+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),s=new f4(i.shape,a);return r.runWebGLProgram(s,[i],i.dtype)}};class qte{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=j3(n.length),a=j3(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map((t,r)=>(e++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(e-1,"] * strides[").concat(r,"] + begin[").concat(r,"]"))).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(e,");\n      ").concat(i," strides = ").concat(i,"(").concat(t,");\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}}const Kte={kernelName:wI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:s,strides:o,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r,{finalShapeSparse:A,finalShape:p,isIdentity:f,sliceDim0:g,isSimpleSlice:m,begin:y,end:v,strides:b}=YF(i.shape,a,s,o,l,c,u,h,d);let x;if(f)x=Z4({inputs:{x:i},backend:n,attrs:{shape:p}});else if(g||m){qC(i.shape.length>=1,()=>"Input must have rank at least 1, got: ".concat(i.shape.length));const e=UF(y,v,b),t=i8({inputs:{x:i},backend:n,attrs:{begin:y,size:e}});x=Z4({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{if(n.shouldExecuteOnCPU([i])){const e=n.readSync(i.dataId),t=kM(i.shape,i.dtype,e),r=Z5(A,t,b,y);x=n.makeTensorInfo(p,i.dtype,r.values)}else{const e=new qte(y,b,A);x=n.runWebGLProgram(e,[i],i.dtype)}}const w=Z4({inputs:{x:x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(x),w}};const Xte={kernelName:_I,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:a,leftPad:s,rightPad:o,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:h}=t,d=n.readSync(u.dataId),A=n.readSync(h.dataId),[p,f]=$5(d,A,i,a,s,o,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(h.shape,"int32",f)]}};const Yte={kernelName:SI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:a,delimiter:s}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==s.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(s.shape));const o=n.readSync(a.dataId),l=n.readSync(s.dataId)[0],[c,u,h]=e4(o,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",c),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};const Jte={kernelName:CI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const s=n.readSync(a.dataId),o=t4(s,i);return n.makeTensorInfo(a.shape,"int32",o)}},Zte=H4({opSnippet:"return tan(x);"}),$te={kernelName:NI,backendName:"webgl",kernelFunc:Zte},ene=H4({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),tne={kernelName:kI,backendName:"webgl",kernelFunc:ene};const nne={kernelName:$k,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:i,indices:a,updates:s}=t,{}=r,{sliceRank:o,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=UU(0,a,i.shape),d=[h/c,c];if(0===h)return n.makeTensorInfo(i.shape,a.dtype);const A=Z4({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),p=Z4({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),f=Z4({inputs:{x:i},backend:n,attrs:{shape:d}}),g=new dte(l,o,A.shape.length,p.shape.length,u,d,!1,!0),m=n.runWebGLProgram(g,[p,A,f],f.dtype),y=Z4({inputs:{x:m},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),y}};class rne{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;const r=j3(this.rank),i=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push("imod(".concat(n[i],", ").concat(e[i],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(i,"));\n      }\n    ")}}function ine(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;if("string"===i.dtype||i.shape.length>5){const e=n.readSync(i.dataId),t="string"===i.dtype?e.map(e=>yT(e)):e,r=kM(i.shape,i.dtype,t),s=r4(r,a);return n.makeTensorInfo(s.shape,s.dtype,s.values)}const s=new rne(i.shape,a);return n.runWebGLProgram(s,[i],i.dtype)}const ane={kernelName:II,backendName:"webgl",kernelFunc:ine};class sne{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class one{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function lne(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function cne(e){let t=1;for(;t<e;)t*=2;return t}const une={kernelName:TI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a,sorted:s}=r,o=NE().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=NE().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=i.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([i])||u<o||a>l){const e=n.readSync(i.dataId),[t,r]=i4(e,c,i.dtype,a,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===a)return c[c.length-1]=0,[n.makeTensorInfo(c,i.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===u)return[i,H7({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(i.dataId),d=null!==h&&h.isPacked,A=d?n.unpackTensor(i):i,p=YC(c)/u,f=Z4({inputs:{x:A},attrs:{shape:[p,u]},backend:n});d&&lne(n,A);const g=cne(a),m=cne(u);let y=null;const v=()=>null===y?[f,f]:[f,y],b=(e,t,r)=>{const i=v(),a=new sne(r),s=[[u],[null===y?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=y;y=n.runWebGLProgram(a,i,"int32",s),lne(n,o)};for(let C=1;C<g;C*=2){const e=2*C;for(let t=C;t>=1;t/=2)b(e,t,[p,m])}for(let C=m;C>g;C/=2){const e=v(),t=new one([p,C/2]),r=[[u],[null===y?1:0],[g]],i=y;y=n.runWebGLProgram(t,e,"int32",r),lne(n,i);const a=g/2,s=2*a;for(let n=a;n>=1;n/=2)b(s,n,y.shape)}let x=y;y=i8({inputs:{x:y},backend:n,attrs:{begin:0,size:[p,a]}}),lne(n,x);let w=o9({inputs:{x:f,indices:y},backend:n,attrs:{axis:1,batchDims:1}});lne(n,f);const _=c.slice(0,-1);_.push(a),x=y,y=Z4({inputs:{x:y},attrs:{shape:_},backend:n}),lne(n,x);const S=w;return w=Z4({inputs:{x:w},attrs:{shape:_},backend:n}),lne(n,S),[w,y]}};class hne{constructor(e,t,n,r,i,a){this.variableNames=["Image","Transforms"],this.outputShape=a;const s="nearest"===n?1:2;let o;switch(r){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(o," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(o," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(e," && 0 <= coordX && coordX < ").concat(t,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(t,"));\n                float mapY = mapCoord(inY, float(").concat(e,"));\n\n                if (").concat(s," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}}const dne={kernelName:BI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:a}=t,{interpolation:s,fillMode:o,fillValue:l,outputShape:c}=r,[u,h,d,A]=i.shape,[p,f]=null!=c?c:[h,d],g=new hne(h,d,s,o,l,[u,p,f,A]);return n.runWebGLProgram(g,[i,a],"float32")}};const Ane={kernelName:FI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;w3(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(a.dataId),{outputValues:o,outputShape:l,indices:c}=s4(s,i,a.shape,a.dtype);return[r.makeTensorInfo(l,a.dtype,o),r.makeTensorInfo([c.length],"int32",c)]}};const pne={kernelName:RI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const s=i,o=s.shape.length,l=i.shape[a],c=new Array(o-1);let u=0;for(let f=0;f<o;f++)f!==a&&(c[u++]=s.shape[f]);const h=[],d=new Array(o).fill(0),A=s.shape.slice();A[a]=1;const p=new Array(l);for(let f=0;f<p.length;f++){d[a]=f;const e=i8({inputs:{x:s},backend:n,attrs:{begin:d,size:A}}),t=Z4({inputs:{x:e},backend:n,attrs:{shape:c}});p[f]=t,h.push(e)}return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}};class fne{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,s=a*Math.ceil(i/n);this.outputShape=[r,s];const o=4*Math.floor(n/4),l=n%4,c="\n        sumValue += dot(values, segFilter);\n    ";let u="";i%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));let h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(a,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(a,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(o,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(o,";\n        if (").concat(1===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(c,"\n        } else if (").concat(2===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(c,"\n        } else if (").concat(3===l,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(c,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const gne={kernelName:LI,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:s}=r,o=i.shape.length,l=[];let c=0;const u=SL([c],o);let h=i;null!=u&&(h=l6({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(h),c=EL(1,o)[0]);const d=_j(h.shape,c,s),A=YC([h.shape[c]]),p=Z4({inputs:{x:h},backend:n,attrs:{shape:[-1,A]}});l.push(p);const f=QT(i.dtype),g=(e,t,r,i,a)=>{const s=e.shape[0],o=e.shape[1],c=wj(o,a),u=new fne({windowSize:c,inSize:o,batchSize:s,numSegments:a},t),h=n.compileAndRun(u,[e,r],i);if(l.push(h),h.shape[1]===a)return h;const d=Oee({backend:n,attrs:{start:0,stop:a,step:1,dtype:"float32"}}),A=ine({inputs:{x:d},backend:n,attrs:{reps:[o/c]}});l.push(d),l.push(A);return g(h,t,A,i,a)},m=Z4({inputs:{x:g(p,"unsortedSegmentSum",a,f,s)},backend:n,attrs:{shape:d}});let y=m;if(null!=u){l.push(m);const e=CL(u);y=l6({inputs:{x:y},backend:n,attrs:{perm:e}})}return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}},mne=[h6,A6,f6,m6,b6,_6,S6,C6,B6,M6,R6,P6,D6,j6,H6,G6,W6,X6,Y6,J6,e8,s8,o8,l8,c8,p8,m8,b8,R4,_8,B8,O8,V8,W8,q8,K8,X8,J8,$8,t7,o7,l7,c7,h7,p7,m7,y7,b7,w7,_7,C7,E7,k7,T7,M7,R7,U7,j7,Q7,G7,K7,Y7,$7,n9,r9,a9,l9,u9,d9,M4,A9,k8,f9,m9,v9,U4,x9,_9,S9,E9,k9,T9,M9,R9,U9,O9,z9,Q9,V9,G9,K9,X9,Y9,J9,Z9,eee,ree,aee,pee,J4,gee,yee,bee,wee,h8,See,Nee,kee,Mee,Ree,j4,Lee,Pee,Uee,Dee,jee,A8,lee,Hee,Vee,Wee,$4,Xee,Jee,ete,nte,ate,ote,cte,hte,pte,gte,yte,bte,wte,Ste,Ete,kte,a8,Aee,Tte,Bte,Mte,Fte,Rte,Lte,Pte,Ute,jte,zte,Vte,Gte,Wte,Kte,Xte,Yte,Jte,hee,o6,$te,tne,nne,ane,une,dne,c6,Ane,pne,gne,Eee];for(const n of mne)YI(n);const yne=new class{constructor(){this.model=null,this.isLoaded=!1}async initialize(){try{return this.model=await TX("/models/surface-detection/model.json"),this.isLoaded=!0,console.log("AI Surface Detection model loaded successfully"),!0}catch(SS){return console.error("Failed to load AI model:",SS),this.isLoaded=!1,!1}}async detectSurfaces(e){const t=await this.loadImage(e);return this.isLoaded&&this.model?await this.aiDetection(t):await this.heuristicDetection(t)}async aiDetection(e){const t=MF(e).resizeBilinear([513,513]).expandDims(0).toFloat().div(127.5).sub(1),n=await this.model.predict(t),r=await n.squeeze().array(),i=this.processSegmentationMap(r,e.width,e.height);return t.dispose(),n.dispose(),i}async heuristicDetection(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.drawImage(e,0,0);const r=n.getImageData(0,0,t.width,t.height).data;return{surfaces:[...this.detectRoofRegions(r,t.width,t.height),...this.detectWallRegions(r,t.width,t.height),...this.detectEdgeRegions(r,t.width,t.height)],confidence:.75,method:"heuristic"}}detectRoofRegions(e,t,n){const r=[],i=.4*n,a=[];for(let s=0;s<i;s+=10)for(let n=0;n<t;n+=10){const r=4*(s*t+n),i=e[r],o=e[r+1],l=e[r+2];this.isRoofColor(i,o,l)&&a.push({x:n,y:s})}return this.clusterPoints(a,50).forEach((e,t)=>{if(e.length>10){const n=this.getBounds(e);r.push({id:"roof-".concat(t),type:"roof",bounds:n,points:e,confidence:this.calculateConfidence(e,"roof"),area:this.calculateArea(n),suitable:["shingles","ridge-vent","flashing"]})}}),r}detectWallRegions(e,t,n){const r=[],i=[];for(let a=.4*n;a<n;a+=10)for(let n=0;n<t;n+=10){const r=4*(a*t+n),s=e[r],o=e[r+1],l=e[r+2];this.isWallColor(s,o,l)&&i.push({x:n,y:a})}return this.clusterPoints(i,60).forEach((e,t)=>{if(e.length>15){const n=this.getBounds(e);r.push({id:"wall-".concat(t),type:"wall",bounds:n,points:e,confidence:this.calculateConfidence(e,"wall"),area:this.calculateArea(n),suitable:["siding","trim","gutters"]})}}),r}detectEdgeRegions(e,t,n){const r=[],i=(this.detectEdges(e,t,n),{id:"eave-primary",type:"eave",bounds:{x:.1*t,y:.45*n,width:.8*t,height:20},confidence:.7,suitable:["lighting","gutters"]});return r.push(i),r}detectEdges(e,t,n){const r=new Uint8ClampedArray(t*n);for(let i=1;i<n-1;i++)for(let n=1;n<t-1;n++){const a=this.getPixelBrightness(e,4*(i*t+n+1))-this.getPixelBrightness(e,4*(i*t+n-1)),s=this.getPixelBrightness(e,4*((i+1)*t+n))-this.getPixelBrightness(e,4*((i-1)*t+n)),o=Math.sqrt(a*a+s*s);r[i*t+n]=o>30?255:0}return r}getPixelBrightness(e,t){return(e[t]+e[t+1]+e[t+2])/3}isRoofColor(e,t,n){const r=(e+t+n)/3,i=Math.abs(e-t)<30&&Math.abs(t-n)<30;return r<150&&(i||e>t&&t>n&&e-n>20)}isWallColor(e,t,n){const r=(e+t+n)/3;return r>80&&r<240}clusterPoints(e,t){const n=[],r=new Set;return e.forEach((i,a)=>{if(r.has(a))return;const s=[i];r.add(a),e.forEach((e,n)=>{if(r.has(n))return;Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))<t&&(s.push(e),r.add(n))}),n.push(s)}),n}getBounds(e){const t=e.map(e=>e.x),n=e.map(e=>e.y),r=Math.min(...t),i=Math.max(...t),a=Math.min(...n);return{x:r,y:a,width:i-r,height:Math.max(...n)-a}}calculateConfidence(e,t){const n=Math.min(e.length/100,1),r="roof"===t?.1:.05;return Math.min(n+r,.95)}calculateArea(e){return e.width*e.height}processSegmentationMap(e,t,n){const r=[];return Object.entries({0:"background",1:"roof",2:"wall",3:"window",4:"door",5:"vegetation"}).forEach(i=>{let[a,s]=i;if("background"===s||"vegetation"===s)return;const o=this.extractMask(e,parseInt(a));this.maskToRegions(o,t,n).forEach((e,t)=>{r.push({id:"".concat(s,"-").concat(t),type:s,bounds:e.bounds,mask:e.mask,confidence:e.confidence,area:this.calculateArea(e.bounds),suitable:this.getSuitableProducts(s)})})}),{surfaces:r,confidence:.92,method:"ai"}}extractMask(e,t){return e.map(e=>e.map(e=>e===t?1:0))}maskToRegions(e,t,n){return[{bounds:{x:0,y:0,width:t,height:n},mask:e,confidence:.9}]}getSuitableProducts(e){return{roof:["shingles","ridge-vent","flashing","underlayment"],wall:["siding","trim","paint"],eave:["lighting","gutters","soffit"],edge:["lighting","gutters"]}[e]||[]}loadImage(e){return new Promise((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=n,r.src=e})}async analyzePanorama(e){const t=await this.detectSurfaces(e);return M(M({},t),{},{placements:this.generatePlacements(t.surfaces)})}generatePlacements(e){const t=[];return e.forEach(e=>{switch(e.type){case"roof":t.push({surfaceId:e.id,product:"shingles",coverage:100,position:this.boundsToPosition(e.bounds),autoPlaced:!0});break;case"eave":t.push({surfaceId:e.id,product:"lighting",spacing:12,position:this.boundsToPosition(e.bounds),autoPlaced:!0})}}),t}boundsToPosition(e){const t=e.x+e.width/2,n=e.y+e.height/2;return{x:t,y:n,spherical:this.pixelToSpherical(t,n)}}pixelToSpherical(e,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024;return{theta:e/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048)*Math.PI*2,phi:t/n*Math.PI}}};const vne=new class{constructor(){this.placementRules={shingles:{minCoverage:.95,overlapFactor:1.1,alignment:"horizontal"},lighting:{spacing:12,offset:6,pattern:"uniform"},ridgeVent:{placement:"peak",coverage:.9},gutters:{placement:"eave",coverage:1}}}async autoPlaceAll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await yne.analyzePanorama(e),r={shingles:[],lighting:[],ridgeVent:[],gutters:[],flashings:[]};return n.surfaces.filter(e=>"roof"===e.type).forEach(e=>{r.shingles.push(...this.placeShingles(e,t.shingleColor||"weathered-wood"));const n=this.placeRidgeVent(e);n&&r.ridgeVent.push(n)}),n.surfaces.filter(e=>"eave"===e.type).forEach(e=>{r.lighting.push(...this.placeLighting(e,t.lightingPattern||"uniform"))}),n.surfaces.filter(e=>"eave"===e.type).forEach(e=>{r.gutters.push(this.placeGutters(e))}),{placements:r,surfaces:n.surfaces,confidence:n.confidence,summary:this.generateSummary(r)}}placeShingles(e,t){const n=[],r=e.bounds,i=e.area,a={id:"shingle-auto-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical(r),bounds:r,coverage:i,autoPlaced:!0,confidence:e.confidence,type:"shingle-region",uvMapping:this.calculateUVMapping(r),material:{roughness:.85,metalness:.1,normalScale:1.5}};n.push(a);const s=this.generateEdgeShingles(e,t);return n.push(...s),n}generateEdgeShingles(e,t){const n=[],r=e.bounds;return n.push({id:"edge-top-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x,y:r.y,width:r.width,height:10}),type:"ridge-shingle",autoPlaced:!0}),n.push({id:"edge-left-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x,y:r.y,width:10,height:r.height}),type:"rake-shingle",autoPlaced:!0}),n.push({id:"edge-right-".concat(e.id),surfaceId:e.id,color:t,position:this.boundsToSpherical({x:r.x+r.width-10,y:r.y,width:10,height:r.height}),type:"rake-shingle",autoPlaced:!0}),n}placeLighting(e,t){const n=[],r=e.bounds,i=this.placementRules.lighting.spacing,a=.5*r.width,s=Math.floor(a/i);for(let o=0;o<s;o++){const i=r.x+r.width/s*o,a=r.y+this.placementRules.lighting.offset,l=this.pixelToSpherical(i,a);n.push({id:"light-auto-".concat(e.id,"-").concat(o),surfaceId:e.id,position:this.sphericalToCartesian(l.theta,l.phi,480),spherical:l,type:"rime-light",autoPlaced:!0,index:o,color:"#fff8dc",intensity:2.5,range:18,beamWidth:2.5,beamLength:12,pattern:t})}return n}placeRidgeVent(e){const t=e.bounds,n={x:t.x+.1*t.width,y:t.y,width:.8*t.width,height:15};return{id:"ridge-vent-auto-".concat(e.id),surfaceId:e.id,position:this.boundsToSpherical(n),bounds:n,type:"ridge-vent",autoPlaced:!0,coverage:n.width,product:"malarkey-ridge-vent"}}placeGutters(e){const t=e.bounds;return{id:"gutter-auto-".concat(e.id),surfaceId:e.id,position:this.boundsToSpherical(t),bounds:t,type:"gutter",autoPlaced:!0,coverage:t.width,color:"white",style:"k-style"}}boundsToSpherical(e){const t=e.x+e.width/2,n=e.y+e.height/2;return this.pixelToSpherical(t,n)}pixelToSpherical(e,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024;return{theta:e/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048)*Math.PI*2-Math.PI,phi:t/n*Math.PI}}sphericalToCartesian(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;return[n*Math.sin(t)*Math.cos(e),n*Math.cos(t),n*Math.sin(t)*Math.sin(e)]}calculateUVMapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024;return{u:e.x/t,v:e.y/n,uWidth:e.width/t,vHeight:e.height/n}}generateSummary(e){return{shingles:{count:e.shingles.length,totalArea:e.shingles.reduce((e,t)=>e+(t.coverage||0),0)},lighting:{count:e.lighting.length,totalLength:12*e.lighting.length},ridgeVent:{count:e.ridgeVent.length,totalLength:e.ridgeVent.reduce((e,t)=>e+(t.coverage||0),0)},gutters:{count:e.gutters.length,totalLength:e.gutters.reduce((e,t)=>e+(t.coverage||0),0)}}}optimizePlacements(e){const t=M({},e);return t.shingles=this.mergeOverlappingRegions(e.shingles),t.lighting=this.optimizeLightingSpacing(e.lighting),t}mergeOverlappingRegions(e){const t=[],n=new Set;return e.forEach((r,i)=>{if(n.has(i))return;let a=r;e.forEach((e,t)=>{i===t||n.has(t)||this.regionsOverlap(a,e)&&(a=this.mergeRegions(a,e),n.add(t))}),t.push(a)}),t}regionsOverlap(e,t){return!(!e.bounds||!t.bounds)&&!(e.bounds.x+e.bounds.width<t.bounds.x||t.bounds.x+t.bounds.width<e.bounds.x||e.bounds.y+e.bounds.height<t.bounds.y||t.bounds.y+t.bounds.height<e.bounds.y)}mergeRegions(e,t){const n=Math.min(e.bounds.x,t.bounds.x),r=Math.min(e.bounds.y,t.bounds.y),i=Math.max(e.bounds.x+e.bounds.width,t.bounds.x+t.bounds.width),a=Math.max(e.bounds.y+e.bounds.height,t.bounds.y+t.bounds.height);return M(M({},e),{},{bounds:{x:n,y:r,width:i-n,height:a-r},coverage:(i-n)*(a-r)})}optimizeLightingSpacing(e){return e.filter((t,n)=>{if(0===n)return!0;const r=e[n-1],i=this.calculateDistance(t.position,r.position);return i>=8&&i<=18})}calculateDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}adjustPlacement(e,t){return M(M({},t),{},{autoPlaced:!1,originalAutoPlacement:e})}};const bne=new class{constructor(){this.apiEndpoint={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_AUTH_CODE:"IAMBRANDON",REACT_APP_FIREBASE_API_KEY:"AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8",REACT_APP_FIREBASE_APP_ID:"1:874590395925:web:41fff249ed9a7b349af81c",REACT_APP_FIREBASE_AUTH_DOMAIN:"crmbackend-470221.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-4BG7SZMK6K",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"874590395925",REACT_APP_FIREBASE_PROJECT_ID:"crmbackend-470221",REACT_APP_FIREBASE_STORAGE_BUCKET:"crmbackend-470221.firebasestorage.app",REACT_APP_GAS_WEB_APP_URL:"https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4",REACT_APP_SHEET_NAME:"Bhotchleads",REACT_APP_SPREADSHEET_ID:"1E9VX7XI7GNGJa8Hq9__XAWv95WNgfJto1gUEXMbGqi0",REACT_APP_TWILIO_ACCOUNT_SID:"AC20e24f43ac063d43511d06c688b5ec06",REACT_APP_TWILIO_AUTH_TOKEN:"65cc837132a39a100d4b03a8a234f2ed",REACT_APP_TWILIO_PHONE_NUMBER:"+13852357204"}.REACT_APP_PHOTOGRAMMETRY_API||"/api/photogrammetry",this.requiredPhotos=8,this.processingStatus=null}async processPhotos(e){if(e.length<this.requiredPhotos)throw new Error("Minimum ".concat(this.requiredPhotos," photos required. Got ").concat(e.length,"."));const t=await this.validatePhotos(e);if(!t.valid)throw new Error("Photo validation failed: ".concat(t.errors.join(", ")));const n=new FormData;e.forEach((e,t)=>{n.append("photo_".concat(t),e.file),n.append("metadata_".concat(t),JSON.stringify({angle:e.angle,timestamp:e.timestamp,gps:e.gps,orientation:e.orientation}))});try{const e=await fetch("".concat(this.apiEndpoint,"/process"),{method:"POST",body:n});if(!e.ok)throw new Error("Upload failed: ".concat(e.statusText));const t=await e.json();return this.processingStatus=t.jobId,{jobId:t.jobId,estimatedTime:t.estimatedTime||300,status:"processing"}}catch(SS){throw console.error("Photogrammetry processing failed:",SS),SS}}async validatePhotos(e){const t=[];e.length!==this.requiredPhotos&&t.push("Expected ".concat(this.requiredPhotos," photos, got ").concat(e.length));const n=e.map(e=>e.angle),r=["front-left","front-right","left-side","right-side","back-left","back-right","overhead","detail"].filter(e=>!n.includes(e));r.length>0&&t.push("Missing required angles: ".concat(r.join(", ")));for(const i of e){const e=await this.checkImageQuality(i);e.passed||t.push("Photo ".concat(i.angle,": ").concat(e.issue))}return{valid:0===t.length,errors:t}}async checkImageQuality(e){return new Promise(t=>{const n=new Image;n.onload=()=>{const e={passed:!0,issue:null};(n.width<1920||n.height<1080)&&(e.passed=!1,e.issue="Resolution too low (minimum 1920x1080)");const r=n.width/n.height;(r<1.3||r>1.8)&&(e.passed=!1,e.issue="Unusual aspect ratio"),t(e)},n.onerror=()=>{t({passed:!1,issue:"Invalid image file"})},n.src=e.preview||URL.createObjectURL(e.file)})}async getStatus(e){try{const t=await fetch("".concat(this.apiEndpoint,"/status/").concat(e)),n=await t.json();return{jobId:e,status:n.status,progress:n.progress||0,result:n.result||null,error:n.error||null}}catch(SS){return console.error("Failed to get status:",SS),{jobId:e,status:"unknown",error:SS.message}}}async downloadModel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"glb";try{const n=await fetch("".concat(this.apiEndpoint,"/download/").concat(e,"?format=").concat(t));if(!n.ok)throw new Error("Download failed");const r=await n.blob();return{format:t,blob:r,url:URL.createObjectURL(r)}}catch(SS){throw console.error("Model download failed:",SS),SS}}async cancelJob(e){try{return await fetch("".concat(this.apiEndpoint,"/cancel/").concat(e),{method:"POST"}),!0}catch(SS){return console.error("Failed to cancel job:",SS),!1}}async generatePointCloudPreview(e){if(e.length<2)throw new Error("Minimum 2 photos required for preview");const t=[],n=await this.extractFeatures(e[0]),r=await this.extractFeatures(e[1]);return this.matchFeatures(n,r).forEach(n=>{const r=this.triangulatePoint(n,e[0],e[1]);r&&t.push(r)}),{points:t,count:t.length,bounds:this.calculateBounds(t),preview:!0}}async extractFeatures(e){return new Promise(t=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas"),r=e.getContext("2d");e.width=n.width,e.height=n.height,r.drawImage(n,0,0);const i=r.getImageData(0,0,e.width,e.height),a=this.detectKeypoints(i);t(a)},n.src=e.preview||URL.createObjectURL(e.file)})}detectKeypoints(e){const t=[],{data:n,width:r,height:i}=e,a=20;for(let s=a;s<i-a;s+=a)for(let e=a;e<r-a;e+=a){const i=this.getGradientX(n,e,s,r),a=this.getGradientY(n,e,s,r),o=Math.sqrt(i*i+a*a);o>30&&t.push({x:e,y:s,magnitude:o,descriptor:this.createDescriptor(n,e,s,r)})}return t}getGradientX(e,t,n,r){const i=4*(n*r+t),a=(e[i-4]+e[i-3]+e[i-2])/3;return(e[i+4]+e[i+5]+e[i+6])/3-a}getGradientY(e,t,n,r){const i=4*(n*r+t),a=(e[i-4*r]+e[i-4*r+1]+e[i-4*r+2])/3;return(e[i+4*r]+e[i+4*r+1]+e[i+4*r+2])/3-a}createDescriptor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;const a=[];for(let s=-i;s<=i;s+=2)for(let o=-i;o<=i;o+=2){const i=4*((n+s)*r+(t+o));a.push((e[i]+e[i+1]+e[i+2])/3)}return a}matchFeatures(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r=[];return e.forEach(e=>{let i=null,a=1/0;t.forEach(t=>{const n=this.descriptorDistance(e.descriptor,t.descriptor);n<a&&(a=n,i=t)}),a<n&&r.push({point1:{x:e.x,y:e.y},point2:{x:i.x,y:i.y},distance:a})}),r}descriptorDistance(e,t){return Math.sqrt(e.reduce((e,n,r)=>e+Math.pow(n-t[r],2),0))}triangulatePoint(e,t,n){return{x:(e.point1.x+e.point2.x)/2,y:(e.point1.y+e.point2.y)/2,z:.1*Math.abs(e.point1.x-e.point2.x),confidence:1/(1+e.distance)}}calculateBounds(e){if(0===e.length)return{min:[0,0,0],max:[0,0,0]};const t=e.map(e=>e.x),n=e.map(e=>e.y),r=e.map(e=>e.z);return{min:[Math.min(...t),Math.min(...n),Math.min(...r)],max:[Math.max(...t),Math.max(...n),Math.max(...r)]}}pointCloudToMesh(e){const t={vertices:e.points.map(e=>[e.x,e.y,e.z]),colors:e.points.map(()=>[1,1,1]),bounds:e.bounds};return t}async estimateMeasurements(e){return{roofArea:0,pitch:0,perimeter:0,valleys:[],ridges:[],hips:[]}}};var xne=n(2284),wne=Uint8Array,_ne=Uint16Array,Sne=Int32Array,Cne=new wne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ene=new wne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Nne=new wne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kne=function(e,t){for(var n=new _ne(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Sne(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},Ine=kne(Cne,2),Tne=Ine.b,Bne=Ine.r;Tne[28]=258,Bne[258]=28;for(var Mne=kne(Ene,0),Fne=(Mne.b,Mne.r),Rne=new _ne(32768),Lne=0;Lne<32768;++Lne){var Pne=(43690&Lne)>>1|(21845&Lne)<<1;Pne=(61680&(Pne=(52428&Pne)>>2|(13107&Pne)<<2))>>4|(3855&Pne)<<4,Rne[Lne]=((65280&Pne)>>8|(255&Pne)<<8)>>1}var Une=function(e,t,n){for(var r=e.length,i=0,a=new _ne(t);i<r;++i)e[i]&&++a[e[i]-1];var s,o=new _ne(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;if(n){s=new _ne(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],h=o[e[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[Rne[h]>>l]=c}else for(s=new _ne(r),i=0;i<r;++i)e[i]&&(s[i]=Rne[o[e[i]-1]++]>>15-e[i]);return s},Dne=new wne(288);for(Lne=0;Lne<144;++Lne)Dne[Lne]=8;for(Lne=144;Lne<256;++Lne)Dne[Lne]=9;for(Lne=256;Lne<280;++Lne)Dne[Lne]=7;for(Lne=280;Lne<288;++Lne)Dne[Lne]=8;var One=new wne(32);for(Lne=0;Lne<32;++Lne)One[Lne]=5;var jne=Une(Dne,9,0),zne=Une(One,5,0),Hne=function(e){return(e+7)/8|0},Qne=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new wne(e.subarray(t,n))},Vne=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},Gne=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},Wne=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,a=n.slice();if(!i)return{t:$ne,l:0};if(1==i){var s=new wne(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var o=n[0],l=n[1],c=0,u=1,h=2;for(n[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=i-1;)o=n[n[c].f<n[h].f?c++:h++],l=n[c!=u&&n[c].f<n[h].f?c++:h++],n[u++]={s:-1,f:o.f+l.f,l:o,r:l};var d=a[0].s;for(r=1;r<i;++r)a[r].s>d&&(d=a[r].s);var A=new _ne(d+1),p=qne(n[u-1],A,0);if(p>t){r=0;var f=0,g=p-t,m=1<<g;for(a.sort(function(e,t){return A[t.s]-A[e.s]||e.f-t.f});r<i;++r){var y=a[r].s;if(!(A[y]>t))break;f+=m-(1<<p-A[y]),A[y]=t}for(f>>=g;f>0;){var v=a[r].s;A[v]<t?f-=1<<t-A[v]++-1:++r}for(;r>=0&&f;--r){var b=a[r].s;A[b]==t&&(--A[b],++f)}p=t}return{t:new wne(A),l:p}},qne=function(e,t,n){return-1==e.s?Math.max(qne(e.l,t,n+1),qne(e.r,t,n+1)):t[e.s]=n},Kne=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new _ne(++t),r=0,i=e[0],a=1,s=function(e){n[r++]=e},o=1;o<=t;++o)if(e[o]==i&&o!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(i),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(i);a=1,i=e[o]}return{c:n.subarray(0,r),n:t}},Xne=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Yne=function(e,t,n){var r=n.length,i=Hne(t+2);e[i]=255&r,e[i+1]=r>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<r;++a)e[i+a+4]=n[a];return 8*(i+4+r)},Jne=function(e,t,n,r,i,a,s,o,l,c,u){Vne(t,u++,n),++i[256];for(var h=Wne(i,15),d=h.t,A=h.l,p=Wne(a,15),f=p.t,g=p.l,m=Kne(d),y=m.c,v=m.n,b=Kne(f),x=b.c,w=b.n,_=new _ne(19),S=0;S<y.length;++S)++_[31&y[S]];for(S=0;S<x.length;++S)++_[31&x[S]];for(var C=Wne(_,7),E=C.t,N=C.l,k=19;k>4&&!E[Nne[k-1]];--k);var I,T,B,M,F=c+5<<3,R=Xne(i,Dne)+Xne(a,One)+s,L=Xne(i,d)+Xne(a,f)+s+14+3*k+Xne(_,E)+2*_[16]+3*_[17]+7*_[18];if(l>=0&&F<=R&&F<=L)return Yne(t,u,e.subarray(l,l+c));if(Vne(t,u,1+(L<R)),u+=2,L<R){I=Une(d,A,0),T=d,B=Une(f,g,0),M=f;var P=Une(E,N,0);Vne(t,u,v-257),Vne(t,u+5,w-1),Vne(t,u+10,k-4),u+=14;for(S=0;S<k;++S)Vne(t,u+3*S,E[Nne[S]]);u+=3*k;for(var U=[y,x],D=0;D<2;++D){var O=U[D];for(S=0;S<O.length;++S){var j=31&O[S];Vne(t,u,P[j]),u+=E[j],j>15&&(Vne(t,u,O[S]>>5&127),u+=O[S]>>12)}}}else I=jne,T=Dne,B=zne,M=One;for(S=0;S<o;++S){var z=r[S];if(z>255){Gne(t,u,I[(j=z>>18&31)+257]),u+=T[j+257],j>7&&(Vne(t,u,z>>23&31),u+=Cne[j]);var H=31&z;Gne(t,u,B[H]),u+=M[H],H>3&&(Gne(t,u,z>>5&8191),u+=Ene[H])}else Gne(t,u,I[z]),u+=T[z]}return Gne(t,u,I[256]),u+T[256]},Zne=new Sne([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$ne=new wne(0),ere=function(e,t,n,r,i,a){var s=a.z||e.length,o=new wne(r+s+5*(1+Math.ceil(s/7e3))+i),l=o.subarray(r,o.length-i),c=a.l,u=7&(a.r||0);if(t){u&&(l[0]=a.r>>3);for(var h=Zne[t-1],d=h>>13,A=8191&h,p=(1<<n)-1,f=a.p||new _ne(32768),g=a.h||new _ne(p+1),m=Math.ceil(n/3),y=2*m,v=function(t){return(e[t]^e[t+1]<<m^e[t+2]<<y)&p},b=new Sne(25e3),x=new _ne(288),w=new _ne(32),_=0,S=0,C=a.i||0,E=0,N=a.w||0,k=0;C+2<s;++C){var I=v(C),T=32767&C,B=g[I];if(f[T]=B,g[I]=T,N<=C){var M=s-C;if((_>7e3||E>24576)&&(M>423||!c)){u=Jne(e,l,0,b,x,w,S,E,k,C-k,u),E=_=S=0,k=C;for(var F=0;F<286;++F)x[F]=0;for(F=0;F<30;++F)w[F]=0}var R=2,L=0,P=A,U=T-B&32767;if(M>2&&I==v(C-U))for(var D=Math.min(d,M)-1,O=Math.min(32767,C),j=Math.min(258,M);U<=O&&--P&&T!=B;){if(e[C+R]==e[C+R-U]){for(var z=0;z<j&&e[C+z]==e[C+z-U];++z);if(z>R){if(R=z,L=U,z>D)break;var H=Math.min(U,z-2),Q=0;for(F=0;F<H;++F){var V=C-U+F&32767,G=V-f[V]&32767;G>Q&&(Q=G,B=V)}}}U+=(T=B)-(B=f[T])&32767}if(L){b[E++]=268435456|Bne[R]<<18|Fne[L];var W=31&Bne[R],q=31&Fne[L];S+=Cne[W]+Ene[q],++x[257+W],++w[q],N=C+R,++_}else b[E++]=e[C],++x[e[C]]}}for(C=Math.max(C,N);C<s;++C)b[E++]=e[C],++x[e[C]];u=Jne(e,l,c,b,x,w,S,E,k,C-k,u),c||(a.r=7&u|l[u/8|0]<<3,u-=7,a.h=g,a.p=f,a.i=C,a.w=N)}else{for(C=a.w||0;C<s+c;C+=65535){var K=C+65535;K>=s&&(l[u/8|0]=c,K=s),u=Yne(l,u+1,e.subarray(C,K))}a.i=s}return Qne(o,0,r+Hne(u)+i)},tre=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,a=0|n.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=r+=n[s];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},nre=function(e,t,n,r,i){if(!i&&(i={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),s=new wne(a.length+e.length);s.set(a),s.set(e,a.length),e=s,i.w=a.length}return ere(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,r,i)},rre=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},ire=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var i=tre();i.p(t.dictionary),rre(e,2,i.d())}};function are(e,t){t||(t={});var n=tre();n.p(e);var r=nre(e,t,t.dictionary?6:2,4);return ire(r,t),rre(r,r.length-4,n.d()),r}var sre="undefined"!=typeof TextDecoder&&new TextDecoder;try{sre.decode($ne,{stream:!0})}catch(IAe){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function ore(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function lre(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ore(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ore(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cre(e){return new TextDecoder(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8").decode(e)}const ure=new TextEncoder;const hre=(()=>{const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])})(),dre={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Are{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,T.A)(this,"buffer",void 0),(0,T.A)(this,"byteLength",void 0),(0,T.A)(this,"byteOffset",void 0),(0,T.A)(this,"length",void 0),(0,T.A)(this,"offset",void 0),(0,T.A)(this,"lastWrittenByte",void 0),(0,T.A)(this,"littleEndian",void 0),(0,T.A)(this,"_data",void 0),(0,T.A)(this,"_mark",void 0),(0,T.A)(this,"_marks",void 0);let n=!1;"number"===typeof e?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,i=e.byteLength-r;let a=r;(ArrayBuffer.isView(e)||e instanceof Are)&&(e.byteLength!==e.buffer.byteLength&&(a=e.byteOffset+r),e=e.buffer),this.lastWrittenByte=n?i:0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,i),this._mark=0,this._marks=[]}available(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=e,this}back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readArray(e,"uint8")}readArray(e,t){const n=dre[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,i=this.buffer.slice(r,r+n);if(this.littleEndian===hre&&"uint8"!==t&&"int8"!==t){const e=new Uint8Array(this.buffer.slice(r,r+n));e.reverse();const i=new dre[t](e.buffer);return this.offset+=n,i.reverse(),i}const a=new dre[t](i);return this.offset+=n,a}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return cre(this.readBytes(e))}decodeText(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";return cre(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(function(e){return ure.encode(e)}(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function pre(e){let t=e.length;for(;--t>=0;)e[t]=0}const fre=256,gre=286,mre=30,yre=15,vre=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),bre=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xre=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wre=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_re=new Array(576);pre(_re);const Sre=new Array(60);pre(Sre);const Cre=new Array(512);pre(Cre);const Ere=new Array(256);pre(Ere);const Nre=new Array(29);pre(Nre);const kre=new Array(mre);function Ire(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let Tre,Bre,Mre;function Fre(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}pre(kre);const Rre=e=>e<256?Cre[e]:Cre[256+(e>>>7)],Lre=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Pre=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Lre(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Ure=(e,t,n)=>{Pre(e,n[2*t],n[2*t+1])},Dre=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Ore=(e,t,n)=>{const r=new Array(16);let i,a,s=0;for(i=1;i<=yre;i++)s=s+n[i-1]<<1,r[i]=s;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=Dre(r[t]++,t))}},jre=e=>{let t;for(t=0;t<gre;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mre;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},zre=e=>{e.bi_valid>8?Lre(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Hre=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},Qre=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Hre(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Hre(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},Vre=(e,t,n)=>{let r,i,a,s,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,i=e.pending_buf[e.sym_buf+o++],0===r?Ure(e,i,t):(a=Ere[i],Ure(e,a+fre+1,t),s=vre[a],0!==s&&(i-=Nre[a],Pre(e,i,s)),r--,a=Rre(r),Ure(e,a,n),s=bre[a],0!==s&&(r-=kre[a],Pre(e,r,s)))}while(o<e.sym_next);Ure(e,256,t)},Gre=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let s,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<a;s++)0!==n[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)Qre(e,n,s);l=a;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Qre(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,n[2*l]=n[2*s]+n[2*o],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,n[2*s+1]=n[2*o+1]=l,e.heap[1]=l++,Qre(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,h,d,A,p,f=0;for(d=0;d<=yre;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],d=n[2*n[2*u+1]+1]+1,d>l&&(d=l,f++),n[2*u+1]=d,u>r||(e.bl_count[d]++,A=0,u>=o&&(A=s[u-o]),p=n[2*u],e.opt_len+=p*(d+A),a&&(e.static_len+=p*(i[2*u+1]+A)));if(0!==f){do{for(d=l-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(d=l;0!==d;d--)for(u=e.bl_count[d];0!==u;)h=e.heap[--c],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}})(e,t),Ore(n,c,e.bl_count)},Wre=(e,t,n)=>{let r,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++o<l&&i===s||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4))},qre=(e,t,n)=>{let r,i,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(o<c)do{Ure(e,i,e.bl_tree)}while(0!==--o);else 0!==i?(i!==a&&(Ure(e,i,e.bl_tree),o--),Ure(e,16,e.bl_tree),Pre(e,o-3,2)):o<=10?(Ure(e,17,e.bl_tree),Pre(e,o-3,3)):(Ure(e,18,e.bl_tree),Pre(e,o-11,7));o=0,a=i,0===s?(l=138,c=3):i===s?(l=6,c=3):(l=7,c=4)}};let Kre=!1;const Xre=(e,t,n,r)=>{Pre(e,0+(r?1:0),3),zre(e),Lre(e,n),Lre(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Yre=e=>{Kre||((()=>{let e,t,n,r,i;const a=new Array(16);for(n=0,r=0;r<28;r++)for(Nre[r]=n,e=0;e<1<<vre[r];e++)Ere[n++]=r;for(Ere[n-1]=r,i=0,r=0;r<16;r++)for(kre[r]=i,e=0;e<1<<bre[r];e++)Cre[i++]=r;for(i>>=7;r<mre;r++)for(kre[r]=i<<7,e=0;e<1<<bre[r]-7;e++)Cre[256+i++]=r;for(t=0;t<=yre;t++)a[t]=0;for(e=0;e<=143;)_re[2*e+1]=8,e++,a[8]++;for(;e<=255;)_re[2*e+1]=9,e++,a[9]++;for(;e<=279;)_re[2*e+1]=7,e++,a[7]++;for(;e<=287;)_re[2*e+1]=8,e++,a[8]++;for(Ore(_re,287,a),e=0;e<mre;e++)Sre[2*e+1]=5,Sre[2*e]=Dre(e,5);Tre=new Ire(_re,vre,257,gre,yre),Bre=new Ire(Sre,bre,0,mre,yre),Mre=new Ire(new Array(0),xre,0,19,7)})(),Kre=!0),e.l_desc=new Fre(e.dyn_ltree,Tre),e.d_desc=new Fre(e.dyn_dtree,Bre),e.bl_desc=new Fre(e.bl_tree,Mre),e.bi_buf=0,e.bi_valid=0,jre(e)},Jre=(e,t,n,r)=>{let i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<fre;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Gre(e,e.l_desc),Gre(e,e.d_desc),s=(e=>{let t;for(Wre(e,e.dyn_ltree,e.l_desc.max_code),Wre(e,e.dyn_dtree,e.d_desc.max_code),Gre(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*wre[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?Xre(e,t,n,r):4===e.strategy||a===i?(Pre(e,2+(r?1:0),3),Vre(e,_re,Sre)):(Pre(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(Pre(e,t-257,5),Pre(e,n-1,5),Pre(e,r-4,4),i=0;i<r;i++)Pre(e,e.bl_tree[2*wre[i]+1],3);qre(e,e.dyn_ltree,t-1),qre(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Vre(e,e.dyn_ltree,e.dyn_dtree)),jre(e),r&&zre(e)},Zre=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Ere[n]+fre+1)]++,e.dyn_dtree[2*Rre(t)]++),e.sym_next===e.sym_end),$re=e=>{Pre(e,2,3),Ure(e,256,_re),(e=>{16===e.bi_valid?(Lre(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},eie={_tr_init:Yre,_tr_stored_block:Xre,_tr_flush_block:Jre,_tr_tally:Zre,_tr_align:$re};var tie=(e,t,n,r)=>{let i=65535&e,a=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,a=a+i|0}while(--s);i%=65521,a%=65521}return i|a<<16};const nie=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var rie=(e,t,n,r)=>{const i=nie,a=r+n;e^=-1;for(let s=r;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},iie={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},aie={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:sie,_tr_stored_block:oie,_tr_flush_block:lie,_tr_tally:cie,_tr_align:uie}=eie,{Z_NO_FLUSH:hie,Z_PARTIAL_FLUSH:die,Z_FULL_FLUSH:Aie,Z_FINISH:pie,Z_BLOCK:fie,Z_OK:gie,Z_STREAM_END:mie,Z_STREAM_ERROR:yie,Z_DATA_ERROR:vie,Z_BUF_ERROR:bie,Z_DEFAULT_COMPRESSION:xie,Z_FILTERED:wie,Z_HUFFMAN_ONLY:_ie,Z_RLE:Sie,Z_FIXED:Cie,Z_DEFAULT_STRATEGY:Eie,Z_UNKNOWN:Nie,Z_DEFLATED:kie}=aie,Iie=258,Tie=262,Bie=42,Mie=113,Fie=666,Rie=(e,t)=>(e.msg=iie[t],t),Lie=e=>2*e-(e>4?9:0),Pie=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Uie=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let Die=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Oie=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},jie=(e,t)=>{lie(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Oie(e.strm)},zie=(e,t)=>{e.pending_buf[e.pending++]=t},Hie=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Qie=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=tie(e.adler,t,i,n):2===e.state.wrap&&(e.adler=rie(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Vie=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-Tie?e.strstart-(e.w_size-Tie):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+Iie;let A=c[a+s-1],p=c[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+s]===p&&c[n+s-1]===A&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<d);if(r=Iie-(d-a),a=d-Iie,r>s){if(e.match_start=t,s=r,r>=o)break;A=c[a+s-1],p=c[a+s]}}}while((t=h[t&u])>l&&0!==--i);return s<=e.lookahead?s:e.lookahead},Gie=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Tie)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Uie(e),r+=t),0===e.strm.avail_in)break;if(n=Qie(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Die(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Die(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Tie&&0!==e.strm.avail_in)},Wie=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==pie||t===hie||n!==r+e.strm.avail_in))break;s=t===pie&&n===r+e.strm.avail_in?1:0,oie(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Oie(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Qie(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==hie&&t!==pie&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Qie(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===pie)&&t!==hie&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===pie&&0===e.strm.avail_in&&n===r?1:0,oie(e,e.block_start,n,s),e.block_start+=n,Oie(e.strm)),s?3:1)},qie=(e,t)=>{let n,r;for(;;){if(e.lookahead<Tie){if(Gie(e),e.lookahead<Tie&&t===hie)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Die(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Tie&&(e.match_length=Vie(e,n)),e.match_length>=3)if(r=cie(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Die(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Die(e,e.ins_h,e.window[e.strstart+1]);else r=cie(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(jie(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===pie?(jie(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jie(e,!1),0===e.strm.avail_out)?1:2},Kie=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Tie){if(Gie(e),e.lookahead<Tie&&t===hie)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Die(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Tie&&(e.match_length=Vie(e,n),e.match_length<=5&&(e.strategy===wie||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=cie(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Die(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(jie(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=cie(e,0,e.window[e.strstart-1]),r&&jie(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=cie(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===pie?(jie(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jie(e,!1),0===e.strm.avail_out)?1:2};function Xie(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const Yie=[new Xie(0,0,0,0,Wie),new Xie(4,4,8,4,qie),new Xie(4,5,16,8,qie),new Xie(4,6,32,32,qie),new Xie(4,4,16,16,Kie),new Xie(8,16,32,32,Kie),new Xie(8,16,128,128,Kie),new Xie(8,32,128,256,Kie),new Xie(32,128,258,1024,Kie),new Xie(32,258,258,4096,Kie)];function Jie(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kie,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Pie(this.dyn_ltree),Pie(this.dyn_dtree),Pie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Pie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Pie(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Zie=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Bie&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Mie&&t.status!==Fie?1:0},$ie=e=>{if(Zie(e))return Rie(e,yie);e.total_in=e.total_out=0,e.data_type=Nie;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Bie:Mie,e.adler=2===t.wrap?0:1,t.last_flush=-2,sie(t),gie},eae=e=>{const t=$ie(e);return t===gie&&(e=>{e.window_size=2*e.w_size,Pie(e.head),e.max_lazy_match=Yie[e.level].max_lazy,e.good_match=Yie[e.level].good_length,e.nice_match=Yie[e.level].nice_length,e.max_chain_length=Yie[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},tae=(e,t,n,r,i,a)=>{if(!e)return yie;let s=1;if(t===xie&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==kie||r<8||r>15||t<0||t>9||a<0||a>Cie||8===r&&1!==s)return Rie(e,yie);8===r&&(r=9);const o=new Jie;return e.state=o,o.strm=e,o.status=Bie,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=n,eae(e)};var nae=(e,t)=>{if(Zie(e)||t>fie||t<0)return e?Rie(e,yie):yie;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Fie&&t!==pie)return Rie(e,0===e.avail_out?bie:yie);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Oie(e),0===e.avail_out)return n.last_flush=-1,gie}else if(0===e.avail_in&&Lie(t)<=Lie(r)&&t!==pie)return Rie(e,bie);if(n.status===Fie&&0!==e.avail_in)return Rie(e,bie);if(n.status===Bie&&0===n.wrap&&(n.status=Mie),n.status===Bie){let t=kie+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=_ie||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Hie(n,t),0!==n.strstart&&(Hie(n,e.adler>>>16),Hie(n,65535&e.adler)),e.adler=1,n.status=Mie,Oie(e),0!==n.pending)return n.last_flush=-1,gie}if(57===n.status)if(e.adler=0,zie(n,31),zie(n,139),zie(n,8),n.gzhead)zie(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),zie(n,255&n.gzhead.time),zie(n,n.gzhead.time>>8&255),zie(n,n.gzhead.time>>16&255),zie(n,n.gzhead.time>>24&255),zie(n,9===n.level?2:n.strategy>=_ie||n.level<2?4:0),zie(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(zie(n,255&n.gzhead.extra.length),zie(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=rie(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(zie(n,0),zie(n,0),zie(n,0),zie(n,0),zie(n,0),zie(n,9===n.level?2:n.strategy>=_ie||n.level<2?4:0),zie(n,3),n.status=Mie,Oie(e),0!==n.pending)return n.last_flush=-1,gie;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=rie(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,Oie(e),0!==n.pending)return n.last_flush=-1,gie;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=rie(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=rie(e.adler,n.pending_buf,n.pending-r,r)),Oie(e),0!==n.pending)return n.last_flush=-1,gie;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,zie(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=rie(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=rie(e.adler,n.pending_buf,n.pending-r,r)),Oie(e),0!==n.pending)return n.last_flush=-1,gie;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,zie(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=rie(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Oie(e),0!==n.pending))return n.last_flush=-1,gie;zie(n,255&e.adler),zie(n,e.adler>>8&255),e.adler=0}if(n.status=Mie,Oie(e),0!==n.pending)return n.last_flush=-1,gie}if(0!==e.avail_in||0!==n.lookahead||t!==hie&&n.status!==Fie){let r=0===n.level?Wie(n,t):n.strategy===_ie?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Gie(e),0===e.lookahead)){if(t===hie)return 1;break}if(e.match_length=0,n=cie(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(jie(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===pie?(jie(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jie(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Sie?((e,t)=>{let n,r,i,a;const s=e.window;for(;;){if(e.lookahead<=Iie){if(Gie(e),e.lookahead<=Iie&&t===hie)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){a=e.strstart+Iie;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=Iie-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=cie(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=cie(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(jie(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===pie?(jie(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jie(e,!1),0===e.strm.avail_out)?1:2})(n,t):Yie[n.level].func(n,t);if(3!==r&&4!==r||(n.status=Fie),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),gie;if(2===r&&(t===die?uie(n):t!==fie&&(oie(n,0,0,!1),t===Aie&&(Pie(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Oie(e),0===e.avail_out))return n.last_flush=-1,gie}return t!==pie?gie:n.wrap<=0?mie:(2===n.wrap?(zie(n,255&e.adler),zie(n,e.adler>>8&255),zie(n,e.adler>>16&255),zie(n,e.adler>>24&255),zie(n,255&e.total_in),zie(n,e.total_in>>8&255),zie(n,e.total_in>>16&255),zie(n,e.total_in>>24&255)):(Hie(n,e.adler>>>16),Hie(n,65535&e.adler)),Oie(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?gie:mie)},rae=(e,t)=>{let n=t.length;if(Zie(e))return yie;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==Bie||r.lookahead)return yie;if(1===i&&(e.adler=tie(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Pie(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const a=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Gie(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=Die(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Gie(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=a,r.wrap=i,gie},iae={deflateInit:(e,t)=>tae(e,t,kie,15,8,Eie),deflateInit2:tae,deflateReset:eae,deflateResetKeep:$ie,deflateSetHeader:(e,t)=>Zie(e)||2!==e.state.wrap?yie:(e.state.gzhead=t,gie),deflate:nae,deflateEnd:e=>{if(Zie(e))return yie;const t=e.state.status;return e.state=null,t===Mie?Rie(e,vie):gie},deflateSetDictionary:rae,deflateInfo:"pako deflate (from Nodeca project)"};const aae=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var sae=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const t in n)aae(n,t)&&(e[t]=n[t])}}return e},oae=e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let t=e[r];n.set(t,i),i+=t.length}return n};let lae=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(TAe){lae=!1}const cae=new Uint8Array(256);for(let n=0;n<256;n++)cae[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;cae[254]=cae[254]=1;var uae=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296===(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)n=e.charCodeAt(i),55296===(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},hae=(e,t)=>{const n=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let s=cae[t];if(s>4)a[i++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&lae)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(a,i)},dae=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+cae[e[n]]>t?n:t};var Aae=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const pae=Object.prototype.toString,{Z_NO_FLUSH:fae,Z_SYNC_FLUSH:gae,Z_FULL_FLUSH:mae,Z_FINISH:yae,Z_OK:vae,Z_STREAM_END:bae,Z_DEFAULT_COMPRESSION:xae,Z_DEFAULT_STRATEGY:wae,Z_DEFLATED:_ae}=aie;function Sae(e){this.options=sae({level:xae,method:_ae,chunkSize:16384,windowBits:15,memLevel:8,strategy:wae},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Aae,this.strm.avail_out=0;let n=iae.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==vae)throw new Error(iie[n]);if(t.header&&iae.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?uae(t.dictionary):"[object ArrayBuffer]"===pae.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=iae.deflateSetDictionary(this.strm,e),n!==vae)throw new Error(iie[n]);this._dict_set=!0}}function Cae(e,t){const n=new Sae(t);if(n.push(e,!0),n.err)throw n.msg||iie[n.err];return n.result}Sae.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?yae:fae,"string"===typeof e?n.input=uae(e):"[object ArrayBuffer]"===pae.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===gae||a===mae)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=iae.deflate(n,a),i===bae)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=iae.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===vae;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Sae.prototype.onData=function(e){this.chunks.push(e)},Sae.prototype.onEnd=function(e){e===vae&&(this.result=oae(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Eae=function(e,t){return(t=t||{}).raw=!0,Cae(e,t)},Nae=function(e,t){return(t=t||{}).gzip=!0,Cae(e,t)},kae={Deflate:Sae,deflate:Cae,deflateRaw:Eae,gzip:Nae,constants:aie};const Iae=16209;var Tae=function(e,t){let n,r,i,a,s,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S,C;const E=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),i=e.next_out,C=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),o=E.dmax,l=E.wsize,c=E.whave,u=E.wnext,h=E.window,d=E.hold,A=E.bits,p=E.lencode,f=E.distcode,g=(1<<E.lenbits)-1,m=(1<<E.distbits)-1;e:do{A<15&&(d+=S[n++]<<A,A+=8,d+=S[n++]<<A,A+=8),y=p[d&g];t:for(;;){if(v=y>>>24,d>>>=v,A-=v,v=y>>>16&255,0===v)C[i++]=65535&y;else{if(!(16&v)){if(0===(64&v)){y=p[(65535&y)+(d&(1<<v)-1)];continue t}if(32&v){E.mode=16191;break e}e.msg="invalid literal/length code",E.mode=Iae;break e}b=65535&y,v&=15,v&&(A<v&&(d+=S[n++]<<A,A+=8),b+=d&(1<<v)-1,d>>>=v,A-=v),A<15&&(d+=S[n++]<<A,A+=8,d+=S[n++]<<A,A+=8),y=f[d&m];n:for(;;){if(v=y>>>24,d>>>=v,A-=v,v=y>>>16&255,!(16&v)){if(0===(64&v)){y=f[(65535&y)+(d&(1<<v)-1)];continue n}e.msg="invalid distance code",E.mode=Iae;break e}if(x=65535&y,v&=15,A<v&&(d+=S[n++]<<A,A+=8,A<v&&(d+=S[n++]<<A,A+=8)),x+=d&(1<<v)-1,x>o){e.msg="invalid distance too far back",E.mode=Iae;break e}if(d>>>=v,A-=v,v=i-a,x>v){if(v=x-v,v>c&&E.sane){e.msg="invalid distance too far back",E.mode=Iae;break e}if(w=0,_=h,0===u){if(w+=l-v,v<b){b-=v;do{C[i++]=h[w++]}while(--v);w=i-x,_=C}}else if(u<v){if(w+=l+u-v,v-=u,v<b){b-=v;do{C[i++]=h[w++]}while(--v);if(w=0,u<b){v=u,b-=v;do{C[i++]=h[w++]}while(--v);w=i-x,_=C}}}else if(w+=u-v,v<b){b-=v;do{C[i++]=h[w++]}while(--v);w=i-x,_=C}for(;b>2;)C[i++]=_[w++],C[i++]=_[w++],C[i++]=_[w++],b-=3;b&&(C[i++]=_[w++],b>1&&(C[i++]=_[w++]))}else{w=i-x;do{C[i++]=C[w++],C[i++]=C[w++],C[i++]=C[w++],b-=3}while(b>2);b&&(C[i++]=C[w++],b>1&&(C[i++]=C[w++]))}break}}break}}while(n<r&&i<s);b=A>>3,n-=b,A-=b<<3,d&=(1<<A)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),E.hold=d,E.bits=A};const Bae=15,Mae=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fae=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Rae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Lae=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Pae=(e,t,n,r,i,a,s,o)=>{const l=o.bits;let c,u,h,d,A,p,f=0,g=0,m=0,y=0,v=0,b=0,x=0,w=0,_=0,S=0,C=null;const E=new Uint16Array(16),N=new Uint16Array(16);let k,I,T,B=null;for(f=0;f<=Bae;f++)E[f]=0;for(g=0;g<r;g++)E[t[n+g]]++;for(v=l,y=Bae;y>=1&&0===E[y];y--);if(v>y&&(v=y),0===y)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(m=1;m<y&&0===E[m];m++);for(v<m&&(v=m),w=1,f=1;f<=Bae;f++)if(w<<=1,w-=E[f],w<0)return-1;if(w>0&&(0===e||1!==y))return-1;for(N[1]=0,f=1;f<Bae;f++)N[f+1]=N[f]+E[f];for(g=0;g<r;g++)0!==t[n+g]&&(s[N[t[n+g]]++]=g);if(0===e?(C=B=s,p=20):1===e?(C=Mae,B=Fae,p=257):(C=Rae,B=Lae,p=0),S=0,g=0,f=m,A=a,b=v,x=0,h=-1,_=1<<v,d=_-1,1===e&&_>852||2===e&&_>592)return 1;for(;;){k=f-x,s[g]+1<p?(I=0,T=s[g]):s[g]>=p?(I=B[s[g]-p],T=C[s[g]-p]):(I=96,T=0),c=1<<f-x,u=1<<b,m=u;do{u-=c,i[A+(S>>x)+u]=k<<24|I<<16|T}while(0!==u);for(c=1<<f-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,g++,0===--E[f]){if(f===y)break;f=t[n+s[g]]}if(f>v&&(S&d)!==h){for(0===x&&(x=v),A+=m,b=f-x,w=1<<b;b+x<y&&(w-=E[b+x],!(w<=0));)b++,w<<=1;if(_+=1<<b,1===e&&_>852||2===e&&_>592)return 1;h=S&d,i[h]=v<<24|b<<16|A-a}}return 0!==S&&(i[A+S]=f-x<<24|64<<16),o.bits=v,0};const{Z_FINISH:Uae,Z_BLOCK:Dae,Z_TREES:Oae,Z_OK:jae,Z_STREAM_END:zae,Z_NEED_DICT:Hae,Z_STREAM_ERROR:Qae,Z_DATA_ERROR:Vae,Z_MEM_ERROR:Gae,Z_BUF_ERROR:Wae,Z_DEFLATED:qae}=aie,Kae=16180,Xae=16190,Yae=16191,Jae=16192,Zae=16194,$ae=16199,ese=16200,tse=16206,nse=16209,rse=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function ise(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ase=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Kae||t.mode>16211?1:0},sse=e=>{if(ase(e))return Qae;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Kae,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,jae},ose=e=>{if(ase(e))return Qae;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,sse(e)},lse=(e,t)=>{let n;if(ase(e))return Qae;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Qae:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ose(e))},cse=(e,t)=>{if(!e)return Qae;const n=new ise;e.state=n,n.strm=e,n.window=null,n.mode=Kae;const r=lse(e,t);return r!==jae&&(e.state=null),r};let use,hse,dse=!0;const Ase=e=>{if(dse){use=new Int32Array(512),hse=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Pae(1,e.lens,0,288,use,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Pae(2,e.lens,0,32,hse,0,e.work,{bits:5}),dse=!1}e.lencode=use,e.lenbits=9,e.distcode=hse,e.distbits=5},pse=(e,t,n,r)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var fse=(e,t)=>{let n,r,i,a,s,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S=0;const C=new Uint8Array(4);let E,N;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ase(e)||!e.output||!e.input&&0!==e.avail_in)return Qae;n=e.state,n.mode===Yae&&(n.mode=Jae),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,h=o,d=l,_=jae;e:for(;;)switch(n.mode){case Kae:if(0===n.wrap){n.mode=Jae;break}for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&c,C[1]=c>>>8&255,n.check=rie(n.check,C,2,0),c=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=nse;break}if((15&c)!==qae){e.msg="unknown compression method",n.mode=nse;break}if(c>>>=4,u-=4,w=8+(15&c),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=nse;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Yae,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==qae){e.msg="unknown compression method",n.mode=nse;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=nse;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=rie(n.check,C,2,0)),c=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,n.check=rie(n.check,C,4,0)),c=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=rie(n.check,C,2,0)),c=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(C[0]=255&c,C[1]=c>>>8&255,n.check=rie(n.check,C,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(A=n.length,A>o&&(A=o),A&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+A),w)),512&n.flags&&4&n.wrap&&(n.check=rie(n.check,r,A,a)),o-=A,a+=A,n.length-=A),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;A=0;do{w=r[a+A++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&A<o);if(512&n.flags&&4&n.wrap&&(n.check=rie(n.check,r,A,a)),o-=A,a+=A,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;A=0;do{w=r[a+A++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&A<o);if(512&n.flags&&4&n.wrap&&(n.check=rie(n.check,r,A,a)),o-=A,a+=A,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=nse;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Yae;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}e.adler=n.check=rse(c),c=0,u=0,n.mode=Xae;case Xae:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,Hae;e.adler=n.check=1,n.mode=Yae;case Yae:if(t===Dae||t===Oae)break e;case Jae:if(n.last){c>>>=7&u,u-=7&u,n.mode=tse;break}for(;u<3;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}switch(n.last=1&c,c>>>=1,u-=1,3&c){case 0:n.mode=16193;break;case 1:if(Ase(n),n.mode=$ae,t===Oae){c>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=nse}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=nse;break}if(n.length=65535&c,c=0,u=0,n.mode=Zae,t===Oae)break e;case Zae:n.mode=16195;case 16195:if(A=n.length,A){if(A>o&&(A=o),A>l&&(A=l),0===A)break e;i.set(r.subarray(a,a+A),s),o-=A,a+=A,l-=A,s+=A,n.length-=A;break}n.mode=Yae;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=nse;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.lens[k[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},_=Pae(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,_){e.msg="invalid code lengths set",n.mode=nse;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[c&(1<<n.lenbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(y<16)c>>>=g,u-=g,n.lens[n.have++]=y;else{if(16===y){for(N=g+2;u<N;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=nse;break}w=n.lens[n.have-1],A=3+(3&c),c>>>=2,u-=2}else if(17===y){for(N=g+3;u<N;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=g,u-=g,w=0,A=3+(7&c),c>>>=3,u-=3}else{for(N=g+7;u<N;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=g,u-=g,w=0,A=11+(127&c),c>>>=7,u-=7}if(n.have+A>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=nse;break}for(;A--;)n.lens[n.have++]=w}}if(n.mode===nse)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=nse;break}if(n.lenbits=9,E={bits:n.lenbits},_=Pae(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,_){e.msg="invalid literal/lengths set",n.mode=nse;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},_=Pae(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,_){e.msg="invalid distances set",n.mode=nse;break}if(n.mode=$ae,t===Oae)break e;case $ae:n.mode=ese;case ese:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,Tae(e,d),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,c=n.hold,u=n.bits,n.mode===Yae&&(n.back=-1);break}for(n.back=0;S=n.lencode[c&(1<<n.lenbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(m&&0===(240&m)){for(v=g,b=m,x=y;S=n.lencode[x+((c&(1<<v+b)-1)>>v)],g=S>>>24,m=S>>>16&255,y=65535&S,!(v+g<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=g,u-=g,n.back+=g,n.length=y,0===m){n.mode=16205;break}if(32&m){n.back=-1,n.mode=Yae;break}if(64&m){e.msg="invalid literal/length code",n.mode=nse;break}n.extra=15&m,n.mode=16201;case 16201:if(n.extra){for(N=n.extra;u<N;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[c&(1<<n.distbits)-1],g=S>>>24,m=S>>>16&255,y=65535&S,!(g<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(0===(240&m)){for(v=g,b=m,x=y;S=n.distcode[x+((c&(1<<v+b)-1)>>v)],g=S>>>24,m=S>>>16&255,y=65535&S,!(v+g<=u);){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}c>>>=v,u-=v,n.back+=v}if(c>>>=g,u-=g,n.back+=g,64&m){e.msg="invalid distance code",n.mode=nse;break}n.offset=y,n.extra=15&m,n.mode=16203;case 16203:if(n.extra){for(N=n.extra;u<N;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=nse;break}n.mode=16204;case 16204:if(0===l)break e;if(A=d-l,n.offset>A){if(A=n.offset-A,A>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=nse;break}A>n.wnext?(A-=n.wnext,p=n.wsize-A):p=n.wnext-A,A>n.length&&(A=n.length),f=n.window}else f=i,p=s-n.offset,A=n.length;A>l&&(A=l),l-=A,n.length-=A;do{i[s++]=f[p++]}while(--A);0===n.length&&(n.mode=ese);break;case 16205:if(0===l)break e;i[s++]=n.length,l--,n.mode=ese;break;case tse:if(n.wrap){for(;u<32;){if(0===o)break e;o--,c|=r[a++]<<u,u+=8}if(d-=l,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?rie(n.check,i,d,s-d):tie(n.check,i,d,s-d)),d=l,4&n.wrap&&(n.flags?c:rse(c))!==n.check){e.msg="incorrect data check",n.mode=nse;break}c=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===o)break e;o--,c+=r[a++]<<u,u+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=nse;break}c=0,u=0}n.mode=16208;case 16208:_=zae;break e;case nse:_=Vae;break e;case 16210:return Gae;default:return Qae}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<nse&&(n.mode<tse||t!==Uae))&&pse(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?rie(n.check,i,d,e.next_out-d):tie(n.check,i,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Yae?128:0)+(n.mode===$ae||n.mode===Zae?256:0),(0===h&&0===d||t===Uae)&&_===jae&&(_=Wae),_},gse={inflateReset:ose,inflateReset2:lse,inflateResetKeep:sse,inflateInit:e=>cse(e,15),inflateInit2:cse,inflate:fse,inflateEnd:e=>{if(ase(e))return Qae;let t=e.state;return t.window&&(t.window=null),e.state=null,jae},inflateGetHeader:(e,t)=>{if(ase(e))return Qae;const n=e.state;return 0===(2&n.wrap)?Qae:(n.head=t,t.done=!1,jae)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,a;return ase(e)?Qae:(r=e.state,0!==r.wrap&&r.mode!==Xae?Qae:r.mode===Xae&&(i=1,i=tie(i,t,n,0),i!==r.check)?Vae:(a=pse(e,t,n,n),a?(r.mode=16210,Gae):(r.havedict=1,jae)))},inflateInfo:"pako inflate (from Nodeca project)"};var mse=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const yse=Object.prototype.toString,{Z_NO_FLUSH:vse,Z_FINISH:bse,Z_OK:xse,Z_STREAM_END:wse,Z_NEED_DICT:_se,Z_STREAM_ERROR:Sse,Z_DATA_ERROR:Cse,Z_MEM_ERROR:Ese}=aie;function Nse(e){this.options=sae({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Aae,this.strm.avail_out=0;let n=gse.inflateInit2(this.strm,t.windowBits);if(n!==xse)throw new Error(iie[n]);if(this.header=new mse,gse.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=uae(t.dictionary):"[object ArrayBuffer]"===yse.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=gse.inflateSetDictionary(this.strm,t.dictionary),n!==xse)))throw new Error(iie[n])}function kse(e,t){const n=new Nse(t);if(n.push(e),n.err)throw n.msg||iie[n.err];return n.result}Nse.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?bse:vse,"[object ArrayBuffer]"===yse.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=gse.inflate(n,s),a===_se&&i&&(a=gse.inflateSetDictionary(n,i),a===xse?a=gse.inflate(n,s):a===Cse&&(a=_se));n.avail_in>0&&a===wse&&n.state.wrap>0&&0!==e[n.next_in];)gse.inflateReset(n),a=gse.inflate(n,s);switch(a){case Sse:case Cse:case _se:case Ese:return this.onEnd(a),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||a===wse))if("string"===this.options.to){let e=dae(n.output,n.next_out),t=n.next_out-e,i=hae(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==xse||0!==o){if(a===wse)return a=gse.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Nse.prototype.onData=function(e){this.chunks.push(e)},Nse.prototype.onEnd=function(e){e===xse&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=oae(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ise=function(e,t){return(t=t||{}).raw=!0,kse(e,t)},Tse={Inflate:Nse,inflate:kse,inflateRaw:Ise,ungzip:kse,constants:aie};const{Deflate:Bse,deflate:Mse,deflateRaw:Fse,gzip:Rse}=kae,{Inflate:Lse,inflate:Pse,inflateRaw:Use,ungzip:Dse}=Tse;var Ose=Lse,jse=Pse;const zse=[];for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;zse[n]=e}const Hse=4294967295;function Qse(e,t){return(function(e,t,n){let r=e;for(let i=0;i<n;i++)r=zse[255&(r^t[i])]^r>>>8;return r}(Hse,e,t)^Hse)>>>0}function Vse(e,t,n){const r=e.readUint32(),i=Qse(new Uint8Array(e.buffer,e.byteOffset+e.offset-t-4,t),t);if(i!==r)throw new Error("CRC mismatch for chunk ".concat(n,". Expected ").concat(r,", found ").concat(i))}function Gse(e,t,n){for(let r=0;r<n;r++)t[r]=e[r]}function Wse(e,t,n,r){let i=0;for(;i<r;i++)t[i]=e[i];for(;i<n;i++)t[i]=e[i]+t[i-r]&255}function qse(e,t,n,r){let i=0;if(0===n.length)for(;i<r;i++)t[i]=e[i];else for(;i<r;i++)t[i]=e[i]+n[i]&255}function Kse(e,t,n,r,i){let a=0;if(0===n.length){for(;a<i;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+(t[a-i]>>1)&255}else{for(;a<i;a++)t[a]=e[a]+(n[a]>>1)&255;for(;a<r;a++)t[a]=e[a]+(t[a-i]+n[a]>>1)&255}}function Xse(e,t,n,r,i){let a=0;if(0===n.length){for(;a<i;a++)t[a]=e[a];for(;a<r;a++)t[a]=e[a]+t[a-i]&255}else{for(;a<i;a++)t[a]=e[a]+n[a]&255;for(;a<r;a++)t[a]=e[a]+Yse(t[a-i],n[a],n[a-i])&255}}function Yse(e,t,n){const r=e+t-n,i=Math.abs(r-e),a=Math.abs(r-t),s=Math.abs(r-n);return i<=a&&i<=s?e:a<=s?t:n}function Jse(e,t,n,r,i,a){switch(e){case 0:Gse(t,n,i);break;case 1:Wse(t,n,i,a);break;case 2:qse(t,n,r,i);break;case 3:Kse(t,n,r,i,a);break;case 4:Xse(t,n,r,i,a);break;default:throw new Error("Unsupported filter: ".concat(e))}}const Zse=new Uint16Array([255]),$se=255===new Uint8Array(Zse.buffer)[0];function eoe(e){return(255&e)<<8|e>>8&255}const toe=new Uint16Array([255]),noe=255===new Uint8Array(toe.buffer)[0],roe=new Uint8Array(0);function ioe(e){const{data:t,width:n,height:r,channels:i,depth:a}=e,s=Math.ceil(a/8)*i,o=Math.ceil(a/8*i*n),l=new Uint8Array(r*o);let c,u,h=roe,d=0;for(let A=0;A<r;A++){switch(c=t.subarray(d+1,d+1+o),u=l.subarray(A*o,(A+1)*o),t[d]){case 0:Gse(c,u,o);break;case 1:Wse(c,u,o,s);break;case 2:qse(c,u,h,o);break;case 3:Kse(c,u,h,o,s);break;case 4:Xse(c,u,h,o,s);break;default:throw new Error("Unsupported filter: ".concat(t[d]))}h=u,d+=o+1}if(16===a){const e=new Uint16Array(l.buffer);if(noe)for(let t=0;t<e.length;t++)e[t]=aoe(e[t]);return e}return l}function aoe(e){return(255&e)<<8|e>>8&255}const soe=Uint8Array.of(137,80,78,71,13,10,26,10);function ooe(e){if(!function(e){if(e.length<soe.length)return!1;for(let t=0;t<soe.length;t++)if(e[t]!==soe[t])return!1;return!0}(e.readBytes(soe.length)))throw new Error("wrong PNG signature")}const loe="tEXt",coe=new TextDecoder("latin1");function uoe(e){if(doe(e),0===e.length||e.length>79)throw new Error("keyword length must be between 1 and 79")}const hoe=/^[\u0000-\u00FF]*$/;function doe(e){if(!hoe.test(e))throw new Error("invalid latin1 text")}function Aoe(e,t,n){const r=poe(t);e[r]=function(e,t){return coe.decode(e.readBytes(t))}(t,n-r.length-1)}function poe(e){for(e.mark();0!==e.readByte(););const t=e.offset;e.reset();const n=coe.decode(e.readBytes(t-e.offset-1));return e.skip(1),uoe(n),n}const foe=-1,goe=0,moe=2,yoe=3,voe=4,boe=6,xoe=-1,woe=0,_oe=-1,Soe=0,Coe=-1,Eoe=0,Noe=1,koe=0,Ioe=1,Toe=2,Boe=0,Moe=1;class Foe extends Are{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e),(0,T.A)(this,"_checkCrc",void 0),(0,T.A)(this,"_inflator",void 0),(0,T.A)(this,"_png",void 0),(0,T.A)(this,"_apng",void 0),(0,T.A)(this,"_end",void 0),(0,T.A)(this,"_hasPalette",void 0),(0,T.A)(this,"_palette",void 0),(0,T.A)(this,"_hasTransparency",void 0),(0,T.A)(this,"_transparency",void 0),(0,T.A)(this,"_compressionMethod",void 0),(0,T.A)(this,"_filterMethod",void 0),(0,T.A)(this,"_interlaceMethod",void 0),(0,T.A)(this,"_colorType",void 0),(0,T.A)(this,"_isAnimated",void 0),(0,T.A)(this,"_numberOfFrames",void 0),(0,T.A)(this,"_numberOfPlays",void 0),(0,T.A)(this,"_frames",void 0),(0,T.A)(this,"_writingDataChunks",void 0);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new Ose,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=xoe,this._filterMethod=_oe,this._interlaceMethod=Coe,this._colorType=foe,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(ooe(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(ooe(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case loe:Aoe(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e)}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Vse(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch("fdAT"!==t&&"IDAT"!==t&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e}if(this.offset-n!==e)throw new Error("Length mismatch while decoding chunk ".concat(t));this._checkCrc?Vse(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(e){if(1!==e&&2!==e&&4!==e&&8!==e&&16!==e)throw new Error("invalid bit depth: ".concat(e));return e}(this.readUint8());const t=this.readUint8();let n;switch(this._colorType=t,t){case goe:n=1;break;case moe:n=3;break;case yoe:n=1;break;case voe:n=2;break;case boe:n=4;break;default:throw new Error("Unknown color type: ".concat(t))}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==woe)throw new Error("Unsupported compression method: ".concat(this._compressionMethod));this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError("PLTE field length must be a multiple of 3. Got ".concat(e));const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));this.skip(e)}decodetRNS(e){switch(this._colorType){case goe:case moe:if(e%2!==0)throw new RangeError("tRNS chunk length must be a multiple of 2. Got ".concat(e));if(e/2>this._png.width*this._png.height)throw new Error("tRNS chunk contains more alpha values than there are pixels (".concat(e/2," vs ").concat(this._png.width*this._png.height,")"));this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break;case yoe:{if(e>this._palette.length)throw new Error("tRNS chunk contains more alpha values than there are palette colors (".concat(e," vs ").concat(this._palette.length,")"));let t=0;for(;t<e;t++){const e=this.readByte();this._palette[t].push(e)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}default:throw new Error("tRNS chunk is not supported for color type ".concat(this._colorType))}}decodeiCCP(e){const t=poe(this),n=this.readUint8();if(n!==woe)throw new Error("Unsupported iCCP compression method: ".concat(n));const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:jse(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=ioe({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===e||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case koe:break;case Ioe:for(let t=0;t<this._png.height;t++)for(let r=0;r<this._png.width;r++){const i=(t*e.width+r)*this._png.channels;for(let e=0;e<this._png.channels;e++)n.data[i+e]=0}break;case Toe:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(e,n)=>({index:((e+t.yOffset)*this._png.width+t.xOffset+n)*this._png.channels,frameIndex:(e*t.width+n)*this._png.channels});switch(t.blendOp){case Boe:for(let n=0;n<t.height;n++)for(let i=0;i<t.width;i++){const{index:a,frameIndex:s}=r(n,i);for(let n=0;n<this._png.channels;n++)e.data[a+n]=t.data[s+n]}break;case Moe:for(let i=0;i<t.height;i++)for(let a=0;a<t.width;a++){const{index:s,frameIndex:o}=r(i,a);for(let r=0;r<this._png.channels;r++){const i=t.data[o+this._png.channels-1]/n,a=r%(this._png.channels-1)===0?1:t.data[o+r],l=Math.floor(i*a+(1-i)*e.data[s+r]);e.data[s+r]+=l}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var e;if(this._inflator.err)throw new Error("Error while decompressing the data: ".concat(this._inflator.err));const t=this._isAnimated?(null===(e=this._frames)||void 0===e?void 0:e.at(0)).data:this._inflator.result;if(this._filterMethod!==Soe)throw new Error("Filter method ".concat(this._filterMethod," not supported"));if(this._interlaceMethod===Eoe)this._png.data=ioe({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else{if(this._interlaceMethod!==Noe)throw new Error("Interlace method ".concat(this._interlaceMethod," not supported"));this._png.data=function(e){const{data:t,width:n,height:r,channels:i,depth:a}=e,s=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(a/8)*i,l=new Uint8Array(r*n*o);let c=0;for(let u=0;u<7;u++){const e=s[u],i=Math.ceil((n-e.x)/e.xStep),a=Math.ceil((r-e.y)/e.yStep);if(i<=0||a<=0)continue;const h=i*o,d=new Uint8Array(h);for(let s=0;s<a;s++){const a=t[c++],u=t.subarray(c,c+h);c+=h;const A=new Uint8Array(h);Jse(a,u,A,d,h,o),d.set(A);for(let t=0;t<i;t++){const i=e.x+t*e.xStep,a=e.y+s*e.yStep;if(!(i>=n||a>=r))for(let e=0;e<o;e++)l[(a*n+i)*o+e]=A[t*o+e]}}}if(16===a){const e=new Uint16Array(l.buffer);if($se)for(let t=0;t<e.length;t++)e[t]=eoe(e[t]);return e}return l}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth})}this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:koe,blendOp:Boe,data:e}),this._inflator=new Ose,this._writingDataChunks=!1}}var Roe;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.METRE=1]="METRE"}(Roe||(Roe={}));var Loe=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function Poe(){Loe.console&&"function"==typeof Loe.console.log&&Loe.console.log.apply(Loe.console,arguments)}var Uoe={log:Poe,warn:function(e){Loe.console&&("function"==typeof Loe.console.warn?Loe.console.warn.apply(Loe.console,arguments):Poe.call(null,arguments))},error:function(e){Loe.console&&("function"==typeof Loe.console.error?Loe.console.error.apply(Loe.console,arguments):Poe(e))}};function Doe(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){zoe(r.response,t,n)},r.onerror=function(){Uoe.error("could not download file")},r.send()}function Ooe(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(n){}return t.status>=200&&t.status<=299}function joe(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var zoe=Loe.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,xne.A)(window))||window!==Loe?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=Loe.URL||Loe.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin!==location.origin?Ooe(i.href)?Doe(e,t,n):joe(i,i.target="_blank"):joe(i)):(i.href=r.createObjectURL(e),setTimeout(function(){r.revokeObjectURL(i.href)},4e4),setTimeout(function(){joe(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(Ooe(e))Doe(e,t,n);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout(function(){joe(r)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,xne.A)(t)&&(Uoe.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return Doe(e,t,n);var i="application/octet-stream"===e.type,a=/constructor/i.test(Loe.HTMLElement)||Loe.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||i&&a)&&"object"===("undefined"==typeof FileReader?"undefined":(0,xne.A)(FileReader))){var o=new FileReader;o.onloadend=function(){var e=o.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},o.readAsDataURL(e)}else{var l=Loe.URL||Loe.webkitURL,c=l.createObjectURL(e);r?r.location=c:location.href=c,r=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function Hoe(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<n.length;r++){var i=n[r].re,a=n[r].process,s=i.exec(e);s&&(t=a(s),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}}var Qoe=Loe.atob.bind(Loe),Voe=Loe.btoa.bind(Loe);function Goe(e,t){var n=e[0],r=e[1],i=e[2],a=e[3];n=qoe(n,r,i,a,t[0],7,-680876936),a=qoe(a,n,r,i,t[1],12,-389564586),i=qoe(i,a,n,r,t[2],17,606105819),r=qoe(r,i,a,n,t[3],22,-1044525330),n=qoe(n,r,i,a,t[4],7,-176418897),a=qoe(a,n,r,i,t[5],12,1200080426),i=qoe(i,a,n,r,t[6],17,-1473231341),r=qoe(r,i,a,n,t[7],22,-45705983),n=qoe(n,r,i,a,t[8],7,1770035416),a=qoe(a,n,r,i,t[9],12,-1958414417),i=qoe(i,a,n,r,t[10],17,-42063),r=qoe(r,i,a,n,t[11],22,-1990404162),n=qoe(n,r,i,a,t[12],7,1804603682),a=qoe(a,n,r,i,t[13],12,-40341101),i=qoe(i,a,n,r,t[14],17,-1502002290),n=Koe(n,r=qoe(r,i,a,n,t[15],22,1236535329),i,a,t[1],5,-165796510),a=Koe(a,n,r,i,t[6],9,-1069501632),i=Koe(i,a,n,r,t[11],14,643717713),r=Koe(r,i,a,n,t[0],20,-373897302),n=Koe(n,r,i,a,t[5],5,-701558691),a=Koe(a,n,r,i,t[10],9,38016083),i=Koe(i,a,n,r,t[15],14,-660478335),r=Koe(r,i,a,n,t[4],20,-405537848),n=Koe(n,r,i,a,t[9],5,568446438),a=Koe(a,n,r,i,t[14],9,-1019803690),i=Koe(i,a,n,r,t[3],14,-187363961),r=Koe(r,i,a,n,t[8],20,1163531501),n=Koe(n,r,i,a,t[13],5,-1444681467),a=Koe(a,n,r,i,t[2],9,-51403784),i=Koe(i,a,n,r,t[7],14,1735328473),n=Xoe(n,r=Koe(r,i,a,n,t[12],20,-1926607734),i,a,t[5],4,-378558),a=Xoe(a,n,r,i,t[8],11,-2022574463),i=Xoe(i,a,n,r,t[11],16,1839030562),r=Xoe(r,i,a,n,t[14],23,-35309556),n=Xoe(n,r,i,a,t[1],4,-1530992060),a=Xoe(a,n,r,i,t[4],11,1272893353),i=Xoe(i,a,n,r,t[7],16,-155497632),r=Xoe(r,i,a,n,t[10],23,-1094730640),n=Xoe(n,r,i,a,t[13],4,681279174),a=Xoe(a,n,r,i,t[0],11,-358537222),i=Xoe(i,a,n,r,t[3],16,-722521979),r=Xoe(r,i,a,n,t[6],23,76029189),n=Xoe(n,r,i,a,t[9],4,-640364487),a=Xoe(a,n,r,i,t[12],11,-421815835),i=Xoe(i,a,n,r,t[15],16,530742520),n=Yoe(n,r=Xoe(r,i,a,n,t[2],23,-995338651),i,a,t[0],6,-198630844),a=Yoe(a,n,r,i,t[7],10,1126891415),i=Yoe(i,a,n,r,t[14],15,-1416354905),r=Yoe(r,i,a,n,t[5],21,-57434055),n=Yoe(n,r,i,a,t[12],6,1700485571),a=Yoe(a,n,r,i,t[3],10,-1894986606),i=Yoe(i,a,n,r,t[10],15,-1051523),r=Yoe(r,i,a,n,t[1],21,-2054922799),n=Yoe(n,r,i,a,t[8],6,1873313359),a=Yoe(a,n,r,i,t[15],10,-30611744),i=Yoe(i,a,n,r,t[6],15,-1560198380),r=Yoe(r,i,a,n,t[13],21,1309151649),n=Yoe(n,r,i,a,t[4],6,-145523070),a=Yoe(a,n,r,i,t[11],10,-1120210379),i=Yoe(i,a,n,r,t[2],15,718787259),r=Yoe(r,i,a,n,t[9],21,-343485551),e[0]=ile(n,e[0]),e[1]=ile(r,e[1]),e[2]=ile(i,e[2]),e[3]=ile(a,e[3])}function Woe(e,t,n,r,i,a){return t=ile(ile(t,e),ile(r,a)),ile(t<<i|t>>>32-i,n)}function qoe(e,t,n,r,i,a,s){return Woe(t&n|~t&r,e,t,i,a,s)}function Koe(e,t,n,r,i,a,s){return Woe(t&r|n&~r,e,t,i,a,s)}function Xoe(e,t,n,r,i,a,s){return Woe(t^n^r,e,t,i,a,s)}function Yoe(e,t,n,r,i,a,s){return Woe(n^(t|~r),e,t,i,a,s)}function Joe(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)Goe(r,Zoe(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(Goe(r,i),t=0;t<16;t++)i[t]=0;return i[14]=8*n,Goe(r,i),r}function Zoe(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var $oe="0123456789abcdef".split("");function ele(e){for(var t="",n=0;n<4;n++)t+=$oe[e>>8*n+4&15]+$oe[e>>8*n&15];return t}function tle(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function nle(e){return Joe(e).map(tle).join("")}var rle="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=ele(e[t]);return e.join("")}(Joe("hello"));function ile(e,t){if(rle){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}return e+t&4294967295}function ale(e,t){var n,r,i,a;if(e!==n){for(var s=(i=e,a=1+(256/e.length|0),new Array(a+1).join(i)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var u=o[l];c=(c+u+s.charCodeAt(l))%256,o[l]=o[c],o[c]=u}n=e,r=o}else o=r;var h=t.length,d=0,A=0,p="";for(l=0;l<h;l++)A=(A+(u=o[d=(d+1)%256]))%256,o[d]=o[A],o[A]=u,s=o[(o[d]+o[A])%256],p+=String.fromCharCode(t.charCodeAt(l)^s);return p}var sle={print:4,modify:8,copy:16,"annot-forms":32};function ole(e,t,n,r){this.v=1,this.r=2;var i=192;e.forEach(function(e){if(void 0!==sle.perm)throw new Error("Invalid permission: "+e);i+=sle[e]}),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var a=(t+this.padding).substr(0,32),s=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,s),this.P=-(1+(255^i)),this.encryptionKey=nle(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=ale(this.encryptionKey,this.padding)}function lle(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",n=e.length,r=0;r<n;r++){var i=e.charCodeAt(r);t+=i<33||35===i||37===i||40===i||41===i||47===i||60===i||62===i||91===i||93===i||123===i||125===i||i>126?"#"+("0"+i.toString(16)).slice(-2):e[r]}return t}function cle(e){if("object"!==(0,xne.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,r){if(r=r||!1,"string"!=typeof e||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var i=Math.random().toString(35);return t[e][i]=[n,!!r],i},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],0===Object.keys(t[n]).length&&delete t[n],!0;return!1},this.publish=function(n){if(t.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),i=[];for(var a in t[n]){var s=t[n][a];try{s[0].apply(e,r)}catch(joe){Loe.console&&Uoe.error("jsPDF PubSub Error",joe.message,joe)}s[1]&&i.push(a)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function ule(e){if(!(this instanceof ule))return new ule(e);var t="opacity,stroke-opacity".split(",");for(var n in e)e.hasOwnProperty(n)&&t.indexOf(n)>=0&&(this[n]=e[n]);this.id="",this.objectNumber=-1}function hle(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function dle(e,t,n,r,i){if(!(this instanceof dle))return new dle(e,t,n,r,i);this.type="axial"===e?2:3,this.coords=t,this.colors=n,hle.call(this,r,i)}function Ale(e,t,n,r,i){if(!(this instanceof Ale))return new Ale(e,t,n,r,i);this.boundingBox=e,this.xStep=t,this.yStep=n,this.stream="",this.cloneIndex=0,hle.call(this,r,i)}function ple(e){var t,n="string"==typeof arguments[0]?arguments[0]:"p",r=arguments[1],i=arguments[2],a=arguments[3],s=[],o=1,l=16,c="S",u=null;"object"===(0,xne.A)(e=e||{})&&(n=e.orientation,r=e.unit||r,i=e.format||i,a=e.compress||e.compressPdf||a,null!==(u=e.encryption||null)&&(u.userPassword=u.userPassword||"",u.ownerPassword=u.ownerPassword||"",u.userPermissions=u.userPermissions||[]),o="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(l=e.floatPrecision),c=e.defaultPathOperation||"S"),s=e.filters||(!0===a?["FlateEncode"]:s),r=r||"mm",n=(""+(n||"P")).toLowerCase();var h=e.putOnlyUsedFonts||!1,d={},A={internal:{},__private__:{}};A.__private__.PubSub=cle;var p="1.3",f=A.__private__.getPdfVersion=function(){return p};A.__private__.setPdfVersion=function(e){p=e};var g={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};A.__private__.getPageFormats=function(){return g};var m=A.__private__.getPageFormat=function(e){return g[e]};i=i||"a4";var y="compat",v="advanced",b=y;function x(){this.saveGraphicsState(),J(new Be(de,0,0,-de,0,An()*de).toString()+" cm"),this.setFontSize(this.getFontSize()/de),c="n",b=v}function w(){this.restoreGraphicsState(),c="S",b=y}var _=A.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};A.advancedAPI=function(e){var t=b===y;return t&&x.call(this),"function"!=typeof e||(e(this),t&&w.call(this)),this},A.compatAPI=function(e){var t=b===v;return t&&w.call(this),"function"!=typeof e||(e(this),t&&x.call(this)),this},A.isAdvancedAPI=function(){return b===v};var S,C=function(e){if(b!==v)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},E=A.roundToPrecision=A.__private__.roundToPrecision=function(e,n){var r=t||n;if(isNaN(e)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(r).replace(/0+$/,"")};S=A.hpf=A.__private__.hpf="number"==typeof l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,l)}:"smart"===l?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return E(e,16)};var N=A.f2=A.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return E(e,2)},k=A.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return E(e,3)},I=A.scale=A.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return b===y?e*de:b===v?e:void 0},T=function(e){return I(function(e){return b===y?An()-e:b===v?e:void 0}(e))};A.__private__.setPrecision=A.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var B,M="00000000000000000000000000000000",F=A.__private__.getFileId=function(){return M},R=A.__private__.setFileId=function(e){return M=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():M.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),null!==u&&(yt=new ole(u.userPermissions,u.userPassword,u.ownerPassword,M)),M};A.setFileId=function(e){return R(e),this},A.getFileId=function(){return F()};var L=A.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),n=t<0?"+":"-",r=Math.floor(Math.abs(t/60)),i=Math.abs(t%60),a=[n,j(r),"'",j(i),"'"].join("");return["D:",e.getFullYear(),j(e.getMonth()+1),j(e.getDate()),j(e.getHours()),j(e.getMinutes()),j(e.getSeconds()),a].join("")},P=A.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),n=parseInt(e.substr(6,2),10)-1,r=parseInt(e.substr(8,2),10),i=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),s=parseInt(e.substr(14,2),10);return new Date(t,n,r,i,a,s,0)},U=A.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=L(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return B=t},D=A.__private__.getCreationDate=function(e){var t=B;return"jsDate"===e&&(t=P(B)),t};A.setCreationDate=function(e){return U(e),this},A.getCreationDate=function(e){return D(e)};var O,j=A.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},z=A.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},H=0,Q=[],V=[],G=0,W=[],q=[],K=!1,X=V;A.__private__.setCustomOutputDestination=function(e){K=!0,X=e};var Y=function(e){K||(X=e)};A.__private__.resetCustomOutputDestination=function(){K=!1,X=V};var J=A.__private__.out=function(e){return e=e.toString(),G+=e.length+1,X.push(e),X},Z=A.__private__.write=function(e){return J(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},$=A.__private__.getArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);t--;)r[t]=e.charCodeAt(t);return n},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];A.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;A.__private__.setFontSize=A.setFontSize=function(e){return te=b===v?e/de:e,this};var ne,re=A.__private__.getFontSize=A.getFontSize=function(){return b===y?te:te*de},ie=e.R2L||!1;A.__private__.setR2L=A.setR2L=function(e){return ie=e,this},A.__private__.getR2L=A.getR2L=function(){return ie};var ae,se=A.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ne=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ne=e}else ne=parseInt(e,10)};A.__private__.getZoomMode=function(){return ne};var oe,le=A.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');ae=e};A.__private__.getPageMode=function(){return ae};var ce=A.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');oe=e};A.__private__.getLayoutMode=function(){return oe},A.__private__.setDisplayMode=A.setDisplayMode=function(e,t,n){return se(e),ce(t),le(n),this};var ue={title:"",subject:"",author:"",keywords:"",creator:""};A.__private__.getDocumentProperty=function(e){if(-1===Object.keys(ue).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ue[e]},A.__private__.getDocumentProperties=function(){return ue},A.__private__.setDocumentProperties=A.setProperties=A.setDocumentProperties=function(e){for(var t in ue)ue.hasOwnProperty(t)&&e[t]&&(ue[t]=e[t]);return this},A.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(ue).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ue[e]=t};var he,de,Ae,pe,fe,ge={},me={},ye=[],ve={},be={},xe={},we={},_e=null,Se=0,Ce=[],Ee=new cle(A),Ne=e.hotfixes||[],ke={},Ie={},Te=[],Be=function e(t,n,r,i,a,s){if(!(this instanceof e))return new e(t,n,r,i,a,s);isNaN(t)&&(t=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(i)&&(i=1),isNaN(a)&&(a=0),isNaN(s)&&(s=0),this._matrix=[t,n,r,i,a,s]};Object.defineProperty(Be.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Be.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Be.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Be.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Be.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Be.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Be.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Be.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Be.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Be.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Be.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Be.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Be.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Be.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Be.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Be.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Be.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(S).join(e)},Be.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,n=e.sx*this.shy+e.shy*this.sy,r=e.shx*this.sx+e.sy*this.shx,i=e.shx*this.shy+e.sy*this.sy,a=e.tx*this.sx+e.ty*this.shx+this.tx,s=e.tx*this.shy+e.ty*this.sy+this.ty;return new Be(t,n,r,i,a,s)},Be.prototype.decompose=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,s=Math.sqrt(e*e+t*t),o=(e/=s)*n+(t/=s)*r;n-=e*o,r-=t*o;var l=Math.sqrt(n*n+r*r);return o/=l,e*(r/=l)<t*(n/=l)&&(e=-e,t=-t,o=-o,s=-s),{scale:new Be(s,0,0,l,0,0),translate:new Be(1,0,0,1,i,a),rotate:new Be(e,t,-t,e,0,0),skew:new Be(1,0,o,1,0,0)}},Be.prototype.toString=function(e){return this.join(" ")},Be.prototype.inversed=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,s=1/(e*r-t*n),o=r*s,l=-t*s,c=-n*s,u=e*s;return new Be(o,l,c,u,-o*i-c*a,-l*i-u*a)},Be.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,n=e.x*this.shy+e.y*this.sy+this.ty;return new tn(t,n)},Be.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),n=this.applyToPoint(new tn(e.x+e.w,e.y+e.h));return new nn(t.x,t.y,n.x-t.x,n.y-t.y)},Be.prototype.clone=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty;return new Be(e,t,n,r,i,a)},A.Matrix=Be;var Me=A.matrixMult=function(e,t){return t.multiply(e)},Fe=new Be(1,0,0,1,0,0);A.unitMatrix=A.identityMatrix=Fe;var Re=function(e,t){if(!be[e]){var n=(t instanceof dle?"Sh":"P")+(Object.keys(ve).length+1).toString(10);t.id=n,be[e]=n,ve[n]=t,Ee.publish("addPattern",t)}};A.ShadingPattern=dle,A.TilingPattern=Ale,A.addShadingPattern=function(e,t){return C("addShadingPattern()"),Re(e,t),this},A.beginTilingPattern=function(e){C("beginTilingPattern()"),an(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},A.endTilingPattern=function(e,t){C("endTilingPattern()"),t.stream=q[O].join("\n"),Re(e,t),Ee.publish("endTilingPattern",t),Te.pop().restore()};var Le,Pe=A.__private__.newObject=function(){var e=Ue();return De(e,!0),e},Ue=A.__private__.newObjectDeferred=function(){return H++,Q[H]=function(){return G},H},De=function(e,t){return t="boolean"==typeof t&&t,Q[e]=G,t&&J(e+" 0 obj"),e},Oe=A.__private__.newAdditionalObject=function(){var e={objId:Ue(),content:""};return W.push(e),e},je=Ue(),ze=Ue(),He=A.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var n=parseFloat(t[0]);t=[n,n,n,"r"]}for(var r="#",i=0;i<3;i++)r+=("0"+Math.floor(255*parseFloat(t[i])).toString(16)).slice(-2);return r},Qe=A.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var n=e.ch1,r=e.ch2,i=e.ch3,a=e.ch4,s="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var o=new Hoe(n);if(o.ok)n=o.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var l=parseInt(n.substr(1),16);n=l>>16&255,r=l>>8&255,i=255&l}if(void 0===r||void 0===a&&n===r&&r===i)t="string"==typeof n?n+" "+s[0]:2===e.precision?N(n/255)+" "+s[0]:k(n/255)+" "+s[0];else if(void 0===a||"object"===(0,xne.A)(a)){if(a&&!isNaN(a.a)&&0===a.a)return["1.","1.","1.",s[1]].join(" ");t="string"==typeof n?[n,r,i,s[1]].join(" "):2===e.precision?[N(n/255),N(r/255),N(i/255),s[1]].join(" "):[k(n/255),k(r/255),k(i/255),s[1]].join(" ")}else t="string"==typeof n?[n,r,i,a,s[2]].join(" "):2===e.precision?[N(n),N(r),N(i),N(a),s[2]].join(" "):[k(n),k(r),k(i),k(a),s[2]].join(" ");return t},Ve=A.__private__.getFilters=function(){return s},Ge=A.__private__.putStream=function(e){var t=(e=e||{}).data||"",n=e.filters||Ve(),r=e.alreadyAppliedFilters||[],i=e.addLength1||!1,a=t.length,s=e.objectId,o=function(e){return e};if(null!==u&&void 0===s)throw new Error("ObjectId must be passed to putStream for file encryption");null!==u&&(o=yt.encryptor(s,0));var l={};!0===n&&(n=["FlateEncode"]);var c=e.additionalKeyValues||[],h=(l=void 0!==ple.API.processDataByFilters?ple.API.processDataByFilters(t,n):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==l.data.length&&(c.push({key:"Length",value:l.data.length}),!0===i&&c.push({key:"Length1",value:a})),0!=h.length)if(h.split("/").length-1==1)c.push({key:"Filter",value:h});else{c.push({key:"Filter",value:"["+h+"]"});for(var d=0;d<c.length;d+=1)if("DecodeParms"===c[d].key){for(var A=[],p=0;p<l.reverseChain.split("/").length-1;p+=1)A.push("null");A.push(c[d].value),c[d].value="["+A.join(" ")+"]"}}J("<<");for(var f=0;f<c.length;f++)J("/"+c[f].key+" "+c[f].value);J(">>"),0!==l.data.length&&(J("stream"),J(o(l.data)),J("endstream"))},We=A.__private__.putPage=function(e){var t=e.number,n=e.data,r=e.objId,i=e.contentsObjId;De(r,!0),J("<</Type /Page"),J("/Parent "+e.rootDictionaryObjId+" 0 R"),J("/Resources "+e.resourceDictionaryObjId+" 0 R"),J("/MediaBox ["+parseFloat(S(e.mediaBox.bottomLeftX))+" "+parseFloat(S(e.mediaBox.bottomLeftY))+" "+S(e.mediaBox.topRightX)+" "+S(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&J("/CropBox ["+S(e.cropBox.bottomLeftX)+" "+S(e.cropBox.bottomLeftY)+" "+S(e.cropBox.topRightX)+" "+S(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&J("/BleedBox ["+S(e.bleedBox.bottomLeftX)+" "+S(e.bleedBox.bottomLeftY)+" "+S(e.bleedBox.topRightX)+" "+S(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&J("/TrimBox ["+S(e.trimBox.bottomLeftX)+" "+S(e.trimBox.bottomLeftY)+" "+S(e.trimBox.topRightX)+" "+S(e.trimBox.topRightY)+"]"),null!==e.artBox&&J("/ArtBox ["+S(e.artBox.bottomLeftX)+" "+S(e.artBox.bottomLeftY)+" "+S(e.artBox.topRightX)+" "+S(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&J("/UserUnit "+e.userUnit),Ee.publish("putPage",{objId:r,pageContext:Ce[t],pageNumber:t,page:n}),J("/Contents "+i+" 0 R"),J(">>"),J("endobj");var a=n.join("\n");return b===v&&(a+="\nQ"),De(i,!0),Ge({data:a,filters:Ve(),objectId:i}),J("endobj"),r},qe=A.__private__.putPages=function(){var e,t,n=[];for(e=1;e<=Se;e++)Ce[e].objId=Ue(),Ce[e].contentsObjId=Ue();for(e=1;e<=Se;e++)n.push(We({number:e,data:q[e],objId:Ce[e].objId,contentsObjId:Ce[e].contentsObjId,mediaBox:Ce[e].mediaBox,cropBox:Ce[e].cropBox,bleedBox:Ce[e].bleedBox,trimBox:Ce[e].trimBox,artBox:Ce[e].artBox,userUnit:Ce[e].userUnit,rootDictionaryObjId:je,resourceDictionaryObjId:ze}));De(je,!0),J("<</Type /Pages");var r="/Kids [";for(t=0;t<Se;t++)r+=n[t]+" 0 R ";J(r+"]"),J("/Count "+Se),J(">>"),J("endobj"),Ee.publish("postPutPages")},Ke=function(e){Ee.publish("putFont",{font:e,out:J,newObject:Pe,putStream:Ge}),!0!==e.isAlreadyPutted&&(e.objectNumber=Pe(),J("<<"),J("/Type /Font"),J("/BaseFont /"+lle(e.postScriptName)),J("/Subtype /Type1"),"string"==typeof e.encoding&&J("/Encoding /"+e.encoding),J("/FirstChar 32"),J("/LastChar 255"),J(">>"),J("endobj"))},Xe=function(e){e.objectNumber=Pe();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[S(e.x),S(e.y),S(e.x+e.width),S(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var n=e.pages[1].join("\n");Ge({data:n,additionalKeyValues:t,objectId:e.objectNumber}),J("endobj")},Ye=function(e,t){t||(t=21);var n=Pe(),r=function(e,t){var n,r=[],i=1/(t-1);for(n=0;n<1;n+=i)r.push(n);if(r.push(1),0!=e[0].offset){var a={offset:0,color:e[0].color};e.unshift(a)}if(1!=e[e.length-1].offset){var s={offset:1,color:e[e.length-1].color};e.push(s)}for(var o="",l=0,c=0;c<r.length;c++){for(n=r[c];n>e[l+1].offset;)l++;var u=e[l].offset,h=(n-u)/(e[l+1].offset-u),d=e[l].color,A=e[l+1].color;o+=z(Math.round((1-h)*d[0]+h*A[0]).toString(16))+z(Math.round((1-h)*d[1]+h*A[1]).toString(16))+z(Math.round((1-h)*d[2]+h*A[2]).toString(16))}return o.trim()}(e.colors,t),i=[];i.push({key:"FunctionType",value:"0"}),i.push({key:"Domain",value:"[0.0 1.0]"}),i.push({key:"Size",value:"["+t+"]"}),i.push({key:"BitsPerSample",value:"8"}),i.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),i.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ge({data:r,additionalKeyValues:i,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),J("endobj"),e.objectNumber=Pe(),J("<< /ShadingType "+e.type),J("/ColorSpace /DeviceRGB");var a="/Coords ["+S(parseFloat(e.coords[0]))+" "+S(parseFloat(e.coords[1]))+" ";2===e.type?a+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3])):a+=S(parseFloat(e.coords[2]))+" "+S(parseFloat(e.coords[3]))+" "+S(parseFloat(e.coords[4]))+" "+S(parseFloat(e.coords[5])),J(a+="]"),e.matrix&&J("/Matrix ["+e.matrix.toString()+"]"),J("/Function "+n+" 0 R"),J("/Extend [true true]"),J(">>"),J("endobj")},Je=function(e,t){var n=Ue(),r=Pe();t.push({resourcesOid:n,objectOid:r}),e.objectNumber=r;var i=[];i.push({key:"Type",value:"/Pattern"}),i.push({key:"PatternType",value:"1"}),i.push({key:"PaintType",value:"1"}),i.push({key:"TilingType",value:"1"}),i.push({key:"BBox",value:"["+e.boundingBox.map(S).join(" ")+"]"}),i.push({key:"XStep",value:S(e.xStep)}),i.push({key:"YStep",value:S(e.yStep)}),i.push({key:"Resources",value:n+" 0 R"}),e.matrix&&i.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),Ge({data:e.stream,additionalKeyValues:i,objectId:e.objectNumber}),J("endobj")},Ze=function(e){for(var t in e.objectNumber=Pe(),J("<<"),e)switch(t){case"opacity":J("/ca "+N(e[t]));break;case"stroke-opacity":J("/CA "+N(e[t]))}J(">>"),J("endobj")},$e=function(e){De(e.resourcesOid,!0),J("<<"),J("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in J("/Font <<"),ge)ge.hasOwnProperty(e)&&(!1===h||!0===h&&d.hasOwnProperty(e))&&J("/"+e+" "+ge[e].objectNumber+" 0 R");J(">>")}(),function(){if(Object.keys(ve).length>0){for(var e in J("/Shading <<"),ve)ve.hasOwnProperty(e)&&ve[e]instanceof dle&&ve[e].objectNumber>=0&&J("/"+e+" "+ve[e].objectNumber+" 0 R");Ee.publish("putShadingPatternDict"),J(">>")}}(),function(e){if(Object.keys(ve).length>0){for(var t in J("/Pattern <<"),ve)ve.hasOwnProperty(t)&&ve[t]instanceof A.TilingPattern&&ve[t].objectNumber>=0&&ve[t].objectNumber<e&&J("/"+t+" "+ve[t].objectNumber+" 0 R");Ee.publish("putTilingPatternDict"),J(">>")}}(e.objectOid),function(){if(Object.keys(xe).length>0){var e;for(e in J("/ExtGState <<"),xe)xe.hasOwnProperty(e)&&xe[e].objectNumber>=0&&J("/"+e+" "+xe[e].objectNumber+" 0 R");Ee.publish("putGStateDict"),J(">>")}}(),function(){for(var e in J("/XObject <<"),ke)ke.hasOwnProperty(e)&&ke[e].objectNumber>=0&&J("/"+e+" "+ke[e].objectNumber+" 0 R");Ee.publish("putXobjectDict"),J(">>")}(),J(">>"),J("endobj")},et=function(e){me[e.fontName]=me[e.fontName]||{},me[e.fontName][e.fontStyle]=e.id},tt=function(e,t,n,r,i){var a={id:"F"+(Object.keys(ge).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:n,encoding:r,isStandardFont:i||!1,metadata:{}};return Ee.publish("addFont",{font:a,instance:this}),ge[a.id]=a,et(a),a.id},nt=A.__private__.pdfEscape=A.pdfEscape=function(e,t){return function(e,t){var n,r,i,a,s,o,l,c,u;if(i=(t=t||{}).sourceEncoding||"Unicode",s=t.outputEncoding,(t.autoencode||s)&&ge[he].metadata&&ge[he].metadata[i]&&ge[he].metadata[i].encoding&&(a=ge[he].metadata[i].encoding,!s&&ge[he].encoding&&(s=ge[he].encoding),!s&&a.codePages&&(s=a.codePages[0]),"string"==typeof s&&(s=a[s]),s)){for(l=!1,o=[],n=0,r=e.length;n<r;n++)(c=s[e.charCodeAt(n)])?o.push(String.fromCharCode(c)):o.push(e[n]),o[n].charCodeAt(0)>>8&&(l=!0);e=o.join("")}for(n=e.length;void 0===l&&0!==n;)e.charCodeAt(n-1)>>8&&(l=!0),n--;if(!l)return e;for(o=t.noBOM?[]:[254,255],n=0,r=e.length;n<r;n++){if((u=(c=e.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");o.push(u),o.push(c-(u<<8))}return String.fromCharCode.apply(void 0,o)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},rt=A.__private__.beginPage=function(e){q[++Se]=[],Ce[Se]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},st(Se),Y(q[O])},it=function(e,t){var r,a,s;switch(n=t||n,"string"==typeof e&&(r=m(e.toLowerCase()),Array.isArray(r)&&(a=r[0],s=r[1])),Array.isArray(e)&&(a=e[0]*de,s=e[1]*de),isNaN(a)&&(a=i[0],s=i[1]),(a>14400||s>14400)&&(Uoe.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),a=Math.min(14400,a),s=Math.min(14400,s)),i=[a,s],n.substr(0,1)){case"l":s>a&&(i=[s,a]);break;case"p":a>s&&(i=[s,a])}rt(i),Dt(Pt),J(Wt),0!==Zt&&J(Zt+" J"),0!==$t&&J($t+" j"),Ee.publish("addPage",{pageNumber:Se})},at=function(e){e>0&&e<=Se&&(q.splice(e,1),Ce.splice(e,1),Se--,O>Se&&(O=Se),this.setPage(O))},st=function(e){e>0&&e<=Se&&(O=e)},ot=A.__private__.getNumberOfPages=A.getNumberOfPages=function(){return q.length-1},lt=function(e,t,n){var r,i=void 0;return n=n||{},e=void 0!==e?e:ge[he].fontName,t=void 0!==t?t:ge[he].fontStyle,r=e.toLowerCase(),void 0!==me[r]&&void 0!==me[r][t]?i=me[r][t]:void 0!==me[e]&&void 0!==me[e][t]?i=me[e][t]:!1===n.disableWarning&&Uoe.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),i||n.noFallback||null==(i=me.times[t])&&(i=me.times.normal),i},ct=A.__private__.putInfo=function(){var e=Pe(),t=function(e){return e};for(var n in null!==u&&(t=yt.encryptor(e,0)),J("<<"),J("/Producer ("+nt(t("jsPDF "+ple.version))+")"),ue)ue.hasOwnProperty(n)&&ue[n]&&J("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+nt(t(ue[n]))+")");J("/CreationDate ("+nt(t(B))+")"),J(">>"),J("endobj")},ut=A.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||je;switch(Pe(),J("<<"),J("/Type /Catalog"),J("/Pages "+t+" 0 R"),ne||(ne="fullwidth"),ne){case"fullwidth":J("/OpenAction [3 0 R /FitH null]");break;case"fullheight":J("/OpenAction [3 0 R /FitV null]");break;case"fullpage":J("/OpenAction [3 0 R /Fit]");break;case"original":J("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+ne;"%"===n.substr(n.length-1)&&(ne=parseInt(ne)/100),"number"==typeof ne&&J("/OpenAction [3 0 R /XYZ null null "+N(ne)+"]")}switch(oe||(oe="continuous"),oe){case"continuous":J("/PageLayout /OneColumn");break;case"single":J("/PageLayout /SinglePage");break;case"two":case"twoleft":J("/PageLayout /TwoColumnLeft");break;case"tworight":J("/PageLayout /TwoColumnRight")}ae&&J("/PageMode /"+ae),Ee.publish("putCatalog"),J(">>"),J("endobj")},ht=A.__private__.putTrailer=function(){J("trailer"),J("<<"),J("/Size "+(H+1)),J("/Root "+H+" 0 R"),J("/Info "+(H-1)+" 0 R"),null!==u&&J("/Encrypt "+yt.oid+" 0 R"),J("/ID [ <"+M+"> <"+M+"> ]"),J(">>")},dt=A.__private__.putHeader=function(){J("%PDF-"+p),J("%\xba\xdf\xac\xe0")},At=A.__private__.putXRef=function(){var e="0000000000";J("xref"),J("0 "+(H+1)),J("0000000000 65535 f ");for(var t=1;t<=H;t++)"function"==typeof Q[t]?J((e+Q[t]()).slice(-10)+" 00000 n "):void 0!==Q[t]?J((e+Q[t]).slice(-10)+" 00000 n "):J("0000000000 00000 n ")},pt=A.__private__.buildDocument=function(){var e;H=0,G=0,V=[],Q=[],W=[],je=Ue(),ze=Ue(),Y(V),Ee.publish("buildDocument"),dt(),qe(),function(){Ee.publish("putAdditionalObjects");for(var e=0;e<W.length;e++){var t=W[e];De(t.objId,!0),J(t.content),J("endobj")}Ee.publish("postPutAdditionalObjects")}(),e=[],function(){for(var e in ge)ge.hasOwnProperty(e)&&(!1===h||!0===h&&d.hasOwnProperty(e))&&Ke(ge[e])}(),function(){var e;for(e in xe)xe.hasOwnProperty(e)&&Ze(xe[e])}(),function(){for(var e in ke)ke.hasOwnProperty(e)&&Xe(ke[e])}(),function(e){var t;for(t in ve)ve.hasOwnProperty(t)&&(ve[t]instanceof dle?Ye(ve[t]):ve[t]instanceof Ale&&Je(ve[t],e))}(e),Ee.publish("putResources"),e.forEach($e),$e({resourcesOid:ze,objectOid:Number.MAX_SAFE_INTEGER}),Ee.publish("postPutResources"),null!==u&&(yt.oid=Pe(),J("<<"),J("/Filter /Standard"),J("/V "+yt.v),J("/R "+yt.r),J("/U <"+yt.toHexString(yt.U)+">"),J("/O <"+yt.toHexString(yt.O)+">"),J("/P "+yt.P),J(">>"),J("endobj")),ct(),ut();var t=G;return At(),ht(),J("startxref"),J(""+t),J("%%EOF"),Y(q[O]),V.join("\n")},ft=A.__private__.getBlob=function(e){return new Blob([$(e)],{type:"application/pdf"})},gt=A.output=A.__private__.output=(Le=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return pt();case"save":A.save(t.filename);break;case"arraybuffer":return $(pt());case"blob":return ft(pt());case"bloburi":case"bloburl":if(void 0!==Loe.URL&&"function"==typeof Loe.URL.createObjectURL)return Loe.URL&&Loe.URL.createObjectURL(ft(pt()))||void 0;Uoe.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=pt();try{n=Voe(r)}catch(u){n=Voe(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+t.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(Loe)){var i="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",a=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(i=t.pdfObjectUrl,a="");var s='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+i+'"'+a+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",o=Loe.open();return null!==o&&o.document.write(s),o}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(Loe)){var l='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',c=Loe.open();if(null!==c){c.document.write(l);var h=this;c.document.documentElement.querySelector("#pdfViewer").onload=function(){c.document.title=t.filename,c.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(h.output("bloburl"))}}return c}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(Loe))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var d='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',p=Loe.open();if(null!==p&&(p.document.write(d),p.document.title=t.filename),p||"undefined"==typeof safari)return p;break;case"datauri":case"dataurl":return Loe.document.location.href=this.output("datauristring",t);default:return null}},Le.foo=function(){try{return Le.apply(this,arguments)}catch(t){var e=t.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var n="Error in function "+e.split("\n")[0].split("<")[0]+": "+t.message;if(!Loe.console)throw new Error(n);Loe.console.error(n,t),Loe.alert&&alert(n)}},Le.foo.bar=Le,Le.foo),mt=function(e){return!0===Array.isArray(Ne)&&Ne.indexOf(e)>-1};switch(r){case"pt":de=1;break;case"mm":de=72/25.4;break;case"cm":de=72/2.54;break;case"in":de=72;break;case"px":de=1==mt("px_scaling")?.75:96/72;break;case"pc":case"em":de=12;break;case"ex":de=6;break;default:if("number"!=typeof r)throw new Error("Invalid unit: "+r);de=r}var yt=null;U(),R();var vt=A.__private__.getPageInfo=A.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ce[e].objId,pageNumber:e,pageContext:Ce[e]}},bt=A.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in Ce)if(Ce[t].objId===e)break;return vt(t)},xt=A.__private__.getCurrentPageInfo=A.getCurrentPageInfo=function(){return{objId:Ce[O].objId,pageNumber:O,pageContext:Ce[O]}};A.addPage=function(){return it.apply(this,arguments),this},A.setPage=function(){return st.apply(this,arguments),Y.call(this,q[O]),this},A.insertPage=function(e){return this.addPage(),this.movePage(O,e),this},A.movePage=function(e,t){var n,r;if(e>t){n=q[e],r=Ce[e];for(var i=e;i>t;i--)q[i]=q[i-1],Ce[i]=Ce[i-1];q[t]=n,Ce[t]=r,this.setPage(t)}else if(e<t){n=q[e],r=Ce[e];for(var a=e;a<t;a++)q[a]=q[a+1],Ce[a]=Ce[a+1];q[t]=n,Ce[t]=r,this.setPage(t)}return this},A.deletePage=function(){return at.apply(this,arguments),this},A.__private__.text=A.text=function(e,t,n,r,i){var a,s,o,l,c,u,h,A,p,f=(r=r||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof n||Array.isArray(n))){var g=n;n=t,t=e,e=g}if(arguments[3]instanceof Be==0?(o=arguments[4],l=arguments[5],"object"===(0,xne.A)(h=arguments[3])&&null!==h||("string"==typeof o&&(l=o,o=null),"string"==typeof h&&(l=h,h=null),"number"==typeof h&&(o=h,h=null),r={flags:h,angle:o,align:l})):(C("The transform parameter of text() with a Matrix value"),p=i),isNaN(t)||isNaN(n)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return f;var m,y="",x="number"==typeof r.lineHeightFactor?r.lineHeightFactor:Lt,w=f.internal.scaleFactor;function _(e){return e=e.split("\t").join(Array(r.TabLen||9).join(" ")),nt(e,h)}function E(e){for(var t,n=e.concat(),r=[],i=n.length;i--;)"string"==typeof(t=n.shift())?r.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?r.push(t[0]):r.push([t[0],t[1],t[2]]);return r}function N(e,t){var n;if("string"==typeof e)n=t(e)[0];else if(Array.isArray(e)){for(var r,i,a=e.concat(),s=[],o=a.length;o--;)"string"==typeof(r=a.shift())?s.push(t(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(i=t(r[0],r[1],r[2]),s.push([i[0],i[1],i[2]]));n=s}return n}var k=!1,T=!0;if("string"==typeof e)k=!0;else if(Array.isArray(e)){var B=e.concat();s=[];for(var M,F=B.length;F--;)("string"!=typeof(M=B.shift())||Array.isArray(M)&&"string"!=typeof M[0])&&(T=!1);k=T}if(!1===k)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var R=te/f.internal.scaleFactor,L=R*(x-1);switch(r.baseline){case"bottom":n-=L;break;case"top":n+=R-L;break;case"hanging":n+=R-2*L;break;case"middle":n+=R/2-L}if((u=r.maxWidth||0)>0&&("string"==typeof e?e=f.splitTextToSize(e,u):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(f.splitTextToSize(t,u))},[]))),a={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:he,fonts:ge,activeFontSize:te}},Ee.publish("preProcessText",a),e=a.text,o=(r=a.options).angle,p instanceof Be==0&&o&&"number"==typeof o){o*=Math.PI/180,0===r.rotationDirection&&(o=-o),b===v&&(o=-o);var P=Math.cos(o),U=Math.sin(o);p=new Be(P,U,-U,P,0,0)}else o&&o instanceof Be&&(p=o);b!==v||p||(p=Fe),void 0!==(c=r.charSpace||Yt)&&(y+=S(I(c))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(A=r.horizontalScale)&&(y+=S(100*A)+" Tz\n"),r.lang;var D=-1,O=void 0!==r.renderingMode?r.renderingMode:r.stroke,j=f.internal.getCurrentPageInfo().pageContext;switch(O){case 0:case!1:case"fill":D=0;break;case 1:case!0:case"stroke":D=1;break;case 2:case"fillThenStroke":D=2;break;case 3:case"invisible":D=3;break;case 4:case"fillAndAddForClipping":D=4;break;case 5:case"strokeAndAddPathForClipping":D=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":D=6;break;case 7:case"addToPathForClipping":D=7}var z=void 0!==j.usedRenderingMode?j.usedRenderingMode:-1;-1!==D?y+=D+" Tr\n":-1!==z&&(y+="0 Tr\n"),-1!==D&&(j.usedRenderingMode=D),l=r.align||"left";var H,Q=te*x,V=f.internal.pageSize.getWidth(),G=ge[he];c=r.charSpace||Yt,u=r.maxWidth||0,h=Object.assign({autoencode:!0,noBOM:!0},r.flags);var W=[],q=function(e){return f.getStringUnitWidth(e,{font:G,charSpace:c,fontSize:te,doKerning:!1})*te/w};if("[object Array]"===Object.prototype.toString.call(e)){var K;s=E(e),"left"!==l&&(H=s.map(q));var X,Y=0;if("right"===l){t-=H[0],e=[],F=s.length;for(var Z=0;Z<F;Z++)0===Z?(X=Ht(t),K=Qt(n)):(X=I(Y-H[Z]),K=-Q),e.push([s[Z],X,K]),Y=H[Z]}else if("center"===l){t-=H[0]/2,e=[],F=s.length;for(var $=0;$<F;$++)0===$?(X=Ht(t),K=Qt(n)):(X=I((Y-H[$])/2),K=-Q),e.push([s[$],X,K]),Y=H[$]}else if("left"===l){e=[],F=s.length;for(var ee=0;ee<F;ee++)e.push(s[ee])}else if("justify"===l&&"Identity-H"===G.encoding){e=[],F=s.length,u=0!==u?u:V;for(var ne=0,re=0;re<F;re++)if(K=0===re?Qt(n):-Q,X=0===re?Ht(t):ne,re<F-1){var ae=I((u-H[re])/(s[re].split(" ").length-1)),se=s[re].split(" ");e.push([se[0]+" ",X,K]),ne=0;for(var oe=1;oe<se.length;oe++){var le=(q(se[oe-1]+" "+se[oe])-q(se[oe]))*w+ae;oe==se.length-1?e.push([se[oe],le,0]):e.push([se[oe]+" ",le,0]),ne-=le}}else e.push([s[re],X,K]);e.push(["",ne,0])}else{if("justify"!==l)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],F=s.length,u=0!==u?u:V,re=0;re<F;re++){K=0===re?Qt(n):-Q,X=0===re?Ht(t):0;var ce=s[re].split(" ").length-1,ue=ce>0?(u-H[re])/ce:0;re<F-1?W.push(S(I(ue))):W.push(0),e.push([s[re],X,K])}}}!0===("boolean"==typeof r.R2L?r.R2L:ie)&&(e=N(e,function(e,t,n){return[e.split("").reverse().join(""),t,n]})),a={text:e,x:t,y:n,options:r,mutex:{pdfEscape:nt,activeFontKey:he,fonts:ge,activeFontSize:te}},Ee.publish("postProcessText",a),e=a.text,m=a.mutex.isHex||!1;var de=ge[he].encoding;"WinAnsiEncoding"!==de&&"StandardEncoding"!==de||(e=N(e,function(e,t,n){return[_(e),t,n]})),s=E(e),e=[];for(var Ae,pe,fe,me=Array.isArray(s[0])?1:0,ye="",ve=function(e,t,n){var i="";return n instanceof Be?(n="number"==typeof r.angle?Me(n,new Be(1,0,0,1,e,t)):Me(new Be(1,0,0,1,e,t),n),b===v&&(n=Me(new Be(1,0,0,-1,0,0),n)),i=n.join(" ")+" Tm\n"):i=S(e)+" "+S(t)+" Td\n",i},be=0;be<s.length;be++){switch(ye="",me){case 1:fe=(m?"<":"(")+s[be][0]+(m?">":")"),Ae=parseFloat(s[be][1]),pe=parseFloat(s[be][2]);break;case 0:fe=(m?"<":"(")+s[be]+(m?">":")"),Ae=Ht(t),pe=Qt(n)}void 0!==W&&void 0!==W[be]&&(ye=W[be]+" Tw\n"),0===be?e.push(ye+ve(Ae,pe,p)+fe):0===me?e.push(ye+fe):1===me&&e.push(ye+ve(Ae,pe,p)+fe)}e=0===me?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var xe="BT\n/";return xe+=he+" "+te+" Tf\n",xe+=S(te*x)+" TL\n",xe+=Kt+"\n",xe+=y,xe+=e,J(xe+="ET"),d[he]=!0,f};var wt=A.__private__.clip=A.clip=function(e){return J("evenodd"===e?"W*":"W"),this};A.clipEvenOdd=function(){return wt("evenodd")},A.__private__.discardPath=A.discardPath=function(){return J("n"),this};var _t=A.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};A.__private__.setDefaultPathOperation=A.setDefaultPathOperation=function(e){return _t(e)&&(c=e),this};var St=A.__private__.getStyle=A.getStyle=function(e){var t=c;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},Ct=A.close=function(){return J("h"),this};A.stroke=function(){return J("S"),this},A.fill=function(e){return Et("f",e),this},A.fillEvenOdd=function(e){return Et("f*",e),this},A.fillStroke=function(e){return Et("B",e),this},A.fillStrokeEvenOdd=function(e){return Et("B*",e),this};var Et=function(e,t){"object"===(0,xne.A)(t)?It(t,e):J(e)},Nt=function(e){null===e||b===v&&void 0===e||(e=St(e),J(e))};function kt(e,t,n,r,i){var a=new Ale(t||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,i||this.matrix);a.stream=this.stream;var s=e+"$$"+this.cloneIndex+++"$$";return Re(s,a),a}var It=function(e,t){var n=be[e.key],r=ve[n];if(r instanceof dle)J("q"),J(Tt(t)),r.gState&&A.setGState(r.gState),J(e.matrix.toString()+" cm"),J("/"+n+" sh"),J("Q");else if(r instanceof Ale){var i=new Be(1,0,0,-1,0,An());e.matrix&&(i=i.multiply(e.matrix||Fe),n=kt.call(r,e.key,e.boundingBox,e.xStep,e.yStep,i).id),J("q"),J("/Pattern cs"),J("/"+n+" scn"),r.gState&&A.setGState(r.gState),J(t),J("Q")}},Tt=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Bt=A.moveTo=function(e,t){return J(S(I(e))+" "+S(T(t))+" m"),this},Mt=A.lineTo=function(e,t){return J(S(I(e))+" "+S(T(t))+" l"),this},Ft=A.curveTo=function(e,t,n,r,i,a){return J([S(I(e)),S(T(t)),S(I(n)),S(T(r)),S(I(i)),S(T(a)),"c"].join(" ")),this};A.__private__.line=A.line=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(i))throw new Error("Invalid arguments passed to jsPDF.line");return b===y?this.lines([[n-e,r-t]],e,t,[1,1],i||"S"):this.lines([[n-e,r-t]],e,t,[1,1]).stroke()},A.__private__.lines=A.lines=function(e,t,n,r,i,a){var s,o,l,c,u,h,d,A,p,f,g,m;if("number"==typeof e&&(m=n,n=t,t=e,e=m),r=r||[1,1],a=a||!1,isNaN(t)||isNaN(n)||!Array.isArray(e)||!Array.isArray(r)||!_t(i)||"boolean"!=typeof a)throw new Error("Invalid arguments passed to jsPDF.lines");for(Bt(t,n),s=r[0],o=r[1],c=e.length,f=t,g=n,l=0;l<c;l++)2===(u=e[l]).length?(f=u[0]*s+f,g=u[1]*o+g,Mt(f,g)):(h=u[0]*s+f,d=u[1]*o+g,A=u[2]*s+f,p=u[3]*o+g,f=u[4]*s+f,g=u[5]*o+g,Ft(h,d,A,p,f,g));return a&&Ct(),Nt(i),this},A.path=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.c;switch(n.op){case"m":Bt(r[0],r[1]);break;case"l":Mt(r[0],r[1]);break;case"c":Ft.apply(this,r);break;case"h":Ct()}}return this},A.__private__.rect=A.rect=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(i))throw new Error("Invalid arguments passed to jsPDF.rect");return b===y&&(r=-r),J([S(I(e)),S(T(t)),S(I(n)),S(I(r)),"re"].join(" ")),Nt(i),this},A.__private__.triangle=A.triangle=function(e,t,n,r,i,a,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!_t(s))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-e,r-t],[i-n,a-r],[e-i,t-a]],e,t,[1,1],s,!0),this},A.__private__.roundedRect=A.roundedRect=function(e,t,n,r,i,a,s){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!_t(s))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var o=4/3*(Math.SQRT2-1);return i=Math.min(i,.5*n),a=Math.min(a,.5*r),this.lines([[n-2*i,0],[i*o,0,i,a-a*o,i,a],[0,r-2*a],[0,a*o,-i*o,a,-i,a],[2*i-n,0],[-i*o,0,-i,-a*o,-i,-a],[0,2*a-r],[0,-a*o,i*o,-a,i,-a]],e+i,t,[1,1],s,!0),this},A.__private__.ellipse=A.ellipse=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!_t(i))throw new Error("Invalid arguments passed to jsPDF.ellipse");var a=4/3*(Math.SQRT2-1)*n,s=4/3*(Math.SQRT2-1)*r;return Bt(e+n,t),Ft(e+n,t-s,e+a,t-r,e,t-r),Ft(e-a,t-r,e-n,t-s,e-n,t),Ft(e-n,t+s,e-a,t+r,e,t+r),Ft(e+a,t+r,e+n,t+s,e+n,t),Nt(i),this},A.__private__.circle=A.circle=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||!_t(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,n,n,r)},A.setFont=function(e,t,n){return n&&(t=_(t,n)),he=lt(e,t,{disableWarning:!1}),this};var Rt=A.__private__.getFont=A.getFont=function(){return ge[lt.apply(A,arguments)]};A.__private__.getFontList=A.getFontList=function(){var e,t,n={};for(e in me)if(me.hasOwnProperty(e))for(t in n[e]=[],me[e])me[e].hasOwnProperty(t)&&n[e].push(t);return n},A.addFont=function(e,t,n,r,i){var a=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==a.indexOf(arguments[3])?i=arguments[3]:arguments[3]&&-1==a.indexOf(arguments[3])&&(n=_(n,r)),tt.call(this,e,t,n,i=i||"Identity-H")};var Lt,Pt=e.lineWidth||.200025,Ut=A.__private__.getLineWidth=A.getLineWidth=function(){return Pt},Dt=A.__private__.setLineWidth=A.setLineWidth=function(e){return Pt=e,J(S(I(e))+" w"),this};A.__private__.setLineDash=ple.API.setLineDash=ple.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map(function(e){return S(I(e))}).join(" "),t=S(I(t)),J("["+e+"] "+t+" d"),this};var Ot=A.__private__.getLineHeight=A.getLineHeight=function(){return te*Lt};A.__private__.getLineHeight=A.getLineHeight=function(){return te*Lt};var jt=A.__private__.setLineHeightFactor=A.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Lt=e),this},zt=A.__private__.getLineHeightFactor=A.getLineHeightFactor=function(){return Lt};jt(e.lineHeight);var Ht=A.__private__.getHorizontalCoordinate=function(e){return I(e)},Qt=A.__private__.getVerticalCoordinate=function(e){return b===v?e:Ce[O].mediaBox.topRightY-Ce[O].mediaBox.bottomLeftY-I(e)},Vt=A.__private__.getHorizontalCoordinateString=A.getHorizontalCoordinateString=function(e){return S(Ht(e))},Gt=A.__private__.getVerticalCoordinateString=A.getVerticalCoordinateString=function(e){return S(Qt(e))},Wt=e.strokeColor||"0 G";A.__private__.getStrokeColor=A.getDrawColor=function(){return He(Wt)},A.__private__.setStrokeColor=A.setDrawColor=function(e,t,n,r){return Wt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),J(Wt),this};var qt=e.fillColor||"0 g";A.__private__.getFillColor=A.getFillColor=function(){return He(qt)},A.__private__.setFillColor=A.setFillColor=function(e,t,n,r){return qt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),J(qt),this};var Kt=e.textColor||"0 g",Xt=A.__private__.getTextColor=A.getTextColor=function(){return He(Kt)};A.__private__.setTextColor=A.setTextColor=function(e,t,n,r){return Kt=Qe({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var Yt=e.charSpace,Jt=A.__private__.getCharSpace=A.getCharSpace=function(){return parseFloat(Yt||0)};A.__private__.setCharSpace=A.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Yt=e,this};var Zt=0;A.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},A.__private__.setLineCap=A.setLineCap=function(e){var t=A.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Zt=t,J(t+" J"),this};var $t=0;A.__private__.setLineJoin=A.setLineJoin=function(e){var t=A.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $t=t,J(t+" j"),this},A.__private__.setLineMiterLimit=A.__private__.setMiterLimit=A.setLineMiterLimit=A.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return J(S(I(e))+" M"),this},A.GState=ule,A.setGState=function(e){(e="string"==typeof e?xe[we[e]]:en(null,e)).equals(_e)||(J("/"+e.id+" gs"),_e=e)};var en=function(e,t){if(!e||!we[e]){var n=!1;for(var r in xe)if(xe.hasOwnProperty(r)&&xe[r].equals(t)){n=!0;break}if(n)t=xe[r];else{var i="GS"+(Object.keys(xe).length+1).toString(10);xe[i]=t,t.id=i}return e&&(we[e]=t.id),Ee.publish("addGState",t),t}};A.addGState=function(e,t){return en(e,t),this},A.saveGraphicsState=function(){return J("q"),ye.push({key:he,size:te,color:Kt}),this},A.restoreGraphicsState=function(){J("Q");var e=ye.pop();return he=e.key,te=e.size,Kt=e.color,_e=null,this},A.setCurrentTransformationMatrix=function(e){return J(e.toString()+" cm"),this},A.comment=function(e){return J("#"+e),this};var tn=function(e,t){var n=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var r=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var i="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return i},set:function(e){i=e.toString()}}),this},nn=function(e,t,n,r){tn.call(this,e,t),this.type="rect";var i=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}});var a=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}}),this},rn=function(){this.page=Se,this.currentPage=O,this.pages=q.slice(0),this.pagesContext=Ce.slice(0),this.x=Ae,this.y=pe,this.matrix=fe,this.width=on(O),this.height=cn(O),this.outputDestination=X,this.id="",this.objectNumber=-1};rn.prototype.restore=function(){Se=this.page,O=this.currentPage,Ce=this.pagesContext,q=this.pages,Ae=this.x,pe=this.y,fe=this.matrix,ln(O,this.width),un(O,this.height),X=this.outputDestination};var an=function(e,t,n,r,i){Te.push(new rn),Se=O=0,q=[],Ae=e,pe=t,fe=i,rt([n,r])};for(var sn in A.beginFormObject=function(e,t,n,r,i){return an(e,t,n,r,i),this},A.endFormObject=function(e){return function(e){if(Ie[e])Te.pop().restore();else{var t=new rn,n="Xo"+(Object.keys(ke).length+1).toString(10);t.id=n,Ie[e]=n,ke[n]=t,Ee.publish("addFormObject",t),Te.pop().restore()}}(e),this},A.doFormObject=function(e,t){var n=ke[Ie[e]];return J("q"),J(t.toString()+" cm"),J("/"+n.id+" Do"),J("Q"),this},A.getFormObject=function(e){var t=ke[Ie[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},A.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(zoe(ft(pt()),e),"function"==typeof zoe.unload&&Loe.setTimeout&&setTimeout(zoe.unload,911),this):new Promise(function(t,n){try{var i=zoe(ft(pt()),e);"function"==typeof zoe.unload&&Loe.setTimeout&&setTimeout(zoe.unload,911),t(i)}catch(r){n(r.message)}})},ple.API)ple.API.hasOwnProperty(sn)&&("events"===sn&&ple.API.events.length?function(e,t){var n,r,i;for(i=t.length-1;-1!==i;i--)n=t[i][0],r=t[i][1],e.subscribe.apply(e,[n].concat("function"==typeof r?[r]:r))}(Ee,ple.API.events):A[sn]=ple.API[sn]);function on(e){return Ce[e].mediaBox.topRightX-Ce[e].mediaBox.bottomLeftX}function ln(e,t){Ce[e].mediaBox.topRightX=t+Ce[e].mediaBox.bottomLeftX}function cn(e){return Ce[e].mediaBox.topRightY-Ce[e].mediaBox.bottomLeftY}function un(e,t){Ce[e].mediaBox.topRightY=t+Ce[e].mediaBox.bottomLeftY}var hn=A.getPageWidth=function(e){return on(e=e||O)/de},dn=A.setPageWidth=function(e,t){ln(e,t*de)},An=A.getPageHeight=function(e){return cn(e=e||O)/de},pn=A.setPageHeight=function(e,t){un(e,t*de)};return A.internal={pdfEscape:nt,getStyle:St,getFont:Rt,getFontSize:re,getCharSpace:Jt,getTextColor:Xt,getLineHeight:Ot,getLineHeightFactor:zt,getLineWidth:Ut,write:Z,getHorizontalCoordinate:Ht,getVerticalCoordinate:Qt,getCoordinateString:Vt,getVerticalCoordinateString:Gt,collections:{},newObject:Pe,newAdditionalObject:Oe,newObjectDeferred:Ue,newObjectDeferredBegin:De,getFilters:Ve,putStream:Ge,events:Ee,scaleFactor:de,pageSize:{getWidth:function(){return hn(O)},setWidth:function(e){dn(O,e)},getHeight:function(){return An(O)},setHeight:function(e){pn(O,e)}},encryptionOptions:u,encryption:yt,getEncryptor:function(e){return null!==u?yt.encryptor(e,0):function(e){return e}},output:gt,getNumberOfPages:ot,pages:q,out:J,f2:N,f3:k,getPageInfo:vt,getPageInfoByObjId:bt,getCurrentPageInfo:xt,getPDFVersion:f,Point:tn,Rectangle:nn,Matrix:Be,hasHotfix:mt},Object.defineProperty(A.internal.pageSize,"width",{get:function(){return hn(O)},set:function(e){dn(O,e)},enumerable:!0,configurable:!0}),Object.defineProperty(A.internal.pageSize,"height",{get:function(){return An(O)},set:function(e){pn(O,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,n=ee.length;t<n;t++){var r=tt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===h&&(d[r]=!0);var i=e[t][0].split("-");et({id:r,fontName:i[0],fontStyle:i[1]||""})}Ee.publish("addFonts",{fonts:ge,dictionary:me})}.call(A,ee),he="F1",it(i,n),Ee.publish("initialized"),A}ole.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},ole.prototype.toHexString=function(e){return e.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ole.prototype.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(String.fromCharCode(parseInt(e.substr(n,2),16)));return t.join("")},ole.prototype.processOwnerPassword=function(e,t){return ale(nle(t).substr(0,5),e)},ole.prototype.encryptor=function(e,t){var n=nle(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return ale(n,e)}},ule.prototype.equals=function(e){var t,n="id,objectNumber,equals";if(!e||(0,xne.A)(e)!==(0,xne.A)(this))return!1;var r=0;for(t in this)if(!(n.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;r++}for(t in e)e.hasOwnProperty(t)&&n.indexOf(t)<0&&r--;return 0===r},ple.API={events:[]},ple.version="3.0.3";var fle=ple.API,gle=1,mle=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},yle=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},vle=function(e){return e.toFixed(2)},ble=function(e){return e.toFixed(5)};fle.__acroform__={};var xle=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},wle=function(e){return e*gle},_le=function(e){var t=new Ole,n=$le.internal.getHeight(e)||0,r=$le.internal.getWidth(e)||0;return t.BBox=[0,0,Number(vle(r)),Number(vle(n))],t},Sle=fle.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},Cle=fle.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},Ele=fle.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},Nle=fle.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Ele(e,t-1)},kle=fle.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Sle(e,t-1)},Ile=fle.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Cle(e,t-1)},Tle=fle.__acroform__.calculateCoordinates=function(e,t){var n=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,i=e[0],a=e[1],s=e[2],o=e[3],l={};return l.lowerLeft_X=n(i)||0,l.lowerLeft_Y=r(a+o)||0,l.upperRight_X=n(i+s)||0,l.upperRight_Y=r(a)||0,[Number(vle(l.lowerLeft_X)),Number(vle(l.lowerLeft_Y)),Number(vle(l.upperRight_X)),Number(vle(l.upperRight_Y))]},Ble=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],n=e._V||e.DV,r=Mle(e,n),i=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+i+" "+vle(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var a=_le(e);return a.scope=e.scope,a.stream=t.join("\n"),a}},Mle=function(e,t){var n=0===e.fontSize?e.maxFontSize:e.fontSize,r={text:"",fontSize:""},i=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");i=e.multiline?i.map(function(e){return e.split("\n")}):i.map(function(e){return[e]});var a=n,s=$le.internal.getHeight(e)||0;s=s<0?-s:s;var o=$le.internal.getWidth(e)||0;o=o<0?-o:o;var l=function(t,n,r){if(t+1<i.length){var a=n+" "+i[t+1][0];return Fle(a,e,r).width<=o-4}return!1};a++;e:for(;a>0;){t="",a--;var c,u,h=Fle("3",e,a).height,d=e.multiline?s-a:(s-h)/2,A=d+=2,p=0,f=0,g=0;if(a<=0){t="(...) Tj\n",t+="% Width of Text: "+Fle(t,e,a=12).width+", FieldWidth:"+o+"\n";break}for(var m="",y=0,v=0;v<i.length;v++)if(i.hasOwnProperty(v)){var b=!1;if(1!==i[v].length&&g!==i[v].length-1){if((h+2)*(y+2)+2>s)continue e;m+=i[v][g],b=!0,f=v,v--}else{m=" "==(m+=i[v][g]+" ").substr(m.length-1)?m.substr(0,m.length-1):m;var x=parseInt(v),w=l(x,m,a),_=v>=i.length-1;if(w&&!_){m+=" ",g=0;continue}if(w||_){if(_)f=x;else if(e.multiline&&(h+2)*(y+2)+2>s)continue e}else{if(!e.multiline)continue e;if((h+2)*(y+2)+2>s)continue e;f=x}}for(var S="",C=p;C<=f;C++){var E=i[C];if(e.multiline){if(C===f){S+=E[g]+" ",g=(g+1)%E.length;continue}if(C===p){S+=E[E.length-1]+" ";continue}}S+=E[0]+" "}switch(S=" "==S.substr(S.length-1)?S.substr(0,S.length-1):S,u=Fle(S,e,a).width,e.textAlign){case"right":c=o-u-2;break;case"center":c=(o-u)/2;break;default:c=2}t+=vle(c)+" "+vle(A)+" Td\n",t+="("+mle(S)+") Tj\n",t+=-vle(c)+" 0 Td\n",A=-(a+2),u=0,p=b?f:f+1,y++,m=""}break}return r.text=t,r.fontSize=a,r},Fle=function(e,t,n){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(e,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:i}},Rle={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Lle=function(e,t){var n={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find(function(e){return e.type===n.type&&e.object===n.object})&&t.internal.getPageInfo(e.page).pageContext.annotations.push(n)},Ple=fle.__acroform__.arrayToPdfArray=function(e,t,n){var r=function(e){return e};if(Array.isArray(e)){for(var i="[",a=0;a<e.length;a++)switch(0!==a&&(i+=" "),(0,xne.A)(e[a])){case"boolean":case"number":case"object":i+=e[a].toString();break;case"string":"/"!==e[a].substr(0,1)?(void 0!==t&&n&&(r=n.internal.getEncryptor(t)),i+="("+mle(r(e[a].toString()))+")"):i+=e[a].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Ule=function(e,t,n){var r=function(e){return e};return void 0!==t&&n&&(r=n.internal.getEncryptor(t)),(e=e||"").toString(),"("+mle(r(e))+")"},Dle=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Dle.prototype.toString=function(){return this.objId+" 0 R"},Dle.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},Dle.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)});for(var n in t)if(!1===Object.getOwnPropertyDescriptor(this,t[n]).configurable){var r=t[n],i=this[r];i&&(Array.isArray(i)?e.push({key:r,value:Ple(i,this.objId,this.scope)}):i instanceof Dle?(i.scope=this.scope,e.push({key:r,value:i.objId+" 0 R"})):"function"!=typeof i&&e.push({key:r,value:i}))}return e};var Ole=function(){Dle.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};xle(Ole,Dle);var jle=function(){Dle.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+mle(t(e))+")"}},set:function(t){e=t}})};xle(jle,Dle);var zle=function e(){Dle.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(t,3))},set:function(e){!0===Boolean(e)?this.F=kle(t,3):this.F=Ile(t,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');n=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof Xle)return;a="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+mle(t(a))+")"},set:function(e){a=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e}});var s="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){s=e}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(e){l=e}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===c?50/gle:c},set:function(e){c=e}});var u="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){u=e}});var h="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!h||this instanceof Xle||this instanceof Jle))return Ule(h,this.objId,this.scope)},set:function(e){e=e.toString(),h=e}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof Wle==0?Ule(d,this.objId,this.scope):d},set:function(e){e=e.toString(),d=this instanceof Wle==0?"("===e.substr(0,1)?yle(e.substr(1,e.length-2)):yle(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Wle==1?yle(d.substr(1,d.length-1)):d},set:function(e){e=e.toString(),d=this instanceof Wle==1?"/"+e:e}});var A=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(A)return A},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(A)return this instanceof Wle==0?Ule(A,this.objId,this.scope):A},set:function(e){e=e.toString(),A=this instanceof Wle==0?"("===e.substr(0,1)?yle(e.substr(1,e.length-2)):yle(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Wle==1?yle(A.substr(1,A.length-1)):A},set:function(e){e=e.toString(),A=this instanceof Wle==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var p,f=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){e=Boolean(e),f=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(p)return p},set:function(e){p=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,1):this.Ff=Ile(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,2):this.Ff=Ile(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,3):this.Ff=Ile(this.Ff,3)}});var g=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==g)return g},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');g=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(g){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:g=2;break;case"center":case 1:g=1;break;default:g=0}}})};xle(zle,Dle);var Hle=function(){zle.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Ple(t,this.objId,this.scope)},set:function(e){var n,r;r=[],"string"==typeof(n=e)&&(r=function(e,t,n){n||(n=1);for(var r,i=[];r=t.exec(e);)i.push(r[n]);return i}(n,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,18):this.Ff=Ile(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=kle(this.Ff,19):this.Ff=Ile(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=kle(this.Ff,20),t.sort()):this.Ff=Ile(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,22):this.Ff=Ile(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,23):this.Ff=Ile(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,27):this.Ff=Ile(this.Ff,27)}}),this.hasAppearanceStream=!1};xle(Hle,zle);var Qle=function(){Hle.call(this),this.fontName="helvetica",this.combo=!1};xle(Qle,Hle);var Vle=function(){Qle.call(this),this.combo=!0};xle(Vle,Qle);var Gle=function(){Vle.call(this),this.edit=!0};xle(Gle,Vle);var Wle=function(){zle.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,15):this.Ff=Ile(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,16):this.Ff=Ile(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,17):this.Ff=Ile(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,26):this.Ff=Ile(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var n,r=[];for(n in r.push("<<"),t)r.push("/"+n+" ("+mle(e(t[n]))+")");return r.push(">>"),r.join("\n")}},set:function(e){"object"===(0,xne.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};xle(Wle,zle);var qle=function(){Wle.call(this),this.pushButton=!0};xle(qle,Wle);var Kle=function(){Wle.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};xle(Kle,Wle);var Xle=function(){var e,t;zle.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,n=[];for(t in n.push("<<"),r)n.push("/"+t+" ("+mle(e(r[t]))+")");return n.push(">>"),n.join("\n")},set:function(e){"object"===(0,xne.A)(e)&&(r=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(e){"string"==typeof e&&(r.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=$le.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};xle(Xle,zle),Kle.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var n=this.Kids[t];n.appearanceStreamContent=e.createAppearanceStream(n.optionName),n.caption=e.getCA()}},Kle.prototype.createOption=function(e){var t=new Xle;return t.Parent=this,t.optionName=e,this.Kids.push(t),ece.call(this.scope,t),t};var Yle=function(){Wle.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=$le.CheckBox.createAppearanceStream()};xle(Yle,Wle);var Jle=function(){zle.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,13):this.Ff=Ile(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,21):this.Ff=Ile(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,23):this.Ff=Ile(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,24):this.Ff=Ile(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,25):this.Ff=Ile(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,26):this.Ff=Ile(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};xle(Jle,zle);var Zle=function(){Jle.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(Nle(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=kle(this.Ff,14):this.Ff=Ile(this.Ff,14)}}),this.password=!0};xle(Zle,Jle);var $le={CheckBox:{createAppearanceStream:function(){return{N:{On:$le.CheckBox.YesNormal},D:{On:$le.CheckBox.YesPushDown,Off:$le.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=[],r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,i=e.scope.__private__.encodeColorString(e.color),a=Mle(e,e.caption);return n.push("0.749023 g"),n.push("0 0 "+vle($le.internal.getWidth(e))+" "+vle($le.internal.getHeight(e))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+vle(a.fontSize)+" Tf "+i),n.push("BT"),n.push(a.text),n.push("ET"),n.push("Q"),n.push("EMC"),t.stream=n.join("\n"),t},YesNormal:function(e){var t=_le(e);t.scope=e.scope;var n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color),i=[],a=$le.internal.getHeight(e),s=$le.internal.getWidth(e),o=Mle(e,e.caption);return i.push("1 g"),i.push("0 0 "+vle(s)+" "+vle(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+vle(s-1)+" "+vle(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+n+" "+vle(o.fontSize)+" Tf "+r),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join("\n"),t},OffPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+vle($le.internal.getWidth(e))+" "+vle($le.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:$le.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=$le.RadioButton.Circle.YesNormal,t.D[e]=$le.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=_le(e);t.scope=e.scope;var n=[],r=$le.internal.getWidth(e)<=$le.internal.getHeight(e)?$le.internal.getWidth(e)/4:$le.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=$le.internal.Bezier_C,a=Number((r*i).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+ble($le.internal.getWidth(e)/2)+" "+ble($le.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=[],r=$le.internal.getWidth(e)<=$le.internal.getHeight(e)?$le.internal.getWidth(e)/4:$le.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*$le.internal.Bezier_C).toFixed(5)),s=Number((r*$le.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ble($le.internal.getWidth(e)/2)+" "+ble($le.internal.getHeight(e)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+ble($le.internal.getWidth(e)/2)+" "+ble($le.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),n.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),n.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),n.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=[],r=$le.internal.getWidth(e)<=$le.internal.getHeight(e)?$le.internal.getWidth(e)/4:$le.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*$le.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ble($le.internal.getWidth(e)/2)+" "+ble($le.internal.getHeight(e)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:$le.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=$le.RadioButton.Cross.YesNormal,t.D[e]=$le.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=_le(e);t.scope=e.scope;var n=[],r=$le.internal.calculateCross(e);return n.push("q"),n.push("1 1 "+vle($le.internal.getWidth(e)-2)+" "+vle($le.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(vle(r.x1.x)+" "+vle(r.x1.y)+" m"),n.push(vle(r.x2.x)+" "+vle(r.x2.y)+" l"),n.push(vle(r.x4.x)+" "+vle(r.x4.y)+" m"),n.push(vle(r.x3.x)+" "+vle(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=$le.internal.calculateCross(e),r=[];return r.push("0.749023 g"),r.push("0 0 "+vle($le.internal.getWidth(e))+" "+vle($le.internal.getHeight(e))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+vle($le.internal.getWidth(e)-2)+" "+vle($le.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(vle(n.x1.x)+" "+vle(n.x1.y)+" m"),r.push(vle(n.x2.x)+" "+vle(n.x2.y)+" l"),r.push(vle(n.x4.x)+" "+vle(n.x4.y)+" m"),r.push(vle(n.x3.x)+" "+vle(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=_le(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+vle($le.internal.getWidth(e))+" "+vle($le.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+n}};$le.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=$le.internal.getWidth(e),n=$le.internal.getHeight(e),r=Math.min(t,n);return{x1:{x:(t-r)/2,y:(n-r)/2+r},x2:{x:(t-r)/2+r,y:(n-r)/2},x3:{x:(t-r)/2,y:(n-r)/2},x4:{x:(t-r)/2+r,y:(n-r)/2+r}}}},$le.internal.getWidth=function(e){var t=0;return"object"===(0,xne.A)(e)&&(t=wle(e.Rect[2])),t},$le.internal.getHeight=function(e){var t=0;return"object"===(0,xne.A)(e)&&(t=wle(e.Rect[3])),t};var ece=fle.addField=function(e){if(function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(zle.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(Rle)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");gle=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new jle,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0}),e.internal.events.subscribe("buildDocument",function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.objId=void 0,r.hasAnnotation&&Lle(r,e)}}(e)}),e.internal.events.subscribe("putCatalog",function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)}),e.internal.events.subscribe("postPutPages",function(t){!function(e,t){var n=!e;for(var r in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(r)){var i=e[r],a=[],s=i.Rect;if(i.Rect&&(i.Rect=Tle(i.Rect,t)),t.internal.newObjectDeferredBegin(i.objId,!0),i.DA=$le.createDefaultAppearanceStream(i),"object"===(0,xne.A)(i)&&"function"==typeof i.getKeyValueListForStream&&(a=i.getKeyValueListForStream()),i.Rect=s,i.hasAppearanceStream&&!i.appearanceStreamContent){var o=Ble(i);a.push({key:"AP",value:"<</N "+o+">>"}),t.internal.acroformPlugin.xForms.push(o)}if(i.appearanceStreamContent){var l="";for(var c in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(c)){var u=i.appearanceStreamContent[c];if(l+="/"+c+" ",l+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var r in u)if(u.hasOwnProperty(r)){var h=u[r];"function"==typeof h&&(h=h.call(t,i)),l+="/"+r+" "+h+" ",t.internal.acroformPlugin.xForms.indexOf(h)>=0||t.internal.acroformPlugin.xForms.push(h)}}else"function"==typeof(h=u)&&(h=h.call(t,i)),l+="/"+r+" "+h,t.internal.acroformPlugin.xForms.indexOf(h)>=0||t.internal.acroformPlugin.xForms.push(h);l+=">>"}a.push({key:"AP",value:"<<\n"+l+">>"})}t.internal.putStream({additionalKeyValues:a,objectId:i.objId}),t.internal.out("endobj")}n&&function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=n,i=e[n];t.internal.newObjectDeferredBegin(i.objId,!0),"object"===(0,xne.A)(i)&&"function"==typeof i.putStream&&i.putStream(),delete e[r]}}(t.internal.acroformPlugin.xForms,t)}(t,e)}),e.internal.acroformPlugin.isInitialized=!0}}(this,e),!(e instanceof zle))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};fle.AcroFormChoiceField=Hle,fle.AcroFormListBox=Qle,fle.AcroFormComboBox=Vle,fle.AcroFormEditBox=Gle,fle.AcroFormButton=Wle,fle.AcroFormPushButton=qle,fle.AcroFormRadioButton=Kle,fle.AcroFormCheckBox=Yle,fle.AcroFormTextField=Jle,fle.AcroFormPasswordField=Zle,fle.AcroFormAppearance=$le,fle.AcroForm={ChoiceField:Hle,ListBox:Qle,ComboBox:Vle,EditBox:Gle,Button:Wle,PushButton:qle,RadioButton:Kle,CheckBox:Yle,TextField:Jle,PasswordField:Zle,Appearance:$le},ple.AcroForm={ChoiceField:Hle,ListBox:Qle,ComboBox:Vle,EditBox:Gle,Button:Wle,PushButton:qle,RadioButton:Kle,CheckBox:Yle,TextField:Jle,PasswordField:Zle,Appearance:$le};ple.AcroForm;function tce(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})}!function(e){var t="addImage_";e.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=e.__addimage__.getImageFileTypeByImageData=function(e,t){var i,a,s,o,l,c=n;if("RGBA"===(t=t||n)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(w(e))for(l in r)for(s=r[l],i=0;i<s.length;i+=1){for(o=!0,a=0;a<s[i].length;a+=1)if(void 0!==s[i][a]&&s[i][a]!==e[a]){o=!1;break}if(!0===o){c=l;break}}else for(l in r)for(s=r[l],i=0;i<s.length;i+=1){for(o=!0,a=0;a<s[i].length;a+=1)if(void 0!==s[i][a]&&s[i][a]!==e.charCodeAt(a)){o=!1;break}if(!0===o){c=l;break}}return c===n&&t!==n&&(c=t),c},a=function e(t){for(var n=this.internal.write,r=this.internal.putStream,i=(0,this.internal.getFilters)();-1!==i.indexOf("FlateEncode");)i.splice(i.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var a=[];if(a.push({key:"Type",value:"/XObject"}),a.push({key:"Subtype",value:"/Image"}),a.push({key:"Width",value:t.width}),a.push({key:"Height",value:t.height}),t.colorSpace===m.INDEXED?a.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(a.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===m.DEVICE_CMYK&&a.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),a.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&a.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)&&t.transparency.length>0){for(var s="",o=0,l=t.transparency.length;o<l;o++)s+=t.transparency[o]+" "+t.transparency[o]+" ";a.push({key:"Mask",value:"["+s+"]"})}void 0!==t.sMask&&a.push({key:"SMask",value:t.objectId+1+" 0 R"});var c=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:a,alreadyAppliedFilters:c,objectId:t.objectId}),n("endobj"),"sMask"in t&&void 0!==t.sMask){var u,h=null!==(u=t.sMaskBitsPerComponent)&&void 0!==u?u:t.bitsPerComponent,d={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:h,data:t.sMask};"filter"in t&&(d.decodeParameters="/Predictor ".concat(t.predictor," /Colors 1 /BitsPerComponent ").concat(h," /Columns ").concat(t.width),d.filter=t.filter),e.call(this,d)}if(t.colorSpace===m.INDEXED){var A=this.internal.newObject();r({data:S(new Uint8Array(t.palette)),objectId:A}),n("endobj")}},s=function(){var e=this.internal.collections[t+"images"];for(var n in e)a.call(this,e[n])},o=function(){var e,n=this.internal.collections[t+"images"],r=this.internal.write;for(var i in n)r("/I"+(e=n[i]).index,e.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",s),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var e=this.internal.collections[t+"images"];return l.call(this),e},u=function(){return Object.keys(this.internal.collections[t+"images"]).length},h=function(t){return"function"==typeof e["process"+t.toUpperCase()]},d=function(e){return"object"===(0,xne.A)(e)&&1===e.nodeType},A=function(t,n){if("IMG"===t.nodeName&&t.hasAttribute("src")){var r=""+t.getAttribute("src");if(0===r.indexOf("data:image/"))return Qoe(unescape(r).split("base64,").pop());var i=e.loadFile(r,!0);if(void 0!==i)return i}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var a;switch(n){case"PNG":a="image/png";break;case"WEBP":a="image/webp";break;default:a="image/jpeg"}return Qoe(t.toDataURL(a,1).split("base64,").pop())}},p=function(e){var n=this.internal.collections[t+"images"];if(n)for(var r in n)if(e===n[r].alias)return n[r]},f=function(e,t,n){return e||t||(e=-96,t=-96),e<0&&(e=-1*n.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*n.height*72/t/this.internal.scaleFactor),0===e&&(e=t*n.width/n.height),0===t&&(t=e*n.height/n.width),[e,t]},g=function(e,t,n,r,i,a){var s=f.call(this,n,r,i),o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,u=c.call(this);if(n=s[0],r=s[1],u[i.index]=i,a){a*=Math.PI/180;var h=Math.cos(a),d=Math.sin(a),A=function(e){return e.toFixed(4)},p=[A(h),A(d),A(-1*d),A(h),0,0,"cm"]}this.internal.write("q"),a?(this.internal.write([1,"0","0",1,o(e),l(t+r),"cm"].join(" ")),this.internal.write(p.join(" ")),this.internal.write([o(n),"0","0",o(r),"0","0","cm"].join(" "))):this.internal.write([o(n),"0","0",o(r),o(e),l(t+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+i.index+" Do"),this.internal.write("Q")},m=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var y=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},v=e.__addimage__.sHashCode=function(e){var t,n,r=0;if("string"==typeof e)for(n=e.length,t=0;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;else if(w(e))for(n=e.byteLength/2,t=0;t<n;t++)r=(r<<5)-r+e[t],r|=0;return r},b=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},x=e.__addimage__.extractImageFromDataUrl=function(e){if(null==e)return null;if(!(e=e.trim()).startsWith("data:"))return null;var t=e.indexOf(",");return t<0?null:e.substring(0,t).trim().endsWith("base64")?e.substring(t+1):null};e.__addimage__.isArrayBuffer=function(e){return e instanceof ArrayBuffer};var w=e.__addimage__.isArrayBufferView=function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array},_=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n},S=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",n=w(e)?e:new Uint8Array(e),r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return t};e.addImage=function(){var e,t,r,i,a,s,o,c,u;if("number"==typeof arguments[1]?(t=n,r=arguments[1],i=arguments[2],a=arguments[3],s=arguments[4],o=arguments[5],c=arguments[6],u=arguments[7]):(t=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],s=arguments[5],o=arguments[6],c=arguments[7],u=arguments[8]),"object"===(0,xne.A)(e=arguments[0])&&!d(e)&&"imageData"in e){var h=e;e=h.imageData,t=h.format||t||n,r=h.x||r||0,i=h.y||i||0,a=h.w||h.width||a,s=h.h||h.height||s,o=h.alias||o,c=h.compression||c,u=h.rotation||h.angle||u}var A=this.internal.getFilters();if(void 0===c&&-1!==A.indexOf("FlateEncode")&&(c="SLOW"),isNaN(r)||isNaN(i))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var p=C.call(this,e,t,o,c);return g.call(this,r,i,a,s,p,u),this};var C=function(t,r,a,s){var o,l,c;if("string"==typeof t&&i(t)===n){t=unescape(t);var f=E(t,!1);(""!==f||void 0!==(f=e.loadFile(t,!0)))&&(t=f)}if(d(t)&&(t=A(t,r)),r=i(t,r),!h(r))throw new Error("addImage does not support files of type '"+r+"', please ensure that a plugin for '"+r+"' support is added.");if((null==(c=a)||0===c.length)&&(a=function(e){return"string"==typeof e||w(e)?v(e):w(e.data)?v(e.data):null}(t)),(o=p.call(this,a))||(t instanceof Uint8Array||"RGBA"===r||(l=t,t=_(t)),o=this["process"+r.toUpperCase()](t,u.call(this),a,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:y.NONE}(s),l)),!o)throw new Error("An unknown error occurred whilst processing the image.");return o},E=e.__addimage__.convertBase64ToBinaryString=function(e,t){t="boolean"!=typeof t||t;var n,r="";if("string"==typeof e){var a;n=null!==(a=x(e))&&void 0!==a?a:e;try{r=Qoe(n)}catch(i){if(t)throw b(n)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+i.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return r};e.getImageProperties=function(t){var r,a,s="";if(d(t)&&(t=A(t)),"string"==typeof t&&i(t)===n&&(""===(s=E(t,!1))&&(s=e.loadFile(t)||""),t=s),a=i(t),!h(a))throw new Error("addImage does not support files of type '"+a+"', please ensure that a plugin for '"+a+"' support is added.");if(t instanceof Uint8Array||(t=_(t)),!(r=this["process"+a.toUpperCase()](t)))throw new Error("An unknown error occurred whilst processing the image");return r.fileType=a,r}}(ple.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};ple.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var n,r,i,a=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,o=this.internal.getPageInfoByObjId(e.objId),l=e.pageContext.annotations,c=!1,u=0;u<l.length&&!c;u++)switch((n=l[u]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(c=!0);break;case"reference":case"text":case"freetext":c=!0}if(0!=c){this.internal.write("/Annots [");for(var h=0;h<l.length;h++){n=l[h];var d=this.internal.pdfEscape,A=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var p=this.internal.newAdditionalObject(),f=this.internal.newAdditionalObject(),g=this.internal.getEncryptor(p.objId),m=n.title||"Note";i="<</Type /Annot /Subtype /Text "+(r="/Rect ["+a(n.bounds.x)+" "+s(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y)+"] ")+"/Contents ("+d(g(n.contents))+")",i+=" /Popup "+f.objId+" 0 R",i+=" /P "+o.objId+" 0 R",i+=" /T ("+d(g(m))+") >>",p.content=i;var y=p.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+a(n.bounds.x+30)+" "+s(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+s(n.bounds.y)+"] ")+" /Parent "+y,n.open&&(i+=" /Open true"),i+=" >>",f.content=i,this.internal.write(p.objId,"0 R",f.objId,"0 R");break;case"freetext":r="/Rect ["+a(n.bounds.x)+" "+s(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+s(n.bounds.y+n.bounds.h)+"] ";var v=n.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+d(A(n.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+v+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(n.options.name){var b=this.annotations._nameMap[n.options.name];n.options.pageNumber=b.page,n.options.top=b.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",i="",n.options.url)i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+d(A(n.options.url))+") >>";else if(n.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,i+=" /FitV "+n.options.left+"]";break;default:var x=s(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),i+=" /XYZ "+n.options.left+" "+x+" "+n.options.zoom+"]"}""!=i&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,n,r,i){var a=this.internal.getCurrentPageInfo(),s=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:s(e),y:o(t),w:s(e+n),h:o(t+r)},options:i,type:"link"})},e.textWithLink=function(e,t,n,r){var i,a,s=this.getTextWidth(e),o=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){a=r.maxWidth;var l=this.splitTextToSize(e,a).length;i=Math.ceil(o*l)}else a=s,i=o;return this.text(e,t,n,r),n+=.2*o,"center"===r.align&&(t-=s/2),"right"===r.align&&(t-=s),this.link(t,n-o,a,i,r),s},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(ple.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];e.__arabicParser__={};var a=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},s=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},o=e.__arabicParser__.isArabicEndLetter=function(e){return s(e)&&a(e)&&t[e.charCodeAt(0)].length<=2},l=e.__arabicParser__.isArabicAlfLetter=function(e){return s(e)&&i.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return s(e)&&a(e)&&t[e.charCodeAt(0)].length>=1};var c=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return s(e)&&a(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return s(e)&&a(e)&&t[e.charCodeAt(0)].length>=3};var u=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return s(e)&&a(e)&&4==t[e.charCodeAt(0)].length},h=e.__arabicParser__.resolveLigatures=function(e){var t=0,r=n,i="",a=0;for(t=0;t<e.length;t+=1)void 0!==r[e.charCodeAt(t)]?(a++,"number"==typeof(r=r[e.charCodeAt(t)])&&(i+=String.fromCharCode(r),r=n,a=0),t===e.length-1&&(r=n,i+=e.charAt(t-(a-1)),t-=a-1,a=0)):(r=n,i+=e.charAt(t-a),t-=a,a=0);return i};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==r[e.charCodeAt(0)]};var d=e.__arabicParser__.getCorrectForm=function(e,t,n){return s(e)?!1===a(e)?-1:!c(e)||!s(t)&&!s(n)||!s(n)&&o(t)||o(e)&&!s(t)||o(e)&&l(t)||o(e)&&o(t)?0:u(e)&&s(t)&&!o(t)&&s(n)&&c(n)?3:o(e)||!s(n)?1:2:-1},A=function(e){var n=0,r=0,i=0,a="",o="",l="",c=(e=e||"").split("\\s+"),u=[];for(n=0;n<c.length;n+=1){for(u.push(""),r=0;r<c[n].length;r+=1)a=c[n][r],o=c[n][r-1],l=c[n][r+1],s(a)?(i=d(a,o,l),u[n]+=-1!==i?String.fromCharCode(t[a.charCodeAt(0)][i]):a):u[n]+=a;u[n]=h(u[n])}return u.join(" ")},p=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(t)){var r=0;for(n=[],r=0;r<t.length;r+=1)Array.isArray(t[r])?n.push([A(t[r][0]),t[r][1],t[r][2]]):n.push([A(t[r])]);e=n}else e=A(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",p])}(ple.API),ple.API.autoPrint=function(e){var t;return(e=e||{}).variant=e.variant||"non-conform","javascript"===e.variant?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(e){n=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(e){r=e}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var n;if("2d"!==(e=e||"2d"))return null;for(n in t)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=t[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(ple.API),function(e){var t={left:0,top:0,bottom:0,right:0},n=!1,r=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var i=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var a=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var s=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return s},set:function(e){s=e}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return r.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){r.call(this);var n=(t=t||{}).fontSize||this.getFontSize(),i=t.font||this.getFont(),a=t.scaleFactor||this.internal.scaleFactor,s=0,o=0,l=0,c=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var u=t.maxWidth;u>0?"string"==typeof e?e=this.splitTextToSize(e,u):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce(function(e,t){return e.concat(c.splitTextToSize(t,u))},[])):e=Array.isArray(e)?e:[e];for(var h=0;h<e.length;h++)s<(l=this.getStringUnitWidth(e[h],{font:i})*n)&&(s=l);return 0!==s&&(o=e.length),{w:s/=a,h:Math.max((o*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/a,0)}},e.cellAddPage=function(){r.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new a(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var s=e.cell=function(){var e;e=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var i=this.internal.__cell__.lastCell,s=this.internal.__cell__.padding,o=this.internal.__cell__.margins||t,l=this.internal.__cell__.tableHeaderRow,c=this.internal.__cell__.printHeaders;return void 0!==i.lineNumber&&(i.lineNumber===e.lineNumber?(e.x=(i.x||0)+(i.width||0),e.y=i.y||0):i.y+i.height+e.height+o.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=o.top,c&&l&&(this.printHeaderRow(e.lineNumber,!0),e.y+=l[0].height)):e.y=i.y+i.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===n?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-s,e.y+s,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+s,{align:"center",baseline:"top",maxWidth:e.width-s-s}):this.text(e.text,e.x+s,e.y+s,{align:"left",baseline:"top",maxWidth:e.width-s-s})),this.internal.__cell__.lastCell=e,this};e.table=function(e,n,l,c,u){if(r.call(this),!l)throw new Error("No data for PDF table.");var h,d,A,p,f=[],g=[],m=[],y={},v={},b=[],x=[],w=(u=u||{}).autoSize||!1,_=!1!==u.printHeaders,S=u.css&&void 0!==u.css["font-size"]?16*u.css["font-size"]:u.fontSize||12,C=u.margins||Object.assign({width:this.getPageWidth()},t),E="number"==typeof u.padding?u.padding:3,N=u.headerBackgroundColor||"#c8c8c8",k=u.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=_,this.internal.__cell__.margins=C,this.internal.__cell__.table_font_size=S,this.internal.__cell__.padding=E,this.internal.__cell__.headerBackgroundColor=N,this.internal.__cell__.headerTextColor=k,this.setFontSize(S),null==c)g=f=Object.keys(l[0]),m=f.map(function(){return"left"});else if(Array.isArray(c)&&"object"===(0,xne.A)(c[0]))for(f=c.map(function(e){return e.name}),g=c.map(function(e){return e.prompt||e.name||""}),m=c.map(function(e){return e.align||"left"}),h=0;h<c.length;h+=1)v[c[h].name]=.7499990551181103*c[h].width;else Array.isArray(c)&&"string"==typeof c[0]&&(g=f=c,m=f.map(function(){return"left"}));if(w||Array.isArray(c)&&"string"==typeof c[0])for(h=0;h<f.length;h+=1){for(y[p=f[h]]=l.map(function(e){return e[p]}),this.setFont(void 0,"bold"),b.push(this.getTextDimensions(g[h],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),d=y[p],this.setFont(void 0,"normal"),A=0;A<d.length;A+=1)b.push(this.getTextDimensions(d[A],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);v[p]=Math.max.apply(null,b)+E+E,b=[]}if(_){var I={};for(h=0;h<f.length;h+=1)I[f[h]]={},I[f[h]].text=g[h],I[f[h]].align=m[h];var T=o.call(this,I,v);x=f.map(function(t){return new a(e,n,v[t],T,I[t].text,void 0,I[t].align)}),this.setTableHeaderRow(x),this.printHeaderRow(1,!1)}var B=c.reduce(function(e,t){return e[t.name]=t.align,e},{});for(h=0;h<l.length;h+=1){"rowStart"in u&&u.rowStart instanceof Function&&u.rowStart({row:h,data:l[h]},this);var M=o.call(this,l[h],v);for(A=0;A<f.length;A+=1){var F=l[h][f[A]];"cellStart"in u&&u.cellStart instanceof Function&&u.cellStart({row:h,col:A,data:F},this),s.call(this,new a(e,n,v[f[A]],M,F,h+2,B[f[A]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=n,this};var o=function(e,t){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,i=this.internal.scaleFactor;return Object.keys(e).map(function(r){var i=e[r];return this.splitTextToSize(i.hasOwnProperty("text")?i.text:i,t[r]-n-n)},this).map(function(e){return this.getLineHeightFactor()*e.length*r/i+n+n},this).reduce(function(e,t){return Math.max(e,t)},0)};e.setTableHeaderRow=function(e){r.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var i;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var o=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(o[0],o[1],o[2],o[3],void 0,-1)}this.setFont(void 0,"bold");for(var l=[],c=0;c<this.internal.__cell__.tableHeaderRow.length;c+=1){i=this.internal.__cell__.tableHeaderRow[c].clone(),t&&(i.y=this.internal.__cell__.margins.top||0,l.push(i)),i.lineNumber=e;var u=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),s.call(this,i),this.setTextColor(u)}l.length>0&&this.setTableHeaderRow(l),this.setFont(void 0,"normal"),n=!1}}(ple.API);var nce={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},rce=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],ice=tce(rce),ace=[100,200,300,400,500,600,700,800,900],sce=tce(ace);function oce(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),n=function(e){return nce[e=e||"normal"]?e:"normal"}(e.style),r=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),i=function(e){return"number"==typeof ice[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:n,weight:r,stretch:i,src:e.src||[],ref:e.ref||{name:t,style:[i,n,r].join(" ")}}}function lce(e,t,n,r){var i;for(i=n;i>=0&&i<t.length;i+=r)if(e[t[i]])return e[t[i]];for(i=n;i>=0&&i<t.length;i-=r)if(e[t[i]])return e[t[i]]}var cce={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},uce={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function hce(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function dce(e){return e.trimLeft()}function Ace(e,t){for(var n=0;n<e.length;){if(e.charAt(n)===t)return[e.substring(0,n),e.substring(n+1)];n+=1}return null}function pce(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var fce,gce,mce,yce,vce,bce,xce,wce,_ce,Sce=["times"];function Cce(e,t,n,r,i){var a=4,s=kce;switch(i){case ple.API.image_compression.FAST:a=1,s=Nce;break;case ple.API.image_compression.MEDIUM:a=6,s=Ice;break;case ple.API.image_compression.SLOW:a=9,s=Tce}e=function(e,t,n,r){for(var i,a=e.length/t,s=new Uint8Array(e.length+a),o=[Ece,Nce,kce,Ice,Tce],l=0;l<a;l+=1){var c=l*t,u=e.subarray(c,c+t);if(r)s.set(r(u,n,i),c+l);else{for(var h=o.length,d=[],A=0;A<h;A+=1)d[A]=o[A](u,n,i);var p=Mce(d.concat());s.set(d[p],c+l)}i=u}return s}(e,t,Math.ceil(n*r/8),s);var o=are(e,{level:a});return ple.API.__addimage__.arrayBufferToBinaryString(o)}function Ece(e){var t=Array.apply([],e);return t.unshift(0),t}function Nce(e,t){var n=e.length,r=[];r[0]=1;for(var i=0;i<n;i+=1){var a=e[i-t]||0;r[i+1]=e[i]-a+256&255}return r}function kce(e,t,n){var r=e.length,i=[];i[0]=2;for(var a=0;a<r;a+=1){var s=n&&n[a]||0;i[a+1]=e[a]-s+256&255}return i}function Ice(e,t,n){var r=e.length,i=[];i[0]=3;for(var a=0;a<r;a+=1){var s=e[a-t]||0,o=n&&n[a]||0;i[a+1]=e[a]+256-(s+o>>>1)&255}return i}function Tce(e,t,n){var r=e.length,i=[];i[0]=4;for(var a=0;a<r;a+=1){var s=Bce(e[a-t]||0,n&&n[a]||0,n&&n[a-t]||0);i[a+1]=e[a]-s+256&255}return i}function Bce(e,t,n){if(e===t&&t===n)return e;var r=Math.abs(t-n),i=Math.abs(e-n),a=Math.abs(e+t-n-n);return r<=i&&r<=a?e:i<=a?t:n}function Mce(e){var t=e.map(function(e){return e.reduce(function(e,t){return e+Math.abs(t)},0)});return t.indexOf(Math.min.apply(null,t))}function Fce(e,t,n){var r=t*n,i=Math.floor(r/8),a=16-(r-8*i+n),s=(1<<n)-1;return Lce(e,i)>>a&s}function Rce(e,t,n,r){var i=n*r,a=Math.floor(i/8),s=16-(i-8*a+r),o=(1<<r)-1,l=(t&o)<<s;!function(e,t,n){if(t+1<e.byteLength)e.setUint16(t,n,!1);else{var r=n>>8&255;e.setUint8(t,r)}}(e,a,Lce(e,a)&~(o<<s)&65535|l)}function Lce(e,t){return t+1<e.byteLength?e.getUint16(t,!1):e.getUint8(t)<<8}function Pce(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,i=e[t++],a=i>>7,s=1<<1+(7&i);e[t++],e[t++];var o=null,l=null;a&&(o=t,l=s,t+=3*s);var c=!0,u=[],h=0,d=null,A=0,p=null;for(this.width=n,this.height=r;c&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,p=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var f=e[t++];h=e[t++]|e[t++]<<8,d=e[t++],1&f||(d=null),A=f>>2&7,t++;break;case 254:for(;;){if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var g=e[t++]|e[t++]<<8,m=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,b=e[t++],x=b>>6&1,w=1<<1+(7&b),_=o,S=l,C=!1;b>>7&&(C=!0,_=t,S=w,t+=3*w);var E=t;for(t++;;){var N;if(!((N=e[t++])>=0))throw Error("Invalid block size");if(0===N)break;t+=N}u.push({x:g,y:m,width:y,height:v,has_local_palette:C,palette_offset:_,palette_size:S,data_offset:E,data_length:t-E,transparent_index:d,interlaced:!!x,delay:h,disposal:A});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return u.length},this.loopCount=function(){return p},this.frameInfo=function(e){if(e<0||e>=u.length)throw new Error("Frame index out of range.");return u[e]},this.decodeAndBlitFrameBGRA=function(t,r){var i=this.frameInfo(t),a=i.width*i.height,s=new Uint8Array(a);Uce(e,i.data_offset,s,a);var o=i.palette_offset,l=i.transparent_index;null===l&&(l=256);var c=i.width,u=n-c,h=c,d=4*(i.y*n+i.x),A=4*((i.y+i.height)*n+i.x),p=d,f=4*u;!0===i.interlaced&&(f+=4*n*7);for(var g=8,m=0,y=s.length;m<y;++m){var v=s[m];if(0===h&&(h=c,(p+=f)>=A&&(f=4*u+4*n*(g-1),p=d+(c+u)*(g<<1),g>>=1)),v===l)p+=4;else{var b=e[o+3*v],x=e[o+3*v+1],w=e[o+3*v+2];r[p++]=w,r[p++]=x,r[p++]=b,r[p++]=255}--h}},this.decodeAndBlitFrameRGBA=function(t,r){var i=this.frameInfo(t),a=i.width*i.height,s=new Uint8Array(a);Uce(e,i.data_offset,s,a);var o=i.palette_offset,l=i.transparent_index;null===l&&(l=256);var c=i.width,u=n-c,h=c,d=4*(i.y*n+i.x),A=4*((i.y+i.height)*n+i.x),p=d,f=4*u;!0===i.interlaced&&(f+=4*n*7);for(var g=8,m=0,y=s.length;m<y;++m){var v=s[m];if(0===h&&(h=c,(p+=f)>=A&&(f=4*u+4*n*(g-1),p=d+(c+u)*(g<<1),g>>=1)),v===l)p+=4;else{var b=e[o+3*v],x=e[o+3*v+1],w=e[o+3*v+2];r[p++]=b,r[p++]=x,r[p++]=w,r[p++]=255}--h}}}function Uce(e,t,n,r){for(var i=e[t++],a=1<<i,s=a+1,o=s+1,l=i+1,c=(1<<l)-1,u=0,h=0,d=0,A=e[t++],p=new Int32Array(4096),f=null;;){for(;u<16&&0!==A;)h|=e[t++]<<u,u+=8,1===A?A=e[t++]:--A;if(u<l)break;var g=h&c;if(h>>=l,u-=l,g!==a){if(g===s)break;for(var m=g<o?g:f,y=0,v=m;v>a;)v=p[v]>>8,++y;var b=v;if(d+y+(m!==g?1:0)>r)return void Uoe.log("Warning, gif stream longer than expected.");n[d++]=b;var x=d+=y;for(m!==g&&(n[d++]=b),v=m;y--;)v=p[v],n[--x]=255&v,v>>=8;null!==f&&o<4096&&(p[o++]=f<<8|b,o>=c+1&&l<12&&(++l,c=c<<1|1)),f=g}else o=s+1,c=(1<<(l=i+1))-1,f=null}return d!==r&&Uoe.log("Warning, gif stream shorter than expected."),n}function Dce(e){var t,n,r,i,a,s=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),u=new Array(64),h=new Array(65535),d=new Array(65535),A=new Array(64),p=new Array(64),f=[],g=0,m=7,y=new Array(64),v=new Array(64),b=new Array(64),x=new Array(256),w=new Array(2048),_=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],E=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],N=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],k=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],T=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],B=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function M(e,t){for(var n=0,r=0,i=new Array,a=1;a<=16;a++){for(var s=1;s<=e[a];s++)i[t[r]]=[],i[t[r]][0]=n,i[t[r]][1]=a,r++,n++;n*=2}return i}function F(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(g|=1<<m),n--,--m<0&&(255==g?(R(255),R(0)):R(g),m=7,g=0)}function R(e){f.push(e)}function L(e){R(e>>8&255),R(255&e)}function P(e,t,n,r,i){for(var a,s=i[0],o=i[240],l=function(e,t){var n,r,i,a,s,o,l,c,u,h,d=0;for(u=0;u<8;++u){n=e[d],r=e[d+1],i=e[d+2],a=e[d+3],s=e[d+4],o=e[d+5],l=e[d+6];var p=n+(c=e[d+7]),f=n-c,g=r+l,m=r-l,y=i+o,v=i-o,b=a+s,x=a-s,w=p+b,_=p-b,S=g+y,C=g-y;e[d]=w+S,e[d+4]=w-S;var E=.707106781*(C+_);e[d+2]=_+E,e[d+6]=_-E;var N=.382683433*((w=x+v)-(C=m+f)),k=.5411961*w+N,I=1.306562965*C+N,T=.707106781*(S=v+m),B=f+T,M=f-T;e[d+5]=M+k,e[d+3]=M-k,e[d+1]=B+I,e[d+7]=B-I,d+=8}for(d=0,u=0;u<8;++u){n=e[d],r=e[d+8],i=e[d+16],a=e[d+24],s=e[d+32],o=e[d+40],l=e[d+48];var F=n+(c=e[d+56]),R=n-c,L=r+l,P=r-l,U=i+o,D=i-o,O=a+s,j=a-s,z=F+O,H=F-O,Q=L+U,V=L-U;e[d]=z+Q,e[d+32]=z-Q;var G=.707106781*(V+H);e[d+16]=H+G,e[d+48]=H-G;var W=.382683433*((z=j+D)-(V=P+R)),q=.5411961*z+W,K=1.306562965*V+W,X=.707106781*(Q=D+P),Y=R+X,J=R-X;e[d+40]=J+q,e[d+24]=J-q,e[d+8]=Y+K,e[d+56]=Y-K,d++}for(u=0;u<64;++u)h=e[u]*t[u],A[u]=h>0?h+.5|0:h-.5|0;return A}(e,t),c=0;c<64;++c)p[_[c]]=l[c];var u=p[0]-n;n=p[0],0==u?F(r[0]):(F(r[d[a=32767+u]]),F(h[a]));for(var f=63;f>0&&0==p[f];)f--;if(0==f)return F(s),n;for(var g,m=1;m<=f;){for(var y=m;0==p[m]&&m<=f;)++m;var v=m-y;if(v>=16){g=v>>4;for(var b=1;b<=g;++b)F(o);v&=15}a=32767+p[m],F(i[(v<<4)+d[a]]),F(h[a]),m++}return 63!=f&&F(s),n}function U(e){e=Math.min(Math.max(e,1),100),a!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=s((t[n]*e+50)/100);r=Math.min(Math.max(r,1),255),o[_[n]]=r}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var h=s((i[a]*e+50)/100);h=Math.min(Math.max(h,1),255),l[_[a]]=h}for(var d=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],A=0,p=0;p<8;p++)for(var f=0;f<8;f++)c[A]=1/(o[_[A]]*d[p]*d[f]*8),u[A]=1/(l[_[A]]*d[p]*d[f]*8),A++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),a=e)}this.encode=function(e,a){a&&U(a),f=new Array,g=0,m=7,L(65496),L(65504),L(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),L(1),L(1),R(0),R(0),function(){L(65499),L(132),R(0);for(var e=0;e<64;e++)R(o[e]);R(1);for(var t=0;t<64;t++)R(l[t])}(),function(e,t){L(65472),L(17),R(8),L(t),L(e),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(e.width,e.height),function(){L(65476),L(418),R(0);for(var e=0;e<16;e++)R(S[e+1]);for(var t=0;t<=11;t++)R(C[t]);R(16);for(var n=0;n<16;n++)R(E[n+1]);for(var r=0;r<=161;r++)R(N[r]);R(1);for(var i=0;i<16;i++)R(k[i+1]);for(var a=0;a<=11;a++)R(I[a]);R(17);for(var s=0;s<16;s++)R(T[s+1]);for(var o=0;o<=161;o++)R(B[o])}(),L(65498),L(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var s=0,h=0,d=0;g=0,m=7,this.encode.displayName="_encode_";for(var A,p,x,_,M,D,O,j,z,H=e.data,Q=e.width,V=e.height,G=4*Q,W=0;W<V;){for(A=0;A<G;){for(M=G*W+A,O=-1,j=0,z=0;z<64;z++)D=M+(j=z>>3)*G+(O=4*(7&z)),W+j>=V&&(D-=G*(W+1+j-V)),A+O>=G&&(D-=A+O-G+4),p=H[D++],x=H[D++],_=H[D++],y[z]=(w[p]+w[x+256|0]+w[_+512|0]>>16)-128,v[z]=(w[p+768|0]+w[x+1024|0]+w[_+1280|0]>>16)-128,b[z]=(w[p+1280|0]+w[x+1536|0]+w[_+1792|0]>>16)-128;s=P(y,c,s,t,r),h=P(v,u,h,n,i),d=P(b,u,d,n,i),A+=32}W+=8}if(m>=0){var q=[];q[1]=m+1,q[0]=(1<<m+1)-1,F(q)}return L(65497),new Uint8Array(f)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)x[t]=e(t)}(),t=M(S,C),n=M(k,I),r=M(E,N),i=M(T,B),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var r=e;r<t;r++)d[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=r;for(var i=-(t-1);i<=-e;i++)d[32767+i]=n,h[32767+i]=[],h[32767+i][1]=n,h[32767+i][0]=t-1+i;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)w[e]=19595*e,w[e+256|0]=38470*e,w[e+512|0]=7471*e+32768,w[e+768|0]=-11059*e,w[e+1024|0]=-21709*e,w[e+1280|0]=32768*e+8421375,w[e+1536|0]=-27439*e,w[e+1792|0]=-5329*e}(),U(e)}function Oce(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function jce(e){function t(e){if(!e)throw Error("assert :P")}function n(e,t,n){for(var r=0;4>r;r++)if(e[t+r]!=n.charCodeAt(r))return!0;return!1}function r(e,t,n,r,i){for(var a=0;a<i;a++)e[t+a]=n[r+a]}function i(e,t,n,r){for(var i=0;i<r;i++)e[t+i]=n}function a(e){return new Int32Array(e)}function s(e,t){for(var n=[],r=0;r<e;r++)n.push(new t);return n}function o(e,t){var n=[];return function e(n,r,i){for(var a=i[r],s=0;s<a&&(n.push(i.length>r+1?[]:new t),!(i.length<r+1));s++)e(n[s],r+1,i)}(n,0,e),n}var l=function(){var e=this;function l(e,t){for(var n=1<<t-1>>>0;e&n;)n>>>=1;return n?(e&n-1)+n:e}function c(e,n,r,i,a){t(!(i%r));do{e[n+(i-=r)]=a}while(0<i)}function u(e,n,r,i,s){if(t(2328>=s),512>=s)var o=a(512);else if(null==(o=a(s)))return 0;return function(e,n,r,i,s,o){var u,d,A=n,p=1<<r,f=a(16),g=a(16);for(t(0!=s),t(null!=i),t(null!=e),t(0<r),d=0;d<s;++d){if(15<i[d])return 0;++f[i[d]]}if(f[0]==s)return 0;for(g[1]=0,u=1;15>u;++u){if(f[u]>1<<u)return 0;g[u+1]=g[u]+f[u]}for(d=0;d<s;++d)u=i[d],0<i[d]&&(o[g[u]++]=d);if(1==g[15])return(i=new h).g=0,i.value=o[0],c(e,A,1,p,i),p;var m,y=-1,v=p-1,b=0,x=1,w=1,_=1<<r;for(d=0,u=1,s=2;u<=r;++u,s<<=1){if(x+=w<<=1,0>(w-=f[u]))return 0;for(;0<f[u];--f[u])(i=new h).g=u,i.value=o[d++],c(e,A+b,s,_,i),b=l(b,u)}for(u=r+1,s=2;15>=u;++u,s<<=1){if(x+=w<<=1,0>(w-=f[u]))return 0;for(;0<f[u];--f[u]){if(i=new h,(b&v)!=y){for(A+=_,m=1<<(y=u)-r;15>y&&!(0>=(m-=f[y]));)++y,m<<=1;p+=_=1<<(m=y-r),e[n+(y=b&v)].g=m+r,e[n+y].value=A-n-y}i.g=u-r,i.value=o[d++],c(e,A+(b>>r),s,_,i),b=l(b,u)}}return x!=2*g[15]-1?0:p}(e,n,r,i,s,o)}function h(){this.value=this.g=0}function d(){this.value=this.g=0}function A(){this.G=s(5,h),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=s(Dn,d)}function p(e,n,r,i){t(null!=e),t(null!=n),t(2147483648>i),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=n,e.pa=r,e.Jd=n,e.Yc=r+i,e.Zc=4<=i?r+i-4+1:r,E(e)}function f(e,t){for(var n=0;0<t--;)n|=k(e,128)<<t;return n}function g(e,t){var n=f(e,t);return N(e)?-n:n}function m(e,n,r,i){var a,s=0;for(t(null!=e),t(null!=n),t(4294967288>i),e.Sb=i,e.Ra=0,e.u=0,e.h=0,4<i&&(i=4),a=0;a<i;++a)s+=n[r+a]<<8*a;e.Ra=s,e.bb=i,e.oa=n,e.pa=r}function y(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<zn-8>>>0,++e.bb,e.u-=8;_(e)&&(e.h=1,e.u=0)}function v(e,n){if(t(0<=n),!e.h&&n<=jn){var r=w(e)&On[n];return e.u+=n,y(e),r}return e.h=1,e.u=0}function b(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function x(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function w(e){return e.Ra>>>(e.u&zn-1)>>>0}function _(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>zn}function S(e,t){e.u=t,e.h=_(e)}function C(e){e.u>=Hn&&(t(e.u>=Hn),y(e))}function E(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function N(e){return f(e,1)}function k(e,t){var n=e.Ca;0>e.b&&E(e);var r=e.b,i=n*t>>>8,a=(e.I>>>r>i)+0;for(a?(n-=i,e.I-=i+1<<r>>>0):n=i+1,r=n,i=0;256<=r;)i+=8,r>>=8;return r=7^i+Qn[r],e.b-=r,e.Ca=(n<<r)-1,a}function I(e,t,n){e[t+0]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function T(e,t){return e[t+0]|e[t+1]<<8}function B(e,t){return T(e,t)|e[t+2]<<16}function M(e,t){return T(e,t)|T(e,t+2)<<16}function F(e,n){var r=1<<n;return t(null!=e),t(0<n),e.X=a(r),null==e.X?0:(e.Mb=32-n,e.Xa=n,1)}function R(e,n){t(null!=e),t(null!=n),t(e.Xa==n.Xa),r(n.X,0,e.X,0,1<<n.Xa)}function L(){this.X=[],this.Xa=this.Mb=0}function P(e,n,r,i){t(null!=r),t(null!=i);var a=r[0],s=i[0];return 0==a&&(a=(e*s+n/2)/n),0==s&&(s=(n*a+e/2)/e),0>=a||0>=s?0:(r[0]=a,i[0]=s,1)}function U(e,t){return e+(1<<t)-1>>>t}function D(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function O(t,n){e[n]=function(n,r,i,a,s,o,l){var c;for(c=0;c<s;++c){var u=e[t](o[l+c-1],i,a+c);o[l+c]=D(n[r+c],u)}}}function j(){this.ud=this.hd=this.jd=0}function z(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function H(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function Q(e,t){return H(e+(e-t+.5>>1))}function V(e,t,n){return Math.abs(t-n)-Math.abs(e-n)}function G(e,t,n,r,i,a,s){for(r=a[s-1],n=0;n<i;++n)a[s+n]=r=D(e[t+n],r)}function W(e,t,n,r,i){var a;for(a=0;a<n;++a){var s=e[t+a],o=s>>8&255,l=16711935&(l=(l=16711935&s)+((o<<16)+o));r[i+a]=(4278255360&s)+l>>>0}}function q(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function K(e,t,n,r,i,a){var s;for(s=0;s<r;++s){var o=t[n+s],l=o>>>8,c=o,u=255&(u=(u=o>>>16)+((e.jd<<24>>24)*(l<<24>>24)>>>5));c=255&(c=(c+=(e.hd<<24>>24)*(l<<24>>24)>>>5)+((e.ud<<24>>24)*(u<<24>>24)>>>5)),i[a+s]=(4278255360&o)+(u<<16)+c}}function X(t,n,r,i,a){e[n]=function(e,t,n,r,s,o,l,c,u){for(r=l;r<c;++r)for(l=0;l<u;++l)s[o++]=a(n[i(e[t++])])},e[t]=function(t,n,s,o,l,c,u){var h=8>>t.b,d=t.Ea,A=t.K[0],p=t.w;if(8>h)for(t=(1<<t.b)-1,p=(1<<h)-1;n<s;++n){var f,g=0;for(f=0;f<d;++f)f&t||(g=i(o[l++])),c[u++]=a(A[g&p]),g>>=h}else e["VP8LMapColor"+r](o,l,A,p,c,u,n,s,d)}}function Y(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a}}function J(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a,r[i++]=a>>24&255}}function Z(e,t,n,r,i){for(n=t+n;t<n;){var a=(s=e[t++])>>16&240|s>>12&15,s=240&s|s>>28&15;r[i++]=a,r[i++]=s}}function $(e,t,n,r,i){for(n=t+n;t<n;){var a=(s=e[t++])>>16&248|s>>13&7,s=s>>5&224|s>>3&31;r[i++]=a,r[i++]=s}}function ee(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=255&a,r[i++]=a>>8&255,r[i++]=a>>16&255}}function te(e,t,n,i,a,s){if(0==s)for(n=t+n;t<n;)I(i,((s=e[t++])[0]>>24|s[1]>>8&65280|s[2]<<8&16711680|s[3]<<24)>>>0),a+=32;else r(i,a,e,t,n)}function ne(t,n){e[n][0]=e[t+"0"],e[n][1]=e[t+"1"],e[n][2]=e[t+"2"],e[n][3]=e[t+"3"],e[n][4]=e[t+"4"],e[n][5]=e[t+"5"],e[n][6]=e[t+"6"],e[n][7]=e[t+"7"],e[n][8]=e[t+"8"],e[n][9]=e[t+"9"],e[n][10]=e[t+"10"],e[n][11]=e[t+"11"],e[n][12]=e[t+"12"],e[n][13]=e[t+"13"],e[n][14]=e[t+"0"],e[n][15]=e[t+"0"]}function re(e){return e==Hr||e==Qr||e==Vr||e==Gr}function ie(){this.eb=[],this.size=this.A=this.fb=0}function ae(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function se(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ie,this.f.kb=new ae,this.sd=null}function oe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function le(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ce(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function ue(e,t){var n=e.T,i=t.ba.f.RGBA,a=i.eb,s=i.fb+e.ka*i.A,o=gi[t.ba.S],l=e.y,c=e.O,u=e.f,h=e.N,d=e.ea,A=e.W,p=t.cc,f=t.dc,g=t.Mc,m=t.Nc,y=e.ka,v=e.ka+e.T,b=e.U,x=b+1>>1;for(0==y?o(l,c,null,null,u,h,d,A,u,h,d,A,a,s,null,null,b):(o(t.ec,t.fc,l,c,p,f,g,m,u,h,d,A,a,s-i.A,a,s,b),++n);y+2<v;y+=2)p=u,f=h,g=d,m=A,h+=e.Rc,A+=e.Rc,s+=2*i.A,o(l,(c+=2*e.fa)-e.fa,l,c,p,f,g,m,u,h,d,A,a,s-i.A,a,s,b);return c+=e.fa,e.j+v<e.o?(r(t.ec,t.fc,l,c,b),r(t.cc,t.dc,u,h,x),r(t.Mc,t.Nc,d,A,x),n--):1&v||o(l,c,null,null,u,h,d,A,u,h,d,A,a,s+i.A,null,null,b),n}function he(e,n,r){var i=e.F,a=[e.J];if(null!=i){var s=e.U,o=n.ba.S,l=o==Or||o==Vr;n=n.ba.f.RGBA;var c=[0],u=e.ka;c[0]=e.T,e.Kb&&(0==u?--c[0]:(--u,a[0]-=e.width),e.j+e.ka+e.T==e.o&&(c[0]=e.o-e.j-u));var h=n.eb;u=n.fb+u*n.A,e=Sr(i,a[0],e.width,s,c,h,u+(l?0:3),n.A),t(r==c),e&&re(o)&&wr(h,u,l,s,c,n.A)}return 0}function de(e){var t=e.ma,n=t.ba.S,r=11>n,i=n==Pr||n==Dr||n==Or||n==jr||12==n||re(n);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Ln(t.Oa,e,i?11:12))return 0;if(i&&re(n)&&yn(),e.da)alert("todo:use_scaling");else{if(r){if(t.Ib=ce,e.Kb){if(n=e.U+1>>1,t.memory=a(e.U+2*n),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+n,t.Ib=ue,yn()}}else alert("todo:EmitYUV");i&&(t.Jb=he,r&&gn())}if(r&&!Ti){for(e=0;256>e;++e)Bi[e]=89858*(e-128)+Ci>>Si,Ri[e]=-22014*(e-128)+Ci,Fi[e]=-45773*(e-128),Mi[e]=113618*(e-128)+Ci>>Si;for(e=Ei;e<Ni;++e)t=76283*(e-16)+Ci>>Si,Li[e-Ei]=Ge(t,255),Pi[e-Ei]=Ge(t+8>>4,15);Ti=1}return 1}function Ae(e){var n=e.ma,r=e.U,i=e.T;return t(!(1&e.ka)),0>=r||0>=i?0:(r=n.Ib(e,n),null!=n.Jb&&n.Jb(e,n,r),n.Dc+=r,1)}function pe(e){e.ma.memory=null}function fe(e,t,n,r){return 47!=v(e,8)?0:(t[0]=v(e,14)+1,n[0]=v(e,14)+1,r[0]=v(e,1),0!=v(e,3)?0:!e.h)}function ge(e,t){if(4>e)return e+1;var n=e-2>>1;return(2+(1&e)<<n)+v(t,n)+1}function me(e,t){return 120<t?t-120:1<=(n=((n=Jr[t-1])>>4)*e+(8-(15&n)))?n:1;var n}function ye(e,t,n){var r=w(n),i=e[t+=255&r].g-8;return 0<i&&(S(n,n.u+8),r=w(n),t+=e[t].value,t+=r&(1<<i)-1),S(n,n.u+e[t].g),e[t].value}function ve(e,n,r){return r.g+=e.g,r.value+=e.value<<n>>>0,t(8>=r.g),e.g}function be(e,n,r){var i=e.xc;return t((n=0==i?0:e.vc[e.md*(r>>i)+(n>>i)])<e.Wb),e.Ya[n]}function xe(e,n,i,a){var s=e.ab,o=e.c*n,l=e.C;n=l+n;var c=i,u=a;for(a=e.Ta,i=e.Ua;0<s--;){var h=e.gc[s],d=l,A=n,p=c,f=u,g=(u=a,c=i,h.Ea);switch(t(d<A),t(A<=h.nc),h.hc){case 2:Wn(p,f,(A-d)*g,u,c);break;case 0:var m=d,y=A,v=u,b=c,x=(E=h).Ea;0==m&&(Vn(p,f,null,null,1,v,b),G(p,f+1,0,0,x-1,v,b+1),f+=x,b+=x,++m);for(var w=1<<E.b,_=w-1,S=U(x,E.b),C=E.K,E=E.w+(m>>E.b)*S;m<y;){var N=C,k=E,I=1;for(Gn(p,f,v,b-x,1,v,b);I<x;){var T=(I&~_)+w;T>x&&(T=x),(0,Jn[N[k++]>>8&15])(p,f+ +I,v,b+I-x,T-I,v,b+I),I=T}f+=x,b+=x,++m&_||(E+=S)}A!=h.nc&&r(u,c-g,u,c+(A-d-1)*g,g);break;case 1:for(g=p,y=f,x=(p=h.Ea)-(b=p&~(v=(f=1<<h.b)-1)),m=U(p,h.b),w=h.K,h=h.w+(d>>h.b)*m;d<A;){for(_=w,S=h,C=new j,E=y+b,N=y+p;y<E;)q(_[S++],C),Zn(C,g,y,f,u,c),y+=f,c+=f;y<N&&(q(_[S++],C),Zn(C,g,y,x,u,c),y+=x,c+=x),++d&v||(h+=m)}break;case 3:if(p==u&&f==c&&0<h.b){for(y=u,p=g=c+(A-d)*g-(b=(A-d)*U(h.Ea,h.b)),f=u,v=c,m=[],b=(x=b)-1;0<=b;--b)m[b]=f[v+b];for(b=x-1;0<=b;--b)y[p+b]=m[b];qn(h,d,A,u,g,u,c)}else qn(h,d,A,p,f,u,c)}c=a,u=i}u!=i&&r(a,i,c,u,o)}function we(e,n){var r=e.V,i=e.Ba+e.c*e.C,a=n-e.C;if(t(n<=e.l.o),t(16>=a),0<a){var s=e.l,o=e.Ta,l=e.Ua,c=s.width;if(xe(e,a,r,i),a=l=[l],t((r=e.C)<(i=n)),t(s.v<s.va),i>s.o&&(i=s.o),r<s.j){var u=s.j-r;r=s.j,a[0]+=u*c}if(r>=i?r=0:(a[0]+=4*s.v,s.ka=r-s.j,s.U=s.va-s.v,s.T=i-r,r=1),r){if(l=l[0],11>(r=e.ca).S){var h=r.f.RGBA,d=(i=r.S,a=s.U,s=s.T,u=h.eb,h.A),A=s;for(h=h.fb+e.Ma*h.A;0<A--;){var p=o,f=l,g=a,m=u,y=h;switch(i){case Lr:$n(p,f,g,m,y);break;case Pr:er(p,f,g,m,y);break;case Hr:er(p,f,g,m,y),wr(m,y,0,g,1,0);break;case Ur:rr(p,f,g,m,y);break;case Dr:te(p,f,g,m,y,1);break;case Qr:te(p,f,g,m,y,1),wr(m,y,0,g,1,0);break;case Or:te(p,f,g,m,y,0);break;case Vr:te(p,f,g,m,y,0),wr(m,y,1,g,1,0);break;case jr:tr(p,f,g,m,y);break;case Gr:tr(p,f,g,m,y),_r(m,y,g,1,0);break;case zr:nr(p,f,g,m,y);break;default:t(0)}l+=c,h+=d}e.Ma+=s}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=r.height)}}e.C=n,t(e.C<=e.i)}function _e(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var n=e.Ya[t].G,r=e.Ya[t].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Se(e,n,r,i,a,s){if(0!=e.Z){var o=e.qd,l=e.rd;for(t(null!=fi[e.Z]);n<r;++n)fi[e.Z](o,l,i,a,i,a,s),o=i,l=a,a+=s;e.qd=o,e.rd=l}}function Ce(e,n){var r=e.l.ma,i=0==r.Z||1==r.Z?e.l.j:e.C;if(i=e.C<i?i:e.C,t(n<=e.l.o),n>i){var a=e.l.width,s=r.ca,o=r.tb+a*i,l=e.V,c=e.Ba+e.c*i,u=e.gc;t(1==e.ab),t(3==u[0].hc),Xn(u[0],i,n,l,c,s,o),Se(r,i,n,s,o,a)}e.C=e.Ma=n}function Ee(e,n,r,i,a,s,o){var l=e.$/i,c=e.$%i,u=e.m,h=e.s,d=r+e.$,A=d;a=r+i*a;var p=r+i*s,f=280+h.ua,g=e.Pb?l:16777216,m=0<h.ua?h.Wa:null,y=h.wc,v=d<p?be(h,c,l):null;t(e.C<s),t(p<=a);var b=!1;e:for(;;){for(;b||d<p;){var x=0;if(l>=g){var E=d-r;t((g=e).Pb),g.wd=g.m,g.xd=E,0<g.s.ua&&R(g.s.Wa,g.s.vb),g=l+$r}if(c&y||(v=be(h,c,l)),t(null!=v),v.Qb&&(n[d]=v.qb,b=!0),!b)if(C(u),v.jc){x=u,E=n;var N=d,k=v.pd[w(x)&Dn-1];t(v.jc),256>k.g?(S(x,x.u+k.g),E[N]=k.value,x=0):(S(x,x.u+k.g-256),t(256<=k.value),x=k.value),0==x&&(b=!0)}else x=ye(v.G[0],v.H[0],u);if(u.h)break;if(b||256>x){if(!b)if(v.nd)n[d]=(v.qb|x<<8)>>>0;else{if(C(u),b=ye(v.G[1],v.H[1],u),C(u),E=ye(v.G[2],v.H[2],u),N=ye(v.G[3],v.H[3],u),u.h)break;n[d]=(N<<24|b<<16|x<<8|E)>>>0}if(b=!1,++d,++c>=i&&(c=0,++l,null!=o&&l<=s&&!(l%16)&&o(e,l),null!=m))for(;A<d;)x=n[A++],m.X[(506832829*x&4294967295)>>>m.Mb]=x}else if(280>x){if(x=ge(x-256,u),E=ye(v.G[4],v.H[4],u),C(u),E=me(i,E=ge(E,u)),u.h)break;if(d-r<E||a-d<x)break e;for(N=0;N<x;++N)n[d+N]=n[d+N-E];for(d+=x,c+=x;c>=i;)c-=i,++l,null!=o&&l<=s&&!(l%16)&&o(e,l);if(t(d<=a),c&y&&(v=be(h,c,l)),null!=m)for(;A<d;)x=n[A++],m.X[(506832829*x&4294967295)>>>m.Mb]=x}else{if(!(x<f))break e;for(b=x-280,t(null!=m);A<d;)x=n[A++],m.X[(506832829*x&4294967295)>>>m.Mb]=x;x=d,t(!(b>>>(E=m).Xa)),n[x]=E.X[b],b=!0}b||t(u.h==_(u))}if(e.Pb&&u.h&&d<a)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&R(e.s.vb,e.s.Wa);else{if(u.h)break e;null!=o&&o(e,l>s?s:l),e.a=0,e.$=d-r}return 1}return e.a=3,0}function Ne(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var n=e.Wa;null!=n&&(n.X=null),e.vb=null,t(null!=e)}function ke(){var t=new sn;return null==t?null:(t.a=0,t.xb=pi,ne("Predictor","VP8LPredictors"),ne("Predictor","VP8LPredictors_C"),ne("PredictorAdd","VP8LPredictorsAdd"),ne("PredictorAdd","VP8LPredictorsAdd_C"),Wn=W,Zn=K,$n=Y,er=J,tr=Z,nr=$,rr=ee,e.VP8LMapColor32b=Kn,e.VP8LMapColor8b=Yn,t)}function Ie(e,n,r,o,l){var c=1,d=[e],p=[n],f=o.m,g=o.s,m=null,y=0;e:for(;;){if(r)for(;c&&v(f,1);){var b=d,x=p,_=o,E=1,N=_.m,k=_.gc[_.ab],I=v(N,2);if(_.Oc&1<<I)c=0;else{switch(_.Oc|=1<<I,k.hc=I,k.Ea=b[0],k.nc=x[0],k.K=[null],++_.ab,t(4>=_.ab),I){case 0:case 1:k.b=v(N,3)+2,E=Ie(U(k.Ea,k.b),U(k.nc,k.b),0,_,k.K),k.K=k.K[0];break;case 3:var T,B=v(N,8)+1,M=16<B?0:4<B?1:2<B?2:3;if(b[0]=U(k.Ea,M),k.b=M,T=E=Ie(B,1,0,_,k.K)){var R,L=B,P=k,O=1<<(8>>P.b),j=a(O);if(null==j)T=0;else{var z=P.K[0],H=P.w;for(j[0]=P.K[0][0],R=1;R<1*L;++R)j[R]=D(z[H+R],j[R-1]);for(;R<4*O;++R)j[R]=0;P.K[0]=null,P.K[0]=j,T=1}}E=T;break;case 2:break;default:t(0)}c=E}}if(d=d[0],p=p[0],c&&v(f,1)&&!(c=1<=(y=v(f,4))&&11>=y)){o.a=3;break e}var Q;if(Q=c)t:{var V,G,W,q=o,K=d,X=p,Y=y,J=r,Z=q.m,$=q.s,ee=[null],te=1,ne=0,re=Zr[Y];n:for(;;){if(J&&v(Z,1)){var ie=v(Z,3)+2,ae=U(K,ie),se=U(X,ie),oe=ae*se;if(!Ie(ae,se,0,q,ee))break n;for(ee=ee[0],$.xc=ie,V=0;V<oe;++V){var le=ee[V]>>8&65535;ee[V]=le,le>=te&&(te=le+1)}}if(Z.h)break n;for(G=0;5>G;++G){var ce=Kr[G];!G&&0<Y&&(ce+=1<<Y),ne<ce&&(ne=ce)}var ue=s(te*re,h),he=te,de=s(he,A);if(null==de)var Ae=null;else t(65536>=he),Ae=de;var pe=a(ne);if(null==Ae||null==pe||null==ue){q.a=1;break n}var fe=ue;for(V=W=0;V<te;++V){var ge=Ae[V],me=ge.G,ye=ge.H,be=0,xe=1,we=0;for(G=0;5>G;++G){ce=Kr[G],me[G]=fe,ye[G]=W,!G&&0<Y&&(ce+=1<<Y);r:{var _e,Se=ce,Ce=q,ke=pe,Te=fe,Be=W,Me=0,Fe=Ce.m,Re=v(Fe,1);if(i(ke,0,0,Se),Re){var Le=v(Fe,1)+1,Pe=v(Fe,1),Ue=v(Fe,0==Pe?1:8);ke[Ue]=1,2==Le&&(ke[Ue=v(Fe,8)]=1);var De=1}else{var Oe=a(19),je=v(Fe,4)+4;if(19<je){Ce.a=3;var ze=0;break r}for(_e=0;_e<je;++_e)Oe[Yr[_e]]=v(Fe,3);var He=void 0,Qe=void 0,Ve=Ce,Ge=Oe,We=Se,qe=ke,Ke=0,Xe=Ve.m,Ye=8,Je=s(128,h);i:for(;u(Je,0,7,Ge,19);){if(v(Xe,1)){var Ze=2+2*v(Xe,3);if((He=2+v(Xe,Ze))>We)break i}else He=We;for(Qe=0;Qe<We&&He--;){C(Xe);var $e=Je[0+(127&w(Xe))];S(Xe,Xe.u+$e.g);var et=$e.value;if(16>et)qe[Qe++]=et,0!=et&&(Ye=et);else{var tt=16==et,nt=et-16,rt=qr[nt],it=v(Xe,Wr[nt])+rt;if(Qe+it>We)break i;for(var at=tt?Ye:0;0<it--;)qe[Qe++]=at}}Ke=1;break i}Ke||(Ve.a=3),De=Ke}(De=De&&!Fe.h)&&(Me=u(Te,Be,8,ke,Se)),De&&0!=Me?ze=Me:(Ce.a=3,ze=0)}if(0==ze)break n;if(xe&&1==Xr[G]&&(xe=0==fe[W].g),be+=fe[W].g,W+=ze,3>=G){var st,ot=pe[0];for(st=1;st<ce;++st)pe[st]>ot&&(ot=pe[st]);we+=ot}}if(ge.nd=xe,ge.Qb=0,xe&&(ge.qb=(me[3][ye[3]+0].value<<24|me[1][ye[1]+0].value<<16|me[2][ye[2]+0].value)>>>0,0==be&&256>me[0][ye[0]+0].value&&(ge.Qb=1,ge.qb+=me[0][ye[0]+0].value<<8)),ge.jc=!ge.Qb&&6>we,ge.jc){var lt,ct=ge;for(lt=0;lt<Dn;++lt){var ut=lt,ht=ct.pd[ut],dt=ct.G[0][ct.H[0]+ut];256<=dt.value?(ht.g=dt.g+256,ht.value=dt.value):(ht.g=0,ht.value=0,ut>>=ve(dt,8,ht),ut>>=ve(ct.G[1][ct.H[1]+ut],16,ht),ut>>=ve(ct.G[2][ct.H[2]+ut],0,ht),ve(ct.G[3][ct.H[3]+ut],24,ht))}}}$.vc=ee,$.Wb=te,$.Ya=Ae,$.yc=ue,Q=1;break t}Q=0}if(!(c=Q)){o.a=3;break e}if(0<y){if(g.ua=1<<y,!F(g.Wa,y)){o.a=1,c=0;break e}}else g.ua=0;var At=o,pt=d,ft=p,gt=At.s,mt=gt.xc;if(At.c=pt,At.i=ft,gt.md=U(pt,mt),gt.wc=0==mt?-1:(1<<mt)-1,r){o.xb=Ai;break e}if(null==(m=a(d*p))){o.a=1,c=0;break e}c=(c=Ee(o,m,0,d,p,p,null))&&!f.h;break e}return c?(null!=l?l[0]=m:(t(null==m),t(r)),o.$=0,r||Ne(g)):Ne(g),c}function Te(e,n){var r=e.c*e.i,i=r+n+16*n;return t(e.c<=n),e.V=a(i),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+r+n,1)}function Be(e,n){var r=e.C,i=n-r,a=e.V,s=e.Ba+e.c*r;for(t(n<=e.l.o);0<i;){var o=16<i?16:i,l=e.l.ma,c=e.l.width,u=c*o,h=l.ca,d=l.tb+c*r,A=e.Ta,p=e.Ua;xe(e,o,a,s),Cr(A,p,h,d,u),Se(l,r,r+o,h,d,c),i-=o,a+=o*e.c,r+=o}t(r==n),e.C=e.Ma=n}function Me(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Re(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function Le(){this.Yb=function(){var e=[];return function e(t,n,r){for(var i=r[n],a=0;a<i&&(t.push(r.length>n+1?[]:0),!(r.length<n+1));a++)e(t[a],n+1,r)}(e,0,[3,11]),e}()}function Pe(){this.jb=a(3),this.Wc=o([4,8],Le),this.Xc=o([4,17],Le)}function Ue(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function De(){this.ld=this.La=this.dd=this.tc=0}function Oe(){this.Na=this.la=0}function je(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ze(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function He(){this.uc=this.M=this.Nb=0,this.wa=Array(new De),this.Y=0,this.ya=Array(new ze),this.aa=0,this.l=new We}function Qe(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Ve(){this.cb=this.a=0,this.sc="",this.m=new b,this.Od=new Me,this.Kc=new Fe,this.ed=new Ue,this.Qa=new Re,this.Ic=this.$c=this.Aa=0,this.D=new He,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=s(8,b),this.ia=0,this.pb=s(4,je),this.Pa=new Pe,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Qe),this.Hd=0,this.rb=Array(new Oe),this.sb=0,this.wa=Array(new De),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ze),this.L=this.aa=0,this.gd=o([4,2],De),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ge(e,t){return 0>e?0:e>t?t:e}function We(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function qe(){var e=new Ve;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ni||(ni=Je)),e}function Ke(e,t,n){return 0==e.a&&(e.a=t,e.sc=n,e.cb=0),0}function Xe(e,t,n){return 3<=n&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Ye(e,n){if(null==e)return 0;if(e.a=0,e.sc="OK",null==n)return Ke(e,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,a=n.w,s=n.ha;if(4>s)return Ke(e,7,"Truncated header.");var o=r[a+0]|r[a+1]<<8|r[a+2]<<16,l=e.Od;if(l.Rb=!(1&o),l.td=o>>1&7,l.yd=o>>4&1,l.ub=o>>5,3<l.td)return Ke(e,3,"Incorrect keyframe parameters.");if(!l.yd)return Ke(e,4,"Frame not displayable.");a+=3,s-=3;var c=e.Kc;if(l.Rb){if(7>s)return Ke(e,7,"cannot parse picture header");if(!Xe(r,a,s))return Ke(e,3,"Bad code word");c.c=16383&(r[a+4]<<8|r[a+3]),c.Td=r[a+4]>>6,c.i=16383&(r[a+6]<<8|r[a+5]),c.Ud=r[a+6]>>6,a+=7,s-=7,e.za=c.c+15>>4,e.Ub=c.i+15>>4,n.width=c.c,n.height=c.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,i((o=e.Pa).jb,0,255,o.jb.length),t(null!=(o=e.Qa)),o.Cb=0,o.Bb=0,o.Fb=1,i(o.Zb,0,0,o.Zb.length),i(o.Lb,0,0,o.Lb)}if(l.ub>s)return Ke(e,7,"bad partition length");p(o=e.m,r,a,l.ub),a+=l.ub,s-=l.ub,l.Rb&&(c.Ld=N(o),c.Kd=N(o)),c=e.Qa;var u,h=e.Pa;if(t(null!=o),t(null!=c),c.Cb=N(o),c.Cb){if(c.Bb=N(o),N(o)){for(c.Fb=N(o),u=0;4>u;++u)c.Zb[u]=N(o)?g(o,7):0;for(u=0;4>u;++u)c.Lb[u]=N(o)?g(o,6):0}if(c.Bb)for(u=0;3>u;++u)h.jb[u]=N(o)?f(o,8):255}else c.Bb=0;if(o.Ka)return Ke(e,3,"cannot parse segment header");if((c=e.ed).zd=N(o),c.Tb=f(o,6),c.wb=f(o,3),c.Pc=N(o),c.Pc&&N(o)){for(h=0;4>h;++h)N(o)&&(c.vd[h]=g(o,6));for(h=0;4>h;++h)N(o)&&(c.od[h]=g(o,6))}if(e.L=0==c.Tb?0:c.zd?1:2,o.Ka)return Ke(e,3,"cannot parse filter header");var d=s;if(s=u=a,a=u+d,c=d,e.Xb=(1<<f(e.m,2))-1,d<3*(h=e.Xb))r=7;else{for(u+=3*h,c-=3*h,d=0;d<h;++d){var A=r[s+0]|r[s+1]<<8|r[s+2]<<16;A>c&&(A=c),p(e.Jc[+d],r,u,A),u+=A,c-=A,s+=3}p(e.Jc[+h],r,u,c),r=u<a?0:5}if(0!=r)return Ke(e,r,"cannot parse partitions");for(r=f(u=e.m,7),s=N(u)?g(u,4):0,a=N(u)?g(u,4):0,c=N(u)?g(u,4):0,h=N(u)?g(u,4):0,u=N(u)?g(u,4):0,d=e.Qa,A=0;4>A;++A){if(d.Cb){var m=d.Zb[A];d.Fb||(m+=r)}else{if(0<A){e.pb[A]=e.pb[0];continue}m=r}var y=e.pb[A];y.Sc[0]=ei[Ge(m+s,127)],y.Sc[1]=ti[Ge(m+0,127)],y.Eb[0]=2*ei[Ge(m+a,127)],y.Eb[1]=101581*ti[Ge(m+c,127)]>>16,8>y.Eb[1]&&(y.Eb[1]=8),y.Qc[0]=ei[Ge(m+h,117)],y.Qc[1]=ti[Ge(m+u,127)],y.lc=m+u}if(!l.Rb)return Ke(e,4,"Not a key frame.");for(N(o),l=e.Pa,r=0;4>r;++r){for(s=0;8>s;++s)for(a=0;3>a;++a)for(c=0;11>c;++c)h=k(o,li[r][s][a][c])?f(o,8):si[r][s][a][c],l.Wc[r][s].Yb[a][c]=h;for(s=0;17>s;++s)l.Xc[r][s]=l.Wc[r][ci[s]]}return e.kc=N(o),e.kc&&(e.Bd=f(o,8)),e.cb=1}function Je(e,t,n,r,i,a,s){var o=t[i].Yb[n];for(n=0;16>i;++i){if(!k(e,o[n+0]))return i;for(;!k(e,o[n+1]);)if(o=t[++i].Yb[0],n=0,16==i)return 16;var l=t[i+1].Yb;if(k(e,o[n+2])){var c=e,u=0;if(k(c,(d=o)[(h=n)+3]))if(k(c,d[h+6])){for(o=0,h=2*(u=k(c,d[h+8]))+(d=k(c,d[h+9+u])),u=0,d=ri[h];d[o];++o)u+=u+k(c,d[o]);u+=3+(8<<h)}else k(c,d[h+7])?(u=7+2*k(c,165),u+=k(c,145)):u=5+k(c,159);else u=k(c,d[h+4])?3+k(c,d[h+5]):2;o=l[2]}else u=1,o=l[1];l=s+ii[i],0>(c=e).b&&E(c);var h,d=c.b,A=(h=c.Ca>>1)-(c.I>>d)>>31;--c.b,c.Ca+=A,c.Ca|=1,c.I-=(h+1&A)<<d,a[l]=((u^A)-A)*r[(0<i)+0]}return 16}function Ze(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,i(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,t,n,r,i){i=e[t+n+32*r]+(i>>3),e[t+n+32*r]=-256&i?0>i?0:255:i}function et(e,t,n,r,i,a){$e(e,t,0,n,r+i),$e(e,t,1,n,r+a),$e(e,t,2,n,r-a),$e(e,t,3,n,r-i)}function tt(e){return(20091*e>>16)+e}function nt(e,t,n,r){var i,s=0,o=a(16);for(i=0;4>i;++i){var l=e[t+0]+e[t+8],c=e[t+0]-e[t+8],u=(35468*e[t+4]>>16)-tt(e[t+12]),h=tt(e[t+4])+(35468*e[t+12]>>16);o[s+0]=l+h,o[s+1]=c+u,o[s+2]=c-u,o[s+3]=l-h,s+=4,t++}for(i=s=0;4>i;++i)l=(e=o[s+0]+4)+o[s+8],c=e-o[s+8],u=(35468*o[s+4]>>16)-tt(o[s+12]),$e(n,r,0,0,l+(h=tt(o[s+4])+(35468*o[s+12]>>16))),$e(n,r,1,0,c+u),$e(n,r,2,0,c-u),$e(n,r,3,0,l-h),s++,r+=32}function rt(e,t,n,r){var i=e[t+0]+4,a=35468*e[t+4]>>16,s=tt(e[t+4]),o=35468*e[t+1]>>16;et(n,r,0,i+s,e=tt(e[t+1]),o),et(n,r,1,i+a,e,o),et(n,r,2,i-a,e,o),et(n,r,3,i-s,e,o)}function it(e,t,n,r,i){nt(e,t,n,r),i&&nt(e,t+16,n,r+4)}function at(e,t,n,r){ar(e,t+0,n,r,1),ar(e,t+32,n,r+128,1)}function st(e,t,n,r){var i;for(e=e[t+0]+4,i=0;4>i;++i)for(t=0;4>t;++t)$e(n,r,t,i,e)}function ot(e,t,n,r){e[t+0]&&lr(e,t+0,n,r),e[t+16]&&lr(e,t+16,n,r+4),e[t+32]&&lr(e,t+32,n,r+128),e[t+48]&&lr(e,t+48,n,r+128+4)}function lt(e,t,n,r){var i,s=a(16);for(i=0;4>i;++i){var o=e[t+0+i]+e[t+12+i],l=e[t+4+i]+e[t+8+i],c=e[t+4+i]-e[t+8+i],u=e[t+0+i]-e[t+12+i];s[0+i]=o+l,s[8+i]=o-l,s[4+i]=u+c,s[12+i]=u-c}for(i=0;4>i;++i)o=(e=s[0+4*i]+3)+s[3+4*i],l=s[1+4*i]+s[2+4*i],c=s[1+4*i]-s[2+4*i],u=e-s[3+4*i],n[r+0]=o+l>>3,n[r+16]=u+c>>3,n[r+32]=o-l>>3,n[r+48]=u-c>>3,r+=64}function ct(e,t,n){var r,i=t-32,a=Fr,s=255-e[i-1];for(r=0;r<n;++r){var o,l=a,c=s+e[t-1];for(o=0;o<n;++o)e[t+o]=l[c+e[i+o]];t+=32}}function ut(e,t){ct(e,t,4)}function ht(e,t){ct(e,t,8)}function dt(e,t){ct(e,t,16)}function At(e,t){var n;for(n=0;16>n;++n)r(e,t+32*n,e,t-32,16)}function pt(e,t){var n;for(n=16;0<n;--n)i(e,t,e[t-1],16),t+=32}function ft(e,t,n){var r;for(r=0;16>r;++r)i(t,n+32*r,e,16)}function gt(e,t){var n,r=16;for(n=0;16>n;++n)r+=e[t-1+32*n]+e[t+n-32];ft(r>>5,e,t)}function mt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t-1+32*n];ft(r>>4,e,t)}function yt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t+n-32];ft(r>>4,e,t)}function vt(e,t){ft(128,e,t)}function bt(e,t,n){return e+2*t+n+2>>2}function xt(e,t){var n,i=t-32;for(i=new Uint8Array([bt(e[i-1],e[i+0],e[i+1]),bt(e[i+0],e[i+1],e[i+2]),bt(e[i+1],e[i+2],e[i+3]),bt(e[i+2],e[i+3],e[i+4])]),n=0;4>n;++n)r(e,t+32*n,i,0,i.length)}function wt(e,t){var n=e[t-1],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96];I(e,t+0,16843009*bt(e[t-1-32],n,r)),I(e,t+32,16843009*bt(n,r,i)),I(e,t+64,16843009*bt(r,i,a)),I(e,t+96,16843009*bt(i,a,a))}function _t(e,t){var n,r=4;for(n=0;4>n;++n)r+=e[t+n-32]+e[t-1+32*n];for(r>>=3,n=0;4>n;++n)i(e,t+32*n,r,4)}function St(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1-32],s=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+96]=bt(r,i,e[t-1+96]),e[t+1+96]=e[t+0+64]=bt(n,r,i),e[t+2+96]=e[t+1+64]=e[t+0+32]=bt(a,n,r),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=bt(s,a,n),e[t+3+64]=e[t+2+32]=e[t+1+0]=bt(o,s,a),e[t+3+32]=e[t+2+0]=bt(l,o,s),e[t+3+0]=bt(c,l,o)}function Ct(e,t){var n=e[t+1-32],r=e[t+2-32],i=e[t+3-32],a=e[t+4-32],s=e[t+5-32],o=e[t+6-32],l=e[t+7-32];e[t+0+0]=bt(e[t+0-32],n,r),e[t+1+0]=e[t+0+32]=bt(n,r,i),e[t+2+0]=e[t+1+32]=e[t+0+64]=bt(r,i,a),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=bt(i,a,s),e[t+3+32]=e[t+2+64]=e[t+1+96]=bt(a,s,o),e[t+3+64]=e[t+2+96]=bt(s,o,l),e[t+3+96]=bt(o,l,l)}function Et(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1-32],s=e[t+0-32],o=e[t+1-32],l=e[t+2-32],c=e[t+3-32];e[t+0+0]=e[t+1+64]=a+s+1>>1,e[t+1+0]=e[t+2+64]=s+o+1>>1,e[t+2+0]=e[t+3+64]=o+l+1>>1,e[t+3+0]=l+c+1>>1,e[t+0+96]=bt(i,r,n),e[t+0+64]=bt(r,n,a),e[t+0+32]=e[t+1+96]=bt(n,a,s),e[t+1+32]=e[t+2+96]=bt(a,s,o),e[t+2+32]=e[t+3+96]=bt(s,o,l),e[t+3+32]=bt(o,l,c)}function Nt(e,t){var n=e[t+0-32],r=e[t+1-32],i=e[t+2-32],a=e[t+3-32],s=e[t+4-32],o=e[t+5-32],l=e[t+6-32],c=e[t+7-32];e[t+0+0]=n+r+1>>1,e[t+1+0]=e[t+0+64]=r+i+1>>1,e[t+2+0]=e[t+1+64]=i+a+1>>1,e[t+3+0]=e[t+2+64]=a+s+1>>1,e[t+0+32]=bt(n,r,i),e[t+1+32]=e[t+0+96]=bt(r,i,a),e[t+2+32]=e[t+1+96]=bt(i,a,s),e[t+3+32]=e[t+2+96]=bt(a,s,o),e[t+3+64]=bt(s,o,l),e[t+3+96]=bt(o,l,c)}function kt(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96];e[t+0+0]=n+r+1>>1,e[t+2+0]=e[t+0+32]=r+i+1>>1,e[t+2+32]=e[t+0+64]=i+a+1>>1,e[t+1+0]=bt(n,r,i),e[t+3+0]=e[t+1+32]=bt(r,i,a),e[t+3+32]=e[t+1+64]=bt(i,a,a),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=a}function It(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96],s=e[t-1-32],o=e[t+0-32],l=e[t+1-32],c=e[t+2-32];e[t+0+0]=e[t+2+32]=n+s+1>>1,e[t+0+32]=e[t+2+64]=r+n+1>>1,e[t+0+64]=e[t+2+96]=i+r+1>>1,e[t+0+96]=a+i+1>>1,e[t+3+0]=bt(o,l,c),e[t+2+0]=bt(s,o,l),e[t+1+0]=e[t+3+32]=bt(n,s,o),e[t+1+32]=e[t+3+64]=bt(r,n,s),e[t+1+64]=e[t+3+96]=bt(i,r,n),e[t+1+96]=bt(a,i,r)}function Tt(e,t){var n;for(n=0;8>n;++n)r(e,t+32*n,e,t-32,8)}function Bt(e,t){var n;for(n=0;8>n;++n)i(e,t,e[t-1],8),t+=32}function Mt(e,t,n){var r;for(r=0;8>r;++r)i(t,n+32*r,e,8)}function Ft(e,t){var n,r=8;for(n=0;8>n;++n)r+=e[t+n-32]+e[t-1+32*n];Mt(r>>4,e,t)}function Rt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t+n-32];Mt(r>>3,e,t)}function Lt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t-1+32*n];Mt(r>>3,e,t)}function Pt(e,t){Mt(128,e,t)}function Ut(e,t,n){var r=e[t-n],i=e[t+0],a=3*(i-r)+Br[1020+e[t-2*n]-e[t+n]],s=Mr[112+(a+4>>3)];e[t-n]=Fr[255+r+Mr[112+(a+3>>3)]],e[t+0]=Fr[255+i-s]}function Dt(e,t,n,r){var i=e[t+0],a=e[t+n];return Rr[255+e[t-2*n]-e[t-n]]>r||Rr[255+a-i]>r}function Ot(e,t,n,r){return 4*Rr[255+e[t-n]-e[t+0]]+Rr[255+e[t-2*n]-e[t+n]]<=r}function jt(e,t,n,r,i){var a=e[t-3*n],s=e[t-2*n],o=e[t-n],l=e[t+0],c=e[t+n],u=e[t+2*n],h=e[t+3*n];return 4*Rr[255+o-l]+Rr[255+s-c]>r?0:Rr[255+e[t-4*n]-a]<=i&&Rr[255+a-s]<=i&&Rr[255+s-o]<=i&&Rr[255+h-u]<=i&&Rr[255+u-c]<=i&&Rr[255+c-l]<=i}function zt(e,t,n,r){var i=2*r+1;for(r=0;16>r;++r)Ot(e,t+r,n,i)&&Ut(e,t+r,n)}function Ht(e,t,n,r){var i=2*r+1;for(r=0;16>r;++r)Ot(e,t+r*n,1,i)&&Ut(e,t+r*n,1)}function Qt(e,t,n,r){var i;for(i=3;0<i;--i)zt(e,t+=4*n,n,r)}function Vt(e,t,n,r){var i;for(i=3;0<i;--i)Ht(e,t+=4,n,r)}function Gt(e,t,n,r,i,a,s,o){for(a=2*a+1;0<i--;){if(jt(e,t,n,a,s))if(Dt(e,t,n,o))Ut(e,t,n);else{var l=e,c=t,u=n,h=l[c-2*u],d=l[c-u],A=l[c+0],p=l[c+u],f=l[c+2*u],g=27*(y=Br[1020+3*(A-d)+Br[1020+h-p]])+63>>7,m=18*y+63>>7,y=9*y+63>>7;l[c-3*u]=Fr[255+l[c-3*u]+y],l[c-2*u]=Fr[255+h+m],l[c-u]=Fr[255+d+g],l[c+0]=Fr[255+A-g],l[c+u]=Fr[255+p-m],l[c+2*u]=Fr[255+f-y]}t+=r}}function Wt(e,t,n,r,i,a,s,o){for(a=2*a+1;0<i--;){if(jt(e,t,n,a,s))if(Dt(e,t,n,o))Ut(e,t,n);else{var l=e,c=t,u=n,h=l[c-u],d=l[c+0],A=l[c+u],p=Mr[112+(4+(f=3*(d-h))>>3)],f=Mr[112+(f+3>>3)],g=p+1>>1;l[c-2*u]=Fr[255+l[c-2*u]+g],l[c-u]=Fr[255+h+f],l[c+0]=Fr[255+d-p],l[c+u]=Fr[255+A-g]}t+=r}}function qt(e,t,n,r,i,a){Gt(e,t,n,1,16,r,i,a)}function Kt(e,t,n,r,i,a){Gt(e,t,1,n,16,r,i,a)}function Xt(e,t,n,r,i,a){var s;for(s=3;0<s;--s)Wt(e,t+=4*n,n,1,16,r,i,a)}function Yt(e,t,n,r,i,a){var s;for(s=3;0<s;--s)Wt(e,t+=4,1,n,16,r,i,a)}function Jt(e,t,n,r,i,a,s,o){Gt(e,t,i,1,8,a,s,o),Gt(n,r,i,1,8,a,s,o)}function Zt(e,t,n,r,i,a,s,o){Gt(e,t,1,i,8,a,s,o),Gt(n,r,1,i,8,a,s,o)}function $t(e,t,n,r,i,a,s,o){Wt(e,t+4*i,i,1,8,a,s,o),Wt(n,r+4*i,i,1,8,a,s,o)}function en(e,t,n,r,i,a,s,o){Wt(e,t+4,1,i,8,a,s,o),Wt(n,r+4,1,i,8,a,s,o)}function tn(){this.ba=new se,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new le,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function nn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function rn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function an(){this.ua=0,this.Wa=new L,this.vb=new L,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new A,this.yc=new h}function sn(){this.xb=this.a=0,this.l=new We,this.ca=new se,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new x,this.Pb=0,this.wd=new x,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new an,this.ab=0,this.gc=s(4,rn),this.Oc=0}function on(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new We,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(e,t,n,r,i,a,s){for(e=null==e?0:e[t+0],t=0;t<s;++t)i[a+t]=e+n[r+t]&255,e=i[a+t]}function cn(e,t,n,r,i,a,s){var o;if(null==e)ln(null,null,n,r,i,a,s);else for(o=0;o<s;++o)i[a+o]=e[t+o]+n[r+o]&255}function un(e,t,n,r,i,a,s){if(null==e)ln(null,null,n,r,i,a,s);else{var o,l=e[t+0],c=l,u=l;for(o=0;o<s;++o)c=u+(l=e[t+o])-c,u=n[r+o]+(-256&c?0>c?0:255:c)&255,c=l,i[a+o]=u}}function hn(e,n,i,s){var o=n.width,l=n.o;if(t(null!=e&&null!=n),0>i||0>=s||i+s>l)return null;if(!e.Cc){if(null==e.ga){var c;if(e.ga=new on,(c=null==e.ga)||(c=n.width*n.o,t(0==e.Gb.length),e.Gb=a(c),e.Uc=0,null==e.Gb?c=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,c=1),c=!c),!c){c=e.ga;var u=e.Fa,h=e.P,d=e.qc,A=e.mb,p=e.nb,f=h+1,g=d-1,y=c.l;if(t(null!=u&&null!=A&&null!=n),fi[0]=null,fi[1]=ln,fi[2]=cn,fi[3]=un,c.ca=A,c.tb=p,c.c=n.width,c.i=n.height,t(0<c.c&&0<c.i),1>=d)n=0;else if(c.$a=3&u[h+0],c.Z=u[h+0]>>2&3,c.Lc=u[h+0]>>4&3,h=u[h+0]>>6&3,0>c.$a||1<c.$a||4<=c.Z||1<c.Lc||h)n=0;else if(y.put=Ae,y.ac=de,y.bc=pe,y.ma=c,y.width=n.width,y.height=n.height,y.Da=n.Da,y.v=n.v,y.va=n.va,y.j=n.j,y.o=n.o,c.$a)e:{t(1==c.$a),n=ke();t:for(;;){if(null==n){n=0;break e}if(t(null!=c),c.mc=n,n.c=c.c,n.i=c.i,n.l=c.l,n.l.ma=c,n.l.width=c.c,n.l.height=c.i,n.a=0,m(n.m,u,f,g),!Ie(c.c,c.i,1,n,null))break t;if(1==n.ab&&3==n.gc[0].hc&&_e(n.s)?(c.ic=1,u=n.c*n.i,n.Ta=null,n.Ua=0,n.V=a(u),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(c.ic=0,n=Te(n,c.c)),!n)break t;n=1;break e}c.mc=null,n=0}else n=g>=c.c*c.i;c=!n}if(c)return null;1!=e.ga.Lc?e.Ga=0:s=l-i}t(null!=e.ga),t(i+s<=l);e:{if(n=(u=e.ga).c,l=u.l.o,0==u.$a){if(f=e.rc,g=e.Vc,y=e.Fa,h=e.P+1+i*n,d=e.mb,A=e.nb+i*n,t(h<=e.P+e.qc),0!=u.Z)for(t(null!=fi[u.Z]),c=0;c<s;++c)fi[u.Z](f,g,y,h,d,A,n),f=d,g=A,A+=n,h+=n;else for(c=0;c<s;++c)r(d,A,y,h,n),f=d,g=A,A+=n,h+=n;e.rc=f,e.Vc=g}else{if(t(null!=u.mc),n=i+s,t(null!=(c=u.mc)),t(n<=c.i),c.C>=n)n=1;else if(u.ic||gn(),u.ic){u=c.V,f=c.Ba,g=c.c;var v=c.i,b=(y=1,h=c.$/g,d=c.$%g,A=c.m,p=c.s,c.$),x=g*v,w=g*n,S=p.wc,E=b<w?be(p,d,h):null;t(b<=x),t(n<=v),t(_e(p));t:for(;;){for(;!A.h&&b<w;){if(d&S||(E=be(p,d,h)),t(null!=E),C(A),256>(v=ye(E.G[0],E.H[0],A)))u[f+b]=v,++b,++d>=g&&(d=0,++h<=n&&!(h%16)&&Ce(c,h));else{if(!(280>v)){y=0;break t}v=ge(v-256,A);var N,k=ye(E.G[4],E.H[4],A);if(C(A),!(b>=(k=me(g,k=ge(k,A)))&&x-b>=v)){y=0;break t}for(N=0;N<v;++N)u[f+b+N]=u[f+b+N-k];for(b+=v,d+=v;d>=g;)d-=g,++h<=n&&!(h%16)&&Ce(c,h);b<w&&d&S&&(E=be(p,d,h))}t(A.h==_(A))}Ce(c,h>n?n:h);break t}!y||A.h&&b<x?(y=0,c.a=A.h?5:3):c.$=b,n=y}else n=Ee(c,c.V,c.Ba,c.c,c.i,n,Be);if(!n){s=0;break e}}i+s>=l&&(e.Cc=1),s=1}if(!s)return null;if(e.Cc&&(null!=(s=e.ga)&&(s.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+i*o}function dn(e,t,n,r,i,a){for(;0<i--;){var s,o=e,l=t+(n?1:0),c=e,u=t+(n?0:3);for(s=0;s<r;++s){var h=c[u+4*s];255!=h&&(h*=32897,o[l+4*s+0]=o[l+4*s+0]*h>>23,o[l+4*s+1]=o[l+4*s+1]*h>>23,o[l+4*s+2]=o[l+4*s+2]*h>>23)}t+=a}}function An(e,t,n,r,i){for(;0<r--;){var a;for(a=0;a<n;++a){var s=e[t+2*a+0],o=15&(c=e[t+2*a+1]),l=4369*o,c=(240&c|c>>4)*l>>16;e[t+2*a+0]=(240&s|s>>4)*l>>16&240|(15&s|s<<4)*l>>16>>4&15,e[t+2*a+1]=240&c|o}t+=i}}function pn(e,t,n,r,i,a,s,o){var l,c,u=255;for(c=0;c<i;++c){for(l=0;l<r;++l){var h=e[t+l];a[s+4*l]=h,u&=h}t+=n,s+=o}return 255!=u}function fn(e,t,n,r,i){var a;for(a=0;a<i;++a)n[r+a]=e[t+a]>>8}function gn(){wr=dn,_r=An,Sr=pn,Cr=fn}function mn(n,r,i){e[n]=function(e,n,a,s,o,l,c,u,h,d,A,p,f,g,m,y,v){var b,x=v-1>>1,w=o[l+0]|c[u+0]<<16,_=h[d+0]|A[p+0]<<16;t(null!=e);var S=3*w+_+131074>>2;for(r(e[n+0],255&S,S>>16,f,g),null!=a&&(S=3*_+w+131074>>2,r(a[s+0],255&S,S>>16,m,y)),b=1;b<=x;++b){var C=o[l+b]|c[u+b]<<16,E=h[d+b]|A[p+b]<<16,N=w+C+_+E+524296,k=N+2*(C+_)>>3;S=k+w>>1,w=(N=N+2*(w+E)>>3)+C>>1,r(e[n+2*b-1],255&S,S>>16,f,g+(2*b-1)*i),r(e[n+2*b-0],255&w,w>>16,f,g+(2*b-0)*i),null!=a&&(S=N+_>>1,w=k+E>>1,r(a[s+2*b-1],255&S,S>>16,m,y+(2*b-1)*i),r(a[s+2*b+0],255&w,w>>16,m,y+(2*b+0)*i)),w=C,_=E}1&v||(S=3*w+_+131074>>2,r(e[n+v-1],255&S,S>>16,f,g+(v-1)*i),null!=a&&(S=3*_+w+131074>>2,r(a[s+v-1],255&S,S>>16,m,y+(v-1)*i)))}}function yn(){gi[Lr]=mi,gi[Pr]=vi,gi[Ur]=yi,gi[Dr]=bi,gi[Or]=xi,gi[jr]=wi,gi[zr]=_i,gi[Hr]=vi,gi[Qr]=bi,gi[Vr]=xi,gi[Gr]=wi}function vn(e){return e&~Ii?0>e?0:255:e>>ki}function bn(e,t){return vn((19077*e>>8)+(26149*t>>8)-14234)}function xn(e,t,n){return vn((19077*e>>8)-(6419*t>>8)-(13320*n>>8)+8708)}function wn(e,t){return vn((19077*e>>8)+(33050*t>>8)-17685)}function _n(e,t,n,r,i){r[i+0]=bn(e,n),r[i+1]=xn(e,t,n),r[i+2]=wn(e,t)}function Sn(e,t,n,r,i){r[i+0]=wn(e,t),r[i+1]=xn(e,t,n),r[i+2]=bn(e,n)}function Cn(e,t,n,r,i){var a=xn(e,t,n);t=a<<3&224|wn(e,t)>>3,r[i+0]=248&bn(e,n)|a>>5,r[i+1]=t}function En(e,t,n,r,i){var a=240&wn(e,t)|15;r[i+0]=240&bn(e,n)|xn(e,t,n)>>4,r[i+1]=a}function Nn(e,t,n,r,i){r[i+0]=255,_n(e,t,n,r,i+1)}function kn(e,t,n,r,i){Sn(e,t,n,r,i),r[i+3]=255}function In(e,t,n,r,i){_n(e,t,n,r,i),r[i+3]=255}function Ge(e,t){return 0>e?0:e>t?t:e}function Tn(t,n,r){e[t]=function(e,t,i,a,s,o,l,c,u){for(var h=c+(-2&u)*r;c!=h;)n(e[t+0],i[a+0],s[o+0],l,c),n(e[t+1],i[a+0],s[o+0],l,c+r),t+=2,++a,++o,c+=2*r;1&u&&n(e[t+0],i[a+0],s[o+0],l,c)}}function Bn(e,t,n){return 0==n?0==e?0==t?6:5:0==t?4:0:n}function Mn(e,t,n,r,i){switch(e>>>30){case 3:ar(t,n,r,i,0);break;case 2:sr(t,n,r,i);break;case 1:lr(t,n,r,i)}}function Fn(e,t){var n,a,s=t.M,o=t.Nb,l=e.oc,c=e.pc+40,u=e.oc,h=e.pc+584,d=e.oc,A=e.pc+600;for(n=0;16>n;++n)l[c+32*n-1]=129;for(n=0;8>n;++n)u[h+32*n-1]=129,d[A+32*n-1]=129;for(0<s?l[c-1-32]=u[h-1-32]=d[A-1-32]=129:(i(l,c-32-1,127,21),i(u,h-32-1,127,9),i(d,A-32-1,127,9)),a=0;a<e.za;++a){var p=t.ya[t.aa+a];if(0<a){for(n=-1;16>n;++n)r(l,c+32*n-4,l,c+32*n+12,4);for(n=-1;8>n;++n)r(u,h+32*n-4,u,h+32*n+4,4),r(d,A+32*n-4,d,A+32*n+4,4)}var f=e.Gd,g=e.Hd+a,m=p.ad,y=p.Hc;if(0<s&&(r(l,c-32,f[g].y,0,16),r(u,h-32,f[g].f,0,8),r(d,A-32,f[g].ea,0,8)),p.Za){var v=l,b=c-32+16;for(0<s&&(a>=e.za-1?i(v,b,f[g].y[15],4):r(v,b,f[g+1].y,0,4)),n=0;4>n;n++)v[b+128+n]=v[b+256+n]=v[b+384+n]=v[b+0+n];for(n=0;16>n;++n,y<<=2)v=l,b=c+Ui[n],hi[p.Ob[n]](v,b),Mn(y,m,16*+n,v,b)}else if(v=Bn(a,s,p.Ob[0]),ui[v](l,c),0!=y)for(n=0;16>n;++n,y<<=2)Mn(y,m,16*+n,l,c+Ui[n]);for(n=p.Gc,v=Bn(a,s,p.Dd),di[v](u,h),di[v](d,A),y=m,v=u,b=h,255&(p=0|n)&&(170&p?or(y,256,v,b):cr(y,256,v,b)),p=d,y=A,255&(n>>=8)&&(170&n?or(m,320,p,y):cr(m,320,p,y)),s<e.Ub-1&&(r(f[g].y,0,l,c+480,16),r(f[g].f,0,u,h+224,8),r(f[g].ea,0,d,A+224,8)),n=8*o*e.B,f=e.sa,g=e.ta+16*a+16*o*e.R,m=e.qa,p=e.ra+8*a+n,y=e.Ha,v=e.Ia+8*a+n,n=0;16>n;++n)r(f,g+n*e.R,l,c+32*n,16);for(n=0;8>n;++n)r(m,p+n*e.B,u,h+32*n,8),r(y,v+n*e.B,d,A+32*n,8)}}function Rn(e,r,i,a,s,o,l,c,u){var h=[0],d=[0],A=0,p=null!=u?u.kd:0,f=null!=u?u:new nn;if(null==e||12>i)return 7;f.data=e,f.w=r,f.ha=i,r=[r],i=[i],f.gb=[f.gb];e:{var g=r,y=i,v=f.gb;if(t(null!=e),t(null!=y),t(null!=v),v[0]=0,12<=y[0]&&!n(e,g[0],"RIFF")){if(n(e,g[0]+8,"WEBP")){v=3;break e}var b=M(e,g[0]+4);if(12>b||4294967286<b){v=3;break e}if(p&&b>y[0]-8){v=7;break e}v[0]=b,g[0]+=12,y[0]-=12}v=0}if(0!=v)return v;for(b=0<f.gb[0],i=i[0];;){e:{var w=e;y=r,v=i;var _=h,S=d,C=g=[0];if((k=A=[A])[0]=0,8>v[0])v=7;else{if(!n(w,y[0],"VP8X")){if(10!=M(w,y[0]+4)){v=3;break e}if(18>v[0]){v=7;break e}var E=M(w,y[0]+8),N=1+B(w,y[0]+12);if(2147483648<=N*(w=1+B(w,y[0]+15))){v=3;break e}null!=C&&(C[0]=E),null!=_&&(_[0]=N),null!=S&&(S[0]=w),y[0]+=18,v[0]-=18,k[0]=1}v=0}}if(A=A[0],g=g[0],0!=v)return v;if(y=!!(2&g),!b&&A)return 3;if(null!=o&&(o[0]=!!(16&g)),null!=l&&(l[0]=y),null!=c&&(c[0]=0),l=h[0],g=d[0],A&&y&&null==u){v=0;break}if(4>i){v=7;break}if(b&&A||!b&&!A&&!n(e,r[0],"ALPH")){i=[i],f.na=[f.na],f.P=[f.P],f.Sa=[f.Sa];e:{E=e,v=r,b=i;var k=f.gb;_=f.na,S=f.P,C=f.Sa,N=22,t(null!=E),t(null!=b),w=v[0];var I=b[0];for(t(null!=_),t(null!=C),_[0]=null,S[0]=null,C[0]=0;;){if(v[0]=w,b[0]=I,8>I){v=7;break e}var T=M(E,w+4);if(4294967286<T){v=3;break e}var F=8+T+1&-2;if(N+=F,0<k&&N>k){v=3;break e}if(!n(E,w,"VP8 ")||!n(E,w,"VP8L")){v=0;break e}if(I[0]<F){v=7;break e}n(E,w,"ALPH")||(_[0]=E,S[0]=w+8,C[0]=T),w+=F,I-=F}}if(i=i[0],f.na=f.na[0],f.P=f.P[0],f.Sa=f.Sa[0],0!=v)break}i=[i],f.Ja=[f.Ja],f.xa=[f.xa];e:if(k=e,v=r,b=i,_=f.gb[0],S=f.Ja,C=f.xa,E=v[0],w=!n(k,E,"VP8 "),N=!n(k,E,"VP8L"),t(null!=k),t(null!=b),t(null!=S),t(null!=C),8>b[0])v=7;else{if(w||N){if(k=M(k,E+4),12<=_&&k>_-12){v=3;break e}if(p&&k>b[0]-8){v=7;break e}S[0]=k,v[0]+=8,b[0]-=8,C[0]=N}else C[0]=5<=b[0]&&47==k[E+0]&&!(k[E+4]>>5),S[0]=b[0];v=0}if(i=i[0],f.Ja=f.Ja[0],f.xa=f.xa[0],r=r[0],0!=v)break;if(4294967286<f.Ja)return 3;if(null==c||y||(c[0]=f.xa?2:1),l=[l],g=[g],f.xa){if(5>i){v=7;break}c=l,p=g,y=o,null==e||5>i?e=0:5<=i&&47==e[r+0]&&!(e[r+4]>>5)?(b=[0],k=[0],_=[0],m(S=new x,e,r,i),fe(S,b,k,_)?(null!=c&&(c[0]=b[0]),null!=p&&(p[0]=k[0]),null!=y&&(y[0]=_[0]),e=1):e=0):e=0}else{if(10>i){v=7;break}c=g,null==e||10>i||!Xe(e,r+3,i-3)?e=0:(p=e[r+0]|e[r+1]<<8|e[r+2]<<16,y=16383&(e[r+7]<<8|e[r+6]),e=16383&(e[r+9]<<8|e[r+8]),1&p||3<(p>>1&7)||!(p>>4&1)||p>>5>=f.Ja||!y||!e?e=0:(l&&(l[0]=y),c&&(c[0]=e),e=1))}if(!e)return 3;if(l=l[0],g=g[0],A&&(h[0]!=l||d[0]!=g))return 3;null!=u&&(u[0]=f,u.offset=r-u.w,t(4294967286>r-u.w),t(u.offset==u.ha-i));break}return 0==v||7==v&&A&&null==u?(null!=o&&(o[0]|=null!=f.na&&0<f.na.length),null!=a&&(a[0]=l),null!=s&&(s[0]=g),0):v}function Ln(e,t,n){var r=t.width,i=t.height,a=0,s=0,o=r,l=i;if(t.Da=null!=e&&0<e.Da,t.Da&&(o=e.cd,l=e.bd,a=e.v,s=e.j,11>n||(a&=-2,s&=-2),0>a||0>s||0>=o||0>=l||a+o>r||s+l>i))return 0;if(t.v=a,t.j=s,t.va=a+o,t.o=s+l,t.U=o,t.T=l,t.da=null!=e&&0<e.da,t.da){if(!P(o,l,n=[e.ib],a=[e.hb]))return 0;t.ib=n[0],t.hb=a[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*r/4&&t.hb<3*i/4,t.Kb=0),1}function Pn(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Un(e,t,n,r){if(null==r||0>=e||0>=t)return 2;if(null!=n){if(n.Da){var i=n.cd,s=n.bd,o=-2&n.v,l=-2&n.j;if(0>o||0>l||0>=i||0>=s||o+i>e||l+s>t)return 2;e=i,t=s}if(n.da){if(!P(e,t,i=[n.ib],s=[n.hb]))return 2;e=i[0],t=s[0]}}r.width=e,r.height=t;e:{var c=r.width,u=r.height;if(e=r.S,0>=c||0>=u||!(e>=Lr&&13>e))e=2;else{if(0>=r.Rd&&null==r.sd){o=s=i=t=0;var h=(l=c*ji[e])*u;if(11>e||(s=(u+1)/2*(t=(c+1)/2),12==e&&(o=(i=c)*u)),null==(u=a(h+2*s+o))){e=1;break e}r.sd=u,11>e?((c=r.f.RGBA).eb=u,c.fb=0,c.A=l,c.size=h):((c=r.f.kb).y=u,c.O=0,c.fa=l,c.Fd=h,c.f=u,c.N=0+h,c.Ab=t,c.Cd=s,c.ea=u,c.W=0+h+s,c.Db=t,c.Ed=s,12==e&&(c.F=u,c.J=0+h+2*s),c.Tc=o,c.lb=i)}if(t=1,i=r.S,s=r.width,o=r.height,i>=Lr&&13>i)if(11>i)e=r.f.RGBA,t&=(l=Math.abs(e.A))*(o-1)+s<=e.size,t&=l>=s*ji[i],t&=null!=e.eb;else{e=r.f.kb,l=(s+1)/2,h=(o+1)/2,c=Math.abs(e.fa),u=Math.abs(e.Ab);var d=Math.abs(e.Db),A=Math.abs(e.lb),p=A*(o-1)+s;t&=c*(o-1)+s<=e.Fd,t&=u*(h-1)+l<=e.Cd,t=(t&=d*(h-1)+l<=e.Ed)&c>=s&u>=l&d>=l,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==i&&(t&=A>=s,t&=p<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=n&&n.fd&&(e=Pn(r)),e}var Dn=64,On=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],jn=24,zn=32,Hn=8,Qn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];O("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,n){return t[n+0]},e.Predictor3=function(e,t,n){return t[n+1]},e.Predictor4=function(e,t,n){return t[n-1]},e.Predictor5=function(e,t,n){return z(z(e,t[n+1]),t[n+0])},e.Predictor6=function(e,t,n){return z(e,t[n-1])},e.Predictor7=function(e,t,n){return z(e,t[n+0])},e.Predictor8=function(e,t,n){return z(t[n-1],t[n+0])},e.Predictor9=function(e,t,n){return z(t[n+0],t[n+1])},e.Predictor10=function(e,t,n){return z(z(e,t[n-1]),z(t[n+0],t[n+1]))},e.Predictor11=function(e,t,n){var r=t[n+0];return 0>=V(r>>24&255,e>>24&255,(t=t[n-1])>>24&255)+V(r>>16&255,e>>16&255,t>>16&255)+V(r>>8&255,e>>8&255,t>>8&255)+V(255&r,255&e,255&t)?r:e},e.Predictor12=function(e,t,n){var r=t[n+0];return(H((e>>24&255)+(r>>24&255)-((t=t[n-1])>>24&255))<<24|H((e>>16&255)+(r>>16&255)-(t>>16&255))<<16|H((e>>8&255)+(r>>8&255)-(t>>8&255))<<8|H((255&e)+(255&r)-(255&t)))>>>0},e.Predictor13=function(e,t,n){var r=t[n-1];return(Q((e=z(e,t[n+0]))>>24&255,r>>24&255)<<24|Q(e>>16&255,r>>16&255)<<16|Q(e>>8&255,r>>8&255)<<8|Q(255&e,255&r))>>>0};var Vn=e.PredictorAdd0;e.PredictorAdd1=G,O("Predictor2","PredictorAdd2"),O("Predictor3","PredictorAdd3"),O("Predictor4","PredictorAdd4"),O("Predictor5","PredictorAdd5"),O("Predictor6","PredictorAdd6"),O("Predictor7","PredictorAdd7"),O("Predictor8","PredictorAdd8"),O("Predictor9","PredictorAdd9"),O("Predictor10","PredictorAdd10"),O("Predictor11","PredictorAdd11"),O("Predictor12","PredictorAdd12"),O("Predictor13","PredictorAdd13");var Gn=e.PredictorAdd2;X("ColorIndexInverseTransform","MapARGB","32b",function(e){return e>>8&255},function(e){return e}),X("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(e){return e},function(e){return e>>8&255});var Wn,qn=e.ColorIndexInverseTransform,Kn=e.MapARGB,Xn=e.VP8LColorIndexInverseTransformAlpha,Yn=e.MapAlpha,Jn=e.VP8LPredictorsAdd=[];Jn.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var Zn,$n,er,tr,nr,rr,ir,ar,sr,or,lr,cr,ur,hr,dr,Ar,pr,fr,gr,mr,yr,vr,br,xr,wr,_r,Sr,Cr,Er=a(511),Nr=a(2041),kr=a(225),Ir=a(767),Tr=0,Br=Nr,Mr=kr,Fr=Ir,Rr=Er,Lr=0,Pr=1,Ur=2,Dr=3,Or=4,jr=5,zr=6,Hr=7,Qr=8,Vr=9,Gr=10,Wr=[2,3,7],qr=[3,3,11],Kr=[280,256,256,256,40],Xr=[0,1,1,1,0],Yr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Jr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Zr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],$r=8,ei=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ti=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ni=null,ri=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ii=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ai=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],si=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],oi=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],li=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ci=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ui=[],hi=[],di=[],Ai=1,pi=2,fi=[],gi=[];mn("UpsampleRgbLinePair",_n,3),mn("UpsampleBgrLinePair",Sn,3),mn("UpsampleRgbaLinePair",In,4),mn("UpsampleBgraLinePair",kn,4),mn("UpsampleArgbLinePair",Nn,4),mn("UpsampleRgba4444LinePair",En,2),mn("UpsampleRgb565LinePair",Cn,2);var mi=e.UpsampleRgbLinePair,yi=e.UpsampleBgrLinePair,vi=e.UpsampleRgbaLinePair,bi=e.UpsampleBgraLinePair,xi=e.UpsampleArgbLinePair,wi=e.UpsampleRgba4444LinePair,_i=e.UpsampleRgb565LinePair,Si=16,Ci=1<<Si-1,Ei=-227,Ni=482,ki=6,Ii=(256<<ki)-1,Ti=0,Bi=a(256),Mi=a(256),Fi=a(256),Ri=a(256),Li=a(Ni-Ei),Pi=a(Ni-Ei);Tn("YuvToRgbRow",_n,3),Tn("YuvToBgrRow",Sn,3),Tn("YuvToRgbaRow",In,4),Tn("YuvToBgraRow",kn,4),Tn("YuvToArgbRow",Nn,4),Tn("YuvToRgba4444Row",En,2),Tn("YuvToRgb565Row",Cn,2);var Ui=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Di=[0,2,8],Oi=[8,7,6,4,4,2,2,2,1,1,1,1];this.WebPDecodeRGBA=function(e,n,o,l,c){var u=Pr,h=new tn,d=new se;h.ba=d,d.S=u,d.width=[d.width],d.height=[d.height];var A=d.width,p=d.height,f=new oe;if(null==f||null==e)var g=2;else t(null!=f),g=Rn(e,n,o,f.width,f.height,f.Pd,f.Qd,f.format,null);if(0!=g?A=0:(null!=A&&(A[0]=f.width[0]),null!=p&&(p[0]=f.height[0]),A=1),A){d.width=d.width[0],d.height=d.height[0],null!=l&&(l[0]=d.width),null!=c&&(c[0]=d.height);e:{if(l=new We,(c=new nn).data=e,c.w=n,c.ha=o,c.kd=1,n=[0],t(null!=c),(0==(e=Rn(c.data,c.w,c.ha,null,null,null,n,null,c))||7==e)&&n[0]&&(e=4),0==(n=e)){if(t(null!=h),l.data=c.data,l.w=c.w+c.offset,l.ha=c.ha-c.offset,l.put=Ae,l.ac=de,l.bc=pe,l.ma=h,c.xa){if(null==(e=ke())){h=1;break e}if(function(e,n){var r=[0],i=[0],a=[0];t:for(;;){if(null==e)return 0;if(null==n)return e.a=2,0;if(e.l=n,e.a=0,m(e.m,n.data,n.w,n.ha),!fe(e.m,r,i,a)){e.a=3;break t}if(e.xb=pi,n.width=r[0],n.height=i[0],!Ie(r[0],i[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,l)){if(l=0==(n=Un(l.width,l.height,h.Oa,h.ba))){t:{l=e;n:for(;;){if(null==l){l=0;break t}if(t(null!=l.s.yc),t(null!=l.s.Ya),t(0<l.s.Wb),t(null!=(o=l.l)),t(null!=(c=o.ma)),0!=l.xb){if(l.ca=c.ba,l.tb=c.tb,t(null!=l.ca),!Ln(c.Oa,o,Dr)){l.a=2;break n}if(!Te(l,o.width))break n;if(o.da)break n;if((o.da||re(l.ca.S))&&gn(),11>l.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=l.ca.f.kb.F&&gn()),l.Pb&&0<l.s.ua&&null==l.s.vb.X&&!F(l.s.vb,l.s.Wa.Xa)){l.a=1;break n}l.xb=0}if(!Ee(l,l.V,l.Ba,l.c,l.i,o.o,we))break n;c.Dc=l.Ma,l=1;break t}t(0!=l.a),l=0}l=!l}l&&(n=e.a)}else n=e.a}else{if(null==(e=new qe)){h=1;break e}if(e.Fa=c.na,e.P=c.P,e.qc=c.Sa,Ye(e,l)){if(0==(n=Un(l.width,l.height,h.Oa,h.ba))){if(e.Aa=0,o=h.Oa,t(null!=(c=e)),null!=o){if(0<(A=0>(A=o.Md)?0:100<A?255:255*A/100)){for(p=f=0;4>p;++p)12>(g=c.pb[p]).lc&&(g.ia=A*Oi[0>g.lc?0:g.lc]>>3),f|=g.ia;f&&(alert("todo:VP8InitRandom"),c.ia=1)}c.Ga=o.Id,100<c.Ga?c.Ga=100:0>c.Ga&&(c.Ga=0)}(function(e,n){if(null==e)return 0;if(null==n)return Ke(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Ye(e,n))return 0;if(t(e.cb),null==n.ac||n.ac(n)){n.ob&&(e.L=0);var o=Di[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=n.v-o>>4,e.zb=n.j-o>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=n.o+15+o>>4,e.Hb=n.va+15+o>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var l=e.ed;for(o=0;4>o;++o){var c;if(e.Qa.Cb){var u=e.Qa.Lb[o];e.Qa.Fb||(u+=l.Tb)}else u=l.Tb;for(c=0;1>=c;++c){var h=e.gd[o][c],d=u;if(l.Pc&&(d+=l.vd[0],c&&(d+=l.od[0])),0<(d=0>d?0:63<d?63:d)){var A=d;0<l.wb&&(A=4<l.wb?A>>2:A>>1)>9-l.wb&&(A=9-l.wb),1>A&&(A=1),h.dd=A,h.tc=2*d+A,h.ld=40<=d?2:15<=d?1:0}else h.tc=0;h.La=c}}}o=0}else Ke(e,6,"Frame setup failed"),o=e.a;if(o=0==o){if(o){e.$c=0,0<e.Aa||(e.Ic=1);t:{o=e.Ic,l=4*(A=e.za);var p=32*A,f=A+1,g=0<e.L?A*(0<e.Aa?2:1):0,m=(2==e.Aa?2:1)*A;if((h=l+832+(c=3*(16*o+Di[e.L])/2*p)+(u=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=h)o=0;else{if(h>e.Vb){if(e.Vb=0,e.Ec=a(h),e.Fc=0,null==e.Ec){o=Ke(e,1,"no memory during frame initialization.");break t}e.Vb=h}h=e.Ec,d=e.Fc,e.Ac=h,e.Bc=d,d+=l,e.Gd=s(p,Qe),e.Hd=0,e.rb=s(f+1,Oe),e.sb=1,e.wa=g?s(g,De):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=A),t(!0),e.oc=h,e.pc=d,d+=832,e.ya=s(m,ze),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=A),e.R=16*A,e.B=8*A,A=(p=Di[e.L])*e.R,p=p/2*e.B,e.sa=h,e.ta=d+A,e.qa=e.sa,e.ra=e.ta+16*o*e.R+p,e.Ha=e.qa,e.Ia=e.ra+8*o*e.B+p,e.$c=0,d+=c,e.mb=u?h:null,e.nb=u?d:null,t(d+u<=e.Fc+e.Vb),Ze(e),i(e.Ac,e.Bc,0,l),o=1}}if(o){if(n.ka=0,n.y=e.sa,n.O=e.ta,n.f=e.qa,n.N=e.ra,n.ea=e.Ha,n.Vd=e.Ia,n.fa=e.R,n.Rc=e.B,n.F=null,n.J=0,!Tr){for(o=-255;255>=o;++o)Er[255+o]=0>o?-o:o;for(o=-1020;1020>=o;++o)Nr[1020+o]=-128>o?-128:127<o?127:o;for(o=-112;112>=o;++o)kr[112+o]=-16>o?-16:15<o?15:o;for(o=-255;510>=o;++o)Ir[255+o]=0>o?0:255<o?255:o;Tr=1}ir=lt,ar=it,or=at,lr=st,cr=ot,sr=rt,ur=qt,hr=Kt,dr=Jt,Ar=Zt,pr=Xt,fr=Yt,gr=$t,mr=en,yr=zt,vr=Ht,br=Qt,xr=Vt,hi[0]=_t,hi[1]=ut,hi[2]=xt,hi[3]=wt,hi[4]=St,hi[5]=Et,hi[6]=Ct,hi[7]=Nt,hi[8]=It,hi[9]=kt,ui[0]=gt,ui[1]=dt,ui[2]=At,ui[3]=pt,ui[4]=mt,ui[5]=yt,ui[6]=vt,di[0]=Ft,di[1]=ht,di[2]=Tt,di[3]=Bt,di[4]=Lt,di[5]=Rt,di[6]=Pt,o=1}else o=0}o&&(o=function(e,n){for(e.M=0;e.M<e.Va;++e.M){var s,o=e.Jc[e.M&e.Xb],l=e.m,c=e;for(s=0;s<c.za;++s){var u=l,h=c,d=h.Ac,A=h.Bc+4*s,p=h.zc,f=h.ya[h.aa+s];if(h.Qa.Bb?f.$b=k(u,h.Pa.jb[0])?2+k(u,h.Pa.jb[2]):k(u,h.Pa.jb[1]):f.$b=0,h.kc&&(f.Ad=k(u,h.Bd)),f.Za=!k(u,145)+0,f.Za){var g=f.Ob,m=0;for(h=0;4>h;++h){var y,v=p[0+h];for(y=0;4>y;++y){v=oi[d[A+y]][v];for(var b=ai[k(u,v[0])];0<b;)b=ai[2*b+k(u,v[b])];v=-b,d[A+y]=v}r(g,m,d,A,4),m+=4,p[0+h]=v}}else v=k(u,156)?k(u,128)?1:3:k(u,163)?2:0,f.Ob[0]=v,i(d,A,v,4),i(p,0,v,4);f.Dd=k(u,142)?k(u,114)?k(u,183)?1:3:2:0}if(c.m.Ka)return Ke(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(c=o,u=(l=e).rb[l.sb-1],d=l.rb[l.sb+l.ja],s=l.ya[l.aa+l.ja],A=l.kc?s.Ad:0)u.la=d.la=0,s.Za||(u.Na=d.Na=0),s.Hc=0,s.Gc=0,s.ia=0;else{var x,w;if(u=d,d=c,A=l.Pa.Xc,p=l.ya[l.aa+l.ja],f=l.pb[p.$b],h=p.ad,g=0,m=l.rb[l.sb-1],v=y=0,i(h,g,0,384),p.Za)var _=0,S=A[3];else{b=a(16);var C=u.Na+m.Na;if(C=ni(d,A[1],C,f.Eb,0,b,0),u.Na=m.Na=(0<C)+0,1<C)ir(b,0,h,g);else{var E=b[0]+3>>3;for(b=0;256>b;b+=16)h[g+b]=E}_=1,S=A[0]}var N=15&u.la,I=15&m.la;for(b=0;4>b;++b){var T=1&I;for(E=w=0;4>E;++E)N=N>>1|(T=(C=ni(d,S,C=T+(1&N),f.Sc,_,h,g))>_)<<7,w=w<<2|(3<C?3:1<C?2:0!=h[g+0]),g+=16;N>>=4,I=I>>1|T<<7,y=(y<<8|w)>>>0}for(S=N,_=I>>4,x=0;4>x;x+=2){for(w=0,N=u.la>>4+x,I=m.la>>4+x,b=0;2>b;++b){for(T=1&I,E=0;2>E;++E)C=T+(1&N),N=N>>1|(T=0<(C=ni(d,A[2],C,f.Qc,0,h,g)))<<3,w=w<<2|(3<C?3:1<C?2:0!=h[g+0]),g+=16;N>>=2,I=I>>1|T<<5}v|=w<<4*x,S|=N<<4<<x,_|=(240&I)<<x}u.la=S,m.la=_,p.Hc=y,p.Gc=v,p.ia=43690&v?0:f.ia,A=!(y|v)}if(0<l.L&&(l.wa[l.Y+l.ja]=l.gd[s.$b][s.Za],l.wa[l.Y+l.ja].La|=!A),c.Ka)return Ke(e,7,"Premature end-of-file encountered.")}if(Ze(e),l=n,c=1,s=(o=e).D,u=0<o.L&&o.M>=o.zb&&o.M<=o.Va,0==o.Aa)t:{if(s.M=o.M,s.uc=u,Fn(o,s),c=1,s=(w=o.D).Nb,u=(v=Di[o.L])*o.R,d=v/2*o.B,b=16*s*o.R,E=8*s*o.B,A=o.sa,p=o.ta-u+b,f=o.qa,h=o.ra-d+E,g=o.Ha,m=o.Ia-d+E,I=0==(N=w.M),y=N>=o.Va-1,2==o.Aa&&Fn(o,w),w.uc)for(T=(C=o).D.M,t(C.D.uc),w=C.yb;w<C.Hb;++w){_=w,S=T;var B=(M=(z=C).D).Nb;x=z.R;var M=M.wa[M.Y+_],F=z.sa,R=z.ta+16*B*x+16*_,L=M.dd,P=M.tc;if(0!=P)if(t(3<=P),1==z.L)0<_&&vr(F,R,x,P+4),M.La&&xr(F,R,x,P),0<S&&yr(F,R,x,P+4),M.La&&br(F,R,x,P);else{var U=z.B,D=z.qa,O=z.ra+8*B*U+8*_,j=z.Ha,z=z.Ia+8*B*U+8*_;B=M.ld,0<_&&(hr(F,R,x,P+4,L,B),Ar(D,O,j,z,U,P+4,L,B)),M.La&&(fr(F,R,x,P,L,B),mr(D,O,j,z,U,P,L,B)),0<S&&(ur(F,R,x,P+4,L,B),dr(D,O,j,z,U,P+4,L,B)),M.La&&(pr(F,R,x,P,L,B),gr(D,O,j,z,U,P,L,B))}}if(o.ia&&alert("todo:DitherRow"),null!=l.put){if(w=16*N,N=16*(N+1),I?(l.y=o.sa,l.O=o.ta+b,l.f=o.qa,l.N=o.ra+E,l.ea=o.Ha,l.W=o.Ia+E):(w-=v,l.y=A,l.O=p,l.f=f,l.N=h,l.ea=g,l.W=m),y||(N-=v),N>l.o&&(N=l.o),l.F=null,l.J=null,null!=o.Fa&&0<o.Fa.length&&w<N&&(l.J=hn(o,l,w,N-w),l.F=o.mb,null==l.F&&0==l.F.length)){c=Ke(o,3,"Could not decode alpha data.");break t}w<l.j&&(v=l.j-w,w=l.j,t(!(1&v)),l.O+=o.R*v,l.N+=o.B*(v>>1),l.W+=o.B*(v>>1),null!=l.F&&(l.J+=l.width*v)),w<N&&(l.O+=l.v,l.N+=l.v>>1,l.W+=l.v>>1,null!=l.F&&(l.J+=l.v),l.ka=w-l.j,l.U=l.va-l.v,l.T=N-w,c=l.put(l))}s+1!=o.Ic||y||(r(o.sa,o.ta-u,A,p+16*o.R,u),r(o.qa,o.ra-d,f,h+8*o.B,d),r(o.Ha,o.Ia-d,g,m+8*o.B,d))}if(!c)return Ke(e,6,"Output aborted.")}return 1}(e,n)),null!=n.bc&&n.bc(n),o&=1}return o?(e.cb=0,o):0})(e,l)||(n=e.a)}}else n=e.a}0==n&&null!=h.Oa&&h.Oa.fd&&(n=Pn(h.ba))}h=n}u=0!=h?null:11>u?d.f.RGBA.eb:d.f.kb.y}else u=null;return u};var ji=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(e,t){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(e[t++]);return n}function u(e,t){return e[t+0]|e[t+1]<<8}function h(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function d(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new l;var A=[0],p=[0],f=[],g=new l,m=e,y=function(e,t){var n={},r=0,i=!1,a=0,s=0;if(n.frames=[],!function(e,t){for(var n=0;n<4;n++)if(e[t+n]!="RIFF".charCodeAt(n))return!0;return!1}(e,t)){for(d(e,t+=4),t+=8;t<e.length;){var o=c(e,t),l=d(e,t+=4);t+=4;var A=l+(1&l);switch(o){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(g=n.frames[r]).src_off=i?s:t-8,g.src_size=a+l+8,r++,i&&(i=!1,a=0,s=0);break;case"VP8X":(g=n.header={}).feature_flags=e[t];var p=t+4;g.canvas_width=1+h(e,p),p+=3,g.canvas_height=1+h(e,p),p+=3;break;case"ALPH":i=!0,a=A+8,s=t-8;break;case"ANIM":(g=n.header).bgcolor=d(e,t),p=t+4,g.loop_count=u(e,p),p+=2;break;case"ANMF":var f,g;(g=n.frames[r]={}).offset_x=2*h(e,t),t+=3,g.offset_y=2*h(e,t),t+=3,g.width=1+h(e,t),t+=3,g.height=1+h(e,t),t+=3,g.duration=h(e,t),t+=3,f=e[t++],g.dispose=1&f,g.blend=f>>1&1}"ANMF"!=o&&(t+=A)}return n}}(m,0);y.response=m,y.rgbaoutput=!0,y.dataurl=!1;var v=y.header?y.header:null,b=y.frames?y.frames:null;if(v){v.loop_counter=v.loop_count,A=[v.canvas_height],p=[v.canvas_width];for(var x=0;x<b.length&&0!=b[x].blend;x++);}var w=b[0],_=g.WebPDecodeRGBA(m,w.src_off,w.src_size,p,A);w.rgba=_,w.imgwidth=p[0],w.imgheight=A[0];for(var S=0;S<p[0]*A[0]*4;S++)f[S]=_[S];return this.width=p,this.height=A,this.data=f,this}!function(e){var t,n,r,i,a,s,o,l,c,u=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new l,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new s,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new s,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new h(this),t=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,s=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new u}]);var h=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var i=0;Object.defineProperty(this,"posX",{get:function(){return i},set:function(e){isNaN(e)||(i=e)}});var a=0;Object.defineProperty(this,"posY",{get:function(){return a},set:function(e){isNaN(e)||(a=e)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),c.margin=t}});var s=!1;Object.defineProperty(this,"autoPaging",{get:function(){return s},set:function(e){s=e}});var o=0;Object.defineProperty(this,"lastBreak",{get:function(){return o},set:function(e){o=e}});var l=[];Object.defineProperty(this,"pageBreaks",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(e){e instanceof u&&(c=e)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(e){c.path=e}});var h=[];Object.defineProperty(this,"ctxStack",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=d(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=d(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var A=null,p=null;Object.defineProperty(this,"fontFaces",{get:function(){return p},set:function(e){A=null,p=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var n=t[1];t[2];var r=t[3],i=t[4];t[5];var a=t[6],s=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(i)[2];i="px"===s?Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor):"em"===s?Math.floor(parseFloat(i)*this.pdf.getFontSize()):Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(i);var o=function(e){var t,n,r=[],i=e.trim();if(""===i)return Sce;if(i in uce)return[uce[i]];for(;""!==i;){switch(n=null,t=(i=dce(i)).charAt(0)){case'"':case"'":n=Ace(i.substring(1),t);break;default:n=pce(i)}if(null===n)return Sce;if(r.push(n[0]),""!==(i=dce(n[1]))&&","!==i.charAt(0))return Sce;i=i.replace(/^,/,"")}return r}(a);if(this.fontFaces){var l=function(e,t){if(null===A){var n=function(e){var t=[];return Object.keys(e).forEach(function(n){e[n].forEach(function(e){var r=null;switch(e){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:e},t.push(r))})}),t}(e.getFontList());A=function(e){for(var t={},n=0;n<e.length;++n){var r=oce(e[n]),i=r.family,a=r.stretch,s=r.style,o=r.weight;t[i]=t[i]||{},t[i][a]=t[i][a]||{},t[i][a][s]=t[i][a][s]||{},t[i][a][s][o]=r}return t}(n.concat(t))}return A}(this.pdf,this.fontFaces),c=o.map(function(e){return{family:e,stretch:"normal",weight:r,style:n}}),u=function(e,t,n){for(var r=(n=n||{}).defaultFontFamily||"times",i=Object.assign({},cce,n.genericFontFamilies||{}),a=null,s=null,o=0;o<t.length;++o)if(i[(a=oce(t[o])).family]&&(a.family=i[a.family]),e.hasOwnProperty(a.family)){s=e[a.family];break}if(!(s=s||e[r]))throw new Error("Could not find a font-family for the rule '"+hce(a)+"' and default family '"+r+"'.");if(s=function(e,t){if(t[e])return t[e];var n=ice[e],r=n<=ice.normal?-1:1,i=lce(t,rce,n,r);if(!i)throw new Error("Could not find a matching font-stretch value for "+e);return i}(a.stretch,s),s=function(e,t){if(t[e])return t[e];for(var n=nce[e],r=0;r<n.length;++r)if(t[n[r]])return t[n[r]];throw new Error("Could not find a matching font-style for "+e)}(a.style,s),!(s=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var n=sce[e],r=lce(t,ace,n,e<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+e);return r}(a.weight,s)))throw new Error("Failed to resolve a font for the rule '"+hce(a)+"'.");return s}(l,c);this.pdf.setFont(u.ref.name,u.ref.style)}else{var h="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(h="bold"),"italic"===n&&(h+="italic"),0===h.length&&(h="normal");for(var d="",p={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},f=0;f<o.length;f++){if(void 0!==this.pdf.internal.getFont(o[f],h,{noFallback:!0,disableWarning:!0})){d=o[f];break}if("bolditalic"===h&&void 0!==this.pdf.internal.getFont(o[f],"bold",{noFallback:!0,disableWarning:!0}))d=o[f],h="bold";else if(void 0!==this.pdf.internal.getFont(o[f],"normal",{noFallback:!0,disableWarning:!0})){d=o[f],h="normal";break}}if(""===d)for(var g=0;g<o.length;g++)if(p[o[g]]){d=p[o[g]];break}d=""===d?"Times":d,this.pdf.setFont(d,h)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,U.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,U.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};h.prototype.setLineDash=function(e){this.lineDash=e},h.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},h.prototype.fill=function(){b.call(this,"fill",!1)},h.prototype.stroke=function(){b.call(this,"stroke",!1)},h.prototype.beginPath=function(){this.path=[{type:"begin"}]},h.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(e,t)},h.prototype.closePath=function(){var e=new s(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,xne.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new s(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new s(e.x,e.y)},h.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new s(n.x,n.y)},h.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),b.call(this,null,!0)},h.prototype.quadraticCurveTo=function(e,t,n,r){if(isNaN(n)||isNaN(r)||isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var i=this.ctx.transform.applyToPoint(new s(n,r)),a=this.ctx.transform.applyToPoint(new s(e,t));this.path.push({type:"qct",x1:a.x,y1:a.y,x:i.x,y:i.y}),this.ctx.lastPoint=new s(i.x,i.y)},h.prototype.bezierCurveTo=function(e,t,n,r,i,a){if(isNaN(i)||isNaN(a)||isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var o=this.ctx.transform.applyToPoint(new s(i,a)),l=this.ctx.transform.applyToPoint(new s(e,t)),c=this.ctx.transform.applyToPoint(new s(n,r));this.path.push({type:"bct",x1:l.x,y1:l.y,x2:c.x,y2:c.y,x:o.x,y:o.y}),this.ctx.lastPoint=new s(o.x,o.y)},h.prototype.arc=function(e,t,n,r,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i))throw Uoe.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(a=Boolean(a),!this.ctx.transform.isIdentity){var o=this.ctx.transform.applyToPoint(new s(e,t));e=o.x,t=o.y;var l=this.ctx.transform.applyToPoint(new s(0,n)),c=this.ctx.transform.applyToPoint(new s(0,0));n=Math.sqrt(Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2))}Math.abs(i-r)>=2*Math.PI&&(r=0,i=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:n,startAngle:r,endAngle:i,counterclockwise:a})},h.prototype.arcTo=function(e,t,n,r,i){throw new Error("arcTo not implemented.")},h.prototype.rect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.lineTo(e+n,t),this.lineTo(e,t)},h.prototype.fillRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!A.call(this)){var i={};"butt"!==this.lineCap&&(i.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(i.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,n,r),this.fill(),i.hasOwnProperty("lineCap")&&(this.lineCap=i.lineCap),i.hasOwnProperty("lineJoin")&&(this.lineJoin=i.lineJoin)}},h.prototype.strokeRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");p.call(this)||(this.beginPath(),this.rect(e,t,n,r),this.stroke())},h.prototype.clearRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw Uoe.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,n,r))},h.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new u(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},h.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},h.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(e){var t,n,r,i;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,n=0,r=0,i=0;else{var a=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==a)t=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=1;else if(null!==(a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=parseFloat(a[4]);else{if(i=1,"string"==typeof e&&"#"!==e.charAt(0)){var s=new Hoe(e);e=s.ok?s.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,n=e.substring(2,3),n+=n,r=e.substring(3,4),r+=r):(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7)),t=parseInt(t,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:t,g:n,b:r,a:i,style:e}},A=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},p=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};h.prototype.fillText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Uoe.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!A.call(this)){var i=R(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;k.call(this,{text:e,x:t,y:n,scale:a,angle:i,align:this.textAlign,maxWidth:r})}},h.prototype.strokeText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw Uoe.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!p.call(this)){r=isNaN(r)?void 0:r;var i=R(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;k.call(this,{text:e,x:t,y:n,scale:a,renderingMode:"stroke",angle:i,align:this.textAlign,maxWidth:r})}},h.prototype.measureText=function(e){if("string"!=typeof e)throw Uoe.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,n=this.pdf.internal.scaleFactor,r=t.internal.getFontSize(),i=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:i*=Math.round(96*n/72*1e4)/1e4})},h.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new l(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.rotate=function(e){if(isNaN(e))throw Uoe.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new l(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},h.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw Uoe.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new l(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(n)},h.prototype.transform=function(e,t,n,r,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a))throw Uoe.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var s=new l(e,t,n,r,i,a);this.ctx.transform=this.ctx.transform.multiply(s)},h.prototype.setTransform=function(e,t,n,r,i,a){e=isNaN(e)?1:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,r=isNaN(r)?1:r,i=isNaN(i)?0:i,a=isNaN(a)?0:a,this.ctx.transform=new l(e,t,n,r,i,a)};var f=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};h.prototype.drawImage=function(e,t,n,r,i,a,s,c,u){var h=this.pdf.getImageProperties(e),d=1,A=1,p=1,m=1;void 0!==r&&void 0!==c&&(p=c/r,m=u/i,d=h.width/r*c/r,A=h.height/i*u/i),void 0===a&&(a=t,s=n,t=0,n=0),void 0!==r&&void 0===c&&(c=r,u=i),void 0===r&&void 0===c&&(c=h.width,u=h.height);for(var b,w=this.ctx.transform.decompose(),_=R(w.rotate.shx),S=new l,C=(S=(S=(S=S.multiply(w.translate)).multiply(w.skew)).multiply(w.scale)).applyToRectangle(new o(a-t*p,s-n*m,r*d,i*A)),E=g.call(this,C),N=[],k=0;k<E.length;k+=1)-1===N.indexOf(E[k])&&N.push(E[k]);if(v(N),this.autoPaging)for(var I=N[0],T=N[N.length-1],B=I;B<T+1;B++){this.pdf.setPage(B);var M=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],F=1===B?this.posY+this.margin[0]:this.margin[0],L=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],P=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],U=1===B?0:L+(B-2)*P;if(0!==this.ctx.clip_path.length){var D=this.path;b=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(b,this.posX+this.margin[3],-U+F+this.ctx.prevPageLastElemOffset),x.call(this,"fill",!0),this.path=D}var O=JSON.parse(JSON.stringify(C));O=y([O],this.posX+this.margin[3],-U+F+this.ctx.prevPageLastElemOffset)[0];var j=(B>I||B<T)&&f.call(this);j&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],M,P,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",O.x,O.y,O.w,O.h,null,null,_),j&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",C.x,C.y,C.w,C.h,null,null,_)};var g=function(e,t,n){var r=[];t=t||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var i=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":r.push(Math.floor((e.y+i)/n)+1);break;case"arc":r.push(Math.floor((e.y+i-e.radius)/n)+1),r.push(Math.floor((e.y+i+e.radius)/n)+1);break;case"qct":var a=L(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);r.push(Math.floor((a.y+i)/n)+1),r.push(Math.floor((a.y+a.h+i)/n)+1);break;case"bct":var s=P(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);r.push(Math.floor((s.y+i)/n)+1),r.push(Math.floor((s.y+s.h+i)/n)+1);break;case"rect":r.push(Math.floor((e.y+i)/n)+1),r.push(Math.floor((e.y+e.h+i)/n)+1)}for(var o=0;o<r.length;o+=1)for(;this.pdf.internal.getNumberOfPages()<r[o];)m.call(this);return r},m=function(){var e=this.fillStyle,t=this.strokeStyle,n=this.font,r=this.lineCap,i=this.lineWidth,a=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=n,this.lineCap=r,this.lineWidth=i,this.lineJoin=a},y=function(e,t,n){for(var r=0;r<e.length;r++)switch(e[r].type){case"bct":e[r].x2+=t,e[r].y2+=n;case"qct":e[r].x1+=t,e[r].y1+=n;default:e[r].x+=t,e[r].y+=n}return e},v=function(e){return e.sort(function(e,t){return e-t})},b=function(e,t){for(var n,r,i=this.fillStyle,a=this.strokeStyle,s=this.lineCap,o=this.lineWidth,l=Math.abs(o*this.ctx.transform.scaleX),c=this.lineJoin,u=JSON.parse(JSON.stringify(this.path)),h=JSON.parse(JSON.stringify(this.path)),d=[],A=0;A<h.length;A++)if(void 0!==h[A].x)for(var p=g.call(this,h[A]),b=0;b<p.length;b+=1)-1===d.indexOf(p[b])&&d.push(p[b]);for(var w=0;w<d.length;w++)for(;this.pdf.internal.getNumberOfPages()<d[w];)m.call(this);if(v(d),this.autoPaging)for(var _=d[0],S=d[d.length-1],C=_;C<S+1;C++){this.pdf.setPage(C),this.fillStyle=i,this.strokeStyle=a,this.lineCap=s,this.lineWidth=l,this.lineJoin=c;var E=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],N=1===C?this.posY+this.margin[0]:this.margin[0],k=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],I=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],T=1===C?0:k+(C-2)*I;if(0!==this.ctx.clip_path.length){var B=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(n,this.posX+this.margin[3],-T+N+this.ctx.prevPageLastElemOffset),x.call(this,e,!0),this.path=B}if(r=JSON.parse(JSON.stringify(u)),this.path=y(r,this.posX+this.margin[3],-T+N+this.ctx.prevPageLastElemOffset),!1===t||0===C){var M=(C>_||C<S)&&f.call(this);M&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],E,I,null).clip().discardPath()),x.call(this,e,t),M&&this.pdf.restoreGraphicsState()}this.lineWidth=o}else this.lineWidth=l,x.call(this,e,t),this.lineWidth=o;this.path=u},x=function(e,t){if(("stroke"!==e||t||!p.call(this))&&("stroke"===e||t||!A.call(this))){for(var n,r,i=[],a=this.path,s=0;s<a.length;s++){var o=a[s];switch(o.type){case"begin":i.push({begin:!0});break;case"close":i.push({close:!0});break;case"mt":i.push({start:o,deltas:[],abs:[]});break;case"lt":var l=i.length;if(a[s-1]&&!isNaN(a[s-1].x)&&(n=[o.x-a[s-1].x,o.y-a[s-1].y],l>0))for(;l>=0;l--)if(!0!==i[l-1].close&&!0!==i[l-1].begin){i[l-1].deltas.push(n),i[l-1].abs.push(o);break}break;case"bct":n=[o.x1-a[s-1].x,o.y1-a[s-1].y,o.x2-a[s-1].x,o.y2-a[s-1].y,o.x-a[s-1].x,o.y-a[s-1].y],i[i.length-1].deltas.push(n);break;case"qct":var c=a[s-1].x+2/3*(o.x1-a[s-1].x),u=a[s-1].y+2/3*(o.y1-a[s-1].y),h=o.x+2/3*(o.x1-o.x),d=o.y+2/3*(o.y1-o.y),f=o.x,g=o.y;n=[c-a[s-1].x,u-a[s-1].y,h-a[s-1].x,d-a[s-1].y,f-a[s-1].x,g-a[s-1].y],i[i.length-1].deltas.push(n);break;case"arc":i.push({deltas:[],abs:[],arc:!0}),Array.isArray(i[i.length-1].abs)&&i[i.length-1].abs.push(o)}}r=t?null:"stroke"===e?"stroke":"fill";for(var m=!1,y=0;y<i.length;y++)if(i[y].arc)for(var v=i[y].abs,b=0;b<v.length;b++){var x=v[b];"arc"===x.type?S.call(this,x.x,x.y,x.radius,x.startAngle,x.endAngle,x.counterclockwise,void 0,t,!m):I.call(this,x.x,x.y),m=!0}else if(!0===i[y].close)this.pdf.internal.out("h"),m=!1;else if(!0!==i[y].begin){var w=i[y].start.x,_=i[y].start.y;T.call(this,i[y].deltas,w,_),m=!0}r&&C.call(this,r),t&&E.call(this)}},w=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-n;case"top":return e+t-n;case"hanging":return e+t-2*n;case"middle":return e+t/2-n;default:return e}},_=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};h.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},h.prototype.createPattern=function(){return this.createLinearGradient()},h.prototype.createRadialGradient=function(){return this.createLinearGradient()};var S=function(e,t,n,r,i,a,s,o,l){for(var c=M.call(this,n,r,i,a),u=0;u<c.length;u++){var h=c[u];0===u&&(l?N.call(this,h.x1+e,h.y1+t):I.call(this,h.x1+e,h.y1+t)),B.call(this,e,t,h.x2,h.y2,h.x3,h.y3,h.x4,h.y4)}o?E.call(this):C.call(this,s)},C=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},E=function(){this.pdf.clip(),this.pdf.discardPath()},N=function(e,t){this.pdf.internal.out(n(e)+" "+r(t)+" m")},k=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var n=this.pdf.getTextDimensions(e.text),r=w.call(this,e.y),i=_.call(this,r)-n.h,a=this.ctx.transform.applyToPoint(new s(e.x,r)),c=this.ctx.transform.decompose(),u=new l;u=(u=(u=u.multiply(c.translate)).multiply(c.skew)).multiply(c.scale);for(var h,d,A,p=this.ctx.transform.applyToRectangle(new o(e.x,r,n.w,n.h)),m=u.applyToRectangle(new o(e.x,i,n.w,n.h)),b=g.call(this,m),S=[],C=0;C<b.length;C+=1)-1===S.indexOf(b[C])&&S.push(b[C]);if(v(S),this.autoPaging)for(var E=S[0],N=S[S.length-1],k=E;k<N+1;k++){this.pdf.setPage(k);var I=1===k?this.posY+this.margin[0]:this.margin[0],T=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],B=this.pdf.internal.pageSize.height-this.margin[2],M=B-this.margin[0],F=this.pdf.internal.pageSize.width-this.margin[1],R=F-this.margin[3],L=1===k?0:T+(k-2)*M;if(0!==this.ctx.clip_path.length){var P=this.path;h=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=y(h,this.posX+this.margin[3],-1*L+I),x.call(this,"fill",!0),this.path=P}var U=y([JSON.parse(JSON.stringify(m))],this.posX+this.margin[3],-L+I+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),A=this.lineWidth,this.lineWidth=A*e.scale);var D="text"!==this.autoPaging;if(D||U.y+U.h<=B){if(D||U.y>=I&&U.x<=F){var O=D?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||F-U.x)[0],j=y([JSON.parse(JSON.stringify(p))],this.posX+this.margin[3],-L+I+this.ctx.prevPageLastElemOffset)[0],z=D&&(k>E||k<N)&&f.call(this);z&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],R,M,null).clip().discardPath()),this.pdf.text(O,j.x,j.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),z&&this.pdf.restoreGraphicsState()}}else U.y<B&&(this.ctx.prevPageLastElemOffset+=B-U.y);e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=A)}else e.scale>=.01&&(d=this.pdf.internal.getFontSize(),this.pdf.setFontSize(d*e.scale),A=this.lineWidth,this.lineWidth=A*e.scale),this.pdf.text(e.text,a.x+this.posX,a.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(d),this.lineWidth=A)},I=function(e,t,i,a){i=i||0,a=a||0,this.pdf.internal.out(n(e+i)+" "+r(t+a)+" l")},T=function(e,t,n){return this.pdf.lines(e,t,n,null,null)},B=function(e,n,r,s,o,l,c,u){this.pdf.internal.out([t(i(r+e)),t(a(s+n)),t(i(o+e)),t(a(l+n)),t(i(c+e)),t(a(u+n)),"c"].join(" "))},M=function(e,t,n,r){for(var i=2*Math.PI,a=Math.PI/2;t>n;)t-=i;var s=Math.abs(n-t);s<i&&r&&(s=i-s);for(var o=[],l=r?-1:1,c=t;s>1e-5;){var u=c+l*Math.min(s,a);o.push(F.call(this,e,c,u)),s-=Math.abs(u-c),c=u}return o},F=function(e,t,n){var r=(n-t)/2,i=e*Math.cos(r),a=e*Math.sin(r),s=i,o=-a,l=s*s+o*o,c=l+s*i+o*a,u=4/3*(Math.sqrt(2*l*c)-c)/(s*a-o*i),h=s-u*o,d=o+u*s,A=h,p=-d,f=r+t,g=Math.cos(f),m=Math.sin(f);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:h*g-d*m,y2:h*m+d*g,x3:A*g-p*m,y3:A*m+p*g,x4:e*Math.cos(n),y4:e*Math.sin(n)}},R=function(e){return 180*e/Math.PI},L=function(e,t,n,r,i,a){var s=e+.5*(n-e),l=t+.5*(r-t),c=i+.5*(n-i),u=a+.5*(r-a),h=Math.min(e,i,s,c),d=Math.max(e,i,s,c),A=Math.min(t,a,l,u),p=Math.max(t,a,l,u);return new o(h,A,d-h,p-A)},P=function(e,t,n,r,i,a,s,l){var c,u,h,d,A,p,f,g,m,y,v,b,x,w,_=n-e,S=r-t,C=i-n,E=a-r,N=s-i,k=l-a;for(u=0;u<41;u++)m=(f=(h=e+(c=u/40)*_)+c*((A=n+c*C)-h))+c*(A+c*(i+c*N-A)-f),y=(g=(d=t+c*S)+c*((p=r+c*E)-d))+c*(p+c*(a+c*k-p)-g),0==u?(v=m,b=y,x=m,w=y):(v=Math.min(v,m),b=Math.min(b,y),x=Math.max(x,m),w=Math.max(w,y));return new o(Math.round(v),Math.round(b),Math.round(x-v),Math.round(w-b))},U=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,n=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(ple.API),function(e){var t=function(e){var t,n,r,i,a,s,o,l,c,u;for(/[^\x00-\xFF]/.test(e),n=[],r=0,i=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;i>r;r+=4)0!==(a=(e.charCodeAt(r)<<24)+(e.charCodeAt(r+1)<<16)+(e.charCodeAt(r+2)<<8)+e.charCodeAt(r+3))?(s=(a=((a=((a=((a=(a-(u=a%85))/85)-(c=a%85))/85)-(l=a%85))/85)-(o=a%85))/85)%85,n.push(s+33,o+33,l+33,c+33,u+33)):n.push(122);return function(e,t){for(var n=t;n>0;n--)e.pop()}(n,t.length),String.fromCharCode.apply(String,n)+"~>"},n=function(e){var t,n,r,i,a,s=String,o="length",l=255,c="charCodeAt",u="slice",h="replace";for(e[u](-2),e=e[u](0,-2)[h](/\s/g,"")[h]("z","!!!!!"),r=[],i=0,a=(e+=t="uuuuu"[u](e[o]%5||5))[o];a>i;i+=5)n=52200625*(e[c](i)-33)+614125*(e[c](i+1)-33)+7225*(e[c](i+2)-33)+85*(e[c](i+3)-33)+(e[c](i+4)-33),r.push(l&n>>24,l&n>>16,l&n>>8,l&n);return function(e,t){for(var n=t;n>0;n--)e.pop()}(r,t[o]),s.fromCharCode.apply(s,r)},r=function(e){return e.split("").map(function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var n="",r=0;r<e.length;r+=2)n+=String.fromCharCode("0x"+(e[r]+e[r+1]));return n},a=function(e){for(var t=new Uint8Array(e.length),n=e.length;n--;)t[n]=e.charCodeAt(n);return(t=are(t)).reduce(function(e,t){return e+String.fromCharCode(t)},"")};e.processDataByFilters=function(e,s){var o=0,l=e||"",c=[];for("string"==typeof(s=s||[])&&(s=[s]),o=0;o<s.length;o+=1)switch(s[o]){case"ASCII85Decode":case"/ASCII85Decode":l=n(l),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":l=t(l),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":l=i(l),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":l=r(l),c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":l=a(l),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+s[o]+'" is not implemented')}return{data:l,reverseChain:c.reverse().join(" ")}}}(ple.API),(_ce=ple.API).loadFile=function(e,t,n){return function(e,t,n){t=!1!==t,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(e,t,n){var r=new XMLHttpRequest,i=0,a=function(e){var t=e.length,n=[],r=String.fromCharCode;for(i=0;i<t;i+=1)n.push(r(255&e.charCodeAt(i)));return n.join("")};if(r.open("GET",e,!t),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(r.onload=function(){200===r.status?n(a(this.responseText)):n(void 0)}),r.send(null),t&&200===r.status)return a(r.responseText)}(e,t,n)}catch(R_){}return r}(e,t,n)},_ce.loadImageFile=_ce.loadFile,function(e){function t(){return(Loe.html2canvas?Promise.resolve(Loe.html2canvas):Promise.resolve().then(n.t.bind(n,5239,23))).catch(function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))}).then(function(e){return e.default?e.default:e})}function r(){return(Loe.DOMPurify?Promise.resolve(Loe.DOMPurify):n.e(977).then(n.bind(n,7977))).catch(function(e){return Promise.reject(new Error("Could not load dompurify: "+e))}).then(function(e){return e.default?e.default:e})}var i=function(e){var t=(0,xne.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},a=function(e,t){var n=document.createElement(e);for(var r in t.className&&(n.className=t.className),t.innerHTML&&t.dompurify&&(n.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)n.style[r]=t.style[r];return n},s=function e(t,n){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),i=t.firstChild;i;i=i.nextSibling)!0!==n&&1===i.nodeType&&"SCRIPT"===i.nodeName||r.appendChild(e(i,n));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft},!0)),r},o=function e(t){var n=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),r=e.convert(Promise.resolve(),n);return(r=r.setProgress(1,e,1,[e])).set(t)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(e,t){return e.__proto__=t||o.prototype,e},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(e,t){return this.then(function(){switch(t=t||function(e){switch(i(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e),t){case"string":return this.then(r).then(function(t){return this.set({src:a("div",{innerHTML:e,dompurify:t})})});case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}})},o.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)}).then(function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then(function(e){var t=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,i=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete i.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=n,n)for(var a=0;a<n.length;++a){var s=n[a],o=s.src.find(function(e){return"truetype"===e.format});o&&t.addFont(o.url,s.ref.name,s.ref.style)}return i.windowHeight=i.windowHeight||0,i.windowHeight=0==i.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):i.windowHeight,t.context2d.save(!0),e(this.prop.container,i)}).then(function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(e,t,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},o.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(e,t)})},o.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}})},o.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(e){if("object"!==i(e))return this;var t=Object.keys(e||{}).map(function(t){if(t in o.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}},this);return this.then(function(){return this.thenList(t)})},o.prototype.get=function(e,t){return this.then(function(){var n=e in o.template.prop?this.prop[e]:this.opt[e];return t?t(n):n})},o.prototype.setMargin=function(e){return this.then(function(){switch(i(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e}).then(this.setPageSize)},o.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then(function(){(e=e||ple.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e})},o.prototype.setProgress=function(e,t,n,r){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(e,t,n,r){return this.setProgress(e?this.progress.val+e:null,t||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},o.prototype.then=function(e,t){var n=this;return this.thenCore(e,t,function(e,t){return n.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,function(t){return n.updateProgress(null,e),t}).then(e,t).then(function(e){return n.updateProgress(1),e})})},o.prototype.thenCore=function(e,t,n){n=n||Promise.prototype.then;var r=this;e&&(e=e.bind(r)),t&&(t=t.bind(r));var i=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?r:o.convert(Object.assign({},r),Promise.prototype),a=n.call(i,e,t);return o.convert(a,r.__proto__)},o.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},o.prototype.thenList=function(e){var t=this;return e.forEach(function(e){t=t.thenCore(e)}),t},o.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return o.convert(t,this)},o.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},o.prototype.error=function(e){return this.then(function(){throw new Error(e)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,ple.getPageSize=function(e,t,n){if("object"===(0,xne.A)(e)){var r=e;e=r.orientation,t=r.unit||t,n=r.format||n}t=t||"mm",n=n||"a4",e=(""+(e||"P")).toLowerCase();var i,a=(""+n).toLowerCase(),s={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":i=1;break;case"mm":i=72/25.4;break;case"cm":i=72/2.54;break;case"in":i=72;break;case"px":i=.75;break;case"pc":case"em":i=12;break;case"ex":i=6;break;default:throw"Invalid unit: "+t}var o,l=0,c=0;if(s.hasOwnProperty(a))l=s[a][1]/i,c=s[a][0]/i;else try{l=n[1],c=n[0]}catch(Hoe){throw new Error("Invalid format: "+n)}if("p"===e||"portrait"===e)e="p",c>l&&(o=c,c=l,l=o);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",l>c&&(o=c,c=l,l=o)}return{width:c,height:l,unit:t,k:i,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(oce):null;var n=new o(t);return t.worker?n:n.from(e).doCallback()}}(ple.API),ple.API.addJS=function(e){return mce=e,this.internal.events.subscribe("postPutResources",function(){fce=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(fce+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),gce=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+mce+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){void 0!==fce&&void 0!==gce&&this.internal.out("/Names <</JavaScript "+fce+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),i=0;i<r.length;i++){var a=r[i],s=n.exec(a);if(null!=s){var o=s[1];e.internal.newObjectDeferredBegin(o,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var l=this.internal.pages.length,c=[];for(i=0;i<l;i++){var u=e.internal.newObject();c.push(u);var h=e.internal.getPageInfo(i+1);e.internal.write("<< /D["+h.objId+" 0 R /XYZ null null null]>> endobj")}var d=e.internal.newObject();for(e.internal.write("<< /Names [ "),i=0;i<c.length;i++)e.internal.write("(page_"+(i+1)+")"+c[i]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+d+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,n){var r={title:t,options:n,children:[]};return null==e&&(e=this.root),e.children.push(r),r},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var n=0;n<t.children.length;n++)this.genIds_r(t.children[n])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<t.children.length;r++){var i=t.children[r];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(t)),r>0&&this.line("/Prev "+this.makeRef(t.children[r-1])),r<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[r+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var a=this.count=this.count_r({count:0},i);if(a>0&&this.line("/Count "+a),i.options&&i.options.pageNumber){var s=e.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+s.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var o=0;o<t.children.length;o++)this.renderItems(t.children[o])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var n=0;n<t.children.length;n++)e.count++,this.count_r(e,t.children[n]);return e.count}}])}(ple.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,n,r,i,a,s){var o,l=this.decode.DCT_DECODE,c=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,o=function(e){for(var n,r=256*e.charCodeAt(4)+e.charCodeAt(5),i=e.length,a={width:0,height:0,numcomponents:1},s=4;s<i;s+=2){if(s+=r,-1!==t.indexOf(e.charCodeAt(s+1))){n=256*e.charCodeAt(s+5)+e.charCodeAt(s+6),a={width:256*e.charCodeAt(s+7)+e.charCodeAt(s+8),height:n,numcomponents:e.charCodeAt(s+9)};break}r=256*e.charCodeAt(s+2)+e.charCodeAt(s+3)}return a}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),o.numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}c={data:e,width:o.width,height:o.height,colorSpace:s,bitsPerComponent:8,filter:l,index:n,alias:r}}return c}}(ple.API),ple.API.processPNG=function(e,t,n,r){if(this.__addimage__.isArrayBuffer(e)&&(e=new Uint8Array(e)),this.__addimage__.isArrayBufferView(e)){var i,a=new Foe(e,{checkCrc:!0}).decode(),s=a.width,o=a.height,l=a.channels,c=a.palette,u=a.depth;i=c&&1===l?function(e){for(var t=e.width,n=e.height,r=e.data,i=e.palette,a=e.depth,s=!1,o=[],l=[],c=void 0,u=!1,h=0,d=0;d<i.length;d++){var A=lre(i[d],4),p=A[0],f=A[1],g=A[2],m=A[3];o.push(p,f,g),null!=m&&(0===m?(h++,l.length<1&&l.push(d)):m<255&&(u=!0))}if(u||h>1){s=!0,l=void 0;var y=t*n;c=new Uint8Array(y);for(var v=new DataView(r.buffer),b=0;b<y;b++){var x=lre(i[Fce(v,b,a)],4)[3];c[b]=x}}else 0===h&&(l=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:s?8:void 0,colorBytes:r,alphaBytes:c,needSMask:s,palette:o,mask:l}}(a):2===l||4===l?function(e){for(var t=e.data,n=e.width,r=e.height,i=e.channels,a=e.depth,s=2===i?"DeviceGray":"DeviceRGB",o=i-1,l=n*r,c=o,u=l*c,h=1*l,d=Math.ceil(u*a/8),A=Math.ceil(h*a/8),p=new Uint8Array(d),f=new Uint8Array(A),g=new DataView(t.buffer),m=new DataView(p.buffer),y=new DataView(f.buffer),v=!1,b=0;b<l;b++){for(var x=b*i,w=0;w<c;w++)Rce(m,Fce(g,x+w,a),b*c+w,a);var _=Fce(g,x+c,a);_<(1<<a)-1&&(v=!0),Rce(y,_,1*b,a)}return{colorSpace:s,colorsPerPixel:o,sMaskBitsPerComponent:v?a:void 0,colorBytes:p,alphaBytes:f,needSMask:v}}(a):function(e){var t=e.data,n=1===e.channels?"DeviceGray":"DeviceRGB";return{colorSpace:n,colorsPerPixel:"DeviceGray"===n?1:3,colorBytes:t instanceof Uint16Array?function(e){for(var t=e.length,n=new Uint8Array(2*t),r=new DataView(n.buffer,n.byteOffset,n.byteLength),i=0;i<t;i++)r.setUint16(2*i,e[i],!1);return n}(t):t,needSMask:!1}}(a);var h,d,A,p=i,f=p.colorSpace,g=p.colorsPerPixel,m=p.sMaskBitsPerComponent,y=p.colorBytes,v=p.alphaBytes,b=p.needSMask,x=p.palette,w=p.mask,_=null;return r!==ple.API.image_compression.NONE?(_=function(e){var t;switch(e){case ple.API.image_compression.FAST:t=11;break;case ple.API.image_compression.MEDIUM:t=13;break;case ple.API.image_compression.SLOW:t=14;break;default:t=12}return t}(r),h=this.decode.FLATE_DECODE,d="/Predictor ".concat(_," /Colors ").concat(g," /BitsPerComponent ").concat(u," /Columns ").concat(s),e=Cce(y,Math.ceil(s*g*u/8),g,u,r),b&&(A=Cce(v,Math.ceil(s*m/8),1,m,r))):(h=void 0,d=void 0,e=y,b&&(A=v)),(this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e))&&(e=this.__addimage__.arrayBufferToBinaryString(e)),(A&&this.__addimage__.isArrayBuffer(A)||this.__addimage__.isArrayBufferView(A))&&(A=this.__addimage__.arrayBufferToBinaryString(A)),{alias:n,data:e,index:t,filter:h,decodeParameters:d,transparency:w,palette:x,sMask:A,predictor:_,width:s,height:o,bitsPerComponent:u,sMaskBitsPerComponent:m,colorSpace:f}}},function(e){e.processGIF89A=function(t,n,r,i){var a=new Pce(t),s=a.width,o=a.height,l=[];a.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:s,height:o},u=new Dce(100).encode(c,100);return e.processJPEG.call(this,u,n,r,i)},e.processGIF87A=e.processGIF89A}(ple.API),Oce.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:r,blue:n,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Oce.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(n){Uoe.log("bit decode error:"+n)}},Oce.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),n=t%4;for(e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,i=0;i<t;i++)for(var a=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var l=this.palette[a>>7-o&1];this.data[s+4*o]=l.blue,this.data[s+4*o+1]=l.green,this.data[s+4*o+2]=l.red,this.data[s+4*o+3]=255}0!==n&&(this.pos+=4-n)}},Oce.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<e;i++){var a=this.datav.getUint8(this.pos++,!0),s=r*this.width*4+2*i*4,o=a>>4,l=15&a,c=this.palette[o];if(this.data[s]=c.blue,this.data[s+1]=c.green,this.data[s+2]=c.red,this.data[s+3]=255,2*i+1>=this.width)break;c=this.palette[l],this.data[s+4]=c.blue,this.data[s+4+1]=c.green,this.data[s+4+2]=c.red,this.data[s+4+3]=255}0!==t&&(this.pos+=4-t)}},Oce.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+4*r;if(i<this.palette.length){var s=this.palette[i];this.data[a]=s.red,this.data[a+1]=s.green,this.data[a+2]=s.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}0!==e&&(this.pos+=4-e)}},Oce.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(a&t)/t*255|0,o=(a>>5&t)/t*255|0,l=(a>>10&t)/t*255|0,c=a>>15?255:0,u=r*this.width*4+4*i;this.data[u]=l,this.data[u+1]=o,this.data[u+2]=s,this.data[u+3]=c}this.pos+=e}},Oce.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(s&t)/t*255|0,l=(s>>5&n)/n*255|0,c=(s>>11)/t*255|0,u=i*this.width*4+4*a;this.data[u]=c,this.data[u+1]=l,this.data[u+2]=o,this.data[u+3]=255}this.pos+=e}},Oce.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;this.data[s]=a,this.data[s+1]=i,this.data[s+2]=r,this.data[s+3]=255}this.pos+=this.width%4}},Oce.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=r,this.data[o+3]=s}},Oce.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,n,r,i){var a=new Oce(t,!1),s=a.width,o=a.height,l={data:a.getData(),width:s,height:o},c=new Dce(100).encode(l,100);return e.processJPEG.call(this,c,n,r,i)}}(ple.API),jce.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,n,r,i){var a=new jce(t),s=a.width,o=a.height,l={data:a.getData(),width:s,height:o},c=new Dce(100).encode(l,100);return e.processJPEG.call(this,c,n,r,i)}}(ple.API),ple.API.processRGBA=function(e,t,n){for(var r=e.data,i=r.length,a=new Uint8Array(i/4*3),s=new Uint8Array(i/4),o=0,l=0,c=0;c<i;c+=4){var u=r[c],h=r[c+1],d=r[c+2],A=r[c+3];a[o++]=u,a[o++]=h,a[o++]=d,s[l++]=A}var p=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(s),data:p,index:t,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},ple.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},yce=ple.API,vce=yce.getCharWidthsArray=function(e,t){var n,r,i=(t=t||{}).font||this.internal.getFont(),a=t.fontSize||this.internal.getFontSize(),s=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,l=o.fof?o.fof:1,c=t.kerning?t.kerning:i.metadata.Unicode.kerning,u=c.fof?c.fof:1,h=!1!==t.doKerning,d=0,A=e.length,p=0,f=o[0]||l,g=[];for(n=0;n<A;n++)r=e.charCodeAt(n),"function"==typeof i.metadata.widthOfString?g.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(r))+s*(1e3/a)||0)/1e3):(d=h&&"object"===(0,xne.A)(c[r])&&!isNaN(parseInt(c[r][p],10))?c[r][p]/u:0,g.push((o[r]||f)/l+d)),p=r;return g},bce=yce.getStringUnitWidth=function(e,t){var n=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return yce.processArabic&&(e=yce.processArabic(e)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(e,n,i)/n:vce.apply(this,arguments).reduce(function(e,t){return e+t},0)},xce=function(e,t,n,r){for(var i=[],a=0,s=e.length,o=0;a!==s&&o+t[a]<n;)o+=t[a],a++;i.push(e.slice(0,a));var l=a;for(o=0;a!==s;)o+t[a]>r&&(i.push(e.slice(l,a)),o=0,l=a),o+=t[a],a++;return l!==a&&i.push(e.slice(l,a)),i},wce=function(e,t,n){n||(n={});var r,i,a,s,o,l,c,u=[],h=[u],d=n.textIndent||0,A=0,p=0,f=e.split(" "),g=vce.apply(this,[" ",n])[0];if(l=-1===n.lineIndent?f[0].length+2:n.lineIndent||0){var m=Array(l).join(" "),y=[];f.map(function(e){(e=e.split(/\s*\n/)).length>1?y=y.concat(e.map(function(e,t){return(t&&e.length?"\n":"")+e})):y.push(e[0])}),f=y,l=bce.apply(this,[m,n])}for(a=0,s=f.length;a<s;a++){var v=0;if(r=f[a],l&&"\n"==r[0]&&(r=r.substr(1),v=1),d+A+(p=(i=vce.apply(this,[r,n])).reduce(function(e,t){return e+t},0))>t||v){if(p>t){for(o=xce.apply(this,[r,i,t-(d+A),t]),u.push(o.shift()),u=[o.pop()];o.length;)h.push([o.shift()]);p=i.slice(r.length-(u[0]?u[0].length:0)).reduce(function(e,t){return e+t},0)}else u=[r];h.push(u),d=p+l,A=g}else u.push(r),d+=A+p,A=g}return c=l?function(e,t){return(t?m:"")+e.join(" ")}:function(e){return e.join(" ")},h.map(c)},yce.splitTextToSize=function(e,t,n){var r,i=(n=n||{}).fontSize||this.internal.getFontSize(),a=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle),n="Unicode";return t.metadata[n]?{widths:t.metadata[n].widths||{0:1},kerning:t.metadata[n].kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(e)?e:String(e).split(/\r?\n/);var s=1*this.internal.scaleFactor*t/i;a.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=n.lineIndent;var o,l,c=[];for(o=0,l=r.length;o<l;o++)c=c.concat(wce.apply(this,[r[o],s,a]));return c},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="0123456789abcdef",n="klmnopqrstuvwxyz",r={},i={},a=0;a<16;a++)r[n[a]]=t[a],i[t[a]]=n[a];var s=function(e){return"0x"+parseInt(e,10).toString(16)},o=e.__fontmetrics__.compress=function(e){var t,n,r,a,l=["{"];for(var c in e){if(t=e[c],isNaN(parseInt(c,10))?n="'"+c+"'":(c=parseInt(c,10),n=(n=s(c).slice(2)).slice(0,-1)+i[n.slice(-1)]),"number"==typeof t)t<0?(r=s(t).slice(3),a="-"):(r=s(t).slice(2),a=""),r=a+r.slice(0,-1)+i[r.slice(-1)];else{if("object"!==(0,xne.A)(t))throw new Error("Don't know what to do with value type "+(0,xne.A)(t)+".");r=o(t)}l.push(n+r)}return l.push("}"),l.join("")},l=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,n,i,a,s={},o=1,l=s,c=[],u="",h="",d=e.length-1,A=1;A<d;A+=1)"'"==(a=e[A])?t?(i=t.join(""),t=void 0):t=[]:t?t.push(a):"{"==a?(c.push([l,i]),l={},i=void 0):"}"==a?((n=c.pop())[0][n[1]]=l,i=void 0,l=n[0]):"-"==a?o=-1:void 0===i?r.hasOwnProperty(a)?(u+=r[a],i=parseInt(u,16)*o,o=1,u=""):u+=a:r.hasOwnProperty(a)?(h+=r[a],l[i]=parseInt(h,16)*o,o=1,i=void 0,h=""):h+=a;return s},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},u={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},h={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,n=h.Unicode[t.postScriptName];n&&(t.metadata.Unicode={},t.metadata.Unicode.widths=n.widths,t.metadata.Unicode.kerning=n.kerning);var r=u.Unicode[t.postScriptName];r&&(t.metadata.Unicode.encoding=r,t.encoding=r.codePages[0])}])}(ple.API),function(e){var t=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n};e.API.events.push(["addFont",function(n){var r=void 0,i=n.font,a=n.instance;if(!i.isStandardFont){if(void 0===a)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if("string"!=typeof(r=!1===a.existsFileInVFS(i.postScriptName)?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?t(r):t(Qoe(r)),n.metadata=e.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(i,r)}}])}(ple),ple.API.addSvgAsImage=function(e,t,r,i,a,s,o,l){if(isNaN(t)||isNaN(r))throw Uoe.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(a))throw Uoe.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=i,c.height=a;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},d=this;return(Loe.canvg?Promise.resolve(Loe.canvg):n.e(455).then(n.bind(n,8455))).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e}).then(function(t){return t.fromString(u,e,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(e){return e.render(h)}).then(function(){d.addImage(c.toDataURL("image/jpeg",1),t,r,i,a,o,l)})},ple.API.putTotalPages=function(e){var t,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),n=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var i=0;i<this.internal.pages[r].length;i++)this.internal.pages[r][i]=this.internal.pages[r][i].replace(t,n);return this},ple.API.viewerPreferences=function(e,t){var n;e=e||{},t=t||!1;var r,i,a,s={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(s),l=[],c=0,u=0,h=0;function d(e,t){var n,r=!1;for(n=0;n<e.length;n+=1)e[n]===t&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(s)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var A=o.length;for(h=0;h<A;h+=1)n[o[h]].value=n[o[h]].defaultValue,n[o[h]].explicitSet=!1}if("object"===(0,xne.A)(e))for(i in e)if(a=e[i],d(o,i)&&void 0!==a){if("boolean"===n[i].type&&"boolean"==typeof a)n[i].value=a;else if("name"===n[i].type&&d(n[i].valueSet,a))n[i].value=a;else if("integer"===n[i].type&&Number.isInteger(a))n[i].value=a;else if("array"===n[i].type){for(c=0;c<a.length;c+=1)if(r=!0,1===a[c].length&&"number"==typeof a[c][0])l.push(String(a[c]-1));else if(a[c].length>1){for(u=0;u<a[c].length;u+=1)"number"!=typeof a[c][u]&&(r=!1);!0===r&&l.push([a[c][0]-1,a[c][1]-1].join(" "))}n[i].value="["+l.join(" ")+"]"}else n[i].value=n[i].defaultValue;n[i].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",function(){var e,t=[];for(e in n)!0===n[e].explicitSet&&("name"===n[e].type?t.push("/"+e+" /"+n[e].value):t.push("/"+e+" "+n[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(e)),r=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),a=unescape(encodeURIComponent("</x:xmpmeta>")),s=n.length+r.length+i.length+t.length+a.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+s+" >>"),this.internal.write("stream"),this.internal.write(t+n+r+i+a),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,r){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",t)),this}}(ple.API),function(e){var t=e.API,n=t.pdfEscape16=function(e,t){for(var n,r=t.metadata.Unicode.widths,i=["","0","00","000","0000"],a=[""],s=0,o=e.length;s<o;++s){if(n=t.metadata.characterToGlyph(e.charCodeAt(s)),t.metadata.glyIdsUsed.push(n),t.metadata.toUnicode[n]=e.charCodeAt(s),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(t.metadata.widthOfGlyph(n),10)])),"0"==n)return a.join("");n=n.toString(16),a.push(i[4-n.length],n)}return a.join("")},r=function(e){var t,n,r,i,a,s,o;for(a="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],s=0,o=(n=Object.keys(e).sort(function(e,t){return e-t})).length;s<o;s++)t=n[s],r.length>=100&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(i=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),r.push("<"+t+"><"+i+">"));return r.length&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),a+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var n=t.font,i=t.out,a=t.newObject,s=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"Identity-H"===n.encoding){for(var o=n.metadata.Unicode.widths,l=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),c="",u=0;u<l.length;u++)c+=String.fromCharCode(l[u]);var h=a();s({data:c,addLength1:!0,objectId:h}),i("endobj");var d=a();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:d}),i("endobj");var A=a();i("<<"),i("/Type /FontDescriptor"),i("/FontName /"+lle(n.fontName)),i("/FontFile2 "+h+" 0 R"),i("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),i("/Flags "+n.metadata.flags),i("/StemV "+n.metadata.stemV),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i(">>"),i("endobj");var p=a();i("<<"),i("/Type /Font"),i("/BaseFont /"+lle(n.fontName)),i("/FontDescriptor "+A+" 0 R"),i("/W "+e.API.PDFObject.convert(o)),i("/CIDToGIDMap /Identity"),i("/DW 1000"),i("/Subtype /CIDFontType2"),i("/CIDSystemInfo"),i("<<"),i("/Supplement 0"),i("/Registry (Adobe)"),i("/Ordering ("+n.encoding+")"),i(">>"),i(">>"),i("endobj"),n.objectNumber=a(),i("<<"),i("/Type /Font"),i("/Subtype /Type0"),i("/ToUnicode "+d+" 0 R"),i("/BaseFont /"+lle(n.fontName)),i("/Encoding /"+n.encoding),i("/DescendantFonts ["+p+" 0 R]"),i(">>"),i("endobj"),n.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var n=t.font,i=t.out,a=t.newObject,s=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var o=n.metadata.rawData,l="",c=0;c<o.length;c++)l+=String.fromCharCode(o[c]);var u=a();s({data:l,addLength1:!0,objectId:u}),i("endobj");var h=a();s({data:r(n.metadata.toUnicode),addLength1:!0,objectId:h}),i("endobj");var d=a();i("<<"),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i("/StemV "+n.metadata.stemV),i("/Type /FontDescriptor"),i("/FontFile2 "+u+" 0 R"),i("/Flags 96"),i("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),i("/FontName /"+lle(n.fontName)),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i(">>"),i("endobj"),n.objectNumber=a();for(var A=0;A<n.metadata.hmtx.widths.length;A++)n.metadata.hmtx.widths[A]=parseInt(n.metadata.hmtx.widths[A]*(1e3/n.metadata.head.unitsPerEm));i("<</Subtype/TrueType/Type/Font/ToUnicode "+h+" 0 R/BaseFont/"+lle(n.fontName)+"/FontDescriptor "+d+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),i("endobj"),n.isAlreadyPutted=!0}}(t)}]);var i=function(e){var t,r=e.text||"",i=e.x,a=e.y,s=e.options||{},o=e.mutex||{},l=o.pdfEscape,c=o.activeFontKey,u=o.fonts,h=c,d="",A=0,p="",f=u[h].encoding;if("Identity-H"!==u[h].encoding)return{text:r,x:i,y:a,options:s,mutex:o};for(p=r,h=c,Array.isArray(r)&&(p=r[0]),A=0;A<p.length;A+=1)u[h].metadata.hasOwnProperty("cmap")&&(t=u[h].metadata.cmap.unicode.codeMap[p[A].charCodeAt(0)]),t||p[A].charCodeAt(0)<256&&u[h].metadata.hasOwnProperty("Unicode")?d+=p[A]:d+="";var g="";return parseInt(h.slice(1))<14||"WinAnsiEncoding"===f?g=l(d,h).split("").map(function(e){return e.charCodeAt(0).toString(16)}).join(""):"Identity-H"===f&&(g=n(d,u[h])),o.isHex=!0,{text:g,x:i,y:a,options:s,mutex:o}};t.events.push(["postProcessText",function(e){var t=e.text||"",n=[],r={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var a=0;for(a=0;a<t.length;a+=1)Array.isArray(t[a])&&3===t[a].length?n.push([i(Object.assign({},r,{text:t[a][0]})).text,t[a][1],t[a][2]]):n.push(i(Object.assign({},r,{text:t[a]})).text);e.text=n}else e.text=i(Object.assign({},r,{text:t})).text}])}(ple),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(ple.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var n,r,i,a,s,o,l,c=t,u=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],d={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},A={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},p=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],f=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),g=!1,m=0;this.__bidiEngine__={};var y=function(e){var t=e.charCodeAt(),n=t>>8,r=A[n];return void 0!==r?c[256*r+(255&t)]:252===n||253===n?"AL":f.test(n)?"L":8===n?"R":"N"},v=function(e){for(var t,n=0;n<e.length;n++){if("L"===(t=y(e.charAt(n))))return!1;if("R"===t)return!0}return!1},b=function(e,t,s,o){var l,c,u,h,d=t[o];switch(d){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":g=!1;break;case"N":case"AN":break;case"EN":g&&(d="AN");break;case"AL":g=!0,d="R";break;case"WS":case"BN":d="N";break;case"CS":o<1||o+1>=t.length||"EN"!==(l=s[o-1])&&"AN"!==l||"EN"!==(c=t[o+1])&&"AN"!==c?d="N":g&&(c="AN"),d=c===l?c:"N";break;case"ES":d="EN"===(l=o>0?s[o-1]:"B")&&o+1<t.length&&"EN"===t[o+1]?"EN":"N";break;case"ET":if(o>0&&"EN"===s[o-1]){d="EN";break}if(g){d="N";break}for(u=o+1,h=t.length;u<h&&"ET"===t[u];)u++;d=u<h&&"EN"===t[u]?"EN":"N";break;case"NSM":if(i&&!a){for(h=t.length,u=o+1;u<h&&"NSM"===t[u];)u++;if(u<h){var A=e[o],p=A>=1425&&A<=2303||64286===A;if(l=t[u],p&&("R"===l||"AL"===l)){d="R";break}}}d=o<1||"B"===(l=t[o-1])?"N":s[o-1];break;case"B":g=!1,n=!0,d=m;break;case"S":r=!0,d="N"}return d},x=function(e,t,n){var r=e.split("");return n&&w(r,n,{hiLevel:m}),r.reverse(),t&&t.reverse(),r.join("")},w=function(e,t,i){var a,s,o,l,c,A=-1,p=e.length,f=0,v=[],x=m?h:u,w=[];for(g=!1,n=!1,r=!1,s=0;s<p;s++)w[s]=y(e[s]);for(o=0;o<p;o++){if(c=f,v[o]=b(e,w,v,o),a=240&(f=x[c][d[v[o]]]),f&=15,t[o]=l=x[f][5],a>0)if(16===a){for(s=A;s<o;s++)t[s]=1;A=-1}else A=-1;if(x[f][6])-1===A&&(A=o);else if(A>-1){for(s=A;s<o;s++)t[s]=l;A=-1}"B"===w[o]&&(t[o]=0),i.hiLevel|=l}r&&function(e,t,n){for(var r=0;r<n;r++)if("S"===e[r]){t[r]=m;for(var i=r-1;i>=0&&"WS"===e[i];i--)t[i]=m}}(w,t,p)},_=function(e,t,r,i,a){if(!(a.hiLevel<e)){if(1===e&&1===m&&!n)return t.reverse(),void(r&&r.reverse());for(var s,o,l,c,u=t.length,h=0;h<u;){if(i[h]>=e){for(l=h+1;l<u&&i[l]>=e;)l++;for(c=h,o=l-1;c<o;c++,o--)s=t[c],t[c]=t[o],t[o]=s,r&&(s=r[c],r[c]=r[o],r[o]=s);h=l}h++}}},S=function(e,t,n){var r=e.split(""),i={hiLevel:m};return n||(n=[]),w(r,n,i),function(e,t,n){if(0!==n.hiLevel&&l)for(var r,i=0;i<e.length;i++)1===t[i]&&(r=p.indexOf(e[i]))>=0&&(e[i]=p[r+1])}(r,n,i),_(2,r,t,n,i),_(1,r,t,n,i),r.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,n){if(function(e,t){if(t)for(var n=0;n<e.length;n++)t[n]=n;void 0===a&&(a=v(e)),void 0===o&&(o=v(e))}(e,t),i||!s||o)if(i&&s&&a^o)m=a?1:0,e=x(e,t,n);else if(!i&&s&&o)m=a?1:0,e=S(e,t,n),e=x(e,t);else if(!i||a||s||o){if(i&&!s&&a^o)e=x(e,t),a?(m=0,e=S(e,t,n)):(m=1,e=S(e,t,n),e=x(e,t));else if(i&&a&&!s&&o)m=1,e=S(e,t,n),e=x(e,t);else if(!i&&!s&&a^o){var r=l;a?(m=1,e=S(e,t,n),m=0,l=!1,e=S(e,t,n),l=r):(m=0,e=S(e,t,n),e=x(e,t),m=1,l=!1,e=S(e,t,n),l=r,e=x(e,t))}}else m=0,e=S(e,t,n);else m=a?1:0,e=S(e,t,n);return e},this.__bidiEngine__.setOptions=function(e){e&&(i=e.isInputVisual,s=e.isOutputVisual,a=e.isInputRtl,o=e.isOutputRtl,l=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text;e.x,e.y;var r=e.options||{};e.mutex,r.lang;var i=[];if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(t)){var a=0;for(i=[],a=0;a<t.length;a+=1)"[object Array]"===Object.prototype.toString.call(t[a])?i.push([n.doBidiReorder(t[a][0]),t[a][1],t[a][2]]):i.push([n.doBidiReorder(t[a])]);e.text=i}else e.text=n.doBidiReorder(t);n.setOptions({isInputVisual:!0})}])}(ple),ple.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new Hce(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new oue(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new Qce(this.contents),this.head=new Wce(this),this.name=new $ce(this),this.cmap=new Kce(this),this.toUnicode={},this.hhea=new Xce(this),this.maxp=new eue(this),this.hmtx=new tue(this),this.post=new Jce(this),this.os2=new Yce(this),this.loca=new sue(this),this.glyf=new rue(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,n,r,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,n,r,i;for(i=[],t=0,n=(r=this.bbox).length;t<n;t++)e=r[t],i.push(Math.round(e*this.scaleFactor));return i}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(i=this.familyClass)||2===i||3===i||4===i||5===i||7===i,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,n){var r,i,a,s;for(a=0,i=0,s=(e=""+e).length;0<=s?i<s:i>s;i=0<=s?++i:--i)r=e.charCodeAt(i),a+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return a*(t/1e3)},e.prototype.lineHeight=function(e,t){var n;return null==t&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},e}();var zce,Hce=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,n,r,i,a,s,o;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),i=this.readByte(),a=this.readByte(),s=this.readByte(),o=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^i)+65536*(255^a)+256*(255^s)+(255^o)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*i+65536*a+256*s+o},e.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},e.prototype.write=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(this.writeByte(t));return i},e}(),Qce=function(){var e;function t(e){var t,n,r;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var n,r,i,a,s,o,l,c,u,h,d,A,p;for(p in d=Object.keys(t).length,o=Math.log(2),u=16*Math.floor(Math.log(d)/o),a=Math.floor(u/o),c=16*d-u,(r=new Hce).writeInt(this.scalarType),r.writeShort(d),r.writeShort(u),r.writeShort(a),r.writeShort(c),i=16*d,l=r.pos+i,s=null,A=[],t)for(h=t[p],r.writeString(p),r.writeInt(e(h)),r.writeInt(l),r.writeInt(h.length),A=A.concat(h),"head"===p&&(s=l),l+=h.length;l%4;)A.push(0),l++;return r.write(A),n=2981146554-e(r.data),r.pos=s+8,r.writeUInt32(n),r.data},e=function(e){var t,n,r,i;for(e=nue.call(e);e.length%4;)e.push(0);for(r=new Hce(e),n=0,t=0,i=e.length;t<i;t=t+=4)n+=r.readUInt32();return 4294967295&n},t}(),Vce={}.hasOwnProperty,Gce=function(e,t){for(var n in t)Vce.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};zce=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var Wce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new Hce).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),qce=function(){function e(e,t){var n,r,i,a,s,o,l,c,u,h,d,A,p,f,g,m,y;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),u=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(o=0;o<256;++o)this.codeMap[o]=e.readByte();break;case 4:for(d=e.readUInt16(),h=d/2,e.pos+=6,i=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),e.pos+=2,p=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),l=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),c=function(){var t,n;for(n=[],o=t=0;0<=h?t<h:t>h;o=0<=h?++t:--t)n.push(e.readUInt16());return n}(),r=(this.length-e.pos+this.offset)/2,s=function(){var t,n;for(n=[],o=t=0;0<=r?t<r:t>r;o=0<=r?++t:--t)n.push(e.readUInt16());return n}(),o=g=0,y=i.length;g<y;o=++g)for(f=i[o],n=m=A=p[o];A<=f?m<=f:m>=f;n=A<=f?++m:--m)0===c[o]?a=n+l[o]:0!==(a=s[c[o]/2+(n-A)-(h-o)]||0)&&(a+=l[o]),this.codeMap[n]=65535&a}e.pos=u}return e.encode=function(e,t){var n,r,i,a,s,o,l,c,u,h,d,A,p,f,g,m,y,v,b,x,w,_,S,C,E,N,k,I,T,B,M,F,R,L,P,U,D,O,j,z,H,Q,V,G,W,q;switch(I=new Hce,a=Object.keys(e).sort(function(e,t){return e-t}),t){case"macroman":for(p=0,f=function(){var e=[];for(A=0;A<256;++A)e.push(0);return e}(),m={0:0},i={},T=0,R=a.length;T<R;T++)null==m[V=e[r=a[T]]]&&(m[V]=++p),i[r]={old:e[r],new:m[e[r]]},f[r]=m[e[r]];return I.writeUInt16(1),I.writeUInt16(0),I.writeUInt32(12),I.writeUInt16(0),I.writeUInt16(262),I.writeUInt16(0),I.write(f),{charMap:i,subtable:I.data,maxGlyphID:p+1};case"unicode":for(N=[],u=[],y=0,m={},n={},g=l=null,B=0,L=a.length;B<L;B++)null==m[b=e[r=a[B]]]&&(m[b]=++y),n[r]={old:b,new:m[b]},s=m[b]-r,null!=g&&s===l||(g&&u.push(g),N.push(r),l=s),g=r;for(g&&u.push(g),u.push(65535),N.push(65535),C=2*(S=N.length),_=2*Math.pow(Math.log(S)/Math.LN2,2),h=Math.log(_/2)/Math.LN2,w=2*S-_,o=[],x=[],d=[],A=M=0,P=N.length;M<P;A=++M){if(E=N[A],c=u[A],65535===E){o.push(0),x.push(0);break}if(E-(k=n[E].new)>=32768)for(o.push(0),x.push(2*(d.length+S-A)),r=F=E;E<=c?F<=c:F>=c;r=E<=c?++F:--F)d.push(n[r].new);else o.push(k-E),x.push(0)}for(I.writeUInt16(3),I.writeUInt16(1),I.writeUInt32(12),I.writeUInt16(4),I.writeUInt16(16+8*S+2*d.length),I.writeUInt16(0),I.writeUInt16(C),I.writeUInt16(_),I.writeUInt16(h),I.writeUInt16(w),H=0,U=u.length;H<U;H++)r=u[H],I.writeUInt16(r);for(I.writeUInt16(0),Q=0,D=N.length;Q<D;Q++)r=N[Q],I.writeUInt16(r);for(G=0,O=o.length;G<O;G++)s=o[G],I.writeUInt16(s);for(W=0,j=x.length;W<j;W++)v=x[W],I.writeUInt16(v);for(q=0,z=d.length;q<z;q++)p=d[q],I.writeUInt16(p);return{charMap:n,subtable:I.data,maxGlyphID:y+1}}},e}(),Kce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new qce(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var n,r;return null==t&&(t="macroman"),n=qce.encode(e,t),(r=new Hce).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(),Xce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),Yce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),Jce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="post",e.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(n=e.readUInt16(),this.glyphNameIndex=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=function(){var t,n,r;for(r=[],i=t=0,n=this.file.maxp.numGlyphs;0<=n?t<n:t>n;i=0<=n?++t:--t)r.push(e.readUInt32());return r}.call(this)}},e}(),Zce=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},$ce=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="name",e.prototype.parse=function(e){var t,n,r,i,a,s,o,l,c,u,h;for(e.pos=this.offset,e.readShort(),t=e.readShort(),s=e.readShort(),n=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+s+e.readShort()});for(o={},i=c=0,u=n.length;c<u;i=++c)r=n[i],e.pos=r.offset,l=e.readString(r.length),a=new Zce(l,r),null==o[h=r.nameID]&&(o[h]=[]),o[r.nameID].push(a);this.strings=o,this.copyright=o[0],this.fontFamily=o[1],this.fontSubfamily=o[2],this.uniqueSubfamily=o[3],this.fontName=o[4],this.version=o[5];try{this.postscriptName=o[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(Qoe){this.postscriptName=o[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=o[7],this.manufacturer=o[8],this.designer=o[9],this.description=o[10],this.vendorUrl=o[11],this.designerUrl=o[12],this.license=o[13],this.licenseUrl=o[14],this.preferredFamily=o[15],this.preferredSubfamily=o[17],this.compatibleFull=o[18],this.sampleText=o[19]},e}(),eue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),tue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,n,r,i,a,s,o;for(e.pos=this.offset,this.metrics=[],t=0,s=this.file.hhea.numberOfMetrics;0<=s?t<s:t>s;t=0<=s?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,i;for(i=[],t=n=0;0<=r?n<r:n>r;t=0<=r?++n:--n)i.push(e.readInt16());return i}(),this.widths=function(){var e,t,n,r;for(r=[],e=0,t=(n=this.metrics).length;e<t;e++)i=n[e],r.push(i.advance);return r}.call(this),n=this.widths[this.widths.length-1],o=[],t=a=0;0<=r?a<r:a>r;t=0<=r?++a:--a)o.push(this.widths.push(n));return o},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),nue=[].slice,rue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,n,r,i,a,s,o,l,c,u;return e in this.cache?this.cache[e]:(i=this.file.loca,t=this.file.contents,n=i.indexOf(e),0===(r=i.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+n,a=(s=new Hce(t.read(r))).readShort(),l=s.readShort(),u=s.readShort(),o=s.readShort(),c=s.readShort(),this.cache[e]=-1===a?new aue(s,l,u,o,c):new iue(s,a,l,u,o,c),this.cache[e]))},e.prototype.encode=function(e,t,n){var r,i,a,s,o;for(a=[],i=[],s=0,o=t.length;s<o;s++)r=e[t[s]],i.push(a.length),r&&(a=a.concat(r.encode(n)));return i.push(a.length),{table:a,offsets:i}},e}(),iue=function(){function e(e,t,n,r,i,a){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=a,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),aue=function(){function e(e,t,n,r,i){var a,s;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;s=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&s;)a.pos+=1&s?4:2,128&s?a.pos+=8:64&s?a.pos+=4:8&s&&(a.pos+=2)}return e.prototype.encode=function(){var e,t,n;for(t=new Hce(nue.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),sue=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return Gce(e,zce),e.prototype.tag="loca",e.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=2)r.push(2*e.readUInt16());return r}.call(this):function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=4)r.push(e.readUInt32());return r}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,i=0,a=0;a<n.length;++a)if(n[a]=r,i<t.length&&t[i]==a){++i,n[a]=r;var s=this.offsets[a],o=this.offsets[a+1]-s;o>0&&(r+=o)}for(var l=new Array(4*n.length),c=0;c<n.length;++c)l[4*c+3]=255&n[c],l[4*c+2]=(65280&n[c])>>8,l[4*c+1]=(16711680&n[c])>>16,l[4*c]=(4278190080&n[c])>>24;return l},e}(),oue=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,n,r,i;for(t in r=this.font.cmap.tables[0].codeMap,e={},i=this.subset)n=i[t],e[t]=r[n];return e},e.prototype.glyphsFor=function(e){var t,n,r,i,a,s,o;for(r={},a=0,s=e.length;a<s;a++)r[i=e[a]]=this.font.glyf.glyphFor(i);for(i in t=[],r)(null!=(n=r[i])?n.compound:void 0)&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(i in o=this.glyphsFor(t))n=o[i],r[i]=n;return r},e.prototype.encode=function(e,t){var n,r,i,a,s,o,l,c,u,h,d,A,p,f,g;for(r in n=Kce.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),d={0:0},g=n.charMap)d[(o=g[r]).old]=o.new;for(A in h=n.maxGlyphID,a)A in d||(d[A]=h++);return c=function(e){var t,n;for(t in n={},e)n[e[t]]=t;return n}(d),u=Object.keys(c).sort(function(e,t){return e-t}),p=function(){var e,t,n;for(n=[],e=0,t=u.length;e<t;e++)s=u[e],n.push(c[s]);return n}(),i=this.font.glyf.encode(a,p,d),l=this.font.loca.encode(i.offsets,p),f={cmap:this.font.cmap.raw(),glyf:i.table,loca:l,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(f["OS/2"]=this.font.os2.raw()),this.font.directory.encode(f)},e}();ple.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(n){var r,i,a,s;if(Array.isArray(n))return"["+function(){var e,i,a;for(a=[],e=0,i=n.length;e<i;e++)r=n[e],a.push(t.convert(r));return a}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+e(n.getUTCFullYear(),4)+e(n.getUTCMonth(),2)+e(n.getUTCDate(),2)+e(n.getUTCHours(),2)+e(n.getUTCMinutes(),2)+e(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(i in a=["<<"],n)s=n[i],a.push("/"+i+" "+t.convert(s));return a.push(">>"),a.join("\n")}return""+n},t}();n(5239);const lue=new class{constructor(){this.pageWidth=210,this.pageHeight=297,this.margin=20,this.lineHeight=7,this.currentY=this.margin}async generateReport(e){const t=new ple("p","mm","a4");this.currentY=this.margin,await this.addCoverPage(t,e),t.addPage(),this.currentY=this.margin,await this.addProjectOverview(t,e),t.addPage(),this.currentY=this.margin,await this.addVisualizations(t,e),t.addPage(),this.currentY=this.margin,this.addMeasurements(t,e),t.addPage(),this.currentY=this.margin,this.addProductDetails(t,e),t.addPage(),this.currentY=this.margin,this.addCostEstimate(t,e);const n=t.internal.getNumberOfPages();for(let r=1;r<=n;r++)t.setPage(r),this.addFooter(t,r,n,e);return t}addCoverPage(e,t){e.setFontSize(28),e.setFont("helvetica","bold"),e.setTextColor(30,64,175),e.text("Project Visualization Report",this.pageWidth/2,60,{align:"center"}),e.setFontSize(18),e.setTextColor(50,50,50),e.text(t.projectName||"Roof & Exterior Project",this.pageWidth/2,80,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Customer: ".concat(t.customerName||"N/A"),this.pageWidth/2,100,{align:"center"}),e.text("Address: ".concat(t.address||"N/A"),this.pageWidth/2,110,{align:"center"}),e.setFontSize(10),e.setTextColor(100,100,100),e.text("Generated: ".concat((new Date).toLocaleDateString()),this.pageWidth/2,130,{align:"center"}),e.setDrawColor(30,64,175),e.setLineWidth(.5),e.line(this.margin,150,this.pageWidth-this.margin,150),e.setFontSize(10),e.setTextColor(80,80,80);let n=170;["Powered by Rime + Malarkey","AI-Driven Visualization Technology","Contact: sales@rimehq.net","www.rimehq.net"].forEach(t=>{e.text(t,this.pageWidth/2,n,{align:"center"}),n+=7})}async addProjectOverview(e,t){this.addSectionTitle(e,"Project Overview"),e.setFontSize(11),e.setFont("helvetica","normal"),e.setTextColor(60,60,60);[{label:"Project Type",value:t.projectType||"Roof Replacement & Lighting"},{label:"Property Address",value:t.address||"N/A"},{label:"Customer",value:t.customerName||"N/A"},{label:"Project Date",value:(new Date).toLocaleDateString()},{label:"Estimated Duration",value:t.duration||"3-5 days"},{label:"Warranty",value:t.warranty||"25 years (Malarkey)"}].forEach(t=>{e.setFont("helvetica","bold"),e.text("".concat(t.label,":"),this.margin,this.currentY),e.setFont("helvetica","normal"),e.text(t.value,this.margin+50,this.currentY),this.currentY+=this.lineHeight}),this.currentY+=10,this.addSectionTitle(e,"Description",14),e.setFontSize(10),e.setFont("helvetica","normal");const n=t.description||"This project includes complete roof replacement with Malarkey Legacy shingles, Rime permanent lighting installation, and enhanced curb appeal visualization.";e.splitTextToSize(n,this.pageWidth-2*this.margin).forEach(t=>{e.text(t,this.margin,this.currentY),this.currentY+=6})}async addVisualizations(e,t){var n,r,i;this.addSectionTitle(e,"Visual Comparison");const a=(this.pageWidth-3*this.margin)/2;if(null!==(n=t.images)&&void 0!==n&&n.before){e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Before",this.margin,this.currentY),this.currentY+=7;try{const n=(await this.captureVisualization(t.images.before)).toDataURL("image/jpeg",.9);e.addImage(n,"JPEG",this.margin,this.currentY,a,80)}catch(SS){console.error("Failed to add before image:",SS)}}if(null!==(r=t.images)&&void 0!==r&&r.after||null!==(i=t.images)&&void 0!==i&&i.before){e.setFontSize(12),e.setFont("helvetica","bold"),e.text("After",this.margin+a+10,this.currentY-7);try{const n=(await this.captureVisualization(t.images.after||t.images.before,t)).toDataURL("image/jpeg",.9);e.addImage(n,"JPEG",this.margin+a+10,this.currentY,a,80)}catch(SS){console.error("Failed to add after image:",SS)}}this.currentY+=95,this.addSectionTitle(e,"Key Improvements",14);const s=["\u2713 ".concat(t.shingleColor||"Premium"," Malarkey Legacy Shingles"),"\u2713 Rime Permanent LED Lighting System","\u2713 Enhanced Curb Appeal","\u2713 Energy-Efficient Materials","\u2713 25-Year Warranty Coverage"];e.setFontSize(10),e.setFont("helvetica","normal"),s.forEach(t=>{e.text(t,this.margin+5,this.currentY),this.currentY+=6})}addMeasurements(e,t){this.addSectionTitle(e,"Measurements & Specifications");const n=t.measurements||{},r=[["Measurement","Value","Notes"],["Roof Area","".concat(n.roofArea||"TBD"," sq ft"),"Total coverage area"],["Roof Pitch","".concat(n.pitch||"TBD","\xb0"),"Average slope"],["Perimeter","".concat(n.perimeter||"TBD"," ft"),"Total edge length"],["Lighting Length","".concat(n.lightingLength||"TBD"," ft"),"Rime track length"],["Ridge Length","".concat(n.ridgeLength||"TBD"," ft"),"Peak ventilation"],["Gutter Length","".concat(n.gutterLength||"TBD"," ft"),"Drainage system"]];this.addTable(e,r),this.currentY+=10,this.addSectionTitle(e,"Technical Specifications",14),e.setFontSize(10);["Roofing System: Malarkey Legacy Series","Underlayment: Synthetic, ice & water barrier","Ventilation: Ridge vent + soffit vents","Lighting: Rime permanent LED (RGBW)","Control: WiFi-enabled smart control","Installation: Professional certified crew"].forEach(t=>{e.text("\u2022 ".concat(t),this.margin+5,this.currentY),this.currentY+=6})}addProductDetails(e,t){this.addSectionTitle(e,"Product Details"),this.addProductSection(e,"Malarkey Legacy Shingles",{color:t.shingleColor||"Weathered Wood",warranty:"25 Years Limited",class:"Class 4 Impact Resistance",windRating:"130 MPH",features:["Algae resistant","Energy Star rated","Recycled content"]}),this.currentY+=5,this.addProductSection(e,"Rime Permanent Lighting",{type:"RGBW LED System",control:"WiFi + Mobile App",colors:"16 million+ colors",warranty:"5 Years",features:["Weather resistant","Energy efficient","Programmable patterns"]}),this.currentY+=5,t.additionalProducts&&t.additionalProducts.length>0&&(this.addSectionTitle(e,"Additional Products",14),t.additionalProducts.forEach(t=>{e.setFontSize(10),e.text("\u2022 ".concat(t.name,": ").concat(t.description),this.margin+5,this.currentY),this.currentY+=6}))}addCostEstimate(e,t){this.addSectionTitle(e,"Cost Estimate");const n=t.estimate||{},r=[["Item","Quantity","Unit Price","Total"],["Malarkey Shingles","".concat(n.shingleSquares||"TBD"," sq"),"$".concat(n.shinglePrice||"0"),"$".concat(n.shingleTotal||"0")],["Underlayment","".concat(n.underlaymentSq||"TBD"," sq"),"$".concat(n.underlaymentPrice||"0"),"$".concat(n.underlaymentTotal||"0")],["Rime Lighting","".concat(n.lightingFt||"TBD"," ft"),"$".concat(n.lightingPrice||"0"),"$".concat(n.lightingTotal||"0")],["Labor - Roofing","Flat rate","-","$".concat(n.laborRoof||"0")],["Labor - Lighting","Flat rate","-","$".concat(n.laborLighting||"0")],["Permit & Disposal","Flat rate","-","$".concat(n.permits||"0")]];this.addTable(e,r,!0),this.currentY+=5,e.setFontSize(11),e.setFont("helvetica","bold");const i=n.subtotal||0,a=n.tax||0,s=n.total||0;e.text("Subtotal:",this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(i.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=7,e.text("Tax (".concat(n.taxRate||7,"%):"),this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(a.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=7,e.setFontSize(13),e.setTextColor(30,64,175),e.text("Total Estimate:",this.pageWidth-this.margin-60,this.currentY,{align:"left"}),e.text("$".concat(s.toLocaleString()),this.pageWidth-this.margin,this.currentY,{align:"right"}),this.currentY+=15,e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(80,80,80);["Payment Terms: 50% deposit, 50% upon completion","Estimate valid for 30 days","Final cost may vary based on site conditions","All warranties as stated by manufacturers"].forEach(t=>{e.text(t,this.margin,this.currentY),this.currentY+=5})}addSectionTitle(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;e.setFontSize(n),e.setFont("helvetica","bold"),e.setTextColor(30,64,175),e.text(t,this.margin,this.currentY),this.currentY+=16===n?10:8,e.setDrawColor(30,64,175),e.setLineWidth(.3),e.line(this.margin,this.currentY-2,this.margin+e.getTextWidth(t),this.currentY-2),this.currentY+=5}addProductSection(e,t,n){e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(40,40,40),e.text(t,this.margin,this.currentY),this.currentY+=7,e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(60,60,60),Object.entries(n).forEach(t=>{let[n,r]=t;"features"===n&&Array.isArray(r)?(e.text("".concat(n,":"),this.margin+5,this.currentY),this.currentY+=5,r.forEach(t=>{e.text("  \u2022 ".concat(t),this.margin+10,this.currentY),this.currentY+=5})):(e.text("".concat(n,": ").concat(r),this.margin+5,this.currentY),this.currentY+=5)})}addTable(e,t){const n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?[80,30,30,30]:[60,50,50],r=this.margin;let i=this.currentY;t.forEach((t,a)=>{let s=r;t.forEach((t,r)=>{0===a?(e.setFontSize(9),e.setFont("helvetica","bold"),e.setFillColor(230,230,230),e.rect(s,i-5,n[r],7,"F")):(e.setFontSize(9),e.setFont("helvetica","normal")),e.text(t,s+2,i,{maxWidth:n[r]-4}),s+=n[r]}),i+=7}),this.currentY=i+5}addFooter(e,t,n,r){e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const i=this.pageHeight-10;e.text("Page ".concat(t," of ").concat(n),this.pageWidth/2,i,{align:"center"}),e.text("Powered by Rime + Malarkey \u2022 www.rimehq.net",this.margin,i)}async captureVisualization(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=800,t.height=600;const r=new Image;return r.crossOrigin="anonymous",new Promise(i=>{r.onload=()=>{n.drawImage(r,0,0,t.width,t.height),i(t)},r.src=e})}async save(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project-report.pdf";(await this.generateReport(e)).save(t)}async getBlob(e){return(await this.generateReport(e)).output("blob")}};const cue=new class{constructor(){this.pricing={shingles:{"weathered-wood":{perSquare:145,name:"Weathered Wood"},"midnight-black":{perSquare:155,name:"Midnight Black"},"storm-grey":{perSquare:150,name:"Storm Grey"},"antique-brown":{perSquare:148,name:"Antique Brown"},"terra-cotta":{perSquare:160,name:"Terra Cotta"},"forest-green":{perSquare:158,name:"Forest Green"},"autumn-red":{perSquare:165,name:"Autumn Red"}},underlayment:{perSquare:25},iceWaterBarrier:{perLinearFoot:3.5},ridgeVent:{perLinearFoot:8.75},dripEdge:{perLinearFoot:2.25},flashing:{perLinearFoot:5.5},lighting:{rime:{trackPerFoot:12.5,controllerBase:299,powerSupply:199,installationPerFoot:8}},gutters:{kStyle:{perLinearFoot:6.5,installationPerFoot:3},halfRound:{perLinearFoot:9.5,installationPerFoot:4}},labor:{roofing:{perSquare:85,minimumCharge:500},lighting:{perFoot:8,minimumCharge:400},gutters:{perFoot:3,minimumCharge:200}},disposal:{perSquare:15},permits:{flatFee:250}},this.wasteFactor={shingles:1.1,underlayment:1.1,lighting:1.05,gutters:1.05},this.taxRate=.07}calculateEstimate(e){const{measurements:t={},shingleColor:n="weathered-wood",lightingLength:r=0,gutterLength:i=0,gutterStyle:a="kStyle",includeRidgeVent:s=!0,includeGutters:o=!1}=e,l={materials:{},labor:{},subtotal:0,tax:0,total:0,breakdown:[]},c=t.roofArea||2e3,u=Math.ceil(c/100),h=u*this.wasteFactor.shingles,d=this.calculateShingleCost(n,h);l.materials.shingles=d,l.breakdown.push({category:"Materials",item:"Malarkey ".concat(this.pricing.shingles[n].name," Shingles"),quantity:"".concat(u," sq"),unitPrice:this.pricing.shingles[n].perSquare,total:d.total});const A=this.calculateUnderlaymentCost(h);if(l.materials.underlayment=A,l.breakdown.push({category:"Materials",item:"Synthetic Underlayment",quantity:"".concat(u," sq"),unitPrice:this.pricing.underlayment.perSquare,total:A.total}),s){const e=t.ridgeLength||.02*c,n=this.calculateRidgeVentCost(e);l.materials.ridgeVent=n,l.breakdown.push({category:"Materials",item:"Ridge Vent",quantity:"".concat(e.toFixed(0)," ft"),unitPrice:this.pricing.ridgeVent.perLinearFoot,total:n.total})}const p=t.perimeter||4*Math.sqrt(c),f=this.calculateDripEdgeCost(p);if(l.materials.dripEdge=f,l.breakdown.push({category:"Materials",item:"Drip Edge",quantity:"".concat(p.toFixed(0)," ft"),unitPrice:this.pricing.dripEdge.perLinearFoot,total:f.total}),r>0){const e=this.calculateLightingCost(r);l.materials.lighting=e,l.breakdown.push({category:"Materials",item:"Rime Permanent Lighting System",quantity:"".concat(r.toFixed(0)," ft"),unitPrice:this.pricing.lighting.rime.trackPerFoot,total:e.materials}),l.breakdown.push({category:"Materials",item:"Rime Controller & Power Supply",quantity:"1 set",unitPrice:this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply,total:this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply})}if(o&&i>0){const e=this.calculateGutterCost(i,a);l.materials.gutters=e,l.breakdown.push({category:"Materials",item:"".concat("kStyle"===a?"K-Style":"Half-Round"," Gutters"),quantity:"".concat(i.toFixed(0)," ft"),unitPrice:this.pricing.gutters[a].perLinearFoot,total:e.materials})}const g=this.calculateRoofingLabor(u);if(l.labor.roofing=g,l.breakdown.push({category:"Labor",item:"Roof Tear-off & Installation",quantity:"".concat(u," sq"),unitPrice:this.pricing.labor.roofing.perSquare,total:g.total}),r>0){const e=this.calculateLightingLabor(r);l.labor.lighting=e,l.breakdown.push({category:"Labor",item:"Lighting Installation",quantity:"".concat(r.toFixed(0)," ft"),unitPrice:this.pricing.labor.lighting.perFoot,total:e.total})}if(o&&i>0){const e=this.calculateGutterLabor(i);l.labor.gutters=e,l.breakdown.push({category:"Labor",item:"Gutter Installation",quantity:"".concat(i.toFixed(0)," ft"),unitPrice:this.pricing.labor.gutters.perFoot,total:e.total})}const m=this.calculateDisposalCost(u);return l.materials.disposal=m,l.breakdown.push({category:"Other",item:"Debris Removal & Disposal",quantity:"".concat(u," sq"),unitPrice:this.pricing.disposal.perSquare,total:m.total}),l.materials.permits={total:this.pricing.permits.flatFee},l.breakdown.push({category:"Other",item:"Permits & Inspection",quantity:"1",unitPrice:this.pricing.permits.flatFee,total:this.pricing.permits.flatFee}),l.subtotal=l.breakdown.reduce((e,t)=>e+t.total,0),l.tax=l.subtotal*this.taxRate,l.total=l.subtotal+l.tax,l.summary={materialsCost:l.breakdown.filter(e=>"Materials"===e.category||"Other"===e.category).reduce((e,t)=>e+t.total,0),laborCost:l.breakdown.filter(e=>"Labor"===e.category).reduce((e,t)=>e+t.total,0),roofArea:c,squares:u,costPerSquareFoot:l.total/c,taxRate:100*this.taxRate},l}calculateShingleCost(e,t){var n;const r=(null===(n=this.pricing.shingles[e])||void 0===n?void 0:n.perSquare)||150;return{quantity:t,pricePerSquare:r,total:t*r,color:e}}calculateUnderlaymentCost(e){const t=e*this.pricing.underlayment.perSquare;return{quantity:e,pricePerSquare:this.pricing.underlayment.perSquare,total:t}}calculateRidgeVentCost(e){const t=e*this.pricing.ridgeVent.perLinearFoot;return{quantity:e,pricePerFoot:this.pricing.ridgeVent.perLinearFoot,total:t}}calculateDripEdgeCost(e){const t=e*this.pricing.dripEdge.perLinearFoot;return{quantity:e,pricePerFoot:this.pricing.dripEdge.perLinearFoot,total:t}}calculateLightingCost(e){const t=e*this.wasteFactor.lighting*this.pricing.lighting.rime.trackPerFoot+this.pricing.lighting.rime.controllerBase+this.pricing.lighting.rime.powerSupply,n=e*this.pricing.lighting.rime.installationPerFoot;return{quantity:e,materials:t,installation:n,total:t+n}}calculateGutterCost(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"kStyle";const n=e*this.wasteFactor.gutters*this.pricing.gutters[t].perLinearFoot,r=e*this.pricing.gutters[t].installationPerFoot;return{quantity:e,style:t,materials:n,installation:r,total:n+r}}calculateRoofingLabor(e){const t=e*this.pricing.labor.roofing.perSquare,n=Math.max(t,this.pricing.labor.roofing.minimumCharge);return{quantity:e,pricePerSquare:this.pricing.labor.roofing.perSquare,total:n}}calculateLightingLabor(e){const t=e*this.pricing.labor.lighting.perFoot,n=Math.max(t,this.pricing.labor.lighting.minimumCharge);return{quantity:e,pricePerFoot:this.pricing.labor.lighting.perFoot,total:n}}calculateGutterLabor(e){const t=e*this.pricing.labor.gutters.perFoot,n=Math.max(t,this.pricing.labor.gutters.minimumCharge);return{quantity:e,pricePerFoot:this.pricing.labor.gutters.perFoot,total:n}}calculateDisposalCost(e){const t=e*this.pricing.disposal.perSquare;return{quantity:e,pricePerSquare:this.pricing.disposal.perSquare,total:t}}applyDiscount(e,t){const n=e.subtotal*(t/100);return M(M({},e),{},{discount:{percent:t,amount:n},subtotal:e.subtotal-n,tax:(e.subtotal-n)*this.taxRate,total:(e.subtotal-n)*(1+this.taxRate)})}generateFinancingOptions(e){const t=[12,24,36,48,60],n=[];return[0,.0499,.0699,.0899].forEach(r=>{t.forEach(t=>{const i=this.calculateMonthlyPayment(e,r,t);n.push({term:t,rate:100*r,monthlyPayment:i.toFixed(2),totalPaid:(i*t).toFixed(2),totalInterest:(i*t-e).toFixed(2)})})}),n}calculateMonthlyPayment(e,t,n){if(0===t)return e/n;const r=t/12;return e*(r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1)}updatePricing(e,t,n){return!(!this.pricing[e]||!this.pricing[e][t])&&(this.pricing[e][t]=n,!0)}getPrice(e,t,n){return this.pricing[e]?t?(null===(r=this.pricing[e][t])||void 0===r?void 0:r[n])||this.pricing[e][t]:this.pricing[e][n]:null;var r}};function uue(){const e=(0,k.useRef)(),[t,n]=(0,k.useState)(null),[r,i]=(0,k.useState)(!1),[a,s]=(0,k.useState)(!1),[o,l]=(0,k.useState)(!1),[c,u]=(0,k.useState)(!1),[h,d]=(0,k.useState)("main"),{images:A,viewMode:p,setBeforeImage:f,setViewMode:g,ui:m,setLoading:y,resetAll:v,shingles:b,lighting:x,measurements:w,addShingleRegion:_,addLight:S}=gC(),C=[{id:"before",label:"Before",icon:Y},{id:"after",label:"After",icon:Y},{id:"compare",label:"Compare",icon:SC}],E=async()=>{y(!0);try{const e=cue.calculateEstimate({measurements:w,shingleColor:b.selectedColor,lightingLength:12*x.lights.length,includeRidgeVent:!0,includeGutters:!1}),t={projectName:"Roof Visualization Project",customerName:"Customer Name",address:"123 Main St",images:A,measurements:w,shingleColor:b.selectedColor,estimate:e};await lue.save(t,"project-report-".concat(Date.now(),".pdf")),alert("PDF report generated successfully!")}catch(SS){console.error("PDF generation failed:",SS),alert("Failed to generate PDF report.")}finally{y(!1)}};return(0,va.jsxs)("div",{className:"control-panel bg-white rounded-lg shadow-lg p-4 space-y-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Controls"}),(0,va.jsx)("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 p-1",title:"Reset All",children:(0,va.jsx)(Ba,{className:"w-4 h-4"})})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"House Image"}),(0,va.jsx)("input",{ref:e,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];t&&(n(t),i(!0))},className:"hidden"}),(0,va.jsxs)("button",{onClick:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.click()},disabled:m.isLoading,className:"w-full py-2.5 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,va.jsx)(CC,{className:"w-4 h-4"}),A.before?"Change Image":"Upload House Photo"]}),A.before&&(0,va.jsx)("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:"\u2713 Image loaded successfully"})]}),r&&t&&(0,va.jsx)(TC,{file:t,onValidationComplete:async e=>{if(e.valid){y(!0);try{const e=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;return new Promise((r,i)=>{const a=new Image,s=URL.createObjectURL(e);a.onload=()=>{URL.revokeObjectURL(s);const o=document.createElement("canvas");let{width:l,height:c}=a;l>t&&(c=c*t/l,l=t),o.width=l,o.height=c,o.getContext("2d").drawImage(a,0,0,l,c),o.toBlob(t=>{if(t){const n=new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()});r({file:n,url:URL.createObjectURL(t),width:l,height:c})}else i(new Error("Failed to compress image"))},"image/jpeg",n)},a.onerror=()=>{URL.revokeObjectURL(s),i(new Error("Failed to load image"))},a.src=s})}(t,2048,.9);f(e.url),i(!1),n(null)}catch(SS){console.error("Image upload error:",SS),alert("Failed to process image")}finally{y(!1)}}}}),A.before&&(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"View Mode"}),(0,va.jsx)("div",{className:"grid grid-cols-3 gap-2",children:C.map(e=>{const t=e.icon;return(0,va.jsxs)("button",{onClick:()=>g(e.id),className:"py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ".concat(p===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(t,{className:"w-3 h-3"}),e.label]},e.id)})})]}),A.before&&"main"===h&&(0,va.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,va.jsxs)("h4",{className:"text-sm font-semibold mb-2 text-gray-700 flex items-center gap-2",children:["Phase 2 Features",(0,va.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"NEW"})]}),(0,va.jsxs)("div",{className:"space-y-2",children:[(0,va.jsxs)("button",{onClick:async()=>{if(A.before){y(!0);try{const e=await vne.autoPlaceAll(A.before,{shingleColor:b.selectedColor,lightingPattern:"uniform"});e.placements.shingles.forEach(e=>{_(e)}),e.placements.lighting.forEach(e=>{S(e)}),alert("Auto-placement complete! Added ".concat(e.placements.shingles.length," shingle regions and ").concat(e.placements.lighting.length," lights."))}catch(SS){console.error("Auto-placement failed:",SS),alert("Auto-placement failed. Please try manual placement.")}finally{y(!1)}}},disabled:m.isLoading,className:"w-full py-2 px-3 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[(0,va.jsx)(EC,{className:"w-4 h-4"}),"AI Auto-Placement"]}),(0,va.jsxs)("button",{onClick:()=>d("measurement"),className:"w-full py-2 px-3 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(NC,{className:"w-4 h-4"}),"Measurement Tools"]}),(0,va.jsxs)("button",{onClick:()=>d("camera"),className:"w-full py-2 px-3 bg-teal-600 text-white rounded-lg text-sm font-medium hover:bg-teal-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(kC,{className:"w-4 h-4"}),"8-Photo Capture (3D)"]}),(0,va.jsxs)("button",{onClick:()=>d("estimate"),className:"w-full py-2 px-3 bg-amber-600 text-white rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(W,{className:"w-4 h-4"}),"Cost Estimate"]}),(0,va.jsxs)("button",{onClick:E,disabled:m.isLoading,className:"w-full py-2 px-3 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[(0,va.jsx)(ls,{className:"w-4 h-4"}),"Generate PDF Report"]}),(0,va.jsxs)("button",{onClick:()=>{const e=document.querySelector("canvas");e&&e.toBlob(e=>{const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="visualization-".concat(Date.now(),".png"),n.click()})},className:"w-full py-2 px-3 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(IC,{className:"w-4 h-4"}),"Export Image"]})]})]}),"camera"===h&&(0,va.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,va.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,va.jsx)(RC,{onComplete:async e=>{y(!0);try{const t=await bne.processPhotos(e);alert("Photos uploaded successfully! Processing job ID: ".concat(t.jobId,". Estimated time: ").concat(Math.floor(t.estimatedTime/60)," minutes.")),s(!1),d("main")}catch(SS){console.error("Photo processing failed:",SS),alert("Photo processing failed: ".concat(SS.message))}finally{y(!1)}}})]}),"measurement"===h&&(0,va.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,va.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,va.jsx)(OC,{})]}),"estimate"===h&&(0,va.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,va.jsx)("button",{onClick:()=>d("main"),className:"text-sm text-blue-600 hover:text-blue-700 mb-3",children:"\u2190 Back to Main"}),(0,va.jsxs)("div",{className:"bg-gray-50 rounded p-3",children:[(0,va.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"Quick Estimate"}),(0,va.jsxs)("div",{className:"text-sm space-y-1",children:[(0,va.jsxs)("div",{className:"flex justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Roof Area:"}),(0,va.jsxs)("span",{className:"font-medium",children:[w.roofArea||0," sq ft"]})]}),(0,va.jsxs)("div",{className:"flex justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Shingles:"}),(0,va.jsx)("span",{className:"font-medium",children:b.selectedColor})]}),(0,va.jsxs)("div",{className:"flex justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Lighting:"}),(0,va.jsxs)("span",{className:"font-medium",children:[x.lights.length," fixtures"]})]})]}),(0,va.jsx)("button",{onClick:E,className:"w-full mt-3 py-2 bg-blue-600 text-white rounded text-sm font-medium hover:bg-blue-700",children:"Generate Full Report"})]})]}),"main"===h&&(0,va.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,va.jsx)("p",{className:"text-xs text-gray-600",children:(0,va.jsx)("strong",{children:"How to use:"})}),(0,va.jsxs)("ul",{className:"text-xs text-gray-600 mt-2 space-y-1 pl-4",children:[(0,va.jsx)("li",{children:"\u2022 Upload a house photo to begin"}),(0,va.jsx)("li",{children:"\u2022 Use AI Auto-Placement for instant results"}),(0,va.jsx)("li",{children:"\u2022 Measure roof surfaces with tools"}),(0,va.jsx)("li",{children:"\u2022 Capture 8 photos for 3D reconstruction"}),(0,va.jsx)("li",{children:"\u2022 Generate cost estimates & PDF reports"}),(0,va.jsx)("li",{children:"\u2022 Export final visualization"})]})]})]})}const hue=z("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),due=z("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Aue=z("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function pue(e){var t;let{colors:n,selectedColor:r,onSelectColor:i,title:a="Colors"}=e;return(0,va.jsxs)("div",{className:"color-palette",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold mb-3 text-gray-700",children:a}),(0,va.jsx)("div",{className:"grid grid-cols-4 gap-2",children:n.map(e=>(0,va.jsx)("button",{onClick:()=>i(e.id),className:"relative aspect-square rounded-lg border-2 transition-all hover:scale-105 ".concat(r===e.id?"border-blue-600 ring-2 ring-blue-200":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:e.hex},title:e.name,children:r===e.id&&(0,va.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,va.jsx)("div",{className:"bg-white rounded-full p-0.5",children:(0,va.jsx)(Aue,{className:"w-4 h-4 text-blue-600"})})})},e.id))}),(0,va.jsx)("div",{className:"mt-2 text-xs text-gray-600 font-medium",children:(null===(t=n.find(e=>e.id===r))||void 0===t?void 0:t.name)||"Select a color"})]})}function fue(){const{shingles:e,setShingleColor:t,setShingleOpacity:n,addShingleRegion:r,removeShingleRegion:i}=gC(),a=Object.entries(mC).map(e=>{let[t,n]=e;return{id:t,name:n.name,hex:n.hex,color:n.baseColor}});return(0,va.jsxs)("div",{className:"shingle-selector bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Malarkey Shingles"}),(0,va.jsxs)("div",{className:"group relative",children:[(0,va.jsx)(BC,{className:"w-4 h-4 text-gray-400 cursor-help"}),(0,va.jsx)("div",{className:"absolute right-0 top-6 hidden group-hover:block bg-gray-900 text-white text-xs rounded p-2 w-48 z-10",children:"Select a shingle color and click Apply to add to your roof"})]})]}),(0,va.jsx)(pue,{colors:a,selectedColor:e.selectedColor,onSelectColor:t,title:"Select Shingle Color"}),(0,va.jsxs)("div",{className:"mt-4",children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Opacity: ",Math.round(100*e.opacity),"%"]}),(0,va.jsx)("input",{type:"range",min:"0",max:"100",value:100*e.opacity,onChange:e=>n(e.target.value/100),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),(0,va.jsxs)("button",{onClick:()=>{const t={id:Date.now(),color:e.selectedColor,opacity:e.opacity,position:[0,0,0],scale:[1,1,1]};r(t)},className:"w-full mt-4 py-2.5 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(Ca,{className:"w-4 h-4"}),"Apply to Roof"]}),e.appliedRegions.length>0&&(0,va.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Applied Shingles"}),(0,va.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:e.appliedRegions.map(e=>{const t=a.find(t=>t.id===e.color);return(0,va.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2",children:[(0,va.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:null===t||void 0===t?void 0:t.hex}}),(0,va.jsx)("span",{className:"text-sm text-gray-700",children:null===t||void 0===t?void 0:t.name})]}),(0,va.jsx)("button",{onClick:()=>i(e.id),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Remove"})]},e.id)})})]}),(0,va.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:(0,va.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,va.jsx)("strong",{children:"Premium Malarkey Shingles"}),(0,va.jsx)("br",{}),"Class 4 Impact Resistant \u2022 50-Year Warranty"]})})]})}const gue=z("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),mue=z("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),yue=z("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);function vue(){const{lighting:e,setLightingEnabled:t,setTrackColor:n,setLightingPattern:r,setLightingColor:i,setLightingBrightness:a,addLight:s,removeLight:o,generateDefaultLighting:l}=gC(),c=Object.entries(yC).map(e=>{let[t,n]=e;return{id:t,name:n.name,hex:n.hex,color:n.color}}),[u,h]=(0,k.useState)("auto");return(0,va.jsxs)("div",{className:"lighting-designer bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsxs)("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[(0,va.jsx)(due,{className:"w-5 h-5 text-purple-600"}),"Rime Lighting System"]}),(0,va.jsx)("button",{onClick:()=>t(!e.enabled),className:"p-2 rounded-lg transition-colors ".concat(e.enabled?"bg-purple-600 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"),title:e.enabled?"Lighting On":"Lighting Off",children:(0,va.jsx)(gue,{className:"w-4 h-4"})})]}),(0,va.jsx)("div",{className:"mb-4",children:(0,va.jsxs)("div",{className:"flex gap-2",children:[(0,va.jsxs)("button",{onClick:()=>h("auto"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("auto"===u?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(mue,{className:"w-4 h-4 inline mr-1"}),"Auto Design"]}),(0,va.jsxs)("button",{onClick:()=>h("manual"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("manual"===u?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(yue,{className:"w-4 h-4 inline mr-1"}),"Manual"]})]})}),"auto"===u?(0,va.jsxs)("div",{children:[(0,va.jsxs)("button",{onClick:l,className:"w-full py-2.5 px-4 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(yue,{className:"w-4 h-4"}),"Generate Complete Lighting Design"]}),(0,va.jsx)("p",{className:"mt-2 text-xs text-gray-600 text-center",children:"Automatically places professional lighting around the house"})]}):(0,va.jsx)("div",{children:(0,va.jsxs)("button",{onClick:()=>{const t={position:[0,5,-20],color:e.color,intensity:e.brightness/100*3,range:15,beamWidth:2,beamLength:10};s(t)},className:"w-full py-2.5 px-4 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center gap-2",children:[(0,va.jsx)(Ca,{className:"w-4 h-4"}),"Add Light Fixture"]})}),(0,va.jsx)("div",{className:"mt-4",children:(0,va.jsx)(pue,{colors:c,selectedColor:e.trackColor,onSelectColor:n,title:"Aluminum Track Color"})}),(0,va.jsxs)("div",{className:"mt-4",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"LED Color"}),(0,va.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{name:"Warm White",value:"#fff8dc"},{name:"Cool White",value:"#ffffff"},{name:"Amber",value:"#ffbf00"},{name:"Red",value:"#ff0000"},{name:"Green",value:"#00ff00"},{name:"Blue",value:"#0000ff"},{name:"Purple",value:"#800080"},{name:"Cyan",value:"#00ffff"}].map(t=>(0,va.jsx)("button",{onClick:()=>i(t.value),className:"aspect-square rounded-lg border-2 transition-all hover:scale-105 ".concat(e.color===t.value?"border-purple-600 ring-2 ring-purple-200":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:t.value},title:t.name},t.value))})]}),(0,va.jsxs)("div",{className:"mt-4",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold mb-2 text-gray-700",children:"Lighting Pattern"}),(0,va.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{id:"solid",name:"Solid",icon:"\u2b24"},{id:"chase",name:"Chase",icon:"\u2192"},{id:"fade",name:"Fade",icon:"\u25d0"},{id:"holiday",name:"Holiday",icon:"\ud83c\udf84"}].map(t=>(0,va.jsxs)("button",{onClick:()=>r(t.id),className:"py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat(e.pattern===t.id?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)("span",{className:"mr-1",children:t.icon}),t.name]},t.id))})]}),(0,va.jsxs)("div",{className:"mt-4",children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Brightness: ",e.brightness,"%"]}),(0,va.jsx)("input",{type:"range",min:"0",max:"100",value:e.brightness,onChange:e=>a(Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})]}),e.lights.length>0&&(0,va.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsxs)("h4",{className:"text-sm font-semibold text-gray-700",children:["Installed Lights (",e.lights.length,")"]}),e.lights.length>0&&(0,va.jsx)("button",{onClick:()=>e.lights.forEach(e=>o(e.id)),className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"})]}),(0,va.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:e.lights.map(e=>(0,va.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,va.jsxs)("div",{className:"flex items-center gap-2",children:[(0,va.jsx)(due,{className:"w-3 h-3 text-purple-600"}),(0,va.jsxs)("span",{className:"text-xs text-gray-700",children:["Position: ",e.position.map(e=>e.toFixed(0)).join(", ")]})]}),(0,va.jsx)("button",{onClick:()=>o(e.id),className:"text-red-600 hover:text-red-800",children:(0,va.jsx)(DC,{className:"w-3 h-3"})})]},e.id))})]}),(0,va.jsx)("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-100",children:(0,va.jsxs)("p",{className:"text-xs text-purple-800",children:[(0,va.jsx)("strong",{children:"Rime Lighting - Jellyfish Style"}),(0,va.jsx)("br",{}),"RGB+W LED \u2022 App Controlled \u2022 Weather Resistant"]})})]})}function bue(){const{ui:e,setActivePanel:t}=gC(),n=[{id:"products",label:"Shingles",icon:hue},{id:"lighting",label:"Lighting",icon:due}];return(0,va.jsxs)("div",{className:"product-panel bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,va.jsx)("div",{className:"flex border-b border-gray-200",children:n.map(n=>{const r=n.icon;return(0,va.jsxs)("button",{onClick:()=>t(n.id),className:"flex-1 py-3 px-4 font-medium text-sm transition-colors flex items-center justify-center gap-2 ".concat(e.activePanel===n.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50"),children:[(0,va.jsx)(r,{className:"w-4 h-4"}),n.label]},n.id)})}),(0,va.jsxs)("div",{className:"p-4",children:["products"===e.activePanel&&(0,va.jsx)(fue,{}),"lighting"===e.activePanel&&(0,va.jsx)(vue,{})]})]})}function xue(){const{ui:e,toggleControls:t}=gC();return(0,va.jsxs)("div",{className:"visualization-360 h-full w-full relative bg-gray-900",children:[(0,va.jsx)("div",{className:"absolute inset-0",children:(0,va.jsx)(_C,{})}),e.showControls&&(0,va.jsx)("div",{className:"absolute top-4 left-4 w-80 max-h-[calc(100vh-120px)] overflow-y-auto z-10",children:(0,va.jsx)(uue,{})}),e.showControls&&(0,va.jsx)("div",{className:"absolute top-4 right-4 w-96 max-h-[calc(100vh-120px)] overflow-y-auto z-10",children:(0,va.jsx)(bue,{})}),(0,va.jsxs)("button",{onClick:t,className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-20 bg-white hover:bg-gray-100 text-gray-800 px-4 py-2 rounded-full shadow-lg font-medium text-sm transition-colors flex items-center gap-2",title:e.showControls?"Hide Controls":"Show Controls",children:[(0,va.jsx)(Y,{className:"w-4 h-4"}),e.showControls?"Hide Controls":"Show Controls"]}),e.isLoading&&(0,va.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,va.jsxs)("div",{className:"bg-white rounded-lg p-6 flex items-center gap-3",children:[(0,va.jsx)(H,{className:"w-6 h-6 text-blue-600 animate-spin"}),(0,va.jsx)("span",{className:"text-gray-800 font-medium",children:"Processing..."})]})}),(0,va.jsx)("div",{className:"absolute bottom-4 right-4 z-10 bg-black bg-opacity-60 text-white px-3 py-1.5 rounded text-xs",children:"Powered by Rime + Malarkey \u2022 AI Visualization Technology"})]})}const wue=z("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),_ue=z("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),Sue=z("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);function Cue(e,t){let n;try{n=e()}catch(IAe){return}const r={getItem:e=>{var r;const i=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),a=null!=(r=n.getItem(e))?r:null;return a instanceof Promise?a.then(i):i(a)},setItem:(e,r)=>n.setItem(e,JSON.stringify(r,null==t?void 0:t.replacer)),removeItem:e=>n.removeItem(e)};return r}const Eue=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>Eue(e)(n),catch(e){return this}}}catch(IAe){return{then(e){return this},catch:t=>Eue(t)(IAe)}}},Nue=(e,t)=>(n,r,i)=>{let a=M({storage:Cue(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>M(M({},t),e)},t),s=!1;const o=new Set,l=new Set;let c=a.storage;if(!c)return e(function(){console.warn("[zustand persist middleware] Unable to update item '".concat(a.name,"', the given storage is currently unavailable.")),n(...arguments)},r,i);const u=()=>{const e=a.partialize(M({},r()));return c.setItem(a.name,{state:e,version:a.version})},h=i.setState;i.setState=(e,t)=>(h(e,t),u());const d=e(function(){return n(...arguments),u()},r,i);let A;i.getInitialState=()=>d;const p=()=>{var e,t;if(!c)return;s=!1,o.forEach(e=>{var t;return e(null!=(t=r())?t:d)});const i=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=r())?e:d))||void 0;return Eue(c.getItem.bind(c))(a.name).then(e=>{if(e){if("number"!==typeof e.version||e.version===a.version)return[!1,e.state];if(a.migrate){const t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[i,s]=e;if(A=a.merge(s,null!=(t=r())?t:d),n(A,!0),i)return u()}).then(()=>{null==i||i(A,void 0),A=r(),s=!0,l.forEach(e=>e(A))}).catch(e=>{null==i||i(void 0,e)})};return i.persist={setOptions:e=>{a=M(M({},a),e),e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>p(),hasHydrated:()=>s,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},a.skipHydration||p(),A||d};var kue=Symbol.for("immer-nothing"),Iue=Symbol.for("immer-draftable"),Tue=Symbol.for("immer-state");function Bue(e){throw new Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var Mue=Object.getPrototypeOf;function Fue(e){return!!e&&!!e[Tue]}function Rue(e){var t;return!!e&&(Pue(e)||Array.isArray(e)||!!e[Iue]||!(null===(t=e.constructor)||void 0===t||!t[Iue])||zue(e)||Hue(e))}var Lue=Object.prototype.constructor.toString();function Pue(e){if(!e||"object"!==typeof e)return!1;const t=Mue(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Lue}function Uue(e,t){0===Due(e)?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function Due(e){const t=e[Tue];return t?t.type_:Array.isArray(e)?1:zue(e)?2:Hue(e)?3:0}function Oue(e,t){return 2===Due(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function jue(e,t,n){const r=Due(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function zue(e){return e instanceof Map}function Hue(e){return e instanceof Set}function Que(e){return e.copy_||e.base_}function Vue(e,t){if(zue(e))return new Map(e);if(Hue(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Pue(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[Tue];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Mue(e),t)}{const t=Mue(e);if(null!==t&&n)return M({},e);const r=Object.create(t);return Object.assign(r,e)}}function Gue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return que(e)||Fue(e)||!Rue(e)||(Due(e)>1&&Object.defineProperties(e,{set:{value:Wue},add:{value:Wue},clear:{value:Wue},delete:{value:Wue}}),Object.freeze(e),t&&Object.values(e).forEach(e=>Gue(e,!0))),e}function Wue(){Bue(2)}function que(e){return Object.isFrozen(e)}var Kue,Xue={};function Yue(e){const t=Xue[e];return t||Bue(0),t}function Jue(){return Kue}function Zue(e,t){t&&(Yue("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function $ue(e){ehe(e),e.drafts_.forEach(nhe),e.drafts_=null}function ehe(e){e===Kue&&(Kue=e.parent_)}function the(e){return Kue={drafts_:[],parent_:Kue,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function nhe(e){const t=e[Tue];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function rhe(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[Tue].modified_&&($ue(t),Bue(4)),Rue(e)&&(e=ihe(t,e),t.parent_||she(t,e)),t.patches_&&Yue("Patches").generateReplacementPatches_(n[Tue].base_,e,t.patches_,t.inversePatches_)):e=ihe(t,n,[]),$ue(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==kue?e:void 0}function ihe(e,t,n){if(que(t))return t;const r=t[Tue];if(!r)return Uue(t,(i,a)=>ahe(e,r,t,i,a,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return she(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,a=!1;3===r.type_&&(i=new Set(t),t.clear(),a=!0),Uue(i,(i,s)=>ahe(e,r,t,i,s,n,a)),she(e,t,!1),n&&e.patches_&&Yue("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function ahe(e,t,n,r,i,a,s){if(Fue(i)){const s=ihe(e,i,a&&t&&3!==t.type_&&!Oue(t.assigned_,r)?a.concat(r):void 0);if(jue(n,r,s),!Fue(s))return;e.canAutoFreeze_=!1}else s&&n.add(i);if(Rue(i)&&!que(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;ihe(e,i),t&&t.scope_.parent_||"symbol"===typeof r||!(zue(n)?n.has(r):Object.prototype.propertyIsEnumerable.call(n,r))||she(e,i)}}function she(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Gue(t,n)}var ohe={get(e,t){if(t===Tue)return e;const n=Que(e);if(!Oue(n,t))return function(e,t,n){var r;const i=uhe(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!Rue(r)?r:r===che(e.base_,t)?(dhe(e),e.copy_[t]=Ahe(r,e)):r},has:(e,t)=>t in Que(e),ownKeys:e=>Reflect.ownKeys(Que(e)),set(e,t,n){const r=uhe(Que(e),t);if(null!==r&&void 0!==r&&r.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=che(Que(e),t),i=null===r||void 0===r?void 0:r[Tue];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}(n,r)&&(void 0!==n||Oue(e.base_,t)))return!0;dhe(e),hhe(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==che(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,dhe(e),hhe(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=Que(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){Bue(11)},getPrototypeOf:e=>Mue(e.base_),setPrototypeOf(){Bue(12)}},lhe={};function che(e,t){const n=e[Tue];return(n?Que(n):e)[t]}function uhe(e,t){if(!(t in e))return;let n=Mue(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=Mue(n)}}function hhe(e){e.modified_||(e.modified_=!0,e.parent_&&hhe(e.parent_))}function dhe(e){e.copy_||(e.copy_=Vue(e.base_,e.scope_.immer_.useStrictShallowCopy_))}Uue(ohe,(e,t)=>{lhe[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),lhe.deleteProperty=function(e,t){return lhe.set.call(this,e,t,void 0)},lhe.set=function(e,t,n){return ohe.set.call(this,e[0],t,n,e[0])};function Ahe(e,t){const n=zue(e)?Yue("MapSet").proxyMap_(e,t):Hue(e)?Yue("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:Jue(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,a=ohe;n&&(i=[r],a=lhe);const{revoke:s,proxy:o}=Proxy.revocable(i,a);return r.draft_=o,r.revoke_=s,o}(e,t);return(t?t.scope_:Jue()).drafts_.push(n),n}function phe(e){if(!Rue(e)||que(e))return e;const t=e[Tue];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=Vue(e,t.scope_.immer_.useStrictShallowCopy_)}else n=Vue(e,!0);return Uue(n,(e,t)=>{jue(n,e,phe(t))}),t&&(t.finalized_=!1),n}var fhe=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"===typeof e&&"function"!==typeof t){const n=t;t=e;const r=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return r.produce(e,e=>t.call(this,e,...a))}}let r;if("function"!==typeof t&&Bue(6),void 0!==n&&"function"!==typeof n&&Bue(7),Rue(e)){const i=the(this),a=Ahe(e,void 0);let s=!0;try{r=t(a),s=!1}finally{s?$ue(i):ehe(i)}return Zue(i,n),rhe(r,i)}if(!e||"object"!==typeof e){if(r=t(e),void 0===r&&(r=e),r===kue&&(r=void 0),this.autoFreeze_&&Gue(r,!0),n){const t=[],i=[];Yue("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}Bue(1)},this.produceWithPatches=(e,n)=>{if("function"===typeof e)return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return t.produceWithPatches(n,t=>e(t,...i))};let r,i;const a=this.produce(e,n,(e,t)=>{r=e,i=t});return[a,r,i]},"boolean"===typeof(null===e||void 0===e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"===typeof(null===e||void 0===e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Rue(e)||Bue(8),Fue(e)&&(e=function(e){Fue(e)||Bue(10);return phe(e)}(e));const t=the(this),n=Ahe(e,void 0);return n[Tue].isManual_=!0,ehe(t),n}finishDraft(e,t){const n=e&&e[Tue];n&&n.isManual_||Bue(9);const{scope_:r}=n;return Zue(r,t),rhe(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=Yue("Patches").applyPatches_;return Fue(e)?r(e,t):this.produce(e,e=>r(e,t))}},ghe=fhe.produce;const mhe=e=>(t,n,r)=>(r.setState=function(e,n){const r="function"===typeof e?ghe(e):e;for(var i=arguments.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];return t(r,n,...a)},e(r.setState,n,r)),yhe=fC(Nue(mhe((e,t)=>({territories:[],selectedTerritory:null,addTerritory:t=>e(e=>{e.territories.push(M(M({},t),{},{id:t.id||"territory_".concat(Date.now()),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}))}),updateTerritory:(t,n)=>e(e=>{const r=e.territories.findIndex(e=>e.id===t);-1!==r&&(e.territories[r]=M(M(M({},e.territories[r]),n),{},{updatedAt:(new Date).toISOString()}))}),deleteTerritory:t=>e(e=>{var n;e.territories=e.territories.filter(e=>e.id!==t),(null===(n=e.selectedTerritory)||void 0===n?void 0:n.id)===t&&(e.selectedTerritory=null)}),selectTerritory:t=>e({selectedTerritory:t}),properties:[],selectedProperty:null,propertyFilter:{status:"all",quality:"all",territory:"all"},addProperty:t=>e(e=>{e.properties.push(M(M({},t),{},{id:t.id||"property_".concat(Date.now()),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),visits:t.visits||[]}))}),updateProperty:(t,n)=>e(e=>{const r=e.properties.findIndex(e=>e.id===t);-1!==r&&(e.properties[r]=M(M(M({},e.properties[r]),n),{},{updatedAt:(new Date).toISOString()}))}),deleteProperty:t=>e(e=>{var n;e.properties=e.properties.filter(e=>e.id!==t),(null===(n=e.selectedProperty)||void 0===n?void 0:n.id)===t&&(e.selectedProperty=null)}),selectProperty:t=>e({selectedProperty:t}),setPropertyFilter:t=>e(e=>{e.propertyFilter=M(M({},e.propertyFilter),t)}),addVisit:(t,n)=>e(e=>{const r=e.properties.find(e=>e.id===t);r&&(r.visits=r.visits||[],r.visits.push(M(M({},n),{},{id:n.id||"visit_".concat(Date.now()),timestamp:(new Date).toISOString()})),r.updatedAt=(new Date).toISOString(),r.lastVisitDate=(new Date).toISOString())}),routes:[],activeRoute:null,addRoute:t=>e(e=>{e.routes.push(M(M({},t),{},{id:t.id||"route_".concat(Date.now()),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}))}),updateRoute:(t,n)=>e(e=>{const r=e.routes.findIndex(e=>e.id===t);-1!==r&&(e.routes[r]=M(M(M({},e.routes[r]),n),{},{updatedAt:(new Date).toISOString()}))}),deleteRoute:t=>e(e=>{var n;e.routes=e.routes.filter(e=>e.id!==t),(null===(n=e.activeRoute)||void 0===n?void 0:n.id)===t&&(e.activeRoute=null)}),setActiveRoute:t=>e({activeRoute:t}),repLocations:{},trackingEnabled:!1,currentLocation:null,updateRepLocation:(t,n)=>e(e=>{e.repLocations[t]=M(M({},n),{},{timestamp:(new Date).toISOString()})}),setCurrentLocation:t=>e({currentLocation:t}),setTrackingEnabled:t=>e({trackingEnabled:t}),analytics:{totalDoorsKnocked:0,contactsMade:0,appointmentsSet:0,salesMade:0,hoursWorked:0},updateAnalytics:t=>e(e=>{e.analytics=M(M({},e.analytics),t)}),incrementMetric:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e(e=>{void 0!==e.analytics[t]&&(e.analytics[t]+=n)})},mapView:{center:{lat:40.7608,lng:-111.891},zoom:13,mapType:"roadmap",showTraffic:!1,showHeatmap:!1,showTerritories:!0,showRoutes:!0},updateMapView:t=>e(e=>{e.mapView=M(M({},e.mapView),t)}),drawingMode:null,setDrawingMode:t=>e({drawingMode:t}),getFilteredProperties:()=>{const{properties:e,propertyFilter:n}=t();return e.filter(e=>{var t;return("all"===n.status||e.status===n.status)&&(("all"===n.quality||(null===(t=e.quality)||void 0===t?void 0:t.toLowerCase())===n.quality)&&("all"===n.territory||e.territoryId===n.territory))})},getTerritoriesForRep:e=>{const{territories:n}=t();return n.filter(t=>{var n;return null===(n=t.assignedReps)||void 0===n?void 0:n.includes(e)})},getPropertiesInTerritory:e=>{const{properties:n}=t();return n.filter(t=>t.territoryId===e)},resetStore:()=>e({territories:[],selectedTerritory:null,properties:[],selectedProperty:null,routes:[],activeRoute:null,repLocations:{},currentLocation:null,analytics:{totalDoorsKnocked:0,contactsMade:0,appointmentsSet:0,salesMade:0,hoursWorked:0}})})),{name:"canvassing-storage",storage:Cue(()=>localStorage),partialize:e=>({territories:e.territories,properties:e.properties,routes:e.routes,analytics:e.analytics,mapView:e.mapView})})),vhe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{enableHighAccuracy:t=!0,timeout:n=1e4,maximumAge:r=3e4,updateInterval:i=3e4,distanceFilter:a=10}=e,[s,o]=(0,k.useState)(null),[l,c]=(0,k.useState)(null),[u,h]=(0,k.useState)(!1),d=(0,k.useRef)(null),A=(0,k.useRef)(null),{setCurrentLocation:p,trackingEnabled:f}=yhe(),g=(0,k.useCallback)(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy,altitude:e.coords.altitude,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,speed:e.coords.speed,timestamp:e.timestamp};if(A.current){const e=((e,t)=>{const n=(t.latitude-e.latitude)*Math.PI/180,r=(t.longitude-e.longitude)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3})({latitude:A.current.lat,longitude:A.current.lng},{latitude:t.lat,longitude:t.lng});if(e<a)return}A.current=t,o(t),p(t),c(null)},[a,p]),m=(0,k.useCallback)(e=>{c({code:e.code,message:{1:"Permission denied. Please enable location access.",2:"Position unavailable. Check your GPS settings.",3:"Request timeout. Please try again."}[e.code]||"Unknown error occurred"}),h(!1)},[]),y=(0,k.useCallback)(()=>{navigator.geolocation?(h(!0),navigator.geolocation.getCurrentPosition(g,m,{enableHighAccuracy:t,timeout:n,maximumAge:r}),d.current=navigator.geolocation.watchPosition(g,m,{enableHighAccuracy:t,timeout:n,maximumAge:r})):c({code:0,message:"Geolocation is not supported by your browser"})},[t,n,r,g,m]),v=(0,k.useCallback)(()=>{null!==d.current&&(navigator.geolocation.clearWatch(d.current),d.current=null),h(!1)},[]),b=(0,k.useCallback)(()=>new Promise((e,i)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const n={lat:t.coords.latitude,lng:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:t.timestamp};o(n),e(n)},e=>{m(e),i(e)},{enableHighAccuracy:t,timeout:n,maximumAge:r}):i(new Error("Geolocation not supported"))}),[t,n,r,m]);return(0,k.useEffect)(()=>{f&&!u?y():!f&&u&&v()},[f,u,y,v]),(0,k.useEffect)(()=>()=>{null!==d.current&&navigator.geolocation.clearWatch(d.current)},[]),{location:s,error:l,isTracking:u,startTracking:y,stopTracking:v,getCurrentLocation:b,isSupported:!!navigator.geolocation}},bhe={NOT_CONTACTED:"not_contacted",INTERESTED:"interested",NOT_INTERESTED:"not_interested",CALLBACK:"callback",APPOINTMENT:"appointment",SOLD:"sold",DNC:"dnc",NOT_HOME:"not_home"},xhe=(e,t)=>{switch(e){case bhe.SOLD:return"#8B5CF6";case bhe.APPOINTMENT:return"#3B82F6";case bhe.INTERESTED:return"#10B981";case bhe.CALLBACK:return"#F59E0B";case bhe.NOT_HOME:return"#6B7280";case bhe.NOT_INTERESTED:return"#EF4444";case bhe.DNC:return"#1F2937";default:switch(null===t||void 0===t?void 0:t.toLowerCase()){case"hot":return"#DC2626";case"warm":return"#F59E0B";case"cold":return"#3B82F6";default:return"#9CA3AF"}}},whe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=xhe(e.status,e.quality),r=t?44:36,i='\n    <svg width="'.concat(r,'" height="').concat(r,'" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        <filter id="shadow">\n          <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity="0.3"/>\n        </filter>\n      </defs>\n      <path\n        d="M18 2c-7.7 0-14 6.3-14 14 0 10.5 14 18 14 18s14-7.5 14-18c0-7.7-6.3-14-14-14z"\n        fill="').concat(n,'"\n        stroke="#ffffff"\n        stroke-width="2"\n        filter="url(#shadow)"\n      />\n      <circle cx="18" cy="16" r="6" fill="#ffffff"/>\n      <circle cx="18" cy="16" r="3" fill="').concat(n,'"/>\n      ').concat("high"===e.priority?'<circle cx="26" cy="8" r="4" fill="#EF4444" stroke="#ffffff" stroke-width="1"/>':"","\n    </svg>\n  ");return{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(i),scaledSize:new window.google.maps.Size(r,r),anchor:new window.google.maps.Point(r/2,r)}},_he=z("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),She=z("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Che={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Ehe(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const Nhe={date:Ehe({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Ehe({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Ehe({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},khe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Ihe(e){return(t,n)=>{let r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,i=null!==n&&void 0!==n&&n.width?String(n.width):t;r=e.formattingValues[i]||e.formattingValues[t]}else{const t=e.defaultWidth,i=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[i]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}const The={ordinalNumber:(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Ihe({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Ihe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ihe({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Ihe({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Ihe({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function Bhe(e){return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;const s=a[0],o=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(o,e=>e.test(s)):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(o,e=>e.test(s));let c;c=e.valueCallback?e.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;return{value:c,rest:t.slice(s.length)}}}const Mhe={ordinalNumber:(Fhe={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.match(Fhe.matchPattern);if(!n)return null;const r=n[0],i=e.match(Fhe.parsePattern);if(!i)return null;let a=Fhe.valueCallback?Fhe.valueCallback(i[0]):i[0];return a=t.valueCallback?t.valueCallback(a):a,{value:a,rest:e.slice(r.length)}}),era:Bhe({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Bhe({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Bhe({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Bhe({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Bhe({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var Fhe;const Rhe={code:"en-US",formatDistance:(e,t,n)=>{let r;const i=Che[e];return r="string"===typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:Nhe,formatRelative:(e,t,n,r)=>khe[e],localize:The,match:Mhe,options:{weekStartsOn:0,firstWeekContainsDate:1}};let Lhe={};function Phe(){return Lhe}Math.pow(10,8);const Uhe=6048e5,Dhe=Symbol.for("constructDateFrom");function Ohe(e,t){return"function"===typeof e?e(t):e&&"object"===typeof e&&Dhe in e?e[Dhe](t):e instanceof Date?new e.constructor(t):new Date(t)}function jhe(e,t){return Ohe(t||e,e)}function zhe(e){const t=jhe(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Hhe(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in);return n.setHours(0,0,0,0),n}function Qhe(e,t,n){const[r,i]=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=Ohe.bind(null,e||n.find(e=>"object"===typeof e));return n.map(i)}(null===n||void 0===n?void 0:n.in,e,t),a=Hhe(r),s=Hhe(i),o=+a-zhe(a),l=+s-zhe(s);return Math.round((o-l)/864e5)}function Vhe(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Ghe(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in);return Qhe(n,Vhe(n))+1}function Whe(e,t){var n,r,i,a,s,o;const l=Phe(),c=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==i?i:l.weekStartsOn)&&void 0!==r?r:null===(o=l.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==n?n:0,u=jhe(e,null===t||void 0===t?void 0:t.in),h=u.getDay(),d=(h<c?7:0)+h-c;return u.setDate(u.getDate()-d),u.setHours(0,0,0,0),u}function qhe(e,t){return Whe(e,M(M({},t),{},{weekStartsOn:1}))}function Khe(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in),r=n.getFullYear(),i=Ohe(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const a=qhe(i),s=Ohe(n,0);s.setFullYear(r,0,4),s.setHours(0,0,0,0);const o=qhe(s);return n.getTime()>=a.getTime()?r+1:n.getTime()>=o.getTime()?r:r-1}function Xhe(e,t){const n=Khe(e,t),r=Ohe((null===t||void 0===t?void 0:t.in)||e,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),qhe(r)}function Yhe(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in),r=+qhe(n)-+Xhe(n);return Math.round(r/Uhe)+1}function Jhe(e,t){var n,r,i,a,s,o;const l=jhe(e,null===t||void 0===t?void 0:t.in),c=l.getFullYear(),u=Phe(),h=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(o=u.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==n?n:1,d=Ohe((null===t||void 0===t?void 0:t.in)||e,0);d.setFullYear(c+1,0,h),d.setHours(0,0,0,0);const A=Whe(d,t),p=Ohe((null===t||void 0===t?void 0:t.in)||e,0);p.setFullYear(c,0,h),p.setHours(0,0,0,0);const f=Whe(p,t);return+l>=+A?c+1:+l>=+f?c:c-1}function Zhe(e,t){var n,r,i,a,s,o;const l=Phe(),c=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==i?i:l.firstWeekContainsDate)&&void 0!==r?r:null===(o=l.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==n?n:1,u=Jhe(e,t),h=Ohe((null===t||void 0===t?void 0:t.in)||e,0);h.setFullYear(u,0,c),h.setHours(0,0,0,0);return Whe(h,t)}function $he(e,t){const n=jhe(e,null===t||void 0===t?void 0:t.in),r=+Whe(n,t)-+Zhe(n,t);return Math.round(r/Uhe)+1}function ede(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const tde={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return ede("yy"===t?r%100:r,t.length)},M(e,t){const n=e.getMonth();return"M"===t?String(n+1):ede(n+1,2)},d:(e,t)=>ede(e.getDate(),t.length),a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:(e,t)=>ede(e.getHours()%12||12,t.length),H:(e,t)=>ede(e.getHours(),t.length),m:(e,t)=>ede(e.getMinutes(),t.length),s:(e,t)=>ede(e.getSeconds(),t.length),S(e,t){const n=t.length,r=e.getMilliseconds();return ede(Math.trunc(r*Math.pow(10,n-3)),t.length)}},nde="midnight",rde="noon",ide="morning",ade="afternoon",sde="evening",ode="night",lde={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){const t=e.getFullYear(),r=t>0?t:1-t;return n.ordinalNumber(r,{unit:"year"})}return tde.y(e,t)},Y:function(e,t,n,r){const i=Jhe(e,r),a=i>0?i:1-i;if("YY"===t){return ede(a%100,2)}return"Yo"===t?n.ordinalNumber(a,{unit:"year"}):ede(a,t.length)},R:function(e,t){return ede(Khe(e),t.length)},u:function(e,t){return ede(e.getFullYear(),t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return ede(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return ede(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return tde.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return ede(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const i=$he(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):ede(i,t.length)},I:function(e,t,n){const r=Yhe(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):ede(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getDate(),{unit:"date"}):tde.d(e,t)},D:function(e,t,n){const r=Ghe(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):ede(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return ede(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return ede(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return ede(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let i;switch(i=12===r?rde:0===r?nde:r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let i;switch(i=r>=17?sde:r>=12?ade:r>=4?ide:ode,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),n.ordinalNumber(t,{unit:"hour"})}return tde.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getHours(),{unit:"hour"}):tde.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):ede(r,t.length)},k:function(e,t,n){let r=e.getHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):ede(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):tde.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getSeconds(),{unit:"second"}):tde.s(e,t)},S:function(e,t){return tde.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return ude(r);case"XXXX":case"XX":return hde(r);default:return hde(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return ude(r);case"xxxx":case"xx":return hde(r);default:return hde(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+cde(r,":");default:return"GMT"+hde(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+cde(r,":");default:return"GMT"+hde(r,":")}},t:function(e,t,n){return ede(Math.trunc(+e/1e3),t.length)},T:function(e,t,n){return ede(+e,t.length)}};function cde(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e>0?"-":"+",r=Math.abs(e),i=Math.trunc(r/60),a=r%60;return 0===a?n+String(i):n+String(i)+t+ede(a,2)}function ude(e,t){if(e%60===0){return(e>0?"-":"+")+ede(Math.abs(e)/60,2)}return hde(e,t)}function hde(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e>0?"-":"+",r=Math.abs(e);return n+ede(Math.trunc(r/60),2)+t+ede(r%60,2)}const dde=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Ade=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},pde={p:Ade,P:(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return dde(e,t);let a;switch(r){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",dde(r,t)).replace("{{time}}",Ade(i,t))}},fde=/^D+$/,gde=/^Y+$/,mde=["D","DD","YY","YYYY"];function yde(e){return e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function vde(e){return!(!yde(e)&&"number"!==typeof e||isNaN(+jhe(e)))}const bde=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xde=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,wde=/^'([^]*?)'?$/,_de=/''/g,Sde=/[a-zA-Z]/;function Cde(e,t,n){var r,i,a,s,o,l,c,u,h,d,A,p,f,g;const m=Phe(),y=null!==(r=null!==(i=null===n||void 0===n?void 0:n.locale)&&void 0!==i?i:m.locale)&&void 0!==r?r:Rhe,v=null!==(a=null!==(s=null!==(o=null!==(l=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==l?l:null===n||void 0===n||null===(c=n.locale)||void 0===c||null===(c=c.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==o?o:m.firstWeekContainsDate)&&void 0!==s?s:null===(u=m.locale)||void 0===u||null===(u=u.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==a?a:1,b=null!==(h=null!==(d=null!==(A=null!==(p=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==p?p:null===n||void 0===n||null===(f=n.locale)||void 0===f||null===(f=f.options)||void 0===f?void 0:f.weekStartsOn)&&void 0!==A?A:m.weekStartsOn)&&void 0!==d?d:null===(g=m.locale)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==h?h:0,x=jhe(e,null===n||void 0===n?void 0:n.in);if(!vde(x))throw new RangeError("Invalid time value");let w=t.match(xde).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,pde[t])(e,y.formatLong)}return e}).join("").match(bde).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Ede(e)};if(lde[t])return{isToken:!0,value:e};if(t.match(Sde))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});y.localize.preprocessor&&(w=y.localize.preprocessor(x,w));const _={firstWeekContainsDate:v,weekStartsOn:b,locale:y};return w.map(r=>{if(!r.isToken)return r.value;const i=r.value;(null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||!function(e){return gde.test(e)}(i))&&(null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!function(e){return fde.test(e)}(i))||function(e,t,n){const r=function(e,t,n){const r="Y"===e[0]?"years":"days of the month";return"Use `".concat(e.toLowerCase(),"` instead of `").concat(e,"` (in `").concat(t,"`) for formatting ").concat(r," to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md")}(e,t,n);if(console.warn(r),mde.includes(e))throw new RangeError(r)}(i,t,String(e));return(0,lde[i[0]])(x,i,y.localize,_)}).join("")}function Ede(e){const t=e.match(wde);return t?t[1].replace(_de,"'"):e}const Nde=e=>{var t;let{property:n,onClose:r,onEdit:i,onDelete:a,onAddVisit:s}=e;const{updateProperty:o,addVisit:l}=yhe(),[c,u]=(0,k.useState)("details"),[h,d]=(0,k.useState)(""),[A,p]=(0,k.useState)(n.status);if(!n)return null;const f=e=>({[bhe.SOLD]:"bg-purple-100 text-purple-800",[bhe.APPOINTMENT]:"bg-blue-100 text-blue-800",[bhe.INTERESTED]:"bg-green-100 text-green-800",[bhe.CALLBACK]:"bg-yellow-100 text-yellow-800",[bhe.NOT_HOME]:"bg-gray-100 text-gray-800",[bhe.NOT_INTERESTED]:"bg-red-100 text-red-800",[bhe.DNC]:"bg-gray-900 text-white",[bhe.NOT_CONTACTED]:"bg-gray-50 text-gray-600"}[e]||"bg-gray-100 text-gray-800");return(0,va.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-30 animate-fade-in",children:(0,va.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-t-2xl shadow-2xl max-h-[85vh] overflow-hidden animate-slide-up",children:[(0,va.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,va.jsx)(ja,{className:"w-6 h-6 text-white"}),(0,va.jsxs)("div",{className:"text-white flex-1",children:[(0,va.jsx)("h3",{className:"text-lg font-semibold truncate",children:n.address||"Unknown Address"}),(0,va.jsx)("p",{className:"text-blue-100 text-sm",children:n.customerName||n.ownerName||"Property Owner"})]})]}),(0,va.jsx)("button",{onClick:r,className:"p-2 hover:bg-blue-800 rounded-full transition-colors",children:(0,va.jsx)(Ta,{className:"w-5 h-5 text-white"})})]}),(0,va.jsxs)("div",{className:"px-6 py-3 bg-gray-50 border-b flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(f(A)),children:(null===A||void 0===A?void 0:A.replace("_"," ").toUpperCase())||"NOT CONTACTED"}),n.quality&&(0,va.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat("Hot"===n.quality?"bg-red-100 text-red-800":"Warm"===n.quality?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"),children:[(0,va.jsx)(_he,{className:"w-3 h-3 inline mr-1"}),n.quality]})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("button",{onClick:()=>null===i||void 0===i?void 0:i(n),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",title:"Edit Property",children:(0,va.jsx)(She,{className:"w-4 h-4 text-gray-600"})}),(0,va.jsx)("button",{onClick:()=>null===a||void 0===a?void 0:a(n),className:"p-2 hover:bg-red-100 rounded-lg transition-colors",title:"Delete Property",children:(0,va.jsx)(DC,{className:"w-4 h-4 text-red-600"})})]})]}),(0,va.jsx)("div",{className:"border-b",children:(0,va.jsxs)("div",{className:"flex px-6",children:[(0,va.jsxs)("button",{onClick:()=>u("details"),className:"px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("details"===c?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,va.jsx)(V,{className:"w-4 h-4 inline mr-2"}),"Details"]}),(0,va.jsxs)("button",{onClick:()=>u("visits"),className:"px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("visits"===c?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,va.jsx)(te,{className:"w-4 h-4 inline mr-2"}),"Visits (",(null===(t=n.visits)||void 0===t?void 0:t.length)||0,")"]}),(0,va.jsxs)("button",{onClick:()=>u("notes"),className:"px-4 py-3 text-sm font-medium border-b-2 transition-colors ".concat("notes"===c?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[(0,va.jsx)(ls,{className:"w-4 h-4 inline mr-2"}),"Notes"]})]})}),(0,va.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)]",children:["details"===c&&(0,va.jsxs)("div",{className:"space-y-6",children:[(0,va.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,va.jsxs)("button",{className:"flex items-center justify-center px-4 py-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors",children:[(0,va.jsx)(is,{className:"w-4 h-4 mr-2"}),"Call"]}),(0,va.jsxs)("button",{className:"flex items-center justify-center px-4 py-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors",children:[(0,va.jsx)(X,{className:"w-4 h-4 mr-2"}),"Message"]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quick Status Update"}),(0,va.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.values(bhe).map(e=>(0,va.jsx)("button",{onClick:()=>{return p(t=e),o(n.id,{status:t}),void l(n.id,{type:"status_change",status:t,notes:"Status changed to ".concat(t)});var t},className:"px-3 py-2 rounded-lg text-xs font-medium transition-colors ".concat(A===e?f(e):"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.replace("_"," ").toUpperCase()},e))})]}),(0,va.jsxs)("div",{className:"space-y-3",children:[(0,va.jsxs)("h4",{className:"font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(rs,{className:"w-4 h-4 mr-2"}),"Property Information"]}),n.phoneNumber&&(0,va.jsxs)("div",{className:"flex items-center text-sm",children:[(0,va.jsx)(is,{className:"w-4 h-4 mr-3 text-gray-400"}),(0,va.jsx)("span",{className:"text-gray-600",children:"Phone:"}),(0,va.jsx)("a",{href:"tel:".concat(n.phoneNumber),className:"ml-2 text-blue-600 hover:underline",children:n.phoneNumber})]}),n.email&&(0,va.jsxs)("div",{className:"flex items-center text-sm",children:[(0,va.jsx)(os,{className:"w-4 h-4 mr-3 text-gray-400"}),(0,va.jsx)("span",{className:"text-gray-600",children:"Email:"}),(0,va.jsx)("a",{href:"mailto:".concat(n.email),className:"ml-2 text-blue-600 hover:underline truncate",children:n.email})]}),n.propertyValue&&(0,va.jsxs)("div",{className:"flex items-center text-sm",children:[(0,va.jsx)(Q,{className:"w-4 h-4 mr-3 text-gray-400"}),(0,va.jsx)("span",{className:"text-gray-600",children:"Est. Value:"}),(0,va.jsxs)("span",{className:"ml-2 font-medium text-gray-900",children:["$",n.propertyValue.toLocaleString()]})]}),n.lastVisitDate&&(0,va.jsxs)("div",{className:"flex items-center text-sm",children:[(0,va.jsx)(K,{className:"w-4 h-4 mr-3 text-gray-400"}),(0,va.jsx)("span",{className:"text-gray-600",children:"Last Visit:"}),(0,va.jsx)("span",{className:"ml-2 text-gray-900",children:Cde(new Date(n.lastVisitDate),"MMM d, yyyy")})]})]}),void 0!==n.leadScore&&(0,va.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsxs)("span",{className:"text-sm font-medium text-blue-900 flex items-center",children:[(0,va.jsx)(_a,{className:"w-4 h-4 mr-2"}),"Lead Score"]}),(0,va.jsxs)("span",{className:"text-2xl font-bold text-blue-600",children:[n.leadScore,"/100"]})]}),(0,va.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,va.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(n.leadScore,"%")}})})]})]}),"visits"===c&&(0,va.jsx)("div",{className:"space-y-3",children:n.visits&&n.visits.length>0?n.visits.map((e,t)=>{var n;return(0,va.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,va.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,va.jsx)("span",{className:"text-xs font-medium text-gray-500",children:Cde(new Date(e.timestamp),"MMM d, yyyy h:mm a")}),(0,va.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded",children:(null===(n=e.type)||void 0===n?void 0:n.replace("_"," "))||"Visit"})]}),e.notes&&(0,va.jsx)("p",{className:"text-sm text-gray-700",children:e.notes}),e.status&&(0,va.jsx)("span",{className:"inline-block mt-2 px-2 py-1 rounded text-xs ".concat(f(e.status)),children:e.status.replace("_"," ").toUpperCase()})]},e.id||t)}):(0,va.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,va.jsx)(te,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,va.jsx)("p",{children:"No visits recorded yet"})]})}),"notes"===c&&(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("textarea",{value:h,onChange:e=>d(e.target.value),placeholder:"Add a note about this property...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"4"}),(0,va.jsx)("button",{onClick:()=>{h.trim()&&(l(n.id,{type:"note",notes:h}),d(""))},disabled:!h.trim(),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Note"})]}),n.notes&&(0,va.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,va.jsx)("h4",{className:"font-medium text-gray-900",children:"Previous Notes"}),"string"===typeof n.notes?(0,va.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,va.jsx)("p",{className:"text-sm text-gray-700",children:n.notes})}):null]})]})]})]})})},kde=e=>{let{leads:t}=e;const n=(0,k.useRef)(null),r=(0,k.useRef)(null),i=(0,k.useRef)([]),a=(0,k.useRef)(null),[s,o]=(0,k.useState)(!0),[l,c]=(0,k.useState)(null),[u,h]=(0,k.useState)(null),[d,A]=(0,k.useState)(!1),[p,f]=(0,k.useState)(!1),{mapView:g,updateMapView:m,properties:y,addProperty:v,propertyFilter:b,setPropertyFilter:x,getFilteredProperties:w,setTrackingEnabled:_}=yhe(),{location:S,isTracking:C,startTracking:E,stopTracking:N}=vhe({updateInterval:3e4});(0,k.useEffect)(()=>{(async()=>{try{const e=await Ga();if(!n.current)return;const t=new e.maps.Map(n.current,{center:g.center,zoom:g.zoom,mapTypeId:g.mapType,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"simplified"}]}]});a.current=new e.maps.TrafficLayer,g.showTraffic&&a.current.setMap(t),r.current=t,t.addListener("center_changed",()=>{const e=t.getCenter();m({center:{lat:e.lat(),lng:e.lng()}})}),t.addListener("zoom_changed",()=>{m({zoom:t.getZoom()})}),o(!1)}catch(kAe){c(kAe.message),o(!1)}})()},[]),(0,k.useEffect)(()=>{t&&0!==t.length&&t.forEach(e=>{if(e.latitude&&e.longitude){const t=y.find(t=>t.leadId===e.id);t||v({leadId:e.id,address:e.address,customerName:e.customerName,phoneNumber:e.phoneNumber,email:e.email,latitude:e.latitude,longitude:e.longitude,quality:e.quality,status:bhe.NOT_CONTACTED,visits:[]})}})},[t,y,v]),(0,k.useEffect)(()=>{if(!r.current||!window.google)return;i.current.forEach(e=>e.setMap(null)),i.current=[];w().forEach(e=>{if(!e.latitude||!e.longitude)return;const t=new window.google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:r.current,title:e.address,icon:whe(e),animation:window.google.maps.Animation.DROP});t.addListener("click",()=>{h(e),A(!0)}),i.current.push(t)})},[y,b,w]),(0,k.useEffect)(()=>{if(!r.current||!window.google||!S)return;const e=new window.google.maps.Marker({position:{lat:S.lat,lng:S.lng},map:r.current,title:"Your Location",icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#4285F4",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:3},zIndex:1e4}),t=new window.google.maps.Circle({map:r.current,center:{lat:S.lat,lng:S.lng},radius:S.accuracy,fillColor:"#4285F4",fillOpacity:.1,strokeColor:"#4285F4",strokeOpacity:.3,strokeWeight:1});return()=>{e.setMap(null),t.setMap(null)}},[S]);const I=(0,k.useMemo)(()=>{const e=w();return{total:e.length,notContacted:e.filter(e=>e.status===bhe.NOT_CONTACTED).length,interested:e.filter(e=>e.status===bhe.INTERESTED).length,appointments:e.filter(e=>e.status===bhe.APPOINTMENT).length,sold:e.filter(e=>e.status===bhe.SOLD).length}},[w]);return s?(0,va.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-50",children:(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)(H,{className:"animate-spin h-12 w-12 text-blue-600 mx-auto mb-3"}),(0,va.jsx)("p",{className:"text-gray-600 text-lg",children:"Loading Canvassing Map..."})]})}):l?(0,va.jsx)("div",{className:"h-full flex items-center justify-center bg-red-50",children:(0,va.jsxs)("div",{className:"text-center max-w-md",children:[(0,va.jsx)(ee,{className:"h-12 w-12 text-red-600 mx-auto mb-3"}),(0,va.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Map Error"}),(0,va.jsx)("p",{className:"text-red-600",children:l})]})}):(0,va.jsxs)("div",{className:"h-full flex flex-col bg-gray-50",children:[(0,va.jsxs)("div",{className:"bg-white border-b px-4 py-3 flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)(J,{className:"w-6 h-6 text-blue-600"}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Door-to-Door Canvassing"}),(0,va.jsxs)("p",{className:"text-sm text-gray-600",children:[I.total," properties"]})]})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("button",{onClick:()=>{C?(N(),_(!1)):(E(),_(!0))},className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(C?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:C?(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(LC,{className:"w-4 h-4 mr-2"})," Stop Tracking"]}):(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(Sue,{className:"w-4 h-4 mr-2"})," Start Tracking"]})}),(0,va.jsx)("button",{onClick:()=>f(!p),className:"p-2 rounded-lg transition-colors ".concat(p?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:(0,va.jsx)(Na,{className:"w-5 h-5"})})]})]}),p&&(0,va.jsxs)("div",{className:"bg-white border-b px-4 py-3",children:[(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,va.jsxs)("select",{value:b.status,onChange:e=>x({status:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,va.jsx)("option",{value:"all",children:"All Statuses"}),Object.values(bhe).map(e=>(0,va.jsx)("option",{value:e,children:e.replace("_"," ").toUpperCase()},e))]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lead Quality"}),(0,va.jsxs)("select",{value:b.quality,onChange:e=>x({quality:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,va.jsx)("option",{value:"all",children:"All Qualities"}),(0,va.jsx)("option",{value:"hot",children:"Hot"}),(0,va.jsx)("option",{value:"warm",children:"Warm"}),(0,va.jsx)("option",{value:"cold",children:"Cold"})]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Map Type"}),(0,va.jsxs)("select",{value:g.mapType,onChange:e=>{m({mapType:e.target.value}),r.current&&r.current.setMapTypeId(e.target.value)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,va.jsx)("option",{value:"roadmap",children:"Road Map"}),(0,va.jsx)("option",{value:"satellite",children:"Satellite"}),(0,va.jsx)("option",{value:"hybrid",children:"Hybrid"}),(0,va.jsx)("option",{value:"terrain",children:"Terrain"})]})]})]}),(0,va.jsxs)("div",{className:"mt-4 grid grid-cols-5 gap-3",children:[(0,va.jsxs)("div",{className:"bg-gray-50 px-3 py-2 rounded-lg text-center",children:[(0,va.jsx)("p",{className:"text-xs text-gray-600",children:"Not Contacted"}),(0,va.jsx)("p",{className:"text-lg font-bold text-gray-900",children:I.notContacted})]}),(0,va.jsxs)("div",{className:"bg-green-50 px-3 py-2 rounded-lg text-center",children:[(0,va.jsx)("p",{className:"text-xs text-green-600",children:"Interested"}),(0,va.jsx)("p",{className:"text-lg font-bold text-green-700",children:I.interested})]}),(0,va.jsxs)("div",{className:"bg-blue-50 px-3 py-2 rounded-lg text-center",children:[(0,va.jsx)("p",{className:"text-xs text-blue-600",children:"Appointments"}),(0,va.jsx)("p",{className:"text-lg font-bold text-blue-700",children:I.appointments})]}),(0,va.jsxs)("div",{className:"bg-purple-50 px-3 py-2 rounded-lg text-center",children:[(0,va.jsx)("p",{className:"text-xs text-purple-600",children:"Sold"}),(0,va.jsx)("p",{className:"text-lg font-bold text-purple-700",children:I.sold})]}),(0,va.jsxs)("div",{className:"bg-gray-50 px-3 py-2 rounded-lg text-center",children:[(0,va.jsx)("p",{className:"text-xs text-gray-600",children:"Total"}),(0,va.jsx)("p",{className:"text-lg font-bold text-gray-900",children:I.total})]})]})]}),(0,va.jsxs)("div",{className:"flex-1 relative",children:[(0,va.jsx)("div",{ref:n,className:"w-full h-full"}),S&&(0,va.jsx)("button",{onClick:()=>{r.current&&(r.current.panTo({lat:S.lat,lng:S.lng}),r.current.setZoom(16))},className:"absolute bottom-6 right-6 p-3 bg-white rounded-full shadow-lg hover:shadow-xl transition-shadow",title:"Center on my location",children:(0,va.jsx)(za,{className:"w-5 h-5 text-blue-600"})}),(0,va.jsxs)("div",{className:"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-xs",children:[(0,va.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Status Legend"}),(0,va.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-400 mr-2"}),(0,va.jsx)("span",{children:"Not Contacted"})]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-2"}),(0,va.jsx)("span",{children:"Interested"})]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500 mr-2"}),(0,va.jsx)("span",{children:"Appointment"})]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-500 mr-2"}),(0,va.jsx)("span",{children:"Sold"})]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-yellow-500 mr-2"}),(0,va.jsx)("span",{children:"Callback"})]}),(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-2"}),(0,va.jsx)("span",{children:"Not Interested"})]})]})]})]}),d&&u&&(0,va.jsx)(Nde,{property:u,onClose:()=>{A(!1),h(null)},onEdit:e=>{console.log("Edit property:",e)},onDelete:e=>{window.confirm("Delete this property from canvassing list?")&&console.log("Delete property:",e)}})]})},Ide=z("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var Tde=n(3121);const Bde=()=>{const{territories:e,selectedTerritory:t,addTerritory:n,updateTerritory:r,deleteTerritory:i,selectTerritory:a,getPropertiesInTerritory:s}=yhe(),o=(0,k.useCallback)(t=>{const{name:r,coordinates:i,assignedReps:a,color:s,description:o}=t;if(!r||!i||i.length<3)throw new Error("Territory must have a name and at least 3 coordinate points");const l=(0,Tde.calculateTerritoryArea)(i),c=(0,Tde.getTerritoryCenter)(i),u=e.filter(e=>(0,Tde.doTerritoriesOverlap)(i,e.coordinates)),h={name:r,coordinates:i,assignedReps:a||[],color:s||Mde(),description:o||"",area:l,center:c,overlaps:u.map(e=>e.id),stats:{totalProperties:0,contactedProperties:0,conversionRate:0}};return n(h),h},[e,n]),l=(0,k.useCallback)((t,n)=>{const i=e.find(e=>e.id===t);if(!i)throw new Error("Territory not found");n.coordinates&&(n.area=(0,Tde.calculateTerritoryArea)(n.coordinates),n.center=(0,Tde.getTerritoryCenter)(n.coordinates)),r(t,n)},[e,r]),c=(0,k.useCallback)(t=>{const n=e.find(e=>e.id===t);if(!n)throw new Error("Territory not found");const r=s(t);if(r.length>0){if(!window.confirm("This territory contains ".concat(r.length," properties. Are you sure you want to delete it?")))return!1}return i(t),!0},[e,i,s]),u=(0,k.useCallback)((e,t)=>{r(e,{assignedReps:t})},[r]),h=(0,k.useCallback)(t=>e.filter(e=>{var n;return null===(n=e.assignedReps)||void 0===n?void 0:n.includes(t)}),[e]),d=(0,k.useCallback)(e=>{const t=s(e),n={totalProperties:t.length,contactedProperties:t.filter(e=>"not_contacted"!==e.status).length,interestedProperties:t.filter(e=>"interested"===e.status).length,appointments:t.filter(e=>"appointment"===e.status).length,sold:t.filter(e=>"sold"===e.status).length,dnc:t.filter(e=>"dnc"===e.status).length,conversionRate:0};return n.contactedProperties>0&&(n.conversionRate=(n.sold/n.contactedProperties*100).toFixed(1)),n},[s]),A=(0,k.useCallback)(t=>{const n=e.find(e=>e.id===t);return n?e.filter(e=>e.id!==t&&(0,Tde.doTerritoriesOverlap)(n.coordinates,e.coordinates)):[]},[e]),p=(0,k.useCallback)(()=>e.map(e=>M(M({},e),{},{stats:d(e.id)})),[e,d]);return{territories:e,selectedTerritory:t,createTerritory:o,modifyTerritory:l,removeTerritory:c,selectTerritory:a,assignReps:u,getRepTerritories:h,getTerritoryStats:d,findOverlappingTerritories:A,getTerritoriesWithStats:p}},Mde=()=>{const e=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"];return e[Math.floor(Math.random()*e.length)]},Fde=e=>{let{map:t,onClose:n}=e;const[r,i]=(0,k.useState)(null),[a,s]=(0,k.useState)(""),[o,l]=(0,k.useState)("#3B82F6"),[c,u]=(0,k.useState)([]),[h,d]=(0,k.useState)([]),[A,p]=(0,k.useState)({area:0,center:null}),f=(0,k.useRef)(null),g=(0,k.useRef)(null),{createTerritory:m}=Bde(),{setDrawingMode:y}=yhe();(0,k.useEffect)(()=>{if(!t||!window.google)return;const e=new window.google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{fillColor:o,fillOpacity:.3,strokeWeight:2,strokeColor:o,editable:!0,draggable:!0},rectangleOptions:{fillColor:o,fillOpacity:.3,strokeWeight:2,strokeColor:o,editable:!0,draggable:!0},circleOptions:{fillColor:o,fillOpacity:.3,strokeWeight:2,strokeColor:o,editable:!0,draggable:!0}});return e.setMap(t),f.current=e,window.google.maps.event.addListener(e,"overlaycomplete",t=>{const n=t.overlay;g.current=n;let r=[];if("polygon"===t.type){r=n.getPath().getArray().map(e=>[e.lng(),e.lat()]),r.push(r[0])}else if("rectangle"===t.type){const e=n.getBounds(),t=e.getNorthEast(),i=e.getSouthWest();r=[[i.lng(),t.lat()],[t.lng(),t.lat()],[t.lng(),i.lat()],[i.lng(),i.lat()],[i.lng(),t.lat()]]}else if("circle"===t.type){const e=n.getCenter(),t=n.getRadius(),i=32;for(let n=0;n<i;n++){const a=n/i*2*Math.PI,s=e.lat()+t/111e3*Math.cos(a),o=e.lng()+t/(111e3*Math.cos(e.lat()*Math.PI/180))*Math.sin(a);r.push([o,s])}r.push(r[0])}if(d(r),r.length>0){const e=(0,Tde.calculateTerritoryArea)(r),t=(0,Tde.getTerritoryCenter)(r);p({area:e,center:t})}i(null),e.setDrawingMode(null),"polygon"===t.type&&(window.google.maps.event.addListener(n.getPath(),"set_at",v),window.google.maps.event.addListener(n.getPath(),"insert_at",v))}),()=>{e&&(window.google.maps.event.clearInstanceListeners(e),e.setMap(null))}},[t,o]);const v=()=>{if(!g.current)return;const e=g.current.getPath().getArray().map(e=>[e.lng(),e.lat()]);e.push(e[0]),d(e);const t=(0,Tde.calculateTerritoryArea)(e),n=(0,Tde.getTerritoryCenter)(e);p({area:t,center:n})},b=e=>{if(!f.current)return;i(e),y(e),g.current&&(g.current.setMap(null),g.current=null),d([]),p({area:0,center:null});const t={polygon:window.google.maps.drawing.OverlayType.POLYGON,rectangle:window.google.maps.drawing.OverlayType.RECTANGLE,circle:window.google.maps.drawing.OverlayType.CIRCLE};f.current.setDrawingMode(t[e]||null)},x=()=>{g.current&&(g.current.setMap(null),g.current=null),d([]),p({area:0,center:null}),i(null),f.current&&f.current.setDrawingMode(null)};return(0,va.jsxs)("div",{className:"absolute top-4 left-4 bg-white rounded-lg shadow-lg p-6 max-w-md z-50",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsxs)("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(ja,{className:"w-5 h-5 mr-2 text-blue-600"}),"Create Territory"]}),(0,va.jsx)("button",{onClick:()=>{x(),n()},className:"p-1 hover:bg-gray-100 rounded-full",children:(0,va.jsx)(Ta,{className:"w-5 h-5 text-gray-600"})})]}),(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Territory Name"}),(0,va.jsx)("input",{type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"e.g., Downtown District",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Territory Color"}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("input",{type:"color",value:o,onChange:e=>l(e.target.value),className:"w-12 h-10 rounded border border-gray-300 cursor-pointer"}),(0,va.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Drawing Tools"}),(0,va.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,va.jsxs)("button",{onClick:()=>b("polygon"),className:"p-3 rounded-lg border-2 transition-all ".concat("polygon"===r?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300"),children:[(0,va.jsx)(Ide,{className:"w-5 h-5 mx-auto"}),(0,va.jsx)("span",{className:"text-xs mt-1 block",children:"Polygon"})]}),(0,va.jsxs)("button",{onClick:()=>b("rectangle"),className:"p-3 rounded-lg border-2 transition-all ".concat("rectangle"===r?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300"),children:[(0,va.jsx)(LC,{className:"w-5 h-5 mx-auto"}),(0,va.jsx)("span",{className:"text-xs mt-1 block",children:"Rectangle"})]}),(0,va.jsxs)("button",{onClick:()=>b("circle"),className:"p-3 rounded-lg border-2 transition-all ".concat("circle"===r?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-blue-300"),children:[(0,va.jsx)(FC,{className:"w-5 h-5 mx-auto"}),(0,va.jsx)("span",{className:"text-xs mt-1 block",children:"Circle"})]})]})]}),h.length>0&&(0,va.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Territory Stats"}),(0,va.jsxs)("div",{className:"space-y-1 text-sm text-blue-800",children:[(0,va.jsxs)("div",{children:["Area: ",(0,va.jsxs)("strong",{children:[A.area," sq mi"]})]}),(0,va.jsxs)("div",{children:["Points: ",(0,va.jsx)("strong",{children:h.length-1})]}),A.center&&(0,va.jsxs)("div",{children:["Center: ",(0,va.jsxs)("strong",{children:[A.center.lat.toFixed(6),", ",A.center.lng.toFixed(6)]})]})]})]}),r&&(0,va.jsx)("div",{className:"bg-yellow-50 p-3 rounded-lg",children:(0,va.jsxs)("p",{className:"text-sm text-yellow-800",children:["polygon"===r&&"Click on the map to create polygon points. Double-click to finish.","rectangle"===r&&"Click and drag on the map to create a rectangle.","circle"===r&&"Click and drag on the map to create a circle."]})}),(0,va.jsxs)("div",{className:"flex space-x-2",children:[(0,va.jsxs)("button",{onClick:x,disabled:0===h.length,className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,va.jsx)(DC,{className:"w-4 h-4 mr-2"}),"Clear"]}),(0,va.jsxs)("button",{onClick:()=>{if(0!==h.length)if(a.trim())try{m({name:a,coordinates:h,assignedReps:c,color:o,description:"Territory with ".concat(A.area," sq mi area")}),alert("Territory created successfully!"),x(),n()}catch(SS){alert("Error creating territory: "+SS.message)}else alert("Please enter a territory name");else alert("Please draw a territory first")},disabled:0===h.length||!a.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,va.jsx)(Ra,{className:"w-4 h-4 mr-2"}),"Save Territory"]})]})]})]})},Rde=e=>{let{onDrawNew:t}=e;const{territories:n,removeTerritory:r,selectTerritory:i,getTerritoryStats:a,selectedTerritory:s}=Bde(),[o,l]=(0,k.useState)(null),[c,u]=(0,k.useState)(new Set(n.map(e=>e.id)));return(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(q,{className:"w-5 h-5 mr-2 text-blue-600"}),"Territory Manager"]}),(0,va.jsxs)("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center text-sm",children:[(0,va.jsx)(Ca,{className:"w-4 h-4 mr-2"}),"New Territory"]})]}),0===n.length?(0,va.jsxs)("div",{className:"text-center py-8",children:[(0,va.jsx)(q,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),(0,va.jsx)("p",{className:"text-gray-600 mb-2",children:"No territories created yet"}),(0,va.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Start by drawing your first territory on the map"}),(0,va.jsx)("button",{onClick:t,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create First Territory"})]}):(0,va.jsx)("div",{className:"space-y-3",children:n.map(e=>{const t=a(e.id),n=o===e.id,h=c.has(e.id);return(0,va.jsx)("div",{className:"border rounded-lg overflow-hidden transition-all ".concat((null===s||void 0===s?void 0:s.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:(0,va.jsxs)("div",{className:"p-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("div",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color}}),(0,va.jsx)("h4",{className:"font-semibold text-gray-900",children:e.name})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsx)("button",{onClick:()=>{return t=e.id,void u(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},className:"p-1 hover:bg-gray-200 rounded",title:h?"Hide on map":"Show on map",children:h?(0,va.jsx)(Y,{className:"w-4 h-4 text-gray-600"}):(0,va.jsx)(SC,{className:"w-4 h-4 text-gray-400"})}),(0,va.jsx)("button",{onClick:()=>i(e),className:"p-1 hover:bg-gray-200 rounded",children:(0,va.jsx)(She,{className:"w-4 h-4 text-blue-600"})}),(0,va.jsx)("button",{onClick:()=>{window.confirm('Delete territory "'.concat(e.name,'"?'))&&r(e.id)},className:"p-1 hover:bg-red-100 rounded",children:(0,va.jsx)(DC,{className:"w-4 h-4 text-red-600"})})]})]}),(0,va.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:t.totalProperties}),(0,va.jsx)("div",{className:"text-xs text-gray-600",children:"Properties"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.sold}),(0,va.jsx)("div",{className:"text-xs text-gray-600",children:"Sold"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[t.conversionRate,"%"]}),(0,va.jsx)("div",{className:"text-xs text-gray-600",children:"Conv. Rate"})]})]}),e.area&&(0,va.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["Area: ",(0,va.jsxs)("strong",{children:[e.area," sq mi"]})]}),e.assignedReps&&e.assignedReps.length>0&&(0,va.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,va.jsx)(wa,{className:"w-4 h-4 mr-1"}),e.assignedReps.length," rep(s) assigned"]}),(0,va.jsxs)("button",{onClick:()=>l(n?null:e.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-700 flex items-center",children:[(0,va.jsx)(ds,{className:"w-4 h-4 mr-1"}),n?"Hide":"Show"," Details"]}),n&&(0,va.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-2 gap-3 text-sm",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("div",{className:"text-gray-600",children:"Contacted"}),(0,va.jsx)("div",{className:"font-semibold",children:t.contactedProperties})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("div",{className:"text-gray-600",children:"Interested"}),(0,va.jsx)("div",{className:"font-semibold text-green-600",children:t.interestedProperties})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("div",{className:"text-gray-600",children:"Appointments"}),(0,va.jsx)("div",{className:"font-semibold text-blue-600",children:t.appointments})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("div",{className:"text-gray-600",children:"DNC"}),(0,va.jsx)("div",{className:"font-semibold text-red-600",children:t.dnc})]})]})]})},e.id)})})]})},Lde=e=>{var t;let{map:n}=e;const{properties:r,activeRoute:i,setActiveRoute:a,addRoute:s,currentLocation:o}=yhe(),{location:l}=vhe(),[c,u]=(0,k.useState)([]),[h,d]=(0,k.useState)(null),[A,p]=(0,k.useState)(""),[f,g]=(0,k.useState)(!1),m=r.filter(e=>e.status===bhe.NOT_CONTACTED||e.status===bhe.CALLBACK);(0,k.useEffect)(()=>{c.length>0&&l&&y()},[c,l]);const y=()=>{0!==c.length&&(g(!0),setTimeout(()=>{const e=l||o||{lat:40.7608,lng:-111.891},t=c.map(e=>M(M({},e),{},{lat:e.latitude,lng:e.longitude})),n=(0,Tde.optimizeRoute)(e,t),r=(0,Tde.calculateRouteDistance)([e,...n]);d({properties:n,distance:r,estimatedTime:(8*parseFloat(r)).toFixed(0)}),g(!1)},500))},v=e=>{const t=m.slice().sort((e,t)=>{const n=l||o||{lat:40.7608,lng:-111.891};return Math.sqrt(Math.pow(e.latitude-n.lat,2)+Math.pow(e.longitude-n.lng,2))-Math.sqrt(Math.pow(t.latitude-n.lat,2)+Math.pow(t.longitude-n.lng,2))}).slice(0,e);u(t)};return(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(wue,{className:"w-5 h-5 mr-2 text-blue-600"}),"Route Optimizer"]}),(0,va.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,va.jsxs)("button",{onClick:()=>v(10),className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:[(0,va.jsx)(mue,{className:"w-4 h-4 inline mr-1"}),"Quick 10"]}),(0,va.jsxs)("button",{onClick:()=>v(20),className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:[(0,va.jsx)(mue,{className:"w-4 h-4 inline mr-1"}),"Quick 20"]})]})]}),(0,va.jsxs)("div",{className:"mb-4",children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route Name"}),(0,va.jsx)("input",{type:"text",value:A,onChange:e=>p(e.target.value),placeholder:"e.g., Morning Route - Downtown",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),h&&(0,va.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Optimized Route"}),(0,va.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:h.properties.length}),(0,va.jsx)("div",{className:"text-xs text-blue-800",children:"Properties"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:h.distance}),(0,va.jsx)("div",{className:"text-xs text-blue-800",children:"Miles"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:h.estimatedTime}),(0,va.jsx)("div",{className:"text-xs text-blue-800",children:"Minutes"})]})]})]}),(0,va.jsxs)("div",{className:"mb-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Select Properties (",c.length," selected)"]}),c.length>0&&(0,va.jsx)("button",{onClick:()=>u([]),className:"text-sm text-red-600 hover:text-red-700",children:"Clear All"})]}),(0,va.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg divide-y",children:0===m.length?(0,va.jsx)("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No available properties for routing"}):m.slice(0,50).map(e=>{var t;const n=c.find(t=>t.id===e.id);return(0,va.jsx)("div",{onClick:()=>(e=>{u(t=>{const n=t.find(t=>t.id===e.id);return n?t.filter(t=>t.id!==e.id):[...t,e]})})(e),className:"p-3 cursor-pointer transition-colors ".concat(n?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-gray-50"),children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("div",{className:"font-medium text-sm text-gray-900",children:(null===(t=e.address)||void 0===t?void 0:t.split(",")[0])||"Unknown Address"}),(0,va.jsx)("div",{className:"text-xs text-gray-500",children:e.customerName||"No name"})]}),n&&(0,va.jsx)("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:c.findIndex(t=>t.id===e.id)+1})]})},e.id)})})]}),(0,va.jsxs)("div",{className:"flex space-x-2",children:[(0,va.jsxs)("button",{onClick:y,disabled:0===c.length||f,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,va.jsx)(za,{className:"w-4 h-4 mr-2"}),f?"Optimizing...":"Optimize Route"]}),(0,va.jsxs)("button",{onClick:()=>{h&&A.trim()?(s({name:A,properties:h.properties.map(e=>e.id),distance:h.distance,estimatedTime:h.estimatedTime,status:"pending"}),a({name:A,properties:h.properties,distance:h.distance}),alert("Route saved and activated!")):alert("Please name your route and select properties")},disabled:!h||!A.trim(),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,va.jsx)(Ra,{className:"w-4 h-4 mr-2"}),"Save & Start"]})]}),i&&(0,va.jsx)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{children:[(0,va.jsxs)("div",{className:"font-semibold text-green-900",children:["Active Route: ",i.name]}),(0,va.jsxs)("div",{className:"text-sm text-green-700",children:[(null===(t=i.properties)||void 0===t?void 0:t.length)||0," stops \u2022 ",i.distance," mi"]})]}),(0,va.jsx)(Sue,{className:"w-6 h-6 text-green-600"})]})})]})},Pde=z("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),Ude=()=>{const{properties:e,analytics:t}=yhe(),n=(0,k.useMemo)(()=>{const n={doorsKnocked:t.totalDoorsKnocked||e.length,contactsMade:e.filter(e=>e.status!==bhe.NOT_CONTACTED).length,appointmentsSet:e.filter(e=>e.status===bhe.APPOINTMENT).length,sold:e.filter(e=>e.status===bhe.SOLD).length};return{stats:n,contactRate:n.doorsKnocked>0?(n.contactsMade/n.doorsKnocked*100).toFixed(1):0,conversionRate:n.contactsMade>0?(n.sold/n.contactsMade*100).toFixed(1):0,score:100*n.sold+25*n.appointmentsSet+5*n.contactsMade,rank:1,badges:[]}},[e,t]),r=(0,k.useMemo)(()=>{const e=[];return n.stats.sold>=5&&e.push({name:"5 Sales",icon:_ue,color:"yellow"}),n.stats.sold>=10&&e.push({name:"10 Sales",icon:_ue,color:"gold"}),n.contactRate>=50&&e.push({name:"Contact Master",icon:J,color:"blue"}),n.conversionRate>=10&&e.push({name:"Closer",icon:Pde,color:"purple"}),n.stats.appointmentsSet>=20&&e.push({name:"Appointment Pro",icon:_he,color:"green"}),e},[n]);return(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[(0,va.jsx)(_ue,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Performance Leaderboard"]}),(0,va.jsxs)("div",{className:"text-sm text-gray-600",children:["Rank: ",(0,va.jsxs)("span",{className:"font-bold text-2xl text-blue-600",children:["#",n.rank]})]})]}),(0,va.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg mb-6",children:(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-sm opacity-90 mb-2",children:"Total Score"}),(0,va.jsx)("div",{className:"text-5xl font-bold mb-4",children:n.score}),(0,va.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)(mue,{className:"w-4 h-4 inline mr-1"}),n.stats.sold," Sales"]}),(0,va.jsxs)("div",{children:[(0,va.jsx)(J,{className:"w-4 h-4 inline mr-1"}),n.contactRate,"% Contact Rate"]})]})]})}),(0,va.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,va.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:n.stats.doorsKnocked}),(0,va.jsx)("div",{className:"text-sm text-blue-800",children:"Doors Knocked"})]}),(0,va.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-green-600",children:n.stats.contactsMade}),(0,va.jsx)("div",{className:"text-sm text-green-800",children:"Contacts Made"})]}),(0,va.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:n.stats.appointmentsSet}),(0,va.jsx)("div",{className:"text-sm text-purple-800",children:"Appointments"})]}),(0,va.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:n.stats.sold}),(0,va.jsx)("div",{className:"text-sm text-yellow-800",children:"Sales Closed"})]})]}),r.length>0&&(0,va.jsxs)("div",{className:"mb-6",children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Achievements Unlocked"}),(0,va.jsx)("div",{className:"grid grid-cols-2 gap-3",children:r.map((e,t)=>{const n=e.icon;return(0,va.jsxs)("div",{className:"p-3 rounded-lg border-2 ".concat({yellow:"bg-yellow-100 text-yellow-700 border-yellow-300",gold:"bg-yellow-200 text-yellow-900 border-yellow-400",blue:"bg-blue-100 text-blue-700 border-blue-300",purple:"bg-purple-100 text-purple-700 border-purple-300",green:"bg-green-100 text-green-700 border-green-300"}[e.color]," flex items-center"),children:[(0,va.jsx)(n,{className:"w-5 h-5 mr-2"}),(0,va.jsx)("span",{className:"text-sm font-medium",children:e.name})]},t)})})]}),(0,va.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,va.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Progress to Next Level"}),(0,va.jsx)("span",{className:"text-sm text-gray-600",children:"75%"})]}),(0,va.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,va.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all",style:{width:"75%"}})}),(0,va.jsx)("div",{className:"text-xs text-gray-600 mt-2",children:"3 more sales needed to reach Level 5"})]}),(0,va.jsxs)("div",{className:"mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,va.jsxs)("div",{className:"flex items-center mb-2",children:[(0,va.jsx)(mue,{className:"w-5 h-5 text-orange-600 mr-2"}),(0,va.jsx)("h4",{className:"font-semibold text-orange-900",children:"Daily Challenge"})]}),(0,va.jsx)("div",{className:"text-sm text-orange-800",children:"Complete 50 door knocks today and earn 500 bonus points!"}),(0,va.jsx)("div",{className:"mt-3 bg-white rounded-full h-2",children:(0,va.jsx)("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:"".concat(n.stats.doorsKnocked/50*100,"%")}})}),(0,va.jsxs)("div",{className:"text-xs text-orange-700 mt-1",children:[n.stats.doorsKnocked,"/50 completed"]})]})]})},Dde=z("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),Ode=()=>{const{properties:e,analytics:t,territories:n}=yhe(),r=(0,k.useMemo)(()=>{const t=e.length,r=e.filter(e=>e.status!==bhe.NOT_CONTACTED).length,i=e.filter(e=>e.status===bhe.INTERESTED).length,a=e.filter(e=>e.status===bhe.APPOINTMENT).length,s=e.filter(e=>e.status===bhe.SOLD).length,o=e.filter(e=>e.status===bhe.DNC).length,l=e.filter(e=>e.status===bhe.NOT_HOME).length;return{total:t,contacted:r,interested:i,appointments:a,sold:s,dnc:o,notHome:l,notContacted:t-r,contactRate:t>0?(r/t*100).toFixed(1):0,interestRate:r>0?(i/r*100).toFixed(1):0,appointmentRate:r>0?(a/r*100).toFixed(1):0,conversionRate:r>0?(s/r*100).toFixed(1):0,territoriesCount:n.length}},[e,n]),i=e=>{let{icon:t,label:n,value:r,subValue:i,trend:a,color:s}=e;return(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,va.jsx)("div",{className:"p-3 rounded-lg ".concat(s),children:(0,va.jsx)(t,{className:"w-6 h-6 text-white"})}),a&&(0,va.jsxs)("div",{className:"flex items-center text-green-600 text-sm font-medium",children:[(0,va.jsx)(_a,{className:"w-4 h-4 mr-1"}),a]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("p",{className:"text-gray-600 text-sm mb-1",children:n}),(0,va.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:r}),i&&(0,va.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:i})]})]})};return(0,va.jsxs)("div",{className:"space-y-6",children:[(0,va.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg shadow-lg p-6 text-white",children:(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Canvassing Performance Dashboard"}),(0,va.jsx)("p",{className:"text-blue-100",children:"Track your door-to-door sales metrics in real-time"})]}),(0,va.jsx)(ds,{className:"w-16 h-16 opacity-50"})]})}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,va.jsx)(i,{icon:ja,label:"Total Properties",value:r.total,subValue:"".concat(r.contacted," contacted"),color:"bg-blue-600"}),(0,va.jsx)(i,{icon:J,label:"Contact Rate",value:"".concat(r.contactRate,"%"),subValue:"".concat(r.contacted," / ").concat(r.total," doors"),color:"bg-green-600",trend:"+12%"}),(0,va.jsx)(i,{icon:wa,label:"Interested Leads",value:r.interested,subValue:"".concat(r.interestRate,"% interest rate"),color:"bg-purple-600"}),(0,va.jsx)(i,{icon:Q,label:"Conversions",value:r.sold,subValue:"".concat(r.conversionRate,"% conversion rate"),color:"bg-amber-600"})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,va.jsx)(Dde,{className:"w-5 h-5 mr-2 text-blue-600"}),"Performance Breakdown"]}),(0,va.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:r.appointments}),(0,va.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Appointments"}),(0,va.jsxs)("div",{className:"text-xs text-blue-600 font-medium",children:[r.appointmentRate,"% rate"]})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:r.notHome}),(0,va.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Not Home"}),(0,va.jsx)("div",{className:"text-xs text-gray-500",children:"Follow-up needed"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:r.dnc}),(0,va.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Do Not Contact"}),(0,va.jsx)("div",{className:"text-xs text-gray-500",children:"Excluded"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:r.notContacted}),(0,va.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Not Contacted"}),(0,va.jsx)("div",{className:"text-xs text-green-600 font-medium",children:"Opportunities"})]})]})]}),(0,va.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,va.jsx)(mue,{className:"w-5 h-5 mr-2 text-blue-600"}),"Territory Coverage"]}),(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Active Territories"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:r.territoriesCount})]}),(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Avg. Properties/Territory"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:r.territoriesCount>0?Math.round(r.total/r.territoriesCount):0})]}),(0,va.jsx)("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:(0,va.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,va.jsx)(Pde,{className:"w-4 h-4 inline mr-1"}),"You're covering ",(0,va.jsx)("strong",{children:r.territoriesCount})," territories with a"," ",(0,va.jsxs)("strong",{children:[r.contactRate,"%"]})," contact rate!"]})})]})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,va.jsx)(te,{className:"w-5 h-5 mr-2 text-blue-600"}),"Today's Activity"]}),(0,va.jsxs)("div",{className:"space-y-4",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Doors Knocked"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:t.totalDoorsKnocked||0})]}),(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Contacts Made"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:t.contactsMade||0})]}),(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsx)("span",{className:"text-gray-600",children:"Appointments Set"}),(0,va.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:t.appointmentsSet||0})]}),(0,va.jsx)("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:(0,va.jsxs)("p",{className:"text-sm text-green-800",children:[(0,va.jsx)(_a,{className:"w-4 h-4 inline mr-1"}),"Great work! You're on track to exceed your daily goals."]})})]})]})]}),(0,va.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,va.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Conversion Funnel"}),(0,va.jsx)("div",{className:"space-y-3",children:[{label:"Total Properties",count:r.total,percent:100,color:"bg-gray-400"},{label:"Contacted",count:r.contacted,percent:r.contacted/r.total*100||0,color:"bg-blue-500"},{label:"Interested",count:r.interested,percent:r.interested/r.total*100||0,color:"bg-green-500"},{label:"Appointments",count:r.appointments,percent:r.appointments/r.total*100||0,color:"bg-purple-500"},{label:"Sold",count:r.sold,percent:r.sold/r.total*100||0,color:"bg-amber-500"}].map((e,t)=>(0,va.jsxs)("div",{children:[(0,va.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,va.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.label}),(0,va.jsxs)("span",{className:"text-sm text-gray-600",children:[e.count," (",e.percent.toFixed(1),"%)"]})]}),(0,va.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,va.jsx)("div",{className:"".concat(e.color," h-3 rounded-full transition-all duration-500"),style:{width:"".concat(e.percent,"%")}})})]},t))})]}),(0,va.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-6",children:[(0,va.jsxs)("h3",{className:"text-lg font-semibold text-blue-900 mb-3 flex items-center",children:[(0,va.jsx)(mue,{className:"w-5 h-5 mr-2"}),"Performance Insights"]}),(0,va.jsxs)("div",{className:"space-y-2 text-sm text-blue-800",children:[r.contactRate<30&&(0,va.jsx)("p",{children:"\u2022 Your contact rate is low. Try canvassing during evening hours (5-8 PM) for better results."}),r.interestRate>50&&(0,va.jsx)("p",{children:"\u2022 Excellent interest rate! Your pitch is resonating well with homeowners."}),r.notHome>.3*r.contacted&&(0,va.jsx)("p",{children:'\u2022 High "Not Home" rate. Consider re-visiting these properties at different times.'}),r.sold>0&&(0,va.jsxs)("p",{children:["\u2022 Congratulations on your sales! You've achieved a ",r.conversionRate,"% conversion rate."]})]})]})]})},jde=e=>{var t;let{leads:n}=e;const[r,i]=(0,k.useState)(null),[a,s]=(0,k.useState)(!1),[o,l]=(0,k.useState)(null),c=[{id:"analytics",label:"Analytics",icon:ds},{id:"territory",label:"Territories",icon:q},{id:"route",label:"Routes",icon:wue},{id:"leaderboard",label:"Leaderboard",icon:_ue}];return(0,va.jsxs)("div",{className:"flex h-full",children:[(0,va.jsxs)("div",{className:"flex-1 relative",children:[(0,va.jsx)(kde,{leads:n,onMapLoad:l}),a&&o&&(0,va.jsx)(Fde,{map:o,onClose:()=>s(!1)}),(0,va.jsx)("div",{className:"absolute top-4 left-4 flex flex-col space-y-2 z-10",children:c.map(e=>{const t=e.icon;return(0,va.jsx)("button",{onClick:()=>i(r===e.id?null:e.id),className:"p-3 rounded-lg shadow-lg transition-all ".concat(r===e.id?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),title:e.label,children:(0,va.jsx)(t,{className:"w-5 h-5"})},e.id)})})]}),r&&(0,va.jsxs)("div",{className:"w-96 bg-white border-l border-gray-200 overflow-y-auto shadow-xl",children:[(0,va.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between z-10",children:[(0,va.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:null===(t=c.find(e=>e.id===r))||void 0===t?void 0:t.label}),(0,va.jsx)("button",{onClick:()=>i(null),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,va.jsx)(Ta,{className:"w-5 h-5 text-gray-600"})})]}),(0,va.jsxs)("div",{className:"p-4",children:["analytics"===r&&(0,va.jsx)(Ode,{}),"territory"===r&&(0,va.jsx)(Rde,{onDrawNew:()=>s(!0)}),"route"===r&&o&&(0,va.jsx)(Lde,{map:o}),"leaderboard"===r&&(0,va.jsx)(Ude,{})]})]})]})},zde=["children"],Hde=e=>{let{title:t,children:n}=e;return(0,va.jsxs)("div",{className:"mb-6",children:[(0,va.jsx)("h4",{className:"text-md font-semibold text-gray-800 border-b pb-2 mb-4",children:t}),(0,va.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n})]})},Qde=e=>{let{label:t,children:n,fullWidth:r=!1}=e;return(0,va.jsxs)("div",{className:r?"lg:col-span-3 md:col-span-2":"",children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),n]})},Vde=e=>(0,va.jsx)("input",M(M({},e),{},{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})),Gde=e=>{let{children:t}=e,n=F(e,zde);return(0,va.jsx)("select",M(M({},n),{},{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500",children:t}))},Wde=e=>(0,va.jsx)("textarea",M(M({},e),{},{rows:4,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})),qde={customerName:"",address:"",phoneNumber:"",email:"",dabellaQuote:"",quality:"Cold",notes:"",disposition:"New",leadSource:"Door Knock",roofAge:"",roofType:"Asphalt Shingle"};const Kde=function(e){let{initialData:t,onSubmit:n,onCancel:r,isEdit:i=!1}=e;const[a,s]=(0,k.useState)(()=>t||qde),[o,l]=(0,k.useState)(!1),c=(0,k.useCallback)(e=>s(t=>M(M({},t),{},{[e.target.name]:e.target.value})),[]),u=(0,k.useCallback)(async e=>{e.preventDefault(),l(!0);const t=M({},a);if(t.address&&(!t.latitude||!t.longitude))try{const e=await re.geocodeAddress(t.address);e.success&&(t.latitude=e.latitude,t.longitude=e.longitude)}catch(SS){console.warn("Geocoding failed during submission:",SS)}await n(t),l(!1)},[a,n]),h=(0,k.useMemo)(()=>["New","Scheduled","Insurance","Quoted","Follow Up","Closed Sold","Closed Lost"],[]);return(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40",children:(0,va.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col",children:[(0,va.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,va.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:i?"Edit Lead":"Add New Lead"}),(0,va.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{size:24})})]}),(0,va.jsx)("div",{className:"p-6 overflow-y-auto",children:(0,va.jsxs)("form",{onSubmit:u,children:[(0,va.jsxs)(Hde,{title:"Customer Information",children:[(0,va.jsx)(Qde,{label:"Full Name *",children:(0,va.jsx)(Vde,{name:"customerName",value:a.customerName,onChange:c,required:!0})}),(0,va.jsx)(Qde,{label:"Phone Number *",children:(0,va.jsx)(Vde,{name:"phoneNumber",value:a.phoneNumber,onChange:c,required:!0})}),(0,va.jsx)(Qde,{label:"Email",children:(0,va.jsx)(Vde,{name:"email",type:"email",value:a.email,onChange:c})}),(0,va.jsx)(Qde,{label:"Address",fullWidth:!0,children:(0,va.jsx)(Vde,{name:"address",value:a.address,onChange:c,placeholder:"Full address for map location"})})]}),(0,va.jsxs)(Hde,{title:"Lead Details",children:[(0,va.jsx)(Qde,{label:"Lead Source",children:(0,va.jsxs)(Gde,{name:"leadSource",value:a.leadSource,onChange:c,children:[(0,va.jsx)("option",{children:"Door Knock"}),(0,va.jsx)("option",{children:"Rime"}),(0,va.jsx)("option",{children:"Adverta"}),(0,va.jsx)("option",{children:"Referral"}),(0,va.jsx)("option",{children:"DaBella"})]})}),(0,va.jsx)(Qde,{label:"Quality",children:(0,va.jsxs)(Gde,{name:"quality",value:a.quality,onChange:c,children:[(0,va.jsx)("option",{children:"Hot"}),(0,va.jsx)("option",{children:"Warm"}),(0,va.jsx)("option",{children:"Cold"})]})}),(0,va.jsx)(Qde,{label:"Disposition",children:(0,va.jsx)(Gde,{name:"disposition",value:a.disposition,onChange:c,children:h.map(e=>(0,va.jsx)("option",{value:e,children:e},e))})})]}),(0,va.jsxs)(Hde,{title:"Job & Quote Details",children:[(0,va.jsx)(Qde,{label:"Roof Age",children:(0,va.jsx)(Vde,{name:"roofAge",value:a.roofAge,onChange:c})}),(0,va.jsx)(Qde,{label:"Roof Type",children:(0,va.jsxs)(Gde,{name:"roofType",value:a.roofType,onChange:c,children:[(0,va.jsx)("option",{children:"Asphalt Shingle"}),(0,va.jsx)("option",{children:"Metal"}),(0,va.jsx)("option",{children:"Tile"}),(0,va.jsx)("option",{children:"TPO"}),(0,va.jsx)("option",{children:"Wood"})]})}),(0,va.jsx)(Qde,{label:"Quote Amount",children:(0,va.jsx)(Vde,{name:"dabellaQuote",value:a.dabellaQuote,onChange:c,placeholder:"$15,000"})})]}),(0,va.jsx)(Hde,{title:"Notes",children:(0,va.jsx)(Qde,{label:"Notes",fullWidth:!0,children:(0,va.jsx)(Wde,{name:"notes",value:a.notes,onChange:c})})}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t mt-6",children:[(0,va.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,va.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:o?(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(H,{className:"animate-spin h-4 w-4 mr-2"}),"Saving..."]}):i?"Update Lead":"Add Lead"})]})]})})]})})},Xde=z("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Yde=z("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),Jde=[{id:"no-answer",label:"No Answer",color:"#EF4444",bgColor:"bg-red-50 hover:bg-red-100 border-red-200",icon:"\ud83d\udcf5",autoNote:"No answer - will try again later",status:"No Answer",keepOpen:!0,suggestRetry:!0},{id:"voicemail",label:"No Answer Left Voicemail",color:"#F59E0B",bgColor:"bg-orange-50 hover:bg-orange-100 border-orange-200",icon:"\ud83d\udced",autoNote:"Left voicemail with callback request",status:"Left Voicemail",keepOpen:!0,createReminder:!0,reminderHours:24},{id:"confirmed",label:"Called and Confirmed Appointment",color:"#10B981",bgColor:"bg-green-50 hover:bg-green-100 border-green-200",icon:"\u2705",autoNote:"Appointment confirmed - customer ready",status:"Completed",updateLeadStatus:"scheduled",promptCalendar:!0},{id:"not-interested",label:"Not Interested",color:"#6B7280",bgColor:"bg-gray-50 hover:bg-gray-100 border-gray-200",icon:"\u274c",autoNote:"Customer declined - not interested at this time",status:"Completed",updateLeadStatus:"lost",requiresConfirmation:!0},{id:"follow-up",label:"Follow-up Needed",color:"#3B82F6",bgColor:"bg-blue-50 hover:bg-blue-100 border-blue-200",icon:"\ud83d\udd14",autoNote:"Needs follow-up - set reminder",status:"Completed",createReminder:!0,updateLeadStatus:"follow-up"}],Zde=[{value:1,label:"1 minute"},{value:2,label:"2 minutes"},{value:5,label:"5 minutes"},{value:10,label:"10 minutes"},{value:15,label:"15 minutes"},{value:30,label:"30 minutes"}],$de=[{value:"tomorrow",label:"Tomorrow morning (9 AM)",hours:24},{value:"3days",label:"In 3 days",hours:72},{value:"week",label:"Next week",hours:168},{value:"custom",label:"Custom date/time"}];const eAe=function(e){let{lead:t,onClose:n,onLogCommunication:r,onUpdateLead:i}=e;const[a,s]=(0,k.useState)("Call"),[o,l]=(0,k.useState)(null),[c,u]=(0,k.useState)(5),[h,d]=(0,k.useState)(""),[A,p]=(0,k.useState)(!1),[f,g]=(0,k.useState)("tomorrow"),[m,y]=(0,k.useState)(""),[v,b]=(0,k.useState)(!1),x=async e=>{if(l(e),e.requiresConfirmation){if(!window.confirm('Are you sure you want to mark this lead as "'.concat(e.updateLeadStatus,'"?')))return void l(null)}e.createReminder?p(!0):await w(e)},w=async e=>{b(!0);try{const s={leadId:t.id,customerName:t.customerName,phoneNumber:t.phoneNumber,communicationType:a,dateTime:(new Date).toISOString(),status:e.status,duration:c,notes:h||e.autoNote,createdBy:"user@example.com",createdAt:(new Date).toISOString()};await r(s),e.updateLeadStatus&&await i(M(M({},t),{},{disposition:e.updateLeadStatus}));let o="Communication logged successfully!";if(e.updateLeadStatus&&(o+=" Lead status updated to ".concat(e.updateLeadStatus,".")),e.promptCalendar&&(o+=" Check Google Calendar for appointment details."),alert(o),e.suggestRetry){const e=new Date(Date.now()+72e5);alert("Suggested retry time: ".concat(e.toLocaleTimeString()))}if(e.promptCalendar){window.confirm("Would you like to open Google Calendar to verify the appointment?")&&window.open("https://calendar.google.com","_blank")}e.keepOpen?(l(null),d("")):n()}catch(SS){console.error("Error logging communication:",SS),alert("Failed to log communication. Please try again.")}finally{b(!1)}},_=async()=>{alert("Reminder set for ".concat(f)),p(!1),await w(o)};return A?(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,va.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full shadow-2xl",children:[(0,va.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,va.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Set Reminder"}),(0,va.jsx)("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{size:24})})]}),(0,va.jsxs)("div",{className:"p-6 space-y-4",children:[(0,va.jsxs)("p",{className:"text-sm text-gray-600",children:["When should we remind you to follow up with ",t.customerName,"?"]}),(0,va.jsx)("div",{className:"space-y-2",children:$de.map(e=>(0,va.jsxs)("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,va.jsx)("input",{type:"radio",name:"reminder",value:e.value,checked:f===e.value,onChange:e=>g(e.target.value),className:"mr-3"}),(0,va.jsx)("span",{className:"text-sm",children:e.label})]},e.value))}),"custom"===f&&(0,va.jsx)("input",{type:"datetime-local",value:m,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,va.jsx)("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,va.jsx)("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Set Reminder & Log"})]})]})}):(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,va.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full shadow-2xl",children:[(0,va.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,va.jsxs)("div",{children:[(0,va.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Log ",a," - ",t.customerName]}),(0,va.jsx)("p",{className:"text-sm text-gray-500",children:t.phoneNumber})]}),(0,va.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{size:24})})]}),(0,va.jsxs)("div",{className:"p-6 space-y-6",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Communication Type"}),(0,va.jsxs)("div",{className:"flex space-x-2",children:[(0,va.jsxs)("button",{onClick:()=>s("Call"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("Call"===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(is,{size:16,className:"mr-2"}),"Call"]}),(0,va.jsxs)("button",{onClick:()=>s("SMS"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("SMS"===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(ss,{size:16,className:"mr-2"}),"SMS"]}),(0,va.jsxs)("button",{onClick:()=>s("Email"),className:"flex-1 px-4 py-2 rounded-md flex items-center justify-center ".concat("Email"===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,va.jsx)(os,{size:16,className:"mr-2"}),"Email"]})]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Outcomes:"}),(0,va.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Jde.map(e=>(0,va.jsxs)("button",{onClick:()=>x(e),disabled:v,className:"p-4 border-2 rounded-lg text-center transition-all ".concat(e.bgColor," ").concat((null===o||void 0===o?void 0:o.id)===e.id?"ring-2 ring-offset-2 ring-blue-500":""," ").concat(v?"opacity-50 cursor-not-allowed":""),style:{borderColor:e.color+"40"},children:[(0,va.jsx)("div",{className:"text-2xl mb-1",children:e.icon}),(0,va.jsx)("div",{className:"text-xs font-medium text-gray-800 leading-tight",children:e.label})]},e.id))})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration"}),(0,va.jsx)("select",{value:c,onChange:e=>u(Number(e.target.value)),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500",children:Zde.map(e=>(0,va.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),(0,va.jsx)("textarea",{value:h,onChange:e=>d(e.target.value),placeholder:o?o.autoNote:"Enter any additional notes...",className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500",rows:3})]})]}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,va.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",disabled:v,children:"Cancel"}),(0,va.jsx)("button",{onClick:()=>{o?x(o):alert("Please select a quick outcome tag")},disabled:!o||v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Logging...":"Quick Log & Close"})]})]})})},tAe=k.memo(e=>{let{icon:t,label:n,value:r}=e;return(0,va.jsxs)("div",{children:[(0,va.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[t,n]}),(0,va.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:r||(0,va.jsx)("span",{className:"text-gray-400",children:"Not provided"})})]})});const nAe=function(e){let{lead:t,onEdit:n,onDelete:r,onClose:i,onNavigateToTab:a,onLogCommunication:s,onUpdateLead:o}=e;const[l,c]=(0,k.useState)(!1);return(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40 animate-fade-in",children:(0,va.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[(0,va.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,va.jsxs)("div",{children:[(0,va.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[(0,va.jsx)(rs,{className:"mr-3 text-blue-600"}),t.customerName]}),(0,va.jsx)("p",{className:"text-sm text-gray-500",children:t.address})]}),(0,va.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:(0,va.jsx)(Ta,{size:24})})]}),(0,va.jsxs)("div",{className:"p-6 overflow-y-auto",children:[(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,va.jsx)(tAe,{icon:(0,va.jsx)(is,{size:14,className:"mr-2"}),label:"Phone",value:(0,va.jsx)("a",{href:"tel:".concat(t.phoneNumber),className:"text-blue-600 hover:underline",children:t.phoneNumber})}),(0,va.jsx)(tAe,{icon:(0,va.jsx)(os,{size:14,className:"mr-2"}),label:"Email",value:(0,va.jsx)("a",{href:"mailto:".concat(t.email),className:"text-blue-600 hover:underline",children:t.email})}),(0,va.jsx)(tAe,{icon:(0,va.jsx)(Q,{size:14,className:"mr-2"}),label:"Quote",value:(0,va.jsx)("span",{className:"font-bold text-green-700",children:t.dabellaQuote})})]}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,va.jsx)(tAe,{icon:(0,va.jsx)(Xde,{size:14,className:"mr-2"}),label:"Quality",value:(0,va.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("Hot"===t.quality?"bg-red-100 text-red-800":"Warm"===t.quality?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:t.quality})}),(0,va.jsx)(tAe,{icon:(0,va.jsx)(G,{size:14,className:"mr-2"}),label:"Disposition",value:t.disposition}),(0,va.jsx)(tAe,{icon:(0,va.jsx)(Yde,{size:14,className:"mr-2"}),label:"Lead Source",value:t.leadSource})]}),(0,va.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 pb-6 border-b",children:[(0,va.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-blue-50 transition-colors",onClick:()=>a("calendar"),children:[(0,va.jsx)(K,{size:24,className:"mx-auto text-blue-600 mb-2"}),(0,va.jsx)("h4",{className:"font-semibold text-sm",children:"Appointments"}),(0,va.jsx)("p",{className:"text-xs text-gray-500",children:"Click to view calendar"})]}),(0,va.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,va.jsx)("h4",{className:"font-semibold text-sm mb-3 text-center",children:"Communications"}),(0,va.jsxs)("div",{className:"space-y-2",children:[(0,va.jsxs)("button",{onClick:()=>{window.open("mailto:".concat(t.email,"?from=brandon@rimehq.net&subject=Follow up - ").concat(t.customerName)),c(!0)},className:"w-full px-3 py-2 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 flex items-center justify-center",children:[(0,va.jsx)(os,{size:12,className:"mr-1"}),"Email"]}),(0,va.jsxs)("button",{onClick:()=>{var e;window.open("https://voice.google.com/u/0/calls?a=nc,%2B1".concat(null===(e=t.phoneNumber)||void 0===e?void 0:e.replace(/\D/g,""))),c(!0)},className:"w-full px-3 py-2 bg-green-600 text-white rounded text-xs hover:bg-green-700 flex items-center justify-center",children:[(0,va.jsx)(is,{size:12,className:"mr-1"}),"Call"]}),(0,va.jsxs)("button",{onClick:()=>{var e;window.open("https://voice.google.com/u/0/messages?contact=%2B1".concat(null===(e=t.phoneNumber)||void 0===e?void 0:e.replace(/\D/g,""))),c(!0)},className:"w-full px-3 py-2 bg-purple-600 text-white rounded text-xs hover:bg-purple-700 flex items-center justify-center",children:[(0,va.jsx)(os,{size:12,className:"mr-1"}),"SMS"]}),(0,va.jsx)("button",{onClick:()=>c(!0),className:"w-full px-3 py-2 bg-indigo-600 text-white rounded text-xs hover:bg-indigo-700 flex items-center justify-center font-semibold",children:"\ud83d\udccb Log Communication"})]})]}),(0,va.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-green-50 transition-colors",onClick:()=>a("map",t.address),children:[(0,va.jsx)(ja,{size:24,className:"mx-auto text-green-600 mb-2"}),(0,va.jsx)("h4",{className:"font-semibold text-sm",children:"Location"}),(0,va.jsx)("p",{className:"text-xs text-gray-500",children:"View on map"})]})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"Notes"}),(0,va.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-4 rounded-md whitespace-pre-wrap",children:t.notes||"No notes for this lead."})]})]}),(0,va.jsxs)("div",{className:"flex justify-end space-x-3 p-4 bg-gray-50 border-t",children:[(0,va.jsxs)("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center",children:[(0,va.jsx)(DC,{size:16,className:"mr-2"}),"Delete"]}),(0,va.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",children:[(0,va.jsx)(La,{size:16,className:"mr-2"}),"Edit Lead"]})]})]})}),l&&(0,va.jsx)(eAe,{lead:t,onClose:()=>c(!1),onLogCommunication:async e=>{s?await s(e):console.log("Communication logged:",e)},onUpdateLead:async e=>{o&&await o(e)}})]})},rAe=["children"],iAe=e=>{let{title:t,children:n}=e;return(0,va.jsxs)("div",{className:"mb-8",children:[(0,va.jsx)("h4",{className:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-3 mb-6",children:t}),(0,va.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n})]})},aAe=e=>{let{label:t,children:n,fullWidth:r=!1,required:i=!1}=e;return(0,va.jsxs)("div",{className:r?"lg:col-span-3 md:col-span-2":"",children:[(0,va.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",i&&(0,va.jsx)("span",{className:"text-red-500",children:"*"})]}),n]})},sAe=e=>(0,va.jsx)("input",M(M({},e),{},{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),oAe=e=>(0,va.jsx)("input",M(M({},e),{},{type:"number",step:"0.01",min:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),lAe=e=>(0,va.jsx)("input",M(M({},e),{},{type:"date",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})),cAe=e=>{let{children:t}=e,n=F(e,rAe);return(0,va.jsx)("select",M(M({},n),{},{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",children:t}))},uAe=e=>(0,va.jsx)("textarea",M(M({},e),{},{rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-vertical"})),hAe={firstName:"",lastName:"",customerName:"",phoneNumber:"",email:"",address:"",date:(new Date).toISOString().split("T")[0],leadSource:"Door Knock",quality:"Cold",disposition:"New",roofAge:"",roofType:"Asphalt Shingle",dabellaQuote:"",notes:"",sqFt:"",ridgeLf:"",valleyLf:"",eavesLf:"",ridgeVents:"",turbine:"",rimeFlow:"",highProfileRidgeCap:"",valleyMetal:"",pipes1Half:"",pipes2:"",pipes3:"",pipes4:"",gables:"",turtleBacks:"",satellite:"",chimney:"",solar:"",swampCooler:"",guttersLf:"",downspouts:"",gutterGuardLf:"",permanentLighting:""};const dAe=function(e){let{initialData:t,onSubmit:n,onCancel:r,isEdit:i=!1}=e;const[a,s]=(0,k.useState)(()=>t||hAe),[o,l]=(0,k.useState)(!1),c=(0,k.useCallback)(e=>{const{name:t,value:n}=e.target;s(e=>M(M({},e),{},{[t]:n}))},[]),u=(0,k.useCallback)(async e=>{e.preventDefault(),l(!0);try{const e=M({},a);e.customerName||!e.firstName&&!e.lastName||(e.customerName="".concat(e.firstName||""," ").concat(e.lastName||"").trim()),await n(e)}catch(SS){console.error("Form submission error:",SS)}finally{l(!1)}},[a,n]);return(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,va.jsxs)("div",{className:"bg-white rounded-xl max-w-7xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[(0,va.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:i?"Edit Job Count":"Add New Job Count"}),(0,va.jsx)("p",{className:"text-gray-600 mt-1",children:i?"Update job count information":"Enter customer and job measurement details"})]}),(0,va.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:(0,va.jsx)(Ta,{size:24})})]}),(0,va.jsx)("div",{className:"p-6 overflow-y-auto flex-1",children:(0,va.jsxs)("form",{onSubmit:u,className:"space-y-8",children:[(0,va.jsxs)(iAe,{title:"Customer Information",children:[(0,va.jsx)(aAe,{label:"First Name",required:!0,children:(0,va.jsx)(sAe,{name:"firstName",value:a.firstName,onChange:c,required:!0,placeholder:"John"})}),(0,va.jsx)(aAe,{label:"Last Name",children:(0,va.jsx)(sAe,{name:"lastName",value:a.lastName,onChange:c,placeholder:"Doe"})}),(0,va.jsx)(aAe,{label:"Full Name",children:(0,va.jsx)(sAe,{name:"customerName",value:a.customerName,onChange:c,placeholder:"John Doe (auto-filled from above)"})}),(0,va.jsx)(aAe,{label:"Phone Number",children:(0,va.jsx)(sAe,{name:"phoneNumber",value:a.phoneNumber,onChange:c,placeholder:"(555) 123-4567"})}),(0,va.jsx)(aAe,{label:"Email",children:(0,va.jsx)(sAe,{name:"email",type:"email",value:a.email,onChange:c,placeholder:"john@example.com"})}),(0,va.jsx)(aAe,{label:"Address",fullWidth:!0,children:(0,va.jsx)(sAe,{name:"address",value:a.address,onChange:c,placeholder:"123 Main St, City, State 12345"})})]}),(0,va.jsxs)(iAe,{title:"Job Information",children:[(0,va.jsx)(aAe,{label:"Date",required:!0,children:(0,va.jsx)(lAe,{name:"date",value:a.date,onChange:c,required:!0})}),(0,va.jsx)(aAe,{label:"Lead Source",children:(0,va.jsxs)(cAe,{name:"leadSource",value:a.leadSource,onChange:c,children:[(0,va.jsx)("option",{value:"Door Knock",children:"Door Knock"}),(0,va.jsx)("option",{value:"Rime",children:"Rime"}),(0,va.jsx)("option",{value:"Adverta",children:"Adverta"}),(0,va.jsx)("option",{value:"Referral",children:"Referral"}),(0,va.jsx)("option",{value:"DaBella",children:"DaBella"})]})}),(0,va.jsx)(aAe,{label:"Quality",children:(0,va.jsxs)(cAe,{name:"quality",value:a.quality,onChange:c,children:[(0,va.jsx)("option",{value:"Hot",children:"Hot"}),(0,va.jsx)("option",{value:"Warm",children:"Warm"}),(0,va.jsx)("option",{value:"Cold",children:"Cold"})]})}),(0,va.jsx)(aAe,{label:"Disposition",children:(0,va.jsxs)(cAe,{name:"disposition",value:a.disposition,onChange:c,children:[(0,va.jsx)("option",{value:"New",children:"New"}),(0,va.jsx)("option",{value:"Scheduled",children:"Scheduled"}),(0,va.jsx)("option",{value:"Insurance",children:"Insurance"}),(0,va.jsx)("option",{value:"Quoted",children:"Quoted"}),(0,va.jsx)("option",{value:"Follow Up",children:"Follow Up"}),(0,va.jsx)("option",{value:"Closed Sold",children:"Closed Sold"}),(0,va.jsx)("option",{value:"Closed Lost",children:"Closed Lost"})]})}),(0,va.jsx)(aAe,{label:"Roof Age",children:(0,va.jsx)(sAe,{name:"roofAge",value:a.roofAge,onChange:c,placeholder:"10 years"})}),(0,va.jsx)(aAe,{label:"Roof Type",children:(0,va.jsxs)(cAe,{name:"roofType",value:a.roofType,onChange:c,children:[(0,va.jsx)("option",{value:"Asphalt Shingle",children:"Asphalt Shingle"}),(0,va.jsx)("option",{value:"Metal",children:"Metal"}),(0,va.jsx)("option",{value:"Tile",children:"Tile"}),(0,va.jsx)("option",{value:"TPO",children:"TPO"}),(0,va.jsx)("option",{value:"Wood",children:"Wood"})]})}),(0,va.jsx)(aAe,{label:"Quote Amount",children:(0,va.jsx)(sAe,{name:"dabellaQuote",value:a.dabellaQuote,onChange:c,placeholder:"15000"})})]}),(0,va.jsxs)(iAe,{title:"Primary Measurements",children:[(0,va.jsx)(aAe,{label:"SQ FT",required:!0,children:(0,va.jsx)(oAe,{name:"sqFt",value:a.sqFt,onChange:c,required:!0,placeholder:"2500"})}),(0,va.jsx)(aAe,{label:"Ridge LF",required:!0,children:(0,va.jsx)(oAe,{name:"ridgeLf",value:a.ridgeLf,onChange:c,required:!0,placeholder:"150"})}),(0,va.jsx)(aAe,{label:"Valley LF",required:!0,children:(0,va.jsx)(oAe,{name:"valleyLf",value:a.valleyLf,onChange:c,required:!0,placeholder:"75"})}),(0,va.jsx)(aAe,{label:"Eaves LF",required:!0,children:(0,va.jsx)(oAe,{name:"eavesLf",value:a.eavesLf,onChange:c,required:!0,placeholder:"200"})})]}),(0,va.jsxs)(iAe,{title:"Ventilation & Flow",children:[(0,va.jsx)(aAe,{label:"Ridge Vents",children:(0,va.jsx)(oAe,{name:"ridgeVents",value:a.ridgeVents,onChange:c,placeholder:"10"})}),(0,va.jsx)(aAe,{label:"Turbine",children:(0,va.jsx)(oAe,{name:"turbine",value:a.turbine,onChange:c,placeholder:"2"})}),(0,va.jsx)(aAe,{label:"Rime Flow",children:(0,va.jsx)(oAe,{name:"rimeFlow",value:a.rimeFlow,onChange:c,placeholder:"100"})})]}),(0,va.jsxs)(iAe,{title:"Ridge & Valley Components",children:[(0,va.jsx)(aAe,{label:"High Profile Ridge Cap",children:(0,va.jsx)(oAe,{name:"highProfileRidgeCap",value:a.highProfileRidgeCap,onChange:c,placeholder:"20"})}),(0,va.jsx)(aAe,{label:"Valley Metal",children:(0,va.jsx)(oAe,{name:"valleyMetal",value:a.valleyMetal,onChange:c,placeholder:"15"})})]}),(0,va.jsxs)(iAe,{title:"Pipes",children:[(0,va.jsx)(aAe,{label:'Pipes [1 1/2"]',children:(0,va.jsx)(oAe,{name:"pipes1Half",value:a.pipes1Half,onChange:c,placeholder:"3"})}),(0,va.jsx)(aAe,{label:'Pipes [2"]',children:(0,va.jsx)(oAe,{name:"pipes2",value:a.pipes2,onChange:c,placeholder:"2"})}),(0,va.jsx)(aAe,{label:'Pipes [3"]',children:(0,va.jsx)(oAe,{name:"pipes3",value:a.pipes3,onChange:c,placeholder:"1"})}),(0,va.jsx)(aAe,{label:'Pipes [4"]',children:(0,va.jsx)(oAe,{name:"pipes4",value:a.pipes4,onChange:c,placeholder:"1"})})]}),(0,va.jsxs)(iAe,{title:"Roof Features",children:[(0,va.jsx)(aAe,{label:"Gables",children:(0,va.jsx)(oAe,{name:"gables",value:a.gables,onChange:c,placeholder:"4"})}),(0,va.jsx)(aAe,{label:"Turtle Backs",children:(0,va.jsx)(oAe,{name:"turtleBacks",value:a.turtleBacks,onChange:c,placeholder:"2"})}),(0,va.jsx)(aAe,{label:"Satellite",children:(0,va.jsx)(oAe,{name:"satellite",value:a.satellite,onChange:c,placeholder:"1"})}),(0,va.jsx)(aAe,{label:"Chimney",children:(0,va.jsx)(oAe,{name:"chimney",value:a.chimney,onChange:c,placeholder:"1"})}),(0,va.jsx)(aAe,{label:"Solar",children:(0,va.jsx)(oAe,{name:"solar",value:a.solar,onChange:c,placeholder:"20"})}),(0,va.jsx)(aAe,{label:"Swamp Cooler",children:(0,va.jsx)(oAe,{name:"swampCooler",value:a.swampCooler,onChange:c,placeholder:"1"})})]}),(0,va.jsxs)(iAe,{title:"Gutters & Additional",children:[(0,va.jsx)(aAe,{label:"Gutters LF",children:(0,va.jsx)(oAe,{name:"guttersLf",value:a.guttersLf,onChange:c,placeholder:"180"})}),(0,va.jsx)(aAe,{label:"Downspouts",children:(0,va.jsx)(oAe,{name:"downspouts",value:a.downspouts,onChange:c,placeholder:"6"})}),(0,va.jsx)(aAe,{label:"Gutter Guard LF",children:(0,va.jsx)(oAe,{name:"gutterGuardLf",value:a.gutterGuardLf,onChange:c,placeholder:"180"})}),(0,va.jsx)(aAe,{label:"Permanent Lighting",children:(0,va.jsx)(oAe,{name:"permanentLighting",value:a.permanentLighting,onChange:c,placeholder:"200"})})]}),(0,va.jsx)(iAe,{title:"Notes",children:(0,va.jsx)(aAe,{label:"Additional Notes",fullWidth:!0,children:(0,va.jsx)(uAe,{name:"notes",value:a.notes,onChange:c,placeholder:"Any additional notes about this job count..."})})}),(0,va.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,va.jsx)("button",{type:"button",onClick:r,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,va.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors",children:o?(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(H,{className:"animate-spin h-5 w-5 mr-2"}),"Saving..."]}):i?"Update Job Count":"Add Job Count"})]})]})})]})})};const AAe=function(e){let{jobCount:t,onClose:n,onEdit:r,onDelete:i}=e;const a=e=>e&&"0"!==e&&"-"!==e?Number(e).toLocaleString():"-",s=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(t){return e}},o=e=>e&&"0"!==e&&"-"!==e?"$".concat(a(e)):"-",l=e=>{let{title:t,children:n,icon:r}=e;return(0,va.jsxs)("div",{className:"mb-8",children:[(0,va.jsxs)("div",{className:"flex items-center mb-6",children:[(0,va.jsx)(r,{className:"w-6 h-6 text-blue-600 mr-3"}),(0,va.jsx)("h4",{className:"text-xl font-semibold text-gray-800",children:t})]}),(0,va.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n})]})},c=e=>{let{label:t,value:n,fullWidth:r=!1}=e;return(0,va.jsxs)("div",{className:"".concat(r?"lg:col-span-3 md:col-span-2":""," bg-gray-50 p-4 rounded-lg border"),children:[(0,va.jsx)("dt",{className:"text-sm font-medium text-gray-600 mb-1",children:t}),(0,va.jsx)("dd",{className:"text-base text-gray-900 font-semibold",children:n||"-"})]})},u=t.customerName||"".concat(t.firstName||""," ").concat(t.lastName||"").trim()||"Unknown Customer";return(0,va.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,va.jsxs)("div",{className:"bg-white rounded-xl max-w-7xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[(0,va.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:"Job Count Details"}),(0,va.jsx)("p",{className:"text-gray-600 mt-1",children:u}),(0,va.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Date: ",s(t.date)]})]}),(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("button",{onClick:()=>r(t),className:"p-3 text-orange-600 hover:text-orange-800 hover:bg-orange-50 rounded-lg transition-colors",title:"Edit Job Count",children:(0,va.jsx)(La,{className:"w-6 h-6"})}),(0,va.jsx)("button",{onClick:()=>i(t.id),className:"p-3 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Job Count",children:(0,va.jsx)(DC,{className:"w-6 h-6"})}),(0,va.jsx)("button",{onClick:n,className:"p-3 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,va.jsx)(Ta,{className:"w-6 h-6"})})]})]}),(0,va.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:[(0,va.jsxs)(l,{title:"Customer Information",icon:rs,children:[(0,va.jsx)(c,{label:"First Name",value:t.firstName}),(0,va.jsx)(c,{label:"Last Name",value:t.lastName}),(0,va.jsx)(c,{label:"Full Name",value:t.customerName}),(0,va.jsx)(c,{label:"Phone Number",value:(e=>{if(!e)return"-";const t=e.toString().replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):e})(t.phoneNumber)}),(0,va.jsx)(c,{label:"Email",value:t.email}),(0,va.jsx)(c,{label:"Address",value:t.address,fullWidth:!0})]}),(0,va.jsxs)(l,{title:"Job Information",icon:ls,children:[(0,va.jsx)(c,{label:"Date",value:s(t.date)}),(0,va.jsx)(c,{label:"Lead Source",value:t.leadSource}),(0,va.jsx)(c,{label:"Quality",value:t.quality}),(0,va.jsx)(c,{label:"Disposition",value:t.disposition}),(0,va.jsx)(c,{label:"Roof Age",value:t.roofAge}),(0,va.jsx)(c,{label:"Roof Type",value:t.roofType}),(0,va.jsx)(c,{label:"Quote Amount",value:o(t.dabellaQuote)})]}),(0,va.jsxs)(l,{title:"Primary Measurements",icon:W,children:[(0,va.jsx)(c,{label:"SQ FT",value:a(t.sqFt)}),(0,va.jsx)(c,{label:"Ridge LF",value:a(t.ridgeLf)}),(0,va.jsx)(c,{label:"Valley LF",value:a(t.valleyLf)}),(0,va.jsx)(c,{label:"Eaves LF",value:a(t.eavesLf)})]}),(0,va.jsxs)(l,{title:"Ventilation & Flow",icon:W,children:[(0,va.jsx)(c,{label:"Ridge Vents",value:a(t.ridgeVents)}),(0,va.jsx)(c,{label:"Turbine",value:a(t.turbine)}),(0,va.jsx)(c,{label:"Rime Flow",value:a(t.rimeFlow)})]}),(0,va.jsxs)(l,{title:"Ridge & Valley Components",icon:W,children:[(0,va.jsx)(c,{label:"High Profile Ridge Cap",value:a(t.highProfileRidgeCap)}),(0,va.jsx)(c,{label:"Valley Metal",value:a(t.valleyMetal)})]}),(0,va.jsxs)(l,{title:"Pipes",icon:W,children:[(0,va.jsx)(c,{label:'Pipes [1 1/2"]',value:a(t.pipes1Half)}),(0,va.jsx)(c,{label:'Pipes [2"]',value:a(t.pipes2)}),(0,va.jsx)(c,{label:'Pipes [3"]',value:a(t.pipes3)}),(0,va.jsx)(c,{label:'Pipes [4"]',value:a(t.pipes4)})]}),(0,va.jsxs)(l,{title:"Roof Features",icon:W,children:[(0,va.jsx)(c,{label:"Gables",value:a(t.gables)}),(0,va.jsx)(c,{label:"Turtle Backs",value:a(t.turtleBacks)}),(0,va.jsx)(c,{label:"Satellite",value:a(t.satellite)}),(0,va.jsx)(c,{label:"Chimney",value:a(t.chimney)}),(0,va.jsx)(c,{label:"Solar",value:a(t.solar)}),(0,va.jsx)(c,{label:"Swamp Cooler",value:a(t.swampCooler)})]}),(0,va.jsxs)(l,{title:"Gutters & Additional",icon:W,children:[(0,va.jsx)(c,{label:"Gutters LF",value:a(t.guttersLf)}),(0,va.jsx)(c,{label:"Downspouts",value:a(t.downspouts)}),(0,va.jsx)(c,{label:"Gutter Guard LF",value:a(t.gutterGuardLf)}),(0,va.jsx)(c,{label:"Permanent Lighting",value:a(t.permanentLighting)})]}),t.notes&&(0,va.jsx)(l,{title:"Notes",icon:ls,children:(0,va.jsx)(c,{label:"Additional Notes",value:t.notes,fullWidth:!0})}),(0,va.jsxs)("div",{className:"mt-8 p-6 bg-blue-50 rounded-xl border border-blue-200",children:[(0,va.jsxs)("h4",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center",children:[(0,va.jsx)(W,{className:"w-5 h-5 mr-2"}),"Summary Totals"]}),(0,va.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:a(t.sqFt)}),(0,va.jsx)("div",{className:"text-sm text-blue-700",children:"Total SQ FT"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:a(t.ridgeLf)}),(0,va.jsx)("div",{className:"text-sm text-blue-700",children:"Ridge LF"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:a(t.valleyLf)}),(0,va.jsx)("div",{className:"text-sm text-blue-700",children:"Valley LF"})]}),(0,va.jsxs)("div",{className:"text-center",children:[(0,va.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:o(t.dabellaQuote)}),(0,va.jsx)("div",{className:"text-sm text-blue-700",children:"Quote Value"})]})]})]})]})]})})};const pAe=function(){const[e,t]=(0,k.useState)(null),[n,r]=(0,k.useState)(!1);return(0,va.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[(0,va.jsxs)("div",{className:"flex items-center justify-between",children:[(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Google Sheets Connection"}),e&&(0,va.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[e.success?(0,va.jsx)($,{className:"w-3 h-3 mr-1"}):(0,va.jsx)(ee,{className:"w-3 h-3 mr-1"}),e.success?"Connected":"Error"]})]}),(0,va.jsxs)("button",{onClick:async()=>{r(!0),t(null);const e=await re.testConnection();t(e),r(!1)},disabled:n,className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[n?(0,va.jsx)(H,{className:"animate-spin w-4 h-4 mr-2"}):(0,va.jsx)(Ba,{className:"w-4 h-4 mr-2"}),"Test"]})]}),e&&(0,va.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[e.message,e.success&&e.rowCount&&" (".concat(e.rowCount," rows)")]})]})};const fAe=function(e){let{error:t}=e;return(0,va.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-50 p-4",children:(0,va.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-lg",children:[(0,va.jsx)(ee,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,va.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Application Configuration Error"}),(0,va.jsx)("p",{className:"text-gray-600 mb-4",children:"The application could not start because a required configuration variable is missing or invalid."}),(0,va.jsxs)("div",{className:"bg-red-100 text-red-700 text-left p-3 rounded-md text-sm",children:[(0,va.jsx)("strong",{children:"Details:"})," ",t]}),(0,va.jsx)("p",{className:"text-gray-500 mt-4 text-sm",children:"Please ensure all `REACT_APP_*` variables are set correctly in your Vercel project settings and redeploy."})]})})},gAe=(0,k.createContext)(null),mAe={didCatch:!1,error:null};class yAe extends k.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=mAe}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,n,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];null===(t=(n=this.props).onReset)||void 0===t||t.call(n,{args:i,reason:"imperative-api"}),this.setState(mAe)}}componentDidCatch(e,t){var n,r;null===(n=(r=this.props).onError)||void 0===n||n.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:n}=this.state,{resetKeys:r}=this.props;var i,a;n&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,n)=>!Object.is(e,t[n]))}(e.resetKeys,r)&&(null===(i=(a=this.props).onReset)||void 0===i||i.call(a,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(mAe))}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:r}=this.props,{didCatch:i,error:a}=this.state;let s=e;if(i){const e={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof t)s=t(e);else if(n)s=(0,k.createElement)(n,e);else{if(void 0===r)throw a;s=r}}return(0,k.createElement)(gAe.Provider,{value:{didCatch:i,error:a,resetErrorBoundary:this.resetErrorBoundary}},s)}}const vAe=z("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),bAe=z("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),xAe=z("bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]),wAe=e=>{let{error:t,resetErrorBoundary:n,componentStack:r}=e;const[i,a]=k.useState(!1),[s,o]=k.useState(!1);return(0,va.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4",children:(0,va.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-xl shadow-2xl border border-red-200",children:[(0,va.jsx)("div",{className:"bg-gradient-to-r from-red-500 to-orange-500 text-white p-6 rounded-t-xl",children:(0,va.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,va.jsx)("div",{className:"p-2 bg-white/20 rounded-lg",children:(0,va.jsx)(vAe,{className:"w-6 h-6"})}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h1",{className:"text-xl font-bold",children:"System Error Detected"}),(0,va.jsx)("p",{className:"text-red-100",children:"The CRM encountered an unexpected error"})]})]})}),(0,va.jsxs)("div",{className:"p-6 space-y-6",children:[(0,va.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,va.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,va.jsx)(bAe,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),(0,va.jsxs)("div",{className:"flex-1",children:[(0,va.jsx)("h3",{className:"font-semibold text-red-800 mb-1",children:"Error Details"}),(0,va.jsx)("p",{className:"text-red-700 text-sm font-mono bg-red-100 p-2 rounded",children:t.message})]})]})}),(0,va.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,va.jsx)("h3",{className:"font-semibold text-blue-800 mb-3",children:"Troubleshooting Steps"}),(0,va.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-blue-700 text-sm",children:[(0,va.jsx)("li",{children:"Try refreshing the page to reload the application"}),(0,va.jsx)("li",{children:"Clear your browser cache and cookies"}),(0,va.jsx)("li",{children:"Check your internet connection"}),(0,va.jsx)("li",{children:"Disable browser extensions temporarily"}),(0,va.jsx)("li",{children:"Contact support if the problem persists"})]})]}),(0,va.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,va.jsxs)("button",{onClick:n,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[(0,va.jsx)(Ba,{className:"w-4 h-4"}),(0,va.jsx)("span",{children:"Try Again"})]}),(0,va.jsxs)("button",{onClick:async()=>{o(!0);try{const e={message:t.message,stack:t.stack,componentStack:r,url:window.location.href,userAgent:navigator.userAgent,timestamp:(new Date).toISOString(),userId:localStorage.getItem("userId")||"anonymous"};console.error("Error Report:",e),setTimeout(()=>o(!1),1e3)}catch(reportError){console.error("Failed to report error:",reportError),o(!1)}},disabled:s,className:"flex items-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50",children:[(0,va.jsx)(xAe,{className:"w-4 h-4"}),(0,va.jsx)("span",{children:s?"Reporting...":"Report Error"})]}),(0,va.jsxs)("button",{onClick:()=>window.location.reload(),className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[(0,va.jsx)(Ba,{className:"w-4 h-4"}),(0,va.jsx)("span",{children:"Reload Page"})]})]}),(0,va.jsxs)("div",{className:"border-t pt-4",children:[(0,va.jsxs)("button",{onClick:()=>a(!i),className:"text-gray-600 hover:text-gray-800 text-sm font-medium",children:[i?"Hide":"Show"," Technical Details"]}),i&&(0,va.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Stack Trace"}),(0,va.jsx)("pre",{className:"text-xs bg-gray-100 p-3 rounded overflow-x-auto text-gray-700 font-mono",children:t.stack})]}),r&&(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Component Stack"}),(0,va.jsx)("pre",{className:"text-xs bg-gray-100 p-3 rounded overflow-x-auto text-gray-700 font-mono",children:r})]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Environment"}),(0,va.jsxs)("div",{className:"text-xs bg-gray-100 p-3 rounded text-gray-700 space-y-1",children:[(0,va.jsxs)("div",{children:[(0,va.jsx)("strong",{children:"URL:"})," ",window.location.href]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("strong",{children:"User Agent:"})," ",navigator.userAgent]}),(0,va.jsxs)("div",{children:[(0,va.jsx)("strong",{children:"Timestamp:"})," ",(new Date).toISOString()]})]})]})]})]})]}),(0,va.jsx)("div",{className:"bg-gray-50 px-6 py-3 rounded-b-xl border-t text-center",children:(0,va.jsxs)("p",{className:"text-xs text-gray-500",children:["Bhotch CRM System - Error ID: ",Date.now().toString(36)]})})]})})},_Ae=(e,t)=>{console.group("\ud83d\udea8 Error Boundary Triggered"),console.error("Error:",e),console.error("Error Info:",t),console.error("Component Stack:",t.componentStack),console.error("Error Stack:",e.stack),console.groupEnd();const n={message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent};try{const e=JSON.parse(localStorage.getItem("errorLogs")||"[]");e.push(n),e.length>10&&e.splice(0,e.length-10),localStorage.setItem("errorLogs",JSON.stringify(e))}catch(r){console.warn("Failed to store error log:",r)}},SAe=e=>{let{children:t,fallback:n}=e;return(0,va.jsx)(yAe,{FallbackComponent:n||wAe,onError:_Ae,onReset:()=>{window.location.hash="",window.location.reload()},children:t})},CAe=SAe;function EAe(e){let{onLogout:t}=e;const{notifications:n,addNotification:r}=function(){const[e,t]=(0,k.useState)([]),n=(0,k.useCallback)(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";const r={id:Date.now().toString(),message:e,type:n};t(e=>[r,...e.slice(0,4)]),setTimeout(()=>{t(e=>e.filter(e=>e.id!==r.id))},5e3)},[]);return{notifications:e,addNotification:n}}(),{leads:i,loading:a,refreshLeads:s,addLead:o,updateLead:l,deleteLead:c}=function(e){const[t,n]=(0,k.useState)([]),[r,i]=(0,k.useState)(!0),a=(0,k.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||i(!0);const r=await re.fetchLeads();if(r.success){const i=(r.data||r.leads||[]).map(e=>M(M({},e),{},{customerName:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown"})).sort((e,t)=>new Date(t.createdDate||0)-new Date(e.createdDate||0));n(i),e(t?"Leads refreshed. Found ".concat(i.length," leads."):"Leads loaded. Found ".concat(i.length," leads."),"success")}else e("Error fetching leads: ".concat(r.message),"error");t||i(!1)},[e]);(0,k.useEffect)(()=>{a()},[a]);const s=(0,k.useCallback)(async t=>{const r=await re.addLead(t);return r.success&&r.lead?(n(e=>[r.lead,...e].sort((e,t)=>new Date(t.createdDate||0)-new Date(e.createdDate||0))),e("Lead added: ".concat(r.lead.customerName),"success")):e("Error adding lead: ".concat(r.message),"error"),r},[e]),o=(0,k.useCallback)(async t=>{const r=await re.updateLead(t);return r.success&&r.lead?(n(e=>e.map(e=>e.id===r.lead.id?r.lead:e)),e("Lead updated: ".concat(r.lead.customerName),"info")):e("Error updating lead: ".concat(r.message),"error"),r},[e]),l=(0,k.useCallback)(async r=>{const i=t.find(e=>e.id===r);if(i&&window.confirm("Are you sure you want to delete ".concat(i.customerName,"?"))){const t=await re.deleteLead(r);t.success?(n(e=>e.filter(e=>e.id!==r)),e("Lead deleted: ".concat(i.customerName),"warning")):e("Error deleting lead: ".concat(t.message),"error")}},[t,e]);return{leads:t,loading:r,refreshLeads:()=>a(!0),addLead:s,updateLead:o,deleteLead:l}}(r),{jobCounts:u,loading:h,refreshJobCounts:d,addJobCount:A,updateJobCount:p,deleteJobCount:f}=function(e){const[t,n]=(0,k.useState)([]),[r,i]=(0,k.useState)(!0),a=(0,k.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||i(!0);try{const r=await re.fetchJobCounts();if(r.success){const i=(r.data||r.jobCounts||[]).map((e,t)=>M(M({},e),{},{id:e.id||"jobcount_".concat(Date.now(),"_").concat(t),fullName:e.customerName||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Unknown Customer"})).sort((e,t)=>new Date(t.date||0)-new Date(e.date||0));n(i);const a=t?"Job counts refreshed. Found ".concat(i.length," records."):"Job counts loaded. Found ".concat(i.length," records.");e(a,"success")}else e("Error fetching job counts: ".concat(r.message),"error")}catch(SS){e("Error loading job counts: ".concat(SS.message),"error")}finally{t||i(!1)}},[e]);(0,k.useEffect)(()=>{a()},[a]);const s=(0,k.useCallback)(async t=>{try{const r=await re.addJobCount(t);if(r.success&&r.jobCount){const t=M(M({},r.jobCount),{},{id:r.jobCount.id||"jobcount_".concat(Date.now()),fullName:r.jobCount.customerName||"".concat(r.jobCount.firstName||""," ").concat(r.jobCount.lastName||"").trim()||"Unknown Customer"});n(e=>[t,...e].sort((e,t)=>new Date(t.date||0)-new Date(e.date||0))),e("Job count added: ".concat(t.fullName),"success")}else e("Error adding job count: ".concat(r.message),"error");return r}catch(SS){return e("Error adding job count: ".concat(SS.message),"error"),{success:!1,message:SS.message}}},[e]),o=(0,k.useCallback)(async t=>{try{const r=await re.updateJobCount(t);if(r.success&&r.jobCount){const i=M(M({},r.jobCount),{},{id:r.jobCount.id||t.id,fullName:r.jobCount.customerName||"".concat(r.jobCount.firstName||""," ").concat(r.jobCount.lastName||"").trim()||"Unknown Customer"});n(e=>e.map(e=>e.id===i.id?i:e)),e("Job count updated: ".concat(i.fullName),"info")}else e("Error updating job count: ".concat(r.message),"error");return r}catch(SS){return e("Error updating job count: ".concat(SS.message),"error"),{success:!1,message:SS.message}}},[e]),l=(0,k.useCallback)(async r=>{const i=t.find(e=>e.id===r);if(!i)return void e("Job count not found","error");const a="Are you sure you want to delete the job count for ".concat(i.fullName,"?");if(window.confirm(a))try{const t=await re.deleteJobCount(r);t.success?(n(e=>e.filter(e=>e.id!==r)),e("Job count deleted: ".concat(i.fullName),"info")):e("Error deleting job count: ".concat(t.message),"error")}catch(SS){e("Error deleting job count: ".concat(SS.message),"error")}},[t,e]);return{jobCounts:t,loading:r,refreshJobCounts:()=>a(!0),addJobCount:s,updateJobCount:o,deleteJobCount:l}}(r),{communications:g,addCommunication:m}=le(r),[y,v]=(0,k.useState)("dashboard"),[b,x]=(0,k.useState)(null),[w,_]=(0,k.useState)(!1),[S,C]=(0,k.useState)(null),[E,N]=(0,k.useState)(""),[I,T]=(0,k.useState)(null),[B,F]=(0,k.useState)(!1),[R,L]=(0,k.useState)(null),P=(0,k.useMemo)(()=>({totalLeads:i.length,hotLeads:i.filter(e=>"Hot"===e.quality).length,quotedLeads:i.filter(e=>"Quoted"===e.disposition).length,totalQuoteValue:i.reduce((e,t)=>e+(parseFloat(String(t.dabellaQuote).replace(/[$,]/g,""))||0),0),totalJobCounts:u.length,totalSqFt:u.reduce((e,t)=>e+(parseFloat(t.sqFt)||0),0)}),[i,u]),U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";v(e),"map"===e&&t&&N(t),C(null),L(null)};return a||h?(0,va.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,va.jsx)(H,{className:"animate-spin h-12 w-12 text-blue-600"})}):(0,va.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,va.jsx)("header",{className:"bg-white shadow-sm border-b sticky top-0 z-30",children:(0,va.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,va.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,va.jsxs)("div",{className:"flex items-center",children:[(0,va.jsx)(Q,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,va.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Bhotch CRM"})]}),(0,va.jsxs)("nav",{className:"flex space-x-1 sm:space-x-2",children:[(0,va.jsxs)("button",{onClick:()=>v("dashboard"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("dashboard"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(V,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Dashboard"})]}),(0,va.jsxs)("button",{onClick:()=>v("leads"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("leads"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(G,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Leads"})]}),(0,va.jsxs)("button",{onClick:()=>v("jobcount"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("jobcount"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(W,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Job Count"})]}),(0,va.jsxs)("button",{onClick:()=>v("map"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("map"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(q,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Map"})]}),(0,va.jsxs)("button",{onClick:()=>v("calendar"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("calendar"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(K,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Calendar"})]}),(0,va.jsxs)("button",{onClick:()=>v("communications"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("communications"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(X,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Comms"})]}),(0,va.jsxs)("button",{onClick:()=>v("visualization"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("visualization"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(Y,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"360\xb0 View"})]}),(0,va.jsxs)("button",{onClick:()=>v("canvassing"),className:"px-3 py-2 rounded-md text-sm font-medium flex items-center transition-colors ".concat("canvassing"===y?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"),children:[(0,va.jsx)(J,{className:"w-4 h-4 mr-1"}),(0,va.jsx)("span",{className:"hidden sm:inline",children:"Canvassing"})]}),(0,va.jsx)("button",{onClick:t,className:"p-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors",children:(0,va.jsx)(Z,{className:"w-5 h-5"})})]})]})})}),(0,va.jsx)("div",{className:"fixed top-20 right-5 w-80 z-50",children:n.map(e=>(0,va.jsxs)("div",{className:"p-3 rounded-md mb-2 shadow-lg animate-fade-in-right flex items-start ".concat("success"===e.type?"bg-green-100 text-green-800":"error"===e.type?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:["success"===e.type&&(0,va.jsx)($,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),"error"===e.type&&(0,va.jsx)(ee,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),"info"===e.type&&(0,va.jsx)(te,{className:"w-5 h-5 mr-2 mt-0.5 shrink-0"}),(0,va.jsx)("span",{className:"text-sm",children:e.message})]},e.id))}),(0,va.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:["dashboard"===y&&(0,va.jsxs)(va.Fragment,{children:[(0,va.jsx)(pAe,{}),(0,va.jsx)(Sa,{stats:P,leads:i,jobCounts:u,onNavigateToTab:U})]}),"leads"===y&&(0,va.jsx)(Da,{leads:i,onAddLead:()=>_(!0),onEditLead:x,onDeleteLead:c,onRefreshLeads:s,onSelectLead:C}),"jobcount"===y&&(0,va.jsx)(Oa,{jobCounts:u,onAddJobCount:()=>F(!0),onEditJobCount:T,onDeleteJobCount:f,onRefreshJobCounts:d,onSelectJobCount:L}),"map"===y&&(0,va.jsx)(qa,{leads:i,onLeadClick:C,searchAddress:E,onSearchComplete:()=>N("")}),"calendar"===y&&(0,va.jsx)(Za,{}),"communications"===y&&(0,va.jsx)(As,{leads:i,jobCounts:u,communications:g}),"visualization"===y&&(0,va.jsx)("div",{style:{height:"calc(100vh - 120px)"},children:(0,va.jsx)(xue,{})}),"canvassing"===y&&(0,va.jsx)("div",{style:{height:"calc(100vh - 120px)"},children:(0,va.jsx)(jde,{leads:i})})]}),w&&(0,va.jsx)(Kde,{onSubmit:async e=>{await o(e),_(!1)},onCancel:()=>_(!1)}),b&&(0,va.jsx)(Kde,{initialData:b,onSubmit:async e=>{await l(e),x(null)},onCancel:()=>x(null),isEdit:!0}),S&&(0,va.jsx)(nAe,{lead:S,onClose:()=>C(null),onEdit:()=>{x(S),C(null)},onDelete:()=>{c(S.id),C(null)},onNavigateToTab:U,onLogCommunication:m,onUpdateLead:l}),B&&(0,va.jsx)(dAe,{onSubmit:async e=>{await A(e),F(!1)},onCancel:()=>F(!1)}),I&&(0,va.jsx)(dAe,{initialData:I,onSubmit:async e=>{await p(e),T(null)},onCancel:()=>T(null),isEdit:!0}),R&&(0,va.jsx)(AAe,{jobCount:R,onClose:()=>L(null),onEdit:()=>{T(R),L(null)},onDelete:()=>{f(R.id),L(null)},onJobCountUpdate:e=>{L(e),d()}})]})}function NAe(){const[e,t]=(0,k.useState)(!!sessionStorage.getItem("isAuthenticated")),n=["AIzaSyCa63Fy9PF-NV8C_z_5Qp7VWse5nRxRRJ8","https://script.google.com/macros/s/AKfycbweOri4v6JDVEsMnU2KbxiQ2_MicbaltR49-cqYwwT2J8YE1dbLhd_Klc5AuUThJjpNZA/exec","AIzaSyA-IhqTEAOQMTU9DlEeUwt1_oM5yq3-sb4"].some(e=>!e)?"One or more critical environment variables (Firebase, GAS URL, Maps API) are not set.":null;return n?(0,va.jsx)(fAe,{error:n}):e?(0,va.jsx)(CAe,{children:(0,va.jsx)(EAe,{onLogout:()=>{sessionStorage.removeItem("isAuthenticated"),t(!1)}})}):(0,va.jsx)(CAe,{children:(0,va.jsx)(ba,{onLogin:()=>t(!0)})})}I.createRoot(document.getElementById("root")).render((0,va.jsx)(k.StrictMode,{children:(0,va.jsx)(NAe,{})}))})()})();
//# sourceMappingURL=main.01bd1f68.js.map