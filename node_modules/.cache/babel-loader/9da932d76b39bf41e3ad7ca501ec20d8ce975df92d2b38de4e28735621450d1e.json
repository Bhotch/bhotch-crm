{"ast":null,"code":"// Fix for deployment environment variable parsing issue\nlet GOOGLE_SCRIPT_URL = process.env.REACT_APP_GAS_WEB_APP_URL;\n\n// Handle case where environment variable includes the variable name\nif (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.includes('REACT_APP_GAS_WEB_APP_URL=')) {\n  GOOGLE_SCRIPT_URL = GOOGLE_SCRIPT_URL.split('REACT_APP_GAS_WEB_APP_URL=')[1];\n}\n\n// Ensure URL has proper protocol\nif (GOOGLE_SCRIPT_URL && !GOOGLE_SCRIPT_URL.startsWith('http')) {\n  GOOGLE_SCRIPT_URL = 'https://' + GOOGLE_SCRIPT_URL.replace(/^\\/+/, '');\n}\nclass GoogleSheetsService {\n  constructor(baseURL) {\n    this.baseURL = baseURL;\n  }\n  async makeRequest(action, payload) {\n    if (!this.baseURL) {\n      return {\n        success: false,\n        message: 'API endpoint is not configured.'\n      };\n    }\n    try {\n      const response = await fetch(this.baseURL, {\n        method: 'POST',\n        mode: 'cors',\n        credentials: 'omit',\n        headers: {\n          'Content-Type': 'text/plain;charset=utf-8'\n        },\n        body: JSON.stringify({\n          action,\n          ...payload\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Server responded with status: ${response.status}`);\n      }\n      const text = await response.text();\n      try {\n        const result = JSON.parse(text);\n        if (result.success === false) {\n          throw new Error(result.message || 'An unknown backend error occurred.');\n        }\n        return result;\n      } catch (parseError) {\n        throw new Error('Invalid server response. The backend may have crashed.');\n      }\n    } catch (error) {\n      return {\n        success: false,\n        message: `Network error: ${error.message}`\n      };\n    }\n  }\n\n  // Lead operations\n  fetchLeads() {\n    return this.makeRequest('getLeads', {});\n  }\n  addLead(lead) {\n    return this.makeRequest('addLead', {\n      lead\n    });\n  }\n  updateLead(lead) {\n    return this.makeRequest('updateLead', {\n      lead\n    });\n  }\n  deleteLead(leadId) {\n    return this.makeRequest('deleteLead', {\n      leadId\n    });\n  }\n\n  // Job Count operations\n  fetchJobCounts() {\n    return this.makeRequest('getJobCounts', {});\n  }\n  addJobCount(jobCount) {\n    return this.makeRequest('addJobCount', {\n      jobCount\n    });\n  }\n  updateJobCount(jobCount) {\n    return this.makeRequest('updateJobCount', {\n      jobCount\n    });\n  }\n  deleteJobCount(jobCountId) {\n    return this.makeRequest('deleteJobCount', {\n      jobCountId\n    });\n  }\n\n  // Utility operations\n  testConnection() {\n    return this.makeRequest('testConnection', {});\n  }\n  geocodeAddress(address) {\n    return this.makeRequest('geocodeAddress', {\n      address\n    });\n  }\n}\nexport const googleSheetsService = new GoogleSheetsService(GOOGLE_SCRIPT_URL);","map":{"version":3,"names":["GOOGLE_SCRIPT_URL","process","env","REACT_APP_GAS_WEB_APP_URL","includes","split","startsWith","replace","GoogleSheetsService","constructor","baseURL","makeRequest","action","payload","success","message","response","fetch","method","mode","credentials","headers","body","JSON","stringify","ok","Error","status","text","result","parse","parseError","error","fetchLeads","addLead","lead","updateLead","deleteLead","leadId","fetchJobCounts","addJobCount","jobCount","updateJobCount","deleteJobCount","jobCountId","testConnection","geocodeAddress","address","googleSheetsService"],"sources":["C:/Users/PC_User/Desktop/free-crm/bhotch-crm/src/api/googleSheetsService.js"],"sourcesContent":["// Fix for deployment environment variable parsing issue\r\nlet GOOGLE_SCRIPT_URL = process.env.REACT_APP_GAS_WEB_APP_URL;\r\n\r\n// Handle case where environment variable includes the variable name\r\nif (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.includes('REACT_APP_GAS_WEB_APP_URL=')) {\r\n  GOOGLE_SCRIPT_URL = GOOGLE_SCRIPT_URL.split('REACT_APP_GAS_WEB_APP_URL=')[1];\r\n}\r\n\r\n// Ensure URL has proper protocol\r\nif (GOOGLE_SCRIPT_URL && !GOOGLE_SCRIPT_URL.startsWith('http')) {\r\n  GOOGLE_SCRIPT_URL = 'https://' + GOOGLE_SCRIPT_URL.replace(/^\\/+/, '');\r\n}\r\n\r\nclass GoogleSheetsService {\r\n  constructor(baseURL) {\r\n    this.baseURL = baseURL;\r\n  }\r\n\r\n  async makeRequest(action, payload) {\r\n    if (!this.baseURL) {\r\n      return { success: false, message: 'API endpoint is not configured.' };\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(this.baseURL, {\r\n        method: 'POST',\r\n        mode: 'cors',\r\n        credentials: 'omit',\r\n        headers: {\r\n          'Content-Type': 'text/plain;charset=utf-8'\r\n        },\r\n        body: JSON.stringify({ action, ...payload })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Server responded with status: ${response.status}`);\r\n      }\r\n\r\n      const text = await response.text();\r\n\r\n      try {\r\n        const result = JSON.parse(text);\r\n        if (result.success === false) {\r\n          throw new Error(result.message || 'An unknown backend error occurred.');\r\n        }\r\n        return result;\r\n      } catch (parseError) {\r\n        throw new Error('Invalid server response. The backend may have crashed.');\r\n      }\r\n    } catch (error) {\r\n      return { success: false, message: `Network error: ${error.message}` };\r\n    }\r\n  }\r\n\r\n  // Lead operations\r\n  fetchLeads() {\r\n    return this.makeRequest('getLeads', {});\r\n  }\r\n\r\n  addLead(lead) {\r\n    return this.makeRequest('addLead', { lead });\r\n  }\r\n\r\n  updateLead(lead) {\r\n    return this.makeRequest('updateLead', { lead });\r\n  }\r\n\r\n  deleteLead(leadId) {\r\n    return this.makeRequest('deleteLead', { leadId });\r\n  }\r\n\r\n  // Job Count operations\r\n  fetchJobCounts() {\r\n    return this.makeRequest('getJobCounts', {});\r\n  }\r\n\r\n  addJobCount(jobCount) {\r\n    return this.makeRequest('addJobCount', { jobCount });\r\n  }\r\n\r\n  updateJobCount(jobCount) {\r\n    return this.makeRequest('updateJobCount', { jobCount });\r\n  }\r\n\r\n  deleteJobCount(jobCountId) {\r\n    return this.makeRequest('deleteJobCount', { jobCountId });\r\n  }\r\n\r\n  // Utility operations\r\n  testConnection() {\r\n    return this.makeRequest('testConnection', {});\r\n  }\r\n\r\n  geocodeAddress(address) {\r\n    return this.makeRequest('geocodeAddress', { address });\r\n  }\r\n}\r\n\r\nexport const googleSheetsService = new GoogleSheetsService(GOOGLE_SCRIPT_URL);"],"mappings":"AAAA;AACA,IAAIA,iBAAiB,GAAGC,OAAO,CAACC,GAAG,CAACC,yBAAyB;;AAE7D;AACA,IAAIH,iBAAiB,IAAIA,iBAAiB,CAACI,QAAQ,CAAC,4BAA4B,CAAC,EAAE;EACjFJ,iBAAiB,GAAGA,iBAAiB,CAACK,KAAK,CAAC,4BAA4B,CAAC,CAAC,CAAC,CAAC;AAC9E;;AAEA;AACA,IAAIL,iBAAiB,IAAI,CAACA,iBAAiB,CAACM,UAAU,CAAC,MAAM,CAAC,EAAE;EAC9DN,iBAAiB,GAAG,UAAU,GAAGA,iBAAiB,CAACO,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;AACxE;AAEA,MAAMC,mBAAmB,CAAC;EACxBC,WAAWA,CAACC,OAAO,EAAE;IACnB,IAAI,CAACA,OAAO,GAAGA,OAAO;EACxB;EAEA,MAAMC,WAAWA,CAACC,MAAM,EAAEC,OAAO,EAAE;IACjC,IAAI,CAAC,IAAI,CAACH,OAAO,EAAE;MACjB,OAAO;QAAEI,OAAO,EAAE,KAAK;QAAEC,OAAO,EAAE;MAAkC,CAAC;IACvE;IAEA,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,IAAI,CAACP,OAAO,EAAE;QACzCQ,MAAM,EAAE,MAAM;QACdC,IAAI,EAAE,MAAM;QACZC,WAAW,EAAE,MAAM;QACnBC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAAEZ,MAAM;UAAE,GAAGC;QAAQ,CAAC;MAC7C,CAAC,CAAC;MAEF,IAAI,CAACG,QAAQ,CAACS,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,iCAAiCV,QAAQ,CAACW,MAAM,EAAE,CAAC;MACrE;MAEA,MAAMC,IAAI,GAAG,MAAMZ,QAAQ,CAACY,IAAI,CAAC,CAAC;MAElC,IAAI;QACF,MAAMC,MAAM,GAAGN,IAAI,CAACO,KAAK,CAACF,IAAI,CAAC;QAC/B,IAAIC,MAAM,CAACf,OAAO,KAAK,KAAK,EAAE;UAC5B,MAAM,IAAIY,KAAK,CAACG,MAAM,CAACd,OAAO,IAAI,oCAAoC,CAAC;QACzE;QACA,OAAOc,MAAM;MACf,CAAC,CAAC,OAAOE,UAAU,EAAE;QACnB,MAAM,IAAIL,KAAK,CAAC,wDAAwD,CAAC;MAC3E;IACF,CAAC,CAAC,OAAOM,KAAK,EAAE;MACd,OAAO;QAAElB,OAAO,EAAE,KAAK;QAAEC,OAAO,EAAE,kBAAkBiB,KAAK,CAACjB,OAAO;MAAG,CAAC;IACvE;EACF;;EAEA;EACAkB,UAAUA,CAAA,EAAG;IACX,OAAO,IAAI,CAACtB,WAAW,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;EACzC;EAEAuB,OAAOA,CAACC,IAAI,EAAE;IACZ,OAAO,IAAI,CAACxB,WAAW,CAAC,SAAS,EAAE;MAAEwB;IAAK,CAAC,CAAC;EAC9C;EAEAC,UAAUA,CAACD,IAAI,EAAE;IACf,OAAO,IAAI,CAACxB,WAAW,CAAC,YAAY,EAAE;MAAEwB;IAAK,CAAC,CAAC;EACjD;EAEAE,UAAUA,CAACC,MAAM,EAAE;IACjB,OAAO,IAAI,CAAC3B,WAAW,CAAC,YAAY,EAAE;MAAE2B;IAAO,CAAC,CAAC;EACnD;;EAEA;EACAC,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI,CAAC5B,WAAW,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;EAC7C;EAEA6B,WAAWA,CAACC,QAAQ,EAAE;IACpB,OAAO,IAAI,CAAC9B,WAAW,CAAC,aAAa,EAAE;MAAE8B;IAAS,CAAC,CAAC;EACtD;EAEAC,cAAcA,CAACD,QAAQ,EAAE;IACvB,OAAO,IAAI,CAAC9B,WAAW,CAAC,gBAAgB,EAAE;MAAE8B;IAAS,CAAC,CAAC;EACzD;EAEAE,cAAcA,CAACC,UAAU,EAAE;IACzB,OAAO,IAAI,CAACjC,WAAW,CAAC,gBAAgB,EAAE;MAAEiC;IAAW,CAAC,CAAC;EAC3D;;EAEA;EACAC,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI,CAAClC,WAAW,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;EAC/C;EAEAmC,cAAcA,CAACC,OAAO,EAAE;IACtB,OAAO,IAAI,CAACpC,WAAW,CAAC,gBAAgB,EAAE;MAAEoC;IAAQ,CAAC,CAAC;EACxD;AACF;AAEA,OAAO,MAAMC,mBAAmB,GAAG,IAAIxC,mBAAmB,CAACR,iBAAiB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}